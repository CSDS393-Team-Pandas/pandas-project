/*!
*  filename: ej2-spreadsheet.umd.min.js
*  version : 19.4.48
*  Copyright Syncfusion Inc. 2001 - 2020. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@syncfusion/ej2-base"),require("@syncfusion/ej2-data"),require("@syncfusion/ej2-splitbuttons"),require("@syncfusion/ej2-popups"),require("@syncfusion/ej2-navigations"),require("@syncfusion/ej2-inputs"),require("@syncfusion/ej2-buttons"),require("@syncfusion/ej2-dropdowns"),require("@syncfusion/ej2-lists"),require("@syncfusion/ej2-grids"),require("@syncfusion/ej2-charts")):"function"==typeof define&&define.amd?define(["exports","@syncfusion/ej2-base","@syncfusion/ej2-data","@syncfusion/ej2-splitbuttons","@syncfusion/ej2-popups","@syncfusion/ej2-navigations","@syncfusion/ej2-inputs","@syncfusion/ej2-buttons","@syncfusion/ej2-dropdowns","@syncfusion/ej2-lists","@syncfusion/ej2-grids","@syncfusion/ej2-charts"],t):t(e.ej={},e.ej2Base,e.ej2Data,e.ej2Splitbuttons,e.ej2Popups,e.ej2Navigations,e.ej2Inputs,e.ej2Buttons,e.ej2Dropdowns,e.ej2Lists,e.ej2Grids,e.ej2Charts)}(this,function(exports,ej2Base,ej2Data,ej2Splitbuttons,ej2Popups,ej2Navigations,ej2Inputs,ej2Buttons,ej2Dropdowns,ej2Lists,ej2Grids,ej2Charts){"use strict";function getRangeIndexes(e){var t,r=[];return e=e.indexOf("!")>-1?e.split("!")[1]:e,(e=-1===e.indexOf(":")?e+":"+e:e).split(":").forEach(function(e){t=getCellIndexes(e),r.push(t[0]),r.push(t[1])}),r}function getCellIndexes(e){return[parseInt(e.match(/\d+/)[0],10)-1,getColIndex(e.match(/[A-Z]+/i)[0].toUpperCase())]}function getColIndex(e){for(var t=0,r=(e=e.split("").reverse().join("")).length-1;r>=0;r--)t+=(e[r].charCodeAt(0)-64)*Math.pow(26,r);return t-1}function getCellAddress(e,t){return getColumnHeaderText(t+1)+(e+1)}function getRangeAddress(e){return getCellAddress(e[0],e[1])+":"+(ej2Base.isNullOrUndefined(e[2])?getCellAddress(e[0],e[1]):getCellAddress(e[2],e[3]))}function getColumnHeaderText(e){return e/26>1?getColumnHeaderText(e%26==0?e/26-1:Math.floor(e/26))+String.fromCharCode(e%26==0?"Z".charCodeAt(0):64+e%26):String.fromCharCode(64+e)}function getIndexesFromAddress(e){return getRangeIndexes(getRangeFromAddress(e))}function getRangeFromAddress(e){return e.split("!")[1]||e}function getAddressFromSelectedRange(e){return e.name+"!"+e.selectedRange}function getAddressInfo(e,t){var r;return r=t.indexOf("!")>-1?getSheetIndex(e,getSheetNameFromAddress(t)):e.activeSheetIndex,{sheetIndex:r,indices:getIndexesFromAddress(t)}}function getSwapRange(e){var t=e.slice();return e[0]>e[2]&&swap(t,0,2),e[1]>e[3]&&swap(t,1,3),t}function swap(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function isSingleCell(e){return e[0]===e[2]&&e[1]===e[3]}function executeTaskAsync(e,t,r,n,i){return new WorkerHelper(e,t,r,n,i)}function toFraction(e){var t=e.toString();if(e===parseInt(t,10))return parseInt(t,10)+"  ";var r=t.indexOf(".")>-1?t.split(".")[1]:0,n=Math.pow(10,r.toString().replace("-","").length),i=Math.abs(getGcd(r,n));return r/i+"/"+n/i}function getGcd(e,t){return e=Number(e),(t=Number(t))?getGcd(t,e%t):e}function intToDate(e){(e=(e=Number(e))>0&&e<1?1+e:0===e?1:e)>60&&(e-=1);var t=new Date("01/01/1900"),r=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds());return new Date(new Date(864e5*(e-1)+r).toUTCString().replace(" GMT",""))}function dateToInt(e,t,r){var n=new Date("01/01/1900"),i=isDateTime(e)?e:new Date(e),o=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),a=(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())-o)/864e5;return(t?a:parseInt(a.toString(),10))+(r?0:a>60?2:1)}function isDateTime(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.valueOf())}function isNumber(e){return e-parseFloat(e)>=0}function toDate(e,t,r,n,i){var o=ej2Base.IntlBase.getDependables(ej2Base.cldrData,r,null).dateObject,a=o.dateTimeFormats.availableFormats,s={dateObj:null,isCustom:!1,type:""};if("string"==typeof e&&(e=e.toUpperCase()),n&&(s.dateObj=t.parseDate(e,{format:n}),s.dateObj&&(s.type=e.toString().indexOf(":")>-1?"time":"datetime",s.isCustom=!0)),ej2Base.isNullOrUndefined(s.dateObj)){if((e=e.toString())&&e.indexOf("/")>-1||e.indexOf("-")>0){var l=i?i.format:n;if(("dd-MM-yyyy"===l||"dd/MM/yyyy"===l)&&(l="dd-MM-yyyy"===l?"d-M-y":"d/M/y",s.dateObj=t.parseDate(e,{format:l}),s.dateObj))return s.type="date",s}if(e.indexOf(":")<0)for(var d=0,p=Object.keys(o.dateFormats);d<p.length;d++){var h=p[d];if(s.dateObj=t.parseDate(e,{format:o.dateFormats[h],skeleton:h}),s.dateObj){s.type="date",s.isCustom=!1;break}}if(ej2Base.isNullOrUndefined(s.dateObj))for(var c=0,u=Object.keys(a);c<u.length;c++){h=u[c];if(s.dateObj=t.parseDate(e,{format:a[h],skeleton:h}),!s.dateObj&&e.indexOf(":")>-1&&a[h].indexOf(":")>-1&&(s.dateObj=t.parseDate(e,{format:a[h].split(" ")[0]})),s.dateObj){if(s.type=e.toString().indexOf(":")>-1?"time":"datetime","time"===s.type){var g=s.dateObj.toLocaleTimeString();s.dateObj=new Date("01/01/1900 "+g)}s.isCustom=!0;break}}if(ej2Base.isNullOrUndefined(s.dateObj))for(var f=0,m=Object.keys(o.timeFormats);f<m.length;f++){h=m[f];if(s.dateObj=t.parseDate(e,{format:o.timeFormats[h],skeleton:h}),s.dateObj){g=s.dateObj.toLocaleTimeString();s.dateObj=new Date("01/01/1900 "+g),s.type="time",s.isCustom=!1;break}}}return"#DIV/0!"===e||s.dateObj||"Invalid Date"===new Date(e).toString()||(s.dateObj=new Date(e)),s}function parseIntValue(e){return e&&/^\d*\.?\d*$/.test(e)?parseFloat(e):e}function getFormatFromType(e){var t="General";switch(e.split(" ").join("")){case"Number":t="0.00";break;case"Currency":t="$#,##0.00";break;case"Accounting":t='_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)';break;case"ShortDate":t="mm-dd-yyyy";break;case"LongDate":t="dddd, mmmm dd, yyyy";break;case"Time":t="h:mm:ss AM/PM";break;case"Percentage":t="0.00%";break;case"Fraction":t="# ?/?";break;case"Scientific":t="0.00E+00";break;case"Text":t="@"}return t}function getTypeFromFormat(e){var t="General";switch(e){case'_-* #,##0.00_-;-* #,##0.00_-;_-* "-"_-;_-@_-':case'_-* #,##0_-;-* #,##0_-;_-* "-"_-;_-@_-':t="Number";break;case"$#,##0.00":case"$#,##0_);[Red]($#,##0)":case"$#,##0.00_);($#,##0.00)":case"$#,##0_);($#,##0)":t="Currency";break;case'_($*#,##0.00_);_($*(#,##0.00);_($*"-"??_);_(@_)':case'_($*#,##0.00_);_($* (#,##0.00);_($*"-"??_);_(@_)':case'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)':case'_ $ * #,##0.00_ ;_ $ * -#,##0.00_ ;_ $ * "-"??_ ;_ @_ ':t="Accounting";break;case"mm-dd-yyyy":case"dd/MM/yyyy":t="ShortDate";break;case"dddd, mmmm dd, yyyy":t="LongDate";break;case"h:mm:ss AM/PM":t="Time";break;case"0.00%":case"0%":t="Percentage";break;case"# ?/?":case"# ??/??":case"# ???/???":t="Fraction";break;case"0.00E+00":t="Scientific";break;case"@":t="Text";break;default:e&&e.indexOf("[$")>-1&&(t=e.indexOf("* ")>-1?"Accounting":"Currency")}return t}function isUndefined$1(e){return void 0===e}function getSkeletonVal(e){switch(e){case"dd-MMM-yyyy":case"dd MMM yyyy":e="medium";break;case"MMM-yyyy":case"MMM yyyy":e="yMMM";break;case"MM-dd-yyyy":case"dd-MM-yyyy":case"dd-MM-yy":case"MM/dd/yyyy":case"dd/MM/yyyy":case"dd/MM/yy":e="short";break;case"dddd MMMM dd yyyy":case"dd MMMM yyyy":e="long";break;case"d MMMM yyyy":e="yMMMd";break;case"yyyy":e="y";break;case"h:mm":e="Hm";break;case"h:mm tt":e="hm";break;case"h":e="H";break;case"h tt":e="h";break;case"dddd":e="E";break;case"h:mm:ss tt":e="hms";break;case"h:mm:ss":e="Hms";break;case"d":e="d";break;case"d dddd":e="Ed";break;case"M":e="M";break;case"Md":e="Md";break;case"MMM":e="MMM";break;case"ddd MMM d":e="MMMEd";break;case"MMM d":e="MMMd";break;case"M/yyyy":e="yM";break;case"ddd":e="E";break;default:e=""}return e}function getModules(e){var t=[];return e.includeBasicFormulas&&t.push({member:"basic-formulas",args:[e]}),t}function getValue$1(e,t){for(var r=t,n=e.replace(/\[/g,".").replace(/\]/g,"").split("."),i=0;i<n.length&&!ej2Base.isUndefined(r);i++)r=r[n[i]];return r}function setValue(e,t,r){var n,i,o=e.replace(/\[/g,".").replace(/\]/g,"").split("."),a=r||{},s=a,l=o.length;for(n=0;n<l;n++)i=o[n],n+1===l?s[i]=void 0===t?{}:t:ej2Base.isNullOrUndefined(s[i])&&(s[i]={}),s=s[i];return a}function getAlphalabel(e){for(var t=[],r=0;e>0&&r<9;){e--;var n="A".charCodeAt(0);t[r]=String.fromCharCode(e%26+n),e=parseInt((e/26).toString(),10),r++}for(var i=[],o=0;o<r;o++)i[r-o-1]=t[o];return i.join("")}function getWorkbookRequiredModules(e,t){return void 0===t&&(t=[]),t.push({member:"workbookBasic",args:[]}),t.push({member:"workbookAll",args:[]}),t.push({member:"dataBind",args:[e]}),t.push({member:"workbookProtectSheet",args:[e]}),e.allowSave&&t.push({member:"workbookSave",args:[e]}),e.allowOpen&&t.push({member:"workbookOpen",args:[e]}),e.allowEditing&&(t.push({member:"workbookEdit",args:[e]}),t.push({member:"workbookFormula",args:[e]})),e.allowNumberFormatting&&t.push({member:"workbookNumberFormat",args:[e]}),e.allowCellFormatting&&t.push({member:"workbookcellformat",args:[e]}),e.allowSorting&&t.push({member:"workbookSort",args:[e]}),e.allowHyperlink&&t.push({member:"workbookHyperlink",args:[e]}),e.allowFiltering&&t.push({member:"workbookFilter",args:[e]}),e.allowFindAndReplace&&t.push({member:"workbookfindAndReplace",args:[e]}),e.allowInsert&&t.push({member:"workbookinsert",args:[e]}),e.allowDelete&&t.push({member:"workbookdelete",args:[e]}),e.allowDataValidation&&t.push({member:"workbookDataValidation",args:[e]}),e.allowMerge&&t.push({member:"workbookmerge",args:[e]}),e.allowCellFormatting&&t.push({member:"workbookConditionalFormatting",args:[e]}),e.allowImage&&t.push({member:"workbookImage",args:[e]}),e.allowChart&&t.push({member:"workbookChart",args:[e]}),e.allowAutoFill&&t.push({member:"workbookautofill",args:[e]}),t}function checkIsFormula(e,t){return e&&"="===e[0]&&(e.length>1||t)}function isCellReference(e){var t=e;if((t=t.split("$").join("")).indexOf(":")>-1){var r=t.split(":");if(isValidCellReference(r[0])&&isValidCellReference(r[1]))return!0}else if(t.indexOf(":")<0&&isValidCellReference(t))return!0;return!1}function isChar(e){return e.charCodeAt(0)>=65&&e.charCodeAt(0)<=90||e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122}function isRowSelected(e,t){return 0===t[1]&&t[3]===e.colCount-1}function isColumnSelected(e,t){return 0===t[0]&&t[2]===e.rowCount-1}function inRange(e,t,r){return e&&t>=e[0]&&t<=e[2]&&r>=e[1]&&r<=e[3]}function isInRange(e,t,r){var n=e[0]<=t[0]&&e[2]>=t[2]&&e[1]<=t[1]&&e[3]>=t[3];if(n)return!0;if(r){if(t[0]<e[0]&&t[2]<e[0]||t[0]>e[2]&&t[2]>e[2])return!1;if(t[0]<e[0]&&t[2]>e[0]&&(t[0]=e[0],n=!0),t[2]>e[2]&&(t[2]=e[2],n=!0),t[1]<e[1]&&t[3]<e[1]||t[1]>e[3]&&t[3]>e[3])return!1;t[1]<e[1]&&t[3]>e[1]&&(t[1]=e[1],n=!0),t[3]>e[3]&&(t[3]=e[3],n=!0)}return n}function isLocked(e,t){return e||(e={}),!!e.isLocked||!1!==e.isLocked&&(!(!t||!t.isLocked)||!(e.isLocked||!t||!1===t.isLocked))}function isValidCellReference(e){for(var t=e,r=0,n=0,i=[89,71,69],o="",a=t.length,s=0;s<a;s++)isChar(t[s])&&r++;var l=(o=t.substring(0,r)).length;if(l!==a&&l<4&&1!==a&&isNaN(parseInt(t,10))){for(;n<l;){if(!(o[n]&&o[n].charCodeAt(0)<i[n])){if(!o[n]&&n>0)break;return!1}n++}var d=parseFloat(t.substring(r,a));if(d>0&&d<1048577)return!0}return!1}function getUpdatedFormula(e,t,r,n){var i,o;if(t&&(i=(o=n||getCell(t[0],t[1],r,!1,!0)).formula?o.formula.toUpperCase():""),i){0===i.indexOf("=")&&(i=i.slice(1));for(var a=["+","-","*","/",">=","<=","<>",">","<","=","%"],s=void 0,l=i=i.split("(").join(",").split(")").join(","),d=0;d<a.length;d++)l=(s=l.split(a[d])).join(",");s=l.split(",");for(var p=[],h=void 0,c=void 0,u=0;u<s.length;u++)if(isCellReference(s[u])){var g=getRangeIndexes(s[u]),f=[e[0]-(t[0]-g[0]),e[1]-(t[1]-g[1]),e[0]-(t[0]-g[2]),e[1]-(t[1]-g[3])];f[0]<0||f[1]<0||f[2]<0||f[3]<0?h="#REF!":(h=getCellAddress(f[0],f[1]),s[u].includes(":")&&(h+=":"+getCellAddress(f[2],f[3])),h=isCellReference(h)?h:"#REF!"),(c={})[s[u]]=h,s[u].includes(":")?p.splice(0,0,c):p.push(c)}var m=void 0;i=o.formula;for(u=0;u<p.length;u++)m=Object.keys(p[u])[0],i=i.replace(new RegExp(m,"gi"),p[u][m].toUpperCase());return i}return null}function updateCell(e,t,r){var n={cell:r.cell,rowIndex:r.rowIdx,colIndex:r.colIdx,cancel:!1,sheetId:t.id};if(r.preventEvt||e.trigger(beforeCellUpdate,n),!r.eventOnly&&!n.cancel)if(r.valChange){var i=e.getDisplayText(getCell(n.rowIndex,n.colIndex,t));setCell(n.rowIndex,n.colIndex,t,n.cell,!r.pvtExtend);var o=getSheetIndex(e,t.name),a=getCell(n.rowIndex,n.colIndex,t,!1,!0);e.notify(workbookEditOperation,{action:"updateCellValue",address:[n.rowIndex,n.colIndex],sheetIndex:o,value:void 0===a.formula?a.value||(0===a.value?"0":""):a.formula});var s=getCell(n.rowIndex,n.colIndex,t,!1,!0).value;s=s||(0===s?"0":""),r.uiRefresh&&e.serviceLocator.getService("cell").refresh(n.rowIndex,n.colIndex,r.lastCell,r.td,r.checkCf,r.checkWrap),s!==i&&e.trigger("cellSave",{value:s,oldValue:i,displayText:e.getDisplayText(a),address:t.name+"!"+getCellAddress(n.rowIndex,n.colIndex),formula:a.formula||""})}else setCell(n.rowIndex,n.colIndex,t,n.cell,!r.pvtExtend);return n.cancel}function getDataRange(e,t,r){var n=0,i=0,o=0,a=r.usedRange.rowIndex+r.usedRange.colIndex,s={rowIndex:e,colIndex:t},l={rowIndex:e,colIndex:t};for(n=1;n<a+1;n++){for(i=-o;i<o+1;i++)getCell(e+i,t+n,r,null,!0).value&&(l.rowIndex=l.rowIndex>e+i?l.rowIndex:e+i,l.colIndex=l.colIndex>t+n?l.colIndex:t+n);for(getCell(e+n,t+n,r,null,!0).value&&(l.rowIndex=l.rowIndex>e+n?l.rowIndex:e+n,l.colIndex=l.colIndex>t+n?l.colIndex:t+n),i=-o;i<o+1;i++)getCell(e+n,t+i,r,null,!0).value&&(l.rowIndex=l.rowIndex>e+n?l.rowIndex:e+n,l.colIndex=l.colIndex>t+i?l.colIndex:t+i);for(getCell(e+n,t-n,r,null,!0).value&&(l.rowIndex=l.rowIndex>e+n?l.rowIndex:e+n,s.colIndex=s.colIndex<t-n?s.colIndex:t-n),i=-o;i<o+1;i++)getCell(e+i,t-n,r,null,!0).value&&(s.rowIndex=s.rowIndex<e+i?s.rowIndex:e+i,s.colIndex=s.colIndex<t-n?s.colIndex:t-n,l.rowIndex=l.rowIndex>e+i?l.rowIndex:e+i);for(getCell(e-n,t-n,r,null,!0).value&&(s.rowIndex=s.rowIndex<e-n?s.rowIndex:e-n,s.colIndex=s.colIndex<t-n?s.colIndex:t-n),i=-o;i<o+1;i++)getCell(e-n,t+i,r,null,!0).value&&(s.rowIndex=s.rowIndex<e-n?s.rowIndex:e-n,s.colIndex=s.colIndex<t+i?s.colIndex:t+i,l.colIndex=l.colIndex>t+i?l.colIndex:t+i);getCell(e-n,t+n,r,null,!0).value&&(s.rowIndex=s.rowIndex<e-n?s.rowIndex:e-n,l.colIndex=l.colIndex>t+n?l.colIndex:t+n),o++}return[s.rowIndex,s.colIndex,l.rowIndex,l.colIndex]}function getData(e,t,r,n,i,o,a,s,l,d,p){return void 0===l&&(l=!0),new Promise(function(h,c){h(function(){var h,c,u,g=new Map;t.indexOf("!")>-1?(u=getSheetIndex(e,getSheetNameFromAddress(t)),t=t.slice(t.indexOf("!")+1,t.length)):u=e.activeSheetIndex;var f=getSheet(e,u),m=getIndexesFromAddress(d||t),v=m[0],C={sheet:f,indexes:m,formulaCellRef:a,sheetIndex:s,isFinite:e.scrollSettings&&e.scrollSettings.isFinite,promise:new Promise(function(e,t){e(void 0)})};return e.notify(updateSheetFromDataSource,C),C.promise.then(function(){var a=e.frozenRowCount(f),s=e.frozenColCount(f);if(r){g instanceof Map&&(g=[]);var d;t.split(",").forEach(function(t){for(m=getRangeIndexes(t),d=0,v=m[0];v<=m[2];){var r=g[d.toString()]||{};for(c=getRow(f,v),h=m[1];h<=m[3];)if(l&&isHiddenRow(f,v)&&!o)v++;else{var i=getColumnHeaderText(h+1);if(n)r[i]=c?getValueFromFormat(e,v,h,u,f):"","string"==typeof r[i]&&Number(r[i])&&(r[i]=Number(r[i]));else{var a=c?getCell(v,h,f):null;(a&&(a.formula||!ej2Base.isNullOrUndefined(a.value))||Object.keys(r).length)&&(h===p?(r[i]=ej2Base.extend({},a,{value:getValueFromFormat(e,v,h,u,f,!0)}),"string"==typeof r[i].value&&Number(r[i].value)&&(r[i].value=Number(r[i].value))):r[i]=a)}m[3]<h+1&&Object.keys(r).length&&(r.__rowIndex=(v+1).toString()),g[d.toString()]=r,h++}v++,Object.keys(r).length?d++:g.pop()}})}else for(;v<=m[2];){for(c=getRow(f,v),h=m[1];h<=m[3];){var C={cell:getCell(v,h,f),address:getCellAddress(v,h),rowIndex:v,colIndex:h};e.trigger(queryCellInfo,C);var y=getCell(v,h,f,!1,!0);if(y.colSpan>1&&y.rowSpan>1)for(var x=void 0,b=v,S=v+y.rowSpan;b<S;b++)for(var w=h,I=h+y.colSpan;w<I;w++)b===v&&w===h||(x=new Object,b!==v&&(x.rowSpan=v-b),w!==h&&(x.colSpan=h-w),f.rows[b]&&f.rows[b].cells&&f.rows[b].cells[w]&&(delete f.rows[b].cells[w].value,delete f.rows[b].cells[w].formula),setCell(b,w,f,x,!0));else if(y.colSpan>1)for(b=h+1,S=h+y.colSpan;b<S;b++)setCell(v,b,f,{colSpan:h-b},!0),f.rows[v]&&f.rows[v].cells&&f.rows[v].cells[b]&&(delete f.rows[v].cells[b].value,delete f.rows[v].cells[b].formula);else if(y.rowSpan>1)for(b=v+1,S=v+y.rowSpan;b<S;b++)setCell(b,h,f,{rowSpan:v-b},!0),f.rows[b]&&f.rows[b].cells&&f.rows[b].cells[h]&&(delete f.rows[b].cells[h].value,delete f.rows[b].cells[h].formula);if(n||!isHiddenRow(f,v))if(n||!isHiddenCol(f,h)){if(!n&&i&&i.length){if(v>=a&&v<i[0]){v++;continue}if(h>=s&&h<i[1]){h++;continue}}if(y.style){var R={};Object.assign(R,y.style),y.style=R}g.set(C.address,y),h++}else h++;else v++}v++}return g})}())})}function getValueFromFormat(e,t,r,n,i,o){var a=getCell(t,r,i);if(a){if(a.format){var s={value:e.getDisplayText(a),rowIndex:t,colIndex:r,sheetIndex:n,dateObj:"",isDate:!1,isTime:!1};return e.notify(checkDateFormat,s),s.isDate?o?s.updatedVal:s.dateObj:a.value}return a.value}return""}function getModel(e,t){var r,n,i;if(ej2Base.isUndefined(e[t])||!e[t]||e[t].index!==t)for(var o=0;o<=t;o++)if(e&&e[o]){if((r=e[o].index-o)>0){for(e.forEach(function(e,t){e&&e.index&&(i=e.index,n=1),e&&!e.index&&0!==t&&(e.index=i+n),n++});r--;)e.splice(o,0,null);o+=r}}else e?e[o]=null:e=[];return e[t]}function processIdx(e,t,r){for(var n,i,o,a=0,s=e.length,l=function(l){if(ej2Base.isNullOrUndefined(e[l])||ej2Base.isUndefined(e[l].index)||(i=a=e[l].index-l,delete e[l].index),a>0){for(n=0;a--;)t?(r.createSheet(l+n),n++):e.splice(l,0,null);l+=i,s+=i}if(t){e[l].id<1&&(e[l].id=getMaxSheetId(r.sheets),e[l].properties&&(e[l].properties.id=e[l].id)),e[l].name||r.setSheetPropertyOnMute(e[l],"name","Sheet"+getSheetNameCount(r));var d=0;e[l].rows.forEach(function(e){d=Math.max(d,e&&e.cells&&e.cells.length-1||0)}),r.setSheetPropertyOnMute(e[l],"usedRange",{rowIndex:e[l].rows.length?e[l].rows.length-1:0,colIndex:d})}o=l},d=0;d<s;d++)l(d),d=o}function getSheetIndex(e,t){for(var r,n=0;n<e.sheets.length;n++)if(e.sheets[n].name.toLowerCase()===t.toLowerCase()){r=n;break}return r}function getSheetIndexFromId(e,t){for(var r,n=0;n<e.sheets.length;n++)if(e.sheets[n].id===t){r=n;break}return r}function getSheetNameFromAddress(e){return e.split("!")[0].replace(/\'/gi,"")}function getSheetIndexByName(e,t,r){for(var n=r.length,i=0;i<n;i++)if(r[i].sheet.toUpperCase()===t.toUpperCase())return r[i].index;return-1}function updateSelectedRange(e,t,r,n){void 0===r&&(r={}),e.setSheetPropertyOnMute(r,"selectedRange",n?r.selectedRange+" "+t:t)}function getSelectedRange(e){return e&&e.selectedRange||"A1"}function getSingleSelectedRange(e){return e.selectedRange.split(" ")[0]}function getSheet(e,t){return e.sheets[t]}function getSheetNameCount(e){var t=[];e.sheets.forEach(function(e){t.push(e.name.toLowerCase())});for(var r=0;r<t.length;r++){if(!(t.indexOf("sheet"+e.sheetNameCount)>-1))return e.sheetNameCount++;e.sheetNameCount++}return e.sheetNameCount++}function getMaxSheetId(e){var t=0;return e.forEach(function(e){t=Math.max(e.id,t)}),t+1}function initSheet(e,t){var r=t||e.sheets;r.forEach(function(t){if(t.id=t.id||0,t.name=t.name||"",t.rowCount=ej2Base.isUndefined(t.rowCount)?100:t.rowCount,t.colCount=ej2Base.isUndefined(t.colCount)?100:t.colCount,t.topLeftCell=t.topLeftCell||"A1",t.activeCell=t.activeCell||"A1",t.selectedRange=t.selectedRange||"A1:A1",t.usedRange=t.usedRange||{rowIndex:0,colIndex:0},e.setSheetPropertyOnMute(t,"ranges",t.ranges?t.ranges:[]),e.setSheetPropertyOnMute(t,"rows",t.rows&&ej2Base.extend([],t.rows,null,!0)||[]),e.setSheetPropertyOnMute(t,"columns",t.columns||[]),t.showHeaders=!!ej2Base.isUndefined(t.showHeaders)||t.showHeaders,t.showGridLines=!!ej2Base.isUndefined(t.showGridLines)||t.showGridLines,t.state=t.state||"Visible",t.maxHgts=[],t.protectSettings=t.protectSettings||{selectCells:!1,formatCells:!1,formatRows:!1,formatColumns:!1,insertLink:!1},t.isProtected=t.isProtected||!1,!t.paneTopLeftCell||"A1"===t.paneTopLeftCell){t.frozenRows=t.frozenRows?t.frozenRows:0,t.frozenColumns=t.frozenColumns?t.frozenColumns:0;var r=getCellIndexes(t.topLeftCell);e.setSheetPropertyOnMute(t,"paneTopLeftCell",getCellAddress(t.frozenRows?r[0]+t.frozenRows:r[0],t.frozenColumns?r[1]+t.frozenColumns:r[1]))}processIdx(t.columns),initRow(t.rows)}),processIdx(r,!0,e)}function initRow(e){e.forEach(function(e){e&&e.cells&&processIdx(e.cells)}),processIdx(e)}function getSheetName(e,t){return void 0===t&&(t=e.activeSheetIndex),getSheet(e,t).name}function moveSheet(e,t,r,n){var i=!!r;r=r||[e.activeSheetIndex];var o={action:"moveSheet",position:t=getNextPrevVisibleSheetIndex(e.sheets,t,e.activeSheetIndex>t),sheetIndexes:r,cancel:!1};n&&e.trigger("actionBegin",o),o.cancel||(r.forEach(function(r,n){e.sheets.splice(t+n,0,e.sheets.splice(r+(t>r?-1*n:0),1)[0])}),e.setProperties({activeSheetIndex:t>r[0]?t-(r.length-1):t},!0),e.notify(moveOrDuplicateSheet,{refresh:i}),n&&(delete o.cancel,e.trigger("actionComplete",o)))}function duplicateSheet(e,t,r){var n={action:"duplicateSheet",sheetIndex:t=ej2Base.isUndefined(t)?e.activeSheetIndex:t,cancel:!1};if(r&&e.trigger("actionBegin",n),!n.cancel){var i=getSheet(e,t),o=ej2Base.extend({},i.properties?i.properties:i,!0);o.id=getMaxSheetId(e.sheets);var a=o.name;/^\(\d+\)$/.test("("+a.split(" (")[1])&&(a=a.split(" (")[0]);var s=[];e.sheets.forEach(function(e){s.push(e.name)});for(var l=2;;l++)if(-1===s.indexOf(a+" ("+l+")")){o.name=a+" ("+l+")";break}e.createSheet(t+1,[o]),e.notify(workbookFormulaOperation,{action:"addSheet",sheetName:"Sheet"+o.id,visibleName:o.name,sheetId:o.id}),e.setProperties({activeSheetIndex:t+1},!0),e.notify(moveOrDuplicateSheet,{refresh:!0,isDuplicate:!0}),r&&(delete n.cancel,e.trigger("actionComplete",n))}}function getNextPrevVisibleSheetIndex(e,t,r){for(var n=t;r?n>=0:n<e.length;r?n--:n++)if("Hidden"!==e[n].state&&"VeryHidden"!==e[n].state){t=n;break}return t}function getCell(e,t,r,n,i){var o=getRow(r,e);if(!o||!o.cells){if(!n)return i?{}:null;o?r.rows[e].cells=[]:r.rows[e]={cells:[]}}return r.rows[e].cells[t]||(i?{}:null)}function setCell(e,t,r,n,i){r.rows[e]?r.rows[e].cells||(r.rows[e].cells=[]):r.rows[e]={cells:[]},i&&r.rows[e].cells[t]?ej2Base.extend(r.rows[e].cells[t],n,null,!0):r.rows[e].cells[t]=n}function skipDefaultValue(e,t){var r={fontFamily:"Calibri",verticalAlign:"bottom",textIndent:"0pt",backgroundColor:"#ffffff",color:"#000000",textAlign:"left",fontSize:"11pt",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",border:"",borderLeft:"",borderTop:"",borderRight:"",borderBottom:""},n={};return Object.keys(t?r:e).forEach(function(t){e[t]!==r[t]&&(n[t]=e[t])}),n}function wrap(e,t,r,n){void 0===t&&(t=!0);for(var i=r.getAddressInfo(e),o=i.indices,a=getSheet(r,i.sheetIndex),s=i.sheetIndex===r.activeSheetIndex,l=o[0];l<=o[2];l++)for(var d=o[1];d<=o[3];d++)!updateCell(r,a,{cell:{wrap:t},rowIdx:l,colIdx:d,preventEvt:n})&&s&&r.notify(wrapEvent,{range:o,wrap:t,sheet:a});r.setProperties({sheets:r.sheets},!0)}function getColorCode(e){var t,r=["Black","Blue","Cyan","Green","Magenta","Red","White","Yellow"];if(e.indexOf("[")>-1){var n=e.split("[")[1].split("]")[0];r.indexOf(n)>-1&&(t=n)}return t}function getCustomColors(){return["Black","Blue","Cyan","Green","Magenta","Red","White","Yellow"]}function getRow(e,t){return e.rows[t]}function setRow(e,t,r){e.rows[t]||(e.rows[t]={}),Object.keys(r).forEach(function(n){e.rows[t][n]=r[n]})}function isHiddenRow(e,t){return e.rows[t]&&e.rows[t].hidden}function getRowHeight(e,t,r,n){var i;if(e&&e.rows&&e.rows[t]){if(!n&&e.rows[t].hidden)return 0;i=void 0===e.rows[t].height?20:e.rows[t].height}else i=20;if(r&&window.devicePixelRatio%1>0){var o=i*window.devicePixelRatio%1;return i+(o?(o>.5?1-o:-1*o)/window.devicePixelRatio:0)}return i}function setRowHeight(e,t,r){e&&e.rows&&(e.rows[t]||(e.rows[t]={}),e.rows[t].height=r)}function getRowsHeight(e,t,r,n,i){void 0===r&&(r=t);var o,a=0;t>r&&(o=t,t=r,r=o);for(var s=t;s<=r;s++)a+=getRowHeight(e,s,n,i);return a}function getColumn(e,t){return e.columns?e.columns[t]||(e.columns[t]={}):(e.columns=[],e.columns[t]={}),e.columns[t]}function setColumn(e,t,r){var n=getColumn(e,t);Object.keys(r).forEach(function(e){n[e]=r[e]})}function getColumnWidth(e,t,r,n){var i;if(e&&e.columns&&e.columns[t]){if(!r&&e.columns[t].hidden)return 0;i=e.columns[t].width||e.columns[t].customWidth?e.columns[t].width:64}else i=64;if(n&&window.devicePixelRatio%1>0){var o=i*window.devicePixelRatio%1;return i+(o?(o>.5?1-o:-1*o)/window.devicePixelRatio:0)}return i}function getColumnsWidth(e,t,r,n){void 0===r&&(r=t);var i=0;if(t>r){var o=t;t=r,r=o}for(var a=t;a<=r;a++)i+=getColumnWidth(e,a,null,n);return i}function isHiddenCol(e,t){return e.columns[t]&&e.columns[t].hidden}function getRequiredModules(e){var t=[];return pushBasicModules(e,t),getWorkbookRequiredModules(e,t),t}function pushBasicModules(e,t){t.push({member:"basic",args:[]}),t.push({member:"all",args:[]}),e.showRibbon&&t.push({member:"ribbon",args:[e]}),e.showFormulaBar&&t.push({member:"formulaBar",args:[e]}),e.showSheetTabs&&t.push({member:"sheetTabs",args:[e]}),e.allowEditing&&(t.push({member:"edit",args:[e]}),t.push({member:"formula",args:[e]}),t.push({member:"workbookFormula",args:[e]}),t.push({member:"workbookEdit",args:[e]})),e.allowOpen&&t.push({member:"open",args:[e]}),e.allowSave&&t.push({member:"save",args:[e]}),e.enableContextMenu&&t.push({member:"contextMenu",args:[e]}),e.allowAutoFill&&t.push({member:"autofill",args:[e]}),"None"!==e.selectionSettings.mode&&t.push({member:"selection",args:[e]}),e.enableKeyboardNavigation&&t.push({member:"keyboardNavigation",args:[e]}),e.allowNumberFormatting&&t.push({member:"numberFormat",args:[e]}),e.enableKeyboardShortcut&&t.push({member:"keyboardShortcut",args:[e]}),e.enableClipboard&&t.push({member:"clipboard",args:[e]}),e.allowCellFormatting&&t.push({member:"cellformat",args:[e]}),e.allowSorting&&t.push({member:"sort",args:[e]}),e.allowResizing&&t.push({member:"resize",args:[e]}),t.push({member:"collaborativeEditing",args:[e]}),t.push({member:"protectSheet",args:[e]}),e.allowHyperlink&&t.push({member:"spreadsheetHyperlink",args:[e]}),e.allowUndoRedo&&t.push({member:"undoredo",args:[e]}),e.allowFiltering&&t.push({member:"filter",args:[e]}),e.allowWrap&&t.push({member:"wrapText",args:[e]}),e.allowInsert&&t.push({member:"insert",args:[e]}),e.allowDelete&&t.push({member:"delete",args:[e]}),e.allowDataValidation&&t.push({member:"dataValidation",args:[e]}),e.allowFindAndReplace&&t.push({member:"findAndReplace",args:[e]}),e.allowMerge&&t.push({member:"merge",args:[e]}),e.allowConditionalFormat&&t.push({member:"conditionalFormatting",args:[e]}),e.allowImage&&t.push({member:"spreadsheetImage",args:[e]}),e.allowChart&&t.push({member:"spreadsheetChart",args:[e]})}function getUpdateUsingRaf(e){requestAnimationFrame(function(){e()})}function removeAllChildren(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function getColGroupWidth(e){var t=30;return e.toString().length>3&&(t=10*e.toString().length),t}function getScrollBarWidth(){if(null!==scrollAreaWidth)return scrollAreaWidth;var e=document.createElement("div"),t=0;return e.style.cssText="width:100px;height: 100px;overflow: scroll;position: absolute;top: -9999px;",document.body.appendChild(e),t=e.offsetWidth-e.clientWidth|0,document.body.removeChild(e),scrollAreaWidth=t}function getSiblingsHeight(e,t){void 0===t&&(t=classes);return getHeightFromDirection(e,"previous",t)+getHeightFromDirection(e,"next",t)}function getHeightFromDirection(e,t,r){for(var n=e[t+"ElementSibling"],i=0;n;)r.some(function(e){return n.classList.contains(e)})&&(i+=n.offsetHeight),n=n[t+"ElementSibling"];return i}function inView(e,t,r){if(e.scrollSettings.enableVirtualization){var n,i=e.viewport.topIndex,o=e.viewport.leftIndex,a=e.viewport.bottomIndex,s=e.viewport.rightIndex,l=e.getActiveSheet();if(l.frozenRows||l.frozenColumns)return e.insideViewport(t[0],t[1])||e.insideViewport(t[2],t[3]);if(n=i<=t[0]&&a>=t[2]&&o<=t[1]&&s>=t[3])return!0;if(r){if(t[0]<i&&t[2]<i||t[0]>a&&t[2]>a)return!1;if(t[0]<i&&t[2]>i&&(t[0]=i,n=!0),t[2]>a&&(t[2]=a,n=!0),t[1]<o&&t[3]<o||t[1]>s&&t[3]>s)return!1;t[1]<o&&t[3]>o&&(t[1]=o,n=!0),t[3]>s&&(t[3]=s,n=!0)}return n}return!0}function getCellPosition(e,t,r,n,i,o,a){var s,l={idx:0,size:0},d={idx:0,size:0},p=d.size,h=l.size;for(s=d.idx;s<t[0];s++)r&&r-1<t[0]&&s<r||(p+=getRowHeight(e,s,!0));for(s=l.idx;s<t[1];s++)n&&n-1<t[1]&&s<n||(h+=getColumnWidth(e,s,null,!0));return r&&t[0]<r&&(e.showHeaders&&(p+=30),i&&(p-=i)),n&&t[1]<n&&(e.showHeaders&&(h+=a||30),o&&(h-=o)),{top:p,left:h}}function setPosition(e,t,r,n,i){void 0===n&&(n="e-selection");var o=e.getActiveSheet();if(!o.frozenRows&&!o.frozenColumns){var a=locateElem(t,r,o,e.enableRtl,0,0,i);return t&&!e.getMainContent().querySelector("."+n)&&e.getMainContent().appendChild(t),a}var s,l=e.frozenRowCount(o),d=e.frozenColCount(o);if("e-active-cell"===n){if(r[0]<l||r[1]<d){t.style.display="none";(u=(s=r[0]<l&&r[1]<d?e.getSelectAllContent():r[0]<l?e.getColumnHeaderContent():e.getRowHeaderContent()).querySelector("."+n))||(u=t.cloneNode(!0),s.appendChild(u)),locateElem(t=u,r,o,e.enableRtl,l,d,i,!0,e.viewport.beforeFreezeHeight,e.viewport.beforeFreezeWidth,e.sheetModule.colGroupWidth)}else locateElem(t,r,o,e.enableRtl,l,d,i);t.style.display&&(t.style.display=""),removeRangeEle(e.getSelectAllContent(),s,"e-active-cell"),removeRangeEle(e.getColumnHeaderContent(),s,"e-active-cell"),removeRangeEle(e.getRowHeaderContent(),s,"e-active-cell")}else if("e-autofill"===n){var p=void 0,h=e.frozenRowCount(o),c=e.frozenColCount(o);if(r[0]<h||r[1]<c){t.style.display="none";(u=(p=r[0]<h&&r[1]<c?e.getSelectAllContent():r[0]<h?e.getColumnHeaderContent():e.getRowHeaderContent()).querySelector("."+n))||(u=t.cloneNode(!0),p.appendChild(u)),locateElem(t=u,r,o,e.enableRtl,h,c,i,!0,e.viewport.beforeFreezeHeight,e.viewport.beforeFreezeWidth,e.sheetModule.colGroupWidth,"e-autofill")}else locateElem(t,r,o,e.enableRtl,h,c,i,!1,0,0,0,"e-autofill");t.style.display&&(t.style.display=""),removeRangeEle(e.getSelectAllContent(),p,"e-autofill"),removeRangeEle(e.getColumnHeaderContent(),p,"e-autofill"),removeRangeEle(e.getRowHeaderContent(),p,"e-autofill")}else if("e-filloption"===n){p=void 0,h=e.frozenRowCount(o),c=e.frozenColCount(o);if(r[0]<h||r[1]<c)if(r[3]+1===c&&r[2]+1>h)locateElem(e.getMainContent().querySelector(".e-filloption"),r,o,e.enableRtl,h,c,i,!1,0,0,0,"e-filloption",!0,{left:-4});else if(r[2]+1===h&&r[3]+1>c)locateElem(e.getMainContent().querySelector(".e-filloption"),r,o,e.enableRtl,h,c,i,!1,0,0,0,"e-filloption",!0,{top:-4});else if(r[3]+1===c&&r[2]+1<h){(p=e.getColumnHeaderContent()).querySelector("."+n)||e.notify(getautofillDDB,{id:e.element.id+"_autofilloptionbtn",appendElem:p}),locateElem(t=e.autofillModule.autoFillDropDown.element,r,o,e.enableRtl,h,c,i,!1,0,0,0,"e-filloption",!0,{left:-4})}else if(r[2]+1===h&&r[3]+1===c)locateElem(e.getMainContent().querySelector(".e-filloption"),r,o,e.enableRtl,h,c,i,!1,0,0,0,"e-filloption",!0,{top:-4,left:-4});else{var u;(u=(p=r[0]<h&&r[1]<c?e.getSelectAllContent():r[0]<h?e.getColumnHeaderContent():e.getRowHeaderContent()).querySelector("."+n))||e.notify(getautofillDDB,{id:e.element.id+"_autofilloptionbtn",appendElem:p}),locateElem(t=e.autofillModule.autoFillDropDown.element,r,o,e.enableRtl,h,c,i,!0,e.viewport.beforeFreezeHeight,e.viewport.beforeFreezeWidth,e.sheetModule.colGroupWidth,"e-filloption",!0)}else locateElem(e.getMainContent().querySelector(".e-filloption"),r,o,e.enableRtl,h,c,i,!1,0,0,0,"e-filloption",!0);t.style.display&&(t.style.display=""),removeRangeEle(e.getSelectAllContent(),p,"e-filloption"),removeRangeEle(e.getColumnHeaderContent(),p,"e-filloption"),removeRangeEle(e.getRowHeaderContent(),p,"e-filloption")}else{var g=getSwapRange(r);if(g[0]<l||g[1]<d){t.classList.add("e-hide");var f=[];g[0]<l&&g[1]<d?g[2]<l&&g[3]<d?(f.push(r),removeRangeEle(e.getColumnHeaderContent(),s,"e-selection"),removeRangeEle(e.getRowHeaderContent(),s,"e-selection")):g[2]>l-1?g[3]<d?(removeRangeEle(e.getColumnHeaderContent(),s,"e-selection"),f.push([g[0],g[1],l-1,g[3]]),f.push([l,g[1],g[2],g[3]])):(f.push([g[0],g[1],l-1,d-1]),f.push([l,g[1],g[2],d-1]),f.push([g[0],d,l-1,g[3]]),f.push([l,d,g[2],g[3]])):g[2]<l?(f.push([g[0],g[1],g[2],d-1]),f.push([g[0],d,g[2],g[3]]),removeRangeEle(e.getRowHeaderContent(),s,"e-selection")):(f.push([l,g[1],g[2],d-1]),f.push([g[0],g[1],l-1,d-1]),f.push([l,d,g[2],g[3]]),f.push([g[0],d,l-1,g[3]])):g[0]<l?g[2]<l?f.push(r):(f.push([g[0],g[1],l-1,g[3]]),f.push([l,g[1],g[2],g[3]]),removeRangeEle(e.getSelectAllContent(),s,"e-selection"),removeRangeEle(e.getRowHeaderContent(),s,"e-selection")):g[3]<d?f.push(r):(f.push([g[0],g[1],g[2],d-1]),f.push([g[0],d,g[2],g[3]]),removeRangeEle(e.getSelectAllContent(),s,"e-selection"),removeRangeEle(e.getColumnHeaderContent(),s,"e-selection"));var m;f.forEach(function(r){s=r[2]<l&&r[3]<d?e.getSelectAllContent():r[2]<l?e.getColumnHeaderContent():r[3]<d?e.getRowHeaderContent():e.getMainContent();var a;"e-copy-indicator"===n||"e-range-indicator"===n?(a=t.cloneNode(!0),s.appendChild(a),l&&(r[2]+1===l&&f.forEach(function(e){e!==r&&(m=a.getElementsByClassName("e-bottom")[0])&&e[0]===l&&ej2Base.detach(m)}),r[0]===l&&s.parentElement.classList.contains("e-main-panel")&&f.forEach(function(e){e!==r&&(m=a.getElementsByClassName("e-top")[0])&&e[2]+1===l&&ej2Base.detach(m)})),d&&(r[3]+1===d&&f.forEach(function(e){e!==r&&(m=a.getElementsByClassName("e-right")[0])&&e[1]===d&&ej2Base.detach(m)}),r[1]===d&&(s.classList.contains("e-sheet-content")||s.classList.contains("e-column-header"))&&f.forEach(function(e){e!==r&&(m=a.getElementsByClassName("e-left")[0])&&e[3]+1===d&&ej2Base.detach(m)}))):(a=s.querySelector("."+n))||(a=t.cloneNode(!0),s.appendChild(a)),locateElem(a,r,o,e.enableRtl,l,d,i,!1,e.viewport.beforeFreezeHeight,e.viewport.beforeFreezeWidth,e.sheetModule.colGroupWidth),a.classList.contains("e-hide")&&a.classList.remove("e-hide")})}else removeRangeEle(e.getSelectAllContent(),null,"e-selection"),removeRangeEle(e.getColumnHeaderContent(),null,"e-selection"),removeRangeEle(e.getRowHeaderContent(),null,"e-selection"),locateElem(t,r,o,e.enableRtl,l,d,i),"e-range-indicator"!==n&&e.getMainContent().querySelector("."+n)||e.getMainContent().appendChild(t)}}function removeRangeEle(e,t,r){var n;"e-active-cell"===r?e!==t&&(n=e.querySelector(".e-active-cell"))&&ej2Base.detach(n):"e-autofill"===r?e!==t&&(n=e.querySelector(".e-autofill"))&&ej2Base.detach(n):"e-filloption"===r?e!==t&&(n=e.querySelector(".e-filloption"))&&ej2Base.detach(n):(n=e.querySelector(".e-selection"))&&ej2Base.detach(n)}function locateElem(e,t,r,n,i,o,a,s,l,d,p,h,c,u){var g=getSwapRange(t),f=getCellPosition(r,g,i,o,l,d,p),m=[skipHiddenIdx(r,0,!0),skipHiddenIdx(r,0,!0,"columns")],v=getRowsHeight(r,t[0],t[2],!0),C=getColumnsWidth(r,t[1],t[3],!0),y=0===t[1]&&t[3]===r.colCount-1,x=0===t[0]&&t[2]===r.rowCount-1,b=0,S=-5,w=-5,I=0,R=6,E=6;if(ej2Base.isNullOrUndefined(h)){if((k={top:(g[0]===m[0]?f.top:f.top-getDPRValue(1))+"px",height:v&&v+(g[0]===m[0]?0:getDPRValue(1))+"px",width:C&&C+(g[1]===m[1]?0:getDPRValue(1))+(s&&o&&g[1]<o&&g[3]>=o?1:0)+"px"})[n?"right":"left"]=(g[1]===m[1]?f.left:f.left-1)+"px",e){return setStyleAttribute$1([{element:e,attrs:k}],a)}}else{y&&(S=-5,w=-2,R=6,E=3),x&&(w=-5,S=0,R=1,E=6),x||(b+=v),y||(I+=C),b+=Math.round(f.top)+S,I+=Math.round(f.left)+w;var k={};c?(ej2Base.removeClass([e],"e-hide"),k={top:(b=u&&u.top?u.top:b)+R+"px",left:(I=u&&u.left?u.left:I)+E+"px"},e&&setStyleAttribute$1([{element:e,attrs:k}],a)):((k={top:b+"px"})[n?"right":"left"]=I+"px",e&&setStyleAttribute$1([{element:e,attrs:k}],a))}}function setStyleAttribute$1(e,t){return new Promise(function(r){var n=function(){e.forEach(function(e){ej2Base.setStyleAttribute(e.element,e.attrs),r()})};t?n():requestAnimationFrame(function(){return n()})})}function getStartEvent(){return ej2Base.Browser.isPointer?"pointerdown":"mousedown touchstart"}function getMoveEvent(){return ej2Base.Browser.isPointer?"pointermove":"mousemove touchmove"}function getEndEvent(){return ej2Base.Browser.isPointer?"pointerup":"mouseup touchend"}function isTouchStart(e){return"touchstart"===e.type||"pointerdown"===e.type&&"touch"===e.pointerType}function isTouchMove(e){return"touchmove"===e.type||"pointermove"===e.type&&"touch"===e.pointerType}function isTouchEnd(e){return"touchend"===e.type||"pointerup"===e.type&&"touch"===e.pointerType}function isMouseDown(e){return e&&("mousedown"===e.type||"pointerdown"===e.type)}function isMouseMove(e){return e&&("mousemove"===e.type||"pointermove"===e.type)}function isMouseUp(e){return e&&("mouseup"===e.type||"pointerup"===e.type)}function getClientX(e){return e.changedTouches?e.changedTouches[0].clientX:e.clientX}function getClientY(e){return e.changedTouches?e.changedTouches[0].clientY:e.clientY}function getDPRValue(e,t){if(window.devicePixelRatio%1>0){var r=e*window.devicePixelRatio%1;return e+(r?(r>.5||t?1-r:-1*r)/window.devicePixelRatio:0)}return e}function setAriaOptions(e,t){Object.keys(t).forEach(function(r){e&&e.setAttribute(config[r],t[r])})}function destroyComponent(e,t){if(e){var r=ej2Base.getComponent(e,t);r&&r.destroy()}}function setResize(e,t,r,n,i){var o,a,s,l,d,p,h,c,u,g=i.getActiveSheet(),f=i.frozenRowCount(g),m=i.frozenColCount(g);if(n){var v=e<m?i.getSelectAllContent():i.getColumnHeaderContent();o=v.getElementsByTagName("th")[t],a=v.getElementsByTagName("col")[t],s=(e<m?i.getRowHeaderContent():i.getMainContent()).getElementsByTagName("col")[t]}else{o=a=f||m?i.getRow(e,null,m-1):i.getRow(e,i.getRowHeaderTable()),a.style.height=parseInt(r,10)>0?getDPRValue(parseInt(r,10))+"px":"2px",(s=i.getRow(e,null,m)).style.height=parseInt(r,10)>0?getDPRValue(parseInt(r,10))+"px":"0px";var C=void 0;if(g.showHeaders){var y=i.getRowHeaderContent().getElementsByClassName("e-row"),x=[];x[0]=y[t].getElementsByTagName("td")[0].cloneNode(!0),C=findMaxValue(i.getRowHeaderTable(),x,!1,i)+1}for(var b=i.getMainContent().getElementsByClassName("e-row"),S=[],w=0;w<b[t].getElementsByTagName("td").length;w++)S[w]=b[t].getElementsByTagName("td")[w].cloneNode(!0);var I=findMaxValue(i.getContentTable(),S,!1,i)+1,R=C>=I?C:I;parseInt(s.style.height,10)<R||o&&o.classList.contains("e-reach-fntsize")&&parseInt(s.style.height,10)===R?(g.showHeaders&&(o.classList.add("e-reach-fntsize"),a.style.lineHeight=parseInt(r,10)>=4?parseInt(r,10)-4+"px":parseInt(r,10)>0?parseInt(r,10)-1+"px":"0px"),s.style.lineHeight=parseInt(r,10)>0?parseInt(r,10)-1+"px":"0px"):(a&&a.style.removeProperty("line-height"),s.style.removeProperty("line-height"),o&&o.classList.contains("e-reach-fntsize")&&o.classList.remove("e-reach-fntsize"))}if(p=s.previousElementSibling,u=s.nextElementSibling,p&&(g.showHeaders&&(l=o.previousElementSibling,d=a.previousElementSibling),p=s.previousElementSibling),u&&(g.showHeaders&&(h=o.nextElementSibling,c=a.nextElementSibling),u=s.nextElementSibling),parseInt(r,10)<=0&&!s.classList.contains("e-zero")&&!s.classList.contains("e-zero-start")){if(p&&u)if(n?(g.showHeaders&&(a.style.width="2px"),s.style.width="0px"):(g.showHeaders&&(a.style.height="2px"),s.style.height="0px"),p.classList.contains("e-zero-start")?(g.showHeaders&&o.classList.add("e-zero-start"),s.classList.add("e-zero-start")):(g.showHeaders&&o.classList.add("e-zero"),s.classList.add("e-zero")),!h||h.classList.contains("e-zero")||h.classList.contains("e-zero-last")||(g.showHeaders&&o.classList.add("e-zero-last"),s.classList.add("e-zero-last")),p.classList.contains("e-zero-last")&&(g.showHeaders&&l.classList.remove("e-zero-last"),p.classList.remove("e-zero-last")),g.showHeaders&&l.classList.contains("e-zero")?(o.classList.contains("e-zero-end"),setWidthAndHeight(d,-2,n)):g.showHeaders&&setWidthAndHeight(d,-1,n),g.showHeaders&&l.classList.contains("e-zero-start")&&setWidthAndHeight(a,-1,n),g.showHeaders&&h.classList.contains("e-zero"))if(o.classList.contains("e-zero-start"))for(;h;){if(h.classList.contains("e-zero")&&0!==parseInt(c.style.height,10)&&!n||0!==parseInt(c.style.width,10)&&n){n?(a.style.width=parseInt(a.style.width,10)-1+"px",c.style.width=parseInt(c.style.width,10)-1+"px"):(a.style.height=parseInt(a.style.height,10)-1+"px",c.style.height=parseInt(c.style.height,10)-1+"px"),h.classList.remove("e-zero"),h.classList.add("e-zero-start");break}var E=void 0;h.classList.remove("e-zero"),h.classList.add("e-zero-start"),n?(E=parseInt(h.getAttribute("aria-colindex"),10)-1,h=i.getColHeaderTable().getElementsByTagName("th")[E+1],c=i.getColHeaderTable().getElementsByTagName("col")[E+1]):(E=parseInt(h.getAttribute("aria-rowindex"),10)-1,h=i.getRowHeaderTable().getElementsByTagName("tr")[E+1],c=i.getRowHeaderTable().getElementsByTagName("tr")[E+1])}else setWidthAndHeight(a,-2,n);else g.showHeaders&&(h.classList.contains("e-zero-end")?n?a.style.width="0px":a.style.height="0px":setWidthAndHeight(c,-1,n));else if(p)n?(g.showHeaders&&(a.style.width="1px"),s.style.width="0px"):(g.showHeaders&&(a.style.height="1px"),s.style.height="0px"),g.showHeaders&&o.classList.add("e-zero-end"),s.classList.add("e-zero-end"),g.showHeaders&&o.classList.add("e-zero-last"),s.classList.add("e-zero-last"),g.showHeaders&&l.classList.contains("e-zero")?setWidthAndHeight(d,-2,n):setWidthAndHeight(d,-1,n);else if(h)if(o.classList.add("e-zero-start"),s.classList.add("e-zero-start"),h.classList.contains("e-zero")||(o.classList.add("e-zero-last"),s.classList.add("e-zero-last")),n?(a.style.width="1px",s.style.width="0px"):(a.style.height="1px",s.style.height="0px"),g.showHeaders&&h.classList.contains("e-zero"))for(;h;){if(h.classList.contains("e-zero")&&0!==parseInt(c.style.width,10)&&n||0!==parseInt(c.style.height,10)&&!n){n?(c.style.width=parseInt(c.style.width,10)-1+"px",a.style.width=parseInt(a.style.width,10)-1+"px"):(c.style.height=parseInt(c.style.height,10)-1+"px",a.style.height=parseInt(a.style.height,10)-1+"px"),h.classList.add("e-zero-start"),h.classList.remove("e-zero");break}E=void 0;h.classList.add("e-zero-start"),h.classList.remove("e-zero"),n?(E=parseInt(h.getAttribute("aria-colindex"),10)-1,c=i.getColHeaderTable().getElementsByTagName("col")[E+1],h=i.getColHeaderTable().getElementsByTagName("th")[E+1]):(E=parseInt(h.getAttribute("aria-rowindex"),10)-1,c=i.getRowHeaderTable().getElementsByTagName("tr")[E+1],h=i.getRowHeaderTable().getElementsByTagName("tr")[E+1])}else g.showHeaders&&setWidthAndHeight(c,-1,n)}else if(parseInt(r,10)>0){var k=getDPRValue(parseInt(r,10))+"px";n?(a.style.width=k,s.style.width=k):(a.style.height=k,s.style.height=k),g.showHeaders&&l&&h?(l.classList.contains("e-zero")?o.classList.contains("e-zero")?n?(d.style.width=parseInt(d.style.width,10)+2+"px",a.style.width=parseInt(a.style.width,10)-1+"px"):(d.style.height=parseInt(d.style.height,10)+2+"px",a.style.height=parseInt(a.style.height,10)-1+"px"):setWidthAndHeight(a,-1,n):o.classList.contains("e-zero")?setWidthAndHeight(d,1,n):o.classList.contains("e-zero-start")&&(n?(d.style.width=parseInt(d.style.width,10)+1+"px",a.style.width=parseInt(a.style.width,10)-1+"px"):(d.style.height=parseInt(d.style.height,10)+1+"px",a.style.height=parseInt(a.style.height,10)-1+"px")),h.classList.contains("e-zero")?setWidthAndHeight(a,-1,n):(o.classList.contains("e-zero")||o.classList.contains("e-zero-start"))&&setWidthAndHeight(c,1,n),o.classList.contains("e-zero")&&o.classList.remove("e-zero"),o.classList.contains("e-zero-start")&&o.classList.remove("e-zero-start"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),s.classList.contains("e-zero-start")&&s.classList.remove("e-zero-start"),o.classList.contains("e-zero-last")&&o.classList.remove("e-zero-last"),s.classList.contains("e-zero-last")&&s.classList.remove("e-zero-last"),(l.classList.contains("e-zero")||l.classList.contains("e-zero-start"))&&(l.classList.add("e-zero-last"),p.classList.add("e-zero-last"))):g.showHeaders&&l?(l.classList.contains("e-zero")?o.classList.contains("e-zero")?n?(a.style.width=parseInt(a.style.width,10)-1+"px",d.style.width=parseInt(d.style.width,10)+2+"px"):(a.style.height=parseInt(a.style.height,10)-1+"px",d.style.height=parseInt(d.style.height,10)+2+"px"):setWidthAndHeight(a,-1,n):o.classList.contains("e-zero")?setWidthAndHeight(d,1,n):setWidthAndHeight(a,-1,n),o.classList.contains("e-zero")&&o.classList.remove("e-zero"),o.classList.contains("e-zero-end")&&o.classList.remove("e-zero-end"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),s.classList.contains("e-zero-end")&&s.classList.remove("e-zero-end")):g.showHeaders&&h&&(h.classList.contains("e-zero")?setWidthAndHeight(a,-1,n):o.classList.contains("e-zero-start")&&(setWidthAndHeight(c,1,n),o.classList.remove("e-zero-start")),o.classList.contains("e-zero")&&o.classList.remove("e-zero"),s.classList.contains("e-zero")&&s.classList.remove("e-zero"),o.classList.contains("e-zero-start")&&o.classList.remove("e-zero-start"),s.classList.contains("e-zero-start")&&s.classList.remove("e-zero-start"))}}function setWidthAndHeight(e,t,r){r?e.style.width=parseInt(e.style.width,10)+t+"px":e.style.height=parseInt(e.style.height,10)+t+"px"}function setTextLineHeight(e){textLineHeight=e}function findMaxValue(e,t,r,n,i,o){var a=n.createElement("div",{className:n.element.className,styles:"display: block"}),s=n.createElement("table",{className:e.className+"e-resizetable",styles:"width: auto;height: auto"}),l=n.createElement("tr");r?t.forEach(function(e){var t=l.cloneNode();t.appendChild(e),s.appendChild(t)}):(t.forEach(function(e){l.appendChild(e.cloneNode(!0))}),s.appendChild(l)),a.appendChild(s),document.body.appendChild(a);var d,p,h=s.getBoundingClientRect().width,c=s.getBoundingClientRect().height;return o?(d=r&&parseInt(i,10)>h?h:parseInt(i,10),p=!r&&parseInt(i,10)>c?c:parseInt(i,10)):(p=c,d=h),document.body.removeChild(a),r?Math.ceil(d):Math.ceil(p)}function updateAction(e,t,r,n,i){var o,a,s,l,d,p,h,c=e.eventArgs;switch(e.action){case"sorting":s={args:{range:e.eventArgs.range,sortOptions:e.eventArgs.sortOptions,cancel:!1},promise:new Promise(function(e,t){e(void 0)})},t.notify(initiateSort,s),s.promise.then(function(e){t.serviceLocator.getService("cell").refreshRange(getIndexesFromAddress(e.range))});break;case"cellSave":var u={element:(l=e.eventArgs).element,value:l.value,oldValue:l.oldValue,address:l.address,displayText:l.displayText,formula:l.formula,originalEvent:l.originalEvent};i&&(i.eventArgs=u,t.notify(beginAction,i)),d=u.formula?r?{value:u.formula}:{formula:u.formula}:{value:u.value},t.updateCell(d,u.address),i&&t.trigger("cellSave",i.eventArgs);break;case"cellDelete":var g=getAddressInfo(t,e.eventArgs.address);clearRange(t,g.indices,g.sheetIndex);break;case"format":if("CellFormat"===c.requestType){if(c.style&&c.style.border&&!ej2Base.isNullOrUndefined(c.borderType)){var f={};Object.assign(f,c.style,null,!0),c.style.border=void 0,t.notify(setCellFormat,{style:c.style,refreshRibbon:!0,range:getRangeIndexes(c.range),onActionUpdate:!0}),c.style.border=f.border,t.setBorder(c.style,c.range,c.borderType),c.style=f}else t.notify(setCellFormat,{style:c.style,refreshRibbon:!0,range:getRangeIndexes(c.range),onActionUpdate:!0});getUpdateUsingRaf(function(){return t.selectRange(t.getActiveSheet().selectedRange)})}else t.numberFormat(c.format,c.range);break;case"clipboard":if(c.copiedInfo.isCut&&!r)return;(c.copiedInfo.isCut?t.cut(c.copiedRange):t.copy(c.copiedRange)).then(function(){return t.paste(c.pastedRange,c.type)});break;case"gridLines":t.setSheetPropertyOnMute(t.sheets[c.sheetIdx],"showGridLines",c.isShow);break;case"headers":t.setSheetPropertyOnMute(t.sheets[c.sheetIdx],"showHeaders",c.isShow);break;case"resize":case"resizeToFit":c.isCol?void 0===c.hide?t.setColWidth(c.width,c.index,c.sheetIdx):t.hideColumn(c.index,c.index,c.hide):void 0===c.hide?t.setRowHeight(c.height,c.index,c.sheetIdx+1):t.hideRow(c.index,c.index,c.hide);break;case"renameSheet":t.setSheetPropertyOnMute(t.sheets[c.index-1],"name",c.value);break;case"removeSheet":t.notify(removeSheetTab,{index:c.index,isAction:!0,count:c.sheetCount,clicked:!0});break;case"wrap":wrap(e.eventArgs.address,e.eventArgs.wrap,t);break;case"hideShow":c.isCol?t.hideColumn(c.startIndex,c.endIndex,c.hide):t.hideRow(c.startIndex,c.endIndex,c.hide);break;case"replace":t.updateCell({value:c.replaceValue},c.address);break;case"filter":!1===r?t.notify(initiateFilterUI,{predicates:c.previousPredicates,range:c.range,sIdx:c.index,isUndoRedo:!0}):t.notify(initiateFilterUI,{predicates:c.predicates,range:c.range,sIdx:c.index,isUndoRedo:!0});break;case"insert":if("Sheet"===e.eventArgs.modelType)h=t;else if(!(h=getSheet(t,e.eventArgs.activeSheetIndex)))break;!1===r?t.notify(deleteModel,{model:h,start:e.eventArgs.index,end:e.eventArgs.index+(e.eventArgs.model.length-1),modelType:e.eventArgs.modelType,isUndoRedo:!0}):t.notify(insertModel,{model:h,start:e.eventArgs.index,end:e.eventArgs.index+(e.eventArgs.model.length-1),modelType:e.eventArgs.modelType,isAction:!1,checkCount:e.eventArgs.sheetCount,activeSheetIndex:e.eventArgs.activeSheetIndex,isUndoRedo:!0});break;case"delete":if("Sheet"===e.eventArgs.modelType)h=t;else if(!(h=getSheet(t,e.eventArgs.activeSheetIndex)))break;!1===r?t.notify(insertModel,{model:h,start:e.eventArgs.deletedModel,modelType:e.eventArgs.modelType,isAction:!1,columnCellsModel:e.eventArgs.deletedCellsModel,definedNames:e.eventArgs.definedNames,activeSheetIndex:e.eventArgs.activeSheetIndex,isUndoRedo:!0}):t.notify(deleteModel,{model:h,start:e.eventArgs.startIndex,checkCount:e.eventArgs.sheetCount,end:e.eventArgs.endIndex,modelType:e.eventArgs.modelType,isUndoRedo:!0});break;case"validation":if(r){var m={type:c.type,operator:c.operator,value1:c.value1,value2:c.value2,ignoreBlank:c.ignoreBlank,inCellDropDown:c.inCellDropDown};t.notify(cellValidation,{rules:m,range:c.range})}else t.notify(cellValidation,{range:c.range,isRemoveValidation:!0});break;case"removeHighlight":r?t.removeInvalidHighlight(c.range):t.addInvalidHighlight(c.range);break;case"addHighlight":r?t.addInvalidHighlight(c.range):t.removeInvalidHighlight(c.range);break;case"merge":e.eventArgs.isAction=!1,p=[];for(var v=0,C=c.model.length;v<C;v++){p.push({cells:[]});for(var y=0,x=c.model[v].cells.length;y<x;y++)p[v].cells[y]={},Object.assign(p[v].cells[y],c.model[v].cells[y])}t.notify(setMerge,e.eventArgs),c.model=p;break;case"clear":t.notify(clearViewer,{options:e.eventArgs,isPublic:!0});break;case"conditionalFormat":if(r){var b={type:c.type,cFColor:c.cFColor,value:c.value,range:c.range};t.notify(setCFRule,{conditionalFormat:b,sheetIdx:c.sheetIdx,isUndoRedo:!0})}else{t.notify(clearCFRule,{range:c.range,sheetIdx:c.sheetIdx,isUndoRedo:!0});for(var S=0;S<n.length;S++)if("conditionalFormat"===n[S].action){b={type:n[S].eventArgs.type,cFColor:n[S].eventArgs.cFColor,value:n[S].eventArgs.value,range:n[S].eventArgs.range};t.notify(cFUndo,{conditionalFormat:b,sheetIdx:n[S].eventArgs.sheetIdx})}}break;case"clearCF":r?t.notify(clearCFRule,{range:c.selectedRange,sheetIdx:c.sheetIdx,isClearCF:!0,isUndoRedo:!0}):t.notify(clearCells,{conditionalFormats:c.cFormats,oldRange:c.oldRange,selectedRange:c.selectedRange});break;case"insertImage":r?t.notify(createImageElement,{options:{src:e.eventArgs.imageData,height:e.eventArgs.imageHeight,width:e.eventArgs.imageWidth,imageId:e.eventArgs.id},range:e.eventArgs.range,isPublic:!1,isUndoRedo:!0}):t.notify(deleteImage,{id:e.eventArgs.id,sheetIdx:e.eventArgs.sheetIndex+1,range:e.eventArgs.range});break;case"imageRefresh":a=document.getElementById(e.eventArgs.id),r?(e.eventArgs.isUndoRedo=!0,t.notify(refreshImgCellObj,e.eventArgs)):t.notify(refreshImgCellObj,{prevTop:e.eventArgs.currentTop,prevLeft:e.eventArgs.currentLeft,currentTop:e.eventArgs.prevTop,currentLeft:e.eventArgs.prevLeft,id:e.eventArgs.id,currentHeight:e.eventArgs.prevHeight,currentWidth:e.eventArgs.prevWidth,requestType:"imageRefresh",prevHeight:e.eventArgs.currentHeight,prevWidth:e.eventArgs.currentWidth,isUndoRedo:!0}),a.style.height=r?e.eventArgs.currentHeight+"px":e.eventArgs.prevHeight+"px",a.style.width=r?e.eventArgs.currentWidth+"px":e.eventArgs.prevWidth+"px",a.style.top=r?e.eventArgs.currentTop+"px":e.eventArgs.prevTop+"px",a.style.left=r?e.eventArgs.currentLeft+"px":e.eventArgs.prevLeft+"px";break;case"insertChart":if(r){var w=[{type:c.type,theme:c.theme,isSeriesInRows:c.isSeriesInRows,range:c.range,id:c.id,height:c.height,width:c.width}];t.notify(setChart,{chart:w,isInitCell:c.isInitCell,isUndoRedo:!1,range:c.posRange})}else t.notify(deleteChart,{id:c.id,isUndoRedo:!0});break;case"deleteChart":if(r)t.notify(deleteChart,{id:c.id});else{var I=[{type:c.type,theme:c.theme,isSeriesInRows:c.isSeriesInRows,range:c.range,id:c.id,height:c.height,width:c.width,top:c.top,left:c.left}];t.notify(setChart,{chart:I,isInitCell:c.isInitCell,isUndoRedo:!1,range:c.posRange})}break;case"chartRefresh":(o=document.getElementById(e.eventArgs.id))&&(o.style.height=r?e.eventArgs.currentHeight+"px":e.eventArgs.prevHeight+"px",o.style.width=r?e.eventArgs.currentWidth+"px":e.eventArgs.prevWidth+"px",o.style.top=r?e.eventArgs.currentTop+"px":e.eventArgs.prevTop+"px",o.style.left=r?e.eventArgs.currentLeft+"px":e.eventArgs.prevLeft+"px"),r?(e.eventArgs.isUndoRedo=!0,t.notify(refreshChartSize,{height:o.style.height,width:o.style.width,overlayEle:o})):t.notify(refreshChartSize,{height:o.style.height,width:o.style.width,overlayEle:o});break;case"autofill":r&&t.notify(setAutoFill,{fillRange:e.eventArgs.fillRange,dataRange:e.eventArgs.dataRange,fillType:e.eventArgs.fillType,direction:e.eventArgs.direction});break;case"removeValidation":r&&t.notify(cellValidation,{range:c.range,isRemoveValidation:!0});break;case"addDefinedName":if(!1===r)t.notify(workbookFormulaOperation,{action:"removeDefinedName",isRemoved:!1,definedName:c.name,scope:c.scope,isEventTrigger:!0});else{var R={name:c.name,refersTo:c.refersTo,scope:c.scope,comment:c.comment};t.notify(workbookFormulaOperation,{action:"addDefinedName",isAdded:!1,definedName:R,isEventTrigger:!0})}}}function hasTemplate(e,t,r,n){for(var i,o=e.sheets[n].ranges,a=0,s=o.length;a<s;a++)if(o[a].template&&(i=getRangeIndexes(o[a].address.length?o[a].address:o[a].startCell))[0]<=t&&i[1]<=r&&i[2]>=t&&i[3]>=r)return!0;return!1}function setRowEleHeight(e,t,r,n,i,o,a){void 0===a&&(a=!0);var s=getRowHeight(t,n,!0),l=e.frozenColCount(t),d=getDPRValue(r);(i=i||(t.frozenRows?e.getRow(n,null,l):e.getRow(n)))&&(i.style.height=d+"px"),(o=t.frozenColumns?e.getRow(n,null,l-1):o||e.getRow(n,e.getRowHeaderTable()))&&(o.style.height=d+"px"),setRowHeight(t,n,r),e.setProperties({sheets:e.sheets},!0),a&&e.notify(rowHeightChanged,{rowIdx:n,threshold:d-s})}function getTextHeight(e,t,r,n){void 0===r&&(r=1);var i=t&&t.fontSize||e.cellStyle.fontSize,o=(i.indexOf("pt")>-1?parseInt(i,10)/.75:parseInt(i,10))*(n||getLineHeight(t&&t.fontFamily?t:e.cellStyle))*r;return Math.ceil(o%1>.9?o+1:o)}function getLineHeight(e){var t=textLineHeight;return e&&("Arial Black"===e.fontFamily?t=1.44:'"Segoe UI", sans-serif'===e.fontFamily&&(t=1.36)),t}function getTextWidth(e,t,r,n){t||(t=r);var i=document.createElement("canvas").getContext("2d");return i.font=(t.fontStyle||r.fontStyle)+" "+(t.fontWeight||r.fontWeight)+" "+(t.fontSize||r.fontSize)+" "+(t.fontFamily||r.fontFamily),n?i.measureText(e).width:getDPRValue(i.measureText(e).width,!0)}function getLines(e,t,r,n){var i,o,a,s,l,d=0,p=e.toString().split(" "),h=getTextWidth(" ",r,n),c=0,u=0,g=0,f=function(e,o){d&&c++,i/t>=1&&(e.split("").forEach(function(e){s=getTextWidth(e,r,n,!0),(a+=s)>t&&(c++,a=s)}),i=getDPRValue(a,!0)),o||m(i),d=i},m=function(e){i+=(e+h)/t>=1?0:h};return p.forEach(function(e){a=0,s=0,i=getTextWidth(e,r,n),(d+i)/t>1?(o=e.split("-")).length>1?o.forEach(function(h){a=0,s=0,l||(l=getTextWidth("-",r,n)),i=getTextWidth(h,r,n),o[o.length-1]!==h&&(i+=l),(d+i)/t>=1?f(h,o[o.length-1]!==h):(o[o.length-1]===h&&p[p.length-1]!==e&&m(d+i),d+=i)}):f(e,!1):(m(d+i),d+=i)}),d&&(u=(d-h)/t,g=parseFloat(u.toString().split(".")[0]),c+=u+.05>=g+1?Math.ceil(u)+1:Math.ceil(u)),c}function getBorderWidth(e,t,r){var n=0,i=getCell(e,t,r,null,!0),o=getCell(e,t+1,r,null,!0);return i.style&&(i.style.border?n=(0===t?2:1)*parseFloat(i.style.border.split("px")[0]):(0===t&&i.style.borderLeft&&(n=parseFloat(i.style.borderLeft.split("px")[0])),i.style.borderRight&&(n+=parseFloat(i.style.borderRight.split("px")[0])))),i.style&&(i.style.border||i.style.borderRight)||!o.style||!o.style.borderLeft||(n+=parseFloat(o.style.borderLeft.split("px")[0])),n>0&&n<1?1:n}function getBorderHeight(e,t,r){var n=0,i=getCell(e,t,r,null,!0);i.style&&(i.style.border?n=(0===e?2:1)*parseFloat(i.style.border.split("px")[0]):(0===e&&i.style.borderTop&&(n=parseFloat(i.style.borderTop.split("px")[0])),i.style.borderBottom&&(n+=parseFloat(i.style.borderBottom.split("px")[0]))));var o=getCell(e+1,t,r,null,!0);return i.style&&(i.style.border||i.style.borderBottom)||!o.style||!o.style.borderTop||(n+=parseFloat(o.style.borderTop.split("px")[0])),Math.ceil(n)||1}function getExcludedColumnWidth(e,t,r,n){return void 0===n&&(n=r),getColumnsWidth(e,r,n,!0)-getDPRValue(4+(getBorderWidth(t,r,e)||1))}function getTextHeightWithBorder(e,t,r,n,i,o,a){return getTextHeight(e,i,o,a)+getBorderHeight(t,r,n)}function setMaxHgt(e,t,r,n){e.maxHgts[t]||(e.maxHgts[t]={}),e.maxHgts[t][r]=n}function getMaxHgt(e,t){var r=0,n=e.maxHgts[t];return n&&Object.keys(n).forEach(function(e){n[e]>r&&(r=n[e])}),r}function skipHiddenIdx(e,t,r,n){return void 0===n&&(n="rows"),t<0&&(t=-1),e[n][t]&&e[n][t].hidden&&(r?t++:t--,t=skipHiddenIdx(e,t,r,n)),t}function focus(e){if(!document.activeElement.classList.contains("e-text-findNext-short"))if(ej2Base.Browser.isIE){var t=window.scrollX,r=window.scrollY;e.focus(),window.scrollTo(t,r)}else e.focus({preventScroll:!0})}function isLockedCells(e,t){for(var r,n=e.getActiveSheet(),i=ej2Base.isNullOrUndefined(t)?getSwapRange(getRangeIndexes(n.selectedRange)):t,o=i[0];o<=i[2];o++)for(var a=i[1];a<=i[3];a++){if(isLocked(getCell(o,a,n),getColumn(n,a))){r=!0;break}}return r}function isDiscontinuousRange(e){return e.includes(" ")}function clearRange(e,t,r){for(var n,i,o,a,s=getSheet(e,r),l=r===e.activeSheetIndex,d=t[0],p=t[2];d<=p;d++)if(!(getRow(s,d)||{}).isFiltered)for(var h=t[1],c=t[3];h<=c;h++){var u={cellIdx:[d,h],isUnique:!1,uniqueRange:""};if(e.notify(checkUniqueRange,u),n=!1,""!==u.uniqueRange){var g=getIndexesFromAddress(u.uniqueRange);n="#SPILL!"===getCell(g[0],g[1],s).value}if((!u.isUnique||n)&&(i=getCell(d,h,s))){if(o={},i.formula&&(o.formula=""),(i.value||0===i.value)&&(o.value=""),i.hyperlink&&(o.hyperlink=""),!Object.keys(o).length)continue;if(a=e.getCell(d,h),updateCell(e,s,{cell:o,rowIdx:d,colIdx:h,valChange:!0,uiRefresh:l,td:a}))continue;delete i.value,delete i.formula,delete i.hyperlink,a&&(a.querySelector(".e-cf-databar")&&a.removeChild(a.querySelector(".e-cf-databar")),a.querySelector(".e-iconsetspan")&&a.removeChild(a.querySelector(".e-iconsetspan"))),e.notify(checkConditionalFormat,{rowIdx:d,colIdx:h,cell:getCell(d,h,s),isAction:!0})}}}var WorkerHelper=function(){function e(e,t,r,n,i){this.preventCallback=!1,this.context=e,this.workerTask=t,this.defaultListener=r,this.workerData=n,i&&(this.preventCallback=!0),this.initWorker()}return e.prototype.terminate=function(){this.worker.terminate(),URL.revokeObjectURL(this.workerUrl)},e.prototype.initWorker=function(){var e=new Blob([this.getFnCode()],{type:"text/javascript"});this.workerUrl=URL.createObjectURL(e),this.worker=new Worker(this.workerUrl),this.worker.onmessage=this.messageFromWorker.bind(this),this.worker.onerror=this.onError.bind(this),this.worker.postMessage(this.workerData)},e.prototype.messageFromWorker=function(e){this.terminate(),this.defaultListener.apply(this.context,[e.data])},e.prototype.onError=function(e){throw this.terminate(),e.message||e},e.prototype.getFnCode=function(){var e,t,r="",n="",i=!1;if("function"==typeof this.workerTask)this.workerTask.toString().indexOf("function")<0?n="function "+this.workerTask.toString():(n=this.workerTask.toString(),i=!0),r+="self.workerTask = "+n+"; \n";else if("object"==typeof this.workerTask)for(t=Object.keys(this.workerTask),e=0;e<t.length;e++)this.workerTask[t[e]].toString().indexOf("function")<0?n="function "+this.workerTask[t[e]].toString():(n=this.workerTask[t[e]].toString(),i=!0),r+=(0===e?"self.workerTask":t[e])+"= "+n+"; \n";return r+="self.onmessage = "+(i?"":" function ")+(this.preventCallback?this.getMessageFn.toString():this.getCallbackMessageFn.toString())+"; \n"},e.prototype.getCallbackMessageFn=function(e){postMessage(this.workerTask.apply(this,e.data))},e.prototype.getMessageFn=function(e){this.workerTask.apply(this,e.data)},e}(),workbookDestroyed="workbookDestroyed",updateSheetFromDataSource="updateSheetFromDataSource",dataSourceChanged="dataSourceChanged",dataChanged="dataChanged",triggerDataChange="triggerDataChange",workbookOpen="workbookOpen",beginSave="beginSave",sortImport="sortImport",ribbonFind="ribbonFind",exportDialog="exportDialog",getFilteredCollection="getFilteredCollection",saveCompleted="saveCompleted",applyNumberFormatting="applyNumber",getFormattedCellObject="getFormattedCell",refreshCellElement="refreshCellElem",setCellFormat="setCellFormat",findAllValues="findAllValues",textDecorationUpdate="textDecorationUpdate",applyCellFormat="applyCellFormat",updateUsedRange="updateUsedRange",updateRowColCount="updateRowColCount",workbookFormulaOperation="workbookFormulaOperation",workbookEditOperation="workbookEditOperation",checkDateFormat="checkDateFormat",getFormattedBarText="getFormattedBarText",activeCellChanged="activeCellChanged",openSuccess="openSuccess",openFailure="openFailure",sheetCreated="sheetCreated",sheetsDestroyed="sheetsDestroyed",aggregateComputation="aggregateComputation",getUniqueRange="getUniqueRange",removeUniquecol="removeUniquecol",checkUniqueRange="checkUniqueRange",reApplyFormula="reApplyFormula",clearFormulaDependentCells="clearFormulaDependentCells",getFormulaInfoTable="getFormulaInfoTable",formulaInValidation="formulaInValidation",beforeSort="beforeSort",initiateSort="initiateSort",sortComplete="sortComplete",sortRangeAlert="sortRangeAlert",initiatelink="initiatelink",beforeHyperlinkCreate="beforeHyperlinkCreate",afterHyperlinkCreate="afterHyperlinkCreate",beforeHyperlinkClick="beforeHyperlinkClick",afterHyperlinkClick="afterHyperlinkClick",addHyperlink="addHyperlink",setLinkModel="setLinkModel",beforeFilter="beforeFilter",initiateFilter="initiateFilter",filterComplete="filterComplete",filterRangeAlert="filterRangeAlert",clearAllFilter="clearAllFilter",wrapEvent="wrapText",onSave="onSave",insert="insert",deleteAction="delete",insertModel="insertModel",deleteModel="deleteModel",isValidation="isValidation",cellValidation="cellValidation",addHighlight="addHighlight",dataValidate="dataValidate",findNext="findNext",findPrevious="findPrevious",goto="gotoHandler",findWorkbookHandler="findHandler",replaceHandler="replace",replaceAllHandler="replaceAll",showDialog="ShowDialog",findKeyUp="findKeyUp",removeHighlight="removeHighlight",queryCellInfo="queryCellInfo",count="count",findCount="findCount",protectSheetWorkBook="protectSheet",updateToggle="updateToggleItem",protectsheetHandler="protectsheetHandler",replaceAllDialog="replaceAllDialog",unprotectsheetHandler="unprotectsheetHandler",workBookeditAlert="editAlert",setLockCells="setLockCells",applyLockCells="applyLockCells",setMerge="setMerge",applyMerge="applyMerge",mergedRange="mergedRange",activeCellMergedRange="activeCellMergedRange",insertMerge="insertMerge",pasteMerge="pasteMerge",hideShow="hideShow",setCFRule="setCFRule",cFInitialCheck="cFInitialCheck",clearCFRule="clearCFRule",initiateClearCFRule="initiateClearCFRule",cFRender="cFRender",clear="clear",clearCF="clearCF",clearCells="clearCells",setImage="setImage",setChart="setChart",initiateChart="initiateChart",refreshRibbonIcons="refreshRibbonIcons",refreshChart="refreshChart",refreshChartSize="refreshChartSize",updateChart="updateChart",deleteChartColl="deleteChartColl",initiateChartModel="initiateChartModel",focusChartBorder="focusChartBorder",saveError="saveError",validationHighlight="validationHighlight",dataRefresh="dataRefresh",updateFilter="updateFilter",beforeInsert="beforeInsert",beforeDelete="beforeDelete",deleteHyperlink="deleteHyperlink",moveOrDuplicateSheet="moveOrDuplicateSheet",setAutoFill="setAutoFill",refreshCell="refreshCell",getFillInfo="getFillInfo",getautofillDDB="getautofillDDB",rowFillHandler="rowFillHandler",getTextSpace="getTextSpace",updateCustomFormatsFromImport="updateCustomFormatsFromImport",cFUndo="cFUndo",refreshClipboard="refreshClipboard",updateView="updateView",selectionComplete="selectionComplete",refreshInsertDelete="refreshInsertDelete",checkConditionalFormat="checkConditionalFormat",beforeCellUpdate="beforeCellUpdate",WorkbookNumberFormat=function(){function WorkbookNumberFormat(e){this.parent=e,this.localeObj=ej2Base.getNumericObject(this.parent.locale),this.decimalSep=this.localeObj.decimal,this.groupSep=this.localeObj.group,this.addEventListener()}return WorkbookNumberFormat.prototype.numberFormatting=function(e){var t=this.parent.activeSheetIndex;e.range&&e.range.indexOf("!")>-1&&(t=getSheetIndex(this.parent,e.range.split("!")[0]));for(var r,n=this.parent.sheets[t],i=getRangeIndexes(e.range?e.range.indexOf("!")>-1?e.range.split("!")[1]:e.range:n.selectedRange),o=i[0];o<=i[2];o++)for(var a=i[1];a<=i[3];a++)updateCell(this.parent,n,{cell:{format:e.format},rowIdx:o,colIdx:a})||(r=getCell(o,a,n),this.getFormattedCell({type:getTypeFromFormat(r.format),value:r.value,format:r.format,rowIndex:o,colIndex:a,sheetIndex:t,cell:r}))},WorkbookNumberFormat.prototype.getFormattedCell=function(e){var t,r=void 0===e.value||null===e.value?"":e.value,n=void 0===e.sheetIndex?this.parent.activeSheetIndex:e.sheetIndex,i=this.parent.sheets[n];t=void 0===e.rowIndex?getRangeIndexes(i.activeCell):[e.rowIndex,e.colIndex];var o=e.cell?e.cell:getCell(t[0],t[1],i),a=!1,s={},l=new ej2Base.Internationalization;l.getNumberFormat(s);var d=ej2Base.getNumberDependable(this.parent.locale,s.currency);if(""===e.format||"General"===e.format){o=o||{};var p={value:e.value,rowIndex:t[0],colIndex:t[1],sheetIndex:this.parent.activeSheetIndex,updatedVal:e.value,isDate:!1,isTime:!1};this.checkDateFormat(p),p.isDate?(a=!0,o.value=e.value=p.updatedVal,o.format=e.format=getFormatFromType("ShortDate")):p.isTime&&(a=!0,o.value=e.value=p.updatedVal,o.format=e.format=getFormatFromType("Time"))}e.type=e.format?getTypeFromFormat(e.format):"General";var h,c;if(o&&!ej2Base.isNullOrUndefined(o.format)&&this.isCustomType(o)){var u=o.format;o.format=o.format.split("\\").join(""),this.parent.notify(updateCustomFormatsFromImport,{format:o.format}),e.type="Custom",this.currentRange=getCellAddress(t[0],t[1]),o.format.indexOf(";")>-1?(o.format.indexOf("<")>-1||o.format.indexOf(">")>-1?e.value=e.result=this.processCustomConditions(o):(e.value=e.result=this.processCustomAccounting(o,t[0],t[1],e.td),c=!(isNumber(o.value)&&!(o.format&&o.format.indexOf("@")>-1))),o.format=u):this.isCustomDateTime(o)?e.value=e.result=this.processCustomDate(o):o.format.indexOf("/")>-1?e.value=e.result=this.processCustomFraction(o):o.format.indexOf("@")>-1?(c=!0,e.value=e.result=this.processCustomText(o)):isNumber(o.value)&&(e.value=e.result=this.processCustomNumberFormat(o,t[0],t[1],e.td)),e.isRightAlign=!c&&!ej2Base.isNullOrUndefined(o.value)}else h=this.processFormats(e,r,a,o,l,d,s.currency);return e.isRowFill=this.isRowFill,this.parent.getActiveSheet().id-1!==n||e.onLoad||(this.parent.notify(refreshCellElement,{isRightAlign:"Custom"===e.type?e.isRightAlign:h.rightAlign,result:"Custom"===e.type?e.value:h.fResult||e.value,rowIndex:e.rowIndex,colIndex:e.colIndex,sheetIndex:e.sheetIndex,type:e.type,curSymbol:d,value:"Custom"===e.type?e.value:e.value||"",isRowFill:this.isRowFill}),this.isRowFill=!1),!e.onLoad&&(e.rowIndex>i.usedRange.rowIndex||e.colIndex>i.usedRange.colIndex)&&this.parent.setUsedRange(e.rowIndex,e.colIndex),"Custom"===e.type?(e.formattedText=e.value,e.curSymbol=d):(e.formattedText=h.fResult||e.value,e.isRightAlign=h.rightAlign,e.curSymbol=d),e.formattedText},WorkbookNumberFormat.prototype.isCustomType=function(e){var t=getTypeFromFormat(e.format),r=this.parent.serviceLocator.getService("spreadsheetLocale");return!!(t===r.getConstant("General")&&e.format!==r.getConstant("General")||t===r.getConstant("Time")&&this.parent.isEdit)},WorkbookNumberFormat.prototype.processCustomFill=function(e,t,r,n,i){var o,a,s=t.format.indexOf("*"),l=e[s+1],d=e.split(e[s]+l);if(""===d[1]){var p={format:e=e.split(e[s]+l).join(""),value:t.value};o=this.processCustomNumberFormat(p)}else{o=e.split(e[s]+l)[0];p={format:e=d[1],value:t.value};a=this.processCustomNumberFormat(p),0===parseFloat(t.value)&&(a=a.split("0").join(""))}return this.isRowFill=!0,this.parent.notify(rowFillHandler,{cell:t,rowIdx:r,colIdx:n,value:l,formatText:o,secText:a,td:i}),o},WorkbookNumberFormat.prototype.isCustomDateTime=function(e){var t=!1;return["m","d","y","h","s"].forEach(function(r){!(e.format.indexOf(r)>-1)||getColorCode(e.format)||e.format.indexOf("#")>-1||(t=!0)}),t},WorkbookNumberFormat.prototype.processCustomDate=function(e){var t=intToDate(parseFloat(e.value));if(isNaN(Number(t)))return e.value;var r=e.format,n=void 0,i=new ej2Base.Internationalization;if(e.format.indexOf("h")>-1&&(r=r.split("h").join("H"),n="time"),e.format.indexOf("s")>-1&&(n="time"),(e.format.indexOf("AM/PM")>-1||e.format.indexOf("A/P")>-1)&&(r=(r=r.split("H").join("h")).split("A/P").join("AM/PM").split("AM/PM").join("a"),n="time"),e.format.indexOf("d")>-1){n="date";e.format.match(/d/g).length>2&&(r=e.format.split("d").join("E"))}if(e.format.indexOf("m")>-1)if(e.format.indexOf("s")>-1||e.format.indexOf("h")>-1)n="time";else if(n="date",r=r.split("m").join("M"),e.format.indexOf("mmmmm")>-1){var o=this.formatDateTime(e.value,"MMMM","date",i)[0];return r=e.format.split("mmmmm").join("p"),this.formatDateTime(e.value,r,"date",i).split("p").join(o)}return this.formatDateTime(e.value,r,n,i)},WorkbookNumberFormat.prototype.formatDateTime=function(e,t,r,n){return n.formatDate(intToDate(parseFloat(e)),{type:r,format:t})},WorkbookNumberFormat.prototype.processCustomFraction=function(e){return""},WorkbookNumberFormat.prototype.processCustomConditions=function(cell){var result=cell.value;if(isNumber(cell.value)){for(var conditions=cell.format.split(";"),code=void 0,i=0;i<conditions.length;i++){code=conditions[i],getColorCode(code)&&(code=code.split("["+getColorCode(code)+"]").join(""));var cond=code.split("[")[1].split("]")[0];if(eval(cell.value+cond)){cell.format=conditions[i].split("["+cond+"]")[0]+conditions[i].split("["+cond+"]")[1];break}}return result=this.processCustomNumberFormat(cell)}return result},WorkbookNumberFormat.prototype.processCustomAccounting=function(e,t,r,n){var i=e.format.split(";"),o=ej2Base.isNullOrUndefined(e.value)?e.value:e.value.toString().replace(/,/g,""),a=isNumber(o)?parseFloat(o):NaN,s=e.value;if(a>0)e.format=i[0];else if(0===a){if(!ej2Base.isNullOrUndefined(i[2]))return e.format=i[2]+"0",this.processCustomNumberFormat(e,t,r,n).split("0").join("");e.format=i[0]}else{if(!isNumber(a))return e.format=i[3],ej2Base.isNullOrUndefined(i[3])?e.value?e.value.toString():"":this.processCustomText(e);e.format=i[1]}if(a<0){e.value=Math.abs(a).toString();var l=this.processCustomNumberFormat(e,t,r,n);return e.value=s,l}return this.processCustomNumberFormat(e,t,r,n)},WorkbookNumberFormat.prototype.processCustomText=function(e){var t=this.processCustomNumberFormat({format:e.format.split("@").join("0"),value:e.value?e.value.split(e.value).join("0"):""});return t&&t.split("0").join(e.value)},WorkbookNumberFormat.prototype.thousandSeparator=function(e,t){for(;e;)t/=1e3,e--;return t},WorkbookNumberFormat.prototype.getSeparatorCount=function(e){for(var t=0,r=["#","0"],n=0;n<e.format.length;n++)","!==e.format[n]||r.indexOf(e.format[n+1])>-1||t++;return t},WorkbookNumberFormat.prototype.processSeparator=function(e){var t=this.getSeparatorCount(e),r=this.thousandSeparator(t,parseInt(e.value,10));return e.format.indexOf(".")>-1||(r=Math.round(r)),e.value=this.getFormattedNumber(e.format.split(",").join(""),r),e.value=e.value.replace(",",""),0===r&&(e.value=e.value.replace("0","")),e.value},WorkbookNumberFormat.prototype.processDigits=function(e){var t=e.format.split("?").join("0");return e.value=this.getFormattedNumber(t,parseFloat(e.value)),ej2Base.isNullOrUndefined(e.value)||(e.value=e.value.split(".")[0]+"."+e.value.split(".")[1].split("0").join("  ")),e.value},WorkbookNumberFormat.prototype.processSpace=function(e,t){var r={cell:t,char:" ",width:0};this.parent.notify(getTextSpace,r);for(var n,i=r.width,o=0;o<e.length;o++)if("_"===e[o]){r.char=e[o+1],this.parent.notify(getTextSpace,r);var a=r.width;n=Math.round(a/i),e=e.replace(e[o]+e[o+1]," ".repeat(n))}return e},WorkbookNumberFormat.prototype.processCustomNumberFormat=function(e,t,r,n){if(""===e.format)return"";var i,o=0,a=!1;if(o=ej2Base.isNullOrUndefined(e.value)||isNumber(e.value)?e.value:e.value.replace(/,/g,""),e&&isNumber(e.value)){o=parseFloat(o.toString());var s=this.processCustomColor(e);this.getSeparatorCount(e)&&(a=!0,i=this.processSeparator(e)),s.indexOf("?")>-1&&(a=!0,i=this.processDigits(e)),s.indexOf("_")>-1&&(a=!0,s=e.format=this.processSpace(s,e),i=this.getFormattedNumber(s,o)),(e.format.indexOf('"')>-1||e.format.indexOf("\\")>-1)&&(s=this.processText(s)),s&&i&&s.indexOf("?")>-1&&(i=i.replace("?"," ")),s.indexOf("*")>-1&&(a=!0,i=this.processCustomFill(s,e,t,r,n)),"General"===s&&(a=!0,i=o.toString()),a||(i=this.getFormattedNumber(s,o)),null!=s&&s.split(".")[0].indexOf("#")>-1&&o<1&&(i=i.toString().replace(/^0+/,""))}return i},WorkbookNumberFormat.prototype.processText=function(e){var t=e;return t.indexOf('"')>-1?t=t.split('"').join(""):t.indexOf("\\")>-1&&(t=t.split("\\").join("")),t},WorkbookNumberFormat.prototype.processCustomColor=function(e){var t=e.format,r=getColorCode(t);return r?(t=e.format.split("["+r+"]")[0]+e.format.split("["+r+"]")[1],this.currentRange.indexOf("NaN")>-1&&(this.currentRange=void 0),this.parent.notify(setCellFormat,{style:{color:r},range:this.currentRange})):e.style&&["Black","Blue","Cyan","Green","Magenta","Red","White","Yellow"].indexOf(e.style.color)>-1&&this.parent.notify(setCellFormat,{style:{color:"black"}}),t},WorkbookNumberFormat.prototype.processFormats=function(e,t,r,n,i,o,a){var s;if(e.format=e.format?e.format:"General",""!==t)switch(e.type){case"General":t=(s=this.autoDetectGeneralFormat({args:e,currencySymbol:o,fResult:t,intl:i,isRightAlign:r,curCode:a,cell:n,rowIdx:Number(e.rowIdx),colIdx:Number(e.colIdx)})).fResult,r=s.isRightAlign;break;case"Number":isNumber(t)&&(t=this.applyNumberFormat(e,i),r=!0);break;case"Currency":isNumber(t)&&(t=this.currencyFormat(e,i,a),r=!0);break;case"Percentage":isNumber(t)&&(t=this.percentageFormat(e,i),r=!0);break;case"Accounting":isNumber(t)&&(t=this.accountingFormat(e,i,o,a),r=!0);break;case"ShortDate":r=!!(t=this.shortDateFormat(e,i));break;case"LongDate":r=!!(t=this.longDateFormat(e,i));break;case"Time":r=!!(t=this.timeFormat(e,i));break;case"Fraction":isNumber(t)&&(t=this.fractionFormat(e),r=!0);break;case"Scientific":isNumber(t)&&(t=this.scientificFormat(e),r=!0);break;case"Text":r=!1}return{fResult:t,rightAlign:r}},WorkbookNumberFormat.prototype.autoDetectGeneralFormat=function(e){var t=!1,r=e.fResult;if(e.args.cell&&e.args.cell.formula&&e.args.cell.formula.indexOf("ADDRESS(")>0&&(t=!0),isNumber(e.fResult)&&(e.args.format&&""!==e.args.format&&(e.args.format.toString().indexOf("%")>-1?e.fResult=this.percentageFormat(e.args,e.intl):e.args.format.toString().indexOf(e.currencySymbol)>-1?e.fResult=this.currencyFormat(e.args,e.intl,e.curCode):e.fResult=this.applyNumberFormat(e.args,e.intl)),"General"===e.args.format&&e.fResult&&e.fResult.toString().split(this.decimalSep)[0].length>11&&(e.fResult=this.scientificFormat(e.args)),e.isRightAlign=!0),!ej2Base.isNullOrUndefined(e.fResult)){var n=e.fResult.toString();n.indexOf("%")>-1&&""!==n.split("%")[0]&&""===n.split("%")[1].trim()&&"NaN"!==Number(n.split("%")[0].split(this.groupSep).join("")).toString()?(e.args.value=Number(n.split("%")[0].split(this.groupSep).join(""))/100,e.cell.format=e.args.format=this.getPercentageFormat(n),e.fResult=this.percentageFormat(e.args,e.intl),e.cell.value=e.args.value.toString(),e.isRightAlign=!0):n.indexOf(e.currencySymbol)>-1&&""!==n.split(e.currencySymbol)[1]&&"NaN"!==Number(n.split(e.currencySymbol)[1].split(this.groupSep).join("")).toString()&&(e.args.value=Number(n.split(e.currencySymbol)[1].split(this.groupSep).join("")),e.cell.format=e.args.format=getFormatFromType("Currency"),e.fResult=this.currencyFormat(e.args,e.intl,e.curCode),e.cell.value=e.args.value.toString(),setCell(e.rowIdx,e.colIdx,this.parent.getActiveSheet(),e.cell,!0),e.isRightAlign=!0)}return t&&(e.isRightAlign=!1,e.fResult=r),{isRightAlign:e.isRightAlign,fResult:e.fResult}},WorkbookNumberFormat.prototype.getPercentageFormat=function(e){return e.indexOf(this.decimalSep)>-1?getFormatFromType("Percentage"):"0%"},WorkbookNumberFormat.prototype.findSuffix=function(e,t){var r=e.length-t.length;return e.substr(0,r<0?0:r)+t},WorkbookNumberFormat.prototype.applyNumberFormat=function(e,t){e.format=this.isCustomFormat(e.format.toString());var r=e.format.toString().split(";");if(Number(e.value)>0)e.format=r[0];else if(0===Number(e.value)){if(e.format=r[2]?r[2]:r[0],e.format.indexOf('"')>-1&&-1===e.format.indexOf("#"))return e.format=e.format.split("_").join(" ").split("*").join(" ").split("?").join(" ").split('"').join(""),e.format}else if(Number(e.value)<0)e.format=ej2Base.isNullOrUndefined(r[1])?r[0]:r[1].split("*").join(" "),e.format.indexOf("-")>-1&&(e.value=e.value.toString().split("-").join(""));else if(e.format=r[3]?r[3]:r[0],e.format=e.format.split("_").join(" ").split("*").join(" ").split("?").join(" "),e.format.indexOf("@")>-1)return e.format.split("@").join(e.value.toString());if(e.format=e.format.split("_").join(" ").split("*").join(" ").split('"').join(""),e.format.indexOf("?")>-1&&e.format.indexOf(this.decimalSep)>-1){var n=e.format.split(this.decimalSep)[1].length,i="";if(Number(e.value)%1){i=n>e.value.toString().split(".")[1].length?" ":"0"}e.format=e.format.split("?").join(i)}else e.format=e.format.split("?").join(" ");return Number(e.value)<0&&e.cell&&(e.format=e.cell.format),t.formatNumber(Number(e.value),{format:e.format})},WorkbookNumberFormat.prototype.isCustomFormat=function(e){return'_-* #,##0.00_-;-* #,##0.00_-;_-* "-"_-;_-@_-'!==e&&'_-* #,##0_-;-* #,##0_-;_-* "-"_-;_-@_-'!==e||(e=""),e=""===e?getFormatFromType("Number"):e,e=e.toString().split("_)").join(" ").split("_(").join(" ").split("[Red]").join("")},WorkbookNumberFormat.prototype.currencyFormat=function(e,t,r){e.format=""===e.format?getFormatFromType("Currency"):e.format,e.format=e.format.toString().split("_(").join(" ").split("_)").join(" ").split("[Red]").join("");var n=e.format.toString().split(";");return Number(e.value)>=0?e.format=n[0]:e.format=ej2Base.isNullOrUndefined(n[1])?n[0]:n[1].split("*").join(" "),e.format=this.getFormatForOtherCurrency(e.format),t.formatNumber(Number(e.value),{format:e.format,currency:r})},WorkbookNumberFormat.prototype.percentageFormat=function(e,t){return e.format=""===e.format?getFormatFromType("Percentage"):e.format,t.formatNumber(Number(e.value),{format:e.format})},WorkbookNumberFormat.prototype.accountingFormat=function(e,t,r,n){e.format=""===e.format?getFormatFromType("Accounting"):e.format,e.format=e.format.split("_(").join(" ").split("_)").join(" ").split("[Red]").join("").split("_").join("");var i=e.format.split(";");return Number(e.value)>=0?e.format=i[0]:e.format=i[1].split("*").join(" "),e.format=this.getFormatForOtherCurrency(e.format),0===Number(e.value)?r+"- ":t.formatNumber(Number(e.value),{format:e.format,currency:n}).split("-").join("")},WorkbookNumberFormat.prototype.getFormatForOtherCurrency=function(e){if(e.indexOf("[$")>-1){var t=e.split("]")[0].split("[$")[1].split("-")[0];e=e.indexOf("0")>e.indexOf("[$")?t+e.slice(e.indexOf("]")+1,e.length):e.slice(0,e.indexOf("[$"))+t}return e},WorkbookNumberFormat.prototype.shortDateFormat=function(e,t){if(("dd/MM/yyyy"===e.format||"dd-MM-yyyy"===e.format)&&e.value&&(e.value.toString().indexOf("/")>-1||e.value.toString().indexOf("-")>-1)){var r=new ej2Base.Internationalization,n=toDate(e.value.toString(),r,this.parent.locale,e.format.toString()).dateObj;ej2Base.isNullOrUndefined(n)||"Invalid Date"===n.toString()||(e.value=dateToInt(n),e.cell&&(e.cell.value=e.value.toString()))}var i,o=intToDate(e.value),a=""===e.format||"General"===e.format?getFormatFromType("ShortDate"):e.format.toString();return a===getFormatFromType("ShortDate")?(a="M/d/yy",i={type:"date",skeleton:"yMd"}):i={type:"date",format:a},t.formatDate(o,i)},WorkbookNumberFormat.prototype.longDateFormat=function(e,t){var r=intToDate(e.value),n=""===e.format||"General"===e.format?getFormatFromType("LongDate"):e.format.toString();return n===getFormatFromType("LongDate")&&(n="EEEE, MMMM d, y"),t.formatDate(r,{type:"date",format:n})},WorkbookNumberFormat.prototype.timeFormat=function(e,t){if(ej2Base.isNullOrUndefined(e.value))return"";var r=e.value.toString().split(this.decimalSep);ej2Base.isNullOrUndefined(r[1])||(e.value=parseFloat(r[0]+1+this.decimalSep+r[1])||e.value);var n=intToDate(e.value),i=""===e.format||"General"===e.format?getFormatFromType("Time"):e.format.toString();return i===getFormatFromType("Time")&&(i="h:mm:ss a"),t.formatDate(n,{type:"time",skeleton:"medium",format:i})},WorkbookNumberFormat.prototype.scientificFormat=function(e){e.format=""===e.format?getFormatFromType("Scientific"):e.format;var t=e.format.split("+")[1],r=this.findDecimalPlaces(e.format,"Scientific"),n=Number(e.value).toExponential(r);return n.indexOf("e+")>-1?n=n.split("e+")[0]+"E+"+this.findSuffix(t,n.split("e+")[1]):n.indexOf("e-")>-1&&(n=n.split("e-")[0]+"E-"+ +this.findSuffix(t,n.split("e-")[1])),n},WorkbookNumberFormat.prototype.fractionFormat=function(e){e.format=""===e.format?getFormatFromType("Fraction"):e.format;var t,r="";return e.value.toString().indexOf(this.decimalSep)>-1&&isNumber(e.value)?(r=e.value.toString().split(this.decimalSep)[0],t=toFraction(Number(e.value)),0===Number(r)?" "+t:r+" "+t):r},WorkbookNumberFormat.prototype.findDecimalPlaces=function(e,t){var r,n;switch(t){case"Scientific":if(r=e.toUpperCase().indexOf("E"),n=e.indexOf(this.decimalSep),r>-1)return e.substring(n+1,r).length}return 2},WorkbookNumberFormat.prototype.checkDateFormat=function(e){var t,r=new ej2Base.Internationalization,n=ej2Base.isNullOrUndefined(e.value)?"":e.value.toString(),i=getCell(e.rowIndex,e.colIndex,getSheet(this.parent,ej2Base.isNullOrUndefined(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex)),o=this.checkCustomDateFormat(n);n&&(n.indexOf("/")>-1||n.indexOf("-")>0||n.indexOf(":")>-1)&&"Invalid"!==o&&(((n=o)&&n.indexOf("/")>-1||n.indexOf("-")>0||n.indexOf(":")>-1)&&(t=toDate(n,r,this.parent.locale,"",i),ej2Base.isNullOrUndefined(t.dateObj)||"Invalid Date"===t.dateObj.toString()||(i=i||{},n=dateToInt(t.dateObj,n.indexOf(":")>-1,t.type&&"time"===t.type).toString(),i.format&&""!==i.format||("time"===t.type?i.format=getFormatFromType("Time"):i.format=getFormatFromType("ShortDate")),e.isDate="date"===t.type||"datetime"===t.type,e.isTime="time"===t.type,e.dateObj=t.dateObj)),e.updatedVal=n)},WorkbookNumberFormat.prototype.checkCustomDateFormat=function(e){var t=e.indexOf("/")>-1?e.split("/"):e.indexOf("-")>0?e.split("-"):[""],r=["jan","feb","mar","apr","may","jun","jul","aug","sep","sept","oct","nov","dec"];if(2===t.length)return r.indexOf(t[0].toLowerCase())>-1&&Number(t[1])<=31?"01-"+t[0]+"-"+t[1]:r.indexOf(t[1].toLowerCase())>-1&&Number(t[0])<=31?t[0]+"-"+t[1]+"-"+(new Date).getFullYear():Number(t[0])<=31&&Number(t[1])<=12?t[0]+"-"+t[1]+"-"+(new Date).getFullYear():Number(t[1])<=31&&Number(t[0])<=12?t[0]+"-"+t[1]+"-"+(new Date).getFullYear():Number(t[0])<=12&&Number(t[1])<=9999&&Number(t[1])>=1900?"01-"+t[0]+"-"+t[1]:"Invalid";if(t.length>2)for(var n=function(e){if(!(Number(t[e])>-1||r.filter(function(r){return t[e].toLowerCase().includes(r)}).length))return{value:"Invalid"}},i=0;i<t.length;i++){var o=n(i);if("object"==typeof o)return o.value}return e},WorkbookNumberFormat.prototype.formattedBarText=function(e){if(""!==e.value){var t=getTypeFromFormat(e.cell?e.cell.format:""),r=new ej2Base.Internationalization,n=e.value,i="ShortDate"===t&&e.cell&&e.cell.format?e.cell.format:getFormatFromType("ShortDate"),o=getFormatFromType("Time");switch(t){case"ShortDate":case"LongDate":e.value=this.shortDateFormat({type:t,value:e.value,format:i},r);break;case"Time":n&&Number(n)>=1?e.value=this.shortDateFormat({type:t,value:e.value,format:i},r)+" "+this.timeFormat({type:t,value:e.value,format:o},r):e.value=this.timeFormat({type:t,value:e.value,format:o},r)}(!e.value||e.value&&e.value.toString().indexOf("null")>-1)&&(e.value=n)}},WorkbookNumberFormat.prototype.getFormattedNumber=function(e,t){return(new ej2Base.Internationalization).formatNumber(Number(t),{format:e})},WorkbookNumberFormat.prototype.addEventListener=function(){this.parent.on(applyNumberFormatting,this.numberFormatting,this),this.parent.on(getFormattedCellObject,this.getFormattedCell,this),this.parent.on(checkDateFormat,this.checkDateFormat,this),this.parent.on(getFormattedBarText,this.formattedBarText,this)},WorkbookNumberFormat.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(applyNumberFormatting,this.numberFormatting),this.parent.off(getFormattedCellObject,this.getFormattedCell),this.parent.off(checkDateFormat,this.checkDateFormat),this.parent.off(getFormattedBarText,this.formattedBarText))},WorkbookNumberFormat.prototype.destroy=function(){this.removeEventListener(),this.parent=null},WorkbookNumberFormat.prototype.getModuleName=function(){return"workbookNumberFormat"},WorkbookNumberFormat}(),DataBind=function(){function e(e){this.parent=e,this.requestedInfo=[],this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(updateSheetFromDataSource,this.updateSheetFromDataSourceHandler,this),this.parent.on(dataSourceChanged,this.dataSourceChangedHandler,this),this.parent.on(dataChanged,this.dataChangedHandler,this),this.parent.on(triggerDataChange,this.triggerDataChangeHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(updateSheetFromDataSource,this.updateSheetFromDataSourceHandler),this.parent.off(dataSourceChanged,this.dataSourceChangedHandler),this.parent.off(dataChanged,this.dataChangedHandler),this.parent.off(triggerDataChange,this.triggerDataChangeHandler))},e.prototype.updateSheetFromDataSourceHandler=function(e){var t,r,n,i,o,a,s,l,d,p,h=this,c=[],u=[],g=new ej2Data.Deferred;if(e.promise=g.promise,e.sheet&&e.sheet.ranges.length)for(var f=function(f){var v=e.indexes[0],C=e.indexes[2],y=e.sheet.ranges[f];l=getRangeIndexes(y.startCell)[0],a=y.dataSource instanceof ej2Data.DataManager?y.dataSource:y.dataSource?new ej2Data.DataManager(y.dataSource):new ej2Data.DataManager,o=o||a.dataSource.url,e.sheet.isLocalData=!a.dataSource.url,l<=v?v-=l:l<=C?(C-=l,v=0):v=-1,y.showFieldAsHeader&&0!==v&&(v-=1);var x=!1,b=0;m.initRangeInfo(y);var S=m.getMaxCount(y);if(p=m.getLoadedInfo(v,C,y),v=p.unloadedRange[0],C=p.unloadedRange[1],y.info.insertRowRange&&(y.info.insertRowRange.forEach(function(e){b+=e[1]-e[0]+1}),v-=b,C-=b),v>=S?x=!0:C>S&&(C=S),m.requestedInfo.push({deferred:g,indexes:e.indexes,isNotLoaded:p.isNotLoaded}),v>=0&&p.isNotLoaded&&!x){u[f]=v,c[f]=!1;var w=(y.query?y.query:new ej2Data.Query).clone();a.executeQuery(w.range(v,C>=S?C:C+1).requiresCount()).then(function(o){if(h.parent&&!h.parent.isDestroyed){if(i=o.result&&o.result.result?o.result.result:o.result,n=getRangeIndexes(y.startCell),l=n[0],d=n[1],i&&i.length){if(y.info.count||(S=o.count,y.info.count=o.count),r=Object.keys(i[0]),y.info.fldLen||(y.info.fldLen=r.length,y.info.flds=r),y.info.insertColumnRange){var a=0;y.info.insertColumnRange.forEach(function(e){for(var t=e[0];t<=e[1];t++)t<=d?r.splice(0,0,"emptyCell"+a):r.splice(t-d,0,"emptyCell"+a),a++})}0===u[f]&&y.showFieldAsHeader&&(s=l+u[f]+b,r.forEach(function(r,n){(t=getCell(s,d+n,e.sheet,!0))?r.includes("emptyCell")||(t.value=r):e.sheet.rows[l+u[f]].cells[d+n]=r.includes("emptyCell")?{}:{value:r}}));e.formulaCellRef&&getSheetIndexFromId(h.parent,e.sheet.id);i.forEach(function(n,i){s=l+u[f]+i+(y.showFieldAsHeader?1:0)+b;for(var o=0;o<r.length;o++)(t=getCell(s,d+o,e.sheet,!0))?r[o].includes("emptyCell")||setCell(s,d+o,e.sheet,h.getCellDataFromProp(n[r[o]]),!0):e.sheet.rows[s].cells[d+o]=r[o].includes("emptyCell")?{}:h.getCellDataFromProp(n[r[o]])})}else r=[];var g;g=l+(S||o.count)>0?l+(S||o.count)+(y.showFieldAsHeader?1:0)+b-1:e.sheet.usedRange.rowIndex;var m=d+r.length-1<0?e.sheet.usedRange.colIndex:d+r.length-1;if(e.isFinite?(e.sheet.usedRange.rowIndex=g<e.sheet.rowCount?g:e.sheet.rowCount-1,e.sheet.usedRange.colIndex=m<e.sheet.colCount?m:e.sheet.colCount-1):(e.sheet.usedRange.rowIndex=g,e.sheet.usedRange.colIndex=m),b?(p=h.getLoadedInfo(v,C,y),v=p.unloadedRange[0],C=p.unloadedRange[1],v>S&&(p.isNotLoaded=!1),p.isNotLoaded&&(C>S&&(C=S),y.info.loadedRange.push([v,C]))):y.info.loadedRange.push([v,C]),c[f]=!0,-1===c.indexOf(!1)){if(C+l<l+y.info.count){e.rangeSettingCount||(e.rangeSettingCount=[]),e.rangeSettingCount.push(f);var x={sheet:e.sheet,indexes:[0,0,g,m],promise:new Promise(function(e,t){e(void 0)}),rangeSettingCount:e.rangeSettingCount,isFinite:e.isFinite};h.updateSheetFromDataSourceHandler(x),x.promise.then(function(){"workbook"!==h.parent.getModuleName()&&(e.rangeSettingCount.pop(),e.rangeSettingCount.length||h.parent.notify("created",null),e.formulaCellRef&&h.notfyFormulaCellRefresh(e.formulaCellRef,e.sheetIndex))})}else e.formulaCellRef&&h.notfyFormulaCellRefresh(e.formulaCellRef,e.sheetIndex);h.checkResolve(e.indexes)}}})}else 0===f&&-1===c.indexOf(!1)&&m.checkResolve(e.indexes)},m=this,v=e.sheet.ranges.length-1;v>=0;v--)f(v);else g.resolve()},e.prototype.notfyFormulaCellRefresh=function(e,t){this.parent.formulaRefCell=null,this.parent.notify("updateView",{indexes:getRangeIndexes(e),sheetIndex:t,refreshing:!0})},e.prototype.checkResolve=function(e){var t,r,n=0;this.requestedInfo.forEach(function(i,o){((r=JSON.stringify(i.indexes)===JSON.stringify(e))||t)&&(0===o?(i.deferred.resolve(),n++,t=!0):!t||!i.isLoaded&&i.isNotLoaded?r&&t?(i.deferred.resolve(),n++):r?i.isLoaded=!0:t=!1:(i.deferred.resolve(),n++))}),this.requestedInfo.splice(0,n)},e.prototype.getCellDataFromProp=function(e){var t={};return"[object Object]"===Object.prototype.toString.call(e)?e.formula?t.formula=e.formula:e.value&&("string"==typeof e.value&&(0===e.value.indexOf("http://")||0===e.value.indexOf("https://")||0===e.value.indexOf("ftp://")||0===e.value.indexOf("www."))?t.hyperlink=e.value:t.value=e.value):checkIsFormula(e)?t.formula=e:"string"==typeof e&&(0===e.indexOf("http://")||0===e.indexOf("https://")||0===e.indexOf("ftp://")||0===e.indexOf("www."))?t.hyperlink=e:t.value=e,t},e.prototype.checkDataForFormat=function(e){if(""!==e.value){var t={value:e.value,rowIndex:e.rowIndex,colIndex:e.colIndex,isDate:!1,updatedVal:e.value,isTime:!1,sheetIndex:e.sheetIndex};this.parent.notify(checkDateFormat,t),t.isDate?e.cell?(e.cell.format||(e.cell.format=getFormatFromType("ShortDate")),e.cell.value=t.updatedVal):(e.args.sheet.rows[e.rowIndex].cells[e.colIndex].format=getFormatFromType("ShortDate"),e.args.sheet.rows[e.rowIndex].cells[e.colIndex].value=t.updatedVal):t.isTime&&(e.cell?(e.cell.format||(e.cell.format=getFormatFromType("Time")),e.cell.value=t.updatedVal):(e.args.sheet.rows[e.rowIndex].cells[e.colIndex].format=getFormatFromType("Time"),e.args.sheet.rows[e.rowIndex].cells[e.colIndex].value=t.updatedVal))}},e.prototype.getLoadedInfo=function(e,t,r){var n=!0;return r.info.loadedRange.forEach(function(r){r[0]<=e&&e<=r[1]?r[0]<=t&&t<=r[1]?n=!1:e=r[1]+1:r[0]<=t&&t<=r[1]&&(t=r[0]-1)}),{isNotLoaded:n,unloadedRange:[e,t]}},e.prototype.getMaxCount=function(e){if(e.query)for(var t=e.query.queries,r=0;r<t.length;r++)if("onTake"===t[r].fn)return Math.min(t[r].e.nos,e.info.count||t[r].e.nos);return e.info.count},e.prototype.initRangeInfo=function(e){e.info||(e.info={loadedRange:[]})},e.prototype.dataSourceChangedHandler=function(e){var t,r=this,n=this.parent.sheets[e.sheetIdx],i=n.ranges[e.rangeIdx];if(i&&(this.checkRangeHasChanges(n,e.rangeIdx)||!i.info)){var o=i.showFieldAsHeader,a=getCellIndexes(i.startCell);i.info&&(i.info.loadedRange.forEach(function(e){for(var r=e[0];r<=e[1]&&r<i.info.count+(o?1:0);r++)if(t=n.rows[r+a[0]])for(var s=a[1];s<a[1]+i.info.fldLen;s++)t.cells&&t.cells[s]&&delete t.cells[s]}),i.info=null);var s=this.parent.viewport,l=[s.topIndex,s.leftIndex,s.bottomIndex,s.rightIndex],d={sheet:n,indexes:l,dataSourceChange:!0,promise:new Promise(function(e,t){e(void 0)})};this.updateSheetFromDataSourceHandler(d),d.promise.then(function(){r.parent.trigger("dataSourceChanged",{data:e.changedData,action:"dataSourceChanged",rangeIndex:Number(e.rangeIdx),sheetIndex:Number(e.sheetIdx)}),r.parent.notify("updateView",{indexes:l,checkWrap:!0})})}},e.prototype.checkRangeHasChanges=function(e,t){if(this.parent.isAngular){var r="changedRangeIdx";return e[r]===parseInt(t,10)&&(delete e[r],!0)}return!0},e.prototype.dataChangedHandler=function(e){var t,r,n,i,o,a,s,l,d,p=this,h=[{}],c=void 0===e.sheetIdx?this.parent.activeSheetIndex:e.sheetIdx,u=this.parent.sheets[c];u.ranges.forEach(function(g,f){if(g.dataSource){var m=void 0;if(i=getCellIndexes(g.startCell),n=i.concat([i[0]+g.info.count+(g.showFieldAsHeader?0:-1),i[1]+g.info.fldLen-1]),"Row"===e.modelType||"Column"===e.modelType){if("Column"===e.modelType){if(e.insertType)o=n[1]<e.index&&n[3]>=e.index,l=[e.index],o?(e.model.forEach(function(){g.info.flds.splice(e.index-i[1],0,"")}),g.info.fldLen+=e.model.length):n[3]+1===e.index&&"after"===e.insertType?(e.model.forEach(function(){g.info.flds.splice(e.index-i[1],0,"")}),g.info.fldLen+=e.model.length):n[1]>=e.index&&(g.startCell=getCellAddress(i[0],i[1]+e.model.length));else if(o=n[1]<=e.startIndex&&n[3]>=e.startIndex)for(var v=e.startIndex;v<=e.endIndex;v++)v<=n[3]&&(g.info.flds.splice(e.startIndex,1),g.info.fldLen-=1);return}if(e.insertType){if(o=(g.showFieldAsHeader||"above"!==e.insertType&&!e.isMethod?n[0]<e.index:n[0]<=e.index)&&n[2]>=e.index,l=[e.index],o?(m=!0,g.info.count+=e.model.length):n[2]+1===e.index&&"below"===e.insertType?(m=!0,g.info.count+=e.model.length):n[0]>=e.index&&(g.startCell=getCellAddress(i[0]+e.model.length,i[1])),e.isMethod)return}else o=n[0]<=e.startIndex&&n[2]>=e.startIndex,e.isDataRequest?l=[e.startIndex,n[1],e.startIndex,n[1]]:t="delete"}else{l=getRangeIndexes(e.requestType&&e.requestType.toLowerCase().includes("paste")?e.pastedRange.split("!")[1]:e.sheetIdx>-1?e.address:(e.address||e.range||e.fillRange).split("!")[1]);var C=[g.showFieldAsHeader?n[0]+1:n[0]].concat(n.slice(1,4));if(g.showFieldAsHeader&&l[0]===i[0])for(v=l[1];v<=l[3];v++)v>=C[1]&&v<=C[3]&&(g.info.flds[v-i[1]]=getCell(i[0],v,u,!1,!0).value||"");if(o=isInRange(C,l,!0),"paste"===e.requestType&&e.copiedInfo.isCut){if(d=[].slice.call(e.copiedInfo.range),g.showFieldAsHeader&&d[0]===i[0]){for(v=d[1];v<=d[3];v++)v>=C[1]&&v<=C[3]&&(g.info.flds[v-i[1]]="");o=!1}a=isInRange(C,d,!0)}}if(o||m||a){if("Row"!==e.modelType||e.insertType||e.isDataRequest){t=m?"add":"edit";var y=0;if(a){y=d[2]-d[0]+1;var x=function(e){h[e]={},g.info.flds.forEach(function(t,n){t&&(r=getCell(d[0]+e,i[1]+n,u),h[e][t]=p.getFormattedValue(r))})};for(v=0;v<y;v++)x(v)}if(o||m)for(var b,S=!(e.isDataRequest||a||m||e.skipFilterCheck),w=function(e,t){if(S&&(getRow(u,l[0]+e)||{}).isFiltered)return b=t,"continue";h[t+y]={},g.info.flds.forEach(function(n,o){n&&(r=getCell(l[0]+e,i[1]+o,u),h[t+y][n]=p.getFormattedValue(r))}),b=++t},I=(v=0,0);v<(m?e.model.length:l[2]-l[0]+1||1);v++)w(v,I),I=b}else{if(e.deletedModel.forEach(function(e,t){h[t]={},g.info.flds.forEach(function(n,o){e.cells?(r=e.cells[i[1]+o],h[t][n]=p.getFormattedValue(r)):h[t][n]=null}),g.info.count-=1}),e.isMethod)return;s={count:e.deletedModel.length,index:e.endIndex}}e.isDataRequest?e.data=h:p.parent.trigger("dataSourceChanged",{data:h,action:t,rangeIndex:f,sheetIndex:c})}else s&&s.count&&n[0]>s.index&&(g.startCell=getCellAddress(i[0]-s.count,i[1]))}})},e.prototype.getFormattedValue=function(e){var t=this.parent.getDisplayText(e);return""===t?null:e&&!e.format&&"number"==typeof e.value?e.value:t},e.prototype.triggerDataChangeHandler=function(e){var t=!0;("delete"===e.action||"insert"===e.action)&&["Sheet"].indexOf(e.eventArgs.modelType)>-1?t=!1:"clear"===e.action&&["Clear Formats","Clear Hyperlinks"].indexOf(e.eventArgs.type)>-1?t=!1:"clipboard"===e.action&&"Formats"===e.eventArgs.requestType&&(t=!1),!e.isUndo||"delete"!==e.action&&"insert"!==e.action||("delete"===e.action?(e.eventArgs.index=e.eventArgs.startIndex,e.eventArgs.model=e.eventArgs.deletedModel,e.eventArgs.insertType="below"):(e.eventArgs.startIndex=e.eventArgs.index,e.eventArgs.endIndex=e.eventArgs.index+e.eventArgs.model.length-1,e.eventArgs.deletedModel=e.eventArgs.model,delete e.eventArgs.insertType)),t&&["insert","delete","edit","cellDelete","cellSave","autofill","clipboard","clear"].indexOf(e.action)>-1&&this.parent.notify(dataChanged,e.eventArgs)},e.prototype.getModuleName=function(){return"dataBind"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null,this.requestedInfo=[]},e}(),ribbon="ribbon",formulaBar="formulaBar",sheetTabs="sheetTabs",refreshSheetTabs="refreshSheetTabs",isFormulaBarEdit="isFormulaBarEdit",initialLoad="initialLoad",contentLoaded="contentLoaded",mouseDown="mouseDown",spreadsheetDestroyed="spreadsheetDestroyed",editOperation="editOperation",formulaOperation="formulaOperation",formulaBarOperation="formulaBarOperation",click="click",keyUp="keyUp",keyDown="keyDown",formulaKeyUp="formulaKeyUp",formulaBarUpdate="formulaBarUpdate",onVerticalScroll="verticalScroll",onHorizontalScroll="horizontalScroll",beforeContentLoaded="beforeContentLoaded",beforeVirtualContentLoaded="beforeVirtualContentLoaded",virtualContentLoaded="virtualContentLoaded",contextMenuOpen="contextMenuOpen",cellNavigate="cellNavigate",mouseUpAfterSelection="mouseUpAfterSelection",cMenuBeforeOpen="contextmenuBeforeOpen",insertSheetTab="insertSheetTab",removeSheetTab="removeSheetTab",renameSheetTab="renameSheetTab",ribbonClick="ribboClick",refreshRibbon="ribbonRefresh",enableToolbarItems="enableToolbarItems",tabSwitch="tabSwitch",selectRange="selectRange",cut="cut",copy="copy",paste="paste",clearCopy="clearCopy",dataBound="dataBound",beforeDataBound="beforeDataBound",addContextMenuItems="addContextMenuItems",removeContextMenuItems="removeContextMenuItems",enableContextMenuItems="enableContextMenuItems",enableFileMenuItems="enableFileMenuItems",hideFileMenuItems="hideFileMenuItems",addFileMenuItems="addFileMenuItems",hideRibbonTabs="hideRibbonTabs",enableRibbonTabs="enableRibbonTabs",addRibbonTabs="addRibbonTabs",addToolbarItems="addToolbarItems",hideToolbarItems="hideToolbarItems",beforeRibbonCreate="beforeRibbonCreate",rowHeightChanged="rowHeightChanged",colWidthChanged="colWidthChanged",onContentScroll="onContentScroll",deInitProperties="deInitProperties",activeSheetChanged="activeSheetChanged",renameSheet="renameSheet",initiateCustomSort="initiateCustomSort",applySort="applySort",collaborativeUpdate="collaborativeUpdate",autoFit="autoFitRowsColumns",updateToggleItem="updateToggleItem",initiateHyperlink="initiateHyperlink",editHyperlink="editHyperlink",openHyperlink="openHyperlink",removeHyperlink="removeHyperlink",createHyperlinkElement="createHyperlinkElement",sheetNameUpdate="sheetNameUpdate",hideSheet="hideSheet",performUndoRedo="performUndoRedo",updateUndoRedoCollection="updateUndoRedoCollection",setActionData="setActionData",getBeforeActionData="getBeforeActionData",clearUndoRedoCollection="clearUndoRedoCollection",initiateFilterUI="initiateFilterUI",renderFilterCell="renderFilterCell",reapplyFilter="reapplyFilter",filterByCellValue="filterByCellValue",clearFilter="clearFilter",getFilteredColumn="getFilteredColumn",completeAction="actionComplete",beginAction="actionBegin",filterCellKeyDown="filterCellKeyDown",getFilterRange="getFilterRange",setAutoFit="setAutoFit",refreshFormulaDatasource="refreshFormulaDatasource",setScrollEvent="setScrollEvent",initiateDataValidation="initiatedatavalidation",validationError="validationError",startEdit="startEdit",invalidData="invalidData",clearInvalid="clearInvalid",protectSheet="protectSheet",applyProtect="applyProtect",unprotectSheet="unprotectSheet",protectCellFormat="protectCellFormat",gotoDlg="renderGotoDlgt",findDlg="renderFindDlg",findHandler="findHandler",replace="replaceHandler",created="created",editAlert="editAlert",setUndoRedo="setUndoRedo",enableFormulaInput="enableFormulaInput",protectSelection="protectSelection",hiddenMerge="hiddenMerge",checkPrevMerge="checkPrevMerge",checkMerge="checkMerge",removeDataValidation="removeDataValidation",showAggregate="showAggregate",initiateConditionalFormat="initiateConditionalFormat",setCF="setCF",clearViewer="clearViewer",initiateFormulaReference="initiateFormulaReference",initiateCur="initiateCur",clearCellRef="clearCellRef",editValue="editValue",addressHandle="addressHandle",initiateEdit="initiateEdit",forRefSelRender="forRefSelRender",blankWorkbook="blankWorkbook",insertImage="insertImage",refreshImgElem="refreshImgElem",refreshImgCellObj="refreshImgCellObj",getRowIdxFromClientY="getRowIdxFromClientY",getColIdxFromClientX="getColIdxFromClientX",createImageElement="createImageElement",deleteImage="deleteImage",deleteChart="deleteChart",refreshChartCellObj="refreshChartCellObj",refreshImagePosition="refreshImagePosition",updateTableWidth="updateTableWidth",focusBorder="focusBorder",clearChartBorder="clearChartBorder",insertChart="insertChart",chartRangeSelection="chartRangeSelection",insertDesignChart="insertDesignChart",removeDesignChart="removeDesignChart",chartDesignTab="chartDesignTab",addChartEle="addChartEle",isReact="isReact",renderReactTemplates="renderReactTemplates",clearTemplate="clearTemplate",protectWorkbook="protectWorkbook",unProtectWorkbook="unProtectWorkbook",getPassWord="getPassWord",importProtectWorkbook="importProtectWorkbook",selectionStatus="selectionStatus",freeze="freeze",overlayEleSize="overlayEleSize",updateScroll="updateScroll",positionAutoFillElement="positionAutoFillElement",hideAutoFillOptions="hideAutoFillOptions",performAutoFill="performAutoFill",selectAutoFillRange="selectAutoFillRange",autoFill="autoFill",fillRange="fillRange",UnProtectWorksheet="UnProtectWorksheet",hideAutoFillElement="hideAutoFillElement",unProtectSheetPassword="unProtectSheetPassword",updateTranslate="updateTranslate",getUpdatedScrollPosition="getUpdatedScrollPosition",updateScrollValue="updateScrollValue",WorkbookOpen=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.open=function(e){var t=this;if(this.parent.allowOpen)if(e.jsonObject)this.fetchSuccess(e.jsonObject,null,!0);else{var r=new FormData;if(e.file)r.append("file",e.file);else{if(!(e.sheetIndex>=0))return void(this.parent.isOpen=!1);r.append("sheetPassword",e.sheetPassword),r.append("sheetIndex",e.sheetIndex.toString())}var n={passWord:""};e.password&&e.password.length&&(n.passWord=e.password),n.passWord&&n.passWord.length&&(e.password=n.passWord),e.password&&r.append("password",e.password);var i={file:e.file||null,cancel:!1,requestData:{method:"POST",body:r},password:n.passWord};ej2Base.isNullOrUndefined(e.sheetPassword)&&(this.parent.trigger("beforeOpen",i),this.parent.notify(beginAction,{eventArgs:i,action:"beforeOpen"})),i.cancel?this.parent.isOpen=!1:fetch(this.parent.openUrl,i.requestData).then(function(e){return e.ok?e.json():Promise.reject({status:e.status,statusText:e.statusText,url:e.url})}).then(function(e){return t.fetchSuccess(e,i)}).catch(function(e){return t.fetchFailure(e)})}},e.prototype.fetchFailure=function(e){ej2Base.isUndefined(e.status)&&ej2Base.isUndefined(e.statusText)&&(e.statusText="Improper response"),this.parent.notify(openFailure,e),this.parent.isOpen=!1},e.prototype.fetchSuccess=function(e,t,r){var n=("string"==typeof e?JSON.parse(e):e).Workbook;["UnsupportedFile","InvalidUrl","NeedPassword","InCorrectPassword","InCorrectSheetPassword","CorrectSheetPassword"].indexOf(n)>-1?this.parent.notify(openSuccess,{context:this,data:n,eventArgs:t,isOpenFromJson:r}):(this.updateModel(n,r),this.parent.notify(openSuccess,{context:this,data:n,isOpenFromJson:r}),this.parent.isOpen=!1,t&&t.password&&t.password.length>0&&(this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),this.parent.password=""))},e.prototype.updateModel=function(e,t){this.parent.notify(workbookFormulaOperation,{action:"unRegisterSheet"}),this.setSelectAllRange(e.sheets,t),this.parent.sheetNameCount=1,this.parent.sheets=[],this.parent.notify(sheetsDestroyed,{}),e.activeSheetIndex=e.activeSheetIndex||0,this.parent.setProperties({sheets:e.sheets,activeSheetIndex:e.activeSheetIndex,definedNames:e.definedNames||[],filterCollection:e.filterCollection||[],sortCollection:e.sortCollection||[]},!0),initSheet(this.parent),this.parent.notify(sheetCreated,null),this.parent.notify(workbookFormulaOperation,{action:"registerSheet",isImport:!0}),this.parent.notify(workbookFormulaOperation,{action:"initiateDefinedNames"}),this.parent.notify(protectSheetWorkBook,null)},e.prototype.setSelectAllRange=function(e,t){var r,n,i=this;e.forEach(function(e){if(e.selectedRange){var o=getRangeIndexes(e.selectedRange),a=(ej2Base.isUndefined(e.rowCount)?100:e.rowCount)-1,s=(ej2Base.isUndefined(e.colCount)?100:e.colCount)-1;65535===o[2]&&(o[2]=a),255===o[3]&&(o[3]=s),65535===o[0]&&(o[0]=a),255===o[1]&&(o[1]=s),e.selectedRange=getRangeAddress(o)}if(t&&i.parent.isAngular)for(var l=0;l<i.parent.sheets.length;l++)if(r=i.parent.sheets[l],e.name===r.name){e.ranges&&e.ranges.forEach(function(e,t){(n=r.ranges[t])&&n.template&&(e.template=n.template)});break}})},e.prototype.addEventListener=function(){this.parent.on(workbookOpen,this.open.bind(this))},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(workbookOpen,this.open.bind(this))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookOpen"},e}(),SaveWorker=function(){function e(e){this.parent=e}return e.prototype.processSheet=function(e,t){return[t,JSON.parse(e,function(e,t){if(!Array.isArray(t)&&"string"!=typeof t||t.length)return t})]},e.prototype.processSave=function(e,t,r,n){var i,o=new FormData,a=Object.keys(t);for(o.append("JSONData",JSON.stringify(e)),i=0;i<a.length;i++)o.append(a[i],t[a[i]]);for(a=Object.keys(r),i=0;i<a.length;i++)o.append(a[i],r[a[i]]);o.append("pdfLayoutSettings",JSON.stringify(n)),fetch(t.url,{method:"POST",body:o}).then(function(e){return e.ok?e.blob():Promise.reject({message:e.statusText})}).then(function(e){new Promise(function(t){var r=new FileReader;r.onload=function(){var n=r.result.toString();if(n.indexOf("data:text/plain;base64,")>-1||n.indexOf("data:text/html;base64,")>-1||n.indexOf("data:application/json;base64,")>-1){var i=void 0;if(n=n.replace("data:text/plain;base64,",""),(n=n.replace("data:text/html;base64,","")).indexOf("data:application/json;base64,")>-1?(n=n.replace("data:application/json;base64,",""),i=atob(n).split(".")):i=atob(n).split(/(\r\n|\n|\r)/gm),i.length){var o=i[0].length>1&&'"'===i[0][0]?i[0].split('"')[1]+".":i[0];postMessage({dialog:o})}}else postMessage(e);t(r.result)},r.readAsDataURL(e)})}).catch(function(e){postMessage({error:e.message})})},e}(),__extends$2=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),WorkbookSave=function(e){function t(t){var r=e.call(this,t)||this;return r.isProcessCompleted=!1,r.saveJSON={},r.isFullPost=!1,r.needBlobData=!1,r.customParams=null,r.pdfLayoutSettings={fitSheetOnOnePage:!1},r.addEventListener(),r}return __extends$2(t,e),t.prototype.getModuleName=function(){return"workbookSave"},t.prototype.destroy=function(){this.removeEventListener(),this.parent=null},t.prototype.addEventListener=function(){this.parent.on(beginSave,this.initiateSave,this)},t.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(beginSave,this.initiateSave)},t.prototype.initiateSave=function(e){var t=e.saveSettings;this.parent.notify(getFilteredCollection,null),this.saveSettings={saveType:t.saveType,url:t.url,fileName:t.fileName||"Sample"},this.isFullPost=e.isFullPost,this.needBlobData=e.needBlobData,this.needBlobData&&(this.isFullPost=!1),this.customParams=e.customParams,this.pdfLayoutSettings=e.pdfLayoutSettings,this.updateBasicSettings(),this.processSheets()},t.prototype.updateBasicSettings=function(){var e=this.getStringifyObject(this.parent,["sheets","_isScalar","observers","closed","isStopped","hasError","__isAsync","beforeCellFormat","beforeCellRender","beforeDataBound","beforeOpen","beforeSave","beforeSelect","beforeSort","cellEdit","cellEditing","cellSave","beforeCellSave","contextMenuItemSelect","contextMenuBeforeClose","contextMenuBeforeOpen","created","dataBound","fileMenuItemSelect","fileMenuBeforeClose","fileMenuBeforeOpen","saveComplete","sortComplete","select","actionBegin","actionComplete","afterHyperlinkClick","afterHyperlinkCreate","beforeHyperlinkClick","beforeHyperlinkCreate","openComplete","openFailure","queryCellInfo","dialogBeforeOpen","dataSourceChanged","beforeConditionalFormat"]),t=JSON.parse(e);this.parent.sheets.length&&(t.sheets=[]),this.saveJSON=t},t.prototype.processSheets=function(){var e=0,t=this.parent.sheets.length,r=["dataSource","startCell","query","showFieldAsHeader"];for(this.parent.isAngular&&r.push("template");e<t;)executeTaskAsync(this,this.processSheet,this.updateSheet,[this.getStringifyObject(this.parent.sheets[e],r),e]),e++},t.prototype.updateSheet=function(e){this.saveJSON.sheets[e[0]]=e[1],this.isProcessCompleted=this.getSheetLength(this.saveJSON.sheets)===this.parent.sheets.length,this.isProcessCompleted&&this.save(this.saveSettings)},t.prototype.getSheetLength=function(e){var t=0;return e.forEach(function(e){e&&t++}),t},t.prototype.save=function(e){var t={cancel:!1,jsonObject:this.saveJSON};this.parent.notify(onSave,t),t.cancel||(this.isFullPost?this.initiateFullPostSave():executeTaskAsync(this,{workerTask:this.processSave},this.updateSaveResult,[this.saveJSON,e,this.customParams,this.pdfLayoutSettings],!0)),this.saveJSON={}},t.prototype.updateSaveResult=function(e){var t={status:"Success",message:"",url:this.saveSettings.url,fileName:this.saveSettings.fileName,saveType:this.saveSettings.saveType,blobData:null};"object"==typeof e&&e.error?(t.status="Failure",t.message=e.error.toString()):"object"==typeof e&&e.dialog?this.parent.notify(saveError,{content:e.dialog}):this.needBlobData?t.blobData=e:this.ClientFileDownload(e),this.parent.trigger("saveComplete",t),this.parent.notify(saveCompleted,t)},t.prototype.ClientFileDownload=function(e){var t=this.parent.createElement("a",{attrs:{download:this.getFileNameWithExtension()}}),r=URL.createObjectURL(e);t.href=r,document.body.appendChild(t),t.click(),URL.revokeObjectURL(r),document.body.removeChild(t)},t.prototype.initiateFullPostSave=function(){var e,t=Object.keys(this.saveSettings),r=this.parent.createElement("form",{attrs:{method:"POST",action:this.saveSettings.url}}),n=this.parent.createElement("input",{attrs:{type:"hidden",name:"JSONData"}});for(n.value=JSON.stringify(this.saveJSON),r.appendChild(n),e=0;e<t.length;e++)(n=this.parent.createElement("input",{attrs:{type:"hidden",name:t[e]}})).value=this.saveSettings[t[e]],r.appendChild(n);for(t=Object.keys(this.customParams),e=0;e<t.length;e++)(n=this.parent.createElement("input",{attrs:{type:"hidden",name:t[e]}})).value=this.customParams[t[e]],r.appendChild(n);(n=this.parent.createElement("input",{attrs:{type:"hidden",name:"pdfLayoutSettings"}})).value=JSON.stringify(this.pdfLayoutSettings),r.appendChild(n),document.body.appendChild(r),r.submit(),ej2Base.detach(r),this.parent.notify(saveCompleted,{})},t.prototype.getStringifyObject=function(e,t){return void 0===t&&(t=[]),JSON.stringify(e,function(e,r){return t.indexOf(e)>-1?void 0:r&&"object"==typeof r&&r.hasOwnProperty("properties")?r.properties:null!==r?r:void 0})},t.prototype.getFileNameWithExtension=function(e){e||(e=this.saveSettings.fileName);var t=this.getFileExtension(),r=e.lastIndexOf(".");return r>-1&&(e=e.substr(0,r)),e+t},t.prototype.getFileExtension=function(){return"."+this.saveSettings.saveType.toLowerCase()},t}(SaveWorker),CalculateCommon=function(){function e(e){this.parent=e}return e.prototype.getModuleName=function(){return"calc-common"},e}(),MODULE_SUFFIX="Module",ModuleLoader=function(){function e(e){this.loadedModules=[],this.parent=e}return e.prototype.inject=function(e,t){var r=e.length;if(0!==r){this.loadedModules.length&&this.clearUnusedModule(e);for(var n=0;n<r;n++)for(var i=e[n],o=0,a=t;o<a.length;o++){var s=a[o],l=i.member;if(s.prototype.getModuleName()===i.member&&!this.isModuleLoaded(l)){var d=this.createInstance(s,i.args),p=this.getMemberName(l);i.isProperty?setValue(p,s,this.parent):setValue(p,d,this.parent);var h=i;h.member=p,this.loadedModules.push(h)}}}else this.clean()},e.prototype.createInstance=function(e,t){var r=t;return r.unshift(void 0),new(Function.prototype.bind.apply(e,r))},e.prototype.clean=function(){for(var e=0,t=this.loadedModules;e<t.length;e++){var r=t[e];r.isProperty||getValue$1(r.member,this.parent).destroy()}this.loadedModules=[]},e.prototype.clearUnusedModule=function(e){for(var t=this,r=e.map(function(e){return t.getMemberName(e.member)}),n=0,i=this.loadedModules.filter(function(e){return-1===r.indexOf(e.member)});n<i.length;n++){var o=i[n];o.isProperty||getValue$1(o.member,this.parent).destroy(),this.loadedModules.splice(this.loadedModules.indexOf(o),1),this.deleteObject(this.parent,o.member)}},e.prototype.getMemberName=function(e){return e[0].toLowerCase()+e.substring(1)+MODULE_SUFFIX},e.prototype.deleteObject=function(e,t){delete e[t]},e.prototype.isModuleLoaded=function(e){for(var t=0,r=this.loadedModules;t<r.length;t++){if(r[t].member===this.getMemberName(e))return!0}return!1},e}();!function(e){e[e.na=0]="na",e[e.value=1]="value",e[e.ref=2]="ref",e[e.divzero=3]="divzero",e[e.num=4]="num",e[e.name=5]="name",e[e.null=6]="null"}(exports.CommonErrors||(exports.CommonErrors={})),function(e){e[e.operators_cannot_start_with_expression=0]="operators_cannot_start_with_expression",e[e.reservedWord_And=1]="reservedWord_And",e[e.reservedWord_Xor=2]="reservedWord_Xor",e[e.reservedWord_If=3]="reservedWord_If",e[e.number_contains_2_decimal_points=4]="number_contains_2_decimal_points",e[e.reservedWord_Else=5]="reservedWord_Else",e[e.reservedWord_Not=6]="reservedWord_Not",e[e.invalid_char_in_number=7]="invalid_char_in_number",e[e.invalid_characters_following_with_operator=6]="invalid_characters_following_with_operator",e[e.mismatched_parentheses=8]="mismatched_parentheses",e[e.unknown_formula_name=9]="unknown_formula_name",e[e.requires_a_single_argument=10]="requires_a_single_argument",e[e.requires_3_args=11]="requires_3_args",e[e.invalid_Math_argument=12]="invalid_Math_argument",e[e.requires_2_args=13]="requires_2_args",e[e.bad_index=14]="bad_index",e[e.too_complex=15]="too_complex",e[e.circular_reference=16]="circular_reference",e[e.missing_formula=17]="missing_formula",e[e.improper_formula=18]="improper_formula",e[e.invalid_expression=19]="invalid_expression",e[e.cell_empty=20]="cell_empty",e[e.bad_formula=21]="bad_formula",e[e.empty_expression=22]="empty_expression",e[e.virtual_mode_required=23]="virtual_mode_required",e[e.mismatched_tics=24]="mismatched_tics",e[e.wrong_number_arguments=25]="wrong_number_arguments",e[e.invalid_arguments=26]="invalid_arguments",e[e.iterations_do_not_converge=27]="iterations_do_not_converge",e[e.calculation_overflow=29]="calculation_overflow",e[e.already_registered=28]="already_registered",e[e.missing_sheet=30]="missing_sheet",e[e.cannot_parse=31]="cannot_parse",e[e.expression_cannot_end_with_an_operator=32]="expression_cannot_end_with_an_operator",e[e.spill=33]="spill",e[e.div=34]="div"}(exports.FormulasErrorsStrings||(exports.FormulasErrorsStrings={}));var BasicFormulas=function(){function e(e){this.formulas=[{formulaName:"SUM",category:"Math & Trig",description:"Sums individual values, cell references or ranges."},{formulaName:"SUMIFS",category:"Math & Trig",description:"Sums the cells specified by a given set of conditionsor criteria."},{formulaName:"SUMPRODUCT",category:"Math & Trig",description:"Returns sum of the product of given ranges of arrays."},{formulaName:"ABS",category:"Math & Trig",description:"Returns the absolute value of a number."},{formulaName:"RAND",category:"Math & Trig",description:"Return a random number between 0 and 1."},{formulaName:"FLOOR",category:"Math & Trig",description:"Returns the round a number down to the nearest integer."},{formulaName:"CEILING",category:"Math & Trig",description:"Returns a number rounded up to a multiple of another number."},{formulaName:"SUMIF",category:"Math & Trig",description:"It will sum up cells that meet the given criteria."},{formulaName:"PRODUCT",category:"Math & Trig",description:"Multiplies all the numbers given as arguments and returns the product."},{formulaName:"AVERAGE",category:"Statistical",description:"The sum of the numbers divided by how many numbers are being averaged."},{formulaName:"AVERAGEIF",category:"Statistical",description:"Computes the average of the numbers in a range that meet the supplied criteria."},{formulaName:"COUNT",category:"Statistical",description:"Counts the numbers in the list of arguments, exclude text entries."},{formulaName:"COUNTA",category:"Statistical",description:"Counts the non-empty values in the list of arguments."},{formulaName:"COUNTIF",category:"Statistical",description:"Counts the number of cells in a range that meet a specified condition."},{formulaName:"COUNTIFS",category:"Statistical",description:"Counts the number of times each cells in all the ranges that meet the specific conditions."},{formulaName:"AVERAGEA",category:"Statistical",description:"Calculates the average of values in the list of arguments.Arguments can be numbers, names, arrays or references."},{formulaName:"AVERAGEIFS",category:"Statistical",description:"Conditionally returns the average of the contents of cells for the set of ranges."},{formulaName:"MIN",category:"Statistical",description:"Returns the smaller number in set of arguments."},{formulaName:"MAX",category:"Statistical",description:"Returns the largest number in set of arguments."},{formulaName:"DATE",category:"Date",description:"Returns the date, given the year, month and day of the month."},{formulaName:"DAY",category:"Date",description:"Returns the day of a given date."},{formulaName:"TODAY",category:"Date",description:"Returns the current date as date value."},{formulaName:"DAYS",category:"Date",description:"Returns the number of days between two dates."},{formulaName:"WEEKDAY",category:"Date",description:"Returns the day of the week corresponding to a date."},{formulaName:"IF",category:"Logical",description:"Returns one value if a logical expression is TRUE and another if it is FALSE"},{formulaName:"AND",category:"Logical",description:"Returns TRUE if all the arguments are considered TRUE, and FALSE otherwise."},{formulaName:"IFS",category:"Logical",description:"Checks multiple conditions and returns a value corresponding to the first TRUE result."},{formulaName:"IFERROR",category:"Logical",description:"Returns a value you specify if a formula evaluates to an error; otherwise, it returns the result of the formula."},{formulaName:"CHOOSE",category:"Lookup & Reference",description:"Returns a value from a list, given an index number."},{formulaName:"INDEX",category:"Lookup & Reference",description:"Returns a value from a table, given a row and column number."},{formulaName:"FIND",category:"Text",description:"Returns the position of a string of text within another string."},{formulaName:"CONCATENATE",category:"Text",description:" Used to join two or more strings together."},{formulaName:"CONCAT",category:"Text",description:"Concatenates a list or range of text strings."},{formulaName:"SUBTOTAL",category:"Lookup & Reference",description:"Returns a subtotal in a list or database."},{formulaName:"RADIANS",category:"Math & Trig",description:"Converts degrees to radians."},{formulaName:"OR",category:"Logical",description:"Returns TRUE if any arguments considered TRUE, and all the arguments are FALSE it will return FALSE."},{formulaName:"MATCH",category:"Lookup & Reference",description:"Returns the relative position of an checked item in range that matches a specified value in a specified order"},{formulaName:"RANDBETWEEN",category:"Math & Trig",description:"Returns an integer random number in a specified range."},{formulaName:"SLOPE",category:"Statistical",description:"Returns the slope of the line from linear regression of the data points."},{formulaName:"INTERCEPT",category:"Statistical",description:"Calculates the point of the Y-intercept line via linear regression."},{formulaName:"UNIQUE",category:"Lookup & Reference",description:"Returns a unique values from a range or array."},{formulaName:"ROUNDUP",category:"Math & Trig",description:"Rounds a number away from zero."},{formulaName:"INT",category:"Math & Trig",description:"Returns a number to the nearest integer."},{formulaName:"LN",category:"Math & Trig",description:"Returns the natural logarithm of a number."},{formulaName:"ISNUMBER",category:"Information",description:"Returns TRUE, if the argument is number and FALSE otherwise."},{formulaName:"ROUND",category:"Math & Trig",description:"Rounds a number to a specified number of digits."},{formulaName:"LOG",category:"Math & Trig",description:"Returns the logarithm of a number to the base that you specify."},{formulaName:"POWER",category:"Math & Trig",description:"Returns the result of a number raised to power."},{formulaName:"TRUNC",category:"Math & Trig",description:"Returns the truncated value of a number to a specified number of decimal places."},{formulaName:"EXP",category:"Math & Trig",description:"Returns e raised to the power of the given number."},{formulaName:"GEOMEAN",category:"Statistical",description:"Returns the geometric mean of an array or range of positive data."},{formulaName:"TEXT",category:"Lookup & Reference",description:"Converts a value to text in specified number format."},{formulaName:"SORT",category:"Lookup & Reference",description:"Sorts a range of an array."},{formulaName:"T",category:"Text",description:"Checks whether a value is text or not and returns the text."},{formulaName:"EXACT",category:"Text",description:"Checks whether a two text strings are exactly same and returns TRUE or FALSE."},{formulaName:"LEN",category:"Text",description:"Returns a number of characters in a given string."},{formulaName:"MOD",category:"Math & Trig",description:"Returns a remainder after a number is divided by divisor."},{formulaName:"ODD",category:"Math & Trig",description:"Rounds a positive number up and negative number down to the nearest odd integer."},{formulaName:"PI",category:"Math & Trig",description:"Returns the value of pi."},{formulaName:"COUNTBLANK",category:"Statistical",description:"Returns the number of empty cells in a specified range of cells."},{formulaName:"EVEN",category:"Math & Trig",description:"Rounds a positive number up and negative number down to the nearest even integer."},{formulaName:"FACT",category:"Math & Trig",description:"Returns the factorial of a number."},{formulaName:"DECIMAL",category:"Math & Trig",description:"Converts a text representation of a number in a given base into a decimal number."},{formulaName:"DEGREES",category:"Math & Trig",description:"Converts radians to degrees."},{formulaName:"ADDRESS",category:"Lookup & Reference",description:"Returns a cell reference as text, given specified row and column numbers."},{formulaName:"TIME",category:"Date & Time",description:"Converts hours, minutes, seconds to the time formatted text."},{formulaName:"CHAR",category:"Text",description:"Returns the character from the specified number."},{formulaName:"CODE",category:"Text",description:"Returns the numeric code for the first character in a given string."},{formulaName:"DOLLAR",category:"Text",description:"Converts the number to currency formatted text."},{formulaName:"SMALL",category:"Statistical",description:"Returns the k-th smallest value in a given array."},{formulaName:"LARGE",category:"Statistical",description:"Returns the k-th largest value in a given array."},{formulaName:"MEDIAN",category:"Statistical",description:"Returns the median of the given set of numbers."},{formulaName:"EDATE",category:"Date & Time",description:"Returns a date with given number of months before or after the specified date."},{formulaName:"DATEVALUE",category:"Date & Time",description:"Converts a date string into date value."},{formulaName:"HOUR",category:"Date & Time",description:"Returns the number of hours in a specified time string."},{formulaName:"MINUTE",category:"Date & Time",description:"Returns the number of minutes in a specified time string."},{formulaName:"SECOND",category:"Date & Time",description:"Returns the number of seconds in a specified time string."},{formulaName:"NOW",category:"Date & Time",description:"Returns the current date and time."},{formulaName:"MONTH",category:"Date & Time",description:"Returns the number of months in a specified date string."},{formulaName:"PROPER",category:"Text",description:"Converts a text to proper case; first letter to uppercase and other letters to lowercase."}],this.isConcat=!1,this.parent=e,this.init()}return e.prototype.init=function(){for(var e,t=0;t<this.formulas.length;t++)e=ej2Base.getValue("Compute"+this.formulas[t].formulaName,this).bind(this),this.addFormulaCollection(this.formulas[t].formulaName.toUpperCase(),e,this.formulas[t].category,this.formulas[t].description)},e.prototype.addFormulaCollection=function(e,t,r,n){this.parent.libraryFormulas={fName:e,handler:t,category:r,description:n}},e.prototype.ComputeSUM=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var r,n,i=0;if(!ej2Base.isNullOrUndefined(e))for(var o=e,a=0;a<o.length;a++){var s=o[a].toString();if(s.indexOf(":")>-1&&this.parent.isCellReference(s))for(var l=this.parent.getCellCollection(s.split(this.parent.tic).join("")),d=0;d<l.length;d++){if(r=this.parent.getValueFromArg(l[d]),this.parent.getErrorStrings().indexOf(r)>-1)return r;ej2Base.isNullOrUndefined(r[0])||isNaN(this.parent.parseFloat(r))||(i+=this.parent.parseFloat(r))}else{if(o[a].split(this.parent.tic).join("")===this.parent.trueValue&&(o[a]="1"),o[a].split(this.parent.tic).join("")===this.parent.falseValue&&(o[a]="0"),n=this.parent.getValueFromArg(o[a].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(n)>-1)return n;if(ej2Base.isNullOrUndefined(n)||isNaN(this.parent.parseFloat(n)))continue;n.length>0&&(i+=this.parent.parseFloat(n+""))}}return i.toString().indexOf(".")>-1?i.toFixed(2):i},e.prototype.ComputeINT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n,i;return(!ej2Base.isNullOrUndefined(e)&&1!==e.length||""===e[0])&&(r=this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments]),""!==e[0]&&1===e.length&&(i=(r=e[0]).indexOf('"'),r=(r=r.indexOf('"')>-1?r.replace('"',""):r).indexOf('"')>-1?r.replace('"',""):r,r="TRUE"===(r=this.parent.getValueFromArg(r)).toUpperCase()?"1":"FALSE"===r?"0":r,n=this.parent.parseFloat(r),n=Math.floor(n)),isNaN(n)&&(r=i>-1?this.parent.getErrorStrings()[exports.CommonErrors.value]:this.parent.getErrorStrings()[exports.CommonErrors.name]),n||r},e.prototype.ComputeTODAY=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r;if(e&&""!==e[0])r=this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];else{var n=new Date(Date.now());"spreadsheet"===this.parent.parentObject.getModuleName()?(r=this.parent.parentObject.dateToInt(n),0===this.parent.parser.storedStringText.toUpperCase().indexOf("TODAY")&&this.parent.parentObject.setDateFormat(this.parent.getSheetId(this.parent.grid),this.parent.rowIndex(this.parent.cell)-1,this.parent.colIndex(this.parent.cell)-1)):r=n.getFullYear()+"/"+this.parent.calculateDate((n.getMonth()+1).toString())+"/"+this.parent.calculateDate(n.getDate().toString())}return r},e.prototype.ComputeWEEKDAY=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r;if(""===e[0])r=this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];else{var n=this.parent.getValueFromArg(e[0]);r=Math.ceil(Number(n))%7||7}return r},e.prototype.ComputePROPER=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r;if(e&&""===e[0]||1!==e.length)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var n=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");if(n===this.parent.getErrorStrings()[exports.CommonErrors.name])return this.parent.getErrorStrings()[exports.CommonErrors.name];for(var i=n.toLowerCase().split(" "),o=0;o<i.length;o++)if(i[o][0])for(var a=0;a<i[o].length;a++)if(i[o].charCodeAt(a)>=97&&i[o].charCodeAt(a)<=122){i[o]=i[o].replace(i[o][a],i[o][a].toUpperCase());break}if((r=i.join(" ")).indexOf("-")>0){var s=r.split("-");for(o=0;o<s.length;o++)if(s[o][0])for(a=0;a<s[o].length;a++)if(s[o].charCodeAt(a)>=97&&s[o].charCodeAt(a)<=122){s[o]=s[o].replace(s[o][a],s[o][a].toUpperCase());break}r=s.join("-")}if(r.indexOf(",")>0){var l=r.split(",");for(o=0;o<l.length;o++)if(l[o][0])for(a=0;a<l[o].length;a++)if(l[o].charCodeAt(a)>=97&&l[o].charCodeAt(a)<=122){l[o]=l[o].replace(l[o][a],l[o][a].toUpperCase());break}r=l.join(",")}return r},e.prototype.ComputeSUMPRODUCT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r,n=0,i=0,o=null,a=e,s=0;s<a.length;++s){var l=a[s];if(l.startsWith(this.parent.tic)||!this.parent.isCellReference(l)){var d=this.parent.getValueFromArg(l);return r=d.indexOf('"'),this.parent.getErrorStrings().indexOf(d)>-1?d:r>-1?0:this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments]}var p=l.indexOf(":"),h=this.parent.rowIndex(l.substr(0,p)),c=this.parent.rowIndex(l.substr(p+1));if(!(-1!==h||-1===c)==(-1===h||-1!==c))return this.parent.getErrorStrings()[exports.CommonErrors.name];var u=this.parent.colIndex(l.substr(0,p)),g=this.parent.colIndex(l.substr(p+1));if(null===o)for(i=(c-h+1)*(g-u+1),o=[],p=0;p<i;++p)o[p]=1;p=0;for(var f=h;f<=c;++f)for(var m=u;m<=g;++m){var v=this.getSheetReference(l)+this.parent.convertAlpha(m)+f,C=this.parent.getValueFromArg(v);if(isNaN(parseFloat(C)))o[p]=0;else{if(isNaN(o[p]))return this.parent.getErrorStrings()[exports.CommonErrors.name];o[p]=o[p]*parseFloat(C)}p++}}for(p=0;p<i;++p)n+=o[p];return n},e.prototype.ComputeROUNDUP=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n,i,o,a,s=e.length;if(!ej2Base.isNullOrUndefined(e)&&s>2&&(r=this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments]),1===s&&""!==e[0])a=e[0].indexOf('"'),i="TRUE"===(i=(i=e[0].indexOf('"')>-1?e[0].replace('"',""):e[0]).indexOf('"')>-1?i.replace('"',""):i).toUpperCase()?"1":"FALSE"===i?"0":i,i=this.parent.getValueFromArg(i),(n=this.parent.parseFloat(i))>0?n+=.4999999999:n<0&&(n-=.4999999999),r=(n=this.parent.parseFloat(n.toFixed(0))).toString();else if(2===s&&""!==e[0]&&""!==e[1]){a=e[0].indexOf('"')>-1?e[0].indexOf('"'):e[1].indexOf('"')>-1?e[1].indexOf('"'):-1,i=(i=e[0].indexOf('"')>-1?e[0].replace('"',""):e[0]).indexOf('"')>-1?i.replace('"',""):i,o=(o=e[1].indexOf('"')>-1?e[1].replace('"',""):e[1]).indexOf('"')>-1?o.replace('"',""):o,i="TRUE"===i.toUpperCase()?"1":"FALSE"===i?"0":i,o="TRUE"===o.toUpperCase()?"1":"FALSE"===o?"0":o,i=this.parent.getValueFromArg(i),o=this.parent.getValueFromArg(o);var l=Math.ceil(this.parent.parseFloat(o));n=this.parent.parseFloat(i),l>0?(n>0?n+=.4999999999/Math.pow(10,l):n<0&&(n-=.4999999999/Math.pow(10,l)),r=(n=this.parent.parseFloat(n.toFixed(l))).toFixed(l),isNaN(n)&&(r=l.toString().indexOf('"')>-1?this.parent.getErrorStrings()[exports.CommonErrors.value]:this.parent.getErrorStrings()[exports.CommonErrors.name])):(n>0?n=n/Math.pow(10,-l)+.49999:n<0&&(n=n/Math.pow(10,-l)-.49999),r=(n=this.parent.parseFloat(n.toFixed(0))*Math.pow(10,-l)).toString(),isNaN(n)&&(r=l.toString().indexOf('"')>-1?this.parent.getErrorStrings()[exports.CommonErrors.value]:r=this.parent.getErrorStrings()[exports.CommonErrors.name]))}else r=a>-1?this.parent.getErrorStrings()[exports.CommonErrors.value]:this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];return r},e.prototype.ComputeCOUNT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];for(var r,n,i,o=e,a=0,s=0;s<o.length;s++)if((r=o[s]).indexOf(":")>-1&&this.parent.isCellReference(r)){n=this.parent.getCellCollection(r.split(this.parent.tic).join(""));for(var l=0;l<n.length;l++)i=this.parent.getValueFromArg(n[l]),isNaN(this.parent.parseFloat(i))||r.length>0&&""!==r&&" "!==r&&a++}else r=r.split(this.parent.tic).join(""),isNaN(this.parent.parseFloat(this.parent.getValueFromArg(r)))||r.length>0&&""!==r&&" "!==r&&a++;return a},e.prototype.ComputeDATE=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var r=e;if(3!==r.length)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];for(var n=0;n<r.length;++n)r[n]=this.parent.getValueFromArg(r[n]);r[0]="TRUE"===r[0].split(this.parent.tic).join("")?"1":"FALSE"===r[0].split(this.parent.tic).join("")?"0":r[0],r[1]="TRUE"===r[1].split(this.parent.tic).join("")?"1":"FALSE"===r[1].split(this.parent.tic).join("")?"0":r[1],r[2]="TRUE"===r[2].split(this.parent.tic).join("")?"1":"FALSE"===r[2].split(this.parent.tic).join("")?"0":r[2];var i=this.parent.parseFloat(r[0].split(this.parent.tic).join("")),o=this.parent.parseFloat(r[1].split(this.parent.tic).join("")),a=this.parent.parseFloat(r[2].split(this.parent.tic).join("")),s=0;if(isNaN(i)||isNaN(o)||isNaN(a))return this.parent.getErrorStrings()[exports.CommonErrors.value].toString();if(i<0)return this.parent.getErrorStrings()[exports.CommonErrors.num].toString();for(;o>12;)o-=12,i++;if(0===(s=this.parent.getSerialDateFromDate(i,o,a)))return this.parent.getErrorStrings()[exports.CommonErrors.num].toString();var l=this.parent.fromOADate(s);return"Invalid Date"!==l.toString()?l.getFullYear()+"/"+this.parent.calculateDate((l.getMonth()+1).toString())+"/"+this.parent.calculateDate(l.getDate().toString()):s.toString()},e.prototype.ComputeFLOOR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var r,n,i=e,o=i.length,a=i[1].split(this.parent.tic).join(""),s=[];if(2!==o)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];if(s.push(r=this.parent.parseFloat(this.parent.getValueFromArg(i[0].split(this.parent.tic).join("")))),i[1]=a===this.parent.trueValue?"1":a===this.parent.falseValue?"0":i[1],s.push(n=this.parent.parseFloat(this.parent.getValueFromArg(i[1].split(this.parent.tic).join("")))),r>0&&n<0)return this.parent.getErrorStrings()[exports.CommonErrors.num];if(r>0&&0===n)return this.parent.getErrorStrings()[exports.CommonErrors.divzero];for(var l=0;l<i.length;l++)if(i[l].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[exports.CommonErrors.value];return isNaN(r)?this.parent.getErrorStrings()[exports.CommonErrors.name]:Math.floor(r/n)*n},e.prototype.ComputeCEILING=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var r,n,i=e,o=[],a=i.length,s=i[1].split(this.parent.tic).join("");if(2!==a)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];if(o.push(r=this.parent.parseFloat(this.parent.getValueFromArg(i[0].split(this.parent.tic).join("")))),i[1]=s===this.parent.trueValue?"1":s===this.parent.falseValue?"0":i[1],o.push(n=this.parent.parseFloat(this.parent.getValueFromArg(i[1].split(this.parent.tic).join("")))),r>0&&n<0)return this.parent.getErrorStrings()[exports.CommonErrors.num];for(var l=0;l<i.length;l++)if(i[l].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[exports.CommonErrors.value];return isNaN(r)?this.parent.getErrorStrings()[exports.CommonErrors.name]:0===n?0:Math.ceil(r/n)*n},e.prototype.ComputeDAY=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n=e;if(ej2Base.isNullOrUndefined(n)||1===n.length&&""===n[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];if(n.length>1)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var i=this.parent.getValueFromArg(n[0].split(this.parent.tic).join(""));return isNaN(this.parent.parseFloat(i))?(r=this.parent.parseDate(i),"[object Date]"===Object.prototype.toString.call(r)&&(r=r.getDate()),r):this.parent.getErrorStrings()[exports.CommonErrors.name]},e.prototype.ComputeIF=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];if(this.parent.getErrorStrings().indexOf(e[0])>0)return e[0];var r,n=e;4===n.length&&"nestedFormulaTrue"===n[3]&&(r=!0,n.pop());var i,o;if(n.length>3||1===n.length)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];if(n.length<=3){if(i=this.parent.getValueFromArg(n[0]),this.parent.getErrorStrings().indexOf(i)>-1)return i;if(i===this.parent.trueValue||this.parent.parseFloat(i)>0||this.parent.parseFloat(i)<0)o=this.parent.getValueFromArg(n[1]);else{if(i!==this.parent.falseValue&&0!==this.parent.parseFloat(i))return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.requires_3_args];if(ej2Base.isNullOrUndefined(n[2]))return this.parent.falseValue;o=this.parent.getValueFromArg(n[2])}}return!r&&o.indexOf(this.parent.tic)>-1?o.split(this.parent.tic).join(""):o},e.prototype.ComputeIFERROR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var r,n=e;return 2!==n.length?this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments]:(r=this.parent.getValueFromArg(n[0]))===this.parent.trueValue||r===this.parent.falseValue?r:(r[0]===this.parent.arithMarker&&(r=r.replace(this.parent.arithMarker," ")),"#"===(r=this.parent.getValueFromArg(r).toUpperCase().split(this.parent.tic).join(""))[0]||r.indexOf("Infinity")>-1||this.parent.getErrorStrings().indexOf(r)>-1?this.parent.getValueFromArg(n[1]).split(this.parent.tic).join(""):r)},e.prototype.ComputePRODUCT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var r,n,i,o=1,a=!0;if(!ej2Base.isNullOrUndefined(e))for(var s=e,l=0;l<s.length;l++){var d=s[l];if(d.indexOf(":")>-1&&this.parent.isCellReference(d))for(var p=this.parent.getCellCollection(d),h=0;h<p.length;h++){if(r=this.parent.getValueFromArg(p[h].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(r)>-1)return r;r="TRUE"===r.split(this.parent.tic).join("")?"1":"FALSE"===r.split(this.parent.tic).join("")?"0":r,i=this.parent.parseFloat(r),isNaN(i)||r.length>0&&(o*=i,a=!1)}else{if(n=this.parent.getValueFromArg(s[l].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(n)>-1)return n;if(n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n,i=this.parent.parseFloat(n),isNaN(i)||n.length>0&&(o*=i,a=!1),this.parent.getErrorStrings().indexOf(n)>-1)return n}}return a?"0":o.toString()},e.prototype.ComputeDAYS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r;if(ej2Base.isNullOrUndefined(e)&&1===e.length&&""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];if(2!==e.length)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var n=e;n[0].split(this.parent.tic).join("")===this.parent.trueValue&&(n[0]="1"),n[0].split(this.parent.tic).join("")===this.parent.falseValue&&(n[0]="0");var i=this.parent.getValueFromArg(n[0].split(this.parent.tic).join("")),o=this.parent.getValueFromArg(n[1].split(this.parent.tic).join(""));if(o=""===o||null==o?new Date(Date.parse("1899-12-31")).toDateString():o,"#"===(i=""===i||null==i?new Date(Date.parse("1899-12-31")).toDateString():i)[0])return i;if("#"===o[0])return o;var a=this.parent.intToDate(i),s=this.parent.intToDate(o);return"#"===a.toString()[0]?a.toString():"#"===s.toString()[0]?s.toString():"[object Date]"!==Object.prototype.toString.call(a)||"[object Date]"!==Object.prototype.toString.call(s)?this.parent.getErrorStrings()[exports.CommonErrors.value]:(r=Math.ceil(a.getTime()-s.getTime())/864e5,Math.round(r))},e.prototype.ComputeUNIQUE=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n=e;if(ej2Base.isNullOrUndefined(e)||""===e[0]||n.length>3)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var i=n[1]?n[1].toUpperCase():"FALSE",o=n[2]?n[2].toUpperCase():"FALSE",a=[];if(n[0].indexOf(":")>-1){if(ej2Base.isNullOrUndefined(n[0].match(/[0-9]/))){var s=n[0].split(":");n[0]=s[0]+"1:"+s[1]+(this.parent.spreadSheetUsedRange[0]+1)}else if(ej2Base.isNullOrUndefined(n[0].toUpperCase().match(/[A-Z]/))){s=n[0].split(":");n[0]="A"+s[0]+":"+getAlphalabel(this.parent.spreadSheetUsedRange[1]+1)+s[1]}var l=n[0].split(":");if(this.parent.isCellReference(l[0])&&this.parent.isCellReference(l[1])){for(var d=this.parent.dependencyCollection,p=0;p<d.length;p++)d[p].split(":")[0]===n[0].split(":")[0]&&this.clearDependency(d[p]);-1===this.parent.dependencyCollection.indexOf(n[0])?this.parent.dependencyCollection.push(n[0]):this.clearDependency(n[0]);var h=n[0].indexOf(":"),c=void 0,u=this.parent.rowIndex(this.parent.substring(n[0],0,h)),g=this.parent.colIndex(this.parent.substring(n[0],0,h)),f=this.parent.rowIndex(this.parent.substring(n[0],h+1,h+n[0].length-h-1)),m=this.parent.colIndex(this.parent.substring(n[0],h+1,h+n[0].length-h-1));u>f&&(c=f,f=u,u=c),g>m&&(c=m,m=g,g=c);var v="";0===n[0].indexOf("!")&&(v=n[0].substring(0,n[0].replace("!","").indexOf("!")+2)),n[0]=v+getAlphalabel(g)+u+":"+getAlphalabel(m)+f;var C=this.parent.getCellCollection(n[0]),y=m-g,x=[];for(p=0;p<C.length;p++)x.push(C[p]);if("FALSE"===i)if(0===y)for(p=0;p<x.length;p++){R=""===(R=this.parent.getValueFromArg(x[p]))?"0":R,a.push(R)}else{var b="",S=y;for(p=0;p<x.length;p++){if(p===x.length-1){b=b+(R=""===(R=this.parent.getValueFromArg(x[p]))?"0":R)+"+",a.push(b.substring(0,b.length-1))}if(p<=S){b=b+(R=""===(R=this.parent.getValueFromArg(x[p]))?"0":R)+"+"}else{a.push(b.substring(0,b.length-1)),S=y+p;b=(R=""===(R=this.parent.getValueFromArg(x[p]))?"0":R)+"+"}}}else{b="",S=y+1;var w=f-u;for(p=0;p<S;p++){for(var I=0;I<=w;I++){var R;b=b+(R=""===(R=this.parent.getValueFromArg(x[I*S+p]))?"0":R)+"+"}a.push(b.substring(0,b.length-1)),b=""}}var E=[],k=[];for(p=0;p<a.length;p++)-1===E.indexOf(a[p])?E.push(a[p]):k.push(a[p]);if("TRUE"===o){var F=[];for(p=0;p<E.length;p++)-1===k.indexOf(E[p])&&F.push(E[p]);E=F}var A=this.parent.actCell;A=A.indexOf("!")>-1?A.split("!")[1]:A;var B=this.parent.rowIndex(A),T=this.parent.colIndex(A);if(0===this.parent.dependencyLevel)if("FALSE"===i){for(p=B,S=E.length+B;p<S;p++)for(var D=T,N=(L=E[0].split("+")).length+T;D<N;D++)if(p===S-1&&D===N-1&&-1===this.parent.uniqueRange.indexOf(this.parent.actCell+":"+getAlphalabel(D)+p)&&this.parent.uniqueRange.push(this.parent.actCell+":"+getAlphalabel(D)+p),this.checkSpill(D,p))return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.spill]}else for(p=T,S=E.length+T;p<S;p++){var O=B;for(N=(L=E[0].split("+")).length+B;O<N;O++)if(p===S-1&&O===N-1&&-1===this.parent.uniqueRange.indexOf(this.parent.actCell+":"+getAlphalabel(p)+O)&&this.parent.uniqueRange.push(this.parent.actCell+":"+getAlphalabel(p)+O),this.checkSpill(p,O))return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.spill]}else if(this.parent.dependencyLevel>0&&this.parent.getValueFromArg(getAlphalabel(T)+B,!0).indexOf("#SPILL!")>-1)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.spill];if("FALSE"===i){for(p=0;p<E.length;p++){var L=E[p].split("+");p>0&&(B++,T=this.parent.colIndex(A));for(var H=0;H<L.length;H++)this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,L[H],B,T),L[H+1]&&T++}r=E[0].split("+")[0]}else{for(p=0;p<E.length;p++){L=E[p].split("+");for(var j=0;j<L.length;j++)this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,L[j],B,T),L[j+1]?B++:(T++,B=this.parent.rowIndex(A))}r=E[0].split("+")[0]}}}else this.parent.isCellReference(n[0])&&(-1===this.parent.dependencyCollection.indexOf(n[0])?this.parent.dependencyCollection.push(n[0]):this.clearDependency(n[0]),r=this.parent.getValueFromArg(n[0]));return r},e.prototype.checkSpill=function(e,t){var r,n=!1,i=this.parent.getValueFromArg(getAlphalabel(e)+t,!0),o="!"+this.parent.getSheetID(this.parent.grid)+"!"+getAlphalabel(e)+t;return this.parent.getFormulaInfoTable().get(o)&&(r=this.parent.getFormulaInfoTable().get(o).formulaText),i&&(i.indexOf("UNIQUE")<0||r&&!r.toUpperCase().includes("UNIQUE"))&&i!==this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments]&&!this.parent.skipSpill&&(n=!0),n},e.prototype.clearDependency=function(e){var t=this.parent.actCell;t=t.indexOf("!")>-1?t.split("!")[1]:t;for(var r=this.parent.rowIndex(t),n=this.parent.colIndex(t),i=e.indexOf(":"),o=this.parent.rowIndex(this.parent.substring(e,0,i)),a=this.parent.colIndex(this.parent.substring(e,0,i)),s=this.parent.rowIndex(this.parent.substring(e,i+1,i+e.length-i-1))-o+r,l=this.parent.colIndex(this.parent.substring(e,i+1,i+e.length-i-1))-a+n,d=this.parent.getFormulaInfoTable().get("!"+this.parent.getSheetID(this.parent.grid)+"!"+t)?this.parent.getFormulaInfoTable().get("!"+this.parent.getSheetID(this.parent.grid)+"!"+t).getFormulaText():"",p=r;p<=s;p++)for(var h=n;h<=l;h++)if(this.parent.dependencyLevel>0||d.indexOf("UNIQUE")>-1){if(this.parent.getValueFromArg("!"+this.parent.getSheetID(this.parent.grid)+"!"+getAlphalabel(n)+r,!0).indexOf("#SPILL!")>-1)return;this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,null,p,h)}},e.prototype.ComputeT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r="";if(ej2Base.isNullOrUndefined(e)||1!==e.length||""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var n=e[0];n=n.indexOf(":")>-1?n.split(":")[0]:n;return null===(n=this.parent.getValueFromArg(n)).match(/^[0-9.]+$/)&&"TRUE"!==n.toUpperCase()&&"FALSE"!==n.toUpperCase()&&(r=n),r},e.prototype.ComputeHOUR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1!==e.length||ej2Base.isNullOrUndefined(e))return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];if(""===e[0])return this.parent.getErrorStrings()[exports.CommonErrors.value];if(!this.parent.isCellReference(e[0])&&-1===e[0].indexOf(this.parent.tic))return this.parent.getErrorStrings()[exports.CommonErrors.value];var r=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");r=this.parent.intToTime(r);var n=new Date(Date.parse(r));if(parseInt(r,10)<0)return this.parent.getErrorStrings()[exports.CommonErrors.num];if("Invalid Date"===n.toString()){var i=new Date(Date.now()).toLocaleDateString()+" "+r;n=new Date(Date.parse(i))}return"Invalid Date"===n.toString()&&(n=this.parent.fromOADate(parseInt(r,10))),"Invalid Date"===n.toString()?this.parent.getErrorStrings()[exports.CommonErrors.value]:n.getHours()},e.prototype.ComputeMINUTE=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1!==e.length||ej2Base.isNullOrUndefined(e))return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];if(""===e[0])return this.parent.getErrorStrings()[exports.CommonErrors.value];if(!this.parent.isCellReference(e[0])&&-1===e[0].indexOf(this.parent.tic))return this.parent.getErrorStrings()[exports.CommonErrors.value];var r=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");r=this.parent.intToTime(r);var n=new Date(Date.parse(r));if(parseInt(r,10)<0)return this.parent.getErrorStrings()[exports.CommonErrors.num];if("Invalid Date"===n.toString()){var i=new Date(Date.now()).toLocaleDateString()+" "+r;n=new Date(Date.parse(i))}return"Invalid Date"===n.toString()&&(n=this.parent.fromOADate(parseInt(r,10))),"Invalid Date"===n.toString()?this.parent.getErrorStrings()[exports.CommonErrors.value]:n.getMinutes()},e.prototype.ComputeSECOND=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1!==e.length||ej2Base.isNullOrUndefined(e))return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];if(!this.parent.isCellReference(e[0])&&-1===e[0].indexOf(this.parent.tic))return this.parent.getErrorStrings()[exports.CommonErrors.value];if(""===e[0])return this.parent.getErrorStrings()[exports.CommonErrors.value];var r=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");r=this.parent.intToTime(r);var n=new Date(Date.parse(r));if(parseInt(r,10)<0)return this.parent.getErrorStrings()[exports.CommonErrors.num];if("Invalid Date"===n.toString()){var i=new Date(Date.now()).toLocaleDateString()+" "+r;n=new Date(Date.parse(i))}return"Invalid Date"===n.toString()&&(n=this.parent.fromOADate(parseInt(r,10))),"Invalid Date"===n.toString()?this.parent.getErrorStrings()[exports.CommonErrors.value]:n.getSeconds()},e.prototype.ComputeMONTH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(""===e[0])return this.parent.getErrorStrings()[exports.CommonErrors.value];if(1!==e.length||ej2Base.isNullOrUndefined(e))return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];if(!this.parent.isCellReference(e[0])&&-1===e[0].indexOf(this.parent.tic))return this.parent.getErrorStrings()[exports.CommonErrors.value];var r=this.spreadsheetFormat(e[0]),n=this.spreadsheetDisplayText(e[0]),i=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join(""),o=this.parseDouble(i),a=0,s=new Date(Date.parse(i));!isNaN(o)&&s.getFullYear()>9999&&(s=this.parent.fromOADate(o));var l=parseInt(i,10);return l<0?this.parent.getErrorStrings()[exports.CommonErrors.num]:(0===l&&i!==r&&r.indexOf("h:mm")>-1&&(s=this.parent.fromOADate(parseInt(n,10))),"Invalid Date"===s.toString()&&(s=this.parent.fromOADate(parseInt(i,10))),"Invalid Date"===s.toString()?this.parent.getErrorStrings()[exports.CommonErrors.value]:("Invalid Date"!==s.toString()&&(a=s.getMonth()+1),a.toString()))},e.prototype.ComputeNOW=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1!==e.length||""!==e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var r=new Date(Date.now());return(new ej2Base.Internationalization).getDateFormat({skeleton:"short",type:"dateTime"})(r)},e.prototype.ComputeEXACT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=!1;if(ej2Base.isNullOrUndefined(e)||2!==e.length)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var n=this.parent.getValueFromArg(e[1]).split(this.parent.tic).join("");return this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("")===n&&(r=!0),r},e.prototype.ComputeLEN=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1!==e.length)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];if(""===e[0])return this.parent.getErrorStrings()[exports.CommonErrors.value];var r=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");return"#NAME?"===r?this.parent.getErrorStrings()[exports.CommonErrors.name]:r.length},e.prototype.ComputeMOD=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||2!==e.length)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var r=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join(""),n=this.parent.getValueFromArg(e[1]).split(this.parent.tic).join("");if(""===n||"0"===n)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.div];if(""===r||"0"===r)return"0";if("#NAME?"===r||"#NAME?"===n)return this.parent.getErrorStrings()[exports.CommonErrors.name];if(r.toUpperCase().match(/[A-Z]/)||n.toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[exports.CommonErrors.value];var i=parseFloat(r.replace("-",""))%parseFloat(n);return parseFloat(n)<0&&(i*=-1),isNaN(i)?this.parent.getErrorStrings()[exports.CommonErrors.name]:i},e.prototype.ComputeODD=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(""===e[0])return this.parent.getErrorStrings()[exports.CommonErrors.value];if(ej2Base.isNullOrUndefined(e)||1!==e.length)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var r=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");if("#NAME?"===r)return this.parent.getErrorStrings()[exports.CommonErrors.name];if(""===r)r="0";else if(r.toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[exports.CommonErrors.value];var n=Math.ceil(parseInt(r,10)),i=0===n;return n=n%2==0?n>0?n+1:n-1:n,Math.ceil(parseInt(r,10))%2!=0&&(parseInt(r,10)>0&&parseFloat(r)>parseInt(r,10)?n+=2:parseInt(r,10)<0&&parseFloat(r)<parseInt(r,10)&&(n-=2)),isNaN(n)?this.parent.getErrorStrings()[exports.CommonErrors.name]:i?1:n},e.prototype.ComputeEVEN=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1!==e.length)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];if(""===e[0])return this.parent.getErrorStrings()[exports.CommonErrors.value];var r=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");if("#NAME?"===r)return this.parent.getErrorStrings()[exports.CommonErrors.name];if(""===r)r="0";else if(r.toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[exports.CommonErrors.value];var n=Math.ceil(parseFloat(r));return n=n%2==0?n:n>0?n+1:n-1,Math.ceil(parseFloat(r))%2==0&&(parseInt(r,10)>0&&parseFloat(r)>parseInt(r,10)?n+=2:parseInt(r,10)<0&&parseFloat(r)<parseInt(r,10)&&(n-=2)),isNaN(n)?this.parent.getErrorStrings()[exports.CommonErrors.name]:n},e.prototype.ComputePI=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e&&""!==e[0]?this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments]:Math.PI},e.prototype.ComputeMEDIAN=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r;if(ej2Base.isNullOrUndefined(e)||""===e[0]||1!==e.length)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];for(var n=this.parent.getCellCollection(e[0]),i=[],o=0;o<n.length;o++)i.push(parseInt(this.parent.getValueFromArg(n[o]).split(this.parent.tic).join(""),10));for(var a=(i=i.sort(function(e,t){return e-t})).length,s=0;s<a&&(!isNaN(i[s])||(i.splice(s,1),s--,0!==i.length));s++);if(i.length%2!=0&&i[parseInt((i.length/2).toString(),10)])r=i[parseInt((i.length/2).toString(),10)];else{if(isNaN(i[i.length/2])||isNaN(i[i.length/2-1]))return this.parent.getErrorStrings()[exports.CommonErrors.num];r=(i[i.length/2]+i[i.length/2-1])/2}return r},e.prototype.ComputeEDATE=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n;if(2!==e.length||ej2Base.isNullOrUndefined(e))return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];if(""===e[0])return this.parent.getErrorStrings()[exports.CommonErrors.value];var i=this.parent.getValueFromArg(e[0]);return n=this.parent.getValueFromArg(e[1]),n=parseInt(n,10),isNaN(n)?this.parent.getErrorStrings()[exports.CommonErrors.num]:(r=isNaN(parseInt(i,10))?new Date(Date.parse(i)):this.parent.fromOADate(parseInt(i,10)),ej2Base.isNullOrUndefined(this.parent.isDate(r))?this.parent.getErrorStrings()[exports.CommonErrors.value]:new Date(r.setMonth(r.getMonth()+n)).toLocaleDateString())},e.prototype.ComputeDATEVALUE=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n;return 1!==e.length||ej2Base.isNullOrUndefined(e)?this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments]:""===e[0]||this.parent.isCellReference(e[0])?this.parent.getErrorStrings()[exports.CommonErrors.value]:-1===e[0].indexOf(this.parent.tic)?this.parent.getErrorStrings()[exports.CommonErrors.value]:(n=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join(""),r=isNaN(parseInt(n,10))?new Date(Date.parse(n)):this.parent.fromOADate(parseInt(n,10)),ej2Base.isNullOrUndefined(this.parent.isDate(r))||5!==parseInt(n,10).toString().length?this.parent.getErrorStrings()[exports.CommonErrors.value]:this.parent.isDate(n)&&4!==this.parent.isDate(n).getFullYear().toString().length?this.parent.getErrorStrings()[exports.CommonErrors.value]:parseFloat(n).toFixed(0).toString())},e.prototype.ComputeCOUNTBLANK=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=0;if(1!==e.length||ej2Base.isNullOrUndefined(e)||!this.parent.isCellReference(e[0]))return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];if(""===e[0])return this.parent.getErrorStrings()[exports.CommonErrors.value];for(var n=this.parent.getCellCollection(e[0]),i=0;i<n.length;i++)""===this.parent.getValueFromArg(n[i])&&r++;return r},e.prototype.ComputeFACT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=1;if(ej2Base.isNullOrUndefined(e)||1!==e.length)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];if(""===e[0])return this.parent.getErrorStrings()[exports.CommonErrors.value];var n=parseInt(this.parent.getValueFromArg(e[0]).split(this.parent.tic).join(""),10);if(this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("").toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[exports.CommonErrors.value];if(n<0)return this.parent.getErrorStrings()[exports.CommonErrors.num];for(var i=1;i<=n;i++)r*=i;return r},e.prototype.ComputeDECIMAL=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r;if(ej2Base.isNullOrUndefined(e)||2!==e.length)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var n=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join(""),i=this.parent.getValueFromArg(e[1]).split(this.parent.tic).join("");return""===n&&""!==i?0:""!==n&&""===i?this.parent.getErrorStrings()[exports.CommonErrors.value]:isNaN(parseInt(i,10))?this.parent.getErrorStrings()[exports.CommonErrors.value]:(r=parseInt(n,parseInt(i,10)),isNaN(r)?this.parent.getErrorStrings()[exports.CommonErrors.name]:r)},e.prototype.ComputeDEGREES=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r;if(ej2Base.isNullOrUndefined(e)||1!==e.length||""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var n=Math.PI,i=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");return i.toUpperCase().match(/[A-Z]/)?this.parent.getErrorStrings()[exports.CommonErrors.value]:isNaN(parseInt(i,10))?this.parent.getErrorStrings()[exports.CommonErrors.value]:(r=parseFloat(i)*(180/n),parseInt(r.toString(),10))},e.prototype.ComputeADDRESS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r;if(ej2Base.isNullOrUndefined(e)||e.length>5||""===e[0]||""===e[1]||e.length<2)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];e[2]=e[2]?e[2]:"1",e[3]=e[3]?e[3]:"TRUE";var n=this.parent.getValueFromArg(e[0]),i=this.parent.getValueFromArg(e[1]),o=this.parent.getValueFromArg(e[2]),a=this.parent.getValueFromArg(e[3]);if(o=o.split(this.parent.tic).join(""),a=a.split(this.parent.tic).join(""),n=n.split(this.parent.tic).join(""),i=i.split(this.parent.tic).join(""),parseInt(n,10)<=0||parseInt(i,10)<=0)return this.parent.getErrorStrings()[exports.CommonErrors.value];if(n.toUpperCase().match(/[A-Z]/)||i.toUpperCase().match(/[A-Z]/)||o.toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[exports.CommonErrors.value];"TRUE"===a||"1"===a?"1"===o?r="$"+getAlphalabel(parseInt(i,10))+"$"+parseInt(n,10):"2"===o?r=getAlphalabel(parseInt(i,10))+"$"+parseInt(n,10):"3"===o?r="$"+getAlphalabel(parseInt(i,10))+parseInt(n,10):"4"===o&&(r=getAlphalabel(parseInt(i,10))+parseInt(n,10)):"FALSE"!==a&&"0"!==a||("1"===o?r="R"+parseInt(n,10)+"C"+parseInt(i,10):"2"===o?r="R"+parseInt(n,10)+"C["+parseInt(i,10)+"]":"3"===o?r="R["+parseInt(n,10)+"]C"+parseInt(i,10):"4"===o&&(r="R["+parseInt(n,10)+"]C["+parseInt(i,10)+"]"));if(-1===["TRUE","FALSE","1","0"].indexOf(a))return this.parent.getErrorStrings()[exports.CommonErrors.name];if(!ej2Base.isNullOrUndefined(e[4])&&""!==e[4]){var s=this.parent.getValueFromArg(e[4]).split(this.parent.tic).join("");if("#NAME?"===s)return this.parent.getErrorStrings()[exports.CommonErrors.name];r=s+"!"+r}return r},e.prototype.ComputeTIME=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||3!==e.length||""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var r=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join(""),n=this.parent.getValueFromArg(e[1]).split(this.parent.tic).join(""),i=this.parent.getValueFromArg(e[2]).split(this.parent.tic).join("");if("#NAME?"===r||"#NAME?"===n||"#NAME?"===i)return this.parent.getErrorStrings()[exports.CommonErrors.name];if(r=parseInt(r,10),n=parseInt(n,10),i=parseInt(i,10),isNaN(r)||isNaN(n)||isNaN(i))return this.parent.getErrorStrings()[exports.CommonErrors.name];if(r.toString().toUpperCase().match(/[A-Z]/)||n.toString().toUpperCase().match(/[A-Z]/)||i.toString().toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[exports.CommonErrors.value];if(r>32767||n>32767||i>32767)return this.parent.getErrorStrings()[exports.CommonErrors.num];var o=new Date(1900,0,1,r,n,i),a=o.getHours(),s=o.getMinutes(),l="AM",d=a;return d>=12&&(d=a-12,l="PM"),0===d&&(d=12),s=s<10?"0"+s:s,(d=d<10?"0"+d:d)+":"+s+" "+l},e.prototype.ComputeCHAR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1!==e.length||""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var r=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");if("#NAME?"===r)return this.parent.getErrorStrings()[exports.CommonErrors.name];if(!r.toUpperCase().match(/^[0-9]+$/))return this.parent.getErrorStrings()[exports.CommonErrors.value];var n=parseInt(r,10);return n>255||n<=0?this.parent.getErrorStrings()[exports.CommonErrors.value]:String.fromCharCode(n)},e.prototype.ComputeCODE=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1!==e.length||""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var r=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");return"#NAME?"===r?this.parent.getErrorStrings()[exports.CommonErrors.name]:""===r?this.parent.getErrorStrings()[exports.CommonErrors.value]:r.charCodeAt(0)},e.prototype.ComputeDOLLAR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||2!==e.length||""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];var r=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join(""),n=this.parent.getValueFromArg(e[1]).split(this.parent.tic).join("");if(r=""===r?"0":r,n=""===n?"0":n,"#NAME?"===r)return this.parent.getErrorStrings()[exports.CommonErrors.name];if(!r.toUpperCase().match(/^[0-9.]+$/)||!n.toUpperCase().match(/^[0-9.]+$/))return this.parent.getErrorStrings()[exports.CommonErrors.value];return(new ej2Base.Internationalization).formatNumber(parseFloat(parseFloat(r).toFixed(parseInt(n,10))),{format:"$#,##.00"})},e.prototype.ComputeSMALL=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||""===e[0]||2!==e.length)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];for(var r=this.parent.getCellCollection(e[0]),n=[],i=0;i<r.length;i++)n.push(parseFloat(this.parent.getValueFromArg(r[i]).split(this.parent.tic).join("")));for(var o=(n=n.sort(function(e,t){return e-t})).length,a=0;a<o&&(!isNaN(n[a])||(n.splice(a,1),a--,0!==n.length));a++);var s=this.parent.getValueFromArg(e[1]).split(this.parent.tic).join("");return"#NAME?"===s?this.parent.getErrorStrings()[exports.CommonErrors.name]:(s=parseInt(s,10)).toString().toUpperCase().match(/^[0-9]+$/)&&n[s-1]&&n[s-1].toString().toUpperCase().match(/^[-.0-9]+$/)&&0!==s?n[s-1]:ej2Base.isNullOrUndefined(n[s-1])?this.parent.getErrorStrings()[exports.CommonErrors.num]:this.parent.getErrorStrings()[exports.CommonErrors.value]},e.prototype.ComputeLARGE=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||2!==e.length||""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];for(var r=this.parent.getCellCollection(e[0]),n=[],i=0;i<r.length;i++)n.push(parseFloat(this.parent.getValueFromArg(r[i]).split(this.parent.tic).join("")));for(var o=(n=n.sort(function(e,t){return t-e})).length,a=0;a<o&&(!isNaN(n[a])||(n.splice(a,1),a--,0!==n.length));a++);var s=this.parent.getValueFromArg(e[1]).split(this.parent.tic).join("");return"#NAME?"===s?this.parent.getErrorStrings()[exports.CommonErrors.name]:(s=parseInt(s,10)).toString().toUpperCase().match(/^[0-9]+$/)&&n[s-1]&&n[s-1].toString().toUpperCase().match(/^[-.0-9]+$/)&&0!==s?n[s-1]:ej2Base.isNullOrUndefined(n[s-1])?this.parent.getErrorStrings()[exports.CommonErrors.num]:this.parent.getErrorStrings()[exports.CommonErrors.value]},e.prototype.ComputeCHOOSE=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];if(e.length<2)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var r=e;if(r[0].indexOf(":")>-1&&this.parent.isCellReference(r[0])){if(1!==(a=this.parent.getCellCollection(r[0])).length)return this.parent.getErrorStrings()[exports.CommonErrors.value];r[0]=a[0]}var n=this.parent.getValueFromArg(r[0]);if(this.parent.getErrorStrings().indexOf(n)>-1)return n;var i=this.parent.parseFloat(this.parent.getValueFromArg(r[0].split(this.parent.tic).join("")));if(i<1)return this.parent.getErrorStrings()[exports.CommonErrors.value];i=Math.floor(i);var o;if(ej2Base.isNullOrUndefined(r[i]))return this.parent.getErrorStrings()[exports.CommonErrors.value];if(""===(o=r[i])&&(o="0"),o.indexOf(":")>-1&&this.parent.isCellReference(o)){var a;if(1!==(a=this.parent.getCellCollection(r[0].split(this.parent.tic).join(""))).length)return this.parent.getErrorStrings()[exports.CommonErrors.value];r[0]=a[0]}return this.parent.getValueFromArg(o).split(this.parent.tic).join("")},e.prototype.ComputeSUMIF=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e;if(r[0].indexOf(":")<0&&!this.parent.isCellReference(r[0])||r[2]&&r[2].indexOf(":")<0&&!this.parent.isCellReference(r[2]))return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.improper_formula];if(r.length>3||r.length<2)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var n=this.parent.computeSumIfAndAvgIf(e);return"string"==typeof n&&(this.parent.formulaErrorStrings.indexOf(n)||this.parent.getErrorStrings().indexOf(n))?n:n[0]},e.prototype.ComputeABS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n=e,i="";if(0===e.length||e.length>1)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];if(""===n[0].toString().split(this.parent.tic).join("").trim()||n[0].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[exports.CommonErrors.value];if(this.parent.isCellReference(n[0])){if(""===(i=this.parent.getValueFromArg(n[0])))return this.parent.getErrorStrings()[exports.CommonErrors.name];if(r=this.parent.parseFloat(i),isNaN(r))return this.parent.getErrorStrings()[exports.CommonErrors.value]}else if(r=this.parent.parseFloat(n[0]),isNaN(r))return this.parent.getErrorStrings()[exports.CommonErrors.name];return Math.abs(r)},e.prototype.ComputeAVERAGE=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];for(var r=e,n=0;n<r.length;n++)if(r[n].indexOf(":")>-1&&r[n].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[exports.CommonErrors.value];return this.parent.calculateAvg(r)},e.prototype.ComputeAVERAGEIF=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e;if(r[0].indexOf(":")<0&&!this.parent.isCellReference(r[0]))return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.improper_formula];var n=this.parent.computeSumIfAndAvgIf(e);return"string"==typeof n&&(this.parent.formulaErrorStrings.indexOf(n)||this.parent.getErrorStrings().indexOf(n))?n:this.parent.parseFloat(n[0])/this.parent.parseFloat(n[1])},e.prototype.ComputeCONCATENATE=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_arguments];for(var r=e,n="",i="",o=0;o<r.length;o++){if(r[o].indexOf(":")>-1&&this.parent.isCellReference(r[o])){if(!this.isConcat)return this.parent.getErrorStrings()[exports.CommonErrors.value];for(var a=this.parent.getCellCollection(r[o]),s=0;s<a.length;s++)n+=i=this.parent.getValueFromArg(a[s])}else{if(1===r.length&&r[0].indexOf(this.parent.tic)<0)return this.parent.getErrorStrings()[exports.CommonErrors.name];n+=i=this.parent.getValueFromArg(r[o])}if(this.parent.getErrorStrings().indexOf(i)>-1)return i}return n.split(this.parent.tic).join("")},e.prototype.ComputeCONCAT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.isConcat=!0,this.ComputeCONCATENATE.apply(this,e)},e.prototype.ComputeMAX=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeMinMax(e,"max")},e.prototype.ComputeMIN=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeMinMax(e,"min")},e.prototype.ComputeRAND=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===e.length&&""===e[0]&&(e.length=0),e.length>0?this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments]:Math.random().toString()},e.prototype.ComputeAND=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeAndOr(e,"and")},e.prototype.ComputeOR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeAndOr(e,"or")},e.prototype.ComputeFIND=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var r=e;if(r.length>3)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var n=this.parent.removeTics(this.parent.getValueFromArg(r[0])),i=this.parent.removeTics(this.parent.getValueFromArg(r[1]));if(this.parent.getErrorStrings().indexOf(n)>-1||this.parent.getErrorStrings().indexOf(i)>-1)return this.parent.getErrorStrings()[exports.CommonErrors.name];var o=1;if(3===r.length){if(o=this.parent.removeTics(this.parent.getValueFromArg(r[2])),this.parent.getErrorStrings().indexOf(o)>-1)return o;o=this.parent.parseFloat(o),isNaN(o)&&(o=1)}if(o<=0||o>i.length)return this.parent.getErrorStrings()[exports.CommonErrors.value];var a=i.indexOf(n,o-1);return a<0?this.parent.getErrorStrings()[exports.CommonErrors.value]:(Number(a)+Number(1)).toString()},e.prototype.ComputeINDEX=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e,n=r.length;if(ej2Base.isNullOrUndefined(e)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];if(n>3)return this.parent.getErrorStrings()[exports.CommonErrors.ref];var i="",o=[];if(n>2)for(var a=0;a<n;a++){if(this.parent.isCellReference(r[a])&&r[a].indexOf(":")<0)return this.parent.getErrorStrings()[exports.CommonErrors.ref];this.parent.isCellReference(r[a])&&(o[a]=r[a])}if(i=r[0],r[1]=""===r[1]?"1":r[1],r[1]=this.parent.getValueFromArg(r[1]),this.parent.getErrorStrings().indexOf(r[1])>-1)return r[1];if(!ej2Base.isNullOrUndefined(r[2])){if(r[2]=""===r[2]?"1":r[2],r[2]=this.parent.getValueFromArg(r[2]),this.parent.getErrorStrings().indexOf(r[2])>-1)return r[2];if("0"===r[2])return this.parent.getErrorStrings()[exports.CommonErrors.value]}var s=parseFloat(r[1]);s=isNaN(s)?-1:s;var l=parseFloat(r[2]?r[2]:"1");if(l=isNaN(l)?-1:l,-1===s||-1===l)return this.parent.getErrorStrings()[exports.CommonErrors.value];var d=r[0].indexOf(":"),p=this.parent.rowIndex(i.substring(0,d)),h=this.parent.rowIndex(i.substring(d+1)),c=this.parent.colIndex(i.substring(0,d)),u=this.parent.colIndex(i.substring(d+1));if(s>h-p+1||l>u-c+1)return this.parent.getErrorStrings()[exports.CommonErrors.ref];s=p+s-1,l=c+l-1;var g=this.getSheetReference(i)+this.parent.convertAlpha(l)+s,f=this.parent.getValueFromArg(g);return""===f?0:f},e.prototype.getSheetReference=function(e){return 0===e.indexOf(this.parent.sheetToken)&&e.lastIndexOf(this.parent.sheetToken)>e.indexOf(this.parent.sheetToken)?e.substring(0,e.lastIndexOf(this.parent.sheetToken)+1):""},e.prototype.ComputeIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e;if(ej2Base.isNullOrUndefined(e)||1===r.length&&""===r[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];for(var n="",i="",o=0;o<r.length;o++){if((n=this.parent.getValueFromArg(r[o]))!==this.parent.trueValue&&n!==this.parent.falseValue)return this.parent.getErrorStrings()[exports.CommonErrors.value];if(n===this.parent.trueValue)return r[o+1].indexOf(this.parent.arithMarker)>-1?this.parent.trueValue:(i=this.parent.isCellReference(r[o+1].split(this.parent.tic).join(""))?this.parent.getValueFromArg(r[o+1]):r[o+1].indexOf(this.parent.tic)>-1?r[o+1].split(this.parent.tic).join(""):this.parent.getErrorStrings()[exports.CommonErrors.name],o+=1,i);n===this.parent.falseValue&&(o+=1)}return this.parent.getErrorStrings()[exports.CommonErrors.na]},e.prototype.ComputeCOUNTA=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];for(var r,n=e,i=0,o=0;o<n.length;o++)if(n[o].indexOf(":")>-1&&this.parent.isCellReference(n[o])){r=this.parent.getCellCollection(n[o].split(this.parent.tic).join(""));for(var a=0;a<r.length;a++)this.parent.getValueFromArg(r[a]).length>0&&i++}else{this.parent.getValueFromArg(n[o].split(this.parent.tic).join("")).length>0&&i++}return i},e.prototype.ComputeAVERAGEA=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(ej2Base.isNullOrUndefined(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];for(var r,n,i,o=e,a=0,s=0,l=0;l<o.length;l++){if(o[l].indexOf(":")>-1&&this.parent.isCellReference(o[l])){r=this.parent.getCellCollection(o[l].split(this.parent.tic).join(""));for(var d=0;d<r.length;d++)if((n=this.parent.getValueFromArg(r[d])).toUpperCase()===this.parent.trueValue)n="1";else if(n.toUpperCase()===this.parent.falseValue||""===n)n="0";else{if(this.parent.getErrorStrings().indexOf(n)>-1)return n;n.length>0&&(i=parseFloat(n),a+=n=isNaN(i)?0:i,s+=1)}s=r.length}else{if(o[l]===this.parent.trueValue&&(o[l]="1"),o[l]!==this.parent.falseValue&&""!==o[l]||(o[l]="0"),n=this.parent.getValueFromArg(o[l].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(n)>-1)return n;n.length>0&&(i=parseFloat(n),a+=n=isNaN(i)?0:i,s+=1)}if(0===s)return this.parent.getErrorStrings()[exports.CommonErrors.divzero]}return a/s},e.prototype.ComputeSORT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n=e;if(ej2Base.isNullOrUndefined(e)||""===e[0]||n.length>4)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];n[1]=n[1]?n[1]:"1",n[2]=n[2]?n[2]:"1";var i="1"===n[2]?"Ascending":"Descending";n[3]=n[3]?n[3].toUpperCase():"FALSE",n[0]=n[0].split("$").join("");var o,a=[];if(n[0].indexOf(":")>-1){var s=n[0].split(":");if(this.parent.isCellReference(s[0])&&this.parent.isCellReference(s[1])){var l=n[0].indexOf(":"),d=void 0,p=this.parent.rowIndex(this.parent.substring(n[0],0,l)),h=this.parent.colIndex(this.parent.substring(n[0],0,l)),c=this.parent.rowIndex(this.parent.substring(n[0],l+1,l+n[0].length-l-1)),u=this.parent.colIndex(this.parent.substring(n[0],l+1,l+n[0].length-l-1));if(p>c&&(d=c,c=p,p=d),h>u&&(d=u,u=h,h=d),n[2]=this.parent.getValueFromArg(n[2]),"1"!==n[2]&&"-1"!==n[2])return this.parent.getErrorStrings()[exports.CommonErrors.value];if(!isNaN(this.parseDouble(n[1]))&&this.parseDouble(n[1])<1)return this.parent.getErrorStrings()[exports.CommonErrors.value];if(n[3].toUpperCase()!==this.parent.trueValue&&n[3].toUpperCase()!==this.parent.falseValue)return this.parent.getErrorStrings()[exports.CommonErrors.value];var g="";0===n[0].indexOf("!")&&(g=(g=(g=n[0]).replace("!","")).indexOf("!"),g=n[0].substring(0,g+2)),n[0]=g+getAlphalabel(h)+p+":"+getAlphalabel(u)+c,o=this.parent.getCellCollection(n[0]);for(var f=0;f<o.length;f++)a.push(this.parent.getValueFromArg(o[f]));var m=[],v=u-h+1;if("TRUE"===n[3])for(f=0;f<v;f++)a[f+(this.parseDouble(n[1])-1)*v]&&m.push(isNaN(this.parseDouble(a[f+(this.parseDouble(n[1])-1)*v]))?a[f+(this.parseDouble(n[1])-1)*v]:this.parseDouble(a[f+(this.parseDouble(n[1])-1)*v]));if("FALSE"===n[3])for(f=0;f<a.length;f++)a[f*v+this.parseDouble(n[1])-1]&&m.push(isNaN(this.parseDouble(a[f*v+this.parseDouble(n[1])-1]))?a[f*v+this.parseDouble(n[1])-1]:this.parseDouble(a[f*v+this.parseDouble(n[1])-1]));for(var C=ej2Data.DataUtil.sort(m,null,ej2Data.DataUtil.fnSort(i)),y=[],x=0;x<C.length;x++)for(var b=0;b<m.length;b++)JSON.stringify(C[x])===JSON.stringify(m[b])&&-1===y.indexOf(b)&&y.push(b);if("TRUE"===n[3]){for(var S=p,w=0;S<=c;S++,w++){x=0;for(var I=0;x<y.length;x++,I++){var R=this.parent.getValueFromArg(g+getAlphalabel(y[x]+h)+S);A=(A=this.parent.actCell).indexOf("!")>-1?A.split("!")[1]:A;var E=this.parent.rowIndex(A),k=this.parent.colIndex(A);this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,R,E+w,k+I)}}r=this.parent.getValueFromArg(g+getAlphalabel(y[0]+h)+p)}if("FALSE"===n[3]){for(x=0,w=0;x<y.length;x++,w++){var F=h;for(I=0;F<=u;F++,I++){var A,B=this.parent.getValueFromArg(g+getAlphalabel(F)+(y[x]+p));A=(A=this.parent.actCell).indexOf("!")>-1?A.split("!")[1]:A;k=this.parent.colIndex(A),E=this.parent.rowIndex(A);this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,B,E+w,k+I)}}r=this.parent.getValueFromArg(g+getAlphalabel(h)+(y[0]+p))}}}return r},e.prototype.ComputeCOUNTIF=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e;if(ej2Base.isNullOrUndefined(e)||""===e[0]||2!==r.length)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var n,i,o=0,a=[],s="equal",l=r[1].split(this.parent.tic).join("");if(l.startsWith("<=")?(s="lessEq",l=l.substring(2)):l.startsWith(">=")?(s="greaterEq",l=l.substring(2)):l.startsWith("<>")?(s="notEq",l=l.substring(2)):l.startsWith("<")?(s="less",l=l.substring(1)):l.startsWith(">")?(s="greater",l=l.substring(1)):l.startsWith("=")&&(s="equal",l=l.substring(1)),r[0].indexOf(":")>-1&&this.parent.isCellReference(r[0])){n=this.parent.getCellCollection(r[0].split(this.parent.tic).join(""));for(var d=0;d<n.length;d++)i=this.parent.getValueFromArg(n[d]),(l.indexOf("*")>-1||l.indexOf("?")>-1)&&(i=this.parent.findWildCardValue(l,i)),a.push(i),a.push(l),this.parent.processLogical(a,s)===this.parent.trueValue&&o++}return o},e.prototype.ComputeSUMIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeIfsFormulas(e,this.parent.falseValue)},e.prototype.ComputeTEXT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r,n=e.length,i=0;i<n;i++)r=ej2Base.isNullOrUndefined(r)?e[i]:r+","+e[i];var o=r.indexOf(","),a=r.slice(0,o),s=r.slice(r.indexOf('"')+1,r.length),l=s.indexOf('"');if(o>-1&&l!==s.length-1)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var d=a,p=s.slice(0,s.length-1),h=new Date(1900,0,1,0,0,0),c=d+","+p,u=new ej2Base.Internationalization;if(this.parent.getErrorStrings().indexOf(c)>-1)return c;if(d=this.parent.getValueFromArg(d),""===(p=p.split(this.parent.tic).join("")))return"";""===d&&(p.length>0&&(p.toUpperCase().indexOf("M")>-1||p.toUpperCase().indexOf("D")>-1||p.toUpperCase().indexOf("Y")>-1||p.toUpperCase().indexOf("S")>-1||p.toUpperCase().indexOf("T")>-1)||p.toUpperCase().indexOf("H")>-1)&&(d=h.toString());var g=this.parseDouble(d);if(isNaN(g)&&null!==this.parent.isDate(new Date(d))&&(g=this.parent.toOADate(new Date(d))),h=Date.parse(d.split(this.parent.tic).join("")),!isNaN(g)||!isNaN(h)){if("["===p[0])return this.parent.tic+d+this.parent.tic;if(p.length>0&&(p.toUpperCase().indexOf("M")>-1||p.toUpperCase().indexOf("D")>-1||p.toUpperCase().indexOf("Y")>-1||p.toUpperCase().indexOf("S")>-1||p.toUpperCase().indexOf("T")>-1)||p.toUpperCase().indexOf("H")>-1){var f=(p=(p=p.split("Y").join("y").split("D").join("d").split("H").join("h")).split("S").join("s").split("m").join("M").split("AM/PM").join("tt")).split(""),m=!1,v=!1,C=(i=0,0),y=0;for(i=0;i<f.length;){var x=f[i];"s"===x&&"M"===f[C]&&(f[C]="m","M"===f[C-1]&&(f[C-1]="m")),this.parent.isChar(x)?(C=i,"M"===x&&y++):y>1&&y++,"M"===x&&m&&(f[i]="m",v=!0),"h"===x?m=!0:this.parent.isChar(x)&&"M"!==x&&"h"!==x&&!v&&(m=!1,v=!1),i++}p=(p=String(f)).split(",").join("").split("\n").join(" ");var b=this.parent.fromOADate(g);0===g&&(b=h);var S=getSkeletonVal(p);if(""===S)return this.parent.getErrorStrings()[exports.CommonErrors.name];d=u.getDateFormat({skeleton:S,type:"date"})(new Date(b.toString()))}else d=u.formatNumber(g,{format:p})}return d},e.prototype.ComputeCOUNTIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeIfsFormulas(e,this.parent.trueValue)},e.prototype.ComputeAVERAGEIFS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.parent.computeIfsFormulas(e,this.parent.falseValue,this.parent.trueValue)},e.prototype.ComputeMATCH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e;if(ej2Base.isNullOrUndefined(r)||1===r.length&&""===r[0]||r.length<2||r.length>3)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var n,i=[],o=r[0].split(this.parent.tic).join("");if(this.parent.isCellReference(o)&&(o=this.parent.getValueFromArg(o)),!o.toString().length)return this.parent.getErrorStrings()[exports.CommonErrors.na];r[2]=ej2Base.isNullOrUndefined(r[2])?"1":r[2].split(this.parent.tic).join(""),r[2].split(this.parent.tic).join("")===this.parent.trueValue&&(r[2]="1"),r[2].split(this.parent.tic).join("")===this.parent.falseValue&&(r[2]="0");var a=parseFloat(r[2]);if(-1!==a&&0!==a&&1!==a)return this.parent.getErrorStrings()[exports.CommonErrors.na];var s=0,l="";if(r[1].indexOf(":")>-1||this.parent.isCellReference(r[1])){n=this.parent.getCellCollection(r[1].split(this.parent.tic).join(""));for(var d=0;d<n.length;d++)i[d]=this.parent.getValueFromArg(n[d]).split(this.parent.tic).join("");for(var p=0;p<i.length;p++)if(i[p].toString().length)if(1===a){if(o===i[p])return p+1;o>i[p]&&(l?i[p]>l&&(s=p+1,l=i[p]):(s=p+1,l=i[p]))}else if(0===a){if((o.indexOf("*")>-1||o.indexOf("?")>-1)&&(i[p]=this.parent.findWildCardValue(o,i[p])),o===i[p])return p+1;if(this.parent.parseFloat(o)===this.parent.parseFloat(i[p]))return p+1}else if(-1===a){if(o===i[p])return p+1;o<i[p]&&(l?i[p]<l&&(s=p+1,l=i[p]):(s=p+1,l=i[p]))}}return s||this.parent.getErrorStrings()[exports.CommonErrors.na]},e.prototype.ComputeSUBTOTAL=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e,n="";if(r.length<2)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var i=this.parent.parseFloat(this.parent.getValueFromArg(r[0].split(this.parent.tic).join(""))),o=r.slice(1,r.length);switch(i){case 1:case 101:n=this.ComputeAVERAGE.apply(this,o);break;case 2:case 102:n=this.ComputeCOUNT.apply(this,o);break;case 3:case 103:n=this.ComputeCOUNTA.apply(this,o);break;case 4:case 104:n=this.ComputeMAX.apply(this,o);break;case 5:case 105:n=this.ComputeMIN.apply(this,o);break;case 6:case 106:n=this.ComputePRODUCT.apply(this,o);break;case 7:case 107:n=this.ComputeDAY.apply(this,o);break;case 8:case 108:n=this.ComputeCONCAT.apply(this,o);break;case 9:case 109:n=this.ComputeSUM.apply(this,o);break;case 10:case 110:n=this.ComputeAVERAGEA.apply(this,o);break;case 11:case 111:n=this.ComputeABS.apply(this,o);break;default:n=this.parent.getErrorStrings()[exports.CommonErrors.value]}return n},e.prototype.ComputeRADIANS=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e;if(""===r[0]||r.length>1)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];if(r[0].indexOf(":")>-1||""===r[0].split(this.parent.tic).join(""))return this.parent.getErrorStrings()[exports.CommonErrors.value];var n=r[0].split(this.parent.tic).join("");r[0]=isNaN(this.parent.parseFloat(n))?r[0]:n;var i=this.parent.getValueFromArg(r[0]),o=this.parent.parseFloat(i);return isNaN(o)?i.indexOf(this.parent.tic)>-1?this.parent.getErrorStrings()[exports.CommonErrors.value]:this.parent.getErrorStrings()[exports.CommonErrors.name]:Math.PI*o/180},e.prototype.ComputeRANDBETWEEN=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n,i,o=e.length;if(2!==o)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];for(var a=0;a<o;a++){if(""===e[a])return this.parent.getErrorStrings()[exports.CommonErrors.na];if(e[a].indexOf(this.parent.tic)>-1){if(isNaN(parseFloat(e[a].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[exports.CommonErrors.value];e[a]=e[a].split(this.parent.tic).join("")}if(i=parseFloat(this.parent.getValueFromArg(e[a])),this.parent.isCellReference(e[a])){if(i=""===this.parent.getValueFromArg(e[a])?0:i,0===a?r=i:n=i,0===r&&0===n)return"0";if(isNaN(i))return this.parent.getErrorStrings()[exports.CommonErrors.value]}else{if(isNaN(i))return this.parent.getErrorStrings()[exports.CommonErrors.name];0===a?r=i:n=i}}return n<r?this.parent.getErrorStrings()[exports.CommonErrors.num]:0===r?Math.floor(Math.random()*(n-(r-1)))+r:n-r==1?Math.round(Math.random()*(n-r)+r):Math.floor(Math.random()*(n-(r-1)))+r},e.prototype.ComputeSLOPE=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e;if(2!==r.length||""===r[0])return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var n=this.parent.getCellCollection(r[1].split(this.parent.tic).join("")),i=this.parent.getCellCollection(r[0].split(this.parent.tic).join(""));if(i.length!==n.length)return this.parent.getErrorStrings()[exports.CommonErrors.na];var o=this.getDataCollection(i),a=this.getDataCollection(n);if(a.indexOf("#NAME?")>-1||o.indexOf("#NAME?")>-1)return this.parent.getErrorStrings()[exports.CommonErrors.name];for(var s=0,l=0,d=0,p=0,h=0,c=a.length;h<c;++h)"NaN"!==Number(a[h]).toString()&&"NaN"!==Number(o[h]).toString()&&(s+=Number(a[h])*Number(o[h]),d+=Number(a[h]),p+=Number(o[h]),l+=Number(a[h])*Number(a[h]));var u=((s-d*p/a.length)/(l-d*d/a.length)).toString();return"NaN"===u?this.parent.getErrorStrings()[exports.CommonErrors.divzero]:u},e.prototype.ComputeINTERCEPT=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e;if(""===r[0]||2!==r.length)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var n=this.parent.getCellCollection(r[0].split(this.parent.tic).join("")),i=this.parent.getCellCollection(r[1].split(this.parent.tic).join(""));if(n.length!==i.length)return this.parent.getErrorStrings()[exports.CommonErrors.na];var o=this.getDataCollection(i),a=this.getDataCollection(n);if(o.indexOf("#NAME?")>-1||a.indexOf("#NAME?")>-1)return this.parent.getErrorStrings()[exports.CommonErrors.name];for(var s=0,l=0,d=0,p=o.length;d<p;++d)s+=Number(o[d]),l+=Number(a[d]);s/=o.length,l/=o.length;var h,c=0,u=0;for(d=0,p=o.length;d<p;++d)c+=(h=Number(o[d])-s)*(Number(a[d])-l),u+=h*h;var g=(l-c/u*s).toString();return"NaN"===g?this.parent.getErrorStrings()[exports.CommonErrors.divzero]:g},e.prototype.ComputeLN=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n,i=e,o="";if(0===e.length||e.length>1)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];if(this.parent.isCellReference(i[0])){if(o=this.parent.getValueFromArg(i[0]),(r=this.parent.parseFloat(o))<=0||""===o)return this.parent.getErrorStrings()[exports.CommonErrors.num];if(isNaN(r))return this.parent.getErrorStrings()[exports.CommonErrors.value]}else{if(n=this.parent.getValueFromArg(i[0].split(this.parent.tic).join("")),(r=this.parent.parseFloat(n))<=0||""===r.toString())return this.parent.getErrorStrings()[exports.CommonErrors.num];if(isNaN(r))return this.parent.getErrorStrings()[exports.CommonErrors.value]}return Math.log(r)},e.prototype.ComputeISNUMBER=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e;if(0===e.length||e.length>1)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var n=this.parent.isCellReference(r[0])?this.parent.getValueFromArg(r[0]):this.parent.getValueFromArg(r[0].split(this.parent.tic).join(""));if(""===n.toString())return!1;var i=this.parent.parseFloat(n);return!isNaN(i)},e.prototype.ComputeROUND=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n,i,o,a,s=e,l=0,d=0;return 0===e.length||e.length>2?this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments]:1===e.length?(r="TRUE"===s[0].split(this.parent.tic).join("")?"1":"FALSE"===s[0].split(this.parent.tic).join("")?"0":s[0],Math.round(this.parent.parseFloat(r)).toString()):(i=this.parent.getValueFromArg(s[0]),o=""===s[1].split(this.parent.tic).join("")?"0":this.parent.getValueFromArg(s[1].split(this.parent.tic).join("")),i="TRUE"===i.split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i,o="TRUE"===o.split(this.parent.tic).join("")?"1":"FALSE"===o.split(this.parent.tic).join("")?"0":o,""!==i&&""!==o&&(l=this.parent.parseFloat(i),d=this.parent.parseFloat(o),!isNaN(d)&&!isNaN(l)&&d>0?n=l.toFixed(d):(a=Math.pow(10,-d),n=Math.round(l/a)*a)),n.toString())},e.prototype.ComputePOWER=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n,i=e;if(0===e.length||e.length>2)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];r=this.parent.getValueFromArg(i[0]),n=this.parent.getValueFromArg(i[1]),r="TRUE"===r.split(this.parent.tic).join("")?"1":"FALSE"===r.split(this.parent.tic).join("")?"0":r,n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n;var o=this.parent.parseFloat(r),a=this.parent.parseFloat(n);return isNaN(o)||isNaN(a)?this.parent.getErrorStrings()[exports.CommonErrors.value]:0===o&&a<0?this.parent.getErrorStrings()[exports.CommonErrors.divzero]:0===o&&0===a?this.parent.getErrorStrings()[exports.CommonErrors.num]:Math.pow(o,a).toString()},e.prototype.ComputeLOG=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n,i=e;if(0===e.length||e.length>2)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];if(r=this.parent.getValueFromArg(i[0]),n=2===e.length?this.parent.getValueFromArg(i[1]):"10",""===r||null===r||""===n||null===n)return this.parent.getErrorStrings()[exports.CommonErrors.num];r="TRUE"===r.split(this.parent.tic).join("")?"1":"FALSE"===r.split(this.parent.tic).join("")?"0":r,n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n;var o=this.parent.parseFloat(r),a=this.parent.parseFloat(n);return o<=0||a<=0?this.parent.getErrorStrings()[exports.CommonErrors.num]:1===a?this.parent.getErrorStrings()[exports.CommonErrors.divzero]:isNaN(o)||isNaN(a)?this.parent.getErrorStrings()[exports.CommonErrors.value]:(Math.log(o)/Math.LN10/(Math.log(a)/Math.LN10)).toString()},e.prototype.ComputeTRUNC=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n=e,i=0;if(0===e.length||e.length>2)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];2===e.length&&(i="TRUE"===(i=this.parent.getValueFromArg(n[1])).split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i,i=this.parent.parseFloat(i)),r="TRUE"===(r=this.parent.getValueFromArg(n[0])).split(this.parent.tic).join("")?"1":"FALSE"===r.split(this.parent.tic).join("")?"0":r;var o=this.parent.parseFloat(r.split(this.parent.tic).join(""));if(isNaN(o)||isNaN(i))return n[0]===this.parent.tic||this.parent.isCellReference(n[0])||n[1]===this.parent.tic||this.parent.isCellReference(n[1])?this.parent.getErrorStrings()[exports.CommonErrors.value]:this.parent.getErrorStrings()[exports.CommonErrors.name];var a=Math.pow(10,i);return((o<0?-1:1)*Math.floor(a*Math.abs(o))/a).toString()},e.prototype.ComputeEXP=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n=e;if(0===e.length||e.length>1)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];""===(r="TRUE"===(r=this.parent.getValueFromArg(n[0])).split(this.parent.tic).join("")?"1":"FALSE"===r.split(this.parent.tic).join("")?"0":r)&&(r="0");var i=this.parent.parseFloat(r);return i>709?this.parent.getErrorStrings()[exports.CommonErrors.num]:isNaN(i)?n[0]===this.parent.tic||this.parent.isCellReference(n[0])?this.parent.getErrorStrings()[exports.CommonErrors.value]:this.parent.getErrorStrings()[exports.CommonErrors.name]:Math.exp(i).toString()},e.prototype.ComputeGEOMEAN=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n,i,o,a=e,s=1,l=0,d=0;if(0===e.length)return this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];for(n=0;n<a.length;n++)if(a[n].indexOf(":")>-1){if(a[0]===this.parent.tic)return this.parent.getErrorStrings()[exports.CommonErrors.value];for(o=this.parent.getCellCollection(a[n].split(this.parent.tic).join("")),i=0;i<o.length;i++){if(d=this.parent.getValueFromArg(o[i]),d="TRUE"===d.split(this.parent.tic).join("")?"1":"FALSE"===d.split(this.parent.tic).join("")?"0":d,(r=this.parent.parseFloat(d))<=0)return this.parent.getErrorStrings()[exports.CommonErrors.num];isNaN(r)||(l++,s*=r)}}else if((d=this.parent.getValueFromArg(a[n])).length>0){if(d="TRUE"===d.split(this.parent.tic).join("")?"1":"FALSE"===d.split(this.parent.tic).join("")?"0":d,!this.parent.isCellReference(a[n])&&isNaN(this.parent.parseFloat(d)))return this.parent.getErrorStrings()[exports.CommonErrors.name];if((r=this.parent.parseFloat(d))<=0)return this.parent.getErrorStrings()[exports.CommonErrors.num];isNaN(r)||(l++,s*=r)}return l>0&&(s=Math.pow(s,1/l)),s.toString()},e.prototype.getDataCollection=function(e){for(var t=[],r=0,n=e.length;r<n;r++)t.push(this.parent.getValueFromArg(e[r]));return t},e.prototype.parseDouble=function(e){var t=this.parent.parseFloat(e.toString());return isNaN(t)?NaN:t},e.prototype.spreadsheetDisplayText=function(e){if(this.parent.parentObject&&this.parent.parentObject.element&&this.parent.parentObject.element.classList.contains("e-spreadsheet")&&this.parent.isCellReference(e)){var t=this.parent.parentObject.getIndexes(e);e=this.parent.parentObject.getDisplayText(this.parent.parentObject.getActiveSheet().rows[t.startIdx].cells[t.endIdx])}return e},e.prototype.spreadsheetFormat=function(e){if(this.parent.parentObject&&this.parent.parentObject.element&&this.parent.parentObject.element.classList.contains("e-spreadsheet")&&this.parent.isCellReference(e)){var t=this.parent.parentObject.getIndexes(e);e=this.parent.parentObject.getActiveSheet().rows[t.startIdx].cells[t.endIdx].format}return e},e.prototype.getModuleName=function(){return"basic-formulas"},e}(),Parser=function(){function e(e){this.emptyStr="",this.storedStringText=this.emptyStr,this.sheetToken="!",this.tokenAdd="a",this.tokenSubtract="s",this.tokenMultiply="m",this.tokenDivide="d",this.tokenLess="l",this.charEm="r",this.charEp="x",this.tokenGreater="g",this.tokenEqual="e",this.tokenLessEq="k",this.tokenGreaterEq="j",this.tokenNotEqual="o",this.tokenAnd="c",this.tokenEm="v",this.tokenEp="t",this.tokenOr=String.fromCharCode(126),this.charAnd="i",this.charLess="<",this.charGreater=">",this.charEqual="=",this.charLessEq="f",this.charGreaterEq="h",this.charNoEqual="z",this.stringGreaterEq=">=",this.stringLessEq="<=",this.stringNoEqual="<>",this.stringAnd="&",this.stringOr="^",this.charOr="w",this.charAdd="+",this.charSubtract="-",this.charMultiply="*",this.charDivide="/",this.fixedReference="$",this.spaceString=" ",this.ignoreBracet=!1,this.isError=!1,this.isFormulaParsed=!1,this.findNamedRange=!1,this.stringsColl=new Map,this.tokens=[this.tokenAdd,this.tokenSubtract,this.tokenMultiply,this.tokenDivide,this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual,this.tokenAnd,this.tokenOr],this.charNOTop=String.fromCharCode(167),this.specialSym=["~","@","#","?"],this.isFailureTriggered=!1,this.parent=e}return e.prototype.parse=function(e,t){if(this.parent.isTextEmpty(e))return e;this.parent.getFormulaCharacter()!==String.fromCharCode(0)&&this.parent.getFormulaCharacter()===e[0]&&(e=e.substring(1)),(this.parent.namedRanges.size>0||this.parent.storedData.size>0)&&(e=this.checkForNamedRangeAndKeyValue(e),this.findNamedRange=!1),e=(e=(e=(e=e.split("-+").join("-")).split("--").join("+")).split("+-").join("-")).split("-(-").join("(");var r=this.storeStrings(e);e=this.storedStringText;var n=0;if(ej2Base.isNullOrUndefined(r)&&(e=e.split(" ").join("")),e=e.split("=>").join(">="),(e=e.split("=<").join("<="))[e.length-1]===this.parent.arithMarker&&this.indexOfAny(e,this.tokens)===e.length-2||(e=e.toUpperCase()),e.indexOf(this.sheetToken)>-1){var i=this.parent.getSheetFamilyItem(this.parent.grid);if(null!=i.sheetNameToParentObject&&i.sheetNameToParentObject.size>0){e[0]!==this.sheetToken.toString()&&(e=this.parent.setTokensForSheets(e));var o=this.parent.getSheetToken(e.split(this.parent.tic).join(this.emptyStr)),a=this.checkScopedRange(e.split('"').join(this.emptyStr).split(this.sheetToken).join(""));ej2Base.isNullOrUndefined(o)&&""!==o&&this.parent.namedRanges.size>0&&""!==a&&(e=a)}}e=this.markLibraryFormulas(e);try{e=this.formulaAutoCorrection(e)}catch(r){if(!(d={message:r.message,exception:r,isForceCalculable:r.formulaCorrection,computeForceCalculate:!1}).isForceCalculable)throw this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_expression];if(this.isFailureTriggered||(this.parent.trigger("onFailure",d),this.isFailureTriggered=!0),!d.isForceCalculable||!d.computeForceCalculate)throw this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_expression];e=this.formulaAutoCorrection(e,d),this.parent.storedData.get(t).formulaText="="+e}if(!this.ignoreBracet)for(n=e.indexOf(")");n>-1;){var s=e.substring(0,n).lastIndexOf("(");if(-1===s)throw new FormulaError(this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.mismatched_parentheses]);if(s===n-1)throw new FormulaError(this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.empty_expression]);var l=this.emptyStr;l=this.ignoreBracet?this.parent.substring(e,s,n-s+1):this.parent.substring(e,s+1,n-s-1);try{e=e.substring(0,s)+this.parseSimple(l)+e.substring(n+1)}catch(e){var d=this.exceptionArgs(e);this.isFailureTriggered||(this.parent.trigger("onFailure",d),this.isFailureTriggered=!0);var p="string"==typeof d.exception?d.exception:d.message;return(this.parent.getErrorLine(e)?"":"#"+this.parent.getErrorLine(e)+": ")+p}n=e.indexOf(")")}if(!this.ignoreBracet&&e.indexOf("(")>-1)throw new FormulaError(this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.mismatched_parentheses]);return e=this.parseSimple(e),null!==r&&r.size>0&&(e=this.setStrings(e,r)),e},e.prototype.exceptionArgs=function(e){return{message:e.message,exception:e,isForceCalculable:e.formulaCorrection,computeForceCalculate:!1}},e.prototype.formulaAutoCorrection=function(e,t){var r=["*","+","-","/","^","&"],n=[">","=","<"],i=0,o="",a="",s="",l="",d="",p="",h="",c=0;if(this.parent.formulaErrorStrings.indexOf(e)>-1)return e;if(this.indexOfAny(e,this.specialSym)>-1)throw new FormulaError(this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_expression],!1);for(;i<e.length;)if(e=e.split("-*").join("-").split("/*").join("/").split("*/").join("*").split("-/").join("-").split("*+").join("*").split("+*").join("+"),this.parent.isDigit(e[i])&&e.length>i+1&&this.indexOfAny(e[i+1],r)>-1&&e.length>i+2&&!ej2Base.isNullOrUndefined(e[i+2])&&this.indexOfAny(e[i+2],r)>-1&&("-"!==e[i+2]||"*"!==e[i+1]&&"/"!==e[i+1])){if(ej2Base.isNullOrUndefined(t))throw new FormulaError(this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_expression],!0);if(!t.computeForceCalculate)throw this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.improper_formula];this.parent.isDigit(e[i])?(c<1?(p=e[i],s=e[i+1],ej2Base.isNullOrUndefined(s)&&(s=this.emptyStr),c+=1,o=o+p+(s="&"===s?"":s)):c<2&&(h=e[i],l=e[i-1],d=e[i+1],c=0,o="-"===l?o+l+h+(d="&"===(d=ej2Base.isNullOrUndefined(d)?this.emptyStr:d)?"":d):o+h+(d=ej2Base.isNullOrUndefined(d)?this.emptyStr:d)),i+=2):(o="-"===e[i]?o+e[i]:o,i+=1)}else if((this.parent.isDigit(e[i])||e[i]===this.parent.rightBracket||this.parent.storedData.has(e[i].toUpperCase()))&&(ej2Base.isNullOrUndefined(e[i+1])||this.indexOfAny(e[i+1],r))>-1)a="&"===(a=ej2Base.isNullOrUndefined(e[i+1])?this.emptyStr:e[i+1])?"":a,o="-"===e[i-1]?o+e[i-1]+e[i]+a:o+e[i]+a,i+=2;else if(this.indexOfAny(e[i],n)>-1&&!ej2Base.isNullOrUndefined(e[i-1])&&!ej2Base.isNullOrUndefined(e[i+1]))o+=e[i],i+=1;else if("q"===e[i])for(;e[i]!==this.parent.leftBracket;)o+=e[i],i+=1;else e[i]===this.parent.leftBracket||e[i]===this.parent.rightBracket||"{"===e[i]||"}"===e[i]||"("===e[i]||")"===e[i]?(o+=e[i],i+=1):this.parent.isUpperChar(e[i])||e[i].indexOf(":")>-1||e[i]===this.parent.getParseArgumentSeparator()||"%"===e[i]&&this.parent.isDigit(e[i-1])?(o+=e[i],i+=1):e[i]===this.parent.tic||" "===e[i]||"."===e[i]||e[i]===this.sheetToken||"$"===e[i]?(o+=e[i],i+=1):(this.parent.isDigit(e[i])&&(o="-"===e[i-1]?o+e[i-1]+e[i]:o+e[i]),"-"!==e[i]&&"+"!==e[i]||(o=(o+=e[i]).split("++").join("+").split("+-").join("-").split("-+").join("-")),"/"!==e[i]&&"*"!==e[i]||(o+=e[i]),i+=1);return o=o===this.emptyStr?e:o,this.indexOfAny(o[o.length-1],r)>-1&&(o=o.substring(0,o.length-1)),o=o.split("--").join("-").split("-+").join("-").split("+-").join("-")},e.prototype.checkScopedRange=function(e){var t=this,r=this.emptyStr,n="NaN",i=this.parent.getSheetID(this.parent.grid),o=this.parent.getSheetFamilyItem(this.parent.grid);if(e[0]===this.sheetToken.toString()){var a=e.indexOf(this.sheetToken,1),s=parseInt(e.substr(1,a-1),10);a>1&&!this.parent.isNaN(s)&&(e=e.substring(a+1),i=s)}var l="!"+i.toString()+"!";return null===o||null==o.sheetNameToToken?n:(o.sheetNameToToken.forEach(function(i,a){if(o.sheetNameToToken.get(a).toString()===l){var s=t.emptyStr;t.parent.namedRanges.forEach(function(i,a){s=ej2Base.isNullOrUndefined(t.parent.parentObject)?o.sheetNameToToken.get(a).toUpperCase():(t.parent.parentObject.getActiveSheet().name+t.sheetToken+e).toUpperCase(),t.parent.getNamedRanges().has(s)&&(r=t.parent.getNamedRanges().get(s).toUpperCase(),n=r)})}}),n)},e.prototype.storeStrings=function(e){var t,r=0,n=0,i=0,o="",a=null;if(e.indexOf(this.parent.tic)>-1)for(r=e.indexOf(this.parent.tic);r>-1&&e.length>0;){if(null===a&&(a=this.stringsColl),-1===(n=r+1<e.length?e.indexOf(this.parent.tic,r+1):-1))throw new FormulaError(this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.mismatched_tics]);t=this.parent.substring(e,r,n-r+1),o=this.parent.tic+this.spaceString+i.toString()+this.parent.tic,a=a.set(o,t),e=e.substring(0,r)+o+e.substring(n+1),(r+=o.length)<=e.length&&(r=e.indexOf(this.parent.tic,r)),i++}return this.storedStringText=e,a},e.prototype.setStrings=function(e,t){for(var r=0;r<t.size;r++)t.forEach(function(t,r){e=e.split(r).join(t)});return e},e.prototype.parseSimple=function(e){var t=e;if(t.length>0&&"+"===t[0]&&(t=t.substring(1)),"#DIV/0!"===t)return"#DIV/0!";if("#NAME?"===t)return"#NAME?";if(""===t)return t;if(this.parent.formulaErrorStrings.indexOf(t)>-1)return t;t=(t=(t=(t=(t=(t=t.split(this.stringLessEq).join(this.charLessEq)).split(this.stringGreaterEq).join(this.charGreaterEq)).split(this.stringNoEqual).join(this.charNoEqual)).split(this.stringAnd).join(this.charAnd)).split(this.stringOr).join(this.charOr)).split(this.fixedReference).join(this.emptyStr);var r=[this.tokenEp,this.tokenEm],n=[this.tokenMultiply,this.tokenDivide],i=[this.tokenAdd,this.tokenSubtract],o=[this.charMultiply,this.charDivide],a=[this.charAdd,this.charSubtract],s=[this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual],l=[this.charLess,this.charGreater,this.charEqual,this.charLessEq,this.charGreaterEq,this.charNoEqual],d=[this.charEp,this.charEm],p=[this.tokenAnd],h=[this.charAnd],c=[this.charOr],u=[this.tokenOr];return t=this.parseSimpleOperators(t,r,d),t=this.parseSimpleOperators(t,u,c),t=this.parseSimpleOperators(t,n,o),t=this.parseSimpleOperators(t,i,a),t=this.parseSimpleOperators(t,s,l),t=this.parseSimpleOperators(t,p,h)},e.prototype.parseSimpleOperators=function(e,t,r){if(this.parent.getErrorStrings().indexOf(e)>-1)return e;for(var n=e,i=0,o="",a=0;a<r.length;a++)o+=r[a];(n=(n=n.split("---").join("-").split("--").join("+").split(this.parent.getParseArgumentSeparator()+"-").join(this.parent.getParseArgumentSeparator()+"u").split(this.parent.leftBracket+"-").join(this.parent.leftBracket+"u").split("=-").join("=u")).split(",+").join(",").split(this.parent.leftBracket+"+").join(this.parent.leftBracket).split("=+").join("=").split(">+").join(">").split("<+").join("<").split("/+").join("/").split("*+").join("*").split("++").join("+").split("*-").join("*u").toString()).length>0&&"-"===n[0]?(n="0-"+(n=n.substring(1).split("-").join(this.tokenOr)),n=(n=this.parseSimpleOperators(n,[this.tokenSubtract],[this.charSubtract])).split(this.tokenOr).join("-")):n.length>0&&"+"===n[0]?n=n.substring(1):n.length>0&&"+"===n[n.length-1]&&(n=n.substring(0,n.length-1));try{if(this.indexOfAny(n,r)>-1)for(i=this.indexOfAny(n,r);i>-1;){var s="",l="",d=0,p=0,h=0;if(n[i]===this.charNOTop)d=i;else if(h=i-1,n[h]===this.parent.arithMarker){if((u=this.findLeftMarker(n.substring(0,h-1)))<0)throw new FormulaError(this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.cannot_parse]);s=this.parent.substring(n,u+1,h-u-1),d=u+1}else if(n[h]===this.parent.rightBracket){for(var c=0,u=h-1;u>0&&("q"!==n[u]||0!==c);)"q"===n[u]?c--:n[u]===this.parent.rightBracket&&c++,u--;if(u<0)throw new FormulaError(this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.cannot_parse]);s=this.parent.substring(n,u,h-u+1),d=u}else if(n[h]===this.parent.tic[0]){var g=n.substring(0,h-1).lastIndexOf(this.parent.tic);if(g<0)throw new FormulaError(this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.cannot_parse]);s=this.parent.substring(n,g,h-g+1),d=g}else{for(var f=!1;h>-1&&(this.parent.isDigit(n[h])||!f&&n[h]===this.parent.getParseDecimalSeparator());)n[h]===this.parent.getParseDecimalSeparator()&&(f=!0),h-=1;if(h>-1&&f&&n[h]===this.parent.getParseDecimalSeparator())throw new FormulaError(this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.number_contains_2_decimal_points]);if(0===(h+=1)||h>0&&!this.parent.isUpperChar(n[h-1]))s="n"+this.parent.substring(n,h,i-h),d=h;else{for(h-=1;h>-1&&(this.parent.isUpperChar(n[h])||this.parent.isDigit(n[h]));)h-=1;if(h>-1&&n[h]===this.sheetToken){for(h-=1;h>-1&&n[h]!==this.sheetToken;)h-=1;h>-1&&n[h]===this.sheetToken&&(h-=1)}if(h>-1&&":"===n[h]){for(h-=1;h>-1&&this.parent.isDigit(n[h]);)h-=1;for(;h>-1&&this.parent.isUpperChar(n[h]);)h-=1;if(h>-1&&n[h]===this.sheetToken){for(h--;h>-1&&n[h]!==this.sheetToken;)h--;h>-1&&n[h]===this.sheetToken&&h--}h+=1,s=this.parent.substring(n,h,i-h),s=this.parent.getCellFrom(s)}else h+=1,s=this.parent.substring(n,h,i-h);this.parent.updateDependentCell(s),d=h}(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(s.toUpperCase())||this.parent.storedData.has(s.toUpperCase()))&&(s="n"+this.checkForNamedRangeAndKeyValue(s))}if(i===n.length-1)throw new FormulaError(this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.expression_cannot_end_with_an_operator]);var m="u"===n[h=i+1];if(m&&(h+=1),n[h]===this.parent.tic[0]){if((u=n.substring(h+1).indexOf(this.parent.tic))<0)throw this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.cannot_parse];l=this.parent.substring(n,h,u+2),p=u+h+2}else if(n[h]===this.parent.arithMarker){if((u=this.findRightMarker(n.substring(h+1)))<0)throw new FormulaError(this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.cannot_parse]);l=this.parent.substring(n,h+1,u),p=u+h+2}else if("q"===n[h]){for(c=0,u=h+1;u<n.length&&(n[u]!==this.parent.rightBracket||0!==c);)n[u]===this.parent.rightBracket?c++:"q"===n[u]&&c--,u++;if(u===n.length)throw this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.cannot_parse];l=this.parent.substring(n,h,u-h+1),m&&(l="u"+l),p=u+1}else if(this.parent.isDigit(n[h])||n[h]===this.parent.getParseDecimalSeparator()){f=n[h]===this.parent.getParseDecimalSeparator();for(h+=1;h<n.length&&(this.parent.isDigit(n[h])||!f&&n[h]===this.parent.getParseDecimalSeparator());)n[h]===this.parent.getParseDecimalSeparator()&&(f=!0),h+=1;if(h<n.length&&"%"===n[h]&&(h+=1),f&&h<n.length&&n[h]===this.parent.getParseDecimalSeparator())throw this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.number_contains_2_decimal_points];l="n"+this.parent.substring(n,i+1,h-i-1),p=h}else if(this.parent.isUpperChar(n[h])||n[h]===this.sheetToken||"u"===n[h]){if(n[h]===this.sheetToken)for(h+=1;h<n.length&&n[h]!==this.sheetToken;)h+=1;h+=1;for(var v=0,C=!1;h<n.length&&(this.parent.isUpperChar(n[h])||"_"===n[h]||"."===n[h]||"["===n[h]||"]"===n[h]||"#"===n[h]||" "===n[h]||"%"===n[h]||n[h]===this.parent.getParseDecimalSeparator()&&C);)h!==n.length-1&&"["===n[h]&&"["===n[h+1]&&(C=!0),h!==n.length-1&&"]"===n[h]&&"]"===n[h+1]&&(C=!1),h++,v++;var y=h===n.length||!this.parent.isDigit(n[h]);if(v>1){for(;h<n.length&&(this.parent.isUpperChar(n[h])||this.parent.isDigit(n[h])||" "===n[h]||"_"===n[h]);)h++;y=!0}for(;h<n.length&&this.parent.isDigit(n[h]);)h+=1;if(h<n.length&&":"===n[h]){if((h+=1)<n.length&&n[h]===this.sheetToken){for(h++;h<n.length&&n[h]!==this.sheetToken;)h+=1;h<n.length&&n[h]===this.sheetToken&&h++}for(;h<n.length&&this.parent.isUpperChar(n[h]);)h+=1;for(;h<n.length&&this.parent.isDigit(n[h]);)h+=1;h-=1,l=this.parent.substring(n,i+1,h-i),l=this.parent.getCellFrom(l)}else h-=1,l=this.parent.substring(n,i+1,h-i),(m="u"===n[h])&&(l="u"+l);y&&l.startsWith(this.sheetToken)&&(y=!this.parent.isCellReference(l)),y||this.parent.updateDependentCell(l),(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(l.toUpperCase())||this.parent.storedData.has(l.toUpperCase()))&&(l="n"+this.checkForNamedRangeAndKeyValue(l)),p=h+1}var x=o.indexOf(n[i]),b=this.parent.arithMarker+s+l+t[x]+this.parent.arithMarker;d>0&&(b=n.substring(0,d)+b),p<n.length&&(b+=n.substring(p)),n=b=b.split(this.parent.arithMarker2).join(this.parent.arithMarker.toString()),i=this.indexOfAny(n,r)}else if(n.length>0&&(this.parent.isUpperChar(n[0])||n[0]===this.sheetToken)){var S=!0,w=!0,I=!1,R=n.length;for(u=0;u<R;++u)if(n[u]===this.sheetToken){if(u>0&&!I)throw this.parent.getErrorStrings()[exports.CommonErrors.ref];for(I=!0,u++;u<R&&this.parent.isDigit(n[u]);)u++;if(u===R||n[u]!==this.sheetToken){S=!1;break}}else{if(!w&&this.parent.isChar(n[u])){S=!1;break}if(!this.parent.isChar(n[u])&&!this.parent.isDigit(n[u])&&n[u]!==this.sheetToken){S=!1;break}w=this.parent.isUpperChar(n[u])}S&&this.parent.updateDependentCell(n)}return n}catch(e){return e}},e.prototype.indexOfAny=function(e,t){for(var r=0;r<e.length;r++)if(t.indexOf(e[r])>-1)return r;return-1},e.prototype.findLeftMarker=function(e){var t=-1;if(e.indexOf(this.parent.arithMarker)>-1)for(var r=0,n=e.length-1;n>=0;--n)if(e[n]===this.parent.rightBracket)r--;else if(e[n]===this.parent.leftBracket)r++;else if(e[n]===this.parent.arithMarker&&0===r){t=n;break}return t},e.prototype.findRightMarker=function(e){var t=-1;if(e.indexOf(this.parent.arithMarker)>-1)for(var r=0,n=0;n<e.length;++n)if(e[n]===this.parent.rightBracket)r--;else if(e[n]===this.parent.leftBracket)r++;else if(e[n]===this.parent.arithMarker&&0===r){t=n;break}return t},e.prototype.parseFormula=function(e,t){if(e.length>0&&e[0]===this.parent.getFormulaCharacter()&&(e=e.substring(1)),e.indexOf("#REF!")>-1)return this.parent.getErrorStrings()[exports.CommonErrors.ref];e.length>0&&"+"===e[0]&&(e=e.substring(1));try{this.isFailureTriggered=!1,this.isError=!1,e=this.parse(e.trim(),t),this.isFormulaParsed=!0}catch(t){var r=this.exceptionArgs(t);this.isFailureTriggered||(this.parent.trigger("onFailure",r),this.isFailureTriggered=!0);var n="string"==typeof r.exception?r.exception:r.message;e=(ej2Base.isNullOrUndefined(this.parent.getErrorLine(t))?"":"#"+this.parent.getErrorLine(t)+": ")+n,this.isError=!0}return e},e.prototype.markLibraryFormulas=function(e){var t=0,r=e.indexOf(")");if(-1===r)e=this.markNamedRanges(e);else for(;r>-1;){for(var n=0,i=r-1;i>-1&&("("!==e[i]||0!==n);)")"===e[i]&&n++,i--;if(-1===i)throw new FormulaError(this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.mismatched_parentheses]);for(var o=i-1;o>-1&&this.parent.isChar(e[o]);)o--;var a=i-o-1,s=this.parent.substring(e,o+1,a);if(a>0&&!ej2Base.isNullOrUndefined(this.parent.getFunction(s))){"AREAS"===this.parent.substring(e,o+1,a)?this.ignoreBracet=!0:this.ignoreBracet=!1;var l=this.parent.substring(e,i,r-i+1);try{var d=void 0;l=l.split("(").join("").split(")").join(""),l="("+this.formulaAutoCorrection(l,d)+")"}catch(e){if(!(d={message:e.message,exception:e,isForceCalculable:e.formulaCorrection,computeForceCalculate:!1}).isForceCalculable)throw this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.improper_formula];if(this.isFailureTriggered||(this.parent.trigger("onFailure",d),this.isFailureTriggered=!0,t+=1),d.computeForceCalculate=t>0||d.computeForceCalculate,!d.isForceCalculable)throw this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.improper_formula];if(!d.computeForceCalculate)throw this.parent.formulaErrorStrings[exports.FormulasErrorsStrings.improper_formula];l=l.split("(").join("").split(")").join(""),l="("+this.formulaAutoCorrection(l,d)+")"}l=this.markNamedRanges(l),l=this.swapInnerParens(l);-1===(l=this.addParensToArgs(l)).lastIndexOf(this.parent.getParseArgumentSeparator())&&l.length>2&&"("===l[0]&&")"===l[l.length-1]&&"{"!==l[1]&&"("!==l[1]&&(l=(l=l.substring(0,l.length-1)+"}"+l.substring(l.length-1))[0]+"{"+l.substring(1)),e=e.substring(0,o+1)+"q"+this.parent.substring(e,o+1,a)+l.split("(").join(this.parent.leftBracket).split(")").join(this.parent.rightBracket)+e.substring(r+1)}else{if(a>0)return this.parent.getErrorStrings()[exports.CommonErrors.name];var p=this.emptyStr;i>0&&(p=e.substring(0,i)),p=p+"{"+this.parent.substring(e,i+1,r-i-1)+"}",r<e.length&&(p+=e.substring(r+1)),e=p=this.markNamedRanges(p)}r=e.indexOf(")")}return e=e.split("{").join("(").split("}").join(")")},e.prototype.swapInnerParens=function(e){return e.length>2&&(e=e[0]+e.substr(1,e.length-2).split("(").join("{").split(")").join("}")+e[e.length-1]),e},e.prototype.addParensToArgs=function(e){if(0===e.length)return this.emptyStr;var t=[];t.push(this.parent.getParseArgumentSeparator()),t.push(this.parent.rightBracket);var r=e.lastIndexOf(this.parent.getParseArgumentSeparator()),n=0;if(-1===r){if(e.length>2&&"("===e[0]&&")"===e[e.length-1])if("{"!==e[1]&&"("!==e[1])e=(e=e.substring(0,e.length-1)+"}"+e.substring(e.length-1))[0]+"{"+e.substring(1);else{r=this.lastIndexOfAny(e,["+","-","*","/"]),0===n&&")"===e[e.length-1]&&(n=e.length-1),n>0&&"{"!==e[r+1]&&"}"===e[r-1]&&(e=(e=e.substr(0,n)+"}"+e.substr(n)).substr(0,r+1)+"{"+e.substr(r+1))}}else for(var i=!0;r>-1;){var o=this.indexOfAny(e.substring(r+1,e.length),t);o>=0?o=r+o+1:-1===o&&")"===e[e.length-1]&&(o=e.length-1),o>0&&"{"!==e[r+1]&&"}"!==e[o-1]&&(e=(e=e.substr(0,o)+"}"+e.substr(o)).substr(0,r+1)+"{"+e.substr(r+1)),r=e.substr(0,r).lastIndexOf(this.parent.getParseArgumentSeparator()),i&&-1===r&&"("===e[0]&&(r=0,i=!1)}return e=e.split("{}").join(this.emptyStr)},e.prototype.lastIndexOfAny=function(e,t){for(var r=e.length-1;r>-1;r--)if(t.indexOf(e[r])>-1)return r;return-1},e.prototype.markNamedRanges=function(e){var t=[")",this.parent.getParseArgumentSeparator(),"}","+","-","*","/","<",">","=","&"],r=e.length>0&&("("===e[0]||"{"===e[0])?1:0;e.indexOf("#N/A")>-1&&(e=e.split("#N/A").join("#N~A")),e.indexOf("#DIV/0!")>-1&&(e=e.split("#DIV/0!").join("#DIV~0!"));for(var n=this.indexOfAny(e.substring(r),t);n>-1&&n+r<e.length;){var i=this.emptyStr,o=null;if(this.parent.substring(e,r,n).indexOf("[")>-1?o=this.getTableRange(this.parent.substring(e,r,n)):this.parent.storedData.has(this.parent.substring(e,r,n))?o=this.checkForNamedRangeAndKeyValue(this.parent.substring(e,r,n)):this.parent.namedRanges.has(this.parent.substring(e,r,n))&&(o=this.checkForNamedRangeAndKeyValue(this.parent.substring(e,r,n))),ej2Base.isNullOrUndefined(o)&&("NaN"!==(i=this.checkScopedRange(this.parent.substring(e,r,n)))?(this.findNamedRange=!0,o=i):this.parent.substring(e,r,n).startsWith(this.sheetToken.toString()),!ej2Base.isNullOrUndefined(o)&&this.findNamedRange&&o.indexOf(this.fixedReference)>-1&&(o=o.split(this.fixedReference).join(this.emptyStr))),ej2Base.isNullOrUndefined(o)||(o=o.toUpperCase(),o=this.parent.setTokensForSheets(o),o=this.markLibraryFormulas(o)),ej2Base.isNullOrUndefined(o)||o===this.emptyStr)for(r+=n+1;r<e.length&&!this.parent.isUpperChar(e[r])&&e[r]!==this.sheetToken;)r++;else e=e.substring(0,r)+o+e.substring(r+n),r+=o.length+1;for(n=r,r<e.length-1&&"{"===e[r]&&(r+=1),n=this.indexOfAny(e.substring(r),t);0===n&&r<e.length-1;)r++,n=this.indexOfAny(e.substring(r),t);if((-1===n||e.substring(r).indexOf("[")>-1)&&r<e.length){if(o=e.substring(r).indexOf("[")>-1?this.getTableRange(e.substring(r)):this.parent.storedData.has(e.substring(r))?this.parent.storedData.size>0?this.checkForNamedRangeAndKeyValue(e.substring(r)):o:this.parent.namedRanges.size>0?this.checkForNamedRangeAndKeyValue(e.substring(r)):o,ej2Base.isNullOrUndefined(o)&&"NaN"!==(i=this.checkScopedRange(e.substring(r)))&&(o=i),!ej2Base.isNullOrUndefined(o)&&o!==this.emptyStr&&(o=o.toUpperCase(),o=this.parent.setTokensForSheets(o),null!=(o=this.markLibraryFormulas(o)))){var a=e.substring(r);e=")"===a[a.length-1]?e.substring(0,r)+o+")":e.substring(0,r)+o,r+=o.toString().length+1}n=r<e.length?this.indexOfAny(e.substring(r),t):-1}}return e.indexOf("#N~A")>-1&&(e=e.split("#N~A").join("#N/A")),e.indexOf("#DIV~0!")>-1&&(e=e.split("#DIV~0!").join("#DIV/0!")),e},e.prototype.checkForNamedRangeAndKeyValue=function(e){var t=this.emptyStr;if(e.indexOf("[")>-1){var r=this.getTableRange(e);ej2Base.isNullOrUndefined(r)||(this.findNamedRange=!0,e=r)}if("NaN"!==(t=this.checkScopedRange(e)))this.findNamedRange=!0,e=t;else{if(e.indexOf(this.sheetToken)>-1){var n=this.parent.getSheetFamilyItem(this.parent.grid),i=e.split('"').join(this.emptyStr);if(i=i.substr(0,i.indexOf(this.sheetToken)),n.sheetNameToToken.has(i.toUpperCase()))parseInt(n.sheetNameToToken.get(i.toUpperCase()).split(this.sheetToken).join(this.emptyStr))}this.parent.storedData.size>0&&this.parent.storedData.has(e)&&(e="A"+this.parent.colIndex(e)),this.parent.namedRanges.size>0&&this.parent.namedRanges.has(e.toUpperCase())&&(ej2Base.isNullOrUndefined(this.parent.parentObject)?(e=this.parse(this.parent.namedRanges.get(e.toUpperCase())),(e=this.parent.setTokensForSheets(e)).indexOf(this.fixedReference)>-1&&e.split(this.fixedReference).join(this.emptyStr),this.findNamedRange=!0):e=this.parse(this.parent.namedRanges.get(e.toUpperCase()))),this.findNamedRange&&"!"!==e[0]&&"q"!==e[0]&&"bq"!==e[0]&&(e=this.parent.setTokensForSheets(e)).indexOf(this.fixedReference)>-1&&(e=e.split(this.fixedReference).join(this.emptyStr))}return e},e.prototype.getTableRange=function(e){var t=(e=e.replace(" ",this.emptyStr).toUpperCase()).replace("]",this.emptyStr).replace("#DATA",this.emptyStr);t.indexOf(this.parent.getParseArgumentSeparator())>-1&&(t.substring(0,t.indexOf(this.parent.getParseArgumentSeparator())).replace("[",this.emptyStr),t=t.replace("[",this.emptyStr).replace(this.parent.getParseArgumentSeparator(),"_"));this.emptyStr;return t.toUpperCase()},e.prototype.findNextEndIndex=function(e,t){for(var r=0,n=t,i=!1;!i&&t<e.length;)"["===e[n]?r++:"]"===e[n]&&0===--r&&(i=!0),t++;return t-=n},e}(),__extends$3=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__decorate$2=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},Calculate=function(e){function t(t){var n=e.call(this,null,null)||this;n.lFormulas=new Map,n.storedData=new Map,n.keyToRowsMap=new Map,n.rowsToKeyMap=new Map,n.rightBracket=String.fromCharCode(161),n.leftBracket=String.fromCharCode(162),n.sheetToken="!",n.emptyString="",n.leftBrace="{",n.rightBrace="}",n.cell=n.emptyString,n.cellPrefix="!0!A",n.treatEmptyStringAsZero=!1,n.tic='"',n.singleTic="'",n.trueValue="TRUE",n.falseValue="FALSE",n.parseDecimalSeparator=".",n.arithMarker=String.fromCharCode(180),n.arithMarker2=n.arithMarker+n.arithMarker,n.dependentCells=null,n.dependentFormulaCells=null,n.minValue=Number.MIN_SAFE_INTEGER,n.maxValue=Number.MAX_SAFE_INTEGER,n.categoryCollection=["All"],n.dependencyLevel=0,n.refreshedCells=new Map,n.computedValues=null,n.randomValues=new Map,n.isRandomVal=!1,n.randCollection=[],n.dependencyCollection=[],n.uniqueRange=[],n.skipSpill=!1,n.formulaErrorStrings=["binary operators cannot start an expression","cannot parse","bad library","invalid char in front of","number contains 2 decimal points","expression cannot end with an operator","invalid characters following an operator","invalid character in number","mismatched parentheses","unknown formula name","requires a single argument","requires 3 arguments","invalid Math argument","requires 2 arguments","#NAME?","too complex","circular reference: ","missing formula","improper formula","invalid expression","cell empty","bad formula","empty expression","","mismatched string quotes","wrong number of arguments","invalid arguments","iterations do not converge","Control is already registered","Calculation overflow","Missing sheet","cannot_parse","expression_cannot_end_with_an_operator","#SPILL!","#DIV/0!"],n.errorStrings=null,n.parseArgumentSeparator=",",n.dateTime1900=new Date(1900,0,1,0,0,0),n.isParseDecimalSeparatorChanged=!1,n.isArgumentSeparatorChanged=!1,n.sheetFamilyID=0,n.defaultFamilyItem=null,n.sheetFamiliesList=null,n.modelToSheetID=null,n.tokenCount=0,n.sortedSheetNames=null,n.tempSheetPlaceHolder=String.fromCharCode(133),n.namedRanges=new Map,n.formulaInfoTable=null,n.oaDate=new Date(1899,11,30),n.millisecondsOfaDay=864e5,n.parseDateTimeSeparator="/";var i=new ModuleLoader(n);return n.includeBasicFormulas&&r.Inject(BasicFormulas),n.injectedModules&&n.injectedModules.length&&i.inject(n.requiredModules(),n.injectedModules),n.parentObject=ej2Base.isNullOrUndefined(t)?n:t,n.grid=n.parentObject,n.parser=new Parser(n),n}__extends$3(t,e),r=t,Object.defineProperty(t.prototype,"libraryFormulas",{get:function(){return this.lFormulas},set:function(e){this.lFormulas.set(e.fName,{handler:e.handler,category:e.category,description:e.description})},enumerable:!0,configurable:!0}),t.prototype.getParseArgumentSeparator=function(){return this.isArgumentSeparatorChanged||","===this.parseArgumentSeparator||(this.parseArgumentSeparator=","),this.parseArgumentSeparator},t.prototype.setParseArgumentSeparator=function(e){this.parseArgumentSeparator=e,this.isArgumentSeparatorChanged=!0},t.prototype.getParseDateTimeSeparator=function(){return this.parseDateTimeSeparator},t.prototype.setTreatEmptyStringAsZero=function(e){this.treatEmptyStringAsZero=e},t.prototype.getTreatEmptyStringAsZero=function(){return this.treatEmptyStringAsZero},t.prototype.setParseDateTimeSeparator=function(e){this.parseDateTimeSeparator=e},t.prototype.requiredModules=function(){return getModules(this)},t.Inject=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.prototype.injectedModules||(this.prototype.injectedModules=[]);for(var r=0;r<e.length;r++)-1===this.prototype.injectedModules.indexOf(e[r])&&this.prototype.injectedModules.push(e[r])},t.prototype.getInjectedModules=function(){return this.injectedModules},t.prototype.onPropertyChanged=function(e,t){},t.prototype.getModuleName=function(){return"calculate"},t.prototype.getFormulaCharacter=function(){return"="},t.prototype.isUpperChar=function(e){var t=e.charCodeAt(0);return t>64&&t<91},t.prototype.resetKeys=function(){this.storedData.clear(),this.keyToRowsMap.clear(),this.rowsToKeyMap.clear()},t.prototype.updateDependentCell=function(e){var t=this.getSheetFamilyItem(this.grid),r=this.cell;if(r!==this.emptyString){if(null!==t.sheetNameToParentObject){var n=t.parentObjectToToken.get(this.grid);-1===r.indexOf(this.sheetToken)&&(r=n+r),-1===e.indexOf(this.sheetToken)&&(e=n+e)}if(this.getDependentCells().has(e)){var i=this.getDependentCells().get(e);i.indexOf(r)<0&&i.push(r)}else this.getDependentCells().set(e,[r]);this.addToFormulaDependentCells(e)}},t.prototype.addToFormulaDependentCells=function(e){var t=this.cell,r=this.getSheetFamilyItem(this.grid);if(null!=r.sheetNameToParentObject&&-1===t.indexOf(this.sheetToken)){t=r.parentObjectToToken.get(this.grid)+t}this.getDependentFormulaCells().has(t)?this.getDependentFormulaCells().get(t).has(e)||this.getDependentFormulaCells().get(t).set(e,e):(this.getDependentFormulaCells().set(t,new Map),this.getDependentFormulaCells().get(t).set(e,e))},t.prototype.getDependentCells=function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null==e.sheetDependentCells&&(e.sheetDependentCells=new Map),e.sheetDependentCells}return null==this.dependentCells&&(this.dependentCells=new Map),this.dependentCells},t.prototype.getDependentFormulaCells=function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null==e.sheetDependentFormulaCells&&(e.sheetDependentFormulaCells=new Map),e.sheetDependentFormulaCells}return null==this.dependentFormulaCells&&(this.dependentFormulaCells=new Map),this.dependentFormulaCells},t.prototype.getLibraryFormulas=function(){return this.lFormulas},t.prototype.getFunction=function(e){return this.getLibraryFormulas().has(e.toUpperCase())?this.getLibraryFormulas().get(e.toUpperCase()).handler:null},t.prototype.intToDate=function(e){var t=Number(e);return(t=t>0&&t<1?1+t:0===t?1:t)>60&&(t-=1),new Date(864e5*(t-1)+new Date("01/01/1900").getTime())},t.prototype.getFormulaInfoTable=function(){if(this.isSheetMember()){var e=this.getSheetFamilyItem(this.grid);return null===e.sheetFormulaInfotable&&(e.sheetFormulaInfotable=new Map),e.sheetFormulaInfotable}return null===this.formulaInfoTable&&(this.formulaInfoTable=new Map),this.formulaInfoTable},t.prototype.getFormula=function(e){return e=e.toUpperCase(),this.storedData.has(e)?this.storedData.get(e).getFormulaText():""},t.prototype.getParseDecimalSeparator=function(){return this.isParseDecimalSeparatorChanged||"."===this.parseDecimalSeparator||(this.parseDecimalSeparator="."),this.parseDecimalSeparator},t.prototype.setParseDecimalSeparator=function(e){this.parseDecimalSeparator=e,this.isParseDecimalSeparatorChanged=!0},t.prototype.getSheetToken=function(e){var t=0,r=this.emptyString;if(t<e.length&&e[t]===this.sheetToken){for(t++;t<e.length&&e[t]!==this.sheetToken;)t++;r=e.substring(0,t+1)}if(t<e.length)return r;throw this.formulaErrorStrings[exports.FormulasErrorsStrings.bad_index]},t.prototype.getSheetID=function(e){var t=this.getSheetFamilyItem(e);if(null!=t.sheetNameToParentObject&&t.sheetNameToParentObject.size>0){var r=t.parentObjectToToken.get(e);if(r){r=r.split(this.sheetToken).join(this.emptyString);var n=this.parseFloat(r);if(!this.isNaN(n))return n}}return-1},t.prototype.parseFloat=function(e){return Number(e)},t.prototype.rowIndex=function(e){var t=0,r=!1;if(t<e.length&&e[t]===this.sheetToken){for(t++;t<e.length&&e[t]!==this.sheetToken;)t++;t++}for(;t<e.length&&this.isChar(e[t]);)r=!0,t++;var n=parseInt(e.substring(t),10);if(t<e.length&&!this.isNaN(n))return n;if(r)return-1;throw this.formulaErrorStrings[exports.FormulasErrorsStrings.bad_index]},t.prototype.colIndex=function(e){var t=0,r=0;if(e=e.toUpperCase(),t<e.length&&e[t]===this.sheetToken){for(t++;t<e.length&&e[t]!==this.sheetToken;)t++;t++}for(;t<e.length&&this.isChar(e[t]);){r=26*r+e[t].charCodeAt(0)-64,t++}return 0===r?-1:r},t.prototype.getErrorStrings=function(){return null===this.errorStrings&&(this.errorStrings=["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!"]),this.errorStrings},t.prototype.substring=function(e,t,r){return e.substring(t,r+t)},t.prototype.isChar=function(e){return e.charCodeAt(0)>=65&&e.charCodeAt(0)<=90||e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122},t.prototype.getSheetFamilyItem=function(e){if(0===this.sheetFamilyID)return null==this.defaultFamilyItem&&(this.defaultFamilyItem=new CalcSheetFamilyItem),this.defaultFamilyItem;null==this.sheetFamiliesList&&(this.sheetFamiliesList=new Map);var t=this.modelToSheetID.get(e);return this.sheetFamiliesList.has(t)||this.sheetFamiliesList.set(t,new CalcSheetFamilyItem),this.sheetFamiliesList.get(t)},t.prototype.setKeyValue=function(e,t){e=e.toUpperCase();var r=t.toString().trim();this.storedData.get(e)&&0!==r.indexOf(this.leftBrace)||(this.storedData.set(e,new FormulaInfo),this.keyToRowsMap.set(e,this.keyToRowsMap.size+1),this.rowsToKeyMap.set(this.rowsToKeyMap.size+1,e));var n=this.storedData.get(e);if(null!=n.getFormulaText()&&n.getFormulaText().length>0&&n.getFormulaText()!==r){var i=this.cellPrefix+this.keyToRowsMap.get(e).toString();null!=this.getDependentFormulaCells().get(i)&&this.clearFormulaDependentCells(i)}r.length>0&&r[0]===this.getFormulaCharacter()?n.setFormulaText(r):n.getFormulaValue()!==r&&(n.setFormulaText(""),n.setParsedFormula(""),n.setFormulaValue(r))},t.prototype.clearFormulaDependentCells=function(e){var t=this,r=this.getDependentFormulaCells().get(e);r&&(r.forEach(function(r,n){var i=n,o=t.getDependentCells().get(i);t.arrayRemove(o,e),0===o.length&&t.getDependentCells().delete(i)}),this.getDependentFormulaCells().delete(e))},t.prototype.arrayRemove=function(e,t){var r=e.indexOf(t);return-1!==r&&e.splice(r,1),e},t.prototype.getKeyValue=function(e){if(e=e.toUpperCase(),null!==this.storedData.has(e)){var t=this.storedData.get(e),r=t.getFormulaText();if(r.length>0&&r[0]===this.getFormulaCharacter()){this.cell=this.cellPrefix+this.keyToRowsMap.get(e).toString(),r=r.substring(1);try{t.setParsedFormula(this.parser.parseFormula(r,e))}catch(r){var n={message:r.message,exception:r,isForceCalculable:!1,computeForceCalculate:!1};return this.trigger("onFailure",n),t.setFormulaValue(n.message),this.storedData.get(e).getFormulaValue()}try{t.setFormulaValue(this.computeFormula(t.getParsedFormula()))}catch(e){n={message:e.message,exception:e,isForceCalculable:!1,computeForceCalculate:!1};this.trigger("onFailure",n);var i="string"==typeof n.exception?n.exception:n.message;return(ej2Base.isNullOrUndefined(this.getErrorLine(e))?"":"#"+this.getErrorLine(e)+": ")+i}}return this.storedData.get(e).getFormulaValue()}return this.emptyString},t.prototype.getNamedRanges=function(){return this.namedRanges},t.prototype.addNamedRange=function(e,t){var r=e.split(this.sheetToken);if(r.length>1){if(!this.getSheetFamilyItem(this.grid).parentObjectToToken.get(r[0]))return!1;e=r[0]+this.sheetToken+r[1].toUpperCase()}else e=e.toUpperCase();return this.namedRanges.set(e,t),!0},t.prototype.removeNamedRange=function(e){return e=e.toUpperCase(),null!=this.namedRanges.get(e)&&(this.namedRanges.delete(e),!0)},t.prototype.convertAlpha=function(e){for(var t=[],r=0;e>0;){e--;var n="A".charCodeAt(0);t[r]=String.fromCharCode(e%26+n),e=parseInt((e/26).toString(),10),r++}for(var i=[],o=0;o<r;o++)i[r-o-1]=t[o];return i.join("")},t.prototype.getCellCollection=function(e){if(e.indexOf(":")<0){if(!this.isCellReference(e))return e.split(this.getParseArgumentSeparator());e=e+":"+e}var t=this.emptyString,r=e.indexOf(this.sheetToken);if(r>-1)for(var n=r+1;n<e.length;){if(e[n]===this.sheetToken){t=e.substr(0,n+1);break}n++}var i,o,a,s,l=e.indexOf(":");if(l>0&&this.isChar(e[l-1]))for(var d=l-2;d>=0&&this.isDigit(e[d]);)d--;i=this.rowIndex(this.substring(e,0,l)),o=this.rowIndex(this.substring(e,l+1,l+e.length-l-1)),a=this.colIndex(this.substring(e,0,l)),s=this.colIndex(this.substring(e,l+1,l+e.length-l-1)),i>o&&(l=o,o=i,i=l),a>s&&(l=s,s=a,a=l);var p,h=[],c=0;for(l=i;l<=o;l++)for(p=a;p<=s;p++)h[c]=t+this.emptyString+this.convertAlpha(p)+l.toString(),c++;return h},t.prototype.computeFormula=function(e){return this.calculateFormula(e,!1)},t.prototype.calculateFormula=function(e,t){var r,n,i,o,a=!1;if(this.parser.isError)return e;r=this.parser.isFormulaParsed?e:this.parser.parseFormula(e),this.parser.isFormulaParsed=!1;try{if((n=this.findLastIndexOfq(r))>0&&(a=!0),r!==this.emptyString&&n>-1)for(var s=n+1;s>-1;)if(r[s]===this.rightBracket){var l=r.substring(n,s+1),d=l.split(this.leftBracket)[0].split("q").join(this.emptyString),p=void 0;if(this.getLibraryFormulas().get(d.toUpperCase()).isCustom){p=l.substring(l.indexOf(this.leftBracket)+1,l.indexOf(this.rightBracket)).split(this.getParseArgumentSeparator());var h=0,c=[];for(h=0;h<p.length;h++)c.push(this.getValueFromArg(p[h]));p=c}else{if(p=l.substring(l.indexOf(this.leftBracket)+1,l.indexOf(this.rightBracket)).replace(",n",",").split(this.getParseArgumentSeparator()),l.includes(this.getParseArgumentSeparator()+this.tic))for(var u=null,g=0;g<p.length;g++)p[g]&&p[g][0]===this.tic&&p[g][p[g].length-1]!==this.tic&&(u=g),null!==u&&u===g-1&&p[g][0]!==this.tic&&p[g][p[g].length-1]===this.tic&&(p[u]=p[u]+this.getParseArgumentSeparator()+p[g],p.splice(g,1),u=null);a&&d&&"IF"===d&&p.push("nestedFormulaTrue")}if(i=ej2Base.isNullOrUndefined(this.getFunction(d))?this.getErrorStrings()[exports.CommonErrors.name]:this.getFunction(d).apply(void 0,p),!a)break;o=this.processNestedFormula(r,l,i);var f=this.findLastIndexOfq(o);0===f&&(a=!1),-1===f&&(i=this.computeValue(o,t)),n=s=f,r=o}else s++;else this.formulaErrorStrings.indexOf(r)>-1?i=r:r!==this.emptyString&&-1===n&&(i=this.computeValue(r,t))}catch(e){p={message:e.message,exception:e,isForceCalculable:!1,computeForceCalculate:!1};this.trigger("onFailure",p);var m="string"==typeof p.exception?p.exception:p.message;i=(ej2Base.isNullOrUndefined(this.getErrorLine(e))?"":"#"+this.getErrorLine(e)+": ")+m}return i},t.prototype.computeSumIfAndAvgIf=function(e){if(ej2Base.isNullOrUndefined(e)||e[0]===this.emptyString||0===e.length)return this.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];for(var t=e,r=0;r<t.length;r++)if(this.isCellReference(t[r])&&ej2Base.isNullOrUndefined(t[r].match(/[0-9]/))&&t[r].indexOf("!")<0){var n=t[r].split(":");t[r]=n[0]+"1:"+n[1]+this.spreadSheetUsedRange[0]}var i=t.length;if(2!==i&&3!==i&&0===i)return this.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var o=t[0],a=t[1].trim();if((a=a.split(this.tic).join(this.emptyString)).length>255)return this.getErrorStrings()[exports.CommonErrors.value];var s=a.includes("*"),l=s?a.replace(/\*/g,"").trim():a;l=this.isCellReference(l)?this.getValueFromArg(l):a,s&&("*"===a[0]&&(l="*"+l),"*"===a[a.length-1]&&(l+="*")),a=l;var d=this.parser.tokenEqual;a.startsWith("<=")?(d=this.parser.tokenLessEq,a=a.substring(2)):a.startsWith(">=")?(d=this.parser.tokenGreaterEq,a=a.substring(2)):a.startsWith("<>")?(d=this.parser.tokenNotEqual,a=a.substring(2)):a.startsWith("<")?(d=this.parser.tokenLess,a=a.substring(1)):a.startsWith(">")?(d=this.parser.tokenGreater,a=a.substring(1)):a.startsWith("=")&&(d=this.parser.tokenEqual,a=a.substring(1));var p=this.parseFloat(a),h=t[0],c=this.getCellCollection(i>2?t[2]:o),u=this.getCellCollection(h),g=this.getComputeSumIfValue(u,c,a,p,d,s);return[g[0],g[1]]},t.prototype.findWildCardValue=function(e,t){var r="";if(e.indexOf("?")>-1){var n=e[(a=e.indexOf("?"))-1],i=e[a+1];if(t.indexOf(n)>-1&&t.indexOf(i)>-1){var o=t.indexOf(n);r=t[o]===n&&t[o+2]===i?e:t}else r=t}else if(e.indexOf("*")>-1){for(var a=e.indexOf("*"),s="",l="",d=this.falseValue,p=this.falseValue,h=a-1;h>=0;h--)s+=e[h],p=this.trueValue;for(h=a+1;h<e.length;h++)l+=e[h],d=this.trueValue;var c=""===s?-1:t.indexOf(s.split("").reverse().join("")),u=""===l?-1:t.indexOf(l);c>-1||u>-1?p===this.trueValue?r=s.split("").reverse().join("")===t.substr(0,s.length)?e:t:d===this.trueValue&&(r=l===t.substring(t.length-l.length,t.length)?e:t):r=t}return r},t.prototype.getComputeSumIfValue=function(e,t,r,n,i,o){var a=0,s=0;switch(i){case this.parser.tokenEqual:for(var l=o?r.replace(/\*/g,""):r,d=0;d<e.length;d++){var p=this.getValueFromArg(e[d].split(this.tic).join("")),h=this.parseFloat(p);if(p===r&&h===n){var c=this.getValueFromArg(t[d].split(this.tic).join(""));a+=this.parseFloat(c),s+=1}else p===r?(a+=this.getValueFromRange(t,d),s+=1):o&&l&&p&&("*"===r[0]&&l.length<=p.length&&l===p.slice(0,l.length)&&(a+=this.getValueFromRange(t,d),s+=1),"*"===r[r.length-1]&&l.length<=p.length&&l===p.slice(p.length-l.length,p.length)&&(a+=this.getValueFromRange(t,d),s+=1))}break;case this.parser.tokenLess:for(d=0;d<e.length;d++){p=this.getValueFromArg(e[d].split(this.tic).join(""));if((h=this.parseFloat(p))<n){c=this.getValueFromArg(t[d].split(this.tic).join(""));a+=this.parseFloat(c),s+=1}}break;case this.parser.tokenGreater:for(d=0;d<e.length;d++){p=this.getValueFromArg(e[d].split(this.tic).join(""));if((h=this.parseFloat(p))>n){c=this.getValueFromArg(t[d].split(this.tic).join(""));a+=this.parseFloat(c),s+=1}}break;case this.parser.tokenLessEq:for(d=0;d<e.length;d++){p=this.getValueFromArg(e[d].split(this.tic).join(""));if((h=this.parseFloat(p))<=n){c=this.getValueFromArg(t[d].split(this.tic).join(""));a+=this.parseFloat(c),s+=1}}break;case this.parser.tokenGreaterEq:for(d=0;d<e.length;d++){p=this.getValueFromArg(e[d].split(this.tic).join(""));if((h=this.parseFloat(p))>=n){c=this.getValueFromArg(t[d].split(this.tic).join(""));a+=this.parseFloat(c),s+=1}}break;case this.parser.tokenNotEqual:for(d=0;d<e.length;d++){p=this.getValueFromArg(e[d].split(this.tic).join("")),h=this.parseFloat(p);if(p!==r&&h!==n){c=this.getValueFromArg(t[d].split(this.tic).join(""));a+=this.parseFloat(c),s+=1}}}return[a,s]},t.prototype.getValueFromRange=function(e,t){var r=e[t];return r=this.getValueFromArg(r),this.parseFloat(r.toString())},t.prototype.computeAndOr=function(e,t){var r,n,i="and"===t;if(0===e.length)return this.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];for(var o=0,a=e.length;o<a;o++)if(e[o].split(this.tic).join("").trim()===this.emptyString)return this.getErrorStrings()[exports.CommonErrors.value];for(var s=e,l=0;l<s.length;l++){if(s[l]===this.tic)return this.getErrorStrings()[exports.CommonErrors.value];if(s[l].indexOf(":")>-1&&this.isCellReference(s[l]))for(var d=this.getCellCollection(s[l]),p=0;p<d.length;p++){if(this.getErrorStrings().indexOf(d[p])>-1)return d[p];if(d[p][0]===this.tic)return this.getErrorStrings()[exports.CommonErrors.name];if(""===(r=this.getValueFromArg(d[p]))&&(r=this.trueValue),this.getErrorStrings().indexOf(r)>-1)return r;n=this.parseFloat(r)}else{if(r=this.getValueFromArg(s[l]).split(this.tic).join("").toUpperCase(),this.getErrorStrings().indexOf(r)>-1)return r;var h=Date.parse(r.split(this.tic).join(""));if(isNaN(h)){if(r!==this.trueValue&&r!==this.falseValue)return this.getErrorStrings()[exports.CommonErrors.value].toString()}else i=!0;n=this.parseFloat(r)}i="and"===t?i&&(r===this.trueValue||!isNaN(n)):i||r===this.trueValue||!isNaN(n)}return i?this.trueValue:this.falseValue},t.prototype.removeTics=function(e){return e.length>1&&e[0]===this.tic[0]&&e[e.length-1]===this.tic[0]&&(e=this.substring(e,1,e.length-2)),e},t.prototype.getCellFrom=function(e){var t,r="",n=e.indexOf(":")>-1?e.split(":"):[e],i=n.length-1,o=this.rowIndex(n[0]);if(o===this.rowIndex(n[i])){var a=this.colIndex(n[0]),s=this.colIndex(n[i]),l=this.colIndex(this.cell);l>=a&&l<=s&&(r=getAlphalabel(l).toString()+o.toString())}else if(this.colIndex(n[0])===this.colIndex(n[i])){t=this.colIndex(n[0]);var d=this.rowIndex(n[i]),p=this.rowIndex(this.cell);p>=o&&p<=d&&(r=getAlphalabel(t).toString()+p.toString())}return r},t.prototype.computeValue=function(e,t){try{var r=[],n=0,i="";for(r.length=0;n<e.length;){var o="u"===e[n];if(e[n]!==this.arithMarker){if(this.isDigit(e[n])){for(var a=this.emptyString;n<e.length&&(this.isDigit(e[n])||e[n]===this.parseDecimalSeparator);)a+=e[n],n+=1;if(r.push(a),!e[n])return r.toString()}if(e[n]===this.sheetToken){for(i=e[n],n+=1;n<e.length&&e[n]!==this.sheetToken;)i+=e[n],n+=1;n<e.length&&(i+=e[n],n+=1)}else if(this.isUpperChar(e[n])){a=this.emptyString;for(var s="";n<e.length&&this.isUpperChar(e[n]);){a+=e[n],n+=1}for(;n<e.length&&this.isDigit(e[n]);){a+=e[n],n+=1}if(n<e.length&&":"===e[n]){if(a+=e[n],(n+=1)<e.length&&e[n]===this.sheetToken)for(a+=e[n],n+=1;n<e.length&&e[n]!==this.sheetToken;)a+=e[n],n+=1;for(;n<e.length&&this.isUpperChar(e[n]);)a+=e[n],n+=1;for(;n<e.length&&this.isDigit(e[n]);)a+=e[n],n+=1;a=i+this.getCellFrom(a)}else a=i+a;if(s=this.getParentObjectCellValue(a,t).toString(),i="","string"==typeof s&&this.getErrorStrings().indexOf(s)>-1)return s;r.push(s)}else if("q"===e[n]){var l=e.substring(n+1).indexOf(this.leftBracket),d=e.substring(n+l+1).indexOf(this.rightBracket);e=this.substring(e,n+l+2,d-1)}else if(e[n]===this.tic[0]){a=e[n].toString();for(n+=1;n<e.length&&e[n]!==this.tic[0];)a+=e[n],n+=1;r.push(a.split(this.tic).join(this.emptyString)),n+=1}else if("%"===e[n]&&r.length>0){var p=r[0],h=this.parseFloat(p);this.isNaN(h)||(r.pop(),r.push((h/100).toString())),n+=1}else if(0===e.substring(n).indexOf(this.trueValue))r.push(this.trueValue),n+=this.trueValue.length;else if(0===e.substring(n).indexOf(this.falseValue))r.push(this.falseValue),n+=this.falseValue.length;else if(e[n]===this.tic[0]||"|"===e[n]){a=e[n].toString();for(n++;n<e.length&&e[n]!==this.tic[0];)a+=e[n],n+=1;r.push(a+this.tic),n+=1}else switch(e[n]){case"#":var c=0;this.getErrorStrings().indexOf(e.substring(n))>-1?(c=-1===e.indexOf("!")||-1===e.substring(n).indexOf("!")?e.indexOf("#N/A")>-1?e.indexOf("#N/A")+4+n:e.indexOf("?")+1+n:e.indexOf("!")+1+n,r.push(this.substring(e,n,c-n))):(c=n+1,r.push(this.substring(e,n,c-n))),n=c;break;case"n":n+=1;a="";if(0===e.substring(n).indexOf("Infinity"))n+=(a="Infinity").length;else{for(("u"===e[n]||o||"-"===e[n])&&(a="-",o?o=!1:n+=1);n<e.length&&this.isDigit(e[n])||e[n]===this.getParseDecimalSeparator();)a+=e[n],n+=1;if(n<e.length&&"%"===e[n])if(n+=1,""===a){if(r.length>0){p=r[0],h=this.parseFloat(p);this.isNaN(h)||(r.pop(),r.push((h/100).toString()))}}else a=(this.parseFloat(a)/100).toString()}r.push(a);break;case this.parser.tokenAdd:this.getValArithmetic(r,"add"),n+=1;break;case this.parser.tokenSubtract:this.getValArithmetic(r,"sub"),n+=1;break;case this.parser.tokenMultiply:this.getValArithmetic(r,"mul"),n+=1;break;case this.parser.tokenDivide:this.getValArithmetic(r,"div"),n+=1;break;case this.parser.tokenLess:this.processLogical(r,"less"),n+=1;break;case this.parser.tokenGreater:this.processLogical(r,"greater"),n+=1;break;case this.parser.tokenGreaterEq:this.processLogical(r,"greaterEq"),n+=1;break;case this.parser.tokenLessEq:this.processLogical(r,"lessEq"),n+=1;break;case this.parser.tokenNotEqual:this.processLogical(r,"notEq"),n+=1;break;case this.parser.tokenOr:this.processLogical(r,"or"),n+=1;break;case this.parser.tokenAnd:this.processLogical(r,"and"),n+=1;break;case this.parser.tokenEqual:this.processLogical(r,"equal"),n+=1;break;default:return this.getErrorStrings()[exports.CommonErrors.value]}}else n+=1}if(0===r.length)return this.emptyString;a=this.emptyString;for(var u=r.length;u>0;){if((a=r.pop()+a)===this.emptyString&&this.isCellReference(e)&&this.getTreatEmptyStringAsZero())return"0";u--}return a}catch(e){if(this.getErrorStrings().indexOf(e)>-1||this.formulaErrorStrings.indexOf(e)>-1)throw e;throw new FormulaError(this.formulaErrorStrings[exports.FormulasErrorsStrings.invalid_expression])}},t.prototype.getValArithmetic=function(e,t){var r=e.pop();r=r===this.emptyString?"0":r;var n=Number(r);if(isNaN(n))throw r===this.getErrorStrings()[exports.CommonErrors.divzero]?this.getErrorStrings()[exports.CommonErrors.divzero]:this.getErrorStrings()[exports.CommonErrors.value];var i=e.pop();if(i=i===this.emptyString?"0":i,n=Number(i),isNaN(n))throw r===this.getErrorStrings()[exports.CommonErrors.divzero]?this.getErrorStrings()[exports.CommonErrors.divzero]:this.getErrorStrings()[exports.CommonErrors.value];"add"===t&&e.push((Number(i)+Number(r)).toString()),"sub"===t&&e.push((Number(i)-Number(r)).toString()),"mul"===t&&e.push((Number(i)*Number(r)).toString()),"div"===t&&(this.isNaN(this.parseFloat(r))||this.isNaN(this.parseFloat(i))?e.push(this.getErrorStrings()[exports.CommonErrors.value]):0===this.parseFloat(r)?e.push(this.getErrorStrings()[exports.CommonErrors.divzero]):e.push((Number(i)/Number(r)).toString()))},t.prototype.processLogical=function(e,t){var r,n,i,o;"and"!==t&&"equal"!==t&&(r=e.pop(),n=e.pop(),i=r.indexOf(this.tic)>-1?r:this.parseFloat(r),o=n.indexOf(this.tic)>-1?n:this.parseFloat(n));var a;return"less"===t&&(a=this.isNaN(i)||this.isNaN(o)?n.toUpperCase().split(this.tic).join("").localeCompare(r.toUpperCase().split(this.tic).join(""))<0?this.trueValue:this.falseValue:o<i?this.trueValue:this.falseValue),"greater"===t&&(a=this.isNaN(i)||this.isNaN(o)?n.toUpperCase().split(this.tic).join("").localeCompare(r.toUpperCase().split(this.tic).join(""))>0?this.trueValue:this.falseValue:o>i?this.trueValue:this.falseValue),"lessEq"===t&&(a=this.isNaN(i)||this.isNaN(o)?n.toUpperCase().split(this.tic).join("").localeCompare(r.toUpperCase().split(this.tic).join(""))<=0?this.trueValue:this.falseValue:o<=i?this.trueValue:this.falseValue),"greaterEq"===t&&(a=this.isNaN(i)||this.isNaN(o)?n.toUpperCase().split(this.tic).join("").localeCompare(r.toUpperCase().split(this.tic).join(""))>=0?this.trueValue:this.falseValue:o>=i?this.trueValue:this.falseValue),"notEq"===t&&(a=n!==r?this.trueValue:this.falseValue),"and"===t&&(r=e.pop().toString(),n="",e.length>0&&(n=e.pop().toString()),a=(a=this.emptyString+n+r+this.emptyString).split(this.tic).join("")),"equal"===t&&(r=e.pop().toString(),""===(n=e.pop().toString())&&""!==r&&(n="0"),a=r===n?this.trueValue:this.falseValue),"or"===t&&(a=Math.pow(this.parseFloat(o),this.parseFloat(i)).toString()),e.push(a),a},t.prototype.computeStoreCells=function(e){for(var t=e.cellValue,r=e.cellRange,n=e.criteria,i=e.argArray,o=e.isCriteria,a=e.storedCells,s=e.isCountIfS,l=e.countVal,d=o===this.trueValue?a:t,p=[],h=0;h<d.length;h++){var c=[],u=this.getValueFromArg(t[h]),g=void 0,f="";if(g=i[2].split(this.tic).join(this.emptyString),g=this.isCellReference(g)?this.getValueFromArg(g):g,(o=s===this.trueValue?this.trueValue:o)===this.trueValue){var m="",v=0,C=0;for(a[h]=s===this.trueValue&&0===l?t[h]:a[h],m=a[h];!this.isDigit(m[v]);)v+=1;if(this.isCellReference(r[l])&&r[l].indexOf(":")>-1){var y=r[l].indexOf(":");for(f=this.substring(r[l],y);!this.isDigit(f[C]);)C+=1}var x=this.substring(m,v),b=this.substring(f,C);f=a[h].split(x).join(b),u=this.getValueFromArg(f),g=s===this.trueValue?n[l].split(this.tic).join(this.emptyString):n[l-1].split(this.tic).join(this.emptyString)}var S="equal";g.startsWith("<=")?(S="lessEq",g=g.substring(2)):g.startsWith(">=")?(S="greaterEq",g=g.substring(2)):g.startsWith("<>")?(S="notEq",g=g.substring(2)):g.startsWith("<")?(S="less",g=g.substring(1)):g.startsWith(">")?(S="greater",g=g.substring(1)):g.startsWith("=")&&(S="equal",g=g.substring(1)),(g.indexOf("*")>-1||g.indexOf("?")>-1)&&(u=this.findWildCardValue(g,u)),c.push(u.toLowerCase()),c.push(g.toLowerCase()),this.processLogical(c,S)===this.trueValue&&(o===this.falseValue?p.push(t[h]):p.push(f))}return a=p,p=[],a},t.prototype.computeIfsFormulas=function(e,t,r){if(ej2Base.isNullOrUndefined(e)||""===e[0]||0===e.length)return this.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];var n=e,i=n.length;if(i<2||i>127)return this.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];for(var o=[],a=[],s=[],l=0,d=0;d<n.length;d++)n[d].indexOf(":")>-1&&this.isCellReference(n[d])?o.push(n[d]):a.push(n[d]);o=(o=o.toString().split(",,").join(",")).split(this.getParseArgumentSeparator());var p=[];for(d=0;d<o.length;d++)p.push(this.getCellCollection(o[d]).length);for(var h=0;h<p.length;h++)if(p[h]&&p[h+1]&&p[h]!==p[h+1])return this.getErrorStrings()[exports.CommonErrors.value];var c,u;if(t===this.falseValue){u=this.falseValue;var g={cellValue:c=this.getCellCollection(o[1]),cellRange:o,criteria:a,argArray:n,isCriteria:u,storedCells:s,isCountIfS:t};if(s=this.computeStoreCells(g),0===s.length)return r===this.trueValue?this.getErrorStrings()[exports.CommonErrors.divzero]:0}for(d=t===this.trueValue?0:2;d<o.length;d++){u=this.trueValue,u=t===this.trueValue&&0===d?this.falseValue:this.trueValue;g={cellValue:c=this.getCellCollection(o[d]),cellRange:o,criteria:a,argArray:n,isCriteria:u,storedCells:s,isCountIfS:t,countVal:d};if(s=this.computeStoreCells(g),0===s.length)return 0}var f=0;for(h=0;h<s.length;h++){var m="",v="",C=0,y=0;for(m=s[h];!this.isDigit(m[C]);)C+=1;if(this.isCellReference(o[0])&&o[0].indexOf(":")>-1){var x=o[0].indexOf(":");for(v=this.substring(o[0],x);!this.isDigit(v[y]);)y+=1}var b=this.substring(m,C),S=this.substring(v,y);if(c=s[h].split(b).join(S),t===this.trueValue)l+=1;else{f++;var w=this.getValueFromArg(c);l+=parseFloat(""===w?"0":w)}}return r===this.trueValue&&(l/=f),l},t.prototype.processNestedFormula=function(e,t,r){return e.split(t).join("n"+r)},t.prototype.isNaN=function(e){return"NaN"===e.toString()||"string"==typeof e},t.prototype.fromOADate=function(e){var t=new Date;return t.setTime(e*this.millisecondsOfaDay+Date.parse(this.oaDate.toString())),t},t.prototype.getSerialDateFromDate=function(e,t,r){var n=0;e<1900&&(e+=1900);for(var i=!1;!i;){for(;t>12;)e++,t-=12;i=!0;for(var o=new Date(e,t,1,-1).getDate();r>o;)o=new Date(e,t,1,-1).getDate(),t++,r-=o,i=!1;r<1&&(t--,r=(o=new Date(e,t,1,-1).getDate())-r)}var a=Date.parse(e.toString()+this.getParseDateTimeSeparator()+t.toString()+this.getParseDateTimeSeparator()+r.toString());return this.isNaN(a)||(n=this.toOADate(new Date(a))),n},t.prototype.intToTime=function(e){if(ej2Base.isNullOrUndefined(e))return"";var t=e.toString().split(".");ej2Base.isNullOrUndefined(t[1])||(e=parseFloat(t[0]+1+"."+t[1])||e);var r=this.intToDate(e.toString());return(new ej2Base.Internationalization).formatDate(r,{type:"time",skeleton:"medium",format:"h:mm:ss a"})},t.prototype.toOADate=function(e){return(e.getTime()-Date.parse(this.oaDate.toString()))/this.millisecondsOfaDay},t.prototype.calculateDate=function(e){return this.parseFloat(e)<10?"0"+e:e},t.prototype.isTextEmpty=function(e){return null===e||""===e},t.prototype.isDigit=function(e){var t=e.charCodeAt(0);return t>47&&t<58},t.prototype.findLastIndexOfq=function(e){return e.lastIndexOf("q")},t.prototype.getValueFromArg=function(e,t){var r=e=e.trim(),n=this.dateTime1900,i=r;if(ej2Base.isNullOrUndefined(r)||this.isTextEmpty(r))return r;if(e[0]===this.tic||e[0]===this.singleTic)return n=this.isDate(e.split(this.tic).join("")),this.isNaN(this.parseFloat(e.split(this.tic).join("")))&&!ej2Base.isNullOrUndefined(n)&&!this.isNaN(n.getDate())&&this.dateTime1900<=n?this.toOADate(n).toString():e;if(e=e.split("u").join("-"),!this.isUpperChar(r[0])&&(this.isDigit(r[0])||r[0]===this.getParseDecimalSeparator()||"-"===r[0]||"n"===r[0]))return"n"===r[0]&&(r=r.substring(1)).indexOf('"n')>-1&&(r=r.replace('"n','"')),r;if(-1===this.parser.indexOfAny(r,["+","-","/","*",")",")","{"])&&this.isUpperChar(r[0])||r[0]===this.sheetToken){if(r!==this.trueValue&&r!==this.falseValue&&this.isCellReference(r)){var o=this.getSheetFamilyItem(this.grid);if(null!==o.sheetNameToParentObject&&o.sheetNameToParentObject.size>0&&-1===r.indexOf(this.sheetToken)){r=o.parentObjectToToken.get(this.grid)+r}}if(r===this.cell){var a=this.getDependentCells().get(r);if(null!=a&&a.indexOf(r)>-1&&this.arrayRemove(a,r),this.getDependentFormulaCells().has(this.cell)||this.clearFormulaDependentCells(this.cell),!t)throw this.formulaErrorStrings[exports.FormulasErrorsStrings.circular_reference]+r}return i=this.getParentObjectCellValue(r,!1,t),this.updateDependentCell(r),i.toString()}return this.getErrorStrings().indexOf(e)>-1?e:this.computeValue(i.toString(),!1)},t.prototype.isDate=function(e){if("object"==typeof e||null!==Date.parse(e)){var t=new Date(Date.parse(e));return t>=this.dateTime1900?t:null}return null},t.prototype.isValidCellReference=function(e){var t=0,r=0,n=[89,71,69],i=this.emptyString;if(this.namedRanges.has(e))return!1;for(var o=0;o<e.length;o++)this.isChar(e[o])&&t++;if((i=e.substring(0,t)).length<4){for(;r<i.length;){if(ej2Base.isNullOrUndefined(i[r])||!(i[r].charCodeAt(0)<n[r])){if(ej2Base.isNullOrUndefined(i[r])&&r>0)break;return!1}r++}if(this.parseFloat(e.substring(t,e.length))<1048576)return!0}return!1},t.prototype.parseDate=function(e){if(!this.isNaN(e)){if(e instanceof Date)return new Date(e);var t=parseInt(e,10);return t<0?this.getErrorStrings()[exports.CommonErrors.num]:t<=60?new Date(this.dateTime1900.getTime()+864e5*(t-1)):new Date(this.dateTime1900.getTime()+864e5*(t-2))}return"string"!=typeof e||(e=new Date(e),this.isNaN(e))?this.getErrorStrings()[exports.CommonErrors.value]:e},t.prototype.isCellReference=function(e){if(e===this.emptyString)return!1;e=e.trim(),e=this.setTokensForSheets(e);var t=this.getSheetToken(e),r=!1;""!==t&&(e=e.split(t).join(this.emptyString));var n=!1,i=!1;if(e.indexOf(":")!==e.lastIndexOf(":"))return!1;for(var o=e.split("").join(this.getParseArgumentSeparator()).split(this.getParseArgumentSeparator()),a=0;a<o.length;a++)if(this.isChar(o[a]))n=!0;else if(this.isDigit(o[a]))i=!0;else{if(":"!==o[a])return!1;n&&i&&(r=!0),n=!1,i=!1}return e.indexOf(":")>-1&&-1===e.indexOf(this.tic)?!!(r&&n&&i)||!(!(n&&!i||!n&&i)||r):!(!n||!i||-1!==e.indexOf(this.tic))},t.prototype.setTokensForSheets=function(e){var t=this.getSheetFamilyItem(this.grid),r=this.getSortedSheetNames();if(null!=r)for(var n=0;n<r.length;n++){var i=t.sheetNameToToken.get(r[n]);i=i.split(this.sheetToken).join(this.tempSheetPlaceHolder);var o=this.singleTic+"SHEET"+r[n]+this.singleTic+this.sheetToken;-1===e.indexOf(o)&&(o="SHEET"+r[n]+this.sheetToken),e=e.split(o).join(i),o=r[n]+this.sheetToken,e=e.split(o).join(i)}if((e=e.split(this.tempSheetPlaceHolder).join(this.sheetToken)).indexOf("!!")>-1){var a=(e=e.replace("!!","!")).split("");a[1]=(parseInt(a[1],10)+1).toString(),e=a.join("")}return e},t.prototype.getParentObjectCellValue=function(e,t,r){if(e===this.trueValue||e===this.falseValue)return e;var n=e.lastIndexOf(this.sheetToken),i=0,o=0,a=this.grid,s=this.getSheetFamilyItem(a);if(n>-1&&null!==s.tokenToParentObject)this.grid=s.tokenToParentObject.get(e.substring(0,n+1)),i=this.rowIndex(e),o=this.colIndex(e);else if(-1===n){for(var l=0;l<e.length&&this.isChar(e[l]);)l++;if(l===e.length)return""===(e=e.toLowerCase())?this.getErrorStrings()[exports.CommonErrors.value]:this.getErrorStrings()[exports.CommonErrors.name];i=this.rowIndex(e),o=this.colIndex(e),s.isSheetMember&&null!=s.parentObjectToToken&&(e=s.parentObjectToToken.get(this.grid)+e)}var d=""===this.cell||null===this.cell?"":this.cell;if(this.cell=e,d===this.cell&&!r)throw this.formulaErrorStrings[exports.FormulasErrorsStrings.circular_reference];var p=this.getParentCellValue(i,o,this.grid,d,a,t);return this.grid=a,this.cell=d,p},t.prototype.getParentCellValue=function(e,t,r,n,i,o){var a,s=this.getSheetId(r);return void 0!==this.parentObject.getValueRowCol?(n&&(n=i===r?"":n+","+(i&&"string"==typeof i&&Number(i)>-1?i:this.getSheetID(i))),a=this.parentObject.getValueRowCol(s,e,t,n,o),ej2Base.isNullOrUndefined(a)?this.emptyString:a.toString()):(""!==(a=this.getValueRowCol(s,e,t))&&void 0!==a||(a=""),a)},t.prototype.getSheetId=function(e){return e&&"string"==typeof e&&Number(e)>-1?Number(e):this.getSheetID(e)+1},t.prototype.getValueRowCol=function(e,t,r){var n=this.rowsToKeyMap.get(t).toString(),i=this.getKeyValue(n).toString();if(null!=i&&"%"===i[i.length-1]&&i.length>1){var o=this.parseFloat(i.substring(0,i.length-1));this.isNaN(o)&&(i=(Number(o)/100).toString())}return i},t.prototype.defineFunction=function(e,t){"string"==typeof t&&(t=ej2Base.getValue(t,window)),e=e.toUpperCase(),this.libraryFormulas.set(e,{handler:t,isCustom:!0})},t.prototype.valueChanged=function(e,t,r,n,i,o,a){var s=e;this.spreadSheetUsedRange=n,this.grid=e,this.skipSpill=a;var l=!0,d=!0,p=this.getSheetFamilyItem(s),h=getAlphalabel(t.getColIndex())+t.getRowIndex().toString();if(this.actCell=o+"!"+h,null!==p.sheetNameToParentObject&&p.sheetNameToParentObject.size>0){h=p.parentObjectToToken.get(s)+h}var c=t.getValue().toUpperCase();if(c.indexOf("=RAND()")>-1||c.indexOf("RAND()")>-1||c.indexOf("=RANDBETWEEN(")>-1||c.indexOf("RANDBETWEEN(")>-1||this.randomValues.has(h)){var u=this.randCollection.toString();this.randomValues.has(h)?this.randomValues.has(h)&&(c.indexOf("=RAND()")>-1||c.indexOf("RAND()")>-1||c.indexOf("=RANDBETWEEN(")>-1||c.indexOf("RANDBETWEEN(")>-1?this.randomValues.set(h,t.getValue()):t.getValue().toUpperCase()!==this.randomValues.get(h.toUpperCase())&&(this.randomValues.delete(h),u=u.split(h+this.parseArgumentSeparator).join("").split(this.parseArgumentSeparator+h).join("").split(h).join(""),this.randCollection=u.split(this.parseArgumentSeparator)),0===this.randomValues.size&&this.randCollection.length&&(this.isRandomVal=!1,this.randomValues.clear(),this.randCollection=[])):(this.randomValues.set(h,t.getValue()),this.randCollection.push(h),this.isRandomVal=!0)}if(t.getValue()&&t.getValue()[0]===this.getFormulaCharacter()){this.cell=h;var g=void 0;if(ej2Base.isNullOrUndefined(d)||(d=r),this.getFormulaInfoTable().has(h)){if(g=this.getFormulaInfoTable().get(h),t.getValue()!==g.getFormulaText()||null==g.getParsedFormula()){g.setFormulaText(t.getValue()),this.getDependentFormulaCells().has(this.cell)&&this.clearFormulaDependentCells(this.cell);try{g.setParsedFormula(this.parser.parseFormula(t.getValue()))}catch(e){g.setFormulaValue(e),d=!1}}if(d){this.parser.isFormulaParsed=!0;var f=this.calculateFormula(g.getParsedFormula(),i);l=f!==g.getFormulaValue(),g.setFormulaValue(f)}}else{(g=new FormulaInfo).setFormulaText(t.getValue()),this.getDependentFormulaCells().has(h)||this.getDependentFormulaCells().set(h,new Map);try{g.setParsedFormula(this.parser.parseFormula(t.getValue()))}catch(e){g.setFormulaValue(e),d=!1}d&&g.setFormulaValue(this.calculateFormula(g.getParsedFormula(),i)),this.getFormulaInfoTable().has(h),this.getFormulaInfoTable().set(h,g)}d&&(void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(s)+1,g.getFormulaValue(),t.getRowIndex(),t.getColIndex()):this.parentObject.setValueRowCol(this.getSheetId(s),g.getFormulaValue(),t.getRowIndex(),t.getColIndex(),g.getFormulaText()))}else this.getFormulaInfoTable().has(h)&&(this.getFormulaInfoTable().delete(h),this.getDependentFormulaCells().has(h)&&this.clearFormulaDependentCells(h));d&&l&&this.getDependentCells().has(h)&&this.getDependentCells().get(h).toString()!==h&&(this.getComputedValue().clear(),this.refresh(h))},t.prototype.getComputedValue=function(){return null===this.computedValues&&(this.computedValues=new Map),this.computedValues},t.prototype.setValueRowCol=function(e,t,r,n){},t.prototype.getSortedSheetNames=function(){var e=this.getSheetFamilyItem(this.grid);if(null!=e&&null!=e.sheetNameToToken){var t=[];e.sheetNameToToken.forEach(function(e,r){t.push(r),t.sort()}),this.sortedSheetNames=t,this.sortedSheetNames.sort(),this.sortedSheetNames.length>9&&this.sortedSheetNames[0].includes("1")&&this.sortedSheetNames[1].includes("10")&&(this.sortedSheetNames.splice(this.sortedSheetNames.indexOf("2"),0,this.sortedSheetNames[0]),this.sortedSheetNames.splice(0,1))}return this.sortedSheetNames},t.prototype.getErrorLine=function(e){var t=e.stack?e.stack.split("\n")[1].split(":"):null;return t?t[t.length-2]:null},t.prototype.createSheetFamilyID=function(){return this.sheetFamilyID===Number.MAX_SAFE_INTEGER&&(this.sheetFamilyID=Number.MIN_SAFE_INTEGER),this.sheetFamilyID++},t.prototype.computeMinMax=function(e,t){var r,n,i=0;if(ej2Base.isNullOrUndefined(e)||0===e.length)return this.formulaErrorStrings[exports.FormulasErrorsStrings.wrong_number_arguments];for(var o=0,a=e.length;o<a;o++)if(e[o].split(this.tic).join("").trim()===this.emptyString)return this.getErrorStrings()[exports.CommonErrors.value];r="max"===t?this.minValue:this.maxValue;var s=e;if(s.length>255)return this.getErrorStrings()[exports.CommonErrors.value];for(var l=0;l<s.length;l++)if(s[l].indexOf(":")>-1&&this.isCellReference(s[l]))for(var d=this.getCellCollection(s[l]),p=0;p<d.length;p++){if(n=this.getValueFromArg(d[p]),this.getErrorStrings().indexOf(n)>-1)return n;var h=this.parseFloat(n);""===n||this.isNaN(this.parseFloat(h))?(i+=1)===d.length&&(r=0):r="max"===t?Math.max(r,h):Math.min(r,h)}else{var c=this.getValueFromArg(s[l])||"0";if(this.getErrorStrings().indexOf(c)>-1)return c;h=this.isNaN(this.parseFloat(c))?0:this.parseFloat(c);r="max"===t?Math.max(r,h):Math.min(r,h)}return r.toString()},t.prototype.calculateAvg=function(e){for(var t=0,r=e,n=[],i=0,o=0,a=0;a<r.length;a++)if(r[a].indexOf(":")>-1&&this.isCellReference(r[a])){o=0,n=this.getCellCollection(r[a]),i=0;for(var s=0;s<n.length;s++){var l=this.getValueFromArg(n[s]);ej2Base.isNullOrUndefined(l)||isNaN(this.parseFloat(l))||(i+=this.parseFloat(l),o+=1)}if(0===o)return this.getErrorStrings()[exports.CommonErrors.divzero];t=(i/=o)+t}else{if(r[a].indexOf(this.tic)>-1&&isNaN(parseFloat(r[a].split(this.tic).join(""))))return this.getErrorStrings()[exports.CommonErrors.value];0===r[a].length&&(r[a]="1");l=this.getValueFromArg(r[a].split(this.tic).join(""));if(ej2Base.isNullOrUndefined(l)||isNaN(this.parseFloat(l)))return this.getErrorStrings()[exports.CommonErrors.name];t+=this.parseFloat(l)}return(t/(r.length-0)).toString()},t.prototype.registerGridAsSheet=function(e,t,r){ej2Base.isNullOrUndefined(this.modelToSheetID)&&(this.modelToSheetID=new Map),ej2Base.isNullOrUndefined(this.modelToSheetID.get(t))&&this.modelToSheetID.set(t,r);var n=this.getSheetFamilyItem(t);n.isSheetMember=!0;var i=e.toUpperCase();if(0===n.parentObjectToToken.size&&(n.parentObjectToToken=new Map),0===n.sheetNameToParentObject.size&&(n.sheetNameToParentObject=new Map),0===n.sheetNameToToken.size&&(n.sheetNameToToken=new Map),0===n.tokenToParentObject.size&&(n.tokenToParentObject=new Map),ej2Base.isUndefined(n.sheetNameToParentObject.get(i))){o=this.sheetToken+this.tokenCount.toString()+this.sheetToken;this.tokenCount++,n.tokenToParentObject.set(o,t),n.parentObjectToToken.set(t,o),n.sheetNameToToken.set(i,o),n.sheetNameToParentObject.set(i,t)}else{var o=n.sheetNameToToken.get(i);n.tokenToParentObject.set(o,t),n.parentObjectToToken.set(t,o)}return e},t.prototype.unregisterGridAsSheet=function(e,t,r){var n=this,i=[t];r&&(i=[],ej2Base.isNullOrUndefined(this.modelToSheetID)||this.modelToSheetID.forEach(function(e,t){i.push(t)})),i.forEach(function(t){var i=n.getSheetFamilyItem(t),o=(r?t:e).toUpperCase();if(null!=i.sheetNameToParentObject&&i.sheetNameToParentObject.has(o)){i.sheetNameToParentObject.delete(o);var a=i.sheetNameToToken.get(o);i.sheetNameToToken.delete(o),i.tokenToParentObject.delete(a),i.parentObjectToToken.delete(t),r&&(i.sheetDependentCells=new Map)}})},t.prototype.computeExpression=function(e){var t=this.parser.parseFormula(e);return this.computeFormula(t)},t.prototype.isSheetMember=function(){var e=this.getSheetFamilyItem(this.grid);return!ej2Base.isNullOrUndefined(e)&&e.isSheetMember},t.prototype.dispose=function(){this.resetKeys(),this.namedRanges.clear(),this.lFormulas.clear()},t.prototype.refreshRandValues=function(e){var t,r,n,i,o="",a=this.randCollection.toString();this.randomValues.has(e)&&(this.randomValues.delete(e),a=a.split(e+this.parseArgumentSeparator).join("").split(this.parseArgumentSeparator+e).join("").split(e).join(""),0===this.randomValues.size&&""===a?(this.randomValues.clear(),this.randCollection=[]):this.randCollection=a.split(this.parseArgumentSeparator));for(var s=0;s<this.randomValues.size;s++)t=this.rowIndex(this.randCollection[s]),r=this.colIndex(this.randCollection[s]),o=(parseFloat(this.getSheetToken(this.randCollection[s]).split(this.sheetToken).join(""))+1).toString(),i=this.getSheetFamilyItem(o),this.grid=i.sheetNameToParentObject.get(o),n=this.randomValues.get(this.randCollection[s]),n=this.computeFormula(n),void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(this.grid)+1,n,t,r):this.parentObject.setValueRowCol(this.getSheetId(this.grid),n,t,r)},t.prototype.refresh=function(e){if(0===this.dependencyLevel&&this.refreshedCells.clear(),this.getDependentCells().has(e)&&null!==this.getDependentCells().get(e)){var t=this.getSheetFamilyItem(this.grid);this.dependencyLevel=this.dependencyLevel+1;try{var r=this.getDependentCells().get(e),n=void 0;for(n=0;n<r.length;n++){var i=r[n],o=this.getSheetToken(i);this.actCell=i.split(o)[1],o.length&&(this.grid=t.tokenToParentObject.get(o));try{var a=this.rowIndex(i),s=this.colIndex(i),l=this.getFormulaInfoTable().get(i),d=void 0;l&&(this.cell=i,this.getComputedValue().has(i)?d=this.getComputedValue().get(i):(this.parser.isFormulaParsed=!0,d=this.calculateFormula(l.getParsedFormula(),!0),this.computedValues.set(i,d)),l.setFormulaValue(d)),void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(this.grid)+1,l.getFormulaValue(),a,s):this.parentObject.setValueRowCol(this.getSheetId(this.grid),l.getFormulaValue(),a,s,l.getFormulaText()),this.refreshedCells.has(i)||(this.refreshedCells.set(i,[]),this.refresh(i))}catch(e){continue}}}finally{this.grid=t.tokenToParentObject.get(this.getSheetToken(e)),this.dependencyLevel--,0===this.dependencyLevel&&this.refreshedCells.clear()}}};var r;return __decorate$2([ej2Base.Property(!0)],t.prototype,"includeBasicFormulas",void 0),__decorate$2([ej2Base.Event()],t.prototype,"onFailure",void 0),t=r=__decorate$2([ej2Base.NotifyPropertyChanges],t)}(ej2Base.Base),FormulaError=function(){return function(e,t){this.formulaCorrection=!1,this.message=e,this.formulaCorrection=t}}(),FormulaInfo=function(){function e(){this.calcID=Number.MIN_VALUE+1,this.calcID1=Number.MIN_VALUE+1}return e.prototype.getFormulaText=function(){return this.formulaText},e.prototype.setFormulaText=function(e){this.formulaText=e},e.prototype.getFormulaValue=function(){return this.formulaValue},e.prototype.setFormulaValue=function(e){this.formulaValue=e},e.prototype.getParsedFormula=function(){return this.parsedFormula},e.prototype.setParsedFormula=function(e){this.parsedFormula=e},e}(),CalcSheetFamilyItem=function(){return function(){this.isSheetMember=!1,this.parentObjectToToken=new Map,this.sheetDependentCells=new Map,this.sheetDependentFormulaCells=new Map,this.sheetNameToParentObject=new Map,this.sheetNameToToken=new Map,this.tokenToParentObject=new Map,this.sheetFormulaInfotable=new Map}}(),ValueChangedArgs=function(){return function(e,t,r){return this.row=e,this.col=t,this.value=r,this.getRowIndex=function(){return e},this.setRowIndex=function(t){e=t},this.getColIndex=function(){return t},this.setColIndex=function(e){t=e},this.getValue=function(){return r},this}}(),WorkbookFormula=function(){function e(e){this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.uniqueMOperator=String.fromCharCode(135),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueLTOperator=String.fromCharCode(142),this.sheetInfo=[],this.parent=e,this.init()}return e.prototype.init=function(){this.addEventListener(),this.initCalculate(),this.registerSheet()},e.prototype.destroy=function(){this.removeEventListener(),this.calculateInstance.dispose(),this.calculateInstance=null,this.parent=null},e.prototype.addEventListener=function(){this.parent.on(workbookFormulaOperation,this.performFormulaOperation,this),this.parent.on(aggregateComputation,this.aggregateComputation,this),this.parent.on(getUniqueRange,this.getUniqueRange,this),this.parent.on(removeUniquecol,this.removeUniquecol,this),this.parent.on(clearFormulaDependentCells,this.clearFormulaDependentCells,this),this.parent.on(getFormulaInfoTable,this.getFormulaInfoTable,this),this.parent.on(formulaInValidation,this.formulaInValidation,this),this.parent.on(refreshInsertDelete,this.refreshInsertDelete,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(workbookFormulaOperation,this.performFormulaOperation),this.parent.off(aggregateComputation,this.aggregateComputation),this.parent.off(getUniqueRange,this.getUniqueRange),this.parent.off(removeUniquecol,this.removeUniquecol),this.parent.off(clearFormulaDependentCells,this.clearFormulaDependentCells),this.parent.off(getFormulaInfoTable,this.getFormulaInfoTable),this.parent.off(formulaInValidation,this.formulaInValidation),this.parent.off(refreshInsertDelete,this.refreshInsertDelete))},e.prototype.getModuleName=function(){return"workbookFormula"},e.prototype.initCalculate=function(){this.calculateInstance=new Calculate(this.parent),this.calcID=this.calculateInstance.createSheetFamilyID(),this.calculateInstance.setTreatEmptyStringAsZero(!0),this.calculateInstance.grid=this.parent.getActiveSheet().id.toString()},e.prototype.clearFormulaDependentCells=function(e){var t=e.cellRef;t=t.split(":")[0],t="!"+this.parent.activeSheetIndex+"!"+t,this.calculateInstance.clearFormulaDependentCells(t)},e.prototype.formulaInValidation=function(e){var t=this.calculateInstance.getLibraryFormulas().get(e.value);e.skip=ej2Base.isNullOrUndefined(t)},e.prototype.performFormulaOperation=function(e){var t,r=e.action,n=this.calculateInstance.getLibraryFormulas(),i=Array.from(n.values());switch(r){case"getLibraryFormulas":e.formulaCollection=Array.from(n.keys());break;case"getFormulaCategory":t=["All"];for(var o=1;o<Array.from(n.values()).length;o++)t.indexOf(i[o].category)<0&&t.push(i[o].category);e.categoryCollection=t;break;case"dropDownSelectFormulas":for(o=0;o<Array.from(n.values()).length;o++)e.selectCategory===i[o].category&&(e.formulaCollection[o]=Array.from(n.keys())[o]);break;case"getFormulaDescription":for(o=0;o<Array.from(n.values()).length;o++)e.selectedList===Array.from(n.keys())[o]&&(e.description=i[o].description);break;case"registerSheet":this.registerSheet(e.sheetIndex,e.sheetCount),e.isImport&&this.updateSheetInfo();break;case"unRegisterSheet":this.unRegisterSheet(e.sheetIndex,e.sheetCount,e.propertyChange);break;case"initSheetInfo":this.updateSheetInfo();break;case"refreshCalculate":e.isFormula&&(e.value=this.autoCorrectFormula(e.value,e.rowIndex,e.colIndex,e.sheetIndex),e.isClipboard&&e.value.toString().toUpperCase().includes("UNIQUE")&&(this.parent.sheets[e.sheetIndex].rows[e.rowIndex].cells[e.colIndex].value="")),this.refreshCalculate(e.rowIndex,e.colIndex,e.value,e.isFormula,e.sheetIndex,e.isRefreshing,e.skip),e.value=e.value?e.value.toString().split("-*").join("-").split("/*").join("/").split("*/").join("*").split("-/").join("-").split("*+").join("*").split("+*").join("+"):e.value;break;case"getArgumentSeparator":e.argumentSeparator=this.calculateInstance.getParseArgumentSeparator();break;case"addDefinedName":e.isAdded=this.addDefinedName(e.definedName,!1,e.index,e.isEventTrigger);break;case"removeDefinedName":e.isRemoved=this.removeDefinedName(e.definedName,e.scope,e.isEventTrigger);break;case"initiateDefinedNames":this.initiateDefinedNames();break;case"renameUpdation":this.renameUpdation(e.value,e.pName);break;case"addSheet":this.sheetInfo.push({visibleName:e.visibleName,sheet:e.sheetName,index:e.sheetId});break;case"getSheetInfo":e.sheetInfo=this.sheetInfo;break;case"deleteSheetTab":for(o=0;o<this.sheetInfo.length;o++)if(this.sheetInfo[o].index===e.sheetId){var a=this.sheetInfo[o].sheet;this.sheetInfo.splice(o,1);var s=e.sheetId.toString();this.sheetDeletion(a,s),this.calculateInstance.unregisterGridAsSheet(s,s);break}break;case"getReferenceError":e.refError=this.referenceError();break;case"getAlpha":e.col=getAlphalabel(e.col);break;case"addCustomFunction":this.addCustomFunction(e.functionHandler,e.functionName);break;case"computeExpression":e.calcValue=this.calculateInstance.computeExpression(e.formula);break;case"registerGridInCalc":this.calculateInstance.grid=e.sheetID;break;case"checkFormulaAdded":var l=this.calculateInstance.getSheetFamilyItem(e.sheetId);l.isSheetMember&&!ej2Base.isNullOrUndefined(l.parentObjectToToken)&&(e.address=l.parentObjectToToken.get(e.sheetId)+e.address),e.added=this.calculateInstance.getFormulaInfoTable().has(e.address)}},e.prototype.referenceError=function(){return this.calculateInstance.getErrorStrings()[exports.CommonErrors.ref]},e.prototype.getSheetInfo=function(){return this.sheetInfo},e.prototype.addCustomFunction=function(e,t){this.calculateInstance.defineFunction(t,e)},e.prototype.getFormulaInfoTable=function(e){var t=e.cellRef;t=t.split(":")[0],t="!"+this.parent.activeSheetIndex+"!"+t,e.toSkip=ej2Base.isNullOrUndefined(this.calculateInstance.getFormulaInfoTable().get(t))},e.prototype.updateSheetInfo=function(){var e=this;this.sheetInfo=[],this.parent.sheets.forEach(function(t){e.sheetInfo.push({visibleName:t.name,sheet:"Sheet"+t.id,index:t.id})})},e.prototype.sheetDeletion=function(e,t){var r,n,i,o,a,s=this,l=this.calculateInstance.getDependentCells(),d=this.calculateInstance.getSheetFamilyItem(t);l.forEach(function(l,p){l.forEach(function(l){r=s.calculateInstance.getFormulaInfoTable().get(l),ej2Base.isNullOrUndefined(r)||(n=r.formulaText).toUpperCase().indexOf(e.toUpperCase())>-1&&(n=n.toUpperCase().split(e.toUpperCase()+s.calculateInstance.sheetToken).join(s.referenceError()),i=s.calculateInstance.rowIndex(l),o=s.calculateInstance.colIndex(l),a=l.slice(0,l.lastIndexOf(s.calculateInstance.sheetToken)+1),s.updateDataContainer([i-1,o-1],{value:n,visible:!1,sheetId:d.tokenToParentObject.has(a)?Number(d.tokenToParentObject.get(a)):parseInt(l.split("!")[1],10)+1}),s.calculateInstance.refresh(r.getParsedFormula())),a=p.slice(0,p.lastIndexOf(s.calculateInstance.sheetToken)+1),t===(d.tokenToParentObject.has(a)?d.tokenToParentObject.get(a):p.split("!")[1])&&(s.calculateInstance.getFormulaInfoTable().delete(p),s.calculateInstance.clearFormulaDependentCells(p))})})},e.prototype.renameUpdation=function(e,t){var r,n,i=this,o=t.toUpperCase(),a=new RegExp("[!@#$%^&()+=';,.{}|\\\":<>~_-]","g"),s=new RegExp(t.replace(a,"\\$&")+'(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)',"gi");this.sheetInfo.forEach(function(a,l){for(var d=0,p=(r=i.parent.sheets[l]).usedRange.rowIndex;d<=p;d++)for(var h=0,c=r.usedRange.colIndex;h<=c;h++)(n=getCell(d,h,r,!1,!0)).formula&&checkIsFormula(n.formula)&&n.formula.toUpperCase().includes(o)&&n.formula.match(s)&&(n.formula=n.formula.replace(s,e));a.visibleName===t&&(a.visibleName=e)})},e.prototype.updateDataContainer=function(e,t){for(var r,n,i,o=0,a=this.parent.sheets.length;o<a;o++)if(this.parent.sheets[o].id===t.sheetId){r=this.parent.sheets[o],e[0]in r.rows?(n=r.rows[e[0]],e[1]in n.cells?((i=n.cells[e[1]]).formula=t.value,t.visible?o===this.parent.activeSheetIndex&&r.activeCell===getCellAddress(e[0],e[1])&&this.parent.notify(selectionComplete,{}):i.value=this.referenceError()):n.cells[e[1]]=i={}):(n=r.rows[e[0]]={})[e[1]]=i={};break}},e.prototype.parseSheetRef=function(e){var t,r=new RegExp("[!@#$%^&()+=';,.{}|\":<>~_-]","g"),n=0,i=this.parent.sheets.length,o=[];o.length=0;var a,s,l,d,p,h=this.getSheetInfo(),c='(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)';for(n=0;n<i;n++)if(h[n].sheet!==h[n].visibleName&&(t=new RegExp(h[n].visibleName.replace(r,"\\$&")+c,"gi"),l=n,e.match(t))){for(var u=n+1;u<i;u++)a=new RegExp(h[u].visibleName.replace(r,"\\$&")+c,"gi"),s=e.search(a),d=e.search(t),s>-1&&(s<d||s===d&&h[u].visibleName.length>h[n].visibleName.length)&&(p=new RegExp("Sheet","gi"),0!==h[u].visibleName.search(p)&&(t=a,l=u));e=e.replace(t,l+"/"),o.push(l)}for(n=0;n<o.length;)t=new RegExp(o[n]+"/"+c,"gi"),e=e.replace(t,h[o[n]].sheet),n++;return e},e.prototype.registerSheet=function(e,t){void 0===e&&(e=0),void 0===t&&(t=this.parent.sheets.length);for(var r;e<t;)r=getSheet(this.parent,e).id+"",this.calculateInstance.registerGridAsSheet(r,r,this.calcID),e++},e.prototype.unRegisterSheet=function(e,t,r){void 0===e&&(e=0),void 0===t&&(t=this.parent.sheets.length);var n;if(this.calculateInstance.tokenCount=0,r)this.calculateInstance.unregisterGridAsSheet(n,n,r);else for(;e<t;)n=getSheet(this.parent,e).id+"",this.calculateInstance.unregisterGridAsSheet(n,n),e++},e.prototype.getUniqueRange=function(e){e.range=this.calculateInstance.uniqueRange},e.prototype.removeUniquecol=function(){for(var e=this.parent.getActiveSheet(),t=0;t<this.calculateInstance.uniqueRange.length;t++){var r=this.calculateInstance.uniqueRange[t].split(":")[0].split("!");if(r[0]===e.name&&r[1]===e.activeCell){var n=getRangeIndexes(this.calculateInstance.uniqueRange[t]);this.calculateInstance.uniqueRange.splice(t,1);for(var i=n[0];i<=n[2];i++)for(var o=n[1];o<=n[3];o++){getCell(i,o,this.parent.getActiveSheet()).formula="",this.parent.updateCell({value:"",formula:""},getRangeAddress([i,o]))}}}},e.prototype.refreshCalculate=function(e,t,r,n,i,o,a){var s=ej2Base.isNullOrUndefined(i)?this.parent.getActiveSheet():getSheet(this.parent,i),l=s.id+"",d=s.name;if(n){r=this.parseSheetRef(r);var p=new ValueChangedArgs(e+1,t+1,r),h=[s.usedRange.rowIndex,s.usedRange.colIndex];this.calculateInstance.valueChanged(l,p,!0,h,o,d,a);var c=this.calculateInstance.randCollection;if(!0===this.calculateInstance.isRandomVal){var u=void 0,g=void 0,f="";if(this.calculateInstance.randomValues.size>1&&this.calculateInstance.randomValues.size===c.length)for(var m=0;m<this.calculateInstance.randomValues.size;m++){u=this.calculateInstance.rowIndex(c[m]),g=this.calculateInstance.colIndex(c[m]),f=this.calculateInstance.randomValues.get(c[m]),l=(parseFloat(this.calculateInstance.getSheetToken(c[m]).split(this.calculateInstance.sheetToken).join(""))+1).toString();var v=new ValueChangedArgs(u,g,f);this.calculateInstance.valueChanged(l,v,!0)}}}else{var C=this.calculateInstance.getSheetFamilyItem(l),y=getColumnHeaderText(t+1)+(e+1);C.isSheetMember&&!ej2Base.isNullOrUndefined(C.parentObjectToToken)&&(y=C.parentObjectToToken.get(l)+y),this.calculateInstance.getFormulaInfoTable().has(y)&&(this.calculateInstance.getFormulaInfoTable().delete(y),this.calculateInstance.clearFormulaDependentCells(y)),this.calculateInstance.getComputedValue().clear(),this.calculateInstance.refresh(y),this.calculateInstance.refreshRandValues(y)}this.calculateInstance.cell="";var x=getCell(e,t,this.parent.getActiveSheet());if(x&&r&&0===r.toString().toUpperCase().indexOf("=SUM(")){var b=["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!","invalid arguments"],S=r.toString().toUpperCase().replace("=SUM","").replace("(","").replace(")","").split(":")[0];if(isCellReference(S)){var w=getRangeIndexes(S),I=getCell(w[0],w[1],this.parent.getActiveSheet());I&&I.value&&I.format&&b.indexOf(x.value)<0&&b.indexOf(I.value)<0&&(x.format=I.format)}}},e.prototype.autoCorrectFormula=function(e,t,r,n){if(!ej2Base.isNullOrUndefined(e)){2===(e=e.toString()).split("(").length&&e.indexOf(")")<0&&(e+=")");var i=void 0;0===e.indexOf("=")&&(e=e.slice(1),i=!0);var o=e.match(/</g),a=e.match(/>/g),s=e.match(/=/g);if(o){for(var l="",d=0;d<o.length;d++)l+=o[d];e=e.replace(l,"<")}if(a){for(var p="",h=0;h<a.length;h++)p+=a[h];e=e.replace(p,">")}if(s){for(var c="",u=0;u<s.length;u++)c+=s[u];e=e.split(c).join("=")}e=i?"="+e:e,(o||a||s)&&(getCell(t,r,ej2Base.isNullOrUndefined(n)?this.parent.getActiveSheet():getSheet(this.parent,n)).formula=e)}return e},e.prototype.initiateDefinedNames=function(){for(var e=this.parent.definedNames,t=0;t<e.length;){var r=e[t],n=this.parseSheetRef(r.refersTo),i=getRangeFromAddress(n),o=!1,a=n.indexOf("http:")>-1||n.indexOf("https:")>-1;if(i=i.split("$").join(""),(i=i.split("=").join("")).indexOf(":")>-1){var s=i.split(":");isCellReference(s[0])&&isCellReference(s[1])&&(o=!0)}else i.indexOf(":")<0&&isCellReference(i)&&(o=!0);a&&(o=!1),o?this.addDefinedName(r,!0,void 0,!0):(this.removeDefinedName(r.name,r.scope,!0),t--),t++}},e.prototype.addDefinedName=function(e,t,r,n){(void 0===r||r<-1)&&(r=this.parent.definedNames.length);var i,o=!0,a=e.name;if(e.refersTo.indexOf("!")<0){var s=getSheetName(this.parent);s=-1!==s.indexOf(" ")?"'"+s+"'":s,e.refersTo=s+"!"+(e.refersTo.indexOf("=")<0?e.refersTo:e.refersTo.split("=")[1])}var l=e.refersTo,d=this.parseSheetRef(e.refersTo);e.scope?(i=getSheetIndex(this.parent,e.scope))>-1&&(a=getSheetName(this.parent,i)+"!"+a):e.scope="",e.comment||(e.comment=""),!t&&this.checkIsNameExist(e.name,e.scope)?o=!1:(this.calculateInstance.addNamedRange(a,"="===d[0]?d.substr(1):d),"="!==d[0]&&(e.refersTo="="+l),this.parent.definedNames.indexOf(e)<0&&this.parent.definedNames.splice(r,0,e));var p={name:e.name,scope:e.scope,comment:e.comment,refersTo:e.refersTo,cancel:!1};return n||this.parent.notify("actionComplete",{eventArgs:p,action:"addDefinedName"}),o},e.prototype.removeDefinedName=function(e,t,r){var n=!1,i=this.getIndexFromNameColl(e,t);if(i>-1){var o=e;if(t){var a=getSheetIndex(this.parent,t);a&&(o=getSheetName(this.parent,a)+"!"+e)}if(this.calculateInstance.removeNamedRange(o),this.parent.definedNames.splice(i,1),!r){var s={name:e,scope:t,cancel:!1};this.parent.notify("actionComplete",{eventArgs:s,action:"removeDefinedName"})}n=!0}return n},e.prototype.checkIsNameExist=function(e,t){return this.parent.definedNames.some(function(r){return r.name===e&&(t?r.scope===t:""===r.scope)})},e.prototype.getIndexFromNameColl=function(e,t){void 0===t&&(t="");var r=-1;return this.parent.definedNames.filter(function(n,i){n.name===e&&n.scope===t&&(r=i)}),r},e.prototype.toFixed=function(e){var t=Number(e);return Math.round(t)!==t&&(e=t.toFixed(2)),e},e.prototype.aggregateComputation=function(e){var t,r,n=this.parent.getActiveSheet(),i=getSingleSelectedRange(n),o=getRangeIndexes(i.split(":")[1]),a=["SUM","AVERAGE","MIN","MAX"],s=[];o[0]+1===n.rowCount&&o[1]+1===n.colCount&&(i="A1:"+getCellAddress(n.usedRange.rowIndex,n.usedRange.colIndex));var l,d=getRangeIndexes(n.activeCell),p=n.rows[d[0]]&&n.rows[d[0]].cells?n.rows[d[0]].cells[d[1]]:{},h=p?p.format:"",c=this.calculateInstance.getCellCollection(i);for(t=0;t<c.length;t++)if(l=this.calculateInstance.getValueFromArg(c[t]),isNumber(l)){e.countOnly=!1;break}if(e.Count=this.calculateInstance.getFunction("COUNTA")(i),e.Count&&!e.countOnly){for(t=0;t<4;t++){var u={formattedText:r=this.toFixed(this.calculateInstance.getFunction(a[t])(i)),value:r,format:h,onLoad:!0};h&&(this.parent.notify(getFormattedCellObject,u),r=u.formattedText),s.push(r)}e.Sum=s[0],e.Avg=s[1],e.Min=s[2],e.Max=s[3]}},e.prototype.refreshInsertDelete=function(e){var t,r=this,n=this.calculateInstance.getDependentFormulaCells(),i=getSheetIndexFromId(this.parent,e.sheet.id);this.parent.sheets.forEach(function(n,o){for(var a=0,s=n.usedRange.rowIndex;a<=s;a++)for(var l=0,d=n.usedRange.colIndex;l<=d;l++)(t=getCell(a,l,n,!1,!0)).formula&&checkIsFormula(t.formula)&&(o===i?r.updateFormula(e,t):t.formula.includes(e.sheet.name)&&r.updateFormula(e,t))}),n.clear(),this.calculateInstance.getDependentCells().clear(),this.calculateInstance.getFormulaInfoTable().clear(),this.refreshNamedRange(e)},e.prototype.updateFormula=function(e,t){for(var r,n,i,o=this.parseFormula(t.formula,!0),a=0;a<o.length;a++)if(r=o[a].trim().replace(/[$]/g,""),this.calculateInstance.isCellReference(r)){if((n=a&&o[a-1].trim())&&"!"===n[n.length-1]&&(n=n.replace(/['!]/g,""))!==e.sheet.name)continue;i=getRangeIndexes(r),this.parent.updateRangeOnInsertDelete(e,i)&&(o[a]=i[3]<i[1]?this.calculateInstance.getErrorStrings()[exports.CommonErrors.ref]:this.getAddress(i))}var s="="+o.join("");t.formula!==s&&(t.formula=s,t.value=null)},e.prototype.parseFormula=function(e,t){var r,n,i=0,o=[],a=[];a=this.markSpecialChar(e.replace("=",""),t);for(var s=(a=t?a.split(/\(|\)|=|\^|>|<|,|\+|-|\*|\/|%|&/g):a.split(/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g)).length;i<s;)(r=a[i])?(1===r.length?o.push(this.isUniqueChar(r)?this.getUniqueCharVal(r):r):(n=r[0],r.indexOf("!")>0?(this.isUniqueChar(n)&&(o.push(this.getUniqueCharVal(n)),r=r.substr(1)),n=r.indexOf("!")+1,o.push(r.substr(0,n)),o.push(r.substr(n))):this.isUniqueChar(n)?(o.push(this.getUniqueCharVal(n)),o.push(r.substr(1))):o.push(r)),i++):i++;return o},e.prototype.getUniqueCharVal=function(e){switch(e){case this.uniqueOBracket:return"(";case this.uniqueCBracket:return")";case this.uniqueCSeparator:return",";case this.uniqueCOperator:return":";case this.uniquePOperator:return"+";case this.uniqueSOperator:return"-";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueModOperator:return"%";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueGTOperator:return">";case this.uniqueLTOperator:return"<"}return""},e.prototype.isUniqueChar=function(e){var t=e.charCodeAt(e);return t>=129&&t<=142},e.prototype.markSpecialChar=function(e,t){return e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket),e=t?e.replace(/,/g,","+this.uniqueCSeparator):e.replace(/,/g,","+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator),e=e.replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator),e=e.replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator),e=e.replace(/&/g,"&"+this.uniqueConcateOperator),e=e.replace(/=/g,"="+this.uniqueEqualOperator),e=e.replace(/\^/g,"^"+this.uniqueExpOperator),(e=e.replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)},e.prototype.getAddress=function(e){return e[0]===e[2]&&e[1]===e[3]?getCellAddress(e[0],e[1]):getRangeAddress(e)},e.prototype.refreshNamedRange=function(e){var t=this;if(e.definedNames&&e.definedNames.length)e.definedNames.forEach(function(e){t.parent.removeDefinedName(e.name,e.scope),t.parent.addDefinedName(e)});else{var r=this.parent.definedNames.length;if(r)for(var n,i,o,a,s,l=Object.assign({},this.parent.definedNames),d=0;d<r;d++)(i=(o=(a=l[d]).refersTo.split("!"))[0].split("=")[1])===e.sheet.name&&(n=getRangeIndexes(o[1]),s=this.parent.updateRangeOnInsertDelete(e,n),e.isInsert?this.updateDefinedNames(a,i,n,s):"Row"===e.modelType?this.updateDefinedNames(a,i,n,s,[n[0],n[2]],e):"Column"===e.modelType&&this.updateDefinedNames(a,i,n,s,[n[1],n[3]],e))}},e.prototype.updateDefinedNames=function(e,t,r,n,i,o){if(n){var a=this.parent.definedNames.indexOf(e),s={action:"removeDefinedName",isRemoved:!1,definedName:e.name,scope:e.scope,isEventTrigger:!0};if(this.parent.notify(workbookFormulaOperation,s),i){var l={name:e.name,comment:e.comment,refersTo:e.refersTo,scope:e.scope};if(l=new DefineName(this.parent,"definedNames",l,!0),o.definedNames?o.definedNames.push(l):o.definedNames=[l],i[1]<i[0])return}e.refersTo=t+"!"+getRangeAddress(r),this.parent.notify(workbookFormulaOperation,{action:"addDefinedName",definedName:e,isAdded:!1,index:a,isEventTrigger:!0});var d={name:e.name,scope:e.scope,comment:e.comment,refersTo:e.refersTo,cancel:!1};this.parent.notify("actionComplete",{eventArgs:d,action:"refreshNamedRange"})}},e}(),WorkbookSort=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(initiateSort,this.initiateSortHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(initiateSort,this.initiateSortHandler)},e.prototype.initiateSortHandler=function(e){var t=this,r=e.args,n=new ej2Data.Deferred,i=this.parent.getActiveSheet(),o=getSwapRange(getIndexesFromAddress(r.range)),a=r.sortOptions||{sortDescriptors:{},containsHeader:!0},s=!1;if(e.promise=n.promise,o[0]>i.usedRange.rowIndex||o[1]>i.usedRange.colIndex)n.reject(this.parent.serviceLocator.getService(workbookLocale).getConstant("SortOutOfRangeError"));else{var l=a.containsHeader,d=r.checkForHeader;if((o[0]===o[2]||d)&&(d||(o=getDataRange(o[0],o[1],i)),s=!0,ej2Base.isNullOrUndefined(a.containsHeader)&&(l=typeof getCell(o[0],o[1],i,null,!0).value!=typeof getCell(o[0]+1,o[1],i,null,!0).value||!this.isSameStyle(getCell(o[0],o[1],i,null,!0).style,getCell(o[0]+1,o[1],i,null,!0).style))),(ej2Base.isNullOrUndefined(r.sortOptions)||ej2Base.isNullOrUndefined(r.sortOptions.containsHeader))&&!s){var p=getCell(o[0],o[1],i),h=getCell(o[0]+1,o[1],i);p&&h&&(l=typeof p.value!=typeof h.value||!this.isSameStyle(p.style,h.style))}var c,u,g=o[0]=l?o[0]+1:o[0],f=getCellIndexes(i.activeCell),m=getColumnHeaderText(f[1]+1),v=a.sortDescriptors,C=getRangeAddress(o);getData(this.parent,i.name+"!"+C,!0,null,null,null,null,null,void 0,null,f[1]).then(function(s){var l=new ej2Data.DataManager(s),d=new ej2Data.Query;if(Array.isArray(v)){v&&0!==v.length||(v=[{field:m}]);for(var p=v.length,h=p-1;h>-1;h--)if(v[p-1].field||(v[p-1].field=m),v[h].field){var f=v[h].sortComparer||t.sortComparer.bind(t,v[h],a.caseSensitive);d.sortBy(v[h].field,f)}}else{v||(v={field:m}),v.field||(v.field=m);f=v.sortComparer||t.sortComparer.bind(t,v,a.caseSensitive);d.sortBy(v.field,f)}l.executeQuery(d).then(function(t){var a,l={};Array.prototype.forEach.call(t.result,function(e,t){if(e)for(c=o[1],u=o[3],g=parseInt(s[t].__rowIndex,10)-1;c<=u;c++)a=getColumnHeaderText(c+1),(l=e[a])&&l.formula&&(l.formula=getUpdatedFormula([g,c],[parseInt(e.__rowIndex,10)-1,c],i,l)),setCell(g,c,i,l)});var d={range:i.name+"!"+C,sortOptions:r.sortOptions};e.previousSort&&(d.previousSort=e.previousSort),n.resolve(d)})})}},e.prototype.isSameStyle=function(e,t){e||(e={}),t||(t={});for(var r=!0,n=Object.keys(e),i=0;i<n.length;i++){if(e[n[i]]!==t[n[i]]&&this.parent.cellStyle[n[i]]!==e[n[i]]){r=!1;break}r=!0}return r},e.prototype.sortComparer=function(e,t,r,n){var i=e.order||"",o=ej2Data.DataUtil.fnSort(i),a=!1,s={sensitivity:t?"case":"base"};if(r&&n&&("string"==typeof r.value||"string"==typeof n.value)&&""!==r.value&&""!==n.value&&(isNumber(r.value)&&(r.value=parseIntValue(r.value)),isNumber(n.value)&&(n.value=parseIntValue(n.value),a=!0),!a&&!a)){var l=new Intl.Collator(this.parent.locale,s);return i&&"ascending"!==i.toLowerCase()?-1*l.compare(r.value,n.value):l.compare(r.value,n.value)}return(null===r||r&&(ej2Base.isNullOrUndefined(r.value)||""===r.value))&&(null===n||n&&(ej2Base.isNullOrUndefined(n.value)||""===n.value))?-1:null===r||r&&(ej2Base.isNullOrUndefined(r.value)||""===r.value)?1:null===n||n&&(ej2Base.isNullOrUndefined(n.value)||""===n.value)?-1:o(r?r.value:r,n?n.value:n)},e.prototype.getModuleName=function(){return"workbookSort"},e}(),WorkbookFilter=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(initiateFilter,this.initiateFilterHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(initiateFilter,this.initiateFilterHandler)},e.prototype.initiateFilterHandler=function(e){var t=this,r=e.args,n=new ej2Data.Deferred,i=this.parent.getActiveSheet(),o=r.filterOptions||{};if(e.promise=n.promise,o.datasource){this.setFilter(o.datasource,o.predicates,r.range,e.refresh);var a={range:r.range,filterOptions:o};n.resolve(a)}else{var s=getSwapRange(getIndexesFromAddress(r.range));if(s[0]>i.usedRange.rowIndex||s[1]>i.usedRange.colIndex)return void n.reject("Select a cell or range inside the used range and try again.");s[0]===s[2]&&s[2]-s[0]==0&&(s[0]=0,s[1]=0,s[3]=i.usedRange.colIndex),s[2]=i.usedRange.rowIndex,s[0]=s[0]+1;var l=getRangeAddress(s);getData(this.parent,i.name+"!"+l,!0,!0,null,null,null,null,!1).then(function(i){var a=new ej2Data.DataManager(i);t.setFilter(a,o.predicates,r.range,e.refresh);var s={range:l,filterOptions:o};n.resolve(s)})}},e.prototype.setFilter=function(e,t,r,n){var i=this;if(e&&t){var o=e.dataSource.json,a=new ej2Data.Query;t.length&&a.where(ej2Data.Predicate.and(t));var s,l=e.executeLocal(a),d="__rowIndex",p=void 0;if(r.indexOf("!")>-1?(p=getSheetIndex(this.parent,r.split("!")[0]),s=this.parent.sheets[p]):(s=this.parent.getActiveSheet(),p=getSheetIndex(this.parent,s.name)),"spreadsheet"===this.parent.getModuleName()){var h=this.parent;if(h.scrollSettings.enableVirtualization&&o.length>h.viewport.rowCount+2*h.getThreshold("row")||n||s.frozenColumns||s.frozenRows){var c;if(o.forEach(function(e){c=l.indexOf(e)<0,setRow(s,Number(e[d])-1,{hidden:c,isFiltered:c})}),p!==h.activeSheetIndex)return;h.renderModule.refreshSheet(!1,!0,!0)}else{var u;if(o.forEach(function(e){var t={startIndex:Number(e[d])-1,hide:l.indexOf(e)<0,isFiltering:!0,aboveViewport:!1};t.endIndex=t.startIndex,i.parent.notify(hideShow,t),u||(u=t.aboveViewport)}),u&&r){var g=getRangeIndexes(r);this.parent.goTo(getCellAddress(g[0],g[1]))}}}else{var f;o.forEach(function(e){f=l.indexOf(e)<0,setRow(s,Number(e[d])-1,{hidden:f,isFiltered:f})})}}},e.prototype.getModuleName=function(){return"workbookFilter"},e}(),WorkbookImage=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.setImage=function(e){var t,r=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,n=e.range&&e.range.indexOf("!")>0?getSheetIndex(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,i=getRangeIndexes(r),o=n?this.parent.sheets[n]:this.parent.getActiveSheet(),a=getCell(i[0],i[1],o),s=e.options;if(a&&a.image){t=a.image;for(var l=0;l<s.length;l++)t.push(s[l])}setCell(i[0],i[1],o,{image:a&&a.image?t:s},!0)},e.prototype.addEventListener=function(){this.parent.on(setImage,this.setImage,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(setImage,this.setImage)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookImage"},e}(),WorkbookChart=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(setChart,this.setChartHandler,this),this.parent.on(refreshChart,this.refreshChartData,this),this.parent.on(deleteChartColl,this.deleteChartColl,this),this.parent.on(refreshChartSize,this.refreshChartSize,this),this.parent.on(focusChartBorder,this.focusChartBorder,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(setChart,this.setChartHandler),this.parent.off(refreshChart,this.refreshChartData),this.parent.off(deleteChartColl,this.deleteChartColl),this.parent.off(refreshChartSize,this.refreshChartSize),this.parent.off(focusChartBorder,this.focusChartBorder))},e.prototype.setChartHandler=function(e){var t=0;e.isInitCell=!ej2Base.isNullOrUndefined(e.isInitCell)&&e.isInitCell,e.isUndoRedo=!!ej2Base.isNullOrUndefined(e.isUndoRedo)||e.isUndoRedo,e.isPaste=!ej2Base.isNullOrUndefined(e.isPaste)&&e.isPaste;var r=e.chart;if(r.length>0)for(;t<r.length;){if(!1===e.isCut&&document.getElementById(e.chart[t].id)&&(r[t]={range:r[t].range,id:"e_spreadsheet_chart_"+this.parent.chartCount,isSeriesInRows:r[t].isSeriesInRows,theme:r[t].theme,type:r[t].type},r[t].id="e_spreadsheet_chart_"+this.parent.chartCount,e.isIdAvailabe=!1),document.getElementById(e.chart[t].id))return;var n=!!ej2Base.isNullOrUndefined(e.isIdAvailabe)||e.isIdAvailabe;if(r[t].theme=r[t].theme||"Material",r[t].type=r[t].type||"Line",r[t].isSeriesInRows=r[t].isSeriesInRows||!1,r[t].range=r[t].range||this.parent.getActiveSheet().selectedRange,r[t].range.indexOf("!")<0&&(r[t].range=this.parent.getActiveSheet().name+"!"+r[t].range),ej2Base.isNullOrUndefined(r[t].id)&&(r[t].id="e_spreadsheet_chart_"+this.parent.chartCount,n=!1),r[t].height=r[t].height||290,r[t].width=r[t].width||480,this.parent.notify(initiateChart,{option:r[t],chartCount:this.parent.chartCount,isInitCell:e.isInitCell,isUndoRedo:e.isUndoRedo,dataSheetIdx:e.dataSheetIdx,range:e.range,isPaste:e.isPaste}),this.parent.chartColl.push(r[t]),n||this.parent.chartCount++,!e.isInitCell||e.isPaste){var i=r[t].range&&r[t].range.indexOf("!")>0?getSheetIndex(this.parent,r[t].range.split("!")[0]):this.parent.activeSheetIndex,o=e.isPaste?getRangeIndexes(e.range):getRangeIndexes(r[t].range),a=i?this.parent.sheets[i]:this.parent.getActiveSheet(),s=getCell(o[0],o[1],a);s&&s.chart?s.chart.push(r[t]):setCell(o[0],o[1],a,{chart:[r[t]]},!0)}t++}},e.prototype.refreshChartData=function(e){for(var t,r=1,n=this.parent.sheets.length+1;r<n;){var i=this.parent.chartColl;if(t=i?i.length:0)for(;t--;){var o=this.parent.chartColl[t],a=ej2Base.isNullOrUndefined(e.showHide)?inRange(getRangeIndexes(o.range),e.rIdx,e.cIdx):this.inRowColumnRange(getRangeIndexes(o.range),e.rIdx,e.showHide),s=o.range.indexOf("!")>-1?getSheetIndex(this.parent,getSheetNameFromAddress(o.range)):this.parent.activeSheetIndex;a&&s===this.parent.activeSheetIndex&&this.parent.notify(updateChart,{chart:o})}r++}},e.prototype.inRowColumnRange=function(e,t,r){return"rows"===r?t>=e[0]&&t<=e[2]:t>=e[1]&&t<=e[3]},e.prototype.refreshChartSize=function(e){for(var t,r=1,n=this.parent.sheets.length+1;r<n;){var i=this.parent.chartColl;if(t=i?i.length:0)for(;t--;){var o=this.parent.chartColl[t];if(!ej2Base.isNullOrUndefined(e.overlayEle.querySelector("#"+o.id))){var a=this.parent.element.querySelector("."+o.id),s=ej2Base.getComponent(a,"chart");s&&(s.height=e.height,s.width=e.width)}}r++}},e.prototype.focusChartBorder=function(e){for(var t=0;t<this.parent.chartColl.length;t++){var r=document.getElementById(e.id),n=document.getElementById(this.parent.chartColl[t].id);r&&n&&ej2Base.closest(n,"."+r.classList[1])===r&&this.parent.notify(initiateChart,{option:this.parent.chartColl[t],chartCount:this.parent.chartCount,isRefresh:!0})}},e.prototype.deleteChartColl=function(e){for(var t=0;t<this.parent.chartColl.length;t++){var r=document.getElementById(this.parent.chartColl[t].id),n=document.getElementById(e.id);n&&r&&ej2Base.closest(r,"."+n.classList[1])===n&&this.parent.chartColl.splice(t,1)}},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookChart"},e}(),WorkbookCellFormat=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.format=function(e){var t,r=this,n=e.range;n&&"string"==typeof n&&n.indexOf("!")>-1?(n=n.split("!")[1],t=this.parent.sheets[getSheetIndex(this.parent,e.range.split("!")[0])]):t=this.parent.getActiveSheet(),void 0===n&&(n=t.selectedRange);var i="object"!=typeof n&&e.onActionUpdate,o={range:n,style:Object.assign({},e.style),requestType:"CellFormat"};e.borderType&&(o.borderType=e.borderType);var a={};if(Object.assign(a,o.style,null,!0),i&&(this.parent.trigger("beforeCellFormat",o),this.parent.notify("actionBegin",{eventArgs:o,action:"format"}),o.cancel))e.cancel=!0;else{var s="object"==typeof o.range?o.range:getSwapRange(getRangeIndexes(o.range));e.borderType&&(this.setTypedBorder(t,e.style.border,s,e.borderType,e.onActionUpdate),delete e.style.border,delete o.style.border);var l,d,p={cell:null,rowIdx:0,colIdx:0,eventOnly:!0,preventEvt:!i},h=function(e){return p.cell={style:e},p.rowIdx=l,p.colIdx=d,updateCell(r.parent,t,p)};if(void 0!==o.style.borderTop){for(d=s[1];d<=s[3];d++)l=s[0],h({borderTop:o.style.borderTop})||(this.checkAdjustantBorder(t,"borderBottom",l-1,d),this.checkFullBorder(t,"borderBottom",l-1,d),this.checkFullBorder(t,"borderTop",l,d),this.setCellBorder(t,p.cell.style,l,d,e.onActionUpdate,d===s[3]));delete o.style.borderTop}if(void 0!==o.style.borderBottom){var c=void 0,u=void 0;for(d=s[1];d<=s[3];d++)u=(c=getCell(l=s[0],d,t,!1,!0)).rowSpan>0?getCell(s[2],s[1],t,!1,!0):getCell(s[2],s[3],t,!1,!0),c.rowSpan>1&&u.rowSpan<0||(l=s[2]),h({borderBottom:o.style.borderBottom})||(this.checkAdjustantBorder(t,"borderTop",s[2]+1,d),this.checkFullBorder(t,"borderTop",s[2]+1,d),this.checkFullBorder(t,"borderBottom",s[2],d),this.setCellBorder(t,p.cell.style,l,d,e.onActionUpdate,d===s[3]),this.setBottomBorderPriority(t,s[2],d));delete o.style.borderBottom}if(void 0!==o.style.borderLeft){for(var g=s[0];g<=s[2];g++)d=s[1],h({borderLeft:o.style.borderLeft})||(this.checkAdjustantBorder(t,"borderRight",g,d-1),this.checkFullBorder(t,"borderRight",g,d-1),this.checkFullBorder(t,"borderLeft",g,d),this.setCellBorder(t,p.cell.style,g,d,e.onActionUpdate));delete o.style.borderLeft}if(void 0!==o.style.borderRight){for(var f=s[0];f<=s[2];f++)d=s[3],h({borderRight:o.style.borderRight})||(this.checkAdjustantBorder(t,"borderLeft",f,d+1),this.checkFullBorder(t,"borderLeft",f,d+1),this.checkFullBorder(t,"borderRight",f,d),this.setCellBorder(t,p.cell.style,f,d,e.onActionUpdate));delete o.style.borderRight}var m,v,C;if(Object.keys(o.style).length){var y=this.parent,x=y.viewport&&this.parent.getActiveSheet().id===t.id,b=this.parent.frozenRowCount(t),S=this.parent.frozenColCount(t),w=[b+y.viewport.topIndex,S+y.viewport.leftIndex,y.viewport.bottomIndex,y.viewport.rightIndex],I=void 0;for(l=s[0];l<=s[2];l++)if(!(getRow(t,l)||{}).isFiltered)for(I=x&&(l>=w[0]&&l<=w[2]||l<b),d=s[1];d<=s[3];d++)if(!h(o.style)){if(void 0===v&&(void 0!==o.style.border?(m=o.style.border,delete o.style.border,v=!0):v=!1),(C=getCell(l,d,t,!1,!0)).rowSpan>1||C.colSpan>1)for(var R=l,E=C.rowSpan>1?l+(C.rowSpan-1):l;R<=E;R++)for(var k=d,F=C.colSpan>1?d+(C.colSpan-1):d;k<=F;k++)v&&this.setFullBorder(t,m,s,R,k,e.onActionUpdate,!0),this.setCellStyle(t,R,k,o.style);v&&this.setFullBorder(t,m,s,l,d,e.onActionUpdate),this.setCellStyle(t,l,d,o.style),I&&(d>=w[1]&&d<=w[3]||d<S)&&this.parent.notify(applyCellFormat,{style:o.style,rowIdx:l,colIdx:d,lastCell:d===s[3],isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:e.onActionUpdate})}}v&&(o.style.border=m),this.parent.setUsedRange(s[2],s[3]),e.refreshRibbon&&this.parent.notify(activeCellChanged,null),i&&(o.style=a,o.range=t.name+"!"+n,this.parent.notify("actionComplete",{eventArgs:o,action:"format"}))}},e.prototype.setBottomBorderPriority=function(e,t,r){if(isHiddenRow(e,t+1)){var n=this.skipHiddenRows(e,t+1);""!==this.parent.getCellStyleValue(["borderTop"],[n,r]).borderTop&&(e.rows[t].cells[r].style.bottomPriority=!0)}},e.prototype.setFullBorder=function(e,t,r,n,i,o,a){var s={};n===r[0]&&(this.checkAdjustantBorder(e,"borderBottom",n-1,i),this.checkFullBorder(e,"borderBottom",n-1,i)),i===r[1]&&(this.checkAdjustantBorder(e,"borderRight",n,i-1),this.checkFullBorder(e,"borderRight",n,i-1)),i===r[3]?(this.checkAdjustantBorder(e,"borderLeft",n,i+1),this.checkFullBorder(e,"borderLeft",n,i+1)):this.checkAdjustantBorder(e,"border",n,i+1),s.borderRight=t,s.borderTop=t,s.borderLeft=t,s.borderBottom=t,this.setCellBorder(e,s,n,i,o,i===r[3],null,a),n===r[2]?(this.checkAdjustantBorder(e,"borderTop",n+1,i),this.checkFullBorder(e,"borderTop",n+1,i),this.setBottomBorderPriority(e,n,i)):this.checkAdjustantBorder(e,"border",n+1,i)},e.prototype.checkAdjustantBorder=function(e,t,r,n){var i={};""!==this.parent.getCellStyleValue([t],[r,n])[t]&&(i[t]=void 0,this.setCellStyle(e,r,n,i))},e.prototype.checkFullBorder=function(e,t,r,n){var i=this.parent.getCellStyleValue(["border"],[r,n]).border;if(""!==i){var o={border:void 0};["borderBottom","borderTop","borderLeft","borderRight"].forEach(function(e){e!==t&&(o[e]=i)}),this.setCellStyle(e,r,n,o)}},e.prototype.textDecorationActionUpdate=function(e){var t=this.parent.getActiveSheet(),r={range:t.selectedRange,style:e.style,requestType:"CellFormat"};if(this.parent.trigger("beforeCellFormat",r),this.parent.notify("actionBegin",{eventArgs:r,action:"format"}),r.cancel)e.cancel=!0;else{var n,i=getSwapRange(getRangeIndexes(t.selectedRange)),o=e.style.textDecoration,a=o,s=getRangeIndexes(t.activeCell),l=this.parent.getCellStyleValue(["textDecoration"],s).textDecoration,d=!1;"underline"===l?a="underline"===o?"none":"underline line-through":"line-through"===l?a="line-through"===o?"none":"underline line-through":"underline line-through"===l&&(a="underline"===o?"line-through":"underline",d=!0),"none"===a&&(d=!0),this.format({style:{textDecoration:a},range:s,refreshRibbon:e.refreshRibbon,onActionUpdate:!0});for(var p=i[0];p<=i[2];p++)for(var h=i[1];h<=i[3];h++)if(p!==s[0]||h!==s[1]){if(n={},"none"===(l=this.parent.getCellStyleValue(["textDecoration"],[p,h]).textDecoration)){if(d)continue;n.textDecoration=o}else if("underline"===l||"line-through"===l)if(d){if(o!==l)continue;n.textDecoration="none"}else n.textDecoration=o!==l?"underline line-through":o;else if("underline line-through"===l){if(!d)continue;n.textDecoration="underline"===o?"line-through":"underline"}this.format({style:n,range:[p,h,p,h],refreshRibbon:e.refreshRibbon,onActionUpdate:!0})}r.range=t.name+"!"+r.range,this.parent.notify("actionComplete",{eventArgs:r,action:"format"})}},e.prototype.setTypedBorder=function(e,t,r,n,i){var o;if("Outer"===n){for(var a=r[1];a<=r[3];a++)this.checkAdjustantBorder(e,"borderBottom",r[0]-1,a),this.checkFullBorder(e,"borderBottom",r[0]-1,a),this.setCellBorder(e,{borderTop:t},r[0],a,i,a===r[3]),this.checkAdjustantBorder(e,"borderTop",r[2]+1,a),this.checkFullBorder(e,"borderTop",r[2]+1,a),this.setCellBorder(e,{borderBottom:t},r[2],a,i,a===r[3],n),this.setBottomBorderPriority(e,r[2],a);for(var s=r[0];s<=r[2];s++)this.checkAdjustantBorder(e,"borderRight",s,r[1]-1),this.checkFullBorder(e,"borderRight",s,r[1]-1),this.setCellBorder(e,{borderLeft:t},s,r[1],i),this.checkAdjustantBorder(e,"borderLeft",s,r[3]+1),this.checkFullBorder(e,"borderLeft",s,r[3]+1),this.setCellBorder(e,{borderRight:t},s,r[3],i,null,n)}else if("Inner"===n)for(var l=r[0];l<=r[2];l++)for(var d=r[1];d<=r[3];d++){var p={};""!==(o=this.parent.getCellStyleValue(["border"],[l,d]).border)&&(p.border=void 0,d!==r[3]&&d!==r[1]&&l!==r[0]&&l!==r[2]||(l===r[0]&&(p.borderTop=o),l===r[2]&&(p.borderBottom=o),d===r[3]&&(p.borderRight=o),d===r[1]&&(p.borderLeft=o))),d!==r[3]&&(p.borderRight=t),l!==r[0]&&(p.borderTop=t),l!==r[2]&&(p.borderBottom=t),d!==r[1]&&(p.borderLeft=t),this.setCellBorder(e,p,l,d,i,d===r[3])}else if("Vertical"===n)for(l=r[0];l<=r[2];l++)for(d=r[1];d<=r[3];d++){p={borderRight:t,borderLeft:t};d===r[1]&&(this.checkAdjustantBorder(e,"borderRight",l,d-1),this.checkFullBorder(e,"borderRight",l,d-1)),d===r[3]&&(this.checkAdjustantBorder(e,"borderLeft",l,d+1),this.checkFullBorder(e,"borderLeft",l,d+1)),this.setCellBorder(e,p,l,d,i)}else for(l=r[0];l<=r[2];l++)for(d=r[1];d<=r[3];d++){p={borderTop:t,borderBottom:t};l===r[0]&&(this.checkAdjustantBorder(e,"borderBottom",l-1,d),this.checkFullBorder(e,"borderBottom",l-1,d)),this.setCellBorder(e,p,l,d,i,d===r[3]),l===r[2]&&(this.checkAdjustantBorder(e,"borderTop",l+1,d),this.checkFullBorder(e,"borderTop",l+1,d),this.setBottomBorderPriority(e,l,d))}},e.prototype.setCellBorder=function(e,t,r,n,i,o,a,s){if(this.setCellStyle(e,r,n,t),!s&&this.parent.getActiveSheet().id===e.id){if("Outer"===a&&(t.borderBottom||t.borderRight)){var l={range:[r,n,r,n]};this.parent.notify(activeCellMergedRange,l),r=l.range[0],n=l.range[1]}this.parent.notify(applyCellFormat,{style:t,rowIdx:r,colIdx:n,onActionUpdate:i,first:"",lastCell:o,isHeightCheckNeeded:!0,manualUpdate:!0})}},e.prototype.setCellStyle=function(e,t,r,n){e.rows[t]?e.rows[t].cells||(e.rows[t].cells=[]):e.rows[t]={cells:[]},e.rows[t].cells[r]||(e.rows[t].cells[r]={}),e.rows[t].cells[r].style||(e.rows[t].cells[r].style={}),Object.assign(e.rows[t].cells[r].style,n,null,!0)},e.prototype.skipHiddenRows=function(e,t){return t++,isHiddenRow(e,t)&&(t=this.skipHiddenRows(e,t)),t},e.prototype.addEventListener=function(){this.parent.on(setCellFormat,this.format,this),this.parent.on(textDecorationUpdate,this.textDecorationActionUpdate,this),this.parent.on(clear,this.clearCellObj,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(setCellFormat,this.format),this.parent.off(textDecorationUpdate,this.textDecorationActionUpdate),this.parent.off(clear,this.clearCellObj))},e.prototype.clearCellObj=function(e){for(var t,r,n=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,i=e.range&&e.range.indexOf("!")>0?getSheetIndex(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,o=getSheet(this.parent,i),a=getIndexesFromAddress(n),s=a[0],l=a[2];s<=l;s++)for(t=a[1],r=a[3];t<=r;t++){var d=getCell(s,t,o);if(d)switch(e.type){case"Clear Formats":delete d.format,delete d.rowSpan,delete d.style,delete d.wrap,delete d.colSpan;break;case"Clear Contents":d.hyperlink&&this.parent.notify(deleteHyperlink,{sheet:o,rowIdx:s,colIdx:t,preventRefresh:!0}),delete d.value,delete d.formula,this.parent.notify(checkConditionalFormat,{rowIdx:s,colIdx:t,cell:d,isAction:!0});break;case"Clear Hyperlinks":delete d.hyperlink;break;case"Clear All":setCell(s,t,o,{},!1)}}},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"workbookcellformat"},e}(),WorkbookEdit=function(){function e(e){this.parent=e,this.localeObj=ej2Base.getNumericObject(this.parent.locale),this.decimalSep=this.localeObj.decimal,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(workbookEditOperation,this.performEditOperation,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(workbookEditOperation,this.performEditOperation)},e.prototype.getModuleName=function(){return"workbookEdit"},e.prototype.performEditOperation=function(e){switch(e.action){case"updateCellValue":this.updateCellValue(e.address,e.value,e.sheetIndex,e.isValueOnly,e.formula)}},e.prototype.checkDecimalPoint=function(e,t){if(Number(e)){var r=e.toString().indexOf(this.decimalSep)+1;e=e.toString().substr(r).length<=6?!t||t.includes("RANDBETWEEN")?r<7?e:parseFloat(e).toFixed(0):e.toString().length<11?e:r<11?parseFloat(e).toFixed(9-r+2):parseFloat(e).toFixed(0):r>7?parseFloat(e).toFixed(0):parseFloat(e).toFixed(6-r+2)}return e},e.prototype.updateCellValue=function(e,t,r,n,i){void 0===r&&(r=this.parent.activeSheetIndex);var o;o="string"==typeof e?getRangeIndexes(e):e;var a=getSheet(this.parent,r),s=getCell(o[0],o[1],a,!0);if(s||(s=a.rows[o[0]].cells[o[1]]={}),n)t&&t.toString().indexOf(this.decimalSep)>-1&&(t=this.checkDecimalPoint(t,i)),s.value=t;else{var l=checkIsFormula(t);l="#SPILL!"===t||l;var d=!1;s.formula&&s.formula.indexOf("UNIQUE")>-1&&""===t&&(d=!0),l||d||(s.formula&&(s.formula=""),s.value=parseIntValue(t));var p={action:"refreshCalculate",value:t,rowIndex:o[0],colIndex:o[1],sheetIndex:r,isFormula:l};if("Text"!==getTypeFromFormat(s.format)){var h={value:t,rowIndex:o[0],colIndex:o[1],sheetIndex:r,updatedVal:""};this.parent.notify(checkDateFormat,h),!ej2Base.isNullOrUndefined(h.updatedVal)&&h.updatedVal.length>0&&(s.value=h.updatedVal)}if("#SPILL!"===t)s.value=t;else{var c={cellIdx:o,isUnique:!1};this.parent.notify(checkUniqueRange,c),d||c.isUnique&&!(t&&t.toString().indexOf("UNIQUE")>-1)?t=s.value:this.parent.notify(workbookFormulaOperation,p),l?(s.formula=p.value,t=s.value):!s.value||"string"!=typeof s.value||0!==s.value.indexOf("www.")&&0!==s.value.indexOf("https://")&&0!==s.value.indexOf("http://")&&0!==s.value.indexOf("ftp://")||this.parent.notify(setLinkModel,{hyperlink:s.value,cell:a.name+"!"+getCellAddress(o[0],o[1])})}}this.parent.setUsedRange(o[0],o[1],a),this.parent.chartColl.length&&this.parent.notify(refreshChart,{cell:s,rIdx:o[0],cIdx:o[1],sheetIdx:r}),a.conditionalFormats&&a.conditionalFormats.length&&this.parent.notify(checkConditionalFormat,{rowIdx:o[0],colIdx:o[1],cell:s,isAction:!0,preventIfSheetNotRendered:!0})},e}(),WorkbookHyperlink=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(setLinkModel,this.setLinkHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(setLinkModel,this.setLinkHandler)},e.prototype.setLinkHandler=function(e){var t,r,n,i=e.hyperlink,o=e.cell,a=this.parent.getActiveSheet();if(o&&-1!==o.indexOf("!")){t=o.split("!");for(var s=this.parent.sheets,l=0;l<s.length;l++)s[l].name===t[0]&&(r=l);a=this.parent.sheets[r],o=t[1]}var d=getRangeIndexes(o=o||this.parent.getActiveSheet().activeCell),p=d[0],h=d[1];if(a){var c={};"string"==typeof i?(0!==i.indexOf("http://")&&0!==i.indexOf("https://")&&0!==i.indexOf("ftp://")&&(n=i=0===i.toLowerCase().indexOf("www.")?"http://"+i:i),c.hyperlink=i):(0!==(n=i.address).indexOf("http://")&&0!==n.indexOf("https://")&&0!==n.indexOf("ftp://")&&(n=0===n.toLowerCase().indexOf("www.")?"http://"+n:n),c.hyperlink={address:n}),updateCell(this.parent,a,{cell:c,rowIdx:p,colIdx:h,preventEvt:!e.triggerEvt})||(a.rows[p].cells[h].style||(a.rows[p].cells[h].style={}),a.rows[p].cells[h].style.textDecoration="underline",a.rows[p].cells[h].style.color="#00e")}},e.prototype.getModuleName=function(){return"workbookHyperlink"},e}(),WorkbookInsert=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.insertModel=function(e){var t,r,n,i=this;if("Column"===e.modelType){if("number"==typeof e.start)for(var o=0;o<=this.parent.getActiveSheet().usedRange.rowIndex+1;o++){var a={cellIdx:[o,e.start],isUnique:!1};if(this.parent.notify(checkUniqueRange,a),a.isUnique)return}}else if("Row"===e.modelType&&"number"==typeof e.start)for(var s=0;s<=this.parent.getActiveSheet().usedRange.colIndex+1;s++){a={cellIdx:[e.start,s],isUnique:!1};if(this.parent.notify(checkUniqueRange,a),a.isUnique)return}if(e.model){var l,d,p,h=[];if("number"==typeof e.start){l=e.start,e.end=e.end||l,l>e.end&&(l=e.end,e.end=e.start);for(o=l;o<=e.end;o++)h.push({})}else e.start?(l=e.start[0].index||0,h=e.start,p=!0):(l=0,h.push({}));var c,u={startIndex:l,endIndex:l+h.length-1,modelType:e.modelType,sheet:e.model,isInsert:!0};if("Row"===e.modelType){if(void 0!==e.checkCount&&e.model.rows&&e.checkCount===e.model.rows.length)return;if(this.parent.notify(refreshInsertDelete,u),e.model=e.model,e.model.rows||(e.model.rows=[]),p&&e.model.usedRange.rowIndex>-1&&l>e.model.usedRange.rowIndex)for(o=e.model.usedRange.rowIndex;o<l-1;o++)h.splice(0,0,{});var g=this.parent.frozenRowCount(e.model);l<g&&(this.parent.setSheetPropertyOnMute(e.model,"frozenRows",e.model.frozenRows+h.length),c=!0),(t=e.model.rows).splice.apply(t,[l,0].concat(h)),this.setRowColCount(u.startIndex,u.endIndex,e.model,"row"),l>e.model.usedRange.rowIndex?this.parent.setUsedRange(l+(h.length-1),e.model.usedRange.colIndex,e.model,!0):this.parent.setUsedRange(e.model.usedRange.rowIndex+h.length,e.model.usedRange.colIndex,e.model,!0);var f,m=l+h.length,v=void 0,C=function(t){e.model.rows[m]&&e.model.rows[m].cells&&e.model.rows[m].cells[t]&&(void 0!==(v=e.model.rows[m].cells[t]).rowSpan&&v.rowSpan<0&&void 0===v.colSpan&&y.parent.notify(insertMerge,{range:[m,t,m,t],insertCount:h.length,insertModel:"Row"}),v.style&&getCell(l-1,t,e.model,!1,!0).style&&(f=y.checkBorder(v.style,e.model.rows[l-1].cells[t].style))!=={}&&h.forEach(function(e){e.cells||(e.cells=[]),e.cells[t]||(e.cells[t]={}),e.cells[t].style||(e.cells[t].style={}),Object.assign(e.cells[t].style,f)}))},y=this;for(o=0;o<=e.model.usedRange.colIndex;o++)C(o)}else if("Column"===e.modelType){if(void 0!==e.checkCount&&e.model.columns&&e.checkCount===e.model.columns.length)return;this.parent.notify(refreshInsertDelete,u),e.model=e.model,e.model.columns||(e.model.columns=[]),l&&!e.model.columns[l-1]&&(e.model.columns[l-1]={}),(r=e.model.columns).splice.apply(r,[l,0].concat(h));var x=this.parent.frozenColCount(e.model);l<x&&(this.parent.setSheetPropertyOnMute(e.model,"frozenColumns",e.model.frozenColumns+h.length),c=!0),this.setRowColCount(u.startIndex,u.endIndex,e.model,"col"),l>e.model.usedRange.colIndex?this.parent.setUsedRange(e.model.usedRange.rowIndex,l+(h.length-1),e.model,!0):this.parent.setUsedRange(e.model.usedRange.rowIndex,e.model.usedRange.colIndex+h.length,e.model,!0),e.model.rows||(e.model.rows=[]);var b=[];e.columnCellsModel||(e.columnCellsModel=[]);for(o=0;o<h.length;o++)b.push(null);d=[];v=void 0;var S=void 0;for(o=0;o<=e.model.usedRange.rowIndex;o++){e.model.rows[o]?e.model.rows[o].cells||(e.model.rows[o].cells=[]):e.model.rows[o]={cells:[]},l&&!e.model.rows[o].cells[l-1]&&(e.model.rows[o].cells[l-1]={}),(n=e.model.rows[o].cells).splice.apply(n,[l,0].concat(e.columnCellsModel[o]&&e.columnCellsModel[o].cells?e.columnCellsModel[o].cells:b));m=l+h.length;if(e.model.rows[o].cells[m]&&(void 0!==(v=e.model.rows[o].cells[m]).colSpan&&v.colSpan<0&&void 0===v.rowSpan&&d.push({range:[o,m,o,m],insertCount:b.length,insertModel:"Column"}),v.style&&getCell(o,l-1,e.model,!1,!0).style&&(S=this.checkBorder(v.style,e.model.rows[o].cells[l-1].style))!=={}))for(s=l;s<m;s++)e.model.rows[o].cells[s]||(e.model.rows[o].cells[s]={}),e.model.rows[o].cells[s].style||(e.model.rows[o].cells[s].style={}),Object.assign(e.model.rows[o].cells[s].style,S)}d.forEach(function(e){i.parent.notify(insertMerge,e)})}else{if(void 0!==e.checkCount&&e.checkCount===this.parent.sheets.length)return;var w=h;for(o=0;o<w.length;o++)if(w[o].name)for(s=0;s<this.parent.sheets.length;s++)if(w[o].name===this.parent.sheets[s].name){w.splice(o,1),o--;break}if(!w.length)return;delete h[0].index,this.parent.createSheet(l,h);var I;e.activeSheetIndex?this.parent.setProperties({activeSheetIndex:e.activeSheetIndex},!0):!e.isAction&&e.start<this.parent.activeSheetIndex&&this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(this.parent.activeSheetIndex)},!0),h.forEach(function(e){p&&i.updateRangeModel(e.ranges),I=e.id,i.parent.notify(workbookFormulaOperation,{action:"addSheet",visibleName:e.name,sheetName:"Sheet"+I,sheetId:I})})}if("Sheet"!==e.modelType){if(this.parent.notify(refreshClipboard,{start:l,end:l+h.length-1,modelType:e.modelType,model:e.model,isInsert:!0}),e.model.name!==this.parent.getActiveSheet().name)return;this.parent.notify(insert,{model:h,index:l,modelType:e.modelType,isAction:e.isAction,activeSheetIndex:getSheetIndex(this.parent,e.model.name),sheetCount:"Row"===e.modelType?e.model.rows.length:e.model.columns.length,insertType:e.insertType,freezePane:c,isUndoRedo:e.isUndoRedo})}else this.parent.notify(insert,{model:h,index:l,modelType:e.modelType,isAction:e.isAction,activeSheetIndex:e.activeSheetIndex,sheetCount:this.parent.sheets.length,insertType:e.insertType,freezePane:c,isUndoRedo:e.isUndoRedo})}},e.prototype.setRowColCount=function(e,t,r,n){var i=n+"Count";this.parent.setSheetPropertyOnMute(r,i,r[i]+(t-e+1)),r.id===this.parent.getActiveSheet().id&&this.parent.notify(updateRowColCount,{index:r[i]-1,update:n,isInsert:!0,start:e,end:t})},e.prototype.updateRangeModel=function(e){e.forEach(function(e){e.dataSource&&(e.startCell=e.startCell||"A1",e.showFieldAsHeader=void 0===e.showFieldAsHeader||e.showFieldAsHeader,e.template=e.template||"",e.address=e.address||"A1")})},e.prototype.checkBorder=function(e,t){var r={};return e.borderLeft&&e.borderLeft===t.borderLeft&&(r.borderLeft=e.borderLeft),e.borderRight&&e.borderRight===t.borderRight&&(r.borderRight=e.borderRight),e.borderTop&&e.borderTop===t.borderTop&&(r.borderTop=e.borderTop),e.borderBottom&&e.borderBottom===t.borderBottom&&(r.borderBottom=e.borderBottom),r},e.prototype.setInsertInfo=function(e,t,r,n,i){void 0===i&&(i="Row");var o=r=t+(r-1);e.ranges.forEach(function(e){e.info&&t<e.info[n]&&(e.info["insert"+i+"Range"]?e.info["insert"+i+"Range"].push([t,o]):e.info["insert"+i+"Range"]=[[t,o]],e.info[n]+=o-t+1)})},e.prototype.addEventListener=function(){this.parent.on(insertModel,this.insertModel,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(insertModel,this.insertModel)},e.prototype.getModuleName=function(){return"workbookinsert"},e}(),WorkbookDelete=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.deleteModel=function(e){var t=this,r=this.parent.sheets.length;if("Sheet"!==e.modelType||1!==r){if("Column"===e.modelType){if("number"==typeof e.start)for(var n=0;n<=this.parent.getActiveSheet().usedRange.rowIndex+1;n++){var i={cellIdx:[n,e.start],isUnique:!1};if(this.parent.notify(checkUniqueRange,i),i.isUnique)return}}else if("Row"===e.modelType&&"number"==typeof e.start)for(var o=0;o<=this.parent.getActiveSheet().usedRange.colIndex+1;o++){i={cellIdx:[e.start,o],isUnique:!1};if(this.parent.notify(checkUniqueRange,i),i.isUnique)return}var a=e.modelType.toLowerCase()+"s";if(e.start=e.start,e.start>e.end){var s=e.start;e.start=e.end,e.end=s}var l,d,p,h=[],c=e.end-e.start+1,u={startIndex:e.start,endIndex:e.end,modelType:e.modelType,sheet:e.model};if("Row"===e.modelType){if(void 0!==e.checkCount&&e.checkCount===e.model.usedRange.rowIndex)return;if(this.parent.notify(refreshInsertDelete,u),e.model=e.model,e.start>e.model.usedRange.rowIndex)return;this.setRowColCount(e.start,e.end,e.model,"row"),e.end>e.model.usedRange.rowIndex&&(e.end-=e.end-e.model.usedRange.rowIndex),e.model.usedRange.rowIndex-=e.end-e.start+1,e.model.usedRange.rowIndex<0&&(e.model.usedRange.rowIndex=0);var g=this.parent.frozenRowCount(e.model);e.start<g&&(g=e.end<g?e.end-e.start+1:g-e.start,g=e.model.frozenRows-g,this.parent.setSheetPropertyOnMute(e.model,"frozenRows",g),p=!0);var f=e.end+1,m=void 0,v=void 0;if(e.model.rows[e.start]&&e.model.rows[e.start].cells)for(o=0;o<=e.model.usedRange.colIndex;o++){if(e.model.rows[e.start].cells[o]&&void 0!==e.model.rows[e.start].cells[o].rowSpan&&e.model.rows[e.start].cells[o].rowSpan<0&&void 0===e.model.rows[e.start].cells[o].colSpan&&(v={range:[e.start,o,e.start,o]},this.parent.notify(activeCellMergedRange,v),v.range=v.range,v.range[2]<=e.end&&((d=getCell(v.range[0],o,e.model))&&d.rowSpan>1&&(d.rowSpan-(v.range[2]-e.start+1)>1?setCell(v.range[0],o,e.model,{colSpan:d.rowSpan-(v.range[2]-e.start+1)},!0):delete e.model.rows[v.range[0]].cells[o].rowSpan),v=null)),e.model.rows[f]&&e.model.rows[f].cells&&e.model.rows[f].cells[o]&&void 0!==e.model.rows[f].cells[o].rowSpan&&e.model.rows[f].cells[o].rowSpan<0&&void 0===e.model.rows[f].cells[o].colSpan&&(v||(v={range:[f,o,f,o]},this.parent.notify(activeCellMergedRange,v)),m=new Object,v.range=v.range,Object.assign(m,getCell(v.range[0],v.range[1],e.model)),m&&m.rowSpan&&(m.rowSpan>1||m.colSpan>1))){(x=[])[1]=o,x[3]=m.colSpan>1?o+(m.colSpan-1):o,v.range=v.range,v.range[0]<e.start?(x[0]=x[2]=v.range[0],m.rowSpan-c>1&&(x[2]+=m.rowSpan-c-1)):(x[0]=x[2]=e.start,m.rowSpan-(e.end-v.range[0]+1)>1&&(x[2]+=m.rowSpan-(e.end-v.range[0]+1)-1)),h.push({range:x,isAction:!1,preventRefresh:!0,merge:!0,type:"All",skipChecking:!0})}v=null}}else if("Column"===e.modelType){if(void 0!==e.checkCount&&e.checkCount===e.model.usedRange.colIndex)return;if(this.parent.notify(refreshInsertDelete,u),e.model=e.model,e.start>e.model.usedRange.colIndex)return;this.setRowColCount(e.start,e.end,e.model,"col"),e.end>e.model.usedRange.colIndex&&(e.end-=e.end-e.model.usedRange.colIndex),e.model.usedRange.colIndex-=c,e.model.usedRange.colIndex<0&&(e.model.usedRange.colIndex=0);var C=this.parent.frozenColCount(e.model);e.start<C&&(C=e.end<C?e.end-e.start+1:C-e.start,C=e.model.frozenColumns-C,this.parent.setSheetPropertyOnMute(e.model,"frozenColumns",C),this.parent.updateTopLeftCell(),p=!0),l=[];for(f=e.end+1,m=void 0,v=void 0,o=0;o<=e.model.usedRange.rowIndex;o++)if(l.push({}),e.model.rows[o]&&e.model.rows[o].cells){if(e.model.rows[o].cells[e.start]&&void 0!==e.model.rows[o].cells[e.start].colSpan&&e.model.rows[o].cells[e.start].colSpan<0&&void 0===e.model.rows[o].cells[e.start].rowSpan&&(v={range:[o,e.start,o,e.start]},this.parent.notify(activeCellMergedRange,v),v.range=v.range,v.range[3]<=e.end)){var y=getCell(o,v.range[1],e.model);y&&y.colSpan>1&&(y.colSpan-(v.range[3]-e.start+1)>1?setCell(o,v.range[1],e.model,{colSpan:y.colSpan-(v.range[3]-e.start+1)},!0):delete e.model.rows[o].cells[v.range[1]].colSpan),v=null}if(e.model.rows[o].cells[f]&&void 0!==e.model.rows[o].cells[f].colSpan&&e.model.rows[o].cells[f].colSpan<0&&void 0===e.model.rows[o].cells[f].rowSpan&&(v||(v={range:[o,f,o,f]},this.parent.notify(activeCellMergedRange,v)),m=new Object,v.range=v.range,Object.assign(m,getCell(v.range[0],v.range[1],e.model)),m&&m.colSpan&&(m.colSpan>1||m.rowSpan>1))){var x;(x=[])[0]=o,x[2]=m.rowSpan>1?o+(m.rowSpan-1):o,v.range=v.range,v.range[1]<e.start?(x[1]=x[3]=v.range[1],m.colSpan-c>1&&(x[3]+=m.colSpan-c-1)):(x[1]=x[3]=e.start,m.colSpan-(e.end-v.range[1]+1)>1&&(x[3]+=m.colSpan-(e.end-v.range[1]+1)-1)),h.push({range:x,isAction:!1,preventRefresh:!0,merge:!0,type:"All",skipChecking:!0})}l[o].cells=e.model.rows[o].cells.splice(e.start,c),v=null}}else if(e.end-e.start==this.parent.sheets.length-1||void 0!==e.checkCount&&e.checkCount===this.parent.sheets.length)return;var b=[];for(o=e.start;o<=e.end;o++)"Sheet"===e.modelType&&e.model[a][o]&&this.parent.notify(workbookFormulaOperation,{action:"deleteSheetTab",sheetId:e.model[a][o].id}),e.model[a][e.start]||e.start<e.model[a].length?(b.push(e.model[a][e.start]||{}),e.model[a].splice(e.start,1)):b.push({}),o===e.start&&(b[0].index=e.start);if(h.forEach(function(e){t.parent.notify(setMerge,e)}),this.parent.notify(beforeDelete,e),"Sheet"!==e.modelType){if(this.parent.notify(refreshClipboard,e),e.model.name!==this.parent.getActiveSheet().name)return;this.parent.notify(deleteAction,{startIndex:e.start,endIndex:e.end,modelType:e.modelType,refreshSheet:e.refreshSheet,definedNames:u.definedNames,isAction:e.isAction,deletedModel:b,deletedCellsModel:l,sheetCount:"Row"===e.modelType?e.model.usedRange.rowIndex:e.model.usedRange.colIndex,activeSheetIndex:getSheetIndex(this.parent,e.model.name),freezePane:p,isUndoRedo:e.isUndoRedo})}else this.parent.notify(deleteAction,{startIndex:e.start,endIndex:e.end,modelType:e.modelType,definedNames:u.definedNames,isAction:e.isAction,deletedModel:b,deletedCellsModel:l,sheetCount:this.parent.sheets.length,activeSheetIndex:this.parent.activeSheetIndex,freezePane:p,isUndoRedo:e.isUndoRedo})}},e.prototype.setRowColCount=function(e,t,r,n){var i=n+"Count";t>=r[i]&&(t=r[i]-1),t<e||(this.parent.setSheetPropertyOnMute(r,i,r[i]-(t-e+1)),r.id===this.parent.getActiveSheet().id&&this.parent.notify(updateRowColCount,{index:r[i]-1,update:n,isDelete:!0,start:e,end:t}))},e.prototype.setDeleteInfo=function(e,t,r,n){void 0===n&&(n="Row");var i=t-e+1,o=[];this.parent.getActiveSheet().ranges.forEach(function(a){a.info&&e<a.info[r]&&(a.info["delete"+n+"Range"]?a.info["delete"+n+"Range"].push([e,t]):a.info["delete"+n+"Range"]=[[e,t]],a.info[r]-=i,a.info["insert"+n+"Range"]&&(a.info["insert"+n+"Range"]=o))})},e.prototype.addEventListener=function(){this.parent.on(deleteModel,this.deleteModel,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(deleteModel,this.deleteModel)},e.prototype.getModuleName=function(){return"workbookdelete"},e}(),WorkbookDataValidation=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(cellValidation,this.ValidationHandler,this),this.parent.on(addHighlight,this.addHighlightHandler,this),this.parent.on(removeHighlight,this.removeHighlightHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(cellValidation,this.ValidationHandler),this.parent.off(addHighlight,this.addHighlightHandler),this.parent.off(removeHighlight,this.removeHighlightHandler))},e.prototype.ValidationHandler=function(e){var t,r=e.range,n="";e.range.indexOf("!")>-1&&(r=e.range.split("!")[1],n=e.range.split("!")[0]);var i=getSheet(this.parent,this.parent.getAddressInfo(n+"A1:A1").sheetIndex),o=!1,a=i.rowCount,s=r.split(":");r.match(/\D/g)&&!r.match(/[0-9]/g)?(s[0]+=1,s[1]+=a,r=s[0]+":"+s[1],o=!0):!r.match(/\D/g)&&r.match(/[0-9]/g)&&(s[0]="A"+s[0],s[1]=getCellAddress(0,i.colCount-1).replace(/[0-9]/g,"")+s[1],r=s[0]+":"+s[1]),ej2Base.isNullOrUndefined(n)||(e.range=n+"!"+r),e.range=e.range||i.selectedRange;var l=getRangeIndexes(e.range);if(o)for(var d=l[1];d<=l[3];d++)t=getColumn(i,d),o=!(o&&e.isRemoveValidation&&t&&!t.validation);if(o)for(d=l[1];d<=l[3];d++)t=getColumn(i,d),e.isRemoveValidation&&t&&t.validation?delete i.columns[d].validation:e.isRemoveValidation||(ej2Base.isNullOrUndefined(t)&&(i.columns[d]=getColumn(i,d)),i.columns[d].validation={operator:e.rules.operator,type:e.rules.type,value1:e.rules.value1,value2:e.rules.value2,inCellDropDown:e.rules.inCellDropDown,ignoreBlank:e.rules.ignoreBlank});else for(var p=void 0,h=l[0];h<=l[2];h++)for(d=l[1];d<=l[3];d++)e.isRemoveValidation?(p=getCell(h,d,i))&&p.validation&&!updateCell(this.parent,i,{cell:{validation:{}},rowIdx:h,colIdx:d})&&(delete p.validation,this.parent.notify(applyCellFormat,{rowIdx:h,colIdx:d,style:this.parent.getCellStyleValue(["backgroundColor","color"],[h,d])})):(p={validation:Object.assign({},e.rules)},updateCell(this.parent,i,{cell:p,rowIdx:h,colIdx:d}))},e.prototype.addHighlightHandler=function(e){this.InvalidDataHandler(e.range,!1,e.td,e.isclearFormat)},e.prototype.removeHighlightHandler=function(e){this.InvalidDataHandler(e.range,!0)},e.prototype.getRange=function(e){var t=getRangeIndexes(e),r=this.parent.getActiveSheet(),n=r.colCount,i=r.rowCount;return t[2]===i-1&&0===t[0]?e=e.replace(/[0-9]/g,""):t[3]===n-1&&0===t[2]&&(e=e.replace(/\D/g,"")),e},e.prototype.InvalidDataHandler=function(e,t,r,n){var i,o,a=this.parent.getActiveSheet(),s=(e=e||a.selectedRange)?getRangeIndexes(e):[],l=!1;(e=this.getRange(e)).match(/\D/g)&&!e.match(/[0-9]/g)&&(l=!0);for(var d=e?s[0]:0,p=e?s[2]:a.rows.length;d<=p;d++)if(a.rows[d])for(var h=e?s[1]:0,c=e?s[3]:a.rows[d].cells.length;h<=c;h++){var u=void 0;if(a.rows[d].cells[h]){var g=getColumn(a,h);if((i=a.rows[d].cells[h])&&i.validation){if(u=i.validation,n&&!u.isHighlighted)return;t?u.isHighlighted&&(i.validation.isHighlighted=!1):i.validation.isHighlighted=!0}else if(g&&g.validation){if(u=g.validation,n&&!u.isHighlighted)return;t&&l?u.isHighlighted&&(g.validation.isHighlighted=!1):l&&(g.validation.isHighlighted=!0)}o=i.value?i.value:"";var f=[d,h],m=this.parent.activeSheetIndex;if(u&&this.parent.allowDataValidation){this.parent.notify(isValidation,{value:o,range:f,sheetIdx:m,isCell:!1});var v=this.parent.allowDataValidation;this.parent.allowDataValidation=!0,v||isHiddenRow(a,d)||this.parent.notify(validationHighlight,{isRemoveHighlightedData:t,rowIdx:d,colIdx:h,td:r})}}}},e.prototype.getModuleName=function(){return"workbookDataValidation"},e}(),WorkbookFindAndReplace=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(findNext,this.findNext,this),this.parent.on(findPrevious,this.findPrevious,this),this.parent.on(replaceHandler,this.replace,this),this.parent.on(replaceAllHandler,this.replaceAll,this),this.parent.on(count,this.totalCount,this),this.parent.on(findAllValues,this.findAllValues,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(findNext,this.findNext),this.parent.off(findPrevious,this.findPrevious),this.parent.off(replaceHandler,this.replace),this.parent.off(replaceAllHandler,this.replaceAll),this.parent.off(count,this.totalCount),this.parent.off(findAllValues,this.findAllValues))},e.prototype.findNext=function(e){var t,r,n,i=this.parent.sheets,o=i[this.parent.activeSheetIndex],a=getCellIndexes(o.activeCell),s=o.usedRange,l=s.colIndex,d=e.value.toString(),p=0,h=s.rowIndex,c=t=a[1],u=r=a[0];if(o.rows[r]&&o.rows[r].cells&&o.rows[r].cells[t])if(o.rows[r].cells[t].format){n=this.parent.getDisplayText(o.rows[r].cells[t]).toString()}else o.rows[r].cells[t].value&&(n=o.rows[r].cells[t].value.toString());if(n){var g=n.toLowerCase(),f=n.indexOf(e.value)>-1,m=g.indexOf(e.value.toString().toLowerCase())>-1;(d===n||d===g||f||m)&&("By Column"===e.searchBy?r++:t++,p++)}(a[0]>o.usedRange.rowIndex||a[1]>o.usedRange.colIndex)&&(a[0]>o.usedRange.rowIndex&&a[1]<=o.usedRange.colIndex?(r=0,t=a[1]):a[0]<=o.usedRange.rowIndex&&a[1]>o.usedRange.colIndex?(r=a[0],t=0):(r=0,t=0));var v={rowIndex:r,colIndex:t,usedRange:s,endRow:h,endColumn:l,startRow:u,mode:e.mode,loopCount:0,count:p,args:e,val:void 0,stringValue:d,sheetIndex:this.parent.activeSheetIndex,startColumn:c,sheets:i};"By Row"===e.searchBy&&this.findNxtRow(v),"By Column"===e.searchBy&&this.findNxtCol(v)},e.prototype.findNxtRow=function(e){var t,r=e.sheets[e.sheetIndex],n=this.parent.sheets.length;t=r.usedRange;var i=getCellIndexes(r.activeCell);for(e.colIndex>=e.usedRange.colIndex+1&&(e.colIndex=0,e.rowIndex++),e.rowIndex;e.rowIndex<=e.endRow+1;e.rowIndex++){if(e.rowIndex>e.endRow){if("Workbook"===e.mode){var o=this.parent.activeSheetIndex;if(e.sheetIndex++,n===e.sheetIndex&&(e.sheetIndex=0),o===e.sheetIndex&&0===e.count)return void this.parent.notify(showDialog,null);t=(r=e.sheets[e.sheetIndex]).usedRange,i=getCellIndexes(r.activeCell),e.rowIndex=0,e.colIndex=0,e.endColumn=t.colIndex,e.endRow=t.rowIndex}if(0===e.colIndex&&e.rowIndex>e.endRow)if(0===i[0]&&0===i[1]){if(0===e.count)return void this.parent.notify(showDialog,null)}else(0!==i[0]&&0!==i[1]||0!==i[0]||0!==i[1])&&(e.startColumn=0,e.startRow=0,e.endColumn=t.colIndex,e.endRow=i[0],e.rowIndex=e.startRow,e.colIndex=e.startColumn,e.loopCount++)}if(e.count>0&&t.rowIndex<e.rowIndex&&(e.rowIndex=0,0===e.rowIndex&&(e.colIndex=0)),r.rows[e.rowIndex]){var a=r.rows[e.rowIndex];for(e.colIndex;e.colIndex<=e.endColumn;e.colIndex++)if(a&&a.cells&&a.cells[e.colIndex]){if(this.nextCommon(e))return}if(e.colIndex>e.endColumn&&(e.colIndex=0),e.loopCount>0&&i[0]===e.rowIndex)return void this.parent.notify(showDialog,null)}}0!==e.count||this.parent.notify(showDialog,null)},e.prototype.findNxtCol=function(e){var t,r=e.sheets[e.sheetIndex],n=getCellIndexes(r.activeCell),i=this.parent.sheets.length;for(e.rowIndex>=e.usedRange.rowIndex&&(e.rowIndex=0,e.colIndex++),e.colIndex;e.colIndex<=e.usedRange.colIndex+1;e.colIndex++){if(e.colIndex>=e.endColumn+1&&"Workbook"===e.mode){if(t=this.parent.activeSheetIndex,e.sheetIndex++,i===e.sheetIndex&&(e.sheetIndex=0),t===e.sheetIndex&&0===e.count)return void this.parent.notify(showDialog,null);r=e.sheets[e.sheetIndex],e.usedRange=r.usedRange,n=getCellIndexes(r.activeCell),e.colIndex=0,e.rowIndex=0,e.endColumn=e.usedRange.colIndex,e.endRow=e.usedRange.rowIndex}if(e.colIndex>=e.endColumn+1&&(e.colIndex=0),e.rowIndex>e.endRow&&0===e.colIndex)if(0===n[0]&&0===n[1]||n[1]>r.usedRange.rowIndex||n[0]>r.usedRange.colIndex){if(0===e.count)return void this.parent.notify(showDialog,null)}else(0!==n[1]||0!==n[0]||0!==n[1]&&0!==n[0])&&(e.startRow=0,e.startColumn=0,e.endRow=n[0],e.endColumn=e.usedRange.colIndex,e.colIndex=e.startColumn,e.rowIndex=e.startRow,e.loopCount++);if(e.count>0&&e.usedRange.colIndex+1<e.colIndex&&(e.colIndex=0,e.rowIndex=0),e.rowIndex>=e.endRow&&(e.rowIndex=0),e.colIndex<=e.usedRange.colIndex){for(e.rowIndex;e.rowIndex<=e.usedRange.rowIndex;e.rowIndex++)if(r.rows[e.rowIndex]&&r.rows[e.rowIndex].cells&&r.rows[e.rowIndex].cells[e.colIndex]){if(this.nextCommon(e))return}if(e.loopCount>0&&n[1]===e.colIndex)return void this.parent.notify(showDialog,null)}}0!==e.count||this.parent.notify(showDialog,null)},e.prototype.nextCommon=function(e){var t=e.sheets[e.sheetIndex];if(t.rows[e.rowIndex]){var r=t.rows[e.rowIndex].cells[e.colIndex];if(r&&r.value){var n=t.rows[e.rowIndex].cells[e.colIndex];if(n){var i=void 0;if(n.format){i=this.parent.getDisplayText(t.rows[e.rowIndex].cells[e.colIndex])}else i=t.rows[e.rowIndex].cells[e.colIndex].value.toString();if(e.args.isCSen&&e.args.isEMatch){if(i===e.stringValue){var o=t.name+"!"+getCellAddress(e.rowIndex,e.colIndex);return this.parent.notify(goto,{address:o}),e.count++,!0}}else if(e.args.isCSen&&!e.args.isEMatch){var a=i.indexOf(e.args.value)>-1;if(i===e.stringValue||a){o=t.name+"!"+getCellAddress(e.rowIndex,e.colIndex);return this.parent.notify(goto,{address:o}),e.count++,!0}}else if(!e.args.isCSen&&e.args.isEMatch){if(e.val=i.toString().toLowerCase(),e.val===e.stringValue){o=t.name+"!"+getCellAddress(e.rowIndex,e.colIndex);return this.parent.notify(goto,{address:o}),e.count++,!0}}else if(!e.args.isCSen&&!e.args.isEMatch){e.val=i.toString().toLowerCase();a=e.val.indexOf(e.args.value.toString().toLowerCase())>-1;var s=e.val.indexOf(e.args.value)>-1;if(e.val===e.stringValue||i===e.stringValue||a||i===e.stringValue||s){o=t.name+"!"+getCellAddress(e.rowIndex,e.colIndex);return this.parent.notify(goto,{address:o}),e.count++,!0}}}}}return!1},e.prototype.findPrevious=function(e){var t,r=this.parent.sheets,n=e.sheetIndex,i=r[n],o=getCellIndexes(i.activeCell),a=0,s=i.usedRange.rowIndex,l=i.usedRange.colIndex,d=e.value.toString(),p=o[1],h=o[0],c=p,u=h;if(i.rows[h]&&i.rows[h].cells[p])if(i.rows[h].cells[p].format){t=this.parent.getDisplayText(i.rows[h].cells[p]).toString()}else i.rows[h].cells[p].value&&(t=i.rows[h].cells[p].value.toString());if(t){var g=t.toLowerCase(),f=t.indexOf(e.value)>-1,m=g.indexOf(e.value.toString().toLowerCase())>-1;(d===t||d===g||f||m)&&("By Row"===e.searchBy&&p--,"By Column"===e.searchBy&&h--,a++)}(o[0]>i.usedRange.rowIndex||o[1]>i.usedRange.colIndex)&&(o[0]>i.usedRange.rowIndex&&o[1]<=i.usedRange.colIndex?(h=i.usedRange.rowIndex,p=o[1]):o[0]<=i.usedRange.rowIndex&&o[1]>i.usedRange.colIndex?(h=o[0],p=i.usedRange.colIndex):(h=i.usedRange.rowIndex,p=i.usedRange.colIndex));var v={rowIndex:h,colIndex:p,endRow:s,endColumn:l,startRow:u,loopCount:0,count:a,args:e,val:void 0,stringValue:d,sheets:r,sheetIndex:n,startColumn:c};"By Row"===e.searchBy&&this.findPreRow(v),"By Column"===e.searchBy&&this.findPreCol(v)},e.prototype.findPreRow=function(e){var t,r=e.sheets[e.sheetIndex],n=this.parent.sheets.length,i=!1,o=getCellIndexes(r.activeCell);for(-1===e.colIndex&&(e.colIndex=e.endColumn,e.rowIndex--),e.rowIndex;e.rowIndex>=-1;e.rowIndex--){if(e.rowIndex<0&&e.colIndex<=0){if("Workbook"===e.args.mode){var a=this.parent.activeSheetIndex;if(e.sheetIndex--,-1===e.sheetIndex&&(e.sheetIndex=n-1),a===e.sheetIndex&&0===e.count)return void this.parent.notify(showDialog,null);t=(r=e.sheets[e.sheetIndex]).usedRange,o=getCellIndexes(r.activeCell),e.rowIndex=t.rowIndex,e.colIndex=t.colIndex,e.endColumn=0,e.endRow=0}i=this.commonCondition(e,o)}if(!i){"Workbook"!==e.args.mode&&e.count>0&&-1===e.rowIndex&&(e.rowIndex=e.endRow),-1===e.rowIndex&&(e.rowIndex=r.usedRange.rowIndex,e.colIndex=r.usedRange.colIndex);var s=r.rows[e.rowIndex];if(s){for(-1===e.colIndex&&(e.colIndex=r.usedRange.colIndex),e.colIndex;e.colIndex>=0;e.colIndex--)if(s&&s.cells&&s.cells[e.colIndex]){if(this.prevCommon(e))return}if(e.loopCount>0&&o[0]===e.rowIndex)return void this.parent.notify(showDialog,null)}}}i||0!==e.count||this.parent.notify(showDialog,null)},e.prototype.findPreCol=function(e){var t,r=e.sheets[e.sheetIndex],n=this.parent.sheets.length,i=!1,o=getCellIndexes(r.activeCell);for(e.colIndex;e.colIndex>=-1;e.colIndex--){if(e.rowIndex<0&&e.colIndex<=0){if("Workbook"===e.args.mode){var a=this.parent.activeSheetIndex;if(e.sheetIndex--,-1===e.sheetIndex&&(e.sheetIndex=n-1),a===e.sheetIndex&&0===e.count)return void this.parent.notify(showDialog,null);t=(r=e.sheets[e.sheetIndex]).usedRange,o=getCellIndexes(r.activeCell),e.rowIndex=t.rowIndex,e.colIndex=t.colIndex,e.endColumn=0,e.endRow=0}i=this.commonCondition(e,o)}if(!i){e.count>0&&e.colIndex<0&&(e.colIndex=e.endColumn),e.rowIndex<0&&(e.rowIndex=r.usedRange.rowIndex),e.colIndex<-1&&(e.colIndex=r.usedRange.colIndex,e.rowIndex--);var s=r.rows[e.rowIndex];for(s&&r.rows[e.rowIndex].cells[e.colIndex]&&-1===e.rowIndex&&(e.rowIndex=r.usedRange.rowIndex),e.rowIndex;e.rowIndex>=0;e.rowIndex--){if(s&&s.cells&&s.cells[e.colIndex]){if(this.prevCommon(e))return}if(e.loopCount>0&&o[1]===e.colIndex)return void this.parent.notify(showDialog,null)}}}i||0!==e.count||this.parent.notify(showDialog,null)},e.prototype.commonCondition=function(e,t){var r,n=e.sheets[e.sheetIndex];return t[0]!==e.endRow&&t[1]!==e.endColumn||t[0]!==e.endRow||t[1]!==e.endColumn?(e.startColumn=n.usedRange.colIndex,e.startRow=n.usedRange.rowIndex,e.endColumn=0,e.endRow=t[0],e.rowIndex=e.startRow,e.colIndex=e.startColumn,e.loopCount++,r=!1):(t[0]===n.usedRange.rowIndex&&t[1]===n.usedRange.colIndex||t[0]>n.usedRange.rowIndex||t[1]>n.usedRange.colIndex)&&0!==t[0]&&0!==t[1]&&(this.parent.notify(showDialog,null),r=!0),r},e.prototype.prevCommon=function(e){var t=e.sheets[e.sheetIndex];if(t.rows[e.rowIndex]){var r=t.rows[e.rowIndex].cells[e.colIndex];if(r&&r.value){var n=t.rows[e.rowIndex].cells[e.colIndex];if(n){var i=void 0;if(n.format){i=this.parent.getDisplayText(t.rows[e.rowIndex].cells[e.colIndex])}else i=t.rows[e.rowIndex].cells[e.colIndex].value.toString();if(e.args.isCSen&&e.args.isEMatch){if(i===e.stringValue){var o=t.name+"!"+getCellAddress(e.rowIndex,e.colIndex);return this.parent.notify(goto,{address:o}),e.count++,!0}}else if(e.args.isCSen&&!e.args.isEMatch){var a=i.indexOf(e.args.value)>-1;if(i===e.stringValue||a){o=t.name+"!"+getCellAddress(e.rowIndex,e.colIndex);return this.parent.notify(goto,{address:o}),e.count++,!0}}else if(!e.args.isCSen&&e.args.isEMatch){if(e.val=i.toString().toLowerCase(),e.val===e.stringValue){o=t.name+"!"+getCellAddress(e.rowIndex,e.colIndex);return this.parent.notify(goto,{address:o}),e.count++,!0}}else if(!e.args.isCSen&&!e.args.isEMatch){e.val=i.toString().toLowerCase();a=e.val.indexOf(e.args.value.toString().toLowerCase())>-1;var s=e.val.indexOf(e.args.value)>-1;if(i===e.stringValue||i===e.stringValue||a||e.val===e.stringValue||s){o=t.name+"!"+getCellAddress(e.rowIndex,e.colIndex);return this.parent.notify(goto,{address:o}),e.count++,!0}}}}}return!1},e.prototype.replace=function(e){var t=this;if(this.parent.getActiveSheet().isProtected)this.parent.notify(workBookeditAlert,null);else{var r=this.parent.getActiveSheet(),n=getCellIndexes(r.activeCell),i=r.rows[n[0]].cells[n[1]].value.toString(),o=i.indexOf(e.value)>-1,a=i.toLowerCase().indexOf(e.value.toString().toLowerCase())>-1,s=i.toString().toLowerCase();i===e.value||o||s===e.value||a||(e.findOpt="next",this.findNext(e)),n=getCellIndexes(r.activeCell);var l=this.parent.getDisplayText(getCell(n[0],n[1],r)).toString(),d={address:r.name+"!"+getCellAddress(n[0],n[1]),compareValue:l,replaceValue:e.replaceValue,cancel:!1};if(this.parent.notify("actionBegin",{action:"beforeReplace",eventArgs:d}),!d.cancel){l=d.compareValue,n=getCellIndexes(d.address.split("!")[1]);var p=function(e){updateCell(t.parent,r,{cell:e,rowIdx:n[0],colIdx:n[1],uiRefresh:!0,valChange:!0}),t.parent.notify("actionComplete",{action:"replace",eventArgs:{address:d.address,compareValue:l,replaceValue:d.replaceValue}})},h=l.toLowerCase();if(e.value===l||e.value===h)p({value:d.replaceValue});else if(l.indexOf(e.value)>-1)p({value:l.replace(e.value,d.replaceValue)});else if(h.indexOf(e.value)>-1){var c=new RegExp(e.value.toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig");p({value:l.replace(c,d.replaceValue)})}}}},e.prototype.replaceAll=function(e){for(var t,r,n,i=this,o="Sheet"===e.mode?e.sheetIndex:0,a=this.parent.sheets[o],s=a.usedRange.rowIndex,l=0,d=a.usedRange.colIndex,p=0,h=[],c={addressCollection:h,replaceValue:e.replaceValue,compareValue:e.value,cancel:!1},u=function(e,t){requestAnimationFrame?requestAnimationFrame(function(){if(!c.cancel&&c.addressCollection[t]){var r=getCellIndexes(c.addressCollection[t].split("!")[1]);updateCell(i.parent,a,{cell:{value:e},rowIdx:r[0],colIdx:r[1],uiRefresh:!0,valChange:!0}),t===c.addressCollection.length-1&&i.parent.notify("actionComplete",{action:"replaceAll",eventArgs:{replaceValue:c.replaceValue,addressCollection:c.addressCollection,compareValue:c.compareValue}})}}):i.parent.updateCell({value:e},c.addressCollection[t])};l<=s+1;l++){if(p>d&&l>s&&"Workbook"===e.mode){if(o++,!(a=this.parent.sheets[o]))break;p=0,l=0,d=a.usedRange.colIndex,s=a.usedRange.rowIndex}if(r=a.rows[l])for(p===d+1&&(p=0);p<=d;p++)if(r&&r.cells&&r.cells[p]&&(t=this.parent.getDisplayText(a.rows[l].cells[p]).toString()))if(e.isCSen)e.isEMatch?t===e.value&&(u(e.replaceValue,h.length),h.push(a.name+"!"+getCellAddress(l,p))):t.indexOf(e.value)>-1&&(u(t.replace(e.value,e.replaceValue),h.length),h.push(a.name+"!"+getCellAddress(l,p)));else if(e.isEMatch)t.toLowerCase()===e.value&&(u(e.replaceValue,h.length),h.push(a.name+"!"+getCellAddress(l,p)));else{var g=t.toLowerCase();(t===e.value||g.indexOf(e.value.toString().toLowerCase())>-1||g===e.value||t===e.value||g.indexOf(e.value)>-1)&&(n=new RegExp(e.value.toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),u(t.replace(n,e.replaceValue),h.length),h.push(a.name+"!"+getCellAddress(l,p)))}}h.length?(this.parent.notify("actionBegin",{action:"beforeReplaceAll",eventArgs:c}),c.cancel||this.parent.notify(replaceAllDialog,{count:c.addressCollection.length,replaceValue:c.replaceValue})):this.parent.notify(replaceAllDialog,{count:c.addressCollection.length,replaceValue:c.replaceValue})},e.prototype.totalCount=function(e){for(var t=this.parent.sheets[e.sheetIndex],r=t.usedRange.rowIndex,n=0,i=0,o=t.usedRange.colIndex,a=0;i<=r;i++)if(t.rows[i]){var s=t.rows[i];for(a===o+1&&(a=0);a<=o;a++)if(s&&s.cells&&s.cells[a]&&s.cells[a].value){var l=t.rows[i].cells[a];if(l){var d=void 0;if(l.format){d=this.parent.getDisplayText(t.rows[i].cells[a]).toString()}else d=l.value.toString();if(e.isCSen&&e.isEMatch)d===e.value&&n++;else if(e.isCSen&&!e.isEMatch){var p=d.indexOf(e.value)>-1;(d===e.value||p)&&n++}else if(!e.isCSen&&e.isEMatch){(u=d.toString().toLowerCase())===e.value&&n++}else if(!e.isCSen&&!e.isEMatch){p=(u=d.toString().toLowerCase()).indexOf(e.value.toString().toLowerCase())>-1;var h=u.indexOf(e.value)>-1;(u===e.value||d===e.value||p||d===e.value||h)&&n++}}}}var c=n;if((n=c-(this.requiredCount(e)-1))>c&&(n=c),0!==n){var u,g=getCellIndexes(t.activeCell);(u=t.rows[g[0]]?this.parent.getDisplayText(t.rows[g[0]].cells[g[1]]).toString().toLowerCase():null)&&-1===u.indexOf(e.value.toString().toLowerCase())&&(n-=1)}e.findCount=n+" of "+c},e.prototype.requiredCount=function(e){for(var t=this.parent.activeSheetIndex,r=this.parent.sheets[t],n=getCellIndexes(r.activeCell),i=r.usedRange.rowIndex,o=0,a=n[0],s=r.usedRange.colIndex,l=n[1];a<=i;a++)if(r.rows[a]){var d=r.rows[a];for(l===s+1&&(l=0);l<=s;l++)if(d&&d.cells&&d.cells[l]&&d.cells[l].value&&r.rows[a].cells[l]){var p=void 0;if(r.rows[a].cells[l].format){p=this.parent.getDisplayText(r.rows[a].cells[l]).toString()}else p=r.rows[a].cells[l].value.toString();if(e.isCSen&&!e.isEMatch){var h=p.indexOf(e.value)>-1;(p===e.value||h)&&o++}else if(e.isCSen&&e.isEMatch)p===e.value&&o++;else if(!e.isCSen&&e.isEMatch){(c=p.toString().toLowerCase())===e.value&&o++}else if(!e.isCSen&&!e.isEMatch){var c=p.toString().toLowerCase(),u=e.value.toString().toLowerCase(),g=(h=c.indexOf(u)>-1,c.indexOf(e.value)>-1);(p===e.value||c===u||h||c===e.value||g)&&o++}}}return o},e.prototype.findAllValues=function(e){for(var t,r=e.sheetIndex,n=this.parent.sheets[r],i=n.usedRange.rowIndex,o=0,a=n.usedRange.colIndex,s=0,l=this.parent.sheets.length,d=e.sheetIndex;o<=i+1;o++){if(1!==d&&e.sheetIndex===l&&(r=1),o>i&&s>a&&"Workbook"===e.mode){if(r++,d===r)return void 0;r>l-1&&(r=0),(n=this.parent.sheets[r])&&(o=0,s=0,a=n.usedRange.colIndex,i=n.usedRange.rowIndex)}if(!ej2Base.isNullOrUndefined(n)&&n.rows[o]){var p=n.rows[o];for(s===a+2&&(s=0);s<=a+1;s++)if(p&&p.cells&&p.cells[s]){var h=n.rows[o].cells[s];if(h){var c=void 0;if(h.format){c=this.parent.getDisplayText(n.rows[o].cells[s]).toString()}else c=h.value.toString();if(e.isCSen&&e.isEMatch)c===e.value&&(t=n.name+"!"+getCellAddress(o,s),e.findCollection.push(t),0);else if(e.isCSen&&!e.isEMatch){var u=c.indexOf(e.value)>-1;(c===e.value||u)&&(t=n.name+"!"+getCellAddress(o,s),e.findCollection.push(t),0)}else if(!e.isCSen&&e.isEMatch){(g=c.toString().toLowerCase())===e.value&&(t=n.name+"!"+getCellAddress(o,s),e.findCollection.push(t),0)}else if(!e.isCSen&&!e.isEMatch){var g;u=(g=c.toString().toLowerCase()).indexOf(e.value.toLowerCase())>-1;(g===e.value||c===e.value||u||c===e.value)&&(t=n.name+"!"+getCellAddress(o,s),e.findCollection.push(t),0)}}}}}},e.prototype.getModuleName=function(){return"workbookfindAndReplace"},e}(),WorkbookProtectSheet=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.protectsheetHandler=function(e){var t=this.parent.getActiveSheet();this.parent.setSheetPropertyOnMute(t,"protectSettings",{selectCells:e.protectSettings.selectCells,formatCells:e.protectSettings.formatCells,formatColumns:e.protectSettings.formatColumns,formatRows:e.protectSettings.formatRows,insertLink:e.protectSettings.insertLink}),this.parent.notify(protectSheetWorkBook,t.protectSettings),this.parent.notify(updateToggle,{props:"Protect"}),t.password=e.password?e.password:"",t.columns.forEach(function(e){e&&ej2Base.isUndefined(e.isLocked)&&(e.isLocked=!0)})},e.prototype.unprotectsheetHandler=function(e){var t=this.parent.getActiveSheet();e.sheet&&(t=this.parent.sheets[e.sheet]),t.protectSettings.formatCells=t.protectSettings.formatColumns=!1,t.protectSettings.formatRows=t.protectSettings.selectCells=!1,this.parent.setSheetPropertyOnMute(t,"isProtected",!1),this.parent.notify(protectSheetWorkBook,t.protectSettings),this.parent.notify(updateToggle,{props:"Protect"})},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(protectsheetHandler,this.protectsheetHandler,this),this.parent.on(unprotectsheetHandler,this.unprotectsheetHandler,this),this.parent.on(setLockCells,this.lockCells,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(protectsheetHandler,this.protectsheetHandler),this.parent.off(setLockCells,this.lockCells),this.parent.off(protectsheetHandler,this.unprotectsheetHandler))},e.prototype.lockCells=function(e){var t,r=this.parent.getActiveSheet(),n="object"==typeof(t=e?e.range:r.selectedRange)?t:getSwapRange(getRangeIndexes(t));if(0===n[0]&&n[2]===r.rowCount-1)for(var i=n[1];i<=n[3];i++)setColumn(r,i,{isLocked:e.isLocked});for(i=n[0];i<=n[2];i++)for(var o=n[1];o<=n[3];o++)this.parent.getActiveSheet().id===r.id&&this.parent.notify(applyLockCells,{rowIdx:i,colIdx:o,isLocked:e.isLocked})},e.prototype.getModuleName=function(){return"workbookProtectSheet"},e}(),WorkbookMerge=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.merge=function(e){e.isAction&&(this.parent.notify("actionBegin",{eventArgs:e,action:"merge"}),e.model||(e.model=[])),"string"==typeof e.range&&(e.range=getRangeIndexes(e.range)),e.range=getSwapRange(e.range),e.skipChecking||this.mergedRange(e),e.merge&&"All"!==e.type?"Horizontally"===e.type?this.mergeHorizontally(e):"Vertically"===e.type&&this.mergeVertically(e):(this.mergeAll(e),e.refreshRibbon&&this.parent.notify(activeCellChanged,null)),this.parent.setUsedRange(e.range[2],e.range[3]),e.isAction&&this.parent.notify("actionComplete",{eventArgs:e,action:"merge"});var t=e.sheet||this.parent.getActiveSheet();this.parent.sheets.indexOf(t)===this.parent.activeSheetIndex&&this.parent.notify("selectRange",{address:t.selectedRange,skipChecking:!0})},e.prototype.mergeAll=function(e){var t,r=0;e.range=e.range;for(var n,i,o,a=e.sheet||this.parent.getActiveSheet(),s=e.range[0];s<=e.range[2];s++){n=0,e.isAction&&e.model.push({cells:[]});for(var l=e.range[1];l<=e.range[3];l++){if((t=getCell(s,l,a))&&(t.value||t.formula)&&!i&&(i=t.formula||t.value),e.isAction&&e.merge&&(e.model[s-e.range[0]].cells[l-e.range[1]]={},ej2Base.extend(e.model[s-e.range[0]].cells[l-e.range[1]],t,null,!0)),a.rows[s]&&a.rows[s].cells&&a.rows[s].cells[l]&&(delete a.rows[s].cells[l].rowSpan,delete a.rows[s].cells[l].colSpan,!e.merge&&!e.isAction&&e.model&&e.model[s-e.range[0]]&&e.model[s-e.range[0]].cells[l-e.range[1]]&&e.model[s-e.range[0]].cells[l-e.range[1]]!=={}&&setCell(s,l,a,e.model[s-e.range[0]].cells[l-e.range[1]])),e.merge){if(t=new Object,s===e.range[0]&&l===e.range[1]){e.range[3]-e.range[1]>0&&(t.colSpan=e.range[3]-e.range[1]+1),e.range[2]-e.range[0]>0&&(t.rowSpan=e.range[2]-e.range[0]+1),setCell(e.range[0],e.range[1],a,t,!0);continue}s!==e.range[0]&&(t.rowSpan=-r),l!==e.range[1]&&(n++,t.colSpan=-n),a.rows[s]&&a.rows[s].cells&&a.rows[s].cells[l]&&(delete a.rows[s].cells[l].value,delete a.rows[s].cells[l].formula),o=getCell(s,l,a)||{},setCell(s,l,a,Object.assign(t,o))}e.preventRefresh||this.parent.notify(applyMerge,{rowIdx:s,colIdx:l})}r++}e.merge&&(t=this.getCellValue(e.range[0],e.range[1],i,a),setCell(e.range[0],e.range[1],a,t,!0),e.preventRefresh||this.parent.notify(applyMerge,{rowIdx:e.range[0],colIdx:e.range[1]}))},e.prototype.mergeHorizontally=function(e){var t;e.range=e.range;for(var r,n,i,o,a=e.sheet||this.parent.getActiveSheet(),s=e.range[0];s<=e.range[2];s++){t=0,e.isAction&&e.model.push({cells:[]});for(var l=e.range[1];l<=e.range[3];l++){if(o=getCell(s,l,a),r=new Object,e.isAction&&(e.model[s-e.range[0]].cells[l-e.range[1]]={},Object.assign(e.model[s-e.range[0]].cells[l-e.range[1]],o)),l===e.range[1]){if(s===e.range[0])continue;i=s-1,a.rows[i]&&a.rows[i].cells&&a.rows[i].cells[l]&&delete a.rows[i].cells[l].rowSpan,r=this.getCellValue(i,l,n,a),e.range[3]-e.range[1]>0&&(r.colSpan=e.range[3]-e.range[1]+1),n=null,setCell(i,l,a,r,!0)}else o&&(o.value||o.formula)&&!n&&(n=o.formula||o.value),i=s,a.rows[i]&&a.rows[i].cells&&a.rows[i].cells[l]&&(delete a.rows[i].cells[l].rowSpan,delete a.rows[i].cells[l].value,delete a.rows[i].cells[l].formula),t++,r.colSpan=-t,setCell(i,l,a,r,!0);this.parent.notify(applyMerge,{rowIdx:i,colIdx:l})}}a.rows[e.range[2]]&&a.rows[e.range[2]].cells&&a.rows[e.range[2]].cells[e.range[1]]&&delete a.rows[e.range[2]].cells[e.range[1]].rowSpan,r=this.getCellValue(e.range[2],e.range[1],n,a),e.range[3]-e.range[1]>0&&(r.colSpan=e.range[3]-e.range[1]+1),setCell(e.range[2],e.range[1],a,r,!0),this.parent.notify(applyMerge,{rowIdx:e.range[2],colIdx:e.range[1]})},e.prototype.getCellValue=function(e,t,r,n){var i=new Object,o=getCell(e,t,n);return!r||o&&(o.value||o.formula)||(checkIsFormula(r)?i.formula=r:i.value=r),i},e.prototype.mergeVertically=function(e){var t=0;e.range=e.range;for(var r,n,i,o,a=e.sheet||this.parent.getActiveSheet(),s=e.range[1];s<=e.range[3];s++)for(var l=e.range[0];l<=e.range[2];l++){if(o=getCell(l,s,a),e.isAction&&(void 0===e.model[l-e.range[0]]&&(e.model[l-e.range[0]]={cells:[]}),e.model[l-e.range[0]].cells[s-e.range[1]]={},Object.assign(e.model[l-e.range[0]].cells[s-e.range[1]],o)),l===e.range[0]){if(t=0,s===e.range[1])continue;i=s-1,a.rows[l]&&a.rows[l].cells&&a.rows[l].cells[i]&&delete a.rows[l].cells[i].colSpan,r=this.getCellValue(l,i,n,a),e.range[2]-e.range[0]>0&&(r.rowSpan=e.range[2]-e.range[0]+1),n=null,setCell(l,i,a,r,!0)}else r=new Object,o&&(o.value||o.formula)&&!n&&(n=o.formula||o.value),t++,i=s,a.rows[l]&&a.rows[l].cells&&a.rows[l].cells[i]&&(delete a.rows[l].cells[i].colSpan,delete a.rows[l].cells[i].value,delete a.rows[l].cells[i].formula),r.rowSpan=-t,setCell(l,i,a,r,!0);this.parent.notify(applyMerge,{rowIdx:l,colIdx:i})}a.rows[e.range[0]]&&a.rows[e.range[0]].cells&&a.rows[e.range[0]].cells[e.range[3]]&&delete a.rows[e.range[0]].cells[e.range[3]].colSpan,r=this.getCellValue(e.range[0],e.range[1],n,a),e.range[2]-e.range[0]>0&&(r.rowSpan=e.range[2]-e.range[0]+1),setCell(e.range[0],e.range[3],a,r,!0),this.parent.notify(applyMerge,{rowIdx:e.range[0],colIdx:e.range[3]})},e.prototype.activeCellRange=function(e){e.range=e.range;var t=this.parent.getActiveSheet(),r=getCell(e.range[0],e.range[1],t);r&&(!ej2Base.isNullOrUndefined(r.rowSpan)&&r.rowSpan<0&&(e.range[0]+=r.rowSpan,e.insertCount&&(e.range[0]-=e.insertCount)),!ej2Base.isNullOrUndefined(r.colSpan)&&r.colSpan<0&&(e.range[1]+=r.colSpan,e.insertCount&&(e.range[1]-=e.insertCount)),(r=getCell(e.range[0],e.range[1],t))&&(r.rowSpan>1&&(e.range[0]+(r.rowSpan-1)>=e.range[2]||e.insertCount)&&(e.range[2]=e.range[0]+(r.rowSpan-1)),r.colSpan>1&&(e.range[1]+(r.colSpan-1)>=e.range[3]||e.insertCount)&&(e.range[3]=e.range[1]+(r.colSpan-1))))},e.prototype.mergedRange=function(e){"string"==typeof e.range&&(e.range=getRangeIndexes(e.range)),e.range[0]<=e.range[2]&&e.range[1]<=e.range[3]?this.forward(e):e.range[0]>=e.range[2]&&e.range[1]>=e.range[3]?this.reverse(e):e.range[0]<e.range[2]&&e.range[1]>e.range[3]?this.forwardReverse(e):e.range[0]>e.range[2]&&e.range[1]<e.range[3]&&this.reverseForward(e)},e.prototype.forward=function(e){e.range=e.range;var t,r,n=e.sheet||this.parent.getActiveSheet(),i=getCell(e.range[0],e.range[1],n),o=t=e.range[0],a=r=e.range[1];if(i&&(!ej2Base.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(o=t=e.range[0]+i.rowSpan),!ej2Base.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(a=r=e.range[1]+i.colSpan),(i=getCell(o,a,n))&&(i.rowSpan>1&&(t+=i.rowSpan-1,o+(i.rowSpan-1)>=e.range[2]&&(e.range[2]=e.range[0],e.range[2]=o+(i.rowSpan-1))),i.colSpan>1&&(r+=i.colSpan-1,a+(i.colSpan-1)>=e.range[3]&&(e.range[3]=e.range[1],e.range[3]=a+(i.colSpan-1))))),e.range[0]=o,e.range[1]=a,e.range[0]===o&&e.range[1]===a&&e.range[2]===t&&e.range[3]===r&&(e.isActiveCell=!0),!e.skipChecking){for(var s=e.range[1];s<=e.range[3];s++)(i=getCell(e.range[2],s,n))&&(o=e.range[2],a=s,!ej2Base.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(a+=i.colSpan)<e.range[1]&&(e.range[1]=a),!ej2Base.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(o+=i.rowSpan)<e.range[0]&&(e.range[0]=o),(i=getCell(o,a,n))&&(i.colSpan>1&&a+(i.colSpan-1)>e.range[3]&&(e.range[3]=a,e.range[3]=a+(i.colSpan-1)),i.rowSpan>1&&o+(i.rowSpan-1)>e.range[2]&&(e.range[2]=o,e.range[2]=o+(i.rowSpan-1))));var l,d;for(s=e.range[1];s<=e.range[3];s++)(i=getCell(e.range[0],s,n))&&(d=s,l=e.range[0],!ej2Base.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(d+=i.colSpan)<e.range[1]&&(e.range[1]=d),!ej2Base.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(l+=i.rowSpan)<e.range[0]&&(e.range[0]=l));for(s=e.range[0];s<=e.range[2];s++)(i=getCell(s,e.range[3],n))&&(o=s,a=e.range[3],!ej2Base.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(o+=i.rowSpan)<e.range[0]&&(e.range[0]=o),!ej2Base.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(a+=i.colSpan)<e.range[1]&&(e.range[1]=a),(i=getCell(o,a,n))&&(i.rowSpan>1&&o+(i.rowSpan-1)>e.range[2]&&(e.range[2]=o,e.range[2]=o+(i.rowSpan-1)),i.colSpan>1&&a+(i.colSpan-1)>e.range[3]&&(e.range[3]=a,e.range[3]=a+(i.colSpan-1))))}},e.prototype.forwardReverse=function(e){var t=this.parent.getActiveSheet();e.range=e.range;var r=e.range[1],n=getCell(e.range[0],e.range[1],t),i=e.range[0];if(n&&(!ej2Base.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(r+=n.colSpan,e.range[3]>=r&&(e.range[3]=r)),!ej2Base.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(i+=n.rowSpan)<e.range[0]&&(e.range[0]=i),(n=getCell(i,r,t))&&(n.rowSpan>1&&i+(n.rowSpan-1)>=e.range[2]&&(e.range[2]=i+(n.rowSpan-1)),n.colSpan>1&&r+(n.colSpan-1)>=e.range[1]&&(e.range[1]=r+(n.colSpan-1)))),e.range[0]=i,!e.skipChecking){for(var o,a,s=e.range[3];s<=e.range[1];s++)(n=getCell(e.range[2],s,t))&&(a=s,o=e.range[2],!ej2Base.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(o+=n.rowSpan)<e.range[0]&&(e.range[0]=o),!ej2Base.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(a+=n.colSpan)<e.range[3]&&(e.range[3]=a),(n=getCell(o,a,t))&&(n.rowSpan>1&&o+(n.rowSpan-1)>e.range[2]&&(e.range[2]=o+(n.rowSpan-1)),n.colSpan>1&&a+(n.colSpan-1)>e.range[1]&&(e.range[1]=a+(n.colSpan-1))));var l;for(s=e.range[3];s<=e.range[1];s++)(n=getCell(e.range[0],s,t))&&(a=s,l=e.range[0],!ej2Base.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(l+=n.rowSpan)<e.range[0]&&(e.range[0]=l),!ej2Base.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(a+=n.colSpan),(n=getCell(l,a,t))&&(n.rowSpan>1&&l+(n.rowSpan-1)>e.range[2]&&(e.range[2]=l+(n.rowSpan-1)),n.colSpan>1&&a+(n.colSpan-1)>e.range[1]&&(e.range[1]=a,e.range[1]=a+(n.colSpan-1))));var d;for(s=e.range[0];s<=e.range[2];s++)(n=getCell(s,e.range[3],t))&&(l=s,d=e.range[3],!ej2Base.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(l+=n.rowSpan)<e.range[0]&&(e.range[0]=l),!ej2Base.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(d+=n.colSpan)<e.range[3]&&(e.range[3]=d),(n=getCell(l,d,t))&&(n.rowSpan>1&&l+(n.rowSpan-1)>e.range[2]&&(e.range[2]=l,e.range[2]=l+(n.rowSpan-1)),n.colSpan>1&&d+(n.colSpan-1)>e.range[1]&&(e.range[1]=d,e.range[1]=d+(n.colSpan-1))))}},e.prototype.reverse=function(e){e.range=e.range;var t=e.range[1],r=e.sheet||this.parent.getActiveSheet(),n=getCell(e.range[0],e.range[1],r),i=e.range[0];n&&(!ej2Base.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(t+=n.colSpan),!ej2Base.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(i+=n.rowSpan),e.range[2]>=i&&(e.range[2]=i,e.isActiveCell=!0),e.range[3]>=t?(e.range[3]=t,e.range[2]===i&&(e.isActiveCell=!0)):e.isActiveCell&&(e.isActiveCell=!1),(n=getCell(i,t,r))&&(n.rowSpan>1&&i+(n.rowSpan-1)>=e.range[0]&&(e.range[0]=i,e.range[0]=i+(n.rowSpan-1)),n.colSpan>1&&t+(n.colSpan-1)>=e.range[1]&&(e.range[1]=t,e.range[1]=t+(n.colSpan-1))));var o=e.range[3];if(!e.skipChecking){for(var a=e.range[3];a<=e.range[1];a++)(n=getCell(e.range[2],a,r))&&(o=a,i=e.range[2],!ej2Base.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(i+=n.rowSpan)<e.range[2]&&(e.range[2]=i),!ej2Base.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(o+=n.colSpan)<e.range[3]&&(e.range[3]=o),(n=getCell(i,o,r))&&(n.rowSpan>1&&i+(n.rowSpan-1)>e.range[0]&&(e.range[0]=i,e.range[0]=i+(n.rowSpan-1)),n.colSpan>1&&o+(n.colSpan-1)>e.range[1]&&(e.range[1]=o,e.range[1]=o+(n.colSpan-1))));o=e.range[3];for(a=e.range[3];a<=e.range[1];a++)(n=getCell(e.range[0],a,r))&&(o=a,i=e.range[0],!ej2Base.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(o+=n.colSpan),!ej2Base.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(i+=n.rowSpan),(n=getCell(i,o,r))&&(n.colSpan>1&&o+(n.colSpan-1)>e.range[1]&&(e.range[1]=o,e.range[1]=o+(n.colSpan-1)),n.rowSpan>1&&i+(n.rowSpan-1)>e.range[0]&&(e.range[0]=i,e.range[0]=i+(n.rowSpan-1))));var s,l;for(a=e.range[2];a<=e.range[0];a++)(n=getCell(a,e.range[3],r))&&(l=a,s=e.range[3],!ej2Base.isNullOrUndefined(n.rowSpan)&&n.rowSpan<0&&(l+=n.rowSpan)<e.range[2]&&(e.range[2]=l),!ej2Base.isNullOrUndefined(n.colSpan)&&n.colSpan<0&&(s+=n.colSpan)<e.range[3]&&(e.range[3]=s),(n=getCell(l,s,r))&&(n.rowSpan>1&&l+(n.rowSpan-1)>e.range[0]&&(e.range[0]=l,e.range[0]=l+(n.rowSpan-1)),n.colSpan>1&&s+(n.colSpan-1)>e.range[1]&&(e.range[1]=s,e.range[1]=s+(n.colSpan-1))))}},e.prototype.reverseForward=function(e){e.range=e.range;var t=e.sheet||this.parent.getActiveSheet(),r=e.range[0],n=e.range[1],i=getCell(e.range[0],e.range[1],t);if(i&&(!ej2Base.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(r+=i.rowSpan,e.range[2]>=r&&(e.range[2]=r)),!ej2Base.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(n+=i.colSpan),(i=getCell(r,n,t))&&(i.rowSpan>1&&r+(i.rowSpan-1)>=e.range[0]&&(e.range[0]=r,e.range[0]=r+(i.rowSpan-1)),i.colSpan>1&&n+(i.colSpan-1)>=e.range[3]&&(e.range[3]=e.range[1],e.range[3]=n+(i.colSpan-1)))),!e.skipChecking){for(var o,a=e.range[3],s=e.range[1];s<=e.range[3];s++)(i=getCell(e.range[2],s,t))&&(o=e.range[2],a=s,!ej2Base.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(o+=i.rowSpan)<e.range[2]&&(e.range[2]=o),!ej2Base.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(a+=i.colSpan)<e.range[1]&&(e.range[1]=a),(i=getCell(o,a,t))&&(i.colSpan>1&&a+(i.colSpan-1)>e.range[3]&&(e.range[3]=a+(i.colSpan-1)),i.rowSpan>1&&i.rowSpan-1+o>e.range[0]&&(e.range[0]=i.rowSpan-1+o)));var l,d;for(s=e.range[1];s<=e.range[3];s++)(i=getCell(e.range[0],s,t))&&(d=s,l=e.range[0],!ej2Base.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(d+=i.colSpan)<e.range[1]&&(e.range[1]=d),!ej2Base.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(l+=i.rowSpan),(i=getCell(l,d,t))&&i.rowSpan>1&&l+(i.rowSpan-1)>e.range[0]&&(e.range[0]=l+(i.rowSpan-1)));var p;for(s=e.range[2];s<=e.range[0];s++)(i=getCell(s,e.range[3],t))&&(o=s,p=e.range[3],!ej2Base.isNullOrUndefined(i.rowSpan)&&i.rowSpan<0&&(o+=i.rowSpan)<e.range[2]&&(e.range[2]=o),!ej2Base.isNullOrUndefined(i.colSpan)&&i.colSpan<0&&(p+=i.colSpan)<e.range[1]&&(e.range[1]=p),(i=getCell(o,p,t))&&(i.rowSpan>1&&i.rowSpan-1+o>e.range[0]&&(e.range[0]=i.rowSpan-1+o),i.colSpan>1&&i.colSpan-1+p>e.range[3]&&(e.range[3]=p,e.range[3]=i.colSpan-1+p)))}},e.prototype.insertHandler=function(e){this.activeCellRange(e),e.range=e.range,"Row"===e.insertModel?e.range[2]+=e.insertCount:e.range[3]+=e.insertCount,e.preventRefresh=!0,e.merge=!0,this.mergeAll(e)},e.prototype.pasteHandler=function(e){for(var t,r,n,i=this.parent.getActiveSheet(),o=getCellIndexes(i.activeCell),a=e.range[0],s=0;a<=e.range[2];a++,s++)for(var l=e.range[1],d=0;l<=e.range[3];l++,d++){if((t=getCell(a,l,e.prevSheet)||{}).rowSpan>1&&(n=getCell(o[0]+(t.rowSpan-1),o[1],i)||{},r=getCell(o[0]+1,o[1],i)||{},void 0!==n.colSpan&&n.colSpan<0||void 0!==r.colSpan&&r.colSpan<0))return e.cancel=!0,void this.parent.notify(applyMerge,{showDialog:!0});if(t.colSpan>1&&(n=getCell(o[0],o[1]+(t.colSpan-1),i)||{},r=getCell(o[0],o[1]+1,i)||{},void 0!==n.rowSpan&&n.rowSpan<0||void 0!==r.rowSpan&&r.rowSpan<0))return e.cancel=!0,void this.parent.notify(applyMerge,{showDialog:!0})}},e.prototype.addEventListener=function(){this.parent.on(setMerge,this.merge,this),this.parent.on(mergedRange,this.mergedRange,this),this.parent.on(activeCellMergedRange,this.activeCellRange,this),this.parent.on(insertMerge,this.insertHandler,this),this.parent.on(pasteMerge,this.pasteHandler,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(setMerge,this.merge),this.parent.off(mergedRange,this.mergedRange),this.parent.off(activeCellMergedRange,this.activeCellRange),this.parent.off(insertMerge,this.insertHandler),this.parent.off(pasteMerge,this.pasteHandler))},e.prototype.getModuleName=function(){return"workbookmerge"},e}(),WorkbookConditionalFormat=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(setCFRule,this.setCFrulHandler,this),this.parent.on(clearCFRule,this.clearRules,this),this.parent.on(cFUndo,this.cFUndoHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(setCFRule,this.setCFrulHandler),this.parent.off(clearCFRule,this.clearRules),this.parent.off(cFUndo,this.cFUndoHandler))},e.prototype.setCFrulHandler=function(e){var t=e.conditionalFormat,r=t.range,n=e.isUndoRedo?e.sheetIdx:this.parent.getAddressInfo(r).sheetIndex,i=getSheet(this.parent,n),o=getSwapRange(getRangeIndexes(r=r||i.selectedRange));t.range=getRangeAddress(o),i.conditionalFormats||this.parent.setSheetPropertyOnMute(i,"conditionalFormats",[]);var a=i.conditionalFormats.length;if(i.conditionalFormats[a]=t,e.isUndoRedo&&n!==this.parent.activeSheetIndex)this.parent.notify(goto,{address:i.name+"!"+t.range});else for(var s=o[0];s<=o[2];s++){i.rows[s]||setRow(i,s,{});for(var l=o[1];l<=o[3];l++)if(i.rows[s].cells&&i.rows[s].cells[l]||setCell(s,l,i,{}),n===this.parent.activeSheetIndex){var d=i.rows[s].cells[l];this.parent.notify(cFInitialCheck,{rowIdx:s,colIdx:l,cell:d,conditionalFormat:t,isAction:e.isAction})}}},e.prototype.clearRule=function(e){for(var t=e[0];t<=e[2];t++)for(var r=e[1];r<=e[3];r++)this.parent.notify(clearCF,{rIdx:t,cIdx:r})},e.prototype.clearRules=function(e){var t,r,n,i,o,a,s,l,d=!!ej2Base.isNullOrUndefined(e.isPublic),p=[],h=[],c=!0,u=e.range,g=e.isUndoRedo?e.sheetIdx:this.parent.getAddressInfo(u).sheetIndex,f=getSheet(this.parent,g),m=f.conditionalFormats,v=getRangeIndexes(u);if(g===this.parent.activeSheetIndex)if(m&&v[2]===f.rowCount-1&&v[3]===f.colCount-1&&0===v[0]&&0===v[1])for(var C=0;C<m.length;C++){var y=getRangeIndexes(m[C].range);this.clearRule(y)}else this.clearRule(v);if(m){for(var x=m.length-1;x>=0;x--){var b=!1,S="",w=m[x],I=w.range.split(",");if(g===this.parent.activeSheetIndex&&(e.isClearCF||!e.isUndoRedo))for(var R=0;R<I.length;R++){var E=!1,k=getRangeIndexes(I[R]);s=k[0],l=k[0],o=k[1],a=k[1],k[0]>=v[0]&&k[2]<=v[2]&&k[1]>=v[1]&&k[3]<=v[3]&&(E=!0);for(var F=k[0];F<=k[2];F++){for(var A=0,B=k[1];B<=k[3];B++)for(var T=v[0];T<=v[2];T++)for(var D=v[1];D<=v[3];D++)if(T===F&&D===B){var N=this.parent.getCellStyleValue(["backgroundColor","color"],[T,D]);this.parent.notify(applyCellFormat,{style:N,rowIdx:T,colIdx:D,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0}),A+=1,b=!0,T===k[0]?D===k[3]?o===k[1]?a===D?a=D:o=D-1:o!==k[1]&&a+1===D?(a=k[1],o-=1):o!==k[1]&&a===k[1]&&(o=v[1]-1):D===k[1]?a===k[1]&&(a=D+1):o===k[1]&&a===k[1]?(o=D,a=D):a=o===k[1]&&a!==k[1]?D+1:D:D===k[1]?a===k[1]&&k[1]!==k[3]&&(a=D+1):D===k[3]?o===k[1]?a===D?a=D:o=D-1:o!==k[1]&&a===k[1]?o=v[1]-1:o!==k[1]&&a+1===D?(a=k[1],o=v[1]-1):l=T:o===k[1]&&a===k[1]?(o=D,a=D):a!==k[1]&&o!==k[1]?a=D:o!==k[1]&&a===k[1]?o=D:a=D+1}A>0&&!E?(c&&(t=s,r=l,n=o,i=a),o===k[1]&&a!==k[1]?a===k[3]?(s!==F&&(S=S+" "+getRangeAddress([s,n,r,k[3]])),o===k[1]&&a===k[3]&&(F===k[2]?k[1]===v[3]&&(S=S+" "+getRangeAddress([F,a,F,k[3]])):(v[2]===k[0]&&a!==k[3]&&(S=S+" "+getRangeAddress([F,a,F,k[3]])),s=F+1,l=F+1,a=k[1]))):i!==a?(S=S+" "+getRangeAddress([s,i,F-1,k[3]]),a===k[3]&&o===k[1]?(s=F+1,l=F+1,a=k[1]):(s=F,l=F),a===k[3]&&o!==k[1]&&(o=k[1])):n!==o?(S=S+" "+getRangeAddress([s,k[1],F-1,n]),s=F+1,l=F+1,o=k[1],a=k[1]):F===k[2]?S=S+" "+getRangeAddress([s,a,F,k[3]]):(l<F||o===k[1]&&a===k[3])&&(l=F):a===k[1]&&o!==k[1]?(i!==a&&(S=S+" "+getRangeAddress([s,i,F-1,k[3]]),s=F,l=F),n!==o&&(S=S+" "+getRangeAddress([s,n,F-1,k[3]]),s=F,l=F),F===k[2]?S=S+" "+getRangeAddress([s,a,F,o]):l=F):a!==k[1]&&o!==k[1]?F===k[2]&&k[2]===v[0]?S=k[0]===k[2]?(S=S+" "+getRangeAddress([s,k[1],l,o-1]))+" "+getRangeAddress([s,a+1,l,k[3]]):(S=(S=S+" "+getRangeAddress([s,k[1],l,k[3]]))+" "+getRangeAddress([k[2],k[1],k[2],o-1]))+" "+getRangeAddress([k[2],a+1,k[2],k[3]]):F===k[2]?S=(S=S+" "+getRangeAddress([s,k[1],F,o-1]))+" "+getRangeAddress([s,a+1,F,k[3]]):(n===k[1]&&i===k[1]&&(S=S+" "+getRangeAddress([s,n,l,k[3]]),s=F),l=F):o===k[1]&&a===k[1]&&(v[2]!==k[0]?(k[2]>=v[2]&&F>v[2]&&(S=S+" "+getRangeAddress([s,o,l,k[3]])),k[1]===k[3]&&F<=k[2]&&t!==k[2]&&F!==t&&(S=S+" "+getRangeAddress([s,o,l,k[3]])),k[1]===k[3]&&(s=F+1,l=F+1)):((F===k[2]||F===k[0]&&k[1]!==k[3])&&(S=S+" "+getRangeAddress([s,o,l,a])),s=F+1,l=F+1),F===k[2]&&k[0]!==k[2]&&k[1]!==k[3]&&(S=S+" "+getRangeAddress([F,o,F,a]))),c||(t=s,r=l<=k[2]?l:k[2],n=o,i=a<=k[3]?a:k[3]),c=!1):E||(c&&(t=s,r=l,n=o,i=a),o===k[1]&&a===k[1]&&(F===k[2]&&(S=S+" "+getRangeAddress([s,o,F,k[3]])),l=F),a!==k[1]&&o!==k[1]&&(S=(S=S+" "+getRangeAddress([s,k[1],F-1,o-1]))+" "+getRangeAddress([s,a+1,F-1,k[3]]),s=F,l=F,o=k[1],a=k[1]),a!==k[1]&&o===k[1]&&(S=S+" "+getRangeAddress([s,a,F-1,k[3]]),s=F,l=F,o=k[1],a=k[1]),o!==k[1]&&a===k[1]&&(S=S+" "+getRangeAddress([s,a,F-1,o]),s=F,l=F,o=k[1],a=k[1]),c||(t=s,r=l<=k[2]?l:k[2],n=o,i=a<=k[3]?a:k[3]),c=!1)}}if(""===S?(h.push(f.conditionalFormats[x].range),f.conditionalFormats.splice(x,1)):(h.push(f.conditionalFormats[x].range),f.conditionalFormats[x].range=S.trim().replace(" ",",")),b&&!d&&(w.range=S.trim().replace(" ",","),p.push(w)),e.isUndoRedo){this.parent.activeSheetIndex!==e.sheetIdx&&this.parent.notify(goto,{address:f.name+"!"+e.range});break}}if(!d){var O={cFormats:p,oldRange:h,selectedRange:u,sheetIdx:g};this.parent.notify(completeAction,{eventArgs:O,action:"clearCF"})}e.isclearFormat||this.parent.notify(addHighlight,{range:u,isclearFormat:!0})}},e.prototype.cFUndoHandler=function(e){if(e.sheetIdx===this.parent.activeSheetIndex)for(var t=e.conditionalFormat,r=t.range.split(","),n=getSheet(this.parent,e.sheetIdx),i=0;i<r.length;i++)for(var o=getRangeIndexes(r[i]),a=o[0];a<=o[2];a++)for(var s=o[1];s<=o[3];s++){var l=n.rows[a].cells[s];this.parent.notify(cFInitialCheck,{rowIdx:a,colIdx:s,cell:l,conditionalFormat:t,isAction:!0})}},e.prototype.getModuleName=function(){return"workbookConditionalFormatting"},e}(),WorkbookAutoFill=function(){function e(e){this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueLTOperator=String.fromCharCode(142),this.uniqueMOperator=String.fromCharCode(135),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.parent=e,this.addEventListener()}return e.prototype.getFillInfo=function(e){for(var t="",r=!0,n="CopyCells",i=[],o=["Down","Up"].indexOf(e.direction)>-1,a=this.getRangeData({range:e.dataRange,sheetIdx:this.parent.activeSheetIndex}),s=a.join().replace(/,/g,"").length,l=this.isRange(e.dataRange)&&s?a.length:1;l--;)if(t=a[l]&&!ej2Base.isNullOrUndefined(a[l].value)?a[l].value:"",isNumber(t)||checkIsFormula(t)||isNumber(t[t.length-1])){r=!1,n=this.parent.autoFillSettings.fillType;break}return s&&!r||(i.push("Fill Series"),n="FillSeries"===e.fillType?n:e.fillType),(!o||o&&e.dataRange[1]!==e.dataRange[3])&&i.push("Flash Fill"),{fillType:n,disableItems:i}},e.prototype.isRange=function(e){return e&&(e[0]!==e[2]||e[1]!==e[3])},e.prototype.autoFill=function(e){if(e.dataRange&&e.fillRange&&e.direction&&this.parent.allowEditing&&(!this.parent.getActiveSheet().isProtected||!e.isLockedCell)){var t={dataRange:null,fillRange:null,fillType:null,direction:null},r=getSwapRange(getRangeIndexes(e.dataRange)),n=getSwapRange(getRangeIndexes(e.fillRange));switch(this.fillInfo=this.getFillInfo({dataRange:r,fillRange:n,fillType:e.fillType,direction:e.direction}),t.dataRange=r,t.fillRange=n,t.direction=e.direction,t.fillType=e.fillType||this.fillInfo.fillType,this.fillInfo.fillType=e.isFillOptClick?e.fillType:this.fillInfo.fillType,e.fillType){case"FillSeries":case"FillWithoutFormatting":this.fillSeries(t);break;case"CopyCells":case"FillFormattingOnly":this.copyCells(t)}}},e.prototype.fillSeries=function(e){for(var t,r,n,i,o,a,s,l,d,p,h,c,u,g,f,m,v,C,y,x,b={},S=0,w=this.parent.getActiveSheet(),I=e.dataRange[0],R=e.dataRange[1],E=e.dataRange[2],k=e.dataRange[3],F=e.fillRange[0],A=e.fillRange[1],B=e.fillRange[2],T=e.fillRange[3],D=["Down","Up"].indexOf(e.direction)>-1,N=["Up","Left"].indexOf(e.direction)>-1,O=D?k-R:E-I,L="FillSeries"===e.fillType;S<=O;){if(o=this.updateFillValues(D,I,R,E,k,F,A,B,T,S),a=o.patternRange,s=o.fillRange,n=this.getPattern(a,{isRFill:N,isVFill:D}),l=this.getRangeData({range:a,sheetIdx:this.parent.activeSheetIndex}),p=l.length,!n)return;for(r=n.length,C=(v=this.getSelectedRange(w,{rowIndex:s[0],colIndex:s[1]},{rowIndex:s[2],colIndex:s[3]})).length,N&&(v=v.reverse(),n=n.reverse(),n=this.ensurePattern(n),l=l.reverse()),h=0;h<C;){switch(y=v[h],i=n[h%r],isNumber(i)&&(i=n[i]),u=h%p,i.type){case"number":if(t=this.round(i.regVal.a+i.regVal.b*i.i,5).toString(),(i=i).dataVal){if(void 0===i.copy&&(i.copy=i.val.length>2,i.copy))for(var H=2;H<i.val.length&&(i.copy=Math.abs(this.round(i.regVal.a+i.regVal.b*H,5))!==i.val[H],!i.copy);H++);t=i.copy?l[u]&&!ej2Base.isNullOrUndefined(l[u].value)?l[u].value:"":i.start?Math.abs(Number(t))+i.dataVal:i.dataVal+Math.abs(Number(t))}N?i.i--:i.i++;break;case"string":var j=i.i%i.val.length;t=i.val[j],i.i++;break;case"formula":for(m=!1,t="=",c=0,g=i.val.length;c<g;)"object"==typeof(d=i.val[c])?(m=!0,t+=(f=this.round(d.a+d.b*i.i,5))<1?"#REF!":D?d.c+(d.b?f:"$"+f):(d.b?getColumnHeaderText(f):"$"+getColumnHeaderText(f))+d.c):t+=d,c++;m&&N?i.i--:i.i++;break;case"time":t=(i.regVal.a+i.regVal.b*i.i).toString(),N?i.i--:i.i++}x=getCell(y.rowIndex,y.colIndex,w,!1,!0),L?Object.assign(b,l[u],null,!0):(b.style=x.style,b.format=x.format,b.wrap=x.wrap,b.rowSpan=x.rowSpan,b.colSpan=x.colSpan),b.value=t,checkIsFormula(t)&&(b.formula=t),updateCell(this.parent,w,{cell:b,rowIdx:y.rowIndex,colIdx:y.colIndex,valChange:!0,uiRefresh:!0,pvtExtend:!0}),b={},h++}S++}},e.prototype.copyCells=function(e){for(var t,r,n,i,o,a,s,l,d,p,h,c=0,u={},g=e.dataRange[0],f=e.dataRange[1],m=e.dataRange[2],v=e.dataRange[3],C=e.fillRange[0],y=e.fillRange[1],x=e.fillRange[2],b=e.fillRange[3],S=["Down","Up"].indexOf(e.direction)>-1,w=["Up","Left"].indexOf(e.direction)>-1,I=S?v-f:m-g,R=this.parent.getActiveSheet(),E="FillFormattingOnly"===e.fillType;c<=I;){if(o=this.updateFillValues(S,g,f,m,v,C,y,x,b,c),n=o.patternRange,i=o.fillRange,a=this.getRangeData({range:n,sheetIdx:this.parent.activeSheetIndex}),s=a.length,l=this.getSelectedRange(R,{rowIndex:i[0],colIndex:i[1]},{rowIndex:i[2],colIndex:i[3]}),d=l.length,t=0,w&&(l=l.reverse()),E)for(;t<d;)r=t%s,h=getCell((p=l[t]).rowIndex,p.colIndex,R),Object.assign(u,a[r],null,!0),u.value=h.value,u.formula=h.formula,updateCell(this.parent,R,{cell:u,rowIdx:p.rowIndex,colIdx:p.colIndex,valChange:!0,uiRefresh:!0,pvtExtend:!0}),u={},t++;else for(;t<d;)r=t%s,p=l[t],Object.assign(u,a[r],null,!0),updateCell(this.parent,R,{cell:u,rowIdx:p.rowIndex,colIdx:p.colIndex,valChange:!0,uiRefresh:!0,pvtExtend:!0}),u={},t++;c++}},e.prototype.updateFillValues=function(e,t,r,n,i,o,a,s,l,d){var p,h,c,u;e?(p={rowIndex:t,colIndex:r+d},h={rowIndex:n,colIndex:r+d},c={rowIndex:o,colIndex:a+d},u={rowIndex:s,colIndex:a+d}):(p={rowIndex:t+d,colIndex:r},h={rowIndex:t+d,colIndex:i},c={rowIndex:o+d,colIndex:a},u={rowIndex:o+d,colIndex:l});return{patternRange:[p.rowIndex,p.colIndex,h.rowIndex,h.colIndex],fillRange:[c.rowIndex,c.colIndex,u.rowIndex,u.colIndex]}},e.prototype.getType=function(e,t){var r;return t?r="time":checkIsFormula(e)?r="formula":isNumber(e)&&(r="number"),r||"string"},e.prototype.getDataPattern=function(e){var t,r,n,i=0,o={val:null,type:null},a=[],s=this.getRangeData({range:e,sheetIdx:this.parent.activeSheetIndex}),l=s.length;if(l){for(var d=void 0,p=void 0,h=function(e){return!n&&e&&"-"===e[e.length-1]?e.slice(0,e.length-1):e};i<l;){if(t=s[i]?s[i].formula?s[i].formula:ej2Base.isNullOrUndefined(s[i].value)?"":s[i].value:"",r=this.getType(t,s[i]&&"h:mm:ss AM/PM"===s[i].format),p="","string"===r){if(n=!1,isNumber(t[0])){d=0;do{d++}while(isNumber(t[d]));" "===t[d]&&(n=!0,r="number",p=t.slice(d,t.length),t=Number(t.slice(0,d)))}if(t=t,!n&&isNumber(t[t.length-1])){d=1;do{d++}while(isNumber(t[t.length-d]));r="number",d-=1,p=t.slice(0,t.length-d),t=Number(t.slice(t.length-d,t.length)),o.dataVal&&o.dataVal!==p&&o.dataVal===h(p)&&(p=o.dataVal)}}0===i?(o={val:[t],type:r},p&&(o.dataVal=p,o.start=n)):r!==o.type||o.dataVal&&h(o.dataVal)!==h(p)?(a.push(o),o={val:[t],type:r},p&&(o.dataVal=p,o.start=n)):o.val.push(t),i++}return a.push(o),a}return[{val:null,type:null}]},e.prototype.getPredictionValue=function(e,t){for(var r=0,n=0,i=0,o=0,a=0,s=0,l=0,d=e.length;r<d;)n+=r,i+=Number(e[r]),o+=r*Number(e[r]),a+=r*r,r++;return t?(s=(i*a-n*o)/(d*a-n*n),l=(d*o-n*i)/(d*a-n*n)):(s=this.round((i*a-n*o)/(d*a-n*n),5),l=this.round((d*o-n*i)/(d*a-n*n),5)),{a:s,b:l}},e.prototype.getPattern=function(e,t){var r,n,i,o,a,s,l=0,d=[],p=this.getDataPattern(e),h=p.length;if(p){for(;l<h;){switch((s=p[l]).type){case"number":if(n=d.length,a=s.val.length,o=t.isRFill?-1:a,1===a){var c=parseFloat(s.val[0])+1;s.val.push(c)}for(i={regVal:this.getPredictionValue(s.dataVal?s.val.slice(0,2):s.val),type:s.type,i:o},s.dataVal&&(i.dataVal=s.dataVal,i.val=s.val,i.start=s.start),d.push(i),r=1;r<a;)d.push(n),r++;break;case"string":for(n=d.length,i={val:s.val,type:s.type,i:0},d.push(i),r=1,a=s.val.length;r<a;)d.push(n),r++;break;case"formula":if(a=s.val.length,s=this.getFormulaPattern(s.val,t),o=t.isRFill?-1:a,s.isInPattern)for(n=d.length,i={val:s.val,type:"formula",i:o},d.push(i),r=1;r<a;)d.push(n),r++;else for(r=0,o=t.isRFill?-1:1;r<a;)d.push({val:s.val[r],type:"formula",i:o}),r++;break;case"time":if(n=d.length,a=s.val.length,o=t.isRFill?-1:1,1===a){var u=intToDate(s.val[0]),g=dateToInt(new Date(u.getTime()+36e5),!0);s.val.push(g)}for(i={regVal:this.getPredictionValue(s.val,!0),type:s.type,i:o},d.push(i),r=1;r<a;)d.push(n),r++}l++}return d}return[{regVal:null}]},e.prototype.isCellReference=function(e){return/^[a-z]{1,3}\d{1,7}$/gi.test(e)?"relative":/^\$[a-z]{1,3}\$\d{1,7}$/gi.test(e)?"absolute":!!/^((\$[a-z]{1,3})\d{1,7}|[a-z]{1,3}(\$\d{1,7}))$/gi.test(e)&&"mixed"},e.prototype.round=function(e,t){return Number(Math.round(parseFloat(e+"e"+t))+"e-"+t)},e.prototype.getRangeData=function(e){for(var t,r=[],n=this.parent.getActiveSheet(),i=e.range[0],o=e.range[1],a=e.range[2],s=e.range[3],l=o;i<=a;)if(isHiddenRow(n,i))i++;else{for(o=l;o<=s;)isHiddenCol(n,o)?o++:(t=getCell(i,o,n),r.push(t),o++);i++}return r},e.prototype.getFormulaPattern=function(e,t){for(var r,n,i,o,a=[],s=0,l=e.length;s<l;)a.push(this.parseFormula(e[s])),s++;var d=this.isInPattern(a,t.isVFill);if(d){for(s=(i=a[0]).length;s--;)n=i[s],(o=this.isCellReference(n))&&"absolute"!==o&&(i[s]=this.getCellRefPrediction(n,t,null,o));return{isInPattern:d,val:i}}for(s=0;s<l;){for(r=(i=a[s]).length;r--;)n=i[r],(o=this.isCellReference(n))&&"absolute"!==o&&(a[s][r]=this.getCellRefPrediction(n,t,l,o));s++}return{isInPattern:d,val:a}},e.prototype.generateColCount=function(e){for(var t=0,r=e.split("").reverse().join(""),n=r.length-1;n>=0;n--)t+=(e[n].charCodeAt(parseInt(r[n],10))-64)*Math.pow(26,n);return t},e.prototype.getCellRefPrediction=function(e,t,r,n){e=e.toUpperCase();var i=new RegExp("[a-z$]","gi"),o=new RegExp("[0-9$]","g"),a=t.isVFill?e.replace(o,""):e.replace(i,""),s=t.isVFill?Number(e.replace(i,"")):this.generateColCount(e.replace(o,"")),l=[s],d="$"===e[0];return r&&1!==r?l.push(s+r):l.push(s+1),s=this.getPredictionValue(l),n&&"mixed"===n&&(d===t.isVFill?a="$"+a:s.b=0),s.c=a,s},e.prototype.isInPattern=function(e,t){var r,n,i,o,a,s,l,d,p=0,h=1,c=e.length,u=new RegExp("[0-9$]","g"),g=new RegExp("[a-z$]","gi");if(1===c)return!1;for(;h<c;){if(r=e[p],i=e[h],n=r.length,o=i.length,n!==o)return!1;for(;n--;)if(a=r[n],s=i[n],this.isCellReference(a)===this.isCellReference(s)){if(t?(l=Number(a.replace(g,"")),d=Number(s.replace(g,""))):(l=this.generateColCount(a.replace(u,"")),d=this.generateColCount(s.replace(u,""))),l!==d-1)return!1}else if(a!==s)return!1;p++,h++}return!0},e.prototype.parseFormula=function(e){for(var t,r,n=0,i=[],o=(e=(e=this.markSpecialChar(e.replace("=",""))).split(/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g)).length;n<o;)(t=e[n])?(1===t.length?i.push(this.isUniqueChar(t)?this.getUniqueCharVal(t):t):(r=t[0],t.indexOf("!")>0?(this.isUniqueChar(r)&&(i.push(this.getUniqueCharVal(r)),t=t.substr(1)),r=t.indexOf("!")+1,i.push(t.substr(0,r)),i.push(t.substr(r))):this.isUniqueChar(r)?(i.push(this.getUniqueCharVal(r)),i.push(t.substr(1))):i.push(t)),n++):n++;return i},e.prototype.getUniqueCharVal=function(e){switch(e){case this.uniqueSOperator:return"-";case this.uniqueOBracket:return"(";case this.uniqueCOperator:return":";case this.uniqueCBracket:return")";case this.uniqueCSeparator:return",";case this.uniqueGTOperator:return">";case this.uniqueLTOperator:return"<";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueModOperator:return"%";case this.uniquePOperator:return"+"}return""},e.prototype.isUniqueChar=function(e){var t=e.charCodeAt(parseInt(e,10));return t>=129&&t<=142},e.prototype.markSpecialChar=function(e){return e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket),e=e.replace(/,/g,","+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator),e=e.replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator),e=e.replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator),e=e.replace(/&/g,"&"+this.uniqueConcateOperator),e=e.replace(/=/g,"="+this.uniqueEqualOperator),e=e.replace(/\^/g,"^"+this.uniqueExpOperator),(e=e.replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)},e.prototype.ensurePattern=function(e){for(var t,r=-1,n=e.length;n--;)"object"==typeof(t=e[n])?(r=n,"string"===t.type&&(t.val=t.val.reverse())):e[n]=r;return e},e.prototype.getSelectedRange=function(e,t,r){var n,i,o,a=[],s=getSwapRange([t.rowIndex,t.colIndex,r.rowIndex,r.colIndex]);n=s[0];for(var l=s[2];n<=l;)if((getRow(e,n)||{}).isFiltered)n++;else{for(i=s[1],o=s[3];i<=o;)a.push({rowIndex:n,colIndex:i}),i++;n++}return a},e.prototype.getFillType=function(e){return e.fillType=this.fillInfo.fillType,e.disableItems=this.fillInfo.disableItems,e},e.prototype.addEventListener=function(){this.parent.on(setAutoFill,this.autoFill,this),this.parent.on(getFillInfo,this.getFillType,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(setAutoFill,this.autoFill),this.parent.off(getFillInfo,this.getFillType))},e.prototype.getModuleName=function(){return"workbookautofill"},e}(),WorkbookBasicModule=function(){function e(){Workbook.Inject(DataBind,WorkbookSave,WorkbookOpen,WorkbookNumberFormat,WorkbookCellFormat,WorkbookEdit,WorkbookFormula,WorkbookSort,WorkbookHyperlink,WorkbookFilter,WorkbookInsert,WorkbookDelete,WorkbookFindAndReplace,WorkbookProtectSheet,WorkbookDataValidation,WorkbookMerge,WorkbookConditionalFormat,WorkbookImage,WorkbookChart,WorkbookAutoFill)}return e.prototype.getModuleName=function(){return"workbookBasic"},e.prototype.destroy=function(){},e}(),WorkbookAllModule=function(){function e(){Workbook.Inject(DataBind,WorkbookSave,WorkbookNumberFormat,WorkbookCellFormat,WorkbookEdit,WorkbookFormula,WorkbookOpen,WorkbookSort,WorkbookHyperlink,WorkbookFilter,WorkbookInsert,WorkbookDelete,WorkbookFindAndReplace,WorkbookProtectSheet,WorkbookDataValidation,WorkbookMerge,WorkbookConditionalFormat,WorkbookImage,WorkbookChart,WorkbookAutoFill)}return e.prototype.getModuleName=function(){return"workbook-all"},e.prototype.destroy=function(){},e}(),__extends$4=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__decorate$3=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},CellStyle=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property("Calibri")],t.prototype,"fontFamily",void 0),__decorate$3([ej2Base.Property("bottom")],t.prototype,"verticalAlign",void 0),__decorate$3([ej2Base.Property("left")],t.prototype,"textAlign",void 0),__decorate$3([ej2Base.Property("0pt")],t.prototype,"textIndent",void 0),__decorate$3([ej2Base.Property("#000000")],t.prototype,"color",void 0),__decorate$3([ej2Base.Property("#ffffff")],t.prototype,"backgroundColor",void 0),__decorate$3([ej2Base.Property("normal")],t.prototype,"fontWeight",void 0),__decorate$3([ej2Base.Property("normal")],t.prototype,"fontStyle",void 0),__decorate$3([ej2Base.Property("11pt")],t.prototype,"fontSize",void 0),__decorate$3([ej2Base.Property("none")],t.prototype,"textDecoration",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"border",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"borderTop",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"borderBottom",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"borderLeft",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"borderRight",void 0),t}(ej2Base.ChildProperty),FilterCollection=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property()],t.prototype,"sheetIndex",void 0),__decorate$3([ej2Base.Property()],t.prototype,"filterRange",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"hasFilter",void 0),__decorate$3([ej2Base.Property()],t.prototype,"column",void 0),__decorate$3([ej2Base.Property()],t.prototype,"criteria",void 0),__decorate$3([ej2Base.Property()],t.prototype,"value",void 0),__decorate$3([ej2Base.Property()],t.prototype,"dataType",void 0),__decorate$3([ej2Base.Property()],t.prototype,"predicates",void 0),t}(ej2Base.ChildProperty),SortCollection=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property()],t.prototype,"sortRange",void 0),__decorate$3([ej2Base.Property()],t.prototype,"columnIndex",void 0),__decorate$3([ej2Base.Property()],t.prototype,"order",void 0),__decorate$3([ej2Base.Property()],t.prototype,"sheetIndex",void 0),t}(ej2Base.ChildProperty),DefineName=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property("")],t.prototype,"name",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"scope",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"comment",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"refersTo",void 0),t}(ej2Base.ChildProperty),ProtectSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property(!1)],t.prototype,"selectCells",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"formatCells",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"formatRows",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"formatColumns",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"insertLink",void 0),t}(ej2Base.ChildProperty),Hyperlink=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property("")],t.prototype,"address",void 0),t}(ej2Base.ChildProperty),Validation=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property("WholeNumber")],t.prototype,"type",void 0),__decorate$3([ej2Base.Property("Between")],t.prototype,"operator",void 0),__decorate$3([ej2Base.Property("0")],t.prototype,"value1",void 0),__decorate$3([ej2Base.Property("0")],t.prototype,"value2",void 0),__decorate$3([ej2Base.Property(!0)],t.prototype,"ignoreBlank",void 0),__decorate$3([ej2Base.Property(!0)],t.prototype,"inCellDropDown",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"isHighlighted",void 0),t}(ej2Base.ChildProperty),Format=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property("General")],t.prototype,"format",void 0),__decorate$3([ej2Base.Complex({},CellStyle)],t.prototype,"style",void 0),__decorate$3([ej2Base.Property(!0)],t.prototype,"isLocked",void 0),t}(ej2Base.ChildProperty),ConditionalFormat=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property("GreaterThan")],t.prototype,"type",void 0),__decorate$3([ej2Base.Complex({},Format)],t.prototype,"format",void 0),__decorate$3([ej2Base.Property("RedFT")],t.prototype,"cFColor",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"value",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"range",void 0),t}(ej2Base.ChildProperty),LegendSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property(!0)],t.prototype,"visible",void 0),__decorate$3([ej2Base.Property("Auto")],t.prototype,"position",void 0),t}(ej2Base.ChildProperty),DataLabelSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property(!1)],t.prototype,"visible",void 0),__decorate$3([ej2Base.Property("Auto")],t.prototype,"position",void 0),t}(ej2Base.ChildProperty),MajorGridLines=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property(0)],t.prototype,"width",void 0),t}(ej2Base.ChildProperty),MinorGridLines=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property(0)],t.prototype,"width",void 0),t}(ej2Base.ChildProperty),Axis=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property("")],t.prototype,"title",void 0),__decorate$3([ej2Base.Complex({},MajorGridLines)],t.prototype,"majorGridLines",void 0),__decorate$3([ej2Base.Complex({},MinorGridLines)],t.prototype,"minorGridLines",void 0),__decorate$3([ej2Base.Property(!0)],t.prototype,"visible",void 0),t}(ej2Base.ChildProperty),Chart$1=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property("Line")],t.prototype,"type",void 0),__decorate$3([ej2Base.Property("Material")],t.prototype,"theme",void 0),__decorate$3([ej2Base.Property(!1)],t.prototype,"isSeriesInRows",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"range",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"id",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"title",void 0),__decorate$3([ej2Base.Property(290)],t.prototype,"height",void 0),__decorate$3([ej2Base.Property(480)],t.prototype,"width",void 0),__decorate$3([ej2Base.Property(0)],t.prototype,"top",void 0),__decorate$3([ej2Base.Property(0)],t.prototype,"left",void 0),__decorate$3([ej2Base.Complex({},LegendSettings)],t.prototype,"legendSettings",void 0),__decorate$3([ej2Base.Complex({},Axis)],t.prototype,"primaryXAxis",void 0),__decorate$3([ej2Base.Complex({},Axis)],t.prototype,"primaryYAxis",void 0),__decorate$3([ej2Base.Complex({},DataLabelSettings)],t.prototype,"dataLabelSettings",void 0),t}(ej2Base.ChildProperty),Image=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property("")],t.prototype,"src",void 0),__decorate$3([ej2Base.Property("")],t.prototype,"id",void 0),__decorate$3([ej2Base.Property(300)],t.prototype,"height",void 0),__decorate$3([ej2Base.Property(400)],t.prototype,"width",void 0),__decorate$3([ej2Base.Property(0)],t.prototype,"top",void 0),__decorate$3([ej2Base.Property(0)],t.prototype,"left",void 0),t}(ej2Base.ChildProperty),AutoFillSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),__decorate$3([ej2Base.Property("FillSeries")],t.prototype,"fillType",void 0),__decorate$3([ej2Base.Property(!0)],t.prototype,"showFillOptions",void 0),t}(ej2Base.ChildProperty),workbookLocale="spreadsheetLocale",localeData={SortOutOfRangeError:"Select a cell or range inside the used range and try again."},__extends$1=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__decorate$1=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},Range=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),t.prototype.setProperties=function(t,r){var n=this,i="parentObj",o="currRangeIdx",a="controlParent";if(this[i].isComplexArraySetter&&this[a]&&this[a].isAngular)if(Object.keys(t).length){void 0===this[i][o]?this[i][o]=0:this[i][o]+=1;var s=this[i].ranges[this[i][o]];s&&s.info&&(this.info=s.info),setTimeout(function(){void 0!==n[i][o]&&delete n[i][o]})}else if(this[a].tagObjects[0].instance&&this[a].tagObjects[0].instance.hasChanges&&!this[a].tagObjects[0].instance.isInitChanges){var l=this[a].sheets.indexOf(this[i]);if(void 0===this[i].changedRangeIdx){for(var d,p=this[a].tagObjects[0].instance.list[l].tagObjects,h=0;h<p.length;h++)if("ranges"===p[h].name){p[h].instance.list.forEach(function(e,t){e.hasChanges&&(d=t)});break}this[i].changedRangeIdx=d}}e.prototype.setProperties.call(this,t,r)},__decorate$1([ej2Base.Property(null)],t.prototype,"dataSource",void 0),__decorate$1([ej2Base.Property("A1")],t.prototype,"startCell",void 0),__decorate$1([ej2Base.Property(null)],t.prototype,"query",void 0),__decorate$1([ej2Base.Property(!0)],t.prototype,"showFieldAsHeader",void 0),__decorate$1([ej2Base.Property("")],t.prototype,"template",void 0),__decorate$1([ej2Base.Property("A1")],t.prototype,"address",void 0),t}(ej2Base.ChildProperty),UsedRange=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),__decorate$1([ej2Base.Property(0)],t.prototype,"rowIndex",void 0),__decorate$1([ej2Base.Property(0)],t.prototype,"colIndex",void 0),t}(ej2Base.ChildProperty),Sheet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$1(t,e),__decorate$1([ej2Base.Property(null)],t.prototype,"rows",void 0),__decorate$1([ej2Base.Property(null)],t.prototype,"columns",void 0),__decorate$1([ej2Base.Complex({},ProtectSettings)],t.prototype,"protectSettings",void 0),__decorate$1([ej2Base.Collection([],Range)],t.prototype,"ranges",void 0),__decorate$1([ej2Base.Collection([],ConditionalFormat)],t.prototype,"conditionalFormats",void 0),__decorate$1([ej2Base.Property(0)],t.prototype,"index",void 0),__decorate$1([ej2Base.Property("")],t.prototype,"name",void 0),__decorate$1([ej2Base.Property(100)],t.prototype,"rowCount",void 0),__decorate$1([ej2Base.Property(100)],t.prototype,"colCount",void 0),__decorate$1([ej2Base.Property("A1:A1")],t.prototype,"selectedRange",void 0),__decorate$1([ej2Base.Property("A1")],t.prototype,"activeCell",void 0),__decorate$1([ej2Base.Property({})],t.prototype,"usedRange",void 0),__decorate$1([ej2Base.Property("A1")],t.prototype,"topLeftCell",void 0),__decorate$1([ej2Base.Property(!0)],t.prototype,"showHeaders",void 0),__decorate$1([ej2Base.Property(!0)],t.prototype,"showGridLines",void 0),__decorate$1([ej2Base.Property(!1)],t.prototype,"isProtected",void 0),__decorate$1([ej2Base.Property("Visible")],t.prototype,"state",void 0),__decorate$1([ej2Base.Property(0)],t.prototype,"frozenRows",void 0),__decorate$1([ej2Base.Property(0)],t.prototype,"frozenColumns",void 0),__decorate$1([ej2Base.Property("A1")],t.prototype,"paneTopLeftCell",void 0),__decorate$1([ej2Base.Property("")],t.prototype,"password",void 0),t}(ej2Base.ChildProperty),__extends$5=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__decorate$4=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},Cell=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$5(t,e),__decorate$4([ej2Base.Collection([],Image)],t.prototype,"image",void 0),__decorate$4([ej2Base.Collection([],Chart$1)],t.prototype,"chart",void 0),__decorate$4([ej2Base.Property("")],t.prototype,"value",void 0),__decorate$4([ej2Base.Property("")],t.prototype,"formula",void 0),__decorate$4([ej2Base.Property(0)],t.prototype,"index",void 0),__decorate$4([ej2Base.Property("General")],t.prototype,"format",void 0),__decorate$4([ej2Base.Complex({},CellStyle)],t.prototype,"style",void 0),__decorate$4([ej2Base.Property("")],t.prototype,"hyperlink",void 0),__decorate$4([ej2Base.Property(!1)],t.prototype,"wrap",void 0),__decorate$4([ej2Base.Property(!0)],t.prototype,"isLocked",void 0),__decorate$4([ej2Base.Property("")],t.prototype,"validation",void 0),__decorate$4([ej2Base.Property(1)],t.prototype,"colSpan",void 0),__decorate$4([ej2Base.Property(1)],t.prototype,"rowSpan",void 0),t}(ej2Base.ChildProperty),ServiceLocator=function(){function e(){this.services={}}return e.prototype.getService=function(e){if(ej2Base.isNullOrUndefined(this.services[e]))throw"The service "+e+" is not registered";return this.services[e]},e.prototype.register=function(e,t){ej2Base.isNullOrUndefined(this.services[e])&&(this.services[e]=t)},e}(),__extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},__decorate=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},Workbook=function(e){function t(t){var n=e.call(this,t)||this;return n.isEdit=!1,n.sheetNameCount=1,n.isOpen=!1,n.chartColl=[],n.chartCount=1,r.Inject(DataBind,WorkbookSave,WorkbookOpen,WorkbookNumberFormat,WorkbookCellFormat,WorkbookEdit,WorkbookFormula,WorkbookSort,WorkbookHyperlink,WorkbookFilter,WorkbookInsert,WorkbookFindAndReplace,WorkbookDataValidation,WorkbookProtectSheet,WorkbookMerge,WorkbookConditionalFormat,WorkbookImage,WorkbookChart,WorkbookAutoFill),n.commonCellStyle={},t&&t.cellStyle&&(n.commonCellStyle=t.cellStyle),"workbook"===n.getModuleName()&&(n.serviceLocator=new ServiceLocator,n.initWorkbookServices(),n.dataBind(),n.initEmptySheet()),n}__extends(t,e),r=t,t.prototype.preRender=function(){Object.keys(this.commonCellStyle).length||(this.commonCellStyle=skipDefaultValue(this.cellStyle,!0)),"spreadsheet"!==this.getModuleName()||this.refreshing||this.initEmptySheet()},t.prototype.initWorkbookServices=function(){this.serviceLocator.register(workbookLocale,new ej2Base.L10n(this.getModuleName(),localeData,this.locale))},t.prototype.render=function(){},t.prototype.requiredModules=function(){return getWorkbookRequiredModules(this)},t.prototype.getPersistData=function(){return this.addOnPersist([])},t.prototype.cellFormat=function(e,t){var r=this.getActiveSheet();t=t||r.selectedRange,this.notify(setCellFormat,{style:e,range:t,refreshRibbon:t.indexOf(r.activeCell)>-1})},t.prototype.lockCells=function(e,t){var r=this.getActiveSheet();e=e||r.selectedRange,this.notify(setLockCells,{range:e,isLocked:t})},t.prototype.getCellStyleValue=function(e,t){var r=this,n=getCell(t[0],t[1],this.getActiveSheet()),i={};return e.forEach(function(e){i[e]=r.cellStyle[e],n&&n.style&&n.style[e]&&(i[e]=n.style[e])}),i},t.prototype.numberFormat=function(e,t){this.notify(applyNumberFormatting,{format:e,range:t})},t.prototype.createSheet=function(e,t){void 0===e&&(e=this.sheets.length),void 0===t&&(t=[{}]);var r;(r=this.sheets).splice.apply(r,[e,0].concat(t)),initSheet(this,t),this.notify(sheetCreated,{sheetIndex:e||0,sheets:t}),this.notify(workbookFormulaOperation,{action:"registerSheet",sheetIndex:e||0,sheetCount:e+t.length})},t.prototype.removeSheet=function(e){this.sheets.splice(e,1)},t.prototype.destroy=function(){this.notify(workbookDestroyed,null),e.prototype.destroy.call(this)},t.prototype.onPropertyChanged=function(e,t){for(var r=0,n=Object.keys(e);r<n.length;r++){switch(n[r]){case"cellStyle":ej2Base.merge(this.commonCellStyle,e.cellStyle);break;case"sheets":e.sheets===this.sheets?(this.notify(workbookFormulaOperation,{action:"unRegisterSheet",propertyChange:!0}),this.sheetNameCount=1,this.notify(sheetsDestroyed,{}),initSheet(this),this.notify(sheetCreated,null),this.notify(workbookFormulaOperation,{action:"registerSheet"})):initSheet(this)}}},t.prototype.appendTo=function(t){e.prototype.appendTo.call(this,t)},t.prototype.hideRow=function(e,t,r){void 0===t&&(t=e),void 0===r&&(r=!0);var n=this.getActiveSheet();if(!r||!n.frozenRows&&!n.frozenColumns)for(var i=e;i<=t;i++)setRow(n,i,{hidden:r})},t.prototype.hideColumn=function(e,t,r){void 0===t&&(t=e),void 0===r&&(r=!0);var n=this.getActiveSheet();if(!n.frozenRows&&!n.frozenColumns)for(var i=e;i<=t;i++)setColumn(n,i,{hidden:r})},t.prototype.setBorder=function(e,t,r){this.notify(setCellFormat,{style:e,borderType:r,range:t||this.getActiveSheet().selectedRange})},t.prototype.insertRow=function(e,t,r){this.notify(insertModel,{model:this.getSheetModel(r),start:e,end:t,modelType:"Row",insertType:"below"})},t.prototype.insertColumn=function(e,t,r){this.notify(insertModel,{model:this.getSheetModel(r),start:e,end:t,modelType:"Column",insertType:"after"})},t.prototype.insertSheet=function(e,t){this.notify(insertModel,{model:this,start:e,end:t,modelType:"Sheet"})},t.prototype.delete=function(e,t,r,n){e=e||0;var i;if(r&&"Sheet"!==r){if(!(i=this.getSheetModel(n)))return}else i=this;this.notify(deleteModel,{model:i,start:e,end:ej2Base.isNullOrUndefined(t)?e:t,modelType:r||"Sheet"})},t.prototype.moveSheet=function(e,t){moveSheet(this,e,t)},t.prototype.duplicateSheet=function(e){duplicateSheet(this,e)},t.prototype.getSheetModel=function(e){if(ej2Base.isNullOrUndefined(e))return this.getActiveSheet();var t="string"==typeof e?getSheetIndex(this,e):e;return ej2Base.isNullOrUndefined(t)||t>=this.sheets.length?null:this.sheets[t]},t.prototype.merge=function(e,t){var r,n;e?n=getSheet(this,r=this.getAddressInfo(e).sheetIndex):e=(n=this.getActiveSheet()).selectedRange,this.notify(setMerge,{merge:!0,range:e,type:t||"All",sheet:n,refreshRibbon:e.indexOf(n.activeCell)>-1,preventRefresh:this.activeSheetIndex!==r})},t.prototype.computeExpression=function(e){var t={action:"computeExpression",formula:e};return this.notify(workbookFormulaOperation,t),t.calcValue},t.prototype.initEmptySheet=function(){this.sheets.length?initSheet(this):this.createSheet()},t.prototype.getActiveSheet=function(){return this.sheets[this.activeSheetIndex]},t.prototype.skipHiddenSheets=function(e,t,r){return void 0===r&&(r=0),this.sheets[e]&&"Visible"!==this.sheets[e].state&&(void 0===t&&(t=e),e=e&&e+1===this.sheets.length?t-1:e<t?--e:++e,e=this.skipHiddenSheets(e,t,++r)),r===this.sheets.length?(this.setSheetPropertyOnMute(this.sheets[0],"state","Visible"),0):e},t.prototype.setUsedRange=function(e,t,r,n){void 0===r&&(r=this.getActiveSheet()),e>r.usedRange.rowIndex&&(r.usedRange.rowIndex=e,r!==this.getActiveSheet()||n||this.notify(updateRowColCount,{index:e,update:"row"})),t>r.usedRange.colIndex&&(r.usedRange.colIndex=t,r!==this.getActiveSheet()||n||this.notify(updateRowColCount,{index:t,update:"col"}))},t.prototype.getData=function(e){return getData(this,e)},t.prototype.getModuleName=function(){return"workbook"},t.prototype.goTo=function(e){},t.prototype.getValueRowCol=function(e,t,r,n,i){var o={action:"getSheetInfo",sheetInfo:[]};if(this.notify(workbookFormulaOperation,o),-1===getSheetIndexByName(0,"Sheet"+e,o.sheetInfo)){var a={action:"getReferenceError",refError:""};return this.notify(workbookFormulaOperation,a),a.refError}var s=getSheetIndexFromId(this,e),l=getSheet(this,s),d=getCell(t-1,r-1,l);if(n&&n.includes("!")&&!d&&l.ranges&&l.ranges.length){var p;if(this.formulaRefCell&&this.formulaRefCell===n)return d&&d.value;if(l.ranges.forEach(function(e){e.info&&e.info.loadedRange&&e.info.loadedRange.length||(p=!0)}),p){if(this.formulaRefCell=n,s=getSheetIndexFromId(this,Number(n.substring(n.lastIndexOf(",")+1,n.length))),ej2Base.isNullOrUndefined(s))return d&&d.value;n=n.substring(n.lastIndexOf("!")+1,n.lastIndexOf(",")),getData(this,l.name+"!A1:"+getCellAddress(t-1,r-1),null,null,null,null,n,s)}}else d&&d.formula&&(i||ej2Base.isNullOrUndefined(d.value))&&-1===d.formula.indexOf("UNIQUE")&&this.notify("calculateFormula",{cell:d,rowIdx:t-1,colIdx:r-1,sheetIndex:s});return d&&d.value},t.prototype.setValueRowCol=function(e,t,r,n,i){this.notify(workbookEditOperation,{action:"updateCellValue",address:[r-1,n-1],value:t,sheetIndex:getSheetIndexFromId(this,e),isValueOnly:!0,formula:i})},t.prototype.open=function(e){this.notify(workbookOpen,e)},t.prototype.openFromJson=function(e){this.isOpen=!0;var t="object"==typeof e.file?JSON.stringify(e.file):e.file;this.notify(workbookOpen,{jsonObject:t})},t.prototype.save=function(e){if(void 0===e&&(e={}),this.allowSave){var t={url:this.saveUrl,fileName:e.fileName||"Sample",saveType:"Xlsx"},r=__assign({},t,e,{customParams:{},isFullPost:!0,needBlobData:!1,cancel:!1,pdfLayoutSettings:{fitSheetOnOnePage:!1}});this.trigger("beforeSave",r),this.notify(beginAction,{eventArgs:r,action:"beforeSave"}),r.cancel||this.notify(beginSave,{saveSettings:r,isFullPost:r.isFullPost,needBlobData:r.needBlobData,customParams:r.customParams,pdfLayoutSettings:r.pdfLayoutSettings})}},t.prototype.saveAsJson=function(){var e=this;return new Promise(function(t){e.on(onSave,function(r){r.cancel=!0,e.off(onSave),t({jsonObject:{Workbook:r.jsonObject}}),e.notify(saveCompleted,r)}),e.save()})},t.prototype.addHyperlink=function(e,t){var r={hyperlink:e,cell:t};this.notify(setLinkModel,r)},t.prototype.findHandler=function(e){"next"===e.findOpt?this.notify(findNext,e):"prev"===e.findOpt&&this.notify(findPrevious,e)},t.prototype.replaceHandler=function(e){"replace"===e.replaceBy?this.notify(replaceHandler,e):this.notify(replaceAllHandler,e)},t.prototype.protectSheet=function(e,t,r){this.notify(protectsheetHandler,{protectSettings:t,password:r})},t.prototype.unprotectSheet=function(e){var t={sheet:e};this.notify(unprotectsheetHandler,t)},t.prototype.sort=function(e,t){if(!this.allowSorting)return Promise.reject();var r={args:{range:t||this.getActiveSheet().selectedRange,sortOptions:e||{sortDescriptors:{}},cancel:!1},promise:new Promise(function(e,t){e(void 0)})};return this.notify(initiateSort,r),r.promise},t.prototype.addDataValidation=function(e,t){"List"===e.type&&e.value1.length>256&&(e.value1=e.value1.substring(0,255)),this.notify(cellValidation,{rules:e,range:t||this.getActiveSheet().selectedRange})},t.prototype.removeDataValidation=function(e){this.notify(cellValidation,{range:e,isRemoveValidation:!0})},t.prototype.addInvalidHighlight=function(e){this.notify(addHighlight,{range:e})},t.prototype.removeInvalidHighlight=function(e){this.notify(removeHighlight,{range:e})},t.prototype.conditionalFormat=function(e){e.range=e.range||this.getActiveSheet().selectedRange,this.notify(setCFRule,{conditionalFormat:e})},t.prototype.clearConditionalFormat=function(e){e=e||this.getActiveSheet().selectedRange,this.notify(clearCFRule,{range:e})},t.prototype.updateCell=function(e,t){var r,n=getIndexesFromAddress(t);t.includes("!")?void 0===(r=getSheetIndex(this,t.split("!")[0]))&&(r=this.activeSheetIndex):r=this.activeSheetIndex,updateCell(this,this.sheets[r],{cell:e,rowIdx:n[0],colIdx:n[1],uiRefresh:r===this.activeSheetIndex,valChange:void 0!==e.value||void 0!==e.formula,preventEvt:!0}),this.notify(activeCellChanged,null)},t.prototype.getRowData=function(e,t){ej2Base.isNullOrUndefined(e)&&(e=0),ej2Base.isNullOrUndefined(t)&&(t=this.activeSheetIndex);var r={sheetIdx:t,startIndex:e,modelType:"Row",isDataRequest:!0};return this.notify(dataChanged,r),r.data},t.prototype.updateRange=function(e,t){var r=getSheet(this,t=t?t-1:this.activeSheetIndex),n=r.ranges;ej2Base.isNullOrUndefined(r)||(n.push(e),r.ranges=n)},t.prototype.wrap=function(e,t){void 0===t&&(t=!0),wrap(e,t,this)},t.prototype.addDefinedName=function(e){var t={action:"addDefinedName",isAdded:!1,definedName:e};return this.notify(workbookFormulaOperation,t),t.isAdded},t.prototype.removeDefinedName=function(e,t){void 0===t&&(t="");var r={action:"removeDefinedName",isRemoved:!1,definedName:e,scope:t};return this.notify(workbookFormulaOperation,r),r.isRemoved},t.prototype.clearRange=function(e,t,r){},t.prototype.insertImage=function(e,t){this.notify(setImage,{options:e,range:t||this.getActiveSheet().selectedRange})},t.prototype.autoFill=function(e,t,r,n){var i={dataRange:t||this.getActiveSheet().selectedRange,fillRange:e,direction:r||"Down",fillType:n||"FillSeries"};this.notify(setAutoFill,i)},t.prototype.insertChart=function(e){this.notify(setChart,{chart:e})},t.prototype.deleteChart=function(e){this.notify(deleteChart,{id:e})},t.prototype.filter=function(e,t){if(!this.allowFiltering)return Promise.reject();var r={args:{range:t||this.getActiveSheet().selectedRange,filterOptions:e,cancel:!1},promise:new Promise(function(e,t){e(void 0)})};return this.notify(initiateFilter,r),r.promise},t.prototype.addCustomFunction=function(e,t){var r={action:"addCustomFunction",functionHandler:e,functionName:t=t||("string"==typeof e?e:e.name.replace("bound ",""))};this.notify(workbookFormulaOperation,r)},t.prototype.clear=function(e){this.notify(clear,e)},t.prototype.getDisplayText=function(e){if(!e)return"";if(e.format&&!ej2Base.isNullOrUndefined(e.value)){var t={formattedText:e.value,value:e.value,format:e.format,onLoad:!0,cell:e};return this.notify(getFormattedCellObject,t),t.formattedText}return!e.value&&e.hyperlink?"string"==typeof e.hyperlink?e.hyperlink:e.hyperlink.address:e.value||"number"==typeof e.value?e.value.toString():""},t.prototype.freezePanes=function(e,t,r){void 0===e&&(e=1),void 0===t&&(t=1);var n=this.getSheetModel(r);n.frozenRows===e&&n.frozenColumns===t||(this.setSheetPropertyOnMute(n,"frozenRows",e),this.setSheetPropertyOnMute(n,"frozenColumns",t),this.updateTopLeftCell(),n.name===this.getActiveSheet().name&&this.notify(dataRefresh,null))},t.prototype.Unfreeze=function(e){this.freezePanes(0,0,e)},t.prototype.updateTopLeftCell=function(e,t,r,n){n||(n=this.getActiveSheet());var i=getCellIndexes(n.topLeftCell);n.frozenRows||n.frozenColumns?(ej2Base.isNullOrUndefined(e)&&(e=n.frozenRows?0:i[0]),ej2Base.isNullOrUndefined(t)&&(t=n.frozenColumns?0:i[1]),e+=this.frozenRowCount(n),t+=this.frozenColCount(n),r&&("row"===r?e=getCellIndexes(n.paneTopLeftCell)[0]:t=getCellIndexes(n.paneTopLeftCell)[1]),this.setSheetPropertyOnMute(n,"paneTopLeftCell",getCellAddress(e,t)),n.frozenRows&&(e=i[0]),n.frozenColumns&&(t=i[1])):(ej2Base.isNullOrUndefined(e)&&(e=i[0]),ej2Base.isNullOrUndefined(t)&&(t=i[1]),this.setSheetPropertyOnMute(n,"paneTopLeftCell",getCellAddress(e,t))),this.setSheetPropertyOnMute(n,"topLeftCell",getCellAddress(e,t))},t.prototype.getAddressInfo=function(e){return getAddressInfo(this,e)},t.prototype.setSheetPropertyOnMute=function(e,t,r){this.isProtectedOnChange=!0,e[t]=r,this.isProtectedOnChange=!1},t.prototype.frozenRowCount=function(e){return e.frozenRows?"A1"===e.topLeftCell?e.frozenRows:getCellIndexes(e.topLeftCell)[0]+e.frozenRows:0},t.prototype.frozenColCount=function(e){return e.frozenColumns?"A1"===e.topLeftCell?e.frozenColumns:getCellIndexes(e.topLeftCell)[1]+e.frozenColumns:0},t.prototype.updateRangeOnInsertDelete=function(e,t){var r,n=!1;return e.isInsert?(r=e.endIndex-e.startIndex+1,"Row"===e.modelType?(e.startIndex<=t[0]&&(t[0]+=r,n=!0),e.startIndex<=t[2]&&(t[2]+=r,n=!0)):(e.startIndex<=t[1]&&(t[1]+=r,n=!0),e.startIndex<=t[3]&&(t[3]+=r,n=!0))):"Row"===e.modelType?((r=t[0]-e.startIndex)>0&&(t[0]>e.endIndex?(r=e.endIndex-e.startIndex+1)>0&&(t[0]-=r,n=!0):(t[0]-=r,n=!0)),e.startIndex<=t[2]&&(e.endIndex<=t[2]?t[2]-=e.endIndex-e.startIndex+1:t[2]-=t[2]-e.startIndex+1,n=!0)):((r=t[1]-e.startIndex)>0&&(t[1]>e.endIndex?(r=e.endIndex-e.startIndex+1)>0&&(t[1]-=r,n=!0):(t[1]-=r,n=!0)),e.startIndex<=t[3]&&(e.endIndex<=t[3]?t[3]-=e.endIndex-e.startIndex+1:t[3]-=t[3]-e.startIndex+1,n=!0)),n},t.prototype.dateToInt=function(e){return dateToInt(e)},t.prototype.setDateFormat=function(e,t,r){var n=getSheet(this,getSheetIndexFromId(this,e));getCell(t,r,n,null,!0).format||setCell(t,r,n,{format:getFormatFromType("ShortDate")},!0)};var r;return __decorate([ej2Base.Collection([],Sheet)],t.prototype,"sheets",void 0),__decorate([ej2Base.Property(0)],t.prototype,"activeSheetIndex",void 0),__decorate([ej2Base.Property("100%")],t.prototype,"height",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowFindAndReplace",void 0),__decorate([ej2Base.Property()],t.prototype,"filterCollection",void 0),__decorate([ej2Base.Property()],t.prototype,"sortCollection",void 0),__decorate([ej2Base.Property("100%")],t.prototype,"width",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"showRibbon",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"showFormulaBar",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"showSheetTabs",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowEditing",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowOpen",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowSave",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowSorting",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowFiltering",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowNumberFormatting",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowCellFormatting",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowHyperlink",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowInsert",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowDelete",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowMerge",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowDataValidation",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowImage",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowChart",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowAutoFill",void 0),__decorate([ej2Base.Complex({},AutoFillSettings)],t.prototype,"autoFillSettings",void 0),__decorate([ej2Base.Property(!0)],t.prototype,"allowConditionalFormat",void 0),__decorate([ej2Base.Complex({},CellStyle)],t.prototype,"cellStyle",void 0),__decorate([ej2Base.Property("")],t.prototype,"openUrl",void 0),__decorate([ej2Base.Property("")],t.prototype,"saveUrl",void 0),__decorate([ej2Base.Property("")],t.prototype,"password",void 0),__decorate([ej2Base.Property(!1)],t.prototype,"isProtected",void 0),__decorate([ej2Base.Collection([],DefineName)],t.prototype,"definedNames",void 0),__decorate([ej2Base.Event()],t.prototype,"beforeOpen",void 0),__decorate([ej2Base.Event()],t.prototype,"openFailure",void 0),__decorate([ej2Base.Event()],t.prototype,"beforeSave",void 0),__decorate([ej2Base.Event()],t.prototype,"saveComplete",void 0),__decorate([ej2Base.Event()],t.prototype,"beforeCellFormat",void 0),__decorate([ej2Base.Event()],t.prototype,"queryCellInfo",void 0),__decorate([ej2Base.Event()],t.prototype,"beforeCellUpdate",void 0),t=r=__decorate([ej2Base.NotifyPropertyChanges],t)}(ej2Base.Component),__extends$6=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__decorate$5=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},Row=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$6(t,e),__decorate$5([ej2Base.Collection([],Cell)],t.prototype,"cells",void 0),__decorate$5([ej2Base.Property(0)],t.prototype,"index",void 0),__decorate$5([ej2Base.Property(20)],t.prototype,"height",void 0),__decorate$5([ej2Base.Property(!1)],t.prototype,"customHeight",void 0),__decorate$5([ej2Base.Property(!1)],t.prototype,"hidden",void 0),__decorate$5([ej2Base.Complex({},Format)],t.prototype,"format",void 0),t}(ej2Base.ChildProperty),__extends$7=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__decorate$6=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},Column=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$7(t,e),__decorate$6([ej2Base.Property(0)],t.prototype,"index",void 0),__decorate$6([ej2Base.Property(64)],t.prototype,"width",void 0),__decorate$6([ej2Base.Property(!1)],t.prototype,"customWidth",void 0),__decorate$6([ej2Base.Property(!1)],t.prototype,"hidden",void 0),__decorate$6([ej2Base.Complex({},Format)],t.prototype,"format",void 0),__decorate$6([ej2Base.Property(!0)],t.prototype,"isLocked",void 0),__decorate$6([ej2Base.Property("")],t.prototype,"validation",void 0),t}(ej2Base.ChildProperty),scrollAreaWidth=null,textLineHeight=1.24,classes=["e-ribbon","e-formula-bar-panel","e-sheet-tab-panel","e-header-toolbar"],config={role:"role",selected:"aria-selected",multiselectable:"aria-multiselectable",busy:"aria-busy",colcount:"aria-colcount"},Clipboard=function(){function e(e){this.parent=e,this.init(),this.addEventListener()}return e.prototype.init=function(){this.parent.element.appendChild(this.parent.createElement("input",{className:"e-clipboard",attrs:{contenteditable:"true"}}))},e.prototype.addEventListener=function(){var e=this.getClipboardEle();this.parent.on(cut,this.cut,this),this.parent.on(copy,this.copy,this),this.parent.on(paste,this.paste,this),this.parent.on(clearCopy,this.clearCopiedInfo,this),this.parent.on(tabSwitch,this.tabSwitchHandler,this),this.parent.on(cMenuBeforeOpen,this.cMenuBeforeOpenHandler,this),this.parent.on(ribbonClick,this.ribbonClickHandler,this),this.parent.on(contentLoaded,this.initCopyIndicator,this),this.parent.on(rowHeightChanged,this.rowHeightChanged,this),this.parent.on(colWidthChanged,this.colWidthChanged,this),this.parent.on(refreshClipboard,this.refreshOnInsertDelete,this),ej2Base.EventHandler.add(e,"cut",this.cut,this),ej2Base.EventHandler.add(e,"copy",this.copy,this),ej2Base.EventHandler.add(e,"paste",this.paste,this)},e.prototype.removeEventListener=function(){var e=this.getClipboardEle();this.parent.isDestroyed||(this.parent.off(cut,this.cut),this.parent.off(copy,this.copy),this.parent.off(paste,this.paste),this.parent.off(clearCopy,this.clearCopiedInfo),this.parent.off(tabSwitch,this.tabSwitchHandler),this.parent.off(cMenuBeforeOpen,this.cMenuBeforeOpenHandler),this.parent.off(ribbonClick,this.ribbonClickHandler),this.parent.off(contentLoaded,this.initCopyIndicator),this.parent.off(rowHeightChanged,this.rowHeightChanged),this.parent.off(colWidthChanged,this.colWidthChanged),this.parent.off(refreshClipboard,this.refreshOnInsertDelete)),ej2Base.EventHandler.remove(e,"cut",this.cut),ej2Base.EventHandler.remove(e,"copy",this.copy),ej2Base.EventHandler.remove(e,"paste",this.paste)},e.prototype.ribbonClickHandler=function(e){var t=this.parent.element.id;switch(e.item.id){case t+"_cut":this.cut({invokeCopy:!0});break;case t+"_copy":this.copy({invokeCopy:!0})}focus(this.parent.element)},e.prototype.tabSwitchHandler=function(e){0!==e.activeTab||this.copiedInfo||this.copiedShapeInfo||this.hidePaste()},e.prototype.cMenuBeforeOpenHandler=function(e){var t=this.parent.getActiveSheet(),r=this.parent.serviceLocator.getService(locale),n=[],i=[],o=[],a=[],s=getCellIndexes(t.activeCell),l=getCell(s[0],s[1],t),d=t.isProtected&&isLocked(l,getColumn(t,s[1]));"Content"!==e.target&&"RowHeader"!==e.target&&"ColumnHeader"!==e.target&&"SelectAll"!==e.target||(this.parent.enableContextMenuItems([r.getConstant("Paste"),r.getConstant("PasteSpecial")],!!(this.copiedInfo||this.copiedShapeInfo&&!d)),this.parent.enableContextMenuItems([r.getConstant("Cut")],!d)),"Content"===e.target&&d&&this.parent.enableContextMenuItems([r.getConstant("Cut"),r.getConstant("Filter"),r.getConstant("Sort")],!1),"Content"===e.target&&d&&!t.protectSettings.insertLink&&this.parent.enableContextMenuItems([r.getConstant("Hyperlink")],!1),"ColumnHeader"===e.target&&t.isProtected&&(o=[r.getConstant("DeleteColumn"),r.getConstant("DeleteColumns"),r.getConstant("InsertColumn"),r.getConstant("InsertColumns")],a=[r.getConstant("HideColumn"),r.getConstant("HideColumns"),r.getConstant("UnHideColumns")],this.parent.enableContextMenuItems(o,!1),this.parent.enableContextMenuItems(a,!!t.protectSettings.formatColumns)),"RowHeader"===e.target&&t.isProtected&&(n=[r.getConstant("DeleteRow"),r.getConstant("DeleteRows"),r.getConstant("InsertRow"),r.getConstant("InsertRows")],i=[r.getConstant("HideRow"),r.getConstant("HideRows"),r.getConstant("UnHideRows")],this.parent.enableContextMenuItems(n,!1),this.parent.enableContextMenuItems(i,!!t.protectSettings.formatRows))},e.prototype.rowHeightChanged=function(e){if(this.copiedInfo){var t=this.getCopyIndicator();t&&(this.copiedInfo.range[0]>e.rowIdx?t.style.top=parseFloat(t.style.top)+e.threshold+"px":inRange(this.copiedInfo.range,e.rowIdx,this.copiedInfo.range[1])&&(t.style.height=parseFloat(t.style.height)+e.threshold+"px"))}},e.prototype.colWidthChanged=function(e){if(this.copiedInfo){var t=this.getCopyIndicator();t&&(this.copiedInfo.range[1]>e.colIdx?t.style.left=parseFloat(t.style.left)+e.threshold+"px":inRange(this.copiedInfo.range,this.copiedInfo.range[0],e.colIdx)&&(t.style.width=parseFloat(t.style.width)+e.threshold+"px"))}},e.prototype.cut=function(e){this.setCopiedInfo(e,!0)},e.prototype.copy=function(e){this.setCopiedInfo(e,!1)},e.prototype.paste=function(e){if(!(this.parent.isEdit||this.parent.element.getElementsByClassName("e-dlg-overlay").length>0)){var t,r=e&&e.clipboardData||window.clipboardData;if(e.isInternal=!r,!(r&&e.clipboardData&&e.clipboardData.getData("isInternalCut").length))if(r||this.copiedShapeInfo||e.isInternal&&this.copiedInfo){var n=void 0,i=this.getCopiedIdx(),o=Object.assign({isExternal:r},this.copiedInfo);e.isAction=!!r||e.isAction;var a=e&&e.sIdx>-1?e.sIdx:this.parent.activeSheetIndex,s=getSheet(this.parent,a),l=getSwapRange(e&&e.range||getRangeIndexes(s.selectedRange)),d=r&&this.getExternalCells(e);if(!e.isInternal&&d&&d.internal&&(r=!1,!this.copiedInfo))return;if(r&&!d.length)return void(d.file&&this.parent.notify(insertImage,{file:d.file}));var p=1;if(d)for(var h=0;h<d.length;h++)p=d[h].cells.length>p?d[h].cells.length:p;var c=l[0],u=r?[0,0,d.length-1,p-1]:getSwapRange(this.copiedShapeInfo?getRangeIndexes(s.selectedRange):this.copiedInfo.range),g=(l[2]-l[0]+1)%(u[2]-u[0]+1)==0&&(l[3]-l[1]+1)%(u[3]-u[1]+1)==0;t=g?l:[l[0],l[1]].concat([l[0]+u[2]-u[0],l[1]+u[3]-u[1]||l[1]]);var f={requestType:"paste",copiedInfo:this.copiedInfo,copiedRange:getRangeAddress(u),pastedRange:getRangeAddress(t),type:e&&e.type||"All",cancel:!1};if(e.isAction&&!this.copiedShapeInfo&&this.parent.notify(beginAction,{eventArgs:f,action:"clipboard"}),f.cancel)return;var m=void 0,v=void 0,C=void 0,y=[],x=getSheet(this.parent,r?a:i),b=isSingleCell(u)&&this.isRangeMerged(l,s);c=(l=getRangeIndexes(f.pastedRange))[0],u=r?[0,0,d.length-1,p-1]:getSwapRange(this.copiedShapeInfo?getRangeIndexes(s.selectedRange):this.copiedInfo.range),t=(g=(l[2]-l[0]+1)%(u[2]-u[0]+1)==0&&(l[3]-l[1]+1)%(u[3]-u[1]+1)==0&&!b)?l:[l[0],l[1]].concat([l[0]+u[2]-u[0],l[1]+u[3]-u[1]||l[1]]);if(s.isProtected&&isLockedCells(this.parent,t))return void this.parent.notify(editAlert,null);if(this.copiedShapeInfo&&!this.copiedInfo){var S=this.copiedShapeInfo.pictureElem;S.classList.contains("e-datavisualization-chart")?(this.copiedShapeInfo.chartInfo.top=null,this.copiedShapeInfo.chartInfo.left=null,this.parent.notify(setChart,{chart:[this.copiedShapeInfo.chartInfo],isInitCell:!0,isUndoRedo:!0,isPaste:!0,dataSheetIdx:this.copiedShapeInfo.sheetIdx,isCut:this.copiedShapeInfo.isCut,range:e.range||s.selectedRange,isIdAvailabe:!1})):this.parent.notify(createImageElement,{options:{src:S.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:this.copiedShapeInfo.height,width:this.copiedShapeInfo.width,imageId:this.copiedShapeInfo.isCut?S.id:""},range:getRangeAddress([c,l[1],c,l[1]]),isPublic:!1,isUndoRedo:!0});var w=getCell(c,l[1],s);if(w&&!ej2Base.isNullOrUndefined(w.image)){var I=w.image?w.image.length-1:0,R={requestType:"imagePaste",copiedShapeInfo:this.copiedShapeInfo,pasteSheetIndex:this.parent.activeSheetIndex,pastedRange:getSheetName(this.parent)+"!"+getRangeAddress([c,l[1],c,l[1]]),pastedPictureElement:document.getElementById(w.image[I].id)};this.parent.notify(completeAction,{eventArgs:R,action:"clipboard"})}}else{var E={range:u,prevSheet:x,cancel:!1};if(this.parent.notify(pasteMerge,E),E.cancel)return;var k=f.type||e.type,F=[],A=this.isInRange(u,l,i),B=0===l[1]&&l[3]===s.colCount-1,T=0===l[0]&&l[2]===s.rowCount-1,D=!1,N=!1,O=0;g||this.setCF(u,t,x,s);for(var L=void 0,H=(h=u[0],0);h<=u[2];h++,H++)if(r||o.isCut||!(getRow(x,h)||{}).isFiltered){A&&(F[l[0]+H]={cells:[]});for(var j=u[1],M=0;j<=u[3];j++,M++){if(A&&(F[l[0]+H].cells[l[1]+M]=getCell(l[0]+H,l[1]+M,x,!1,!0)),m=r?d[h].cells[j]:ej2Base.extend({},A&&F[h]&&F[h].cells[j]?F[h].cells[j]:getCell(h,j,x),null,!0),B||T){if(m&&m.rowSpan)if(m.rowSpan>0)m.rowSpan+h-1<=u[2]?D=!0:m={};else if(D){if(m.rowSpan<0){var _=m.rowSpan,P=m.colSpan?m.colSpan:0,U=getCell(c+_,l[1]+M+P,s);U&&!U.rowSpan&&(m={})}}else m={};m&&m.colSpan&&(m.colSpan>0?m.colSpan+j-1<=u[3]?N=!0:m={}:N||(m={}))}if(m&&e&&e.type||k){switch(k){case"Formats":m={format:m.format,style:m.style};break;case"Values":if((m={value:m.value}).value&&m.value.toString().indexOf("\n")>-1){this.parent.getCell(l[0],l[1]).classList.add("e-alt-unwrap")}}v=["Formats","Values"].indexOf(e.type||k)>-1}if(!this.parent.scrollSettings.isFinite&&(u[2]-u[0]>1048575-l[0]||u[3]-u[1]>16383-l[1])||this.parent.scrollSettings.isFinite&&(u[2]-u[0]>s.rowCount-1-l[0]||u[3]-u[1]>s.colCount-1-l[1]))return void this.showDialog();if(g){for(var V=l[0];V<=l[2];V+=u[2]-u[0]+1)if(o.isCut||O||!(getRow(s,V+H)||{}).isFiltered)for(var z=l[1];z<=l[3];z+=u[3]-u[1]+1){if(h!==u[0]||j!==u[1]||void 0!==L&&!L.length||(L=this.setCF(u,[V,z,V+(u[2]-u[0]),z+(u[3]-u[1])],x,s,L)),C=getCell(V+H,z+M,s,!1,!0),!r&&(void 0!==C.colSpan||void 0!==C.rowSpan)){if(B||T)continue;var q={range:(E={range:[V+H,z+M,V+H,z+M]}).range,merge:!1,isAction:!1,type:"All"};y.push(q),this.parent.activeSheetIndex===s.index&&this.parent.notify(setMerge,q)}var W=z+M;if(m=ej2Base.extend({},m||{},null,!0),!v&&this.copiedInfo&&!this.copiedInfo.isCut){var G=getUpdatedFormula([V+H,W],[h,j],x);ej2Base.isNullOrUndefined(G)||(m.formula=G)}if(s.isProtected&&m&&!1!==m.isLocked&&(m.isLocked=C.isLocked),!this.setCell(V+H,W,s,m,v,z===l[3],!!r,!(!L||!L.length))&&(m.formula&&this.copiedInfo.isCut&&this.parent.notify(clearFormulaDependentCells,{cellRef:getRangeAddress([h,j,h,j])}),m.formula&&m.formula.includes("UNIQUE"))){var $={cellIdx:t,isUnique:!1,uniqueRange:""};this.parent.notify(checkUniqueRange,$),t=getRangeIndexes($.uniqueRange);break}}}else!r&&hasTemplate(this.parent,h,j,i)||(b?this.setCell(c,l[1]+M,s,{value:m.value},!0,j===u[3]):this.setCell(c,l[1]+M,s,m,v,j===u[3]));if(!r&&this.copiedInfo.isCut&&(!inRange(l,h,j)||i!==this.parent.activeSheetIndex)){var Y=getCell(h,j,x);if(Y)if(Y.isLocked||ej2Base.isNullOrUndefined(Y.isLocked)){if((B||T)&&(void 0!==Y.rowSpan||void 0!==Y.colSpan))continue;Y=null}else!1===Y.isLocked&&(Y=x.isProtected?{isLocked:!1}:null);this.setCell(h,j,x,Y,!1,j===u[3])||setCell(h,j,x,Y)}}c++}else H--,O++;if(this.parent.notify(refreshRibbonIcons,null),t[2]-=O,this.parent.setUsedRange(t[2],t[3]),a===this.parent.activeSheetIndex&&this.parent.notify(selectRange,{address:getRangeAddress(t)}),!r&&this.copiedInfo.isCut&&(n=this.copiedInfo.isCut,i===this.parent.activeSheetIndex&&this.parent.serviceLocator.getService("cell").refreshRange(u),this.clearCopiedInfo()),(r||A)&&this.copiedInfo&&this.clearCopiedInfo(),(r||e&&e.isAction)&&focus(this.parent.element),n){L&&L.length&&"Values"!==k&&this.parent.notify(clearCFRule,{range:getRangeAddress(u),sheetIdx:r?a:i}),setMaxHgt(x,u[0],u[1],(this.parent.getRow(u[0])||{offsetHeight:20}).offsetHeight);var X=getMaxHgt(x,u[0]);setRowEleHeight(this.parent,x,X,u[0])}var K=getSheet(this.parent,i);if(!r&&u[0]===u[2]&&u[3]-u[1]==K.colCount-1){for(X=K.rows[u[0]].height,h=l[0];h<=l[2];h++)setRowEleHeight(this.parent,this.parent.getActiveSheet(),X,h);n&&setRowEleHeight(this.parent,K,20,u[0])}if(e.isAction){R={requestType:"paste",copiedInfo:o,mergeCollection:y,pasteSheetIndex:this.parent.activeSheetIndex,copiedRange:x.name+"!"+(o.range?getRangeAddress(o.range):x.selectedRange),pastedRange:s.name+"!"+getRangeAddress(t),type:k||"All"};O&&(R.skipFilterCheck=!0),this.parent.notify(completeAction,{eventArgs:R,action:"clipboard"})}}}else this.getClipboardEle().select()}},e.prototype.setCF=function(e,t,r,n,i){var o,a,s=function(r){o=[t[0]+(a[0]<=e[0]?0:a[0]-e[0]),t[1]+(a[1]<=e[1]?0:a[1]-e[1]),t[2]-(a[2]>=e[2]?0:e[2]-a[2]),t[3]-(a[3]>=e[3]?0:e[3]-a[3])],n.conditionalFormats.push(ej2Base.extend({},r,{range:getRangeAddress(o)}))};if(i)for(var l=0,d=i.length;l<d;l++)a=getRangeIndexes(i[l].range),s(i[l]);else if(i=[],r.conditionalFormats)for(l=0,d=r.conditionalFormats.length;l<d;l++)((a=getRangeIndexes(r.conditionalFormats[l].range))[0]>=e[0]&&a[0]<=e[2]||a[2]>=e[0]&&a[2]<=e[2])&&(a[1]>=e[1]&&a[1]<=e[3]||a[3]>=e[1]&&a[3]<=e[3])&&(i.push(r.conditionalFormats[l]),s(r.conditionalFormats[l]));return i},e.prototype.isRangeMerged=function(e,t){var r=getCell(e[0],e[1],t);if(r&&(r.colSpan>1||r.rowSpan>1)){var n={range:e.slice(2,4).concat(e.slice(2,4))};return this.parent.notify(activeCellMergedRange,n),n.range[0]===e[0]&&n.range[1]===e[1]&&n.range[2]===e[2]&&n.range[3]===e[3]}return!1},e.prototype.updateFilter=function(e,t){var r,n;this.parent.notify(getFilteredCollection,null);for(var i=0;i<this.parent.sheets.length;i++)if(this.parent.filterCollection&&this.parent.filterCollection[i]&&this.parent.filterCollection[i].sheetIndex===getSheetIndexFromId(this.parent,e.sId)){var o=e.range,a=getRangeIndexes(this.parent.filterCollection[i].filterRange);o=getSwapRange(o),a[0]===o[0]&&a[2]===o[2]&&a[1]===o[1]&&a[3]===o[3]&&(r=!0,n=[Math.abs(o[0]-a[0]),Math.abs(o[1]-a[1]),Math.abs(o[2]-a[2]),Math.abs(o[3]-a[3])])}var s=this.parent.getCell(e.range[0],e.range[1]),l=(s=s?s.querySelector(".e-filter-icon")?s:this.parent.getCell(e.range[2],e.range[3]):s)?s.querySelector(".e-sortasc-filter"):s,d=s?s.querySelector(".e-sortdesc-filter"):s;if(r)for(var p=0;p<this.parent.filterCollection.length;p++){var h=this.parent.filterCollection[p],c=e&&e.sId?getSheetIndexFromId(this.parent,e.sId):this.parent.activeSheetIndex;if(h.sheetIndex===c&&this.parent.notify(initiateFilterUI,{predicates:null,range:h.filterRange,sIdx:c,isCut:!0}),h.sheetIndex===c&&c===this.parent.activeSheetIndex&&(n=[t[0]+n[0],t[1]+n[1],Math.abs(t[2]-n[2]),Math.abs(t[3]-n[3])],this.parent.notify(initiateFilterUI,{predicates:null,range:getRangeAddress(n),sIdx:null,isCut:!0}),e.range[3]===e.range[1])){var u=this.parent.getCell(t[0],t[1]);l&&u&&u.querySelector(".e-filter-icon").classList.add("e-sortasc-filter"),d&&u&&u.querySelector(".e-filter-icon").classList.add("e-sortdesc-filter")}}},e.prototype.isInRange=function(e,t,r){var n=this.parent.activeSheetIndex;return inRange(e,t[0],t[1])&&r===n||inRange(e,t[2],t[3])&&r===n},e.prototype.setCell=function(e,t,r,n,i,o,a,s){var l=updateCell(this.parent,r,{cell:n,rowIdx:e,colIdx:t,pvtExtend:!i,valChange:!0,lastCell:o,uiRefresh:r.name===this.parent.getActiveSheet().name,checkCf:s});if(!l&&n&&n.style&&a){var d=getTextHeightWithBorder(this.parent,e,t,r,n.style||this.parent.cellStyle,n.wrap?getLines(this.parent.getDisplayText(n),getExcludedColumnWidth(r,e,t),n.style,this.parent.cellStyle):1);(d=Math.round(d))<20&&(d=20),setMaxHgt(r,e,t,d);var p=getRowsHeight(r,e),h=getMaxHgt(r,e);h>p&&setRowEleHeight(this.parent,r,h,e)}return l},e.prototype.getCopiedIdx=function(){if(this.copiedInfo){for(var e=0;e<this.parent.sheets.length;e++)if(this.parent.sheets[e].id===this.copiedInfo.sId)return e;this.clearCopiedInfo()}return-1},e.prototype.setCopiedInfo=function(e,t){var r=this;if(!this.parent.isEdit){var n=new ej2Data.Deferred;e.promise=n.promise;var i,o=this.parent.getActiveSheet();if(e&&e.range){var a=0===e.range[1]&&e.range[3]===o.colCount-1,s=0===e.range[0]&&e.range[2]===o.rowCount-1,l={range:e.range};a||s||this.parent.notify(mergedRange,l),i=l.range}else i=getRangeIndexes(o.selectedRange);if(e&&!e.isPublic&&!e.clipboardData){var d={copiedRange:o.name+"!"+getRangeAddress(i),cancel:!1,action:t?"cut":"copy"};if(this.parent.notify(beginAction,d),d.cancel)return}var p={sheet:o,indexes:[0,0,o.rowCount-1,o.colCount-1],isFinite:this.parent.scrollSettings.isFinite,promise:new Promise(function(e,t){e(void 0)})},h=document.getElementsByClassName("e-ss-overlay-active"),c=h.length;!o.isLocalData||e&&e.clipboardData||0!==i[0]||i[2]!==o.rowCount-1||(this.parent.showSpinner(),this.parent.notify("updateSheetFromDataSource",p)),this.checkForUncalculatedFormula(i,e&&e.sId?e.sId:o.id),p.promise.then(function(){if(c>0){var a={clientY:h[0].offsetTop,isImage:!0};r.parent.notify(getRowIdxFromClientY,a);var s={clientX:h[0].offsetLeft,isImage:!0};r.parent.notify(getColIdxFromClientX,s),r.copiedShapeInfo={sId:e&&e.sId?e.sId:o.id,sheetIdx:o.index,isCut:t,pictureElem:h[0],copiedRange:getRangeAddress([a.clientY,s.clientX,a.clientY,s.clientX]),height:h[0].offsetHeight,width:h[0].offsetWidth,chartInfo:r.getChartElemInfo(h[0])},r.hidePaste(!0),t&&(h[0].classList.contains("e-datavisualization-chart")?r.parent.deleteChart(r.copiedShapeInfo.chartInfo.id):r.parent.notify(deleteImage,{id:r.copiedShapeInfo.pictureElem.id,sheetIdx:r.copiedShapeInfo.sId,range:r.copiedShapeInfo.copiedRange}))}else e&&e.clipboardData||(r.copiedInfo&&r.clearCopiedInfo(),r.copiedInfo={range:i,sId:e&&e.sId?e.sId:o.id,isCut:t},r.hidePaste(!0),r.initCopyIndicator(),ej2Base.Browser.isIE||r.getClipboardEle().select(),e&&e.invokeCopy&&document.execCommand(t?"cut":"copy"),r.parent.hideSpinner());ej2Base.Browser.isIE&&r.setExternalCells(e,t),n.resolve()}),e&&e.clipboardData&&(this.setExternalCells(e,t),focus(this.parent.element))}},e.prototype.checkForUncalculatedFormula=function(e,t){for(var r,n=getSheetIndexFromId(this.parent,t),i=getSheet(this.parent,n),o=e[0];o<=e[2];o++)for(var a=e[1];a<=e[3];a++)(r=getCell(o,a,i,null,!0)).formula&&ej2Base.isUndefined(r.value)&&this.parent.notify(workbookFormulaOperation,{action:"refreshCalculate",value:r.formula,rowIndex:o,colIndex:a,isFormula:checkIsFormula(r.formula),sheetIndex:n})},e.prototype.getChartElemInfo=function(e){var t=this.parent.chartColl;if(e.classList.contains("e-datavisualization-chart"))for(var r=e.getElementsByClassName("e-control")[0].id,n=0;n<t.length;n++)if(t[n].id===r){return t[n]}return null},e.prototype.clearCopiedInfo=function(){this.copiedInfo&&(this.parent.getActiveSheet().id===this.copiedInfo.sId&&(this.removeIndicator(this.parent.getSelectAllContent()),this.removeIndicator(this.parent.getColumnHeaderContent()),this.removeIndicator(this.parent.getRowHeaderContent()),this.removeIndicator(this.parent.getMainContent())),this.copiedInfo=null,this.hidePaste()),this.copiedShapeInfo&&(this.copiedShapeInfo=null,this.hidePaste())},e.prototype.removeIndicator=function(e){if(e){var t=e.getElementsByClassName("e-copy-indicator")[0];t&&ej2Base.detach(t)}},e.prototype.initCopyIndicator=function(){if(this.copiedInfo&&this.parent.getActiveSheet().id===this.copiedInfo.sId){var e=this.parent.createElement("div",{className:"e-copy-indicator"});e.appendChild(this.parent.createElement("div",{className:"e-top"})),e.appendChild(this.parent.createElement("div",{className:"e-bottom"})),e.appendChild(this.parent.createElement("div",{className:"e-left"})),e.appendChild(this.parent.createElement("div",{className:"e-right"})),setPosition(this.parent,e,this.copiedInfo.range,"e-copy-indicator")}},e.prototype.showDialog=function(){var e=this;this.parent.serviceLocator.getService(dialog).show({header:"Spreadsheet",target:this.parent.element,height:205,width:340,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(locale).getConstant("PasteAlert"),beforeOpen:function(t){var r={dialogName:"PasteDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel&&(t.cancel=!0)}})},e.prototype.hidePaste=function(e){this.parent.getActiveSheet().isProtected&&(e=!1),this.parent.notify(enableToolbarItems,[{items:[this.parent.element.id+"_paste"],enable:e||!1}])},e.prototype.setExternalCells=function(e,t){for(var r,n="",i=getSwapRange(this.copiedInfo.range),o=this.parent.getActiveSheet(),a='<html><body><table class="e-spreadsheet" xmlns="http://www.w3.org/1999/xhtml"><tbody>',s=i[0];s<=i[2];s++)if(t||!(getRow(o,s)||{}).isFiltered){a+="<tr>";for(var l=i[1];l<=i[3];l++)if(!((r=getCell(s,l,o,!1,!0)).colSpan<0||r.rowSpan<0)){if(a+="<td",r.colSpan&&(a+=' colspan="'+r.colSpan+'"'),r.rowSpan&&(a+=' rowspan="'+r.rowSpan+'"'),a+=' style="white-space:'+(r.wrap?"normal":"nowrap")+";vertical-align:bottom;",r.style&&Object.keys(r.style).forEach(function(e){var t=e.match(/[A-Z]/);a+=("backgroundColor"===e?"background":t?e.replace(t[0],"-"+t[0].toLowerCase()):e)+":"+("backgroundColor"===e||"color"===e?r.style[e].slice(0,7):r.style[e])+";"}),a+='"',ej2Base.isNullOrUndefined(r.value))a+="></td>";else{var d={formattedText:r.value,value:r.value,format:r.format,onLoad:!0,cell:r,rowIndex:s,colIndex:l};r.format&&"General"!==r.format&&(a+=r.value.toString().includes('"')?" cell-value='"+r.value+"'":' cell-value="'+r.value+'"',this.parent.notify(getFormattedCellObject,d)),a+=">",a+=d.formattedText,n+=d.formattedText,a+="</td>"}n+=l===i[3]?"":"\t"}a+="</tr>",n+=s===i[2]?"":"\n"}a+="</tbody></table></body></html>",ej2Base.Browser.isIE?(window.clipboardData.setData("text",n),t&&window.clipboardData.setData("isInternalCut",n)):(e.clipboardData.setData("text/html",a),e.clipboardData.setData("text/plain",n),t&&e.clipboardData.setData("isInternalCut",n),e.preventDefault())},e.prototype.getExternalCells=function(e){var t,r,n,i=this,o=[],a=[],s=this.parent.createElement("span");if(ej2Base.Browser.isIE?r=window.clipboardData.getData("text"):(t=e.clipboardData.getData("text/html"),r=e.clipboardData.getData("text/plain"),s.innerHTML=t),s.querySelector("table")){var l=!1;if(this.copiedInfo&&!this.copiedInfo.isCut){var d=this.parent.filterCollection;if(d)for(var p=0;p<d.length;p++){var h=getRangeIndexes(d[p].filterRange),c=this.copiedInfo.range;if(h[0]===c[0]&&h[1]===c[1]&&h[2]===c[2]&&h[3]===c[3]){l=!0;break}}}if(s.querySelector(".e-spreadsheet")&&this.copiedInfo&&!l)o={internal:!0};else{var u,g=s.querySelector("table"),f=0;[].slice.call(g.rows||[]).forEach(function(e){o[f]||(o[f]={cells:[]}),a=o[f].cells,u=0,[].slice.call(e.cells||[]).forEach(function(e){if(a[u]&&(u=i.getNewIndex(a,u)),a[u]={},n=i.getStyle(e,s),e.textContent=e.textContent.replace(/(\r\n|\n|\r)/gm,""),e.textContent=e.textContent.replace(/\s+/g," "),n.whiteSpace&&"nowrap"!==n.whiteSpace&&(a[u].wrap=!0,delete n.whiteSpace),Object.keys(n).length&&(n.border&&(["borderBottom","borderTop","borderLeft","borderRight"].forEach(function(e){n[e]=n.border}),delete n.border),a[u].style=n),e.textContent&&(a[u].value=parseIntValue(e.textContent.trim())),e.getAttribute("number-format")&&(a[u].format=e.getAttribute("number-format"),a[u].value&&e.getAttribute("cell-value")&&(a[u].value=parseIntValue(e.getAttribute("cell-value").trim()))),e.getAttribute("colspan")&&parseInt(e.getAttribute("colspan"),10)>1&&(a[u].colSpan=parseInt(e.getAttribute("colspan"),10)),e.getAttribute("rowspan")&&parseInt(e.getAttribute("rowspan"),10)>1&&(a[u].rowSpan=parseInt(e.getAttribute("rowspan"),10)),a[u].colSpan>1&&a[u].rowSpan>1)for(var t=void 0,r=f,l=f+a[u].rowSpan;r<l;r++)for(var d=u,p=u+a[u].colSpan;d<p;d++)r===f&&d===u||(t=a[u].style?{style:ej2Base.extend({},a[u].style)}:{},r!==f&&(t.rowSpan=f-r),d!==u&&(t.colSpan=u-d),o[r]||(o[r]={cells:[]}),o[r].cells[d]=t);else if(a[u].colSpan>1)for(r=u+1,l=u+a[u].colSpan;r<l;r++)a[r]={colSpan:u-r,style:ej2Base.extend({},n)};else if(a[u].rowSpan>1)for(r=f+1,l=f+a[u].rowSpan;r<l;r++)o[r]||(o[r]={cells:[]}),o[r].cells[u]={rowSpan:f-r,style:ej2Base.extend({},n)};u++}),f++})}}else if(s.querySelector("img")){var m=s.querySelector("img");this.parent.notify(createImageElement,{options:{src:m.src,height:m.height,width:m.width},isPublic:!0})}else if(r){var v,C;t&&(v=[].slice.call(s.children)),r.split("\n").forEach(function(e){n=null,t&&(C=v.filter(function(t){return t.textContent&&t.textContent.replace(/(\r\n|\n|\r|\s)/gm," ").trim()===e.trim()})[0])&&(n=i.getStyle(C,s),v.splice(v.indexOf(C),1)),e.trim().split("\t").forEach(function(e,t){(e||n)&&(a[t]={},n&&(n.whiteSpace&&"nowrap"!==n.whiteSpace?(a[t].wrap=!0,delete n.whiteSpace,Object.keys(n).length&&(a[t].style=n)):a[t].style=n),e&&(checkIsFormula(e)?a[t].formula=e:a[t].value=parseIntValue(e.trim())))}),o.push({cells:a}),a=[]})}else if(1===e.clipboardData.types.length&&"Files"===e.clipboardData.types[0]&&e.clipboardData.files[0]&&e.clipboardData.files[0].type.includes("image"))return{file:e.clipboardData.files[0]};return setTimeout(function(){i.getClipboardEle().innerHTML=""},0),o},e.prototype.getNewIndex=function(e,t){return e[t]&&(t++,t=this.getNewIndex(e,t)),t},e.prototype.getStyle=function(e,t){var r=[],n={},i=Object.keys(this.parent.commonCellStyle);if(t.querySelector("style")&&e.classList.length&&t.querySelector("style").innerHTML.indexOf(e.classList[0])>-1){var o=t.querySelector("style").innerHTML.split(e.classList[0]);r.push(o[o.length-1].split("{")[1].split("}")[0])}var a=[].slice.call(e.querySelectorAll("*"));if(a.unshift(e),a.forEach(function(e){e.getAttribute("style")&&r.push(e.getAttribute("style")),"B"===e.tagName&&r.push("font-weight:bold"),"I"===e.tagName&&r.push("font-style:italic"),"U"===e.tagName&&r.push("text-decoration:underline")}),i.length&&t.querySelector("style")){var s=t.querySelector("style").innerHTML.includes("td")?t.querySelector("style").innerHTML.split("td")[1]:t.querySelector("style").innerHTML;s=s.includes("{")?s.split("{")[1].split("}")[0]:s.split("}")[0];for(var l=0;l<i.length;l++){var d=i[l],p=d.match(/[A-Z]/);p&&(d=d.replace(p[0],"-"+p[0].toLowerCase())),s.indexOf(d)>-1&&(n[i[l]]=s.split(d+":")[1].split(";")[0].trim())}}if(r.length){var h,c,u,g=["font-family","vertical-align","text-align","text-indent","color","white-space","font-weight","font-style","font-size","text-decoration","background"],f=["fontFamily","verticalAlign","textAlign","textIndent","color","whiteSpace","fontWeight","fontStyle","fontSize","textDecoration","backgroundColor"],m=["border-bottom","border-top","border-right","border-left","border"],v=["borderBottom","borderTop","borderRight","borderLeft","border"];r.forEach(function(e){e.split(";").forEach(function(e){c=e.split(":")[0].trim(),(h=g.indexOf(c))>-1?(c=e.split(":")[1].trim(),n[f[h]]=c):(h=m.indexOf(c))>-1&&("none"===(c=e.split(":")[1].trim())?c="":c.includes("pt")&&((u=c.split("pt"))[0]=(parseFloat(u[0])/.75).toFixed(2)+"px",c=u.join("")),n[v[h]]=c)})})}return e.innerHTML.indexOf("<s>")>-1&&(n.textDecoration="line-through"),n.textDecoration&&-1===["underline","line-through","underline line-through","none"].indexOf(n.textDecoration)&&(n.textDecoration="none"),n.textAlign&&-1===["left","center","right"].indexOf(n.textAlign)&&(n.textAlign="left"),n.verticalAlign&&-1===["bottom","middle","top"].indexOf(n.verticalAlign)&&(n.verticalAlign="bottom"),n.fontSize&&(n.fontSize=Math.round(parseFloat(n.fontSize.indexOf("px")>-1?(.75*parseFloat(n.fontSize)).toString():n.fontSize))+"pt"),n.fontWeight&&-1===["bold","normal"].indexOf(n.fontWeight)&&(n.fontWeight=n.fontWeight>"599"?"bold":"normal"),n},e.prototype.refreshOnInsertDelete=function(e){if(this.copiedInfo){if(e.model.id!==this.copiedInfo.sId)return;var t=this.copiedInfo.range;if(e.isInsert){if("Column"===e.modelType){if(e.start<=t[3]){if(e.start<=t[1]){var r=e.end-e.start+1;t[1]+=r,t[3]+=r}else t[3]=t[1]+(e.start-t[1]-1);this.performAction()}}else if(e.start<=t[2]){if(e.start<=t[0]){r=e.end-e.start+1;t[0]+=r,t[2]+=r}else t[2]=t[1]+(e.start-t[1]-1);this.performAction()}}else this.clearCopiedInfo()}},e.prototype.performAction=function(){var e=this.getCopyIndicator();e&&setPosition(this.parent,e,this.copiedInfo.range,"e-copy-indicator")},e.prototype.getClipboardEle=function(){return this.parent.element.getElementsByClassName("e-clipboard")[0]},e.prototype.getCopyIndicator=function(){return this.parent.element.getElementsByClassName("e-copy-indicator")[0]},e.prototype.getModuleName=function(){return"clipboard"},e.prototype.destroy=function(){this.removeEventListener();var e=this.getClipboardEle();ej2Base.detach(e),this.parent=null},e}(),Edit=function(){function e(e){this.editorElem=null,this.editCellData={},this.isEdit=!1,this.isCellEdit=!0,this.isNewValueEdit=!0,this.isAltEnter=!1,this.validCharacters=["+","-","*","/",",","(","=","&"],this.formulaBarCurStartPos=null,this.curEndPos=null,this.curStartPos=null,this.selectionStart=null,this.selectionEnd=null,this.uniqueColl="",this.uniqueActCell="",this.isSpill=!1,this.keyCodes={BACKSPACE:8,SPACE:32,TAB:9,DELETE:46,ESC:27,ENTER:13,FIRSTALPHABET:65,LASTALPHABET:90,FIRSTNUMBER:48,LASTNUMBER:59,FIRSTNUMPAD:96,LASTNUMPAD:111,SYMBOLSETONESTART:186,SYMBOLSETONEEND:192,SYMBOLSETTWOSTART:219,SYMBOLSETTWOEND:222,FIREFOXEQUALPLUS:61,FIREFOXMINUS:173,F2:113},this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.isEdit&&this.cancelEdit(!0,!1),this.removeEventListener(),this.parent=null,this.editorElem=null},e.prototype.addEventListener=function(){ej2Base.EventHandler.add(this.parent.element,"dblclick",this.dblClickHandler,this),this.parent.on(mouseDown,this.mouseDownHandler,this),this.parent.on(keyUp,this.keyUpHandler,this),this.parent.on(keyDown,this.keyDownHandler,this),this.parent.on(editOperation,this.performEditOperation,this),this.parent.on(initiateCur,this.initiateCurPosition,this),this.parent.on(editValue,this.updateFormulaBarValue,this),this.parent.on(addressHandle,this.addressHandler,this),this.parent.on(initiateEdit,this.initiateRefSelection,this),this.parent.on(forRefSelRender,this.refSelectionRender,this),this.parent.on(checkUniqueRange,this.checkUniqueRange,this),this.parent.on(reApplyFormula,this.reApplyFormula,this),this.parent.on(activeSheetChanged,this.sheetChangeHandler,this)},e.prototype.removeEventListener=function(){ej2Base.EventHandler.remove(this.parent.element,"dblclick",this.dblClickHandler),this.parent.isDestroyed||(this.parent.off(mouseDown,this.mouseDownHandler),this.parent.off(keyUp,this.keyUpHandler),this.parent.off(keyDown,this.keyDownHandler),this.parent.off(editOperation,this.performEditOperation),this.parent.off(initiateCur,this.initiateCurPosition),this.parent.off(editValue,this.updateFormulaBarValue),this.parent.off(addressHandle,this.addressHandler),this.parent.off(initiateEdit,this.initiateRefSelection),this.parent.off(forRefSelRender,this.refSelectionRender),this.parent.off(checkUniqueRange,this.checkUniqueRange),this.parent.off(reApplyFormula,this.reApplyFormula),this.parent.off(activeSheetChanged,this.sheetChangeHandler))},e.prototype.getModuleName=function(){return"edit"},e.prototype.performEditOperation=function(e){switch(e.action){case"renderEditor":this.renderEditor();break;case"refreshEditor":this.refreshEditor(e.value,e.refreshFormulaBar,e.refreshEditorElem,e.isAppend,e.trigEvent),e.refreshCurPos&&this.setCursorPosition();break;case"startEdit":if(this.isEdit){var t={isEdit:!1};this.parent.notify(isFormulaBarEdit,t),t.isEdit&&(this.isNewValueEdit=e.isNewValueEdit,this.startEdit(e.address,e.value,e.refreshCurPos))}else this.isNewValueEdit=e.isNewValueEdit,this.startEdit(e.address,e.value,e.refreshCurPos);break;case"endEdit":this.isEdit&&this.endEdit(e.refreshFormulaBar);break;case"cancelEdit":this.isEdit&&this.cancelEdit(e.refreshFormulaBar);break;case"getCurrentEditValue":e.editedValue=this.editCellData.value,void 0!==e.endFormulaRef&&(e.endFormulaRef=this.endFormulaRef);break;case"refreshDependentCellValue":this.refreshDependentCellValue(e.rowIdx,e.colIdx,e.sheetIdx);break;case"getElement":e.element=this.getEditElement(this.parent.getActiveSheet());break;case"focusEditorElem":this.editorElem.focus();break;case"getCurrentEditSheetIdx":e.sheetIndex=this.editCellData.sheetIndex}},e.prototype.keyUpHandler=function(e){if(this.isEdit){var t=this.getEditElement(this.parent.getActiveSheet());e.altKey&&13===e.keyCode?(t.focus(),this.altEnter(),this.isAltEnter=!0):this.isCellEdit&&this.editCellData.value!==t.textContent&&16!==e.keyCode&&this.refreshEditor(t.textContent,this.isCellEdit);if(checkIsFormula(this.editCellData.value,!0)&&(!e||16!==e.keyCode)&&(this.updateFormulaReference(t),this.endFormulaRef)){var r=this.getCurPosition();r.end&&this.validCharacters.indexOf(this.editCellData.value[r.end-1])>-1&&(this.endFormulaRef=!1)}}},e.prototype.updateFormulaReference=function(e){var t=this.parent.element.querySelector(".e-formularef-indicator");t&&t.parentElement.removeChild(t),this.editCellData.value!==e.textContent&&this.refreshEditor(e.textContent,!0);var r=this.editCellData.sheetIndex,n=this.editCellData.value;this.parent.notify(initiateFormulaReference,{range:n,formulaSheetIdx:r})},e.prototype.keyDownHandler=function(e){var t=e.target,r=e.keyCode,n=this.parent.getActiveSheet(),i=getCellIndexes(n.activeCell),o=getCell(i[0],i[1],n)||{};if(!ej2Base.closest(e.target,".e-findtool-dlg")&&!ej2Base.closest(e.target,".e-validationerror-dlg")&&!ej2Base.closest(e.target,".e-hyperlink-dlg"))if(n.isProtected&&!ej2Base.closest(e.target,".e-sheet-rename")&&isLocked(o,getColumn(n,i[1]))){if((r>=this.keyCodes.FIRSTALPHABET&&r<=this.keyCodes.LASTALPHABET||r>=this.keyCodes.FIRSTNUMBER&&r<=this.keyCodes.LASTNUMBER||r===this.keyCodes.DELETE||r===this.keyCodes.BACKSPACE||r===this.keyCodes.SPACE||r>=this.keyCodes.FIRSTNUMPAD&&r<=this.keyCodes.LASTNUMPAD||r>=this.keyCodes.SYMBOLSETONESTART&&r<=this.keyCodes.SYMBOLSETONEEND||r>=219&&r<=222||!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&r===this.keyCodes.F2)&&67!==r&&89!==r&&90!==r){if(n.protectSettings.insertLink&&75===r)return;this.parent.element.querySelector(".e-editAlert-dlg")||e.ctrlKey||70===e.keyCode||t.parentElement.classList.contains("e-unprotectpwd-content")||t.parentElement.classList.contains("e-password-content")||t.parentElement.classList.contains("e-sheet-password-content")||t.parentElement.classList.contains("e-unprotectsheetpwd-content")||t.parentElement.classList.contains("e-reenterpwd-content")||this.parent.notify(editAlert,null)}}else if(this.isEdit){var a=this.getEditElement(n),s=checkIsFormula(this.editCellData.value,!0);if((this.isCellEdit||s&&this.editCellData.value!==a.textContent&&16!==e.keyCode)&&(i[1]<this.parent.frozenColCount(n)&&(!n.frozenRows||i[0]>=this.parent.frozenRowCount(n))&&a&&"auto"!==a.style.height&&getTextWidth(a.textContent,o.style,this.parent.cellStyle)>parseInt(a.style.maxWidth,10)&&(a.style.height="auto"),getTextWidth(a.textContent,o.style,this.parent.cellStyle)>parseInt(a.style.maxWidth,10)-5&&(a.style.height="auto"),i[0]<this.parent.frozenRowCount(n)&&a&&!a.style.overflow&&getTextWidth(a.textContent,o.style,this.parent.cellStyle)>parseInt(a.style.maxWidth,10)&&(a.style.overflow="auto"),this.refreshEditor(a.textContent,this.isCellEdit,!1,!1,!1)),!e.altKey)switch(r){case this.keyCodes.ENTER:if(ej2Base.Browser.isWindows&&e.preventDefault(),this.isAltEnter){var l=a.textContent;l&&l.indexOf("\n")>-1&&(wrap(this.parent.getActiveSheet().selectedRange,!0,this.parent,!0),this.refreshEditor(a.textContent,this.isCellEdit,!1,!1,!1),this.isAltEnter=!1)}if(s){var d=this.parent.element.querySelector(".e-formularef-indicator");d&&d.parentElement.removeChild(d),this.editCellData.sheetIndex===n.id-1?this.endEdit(!1,e):(this.parent.goTo(this.editCellData.fullAddr),this.endEdit(!1,e))}else this.endEdit(!1,e);break;case this.keyCodes.TAB:this.hasFormulaSuggSelected()||this.endEdit(!1,e);break;case this.keyCodes.ESC:this.cancelEdit(!0,!0,e)}}else if(!this.isEdit&&(t.classList.contains("e-spreadsheet")||ej2Base.closest(t,".e-sheet-panel"))){var p=r>=this.keyCodes.FIRSTALPHABET&&r<=this.keyCodes.LASTALPHABET,h=r>=this.keyCodes.FIRSTNUMBER&&r<=this.keyCodes.LASTNUMBER,c=r>=this.keyCodes.FIRSTNUMPAD&&r<=this.keyCodes.LASTNUMPAD,u=r>=this.keyCodes.SYMBOLSETONESTART&&r<=this.keyCodes.SYMBOLSETONEEND;u||(u=r>=this.keyCodes.SYMBOLSETTWOSTART&&r<=this.keyCodes.SYMBOLSETTWOEND);var g=r===this.keyCodes.FIREFOXEQUALPLUS||r===this.keyCodes.FIREFOXMINUS,f=!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&r===this.keyCodes.F2,m=r===this.keyCodes.BACKSPACE;if(!e.ctrlKey&&!e.metaKey&&!e.altKey&&(!e.shiftKey&&r===this.keyCodes.SPACE||p||h||c||u||"mozilla"===ej2Base.Browser.info.name&&g)||f||m){f&&(this.isNewValueEdit=!1);var v=document.getElementsByClassName("e-ss-overlay-active");v.length>0?r===this.keyCodes.DELETE&&this.parent.notify(deleteImage,{id:v[0].id,sheetIdx:this.parent.activeSheetIndex+1}):this.startEdit(null,null,!0,!0)}if(r===this.keyCodes.DELETE){n.isProtected&&isLockedCells(this.parent)?this.parent.notify(editAlert,null):(this.editingHandler("delete"),this.parent.notify(activeCellChanged,null))}}},e.prototype.renderEditor=function(){if(!this.editorElem||!ej2Base.select("#"+this.parent.element.id+"_edit",this.parent.element)){var e=this.parent.createElement("div",{id:this.parent.element.id+"_edit",className:"e-spreadsheet-edit"});e.contentEditable="true",e.spellcheck=!1,this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0]&&this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0].remove();var t=this.parent.element.querySelector(".e-sheet-content");if(!t)return;t.appendChild(e),this.editorElem=e}this.parent.notify(formulaOperation,{action:"renderAutoComplete"})},e.prototype.refreshEditor=function(e,t,r,n,i){void 0===i&&(i=!0),n?e=this.editCellData.value=this.editCellData.value+e:this.editCellData.value=e;var o=this.getEditElement(this.parent.getActiveSheet());r&&o&&(o.textContent=e),t&&this.parent.notify(formulaBarOperation,{action:"refreshFormulabar",value:e}),this.parent.isEdit&&o&&i&&this.editCellData.value===o.textContent&&this.triggerEvent("cellEditing").cancel&&this.cancelEdit()},e.prototype.startEdit=function(e,t,r,n){void 0===r&&(r=!0),this.parent.showSheetTabs&&this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true");var i=this.parent.getActiveSheet(),o=getCellIndexes(i.activeCell),a=getCell(o[0],o[1],i,!1,!0);if(hasTemplate(this.parent,o[0],o[1],this.parent.activeSheetIndex)){var s=this.parent.getCell(o[0],o[1]),l=!1,d=s.innerHTML;if(s&&d.indexOf("<")>-1&&d.indexOf(">")>-1&&d.indexOf("input")>-1&&(l=!0),l)return}this.updateEditCellDetail(e,t),this.initiateEditor(r),this.positionEditor(),this.parent.isEdit=this.isEdit=!0,this.parent.notify(clearCopy,null),this.parent.notify(enableToolbarItems,[{enable:!1}]),a.formula&&!n&&this.parent.notify(initiateFormulaReference,{range:a.formula,formulaSheetIdx:this.editCellData.sheetIndex})},e.prototype.setCursorPosition=function(){var e=this.getEditElement(this.parent.getActiveSheet()),t=e.textContent.length;if(t){var r=document.getSelection(),n=document.createRange();n.setStart(e.firstChild,t),n.collapse(!0),r.removeAllRanges(),r.addRange(n)}e.focus()},e.prototype.hasFormulaSuggSelected=function(){var e=document.getElementById(this.parent.element.id+"_ac_popup");return e&&"visible"===e.style.visibility&&e.querySelectorAll(".e-item-focus").length>0},e.prototype.editingHandler=function(e){var t,r=document.getElementsByClassName("e-ss-overlay-active"),n=r.length;switch(e){case"delete":if(n>0)r[0].classList.contains("e-datavisualization-chart")?this.parent.notify(deleteChart,{id:r[0].id,sheetIdx:this.parent.activeSheetIndex+1}):this.parent.notify(deleteImage,{id:r[0].id,sheetIdx:this.parent.activeSheetIndex+1});else{var i=this.parent.getActiveSheet(),o=i.selectedRange,a=getIndexesFromAddress(o);o=getRangeAddress(a=a[0]>a[2]?getSwapRange(a):a);var s={address:i.name+"!"+o,cancel:!1};if(this.parent.notify(beginAction,{action:"cellDelete",eventArgs:s}),s.cancel)return;a=getRangeIndexes(o=getRangeFromAddress(s.address)),clearRange(this.parent,a,this.parent.activeSheetIndex),this.parent.notify(selectionComplete,{});var l={cellIdx:a,isUnique:!1};if(this.checkUniqueRange(l),l.isUnique){var d=getRangeIndexes(this.uniqueColl);(m=getCell(d[0],d[1],this.parent.getActiveSheet()))&&(t=m.value.indexOf("#SPILL!")>-1)}if(l.isUnique&&this.uniqueColl.split(":")[0]===o.split(":")[0]){for(var p=getRangeIndexes(this.uniqueColl),h=p[0];h<=p[2];h++)for(var c=p[1];c<=p[3];c++)this.parent.updateCell({value:"",formula:""},getRangeAddress([h,c]));this.parent.notify(removeUniquecol,null),this.uniqueColl=""}else if(l.isUnique){var u=getRangeIndexes(this.uniqueColl);if("#SPILL!"===getCell(u[0],u[1],i).value){var g=!1;for(c=u[0];c<=u[2];c++)for(var f=u[1];f<=u[3];f++){var m=getCell(c,f,i);c===u[0]&&f===u[1]?g=!1:ej2Base.isNullOrUndefined(m.value)||""===m.value||(g=!0)}g||this.reApplyFormula()}}l.isUnique?this.parent.notify(completeAction,{action:"cellDelete",eventArgs:{address:i.name+"!"+o,isSpill:t}}):this.parent.notify(completeAction,{action:"cellDelete",eventArgs:{address:i.name+"!"+o}})}}},e.prototype.getCurPosition=function(){var e={},t=window.getSelection();if(this.editorElem.textContent===this.editCellData.value&&(e.start=t.anchorOffset,e.end=t.focusOffset,e.start>e.end)){var r=e.start;e.start=e.end,e.end=r}if(t&&t.focusNode&&t.focusNode.classList&&t.focusNode.classList.contains("e-formula-bar-panel")&&this.editorElem.textContent===this.editCellData.value){var n=t.focusNode.getElementsByClassName("e-formula-bar e-css")[0];e.start=n.selectionStart,e.end=n.selectionEnd}return e},e.prototype.mouseDownHandler=function(e){if(!ej2Base.closest(e.target,".e-findtool-dlg")&&this.isEdit){var t=this.getCurPosition();t.start&&(this.curStartPos=this.selectionStart=t.start),t.end&&(this.curEndPos=this.selectionEnd=t.end);var r=e.target,n=this.parent.getActiveSheet(),i=this.parent.element.querySelector(".e-formularef-indicator");this.isCellEdit=r.classList.contains("e-spreadsheet-edit");var o=checkIsFormula(this.editCellData.value,!0),a=this.getEditElement(n);if(r.classList.contains("e-cell")||r.classList.contains("e-header-cell")||r.classList.contains("e-selectall")||ej2Base.closest(r,".e-toolbar-item.e-active")||ej2Base.closest(r,".e-table")){if(this.isAltEnter){var s=a.textContent;s&&s.indexOf("\n")>-1&&(this.isAltEnter=!1,wrap(this.parent.getActiveSheet().selectedRange,!0,this.parent),this.refreshEditor(a.textContent,this.isCellEdit))}if(!o||this.endFormulaRef)this.endFormulaRef=!1,this.endEdit(!1,e);else{var l=this.selectionEnd,d=getCellIndexes(n.activeCell),p=getCell(d[0],d[1],n);if(this.selectionStart!==this.selectionEnd&&this.editCellData.value===a.textContent&&-1!==this.validCharacters.indexOf(a.textContent.substring(this.selectionStart-1,this.selectionStart))&&isCellReference(a.textContent.substring(this.selectionStart,this.selectionEnd))&&a.textContent.indexOf(":")!==this.selectionEnd&&(this.editCellData.value=a.textContent.substring(0,this.selectionStart)+a.textContent.substring(this.selectionEnd,a.textContent.length)),this.editCellData.value===a.textContent&&a.textContent.indexOf("(")!==a.textContent.length-1&&-1!==a.textContent.indexOf("(")&&this.selectionStart===this.selectionEnd)if(this.editCellData.sheetIndex!==n.id-1){var h=this.parent.element.querySelector(".e-formula-bar");if(","!==a.textContent.substring(h.selectionEnd-1,h.selectionEnd)&&!e.shiftKey)return i&&i.parentElement.removeChild(i),this.parent.goTo(this.editCellData.fullAddr),void this.endEdit(!1,e)}else if(-1===this.validCharacters.indexOf(a.textContent.substring(l-1,l)))return i&&i.parentElement.removeChild(i),void this.endEdit(!1,e);if(!p)return;if((o=!!p.formula&&(checkIsFormula(getCell(d[0],d[1],n).formula)||this.editCellData.value&&0===this.editCellData.value.toString().indexOf("=")))&&this.parent.isEdit){var c=this.selectionEnd;this.editCellData.value.length===c?(")"===this.editCellData.value.substring(this.editCellData.value.length-1)||isNumber(this.editCellData.value.substring(this.editCellData.value.length-1)))&&(i&&i.parentElement.removeChild(i),this.endEdit(!1,e)):this.editCellData.value===a.textContent&&(-1===this.validCharacters.indexOf((this.editCellData.value+n.selectedRange).substring(c-1,c))?(i&&i.parentElement.removeChild(i),this.endEdit(!1,e)):(-1===this.validCharacters.indexOf(a.textContent.substring(c-1,c))||")"!==a.textContent.substring(c,c+1)&&-1===this.validCharacters.indexOf(a.textContent.substring(c,c+1)))&&(i&&i.parentElement.removeChild(i),this.endEdit(!1,e)))}}}else if(o&&this.editCellData.value===a.textContent&&a.textContent.indexOf("(")!==a.textContent.length-1&&!this.isCellEdit&&-1===this.validCharacters.indexOf(this.editCellData.value.substring(this.selectionStart-1,this.selectionStart))&&this.editCellData.sheetIndex===n.id-1){l=window.getSelection().focusOffset;if(-1===this.validCharacters.indexOf(a.textContent.substring(l-1,l)))return i&&i.parentElement.removeChild(i),this.parent.goTo(this.editCellData.fullAddr),void this.endEdit(!1,e)}}},e.prototype.dblClickHandler=function(e){var t=e.target,r=this.parent.getActiveSheet(),n=getCellIndexes(r.activeCell),i=getCell(n[0],n[1],r)||{};if(!ej2Base.closest(t,".e-datavisualization-chart"))if(r.isProtected&&isLocked(i,getColumn(r,n[1])))(t.classList.contains("e-active-cell")||t.classList.contains("e-cell"))&&this.parent.notify(editAlert,null);else if(t.className.indexOf("e-ss-overlay")<0&&(t.classList.contains("e-active-cell")||t.classList.contains("e-cell")||ej2Base.closest(t,".e-sheet-content")||t.classList.contains("e-table")))if(this.isEdit)if(checkIsFormula(this.editCellData.value)){var o=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));this.parent.getActiveSheet().name===o&&this.endEdit()}else t.className.indexOf("e-spreadsheet-edit")<0&&this.endEdit();else this.isNewValueEdit=!1,this.startEdit()},e.prototype.updateEditCellDetail=function(e,t){var r,n;if(r=ej2Base.isNullOrUndefined(this.editCellData.sheetIndex)?e&&e.split("!").length>1?getSheetIndex(this.parent,getSheetNameFromAddress(e)):this.parent.activeSheetIndex:this.editCellData.sheetIndex,this.editCellData.addr?checkIsFormula(this.editCellData.value,!0)&&(n=getSheet(this.parent,r),this.isNewValueEdit=!1):(n=getSheet(this.parent,r),e=e?getRangeFromAddress(e):n.activeCell),e){var i=getRangeIndexes(e),o=i[0],a=i[1],s=this.parent.getCell(o,a),l=getCellPosition(n,i,this.parent.frozenRowCount(n),this.parent.frozenColCount(n),this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth);this.editCellData={addr:e,fullAddr:getSheetName(this.parent,r)+"!"+e,rowIndex:o,colIndex:a,sheetIndex:r,element:s,value:t||"",position:l}}},e.prototype.initiateEditor=function(e){var t=this;this.parent.getData(this.editCellData.fullAddr).then(function(r){r.forEach(function(r){var n={cell:r,value:r?r.value:""};t.parent.notify(getFormattedBarText,n);var i=r?n.value:"";r&&r.formula&&(i=r.formula),t.editCellData.oldValue=i,t.editCellData.value?i=t.editCellData.value:t.editCellData.value=i,t.isNewValueEdit?i="":t.isNewValueEdit=!0,ej2Base.isUndefined(i)||t.refreshEditor(i,!1,!0,!1,!1),e&&t.setCursorPosition(),t.triggerEvent("cellEdit").cancel&&t.cancelEdit(!0,!1)})})},e.prototype.positionEditor=function(e){var t,r=this.editCellData.element,n={isEdit:!1};if(this.parent.notify(isFormulaBarEdit,n),n.isEdit&&ej2Base.isNullOrUndefined(r)&&(r=t=this.parent.getCell(this.editCellData.rowIndex,this.editCellData.colIndex),this.editCellData.element=t),r){r.classList.add("e-ss-edited");var i=this.parent.getActiveSheet(),o=getCell(this.editCellData.rowIndex,this.editCellData.colIndex,i,!1,!0),a=this.editCellData.position.left+1,s=this.editCellData.position.top+1,l={range:[this.editCellData.rowIndex,this.editCellData.colIndex,this.editCellData.rowIndex,this.editCellData.colIndex]};this.parent.notify(activeCellMergedRange,l);var d=getRowsHeight(i,l.range[0],l.range[2])-3,p=getColumnsWidth(i,l.range[1],l.range[3])-3,h=this.parent.getMainContent().parentElement,c=void 0,u=this.parent.frozenColCount(i),g=void 0,f=void 0,m=this.parent.frozenRowCount(i),v=void 0;this.editCellData.colIndex<u?(c=Math.abs(this.parent.getRowHeaderContent().getBoundingClientRect()[this.parent.enableRtl?"left":"right"]-r.getBoundingClientRect()[this.parent.enableRtl?"right":"left"])-1,this.editCellData.rowIndex<m?"2"===this.parent.getRowHeaderContent().style.zIndex&&(g="3"):getTextWidth(o.value,o.style,this.parent.cellStyle)>c&&(v=!0)):c=h.offsetWidth-a-28-this.parent.sheetModule.getRowHeaderWidth(i),this.editCellData.rowIndex<m&&(f=!0);var C=!f&&(o&&o.wrap||r&&e||v)?"auto;":d+"px;",y="display:block;top:"+s+"px;"+(this.parent.enableRtl?"right:":"left:")+a+"px;min-width:"+p+"px;max-width:"+(o&&o.wrap?p:c)+"px;height:"+C+(o&&o.wrap?"width:"+p+"px;":"")+"min-height:"+d+"px;"+(g?"z-index: "+g+";":"")+(f&&(o&&!o.wrap||r&&e)&&(getTextWidth(o.value,o.style,this.parent.cellStyle)>c||r&&e)?"overflow: auto;":"");y+=r.style.cssText;var x=this.getEditElement(i,!0);x.setAttribute("style",y),getTextWidth(x.textContent,o.style,this.parent.cellStyle)>c&&(x.style.height="auto");var b=this.parent.element.querySelector(".e-active-cell");b&&(b.style.height=d+4+"px"),r.classList.contains("e-right-align")?x.classList.add("e-right-align"):r.classList.contains("e-center-align")&&x.classList.add("e-center-align")}},e.prototype.updateEditedValue=function(e,t){void 0===e&&(e=!0);var r=this.editCellData.oldValue,n=r?r.toString().toUpperCase():"",i=!0,o=this.editCellData.addr,a=getRangeIndexes(this.parent.getActiveSheet().activeCell),s=this.parent.getActiveSheet(),l=getCell(a[0],a[1],s),d=getColumn(s,a[1]);t&&(this.editCellData.value=t);var p=this.editCellData.value;if(this.parent.notify(setActionData,{args:{action:"beforeCellSave",eventArgs:{address:this.editCellData.addr}}}),this.parent.allowDataValidation&&(l&&l.validation||d&&d.validation)){var h=p||this.getEditElement(s).innerText,c=this.parent.activeSheetIndex,u=void 0;u="string"==typeof o?getRangeIndexes(o):o,this.parent.notify(isValidation,{value:h,range:u,sheetIdx:c,isCell:!0}),i=this.parent.allowDataValidation,this.editCellData.value=i?h:this.editCellData.value,this.parent.allowDataValidation=!0}if((r!==this.editCellData.value||n.indexOf("=RAND()")>-1||n.indexOf("RAND()")>-1||n.indexOf("=RANDBETWEEN(")>-1||n.indexOf("RANDBETWEEN(")>-1)&&i){var g=this.parent.getActiveSheet(),f=getRangeIndexes(g.activeCell);r&&r.toString().indexOf("=UNIQUE(")>-1&&""===this.editCellData.value&&this.parent.notify(removeUniquecol,null);var m={cellIdx:f,isUnique:!1};this.checkUniqueRange(m);var v=m.isUnique;if(v&&""!==r&&""===this.editCellData.value){if(-1===getCell((x=getRangeIndexes(this.uniqueColl))[0],x[1],g).value.indexOf("#SPILL!"))return i}r&&r.toString().indexOf("UNIQUE")>-1&&this.editCellData.value&&this.editCellData.value.toString().indexOf("UNIQUE")>-1&&v&&this.updateUniqueRange(""),this.parent.notify(workbookEditOperation,{action:"updateCellValue",address:this.editCellData.addr,value:this.editCellData.value});var C=getCell(f[0],f[1],g,!0),y=this.getRefreshNodeArgs(C);if(this.editCellData.value=y.value,C&&C.formula&&(this.editCellData.formula=C.formula),C&&C.wrap&&this.parent.notify(wrapEvent,{range:f,wrap:!0,sheet:g}),e&&this.parent.refreshNode(this.editCellData.element,y),C&&C.hyperlink&&this.parent.serviceLocator.getService("cell").refreshRange(f),v){var x;if(getCell((x=getRangeIndexes(this.uniqueColl))[0],x[1],g).value.indexOf("#SPILL!")>-1&&(this.isSpill=!0),""!==r&&""===this.editCellData.value||this.editCellData.formula&&this.editCellData.formula.length>1&&r!==this.editCellData.formula){for(var b=!1,S=x[0];S<=x[2];S++)for(var w=x[1];w<=x[3];w++){var I=getCell(S,w,g);S===x[0]&&w===x[1]?b=!1:I&&!ej2Base.isNullOrUndefined(I.value)&&""!==I.value&&(b=!0)}b||this.reApplyFormula()}else this.updateUniqueRange(p)}}return i},e.prototype.checkUniqueRange=function(e){var t={range:[]};this.parent.notify(getUniqueRange,t);for(var r=t.range,n=0;n<r.length;n++)if(r[n].split("!")[0]===this.parent.getActiveSheet().name)for(var i=getRangeIndexes(r[n]),o=i[0];o<=i[2];o++)for(var a=i[1];a<=i[3];a++)if(e.cellIdx[0]===o&&e.cellIdx[1]===a){e.isUnique=!0,this.uniqueCell=!0;var s=""!==this.uniqueColl?getRangeIndexes(this.uniqueColl):[0,0,0,0],l=getRangeIndexes(r[n]);if(s[0]===l[0]&&s[1]===l[1]){var d=[s[0],l[1],s[0],l[1]];d[2]=s[2]>l[2]?s[2]:l[2],d[3]=s[3]>l[3]?s[3]:l[3],this.uniqueColl=getRangeAddress(d),e.uniqueRange=getRangeAddress(d)}else this.uniqueColl=r[n],e.uniqueRange=r[n]}},e.prototype.updateUniqueRange=function(e){var t=getRangeIndexes(this.uniqueColl),r=!1;"#SPILL!"!==getCell(t[0],t[1],this.parent.getActiveSheet()).value&&(r=!0);for(var n=t[0];n<=t[2];n++)for(var i=t[1];i<=t[3];i++)r&&(n===t[0]&&i===t[1]?this.parent.updateCell({value:"#SPILL!"},getRangeAddress([n,i])):getRangeAddress([n,i]).split(":")[0]===this.editCellData.addr?this.parent.updateCell({value:e},getRangeAddress([n,i])):this.parent.updateCell({value:""},getRangeAddress([n,i])))},e.prototype.reApplyFormula=function(){var e=getRangeIndexes(this.uniqueColl),t=getCell(e[0],e[1],this.parent.getActiveSheet());this.parent.updateCell({value:""},getRangeAddress([e[0],e[1]]));for(var r=this.parent.sheets,n=t.formula,i=0;i<r.length;i++)n.indexOf(r[i].name)>-1&&(n=n.replace(r[i].name,"!"+i));this.parent.computeExpression(n),this.uniqueCell=!1,""!==this.uniqueActCell&&(this.editCellData.value=this.uniqueActCell,this.uniqueActCell="")},e.prototype.refreshDependentCellValue=function(e,t,r){if(e&&t&&(e--,t--,(this.editCellData.rowIndex!==e||this.editCellData.colIndex!==t)&&this.parent.activeSheetIndex===r||this.uniqueCell&&this.parent.activeSheetIndex===r)){var n=this.parent.getCell(e,t);if(n){if(n.parentElement){var i=n.parentElement.getAttribute("aria-rowindex");if(i&&Number(i)-1!==e)return}var o=getSheet(this.parent,r),a=getCell(e,t,o),s=getRangeIndexes(o.activeCell);s[0]===e&&s[1]===t&&(this.uniqueActCell=a.value);var l=this.getRefreshNodeArgs(a,e,t);this.parent.refreshNode(n,l)}}},e.prototype.getRefreshNodeArgs=function(e,t,r){var n=(e=e||{})&&e.format?e.format:"",i={value:e.value,format:n,onLoad:!0,formattedText:"",isRightAlign:!1,type:"General",cell:e,rowIndex:void 0===t?this.editCellData.rowIndex:t,colIndex:void 0===r?this.editCellData.colIndex:r,isRowFill:!1};this.parent.notify(getFormattedCellObject,i),i.formattedText=this.parent.allowNumberFormatting?i.formattedText:i.value;return{isRightAlign:i.isRightAlign,result:i.formattedText,type:i.type,value:i.value,curSymbol:i.curSymbol,isRowFill:i.isRowFill}},e.prototype.endEdit=function(e,t){void 0===e&&(e=!1);var r=this.parent.getActiveSheet(),n=getCellIndexes(r.activeCell),i=this.parent.getCell(n[0],n[1]),o="";this.editCellData.element&&this.editCellData.element.children[0]&&"e-cf-databar"===this.editCellData.element.children[0].className&&(o=i.children[0].querySelector(".e-databar-value").style.fontSize),e&&this.refreshEditor(this.editCellData.oldValue,!1,!0,!1,!1);var a=this.triggerEvent("beforeCellSave");if(a.cancel)this.parent.isEdit&&t&&t.preventDefault();else{a.value&&a.value.toString().indexOf("\n")>-1&&(wrap(this.parent.getActiveSheet().selectedRange,!0,this.parent),this.refreshEditor(a.value,this.isCellEdit,!1,!1,!1));this.updateEditedValue(!0,a.value)?(this.triggerEvent("cellSave",t,a.value),this.resetEditState(),this.focusElement()):t&&t.preventDefault(),""!==o&&(i.children[0].querySelector(".e-databar-value").style.fontSize=o),this.parent.showSheetTabs&&!this.parent.isProtected&&this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.isValidationHighlighted&&getCell(n[0],n[1],r).validation&&this.parent.addInvalidHighlight()}},e.prototype.cancelEdit=function(e,t,r){void 0===e&&(e=!0),void 0===t&&(t=!0),this.refreshEditor(this.editCellData.oldValue,e,!1,!1,!1),t&&this.triggerEvent("cellSave",r),this.resetEditState(),this.focusElement()},e.prototype.focusElement=function(){focus(this.parent.element),this.parent.notify(enableToolbarItems,[{enable:!0}])},e.prototype.triggerEvent=function(e,t,r){var n=this.parent.getActiveSheet(),i=getCell(this.editCellData.rowIndex,this.editCellData.colIndex,n),o={element:this.editCellData.element,value:r||this.editCellData.value,oldValue:this.editCellData.oldValue,address:this.editCellData.fullAddr,displayText:this.parent.getDisplayText(i)};if(o.address){var a={cellIdx:getRangeIndexes(o.address),isUnique:!1};this.checkUniqueRange(a),a.isUnique&&(o.isSpill=this.isSpill)}if(o.value!==o.oldValue){if("cellSave"!==e&&(o.cancel=!1),"beforeCellSave"===e){this.parent.notify(beginAction,{eventArgs:o,action:"cellSave",preventAction:!0});a={cell:i=checkIsFormula(o.value)?{formula:o.value}:{value:o.value},cancel:!1,sheetId:n.id,rowIndex:this.editCellData.rowIndex,colIndex:this.editCellData.colIndex};if(this.parent.trigger(beforeCellUpdate,a),a.cancel)return this.cancelEdit(!1,!1),o.cancel=!0,o}this.parent.trigger(e,o),"cellSave"===e&&(this.editCellData.formula&&(o.formula=this.editCellData.formula),o.originalEvent=t,this.parent.notify(completeAction,{eventArgs:o,action:"cellSave"}))}else"cellSave"!==e&&"beforeCellSave"!==e&&this.parent.trigger(e,o);return{value:o.value,oldValue:null,element:null,address:null,cancel:o.cancel}},e.prototype.altEnter=function(){this.positionEditor(!0);var e,t=window.getSelection(),r=t.anchorNode,n=document.createRange();0===(e=3===r.nodeType?t.anchorOffset:r.textContent.length)&&r.textContent.length>0&&(e=r.textContent.length);var i=r.textContent,o=i.slice(0,e),a=i.slice(e)||" ";r.textContent=o+"\n"+a,n=document.createRange(),3===r.nodeType?(n.setStart(r,e+1),n.setEnd(r,e+1)):1===r.nodeType&&(n.setStart(r.firstChild,e+1),n.setEnd(r.firstChild,e+1)),t.removeAllRanges(),t.addRange(n)},e.prototype.resetEditState=function(e){if(void 0===e&&(e=!0),e){var t=this.getEditElement(this.parent.getActiveSheet());(checkIsFormula(t.textContent)||""===t.textContent)&&this.parent.notify(clearCellRef,null),this.editCellData.element&&(this.editCellData.element.classList.remove("e-ss-edited"),this.editorElem.textContent="",t===this.editorElem?(this.editorElem.removeAttribute("style"),this.editorElem.classList.remove("e-right-align")):ej2Base.detach(t))}this.editCellData={},this.parent.isEdit=this.isEdit=!1,this.isCellEdit=!0,this.parent.notify(formulaOperation,{action:"endEdit"})},e.prototype.refSelectionRender=function(){var e=this.getEditElement(this.parent.getActiveSheet());e&&checkIsFormula(e.textContent)&&this.parent.notify(initiateFormulaReference,{range:e.textContent,formulaSheetIdx:this.editCellData.sheetIndex})},e.prototype.initiateRefSelection=function(){var e=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!")),t=this.editCellData.value;this.parent.getActiveSheet().name===e&&checkIsFormula(this.editCellData.value,!0)?(this.startEdit(this.editCellData.addr,t,!1),this.parent.notify(initiateFormulaReference,{range:this.editCellData.value,formulaSheetIdx:this.editCellData.sheetIndex}),this.getEditElement(this.parent.getActiveSheet()).innerHTML=t,this.initiateCurPosition()):this.initiateCurPosition()},e.prototype.addressHandler=function(e){var t=window.getSelection();if(this.selectionStart=t.anchorOffset,this.selectionEnd=t.focusOffset,this.selectionStart>this.selectionEnd){var r=this.selectionStart;this.selectionStart=this.selectionEnd,this.selectionEnd=r}if(t&&t.focusNode&&t.focusNode.classList&&t.focusNode.classList.contains("e-formula-bar-panel")){var n=t.focusNode.getElementsByClassName("e-formula-bar e-css")[0];this.selectionStart=n.selectionStart,this.selectionEnd=n.selectionEnd}var i={action:"getCurrentEditValue",editedValue:""};this.parent.notify(editOperation,i);var o=e.range,a=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!")),s=this.editCellData.sheetIndex,l=this.getEditElement(this.parent.getActiveSheet());if(this.parent.getActiveSheet().name!==a&&(o="'"+this.parent.getActiveSheet().name+"'!"+o),e.isSelect)this.parent.notify(initiateFormulaReference,{range:i.editedValue+o,formulaSheetIdx:s});else{var d=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));if(this.parent.getActiveSheet().name===d){var p=i.editedValue;this.selectionStart!==this.selectionEnd?(this.formulaBarCurStartPos=this.selectionStart,this.curStartPos=this.selectionStart,this.curEndPos=this.selectionStart+o.length,l.textContent=p.substring(0,this.selectionStart)+o+p.substring(this.selectionStart)):p.indexOf(")")===p.length-1&&this.selectionEnd===p.length?(l.textContent=p.substring(0,p.length-1)+o+p.substring(p.length-1),this.curEndPos=l.textContent.length-1):p.indexOf(")")!==p.length-1?(l.textContent=p+o,this.curEndPos=l.textContent.length):l.textContent!==p?(l.textContent=p.substring(0,this.curStartPos)+o+p.substring(this.curStartPos),this.curEndPos=this.curStartPos+o.length):this.selectionStart!==this.selectionEnd||-1===this.validCharacters.indexOf(p.substring(this.selectionStart-1,this.selectionEnd))||-1===this.validCharacters.indexOf(p.substring(this.selectionStart,this.selectionEnd+1))&&")"!==p.substring(this.selectionStart,this.selectionEnd+1)||(l.textContent=p.substring(0,this.selectionStart)+o+p.substring(this.selectionEnd),this.curStartPos=this.selectionStart,this.curEndPos=this.selectionStart+o.length,this.formulaBarCurStartPos=this.curStartPos)}}},e.prototype.updateFormulaBarValue=function(){var e=window.getSelection(),t=this.editCellData.value,r=this.parent.getActiveSheet().selectedRange;r=isSingleCell(getIndexesFromAddress(r))?r.split(":")[0]:r;var n=this.parent.element.querySelector(".e-formula-bar");if(t&&checkIsFormula(t,!0)){var i=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));this.parent.getActiveSheet().name!==i&&(r="'"+this.parent.getActiveSheet().name+"'!"+r),ej2Base.isNullOrUndefined(this.formulaBarCurStartPos)?t.indexOf(")")===t.length-1&&e.focusOffset===t.length?n.value=t.substring(0,t.length-1)+r+t.substring(t.length-1):t.indexOf(")")!==t.length-1?n.value=t+r:n.value!==t&&(n.value=t.substring(0,this.curStartPos)+r+t.substring(this.curStartPos)):n.value=t.substring(0,this.formulaBarCurStartPos)+r+t.substring(this.formulaBarCurStartPos),this.curEndPos=this.curStartPos+r.length}},e.prototype.setFormulaBarCurPosition=function(e,t,r){e.setSelectionRange&&(e.focus(),e.selectionStart=t,e.selectionEnd=t,e.setSelectionRange(t,r))},e.prototype.initiateCurPosition=function(e){void 0===e&&(e={isCellEdit:!1});var t=this.getEditElement(this.parent.getActiveSheet(),!0);if(e.isCellEdit){var r=this.getCurPosition();this.endFormulaRef||r.start!==r.end||(this.updateFormulaReference(t),r.end&&-1===this.validCharacters.indexOf(this.editCellData.value[r.end-1])&&(this.endFormulaRef=!0))}else{var n=t.innerText,i=window.getSelection();if(i&&i.focusNode&&i.focusNode.classList&&i.focusNode.classList.contains("e-formula-bar-panel")){var o=this.parent.element.querySelector(".e-formula-bar");this.setFormulaBarCurPosition(o,this.curEndPos,this.curEndPos)}else{if(n){var a=document.createRange();n.indexOf(")"),n.length,a.setStart(t.childNodes[0],this.curEndPos),a.setEnd(t.childNodes[0],this.curEndPos),i.removeAllRanges(),i.addRange(a)}if(this.editCellData.sheetIndex!==this.parent.getActiveSheet().id-1){var s=this.parent.element.querySelector(".e-formula-bar");if(s.value){var l=s.value.length;s.value.indexOf(")")===l-1?this.setFormulaBarCurPosition(s,l-1,l-1):this.setFormulaBarCurPosition(s,l,l)}}}}},e.prototype.getEditElement=function(e,t){if((this.isEdit||t)&&(e.frozenRows||e.frozenColumns)){var r=this.parent.frozenRowCount(e),n=this.parent.frozenColCount(e),i=getCellIndexes(e.activeCell),o=void 0;if(i[0]<r&&i[1]<n)o=this.parent.getSelectAllContent();else if(i[0]<r)o=this.parent.getColumnHeaderContent();else{if(!(i[1]<n))return this.editorElem;o=this.parent.getRowHeaderContent()}var a=o.getElementsByClassName("e-spreadsheet-edit")[0];return!a&&t&&(a=o.appendChild(this.editorElem.cloneNode())),a}return this.editorElem},e.prototype.sheetChangeHandler=function(){this.isEdit||(this.editCellData.value=null)},e}(),Selection=function(){function e(e){this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.uniqueMOperator=String.fromCharCode(135),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueLTOperator=String.fromCharCode(142),this.invalidOperators=["%"],this.formulaRange=[],this.tableRangesFormula={},this.parent=e,this.addEventListener(),this.mouseMoveEvt=this.mouseMoveHandler.bind(this)}return e.prototype.addEventListener=function(){this.parent.on(contentLoaded,this.init,this),this.parent.on(mouseDown,this.mouseDownHandler,this),this.parent.on(virtualContentLoaded,this.virtualContentLoadedHandler,this),this.parent.on(cellNavigate,this.cellNavigateHandler,this),this.parent.on(selectRange,this.selectRange,this),this.parent.on(rowHeightChanged,this.rowHeightChanged,this),this.parent.on(colWidthChanged,this.colWidthChanged,this),this.parent.on(protectSelection,this.protectHandler,this),this.parent.on(initiateFormulaReference,this.initiateFormulaSelection,this),this.parent.on(clearCellRef,this.clearBorder,this),this.parent.on(getRowIdxFromClientY,this.getRowIdxFromClientY,this),this.parent.on(getColIdxFromClientX,this.getColIdxFromClientX,this),this.parent.on(focusBorder,this.chartBorderHandler,this),this.parent.on(selectionStatus,this.isTouchSelectionStarted,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(contentLoaded,this.init),this.parent.off(mouseDown,this.mouseDownHandler),this.parent.off(virtualContentLoaded,this.virtualContentLoadedHandler),this.parent.off(cellNavigate,this.cellNavigateHandler),this.parent.off(selectRange,this.selectRange),this.parent.off(rowHeightChanged,this.rowHeightChanged),this.parent.off(colWidthChanged,this.colWidthChanged),this.parent.off(protectSelection,this.protectHandler),this.parent.off(initiateFormulaReference,this.initiateFormulaSelection),this.parent.off(clearCellRef,this.clearBorder),this.parent.off(getRowIdxFromClientY,this.getRowIdxFromClientY),this.parent.off(getColIdxFromClientX,this.getColIdxFromClientX),this.parent.off(focusBorder,this.chartBorderHandler),this.parent.off(selectionStatus,this.isTouchSelectionStarted))},e.prototype.isTouchSelectionStarted=function(e){e.touchSelectionStarted=this.touchSelectionStarted},e.prototype.rowHeightChanged=function(e){var t=this;e.threshold&&getUpdateUsingRaf(function(){var r=t.getActiveCell(),n=t.parent.getActiveSheet();if(r){var i=getCellIndexes(n.activeCell);if(n.frozenRows||n.frozenColumns){var o={range:[i[0],i[1],i[0],i[1]]};t.parent.notify(activeCellMergedRange,o),setPosition(t.parent,r,o.range,"e-active-cell")}else i[0]===e.rowIdx?r.style.height=parseFloat(r.style.height)+e.threshold+"px":i[0]>e.rowIdx&&(r.style.top=parseFloat(r.style.top)+e.threshold+"px")}if(r=t.getSelectionElement()){var a=getRangeIndexes(n.selectedRange),s=getSwapRange(a),l={range:s,isActiveCell:!1,skipChecking:!0};if(t.parent.notify(mergedRange,l),l.isActiveCell||s[0]===s[2]&&s[1]===s[3])return;if(n.frozenRows||n.frozenColumns)return void setPosition(t.parent,r,a);var d=s[0],p=s[2];d<=e.rowIdx&&p>=e.rowIdx&&r?r.style.height=parseFloat(r.style.height)+e.threshold+"px":d>e.rowIdx&&r&&(r.style.top=parseFloat(r.style.top)+e.threshold+"px")}})},e.prototype.colWidthChanged=function(e){var t=this;e.threshold&&getUpdateUsingRaf(function(){var r=t.parent.getActiveSheet(),n=t.getActiveCell();if(n){var i=getCellIndexes(t.parent.getActiveSheet().activeCell);if(r.frozenRows||r.frozenColumns){var o={range:[i[0],i[1],i[0],i[1]]};t.parent.notify(activeCellMergedRange,o),setPosition(t.parent,n,o.range,"e-active-cell")}else i[1]===e.colIdx?n.style.width=parseFloat(n.style.width)+e.threshold+"px":i[1]>e.colIdx&&(n.style.left=parseFloat(n.style.left)+e.threshold+"px")}n=t.getSelectionElement();var a=getRangeIndexes(t.parent.getActiveSheet().selectedRange),s=getSwapRange(a),l={range:s,isActiveCell:!1,skipChecking:!0};if(t.parent.notify(mergedRange,l),!(l.isActiveCell||s[0]===s[2]&&s[1]===s[3]))if(r.frozenRows||r.frozenColumns)setPosition(t.parent,n,a);else{var d=s[1],p=s[3];d<=e.colIdx&&p>=e.colIdx&&n?n.style.width=parseFloat(n.style.width)+e.threshold+"px":d>e.colIdx&&n&&(n.style.left=parseFloat(n.style.left)+e.threshold+"px")}})},e.prototype.selectRange=function(e){e.address="Single"===this.parent.selectionSettings.mode?getRangeAddress(getCellIndexes(e.address)):e.address,this.selectMultiRange(e.address,null,null,e.skipChecking)},e.prototype.init=function(){this.createSelectionElement();var e=this.parent.getActiveSheet(),t=getSwapRange(getRangeIndexes(e.selectedRange)),r=getCellIndexes(e.activeCell),n=t[0]<=r[0]&&t[2]>=r[0]&&t[1]<=r[1]&&t[3]>=r[1];this.selectMultiRange(e.selectedRange,!0,n)},e.prototype.selectMultiRange=function(e,t,r,n){var i=this,o=this.parent.activeSheetIndex;e.indexOf("!")>-1&&(o=getSheetIndex(this.parent,getSheetNameFromAddress(e)),e=e.split("!")[1]),this.parent.activeSheetIndex===o?e.split(" ").forEach(function(e,o){i.selectRangeByIdx(getRangeIndexes(e),{type:"mousedown",ctrlKey:0!==o},null,r,t,n)}):updateSelectedRange(this.parent,e,this.parent.sheets[o])},e.prototype.createSelectionElement=function(){var e=this.parent.getMainContent(),t=this.parent.createElement("div",{className:"e-selection"});e.appendChild(t),t=this.parent.createElement("div",{className:"e-active-cell"}),e.appendChild(t)},e.prototype.mouseDownHandler=function(e){if(!(ej2Base.closest(e.target,".e-scrollbar")||e.target.classList.contains("e-main-panel")||e.target.classList.contains("e-sheet"))){var t={action:"getCurrentEditValue",editedValue:""};this.parent.notify(editOperation,t);var r=checkIsFormula(t.editedValue,!0);if(!this.parent.isEdit||r){var n=document.getElementById(this.parent.element.id+"_overlay");if("string"==typeof e.target.className){if(e.target.className.indexOf("e-ss-overlay")>-1)return}else n&&n.classList.remove("e-ss-overlay-active");if(ej2Base.closest(e.target,".e-datavisualization-chart"))return;if(this.parent.getActiveSheet().isProtected&&!this.parent.getActiveSheet().protectSettings.selectCells)return;if(!ej2Base.closest(e.target,".e-findtool-dlg")&&this.getSheetElement().contains(e.target)&&!e.target.classList.contains("e-colresize")&&!e.target.classList.contains("e-rowresize")){var i=this.parent.getActiveSheet(),o=this.parent.selectionSettings.mode,a=this.getRowIdxFromClientY({clientY:getClientY(e),target:e.target}),s=this.getColIdxFromClientX({clientX:getClientX(e),target:e.target}),l=getCellIndexes(i.activeCell),d=void 0,p=void 0;if(i.showHeaders){var h=e.target;if(i.frozenColumns||i.frozenRows){var c=this.parent.getSelectAllContent().querySelector("thead");p=c?(this.parent.getColumnHeaderContent().contains(h)||c.contains(h))&&h.classList.contains("e-header-cell"):this.parent.getColumnHeaderContent().contains(h)&&h.classList.contains("e-header-cell"),d=(c=this.parent.getSelectAllContent().querySelector("tbody"))?(this.parent.getRowHeaderContent().contains(h)||c.contains(h))&&h.classList.contains("e-header-cell"):this.parent.getRowHeaderContent().contains(h)&&h.classList.contains("e-header-cell")}else d=this.parent.getRowHeaderContent().contains(e.target),p=this.parent.getColumnHeaderContent().contains(e.target)}if(3===e.which&&this.isSelected(a,s))return;if(e.target.classList.contains("e-autofill")){if(this.parent.element.querySelector(".e-dragfill-ddb:not(.e-hide)"))return;this.isautoFillClicked=!0,this.dAutoFillCell=i.selectedRange}var u=getRangeIndexes(i.topLeftCell),g=void 0;d?(this.isRowSelected=!0,e.shiftKey&&"Single"!==o||(this.startCell=[a,0]),g=[this.startCell[0],i.frozenColumns?u[1]:0,a,i.colCount-1]):p?(this.isColSelected=!0,e.shiftKey&&"Single"!==o||(this.startCell=[0,s]),g=[i.frozenRows?u[0]:0,this.startCell[1],i.rowCount-1,s]):ej2Base.closest(e.target,".e-select-all-cell")?(this.startCell=[i.frozenRows?u[0]:0,i.frozenColumns?u[1]:0],g=[].concat(this.startCell,[i.rowCount-1,i.colCount-1])):e.target.classList.contains("e-sheet-content")||(e.shiftKey&&"Single"!==o||(this.startCell=[a,s]),this.isautoFillClicked||ej2Base.closest(e.target,".e-filloption")||(g=[].concat(this.startCell?this.startCell:getCellIndexes(i.activeCell),[a,s])));var f=e.ctrlKey&&g&&i.selectedRange.includes(getRangeAddress(g));if(!f&&"Multiple"===o&&(!isTouchEnd(e)&&(!isTouchStart(e)||isTouchStart(e)&&l[0]===a&&l[1]===s)||p||d)?(document.addEventListener(getMoveEvent().split(" ")[0],this.mouseMoveEvt),ej2Base.Browser.isPointer||document.addEventListener(getMoveEvent().split(" ")[1],this.mouseMoveEvt,{passive:!1}),this.touchSelectionStarted=!0):this.touchSelectionStarted=!1,f||isTouchEnd(e)||ej2Base.EventHandler.add(document,getEndEvent(),this.mouseUpHandler,this),isTouchStart(e)&&!p&&!d)return void(this.touchEvt=e);g&&this.selectRangeByIdx(g,e),this.parent.isMobileView()&&(this.parent.element.classList.add("e-mobile-focused"),this.parent.renderModule.setSheetPanelSize())}}if(r&&(e.target.classList.contains("e-cell")||e.target.classList.contains("e-header-cell"))&&this.parent.isEdit){g=isSingleCell(getIndexesFromAddress(g=this.parent.getActiveSheet().selectedRange))?g.split(":")[0]:g,this.parent.notify(addressHandle,{range:g,isSelect:!1})}}},e.prototype.mouseMoveHandler=function(e){var t=this,r=this.parent.getActiveSheet();isTouchMove(e)&&e.preventDefault();var n={action:"getCurrentEditValue",editedValue:""};this.parent.notify(editOperation,n);var i,o=checkIsFormula(n.editedValue,!0),a=this.parent.getMainContent().parentElement,s=this.parent.element.getElementsByClassName("e-scroller")[0],l=a.getBoundingClientRect(),d=this.parent.frozenColCount(r),p=l.left+this.parent.sheetModule.getRowHeaderWidth(r),h=l.top,c=l.right,u=l.bottom,g=getClientX(e),f=getClientY(e),m=this.isRowSelected?r.colCount-1:this.getColIdxFromClientX({clientX:Math.min(g,c),target:e.target}),v=this.isColSelected?r.rowCount-1:this.getRowIdxFromClientY({clientY:Math.min(f,u),target:e.target});if(e.ctrlKey){var C=r.selectedRange.split(" ");i=getRangeIndexes(C[C.length-1])}else i=getRangeIndexes(r.selectedRange);var y={range:[v,m,v,m]};if(this.parent.notify(activeCellMergedRange,y),y.range[2]!==i[2]||y.range[3]!==i[3]){var x=this.parent.frozenRowCount(r),b=f>u&&v<r.rowCount,S=f<h&&v>=0&&!this.isColSelected&&!!a.scrollTop,w=g>c&&m<r.colCount,I=g<p&&m>=0&&!this.isRowSelected&&!!s.scrollLeft;this.clearInterval();var R,E;if(o||this.isColSelected||this.isRowSelected||(i=getCellIndexes(r.activeCell)),b||S||w||I)(S||I)&&(R=v,E=m),this.scrollInterval=setInterval(function(){if((b||S)&&!t.isColSelected){if((v=t.getRowIdxFromClientY({clientY:b?u:h}))>=r.rowCount)return void t.clearInterval();a.scrollTop+=(b?1:-1)*getRowHeight(r,v)}if((w||I)&&!t.isRowSelected){if((m=t.getColIdxFromClientX({clientX:w?c:p}))>=r.colCount)return void t.clearInterval();s.scrollLeft+=(w?1:-1)*getColumnWidth(r,m)}if(S&&!a.scrollTop||I&&!s.scrollLeft)return t.selectRangeByIdx([].concat(i[0],i[1],[R,E]),e),void t.clearInterval();t.selectRangeByIdx([].concat(i[0],i[1],[v,m]),e)},100);else{var k=[].concat(i[0],i[1],[v,m]);if(x&&k[0]<x&&k[2]>=x&&a.scrollTop&&(a.scrollTop=0,k[2]=x),d&&k[1]<d&&k[3]>=d&&s.scrollLeft&&(s.scrollLeft=0,k[3]=d),this.isautoFillClicked){var F={e:e,indexes:null};this.parent.notify(selectAutoFillRange,F),k=F.indexes}this.selectRangeByIdx(k,e)}if(o&&this.parent.isEdit&&!ej2Base.closest(e.target,"#"+this.parent.element.id+"_edit")){var A=this.parent.getActiveSheet().selectedRange;this.parent.notify(addressHandle,{range:A,isSelect:!1})}}},e.prototype.mouseUpHandler=function(e){var t=this.getRowIdxFromClientY({clientY:getClientY(e),target:e.target}),r=this.getColIdxFromClientX({clientX:getClientX(e),target:e.target});if(this.clearInterval(),!isTouchEnd(e)||this.isColSelected||this.isRowSelected||this.getRowIdxFromClientY({clientY:getClientY(this.touchEvt),target:e.target})!==t||this.getColIdxFromClientX({clientX:getClientX(this.touchEvt),target:e.target})!==r||this.mouseDownHandler(e),document.removeEventListener(getMoveEvent().split(" ")[0],this.mouseMoveEvt),ej2Base.Browser.isPointer||document.removeEventListener(getMoveEvent().split(" ")[1],this.mouseMoveEvt),ej2Base.EventHandler.remove(document,getEndEvent(),this.mouseUpHandler),this.parent.notify(mouseUpAfterSelection,e),this.isautoFillClicked){var n=getRangeIndexes(this.parent.getActiveSheet().selectedRange);this.isColSelected&&n[1]===r||this.isRowSelected&&n[0]===t||this.parent.notify(performAutoFill,{event:e,dAutoFillCell:this.dAutoFillCell}),this.isautoFillClicked=!1}else e.ctrlKey||isDiscontinuousRange(getSelectedRange(this.parent.getActiveSheet()))?this.parent.notify(hideAutoFillElement,null):this.parent.notify(positionAutoFillElement,null);var i={action:"getCurrentEditValue",editedValue:""};this.parent.notify(editOperation,i);(checkIsFormula(i.editedValue)||i.editedValue&&0===i.editedValue.toString().indexOf("="))&&this.parent.isEdit&&this.parent.notify(initiateCur,{isCellEdit:e.target.classList.contains("e-spreadsheet-edit")})},e.prototype.isSelected=function(e,t){for(var r,n=!1,i=this.parent.getActiveSheet().selectedRange.split(" "),o=0;o<i.length;o++)if((r=getSwapRange(getRangeIndexes(i[o])))[0]<=e&&e<=r[2]&&r[1]<=t&&t<=r[3]){n=!0;break}return n},e.prototype.virtualContentLoadedHandler=function(e){var t,r,n=this,i=this.parent.getActiveSheet(),o=getRangeIndexes(i.selectedRange);i.selectedRange.split(" ").forEach(function(a,s){o=getRangeIndexes(a),r=0===o[1]&&o[3]===e.prevRowColCnt.colCount-1,(t=0===o[0]&&o[2]===e.prevRowColCnt.rowCount-1)&&r?n.selectRangeByIdx([0,0,i.rowCount-1,i.colCount-1],null,!0,null,null,null,s):t?n.selectRangeByIdx([0,o[1],i.rowCount-1,o[3]],null,!0,null,null,null,s):r?n.selectRangeByIdx([o[0],0,o[2],i.colCount-1],null,!0,null,null,null,s):(o=getRangeIndexes(a),n.highlightHdr(o,0!==s,o[0]>=n.parent.viewport.topIndex||o[2]>=n.parent.viewport.topIndex,o[1]>=n.parent.viewport.leftIndex||o[3]>=n.parent.viewport.leftIndex))})},e.prototype.clearInterval=function(){clearInterval(this.scrollInterval),this.scrollInterval=null},e.prototype.getScrollLeft=function(){return this.parent.scrollModule?this.parent.scrollModule.prevScroll.scrollLeft:0},e.prototype.cellNavigateHandler=function(e){var t=this.parent.getActiveSheet();t.isProtected&&!t.protectSettings.selectCells||this.selectRangeByIdx(e.range.concat(e.range),void 0,!1,!1,!1,!1,void 0,e.preventAnimation)},e.prototype.getColIdxFromClientX=function(e){var t=0,r=this.parent.getActiveSheet(),n=0;if(e.isImage)n=e.clientX;else{var i=document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect();n=this.parent.enableRtl?i.right-this.parent.sheetModule.getRowHeaderWidth(r,!0)-1-e.clientX:e.clientX-(i.left+this.parent.sheetModule.getRowHeaderWidth(r,!0)+1),n+=this.parent.viewport.beforeFreezeWidth,e.target&&(ej2Base.closest(e.target,".e-row-header")||ej2Base.closest(e.target,".e-selectall-container"))&&!this.isScrollableArea(e.clientX,e.target,!0)||(n+=this.getScrollLeft())}for(var o=0;;o++)if(t+=getColumnWidth(r,o,null,!0),n<t||this.parent.scrollSettings.isFinite&&o===r.colCount-1)return e.isImage||(e.size=n),e.clientX=o,o},e.prototype.isScrollableArea=function(e,t,r){return!!t.classList.contains("e-table")&&(r?e>this.parent.getMainContent().getBoundingClientRect().left:e>this.parent.getMainContent().parentElement.getBoundingClientRect().top)},e.prototype.getRowIdxFromClientY=function(e){var t=0,r=this.parent.getActiveSheet(),n=0;if(e.isImage)n=e.clientY;else{var i=document.getElementById(this.parent.element.id+"_sheet");n=e.clientY+this.parent.viewport.beforeFreezeHeight-(i.getBoundingClientRect().top+(r.showHeaders?31:0)),e.target&&ej2Base.closest(e.target,".e-header-panel")&&!this.isScrollableArea(e.clientY,e.target)||(n+=this.parent.getMainContent().parentElement.scrollTop)}for(var o=0;;o++)if(t+=getRowHeight(r,o,!0),n<t||this.parent.scrollSettings.isFinite&&o===r.rowCount-1)return e.isImage||(e.size=n),e.clientY=o,o},e.prototype.initFormulaReferenceIndicator=function(e){if(this.parent.isEdit){var t=this.parent.createElement("div",{className:"e-formularef-indicator"});t.appendChild(this.parent.createElement("div",{className:"e-top"})),t.appendChild(this.parent.createElement("div",{className:"e-bottom"})),t.appendChild(this.parent.createElement("div",{className:"e-left"})),t.appendChild(this.parent.createElement("div",{className:"e-right"})),this.parent.getMainContent().appendChild(t),setPosition(this.parent,t,e,"e-formularef-indicator")}},e.prototype.selectRangeByIdx=function(e,t,r,n,i,o,a,s){var l=this;if(!(t&&t.target&&ej2Base.closest(t.target,"#"+this.parent.element.id+"_edit"))){var d={action:"getCurrentEditValue",editedValue:"",endFormulaRef:!1};this.parent.notify(editOperation,d);var p,h=checkIsFormula(d.editedValue,!0)&&!d.endFormulaRef,c=t&&t.ctrlKey&&isMouseDown(t);c||(p=this.getSelectionElement(t,a));var u,g=this.parent.getActiveSheet(),f=this.parent.element.querySelector(".e-formularef-indicator"),m={range:[].slice.call(e),isActiveCell:!1,skipChecking:o},v=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");this.isColSelected||this.isRowSelected||this.parent.notify(mergedRange,m),e!==m.range&&(u=!0),e=m.range;var C=new Promise(function(e){e(void 0)}),y={range:getRangeAddress(e),cancel:!1};if(this.parent.trigger("beforeSelect",y),!y.cancel){if(h&&f&&f.parentElement.removeChild(f),this.parent.notify(hideAutoFillOptions,null),!isSingleCell(e)&&!m.isActiveCell||c){if(c)if(void 0===a){var x=getRangeAddress(e);if(g.selectedRange.includes(x)){return(I=g.selectedRange.split(" ")).length>1?(I.splice(I.indexOf(x),1),x=I.join(" ")):x=g.activeCell+":"+g.activeCell,void this.selectRange({address:x})}p=this.getSelectionElement(t,a)}else p=this.getSelectionElement(t,a);if(h&&this.parent.isEdit)t&&t.target&&!t.target.classList.contains("e-spreadsheet-edit")&&this.parent.isEdit&&(this.parent.notify(addressHandle,{range:getRangeAddress(e),isSelect:!0}),this.initFormulaReferenceIndicator(e));else{p&&p.classList.remove("e-hide");var b=this.isColSelected&&this.isRowSelected?void 0:this.getOffset(e[2],e[3]);u&&b&&(b.left={idx:0,size:0}),C=setPosition(this.parent,p,e,void 0)||C}}else p&&(p.classList.contains("e-multi-range")||p.classList.add("e-hide"),(g.frozenRows||g.frozenColumns)&&(removeRangeEle(this.parent.getSelectAllContent(),null,"e-selection"),removeRangeEle(this.parent.getColumnHeaderContent(),null,"e-selection"),removeRangeEle(this.parent.getRowHeaderContent(),null,"e-selection"))),g.frozenColumns||g.frozenRows||!p||setPosition(this.parent,p,e),h&&t&&t.target&&!t.target.classList.contains("e-spreadsheet-edit")&&this.parent.isEdit&&(this.parent.notify(addressHandle,{range:getRangeAddress(e).split(":")[0],isSelect:!0}),this.initFormulaReferenceIndicator(e));var S={action:"getCurrentEditSheetIdx",sheetIndex:null};this.parent.notify(editOperation,S);var w=getRangeAddress(e);if(t&&t.ctrlKey&&(isMouseMove(t)||isMouseUp(t)))w=g.selectedRange.slice(0,g.selectedRange.lastIndexOf(" "))+" "+w;else if(a>-1){var I;(I=g.selectedRange.split(" "))[a]=w,w=I.join(" ")}if(h||this.isautoFillClicked)i||this.isautoFillClicked||updateSelectedRange(this.parent,w,g,c);else{var R=!1;g.selectedRange!==w&&(R=!0),updateSelectedRange(this.parent,w,g,c),R&&C.then(function(){l.parent.trigger("select",{range:l.parent.getActiveSheet().selectedRange})})}this.UpdateRowColSelected(e),this.highlightHdr(e,t&&t.ctrlKey),r||t&&("mousemove"===t.type||isTouchMove(t))||(h?S.sheetIndex===this.parent.getActiveSheet().id-1&&i?(n=!0,this.updateActiveCell(n?getRangeIndexes(g.activeCell):e,i,s)):this.parent.isEdit||this.updateActiveCell(n?getRangeIndexes(g.activeCell):e,i,s):this.updateActiveCell(n?getRangeIndexes(g.activeCell):e,i,s)),ej2Base.isNullOrUndefined(t)&&(t={type:"mousedown"}),h?i||this.parent.notify(selectionComplete,t):this.parent.notify(selectionComplete,t),c||isDiscontinuousRange(getSelectedRange(this.parent.getActiveSheet()))?this.parent.notify(hideAutoFillElement,null):this.parent.notify(positionAutoFillElement,{preventAnimation:s}),this.parent.showAggregate&&this.parent.notify(showAggregate,{}),this.parent.notify(refreshImgElem,{}),v&&this.parent.notify(removeDesignChart,{}),this.parent.notify(clearChartBorder,{})}}},e.prototype.UpdateRowColSelected=function(e){var t=this.parent.getActiveSheet();this.isRowSelected=0===e[1]&&e[3]===t.colCount-1,this.isColSelected=0===e[0]&&e[2]===t.rowCount-1},e.prototype.updateActiveCell=function(e,t,r){var n,i,o,a=this.parent.getActiveSheet(),s=getRangeIndexes(a.topLeftCell);this.isColSelected?(n=s[0],i=e[1],this.isRowSelected&&(i=s[1])):(n=e[0],i=e[1],this.isRowSelected&&(i=s[1]));var l={range:[n,i].concat([n,i])};if(this.parent.notify(activeCellMergedRange,l),e!==l.range&&(o=!0),e=l.range,a.activeCell!==getCellAddress(e[0],e[1])||t){if(this.parent.setSheetPropertyOnMute(a,"activeCell",getCellAddress(e[0],e[1])),a.isProtected){var d=this.parent.element.querySelector(".e-formula-bar"),p=isLocked(getCell(e[0],e[1],a),getColumn(a,e[1]));p&&d&&!d.disabled?d.disabled=!0:!p&&d&&d.disabled&&(d.disabled=!1)}if(this.getActiveCell()){var h=this.getOffset(e[2],e[3]);o&&(h.left={idx:0,size:0}),setPosition(this.parent,this.getActiveCell(),e,"e-active-cell",r)}this.parent.notify(activeCellChanged,null)}else setPosition(this.parent,this.getActiveCell(),e,"e-active-cell",r)},e.prototype.getOffset=function(e,t){var r={left:{idx:0,size:0},top:{idx:0,size:0}};return this.parent.scrollModule&&(t>=this.parent.scrollModule.offset.left.idx&&(r.left=this.parent.scrollModule.offset.left),e>=this.parent.scrollModule.offset.top.idx&&(r.top=this.parent.scrollModule.offset.top)),r},e.prototype.getSelectionElement=function(e,t){if(e&&e.ctrlKey){if(isMouseUp(e)||isMouseMove(e))return this.parent.getMainContent().querySelector(".e-selection:last-child");var r=this.parent.getMainContent().getElementsByClassName("e-selection")[0];r.classList.remove("e-hide");var n=r.cloneNode();return n.classList.add("e-multi-range"),this.parent.getMainContent().appendChild(n)}if(t>-1)return this.parent.getMainContent().getElementsByClassName("e-selection")[t];return[].slice.call(this.parent.element.getElementsByClassName("e-multi-range")).forEach(function(e){ej2Base.remove(e)}),this.parent.getMainContent().getElementsByClassName("e-selection")[0]},e.prototype.getActiveCell=function(){return this.parent.getMainContent().getElementsByClassName("e-active-cell")[0]},e.prototype.getSheetElement=function(){return document.getElementById(this.parent.element.id+"_sheet")},e.prototype.highlightHdr=function(e,t,r,n){if(void 0===r&&(r=!0),void 0===n&&(n=!0),this.parent.getActiveSheet().showHeaders){var i=this.parent.getActiveSheet(),o=[],a=[],s=getSwapRange(e);s=this.getHdrIndexes(s);var l=this.parent.element.getElementsByClassName("e-select-all-cell")[0];if(t||(ej2Base.removeClass(this.getSheetElement().querySelectorAll(".e-highlight"),"e-highlight"),ej2Base.removeClass(this.getSheetElement().querySelectorAll(".e-prev-highlight"),"e-prev-highlight")),l&&ej2Base.removeClass([l],["e-prev-highlight-right","e-prev-highlight-bottom"]),r){var d,p=this.parent.frozenRowCount(i),h=void 0;(m=this.parent.getSelectAllContent().querySelector("tbody"))&&(d=[].slice.call(m.querySelectorAll(".e-header-cell")));for(var c=[].slice.call(this.parent.getRowHeaderContent().querySelectorAll(".e-header-cell")),u=getCellIndexes(i.topLeftCell)[0],g=s[0];g<s[2]+1;g++)(h=g<p?d[g-u]:c[g-p])&&o.push(h)}if(n){var f,m,v=this.parent.frozenColCount(i);h=void 0;(m=this.parent.getSelectAllContent().querySelector("thead"))&&(f=[].slice.call(m.querySelectorAll(".e-header-cell")));c=[].slice.call(this.parent.getColumnHeaderContent().querySelectorAll("th"));var C=getCellIndexes(i.topLeftCell)[1];for(g=s[1];g<s[3]+1;g++)(h=g<v?f[g-C]:c[g-v])&&a.push(h)}i.isProtected&&!i.protectSettings.selectCells?ej2Base.removeClass([].concat(o,a),"e-highlight"):ej2Base.addClass([].concat(o,a),"e-highlight"),o.length&&o[0].parentElement.previousElementSibling&&o[0].parentElement.previousElementSibling.classList.add("e-prev-highlight"),a.length&&a[0].previousElementSibling&&a[0].previousElementSibling.classList.add("e-prev-highlight"),this.isRowSelected&&this.isColSelected&&(i.isProtected&&!i.protectSettings.selectCells?document.getElementById(this.parent.element.id+"_select_all").classList.remove("e-highlight"):document.getElementById(this.parent.element.id+"_select_all").classList.add("e-highlight")),l&&(0===s[0]&&l.classList.add("e-prev-highlight-bottom"),0===s[1]&&l.classList.add("e-prev-highlight-right"))}},e.prototype.protectHandler=function(){var e=getRangeIndexes(this.parent.getActiveSheet().selectedRange),t=getSwapRange(e),r=getCellIndexes(this.parent.getActiveSheet().activeCell),n=t[0]<=r[0]&&t[2]>=r[0]&&t[1]<=r[1]&&t[3]>=r[1];this.selectRangeByIdx(e,null,null,n)},e.prototype.getHdrIndexes=function(e){if(this.parent.scrollSettings.enableVirtualization){var t=[],r=this.parent.hiddenCount(this.parent.viewport.topIndex,e[0]),n=this.parent.hiddenCount(this.parent.viewport.leftIndex,e[1],"columns");return t[0]=this.isColSelected?e[0]:e[0]-this.parent.viewport.topIndex<0?0:e[0]-r-this.parent.viewport.topIndex,t[1]=this.isRowSelected?e[1]:e[1]-this.parent.viewport.leftIndex<0?0:e[1]-n-this.parent.viewport.leftIndex,t[2]=this.isColSelected?this.parent.viewport.rowCount+2*this.parent.getThreshold("row"):e[2]-this.parent.hiddenCount(e[0],e[2])-r-this.parent.viewport.topIndex,t[3]=this.isRowSelected?this.parent.viewport.colCount+2*this.parent.getThreshold("col"):e[3]-this.parent.hiddenCount(e[1],e[3],"columns")-n-this.parent.viewport.leftIndex,t}return e},e.prototype.initiateFormulaSelection=function(e){this.processFormulaEditRange(e.range,e.formulaSheetIdx)},e.prototype.processFormulaEditRange=function(e,t){var r,n=t,i=0,o=this.parseFormula(e),a=o.length,s=0,l=[["e-vborderright","e-vborderbottom"],["e-pborderright","e-pborderbottom"],["e-cborderright","e-cborderbottom"],["e-gborderright","e-gborderbottom"],["e-oborderright","e-oborderbottom"],["e-bborderright","e-bborderbottom"]];this.clearBorder();for(var d=this.parent.getActiveSheet().id-1;i<a&&(r=o[i],!(this.invalidOperators.indexOf(r)>-1));){if(isCellReference(r.toUpperCase())){if(r=r.replace(/\$/g,""),i>0&&o[i-1].indexOf("!")===o[i-1].length-1){var p=o[i-1].split("!");n=getSheetIndex(this.parent,p[0].substring(1,p[0].length-1))}":"===o[i+1]&&o[++i+1]&&isCellReference(o[i+1].toUpperCase())&&(r=r+":"+o[i+1],i++),d===n&&this.updateFormulaEditRange(r,s,l),n=t,s++}i++}},e.prototype.updateFormulaEditRange=function(e,t,r){var n=getRangeIndexes(e);this.formulaRange[t]=e,this.dStartCell={rowIndex:n[0],colIndex:n[1]},this.dEndCell={rowIndex:n[2],colIndex:n[3]},this.focusBorder(this.dStartCell,this.dEndCell,r[t%6])},e.prototype.chartBorderHandler=function(e){this.focusBorder(e.startcell,e.endcell,e.classes,!0)},e.prototype.focusBorder=function(e,t,r,n){n=!ej2Base.isNullOrUndefined(n)&&n;var i=getSwapRange([e.rowIndex,e.colIndex,t.rowIndex,t.colIndex]),o=this.parent.getActiveSheet();if(o.frozenRows||o.frozenColumns){var a=this.parent.createElement("div",{className:n?"e-range-indicator e-chart-range":"e-range-indicator e-formuala-range"});return a.appendChild(this.parent.createElement("div",{className:"e-top"})),a.appendChild(this.parent.createElement("div",{className:"e-bottom"})),a.appendChild(this.parent.createElement("div",{className:"e-left"})),a.appendChild(this.parent.createElement("div",{className:"e-right"})),void setPosition(this.parent,a,i,"e-range-indicator")}var s=i[0],l=i[1],d=i[2],p=i[3];s&&this.getEleFromRange([s-1,l,s-1,p]).forEach(function(e){e&&(e.classList.add(r[1]),n||e.classList.add("e-formularef-selection"))}),this.getEleFromRange([s,p,d,p]).forEach(function(e){e&&(e.classList.add(r[0]),n||e.classList.add("e-formularef-selection"))}),this.getEleFromRange([d,l,d,p]).forEach(function(e){e&&(e.classList.add(r[1]),n||e.classList.add("e-formularef-selection"))}),l&&this.getEleFromRange([s,l-1,d,l-1]).forEach(function(e){e&&(e.classList.add(r[0]),n||e.classList.add("e-formularef-selection"))})},e.prototype.getEleFromRange=function(e){var t,r,n,i,o=e[0],a=e[1],s=e[2],l=e[3],d=[],p=[];if(o>s&&(n=o,o=s,s=n),a>l&&(n=a,a=l,l=n),this.parent.scrollSettings.enableVirtualization)for(t=o;t<=s;t++)if((r=t)>-1){var h=this.parent.getRow(r,null);h&&(i=h.getElementsByClassName("e-cell"),d=l===a?[i[l]]:this.getRowCells(i,a,l+1),this.merge(p,d))}return p},e.prototype.getRowCells=function(e,t,r){for(var n=[];t<r;t++)e[t]&&n.push(e[t]);return n},e.prototype.merge=function(e,t){e&&t&&Array.prototype.push.apply(e,t)},e.prototype.clearBorder=function(){var e=this.parent.getActiveSheet();if(e.frozenColumns||e.frozenRows){[].slice.call(this.parent.element.getElementsByClassName("e-formuala-range")).forEach(function(e){ej2Base.detach(e)})}else for(var t=this.parent.element.getElementsByClassName("e-formularef-selection"),r=0;r<t.length;r++)for(var n=t[r],i=["e-vborderright","e-vborderbottom","e-pborderright","e-pborderbottom","e-cborderright","e-cborderbottom","e-gborderright","e-gborderbottom","e-oborderright","e-oborderbottom","e-bborderright","e-bborderbottom"],o=0;o<i.length;o++)n.classList.remove(i[o])},e.prototype.parseFormula=function(e){for(var t,r,n=0,i=[],o=(e=this.markSpecialChar(e.replace("=",""))).split(/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g),a=o.length;n<a;)if(t=o[n]){if(1===t.length)i.push(this.isUniqueChar(t)?this.getUniqueCharVal(t):t);else if(r=t[0],t.indexOf("!")>0){this.isUniqueChar(r)&&(i.push(this.getUniqueCharVal(r)),t=t.substr(1));var s=t.indexOf("!")+1;i.push(t.substr(0,s)),i.push(t.substr(s))}else this.isUniqueChar(r)?(i.push(this.getUniqueCharVal(r)),i.push(t.substr(1))):i.push(t);n++}else n++;return i},e.prototype.isUniqueChar=function(e){var t=e.charCodeAt(e.charAt[0]);return t>=129&&t<=142},e.prototype.getUniqueCharVal=function(e){switch(e){case this.uniqueOBracket:return"(";case this.uniqueCBracket:return")";case this.uniqueCOperator:return":";case this.uniqueSOperator:return"-";case this.uniquePOperator:return"+";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueModOperator:return"%";case this.uniqueCSeparator:return",";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueLTOperator:return"<";case this.uniqueGTOperator:return">"}return""},e.prototype.markSpecialChar=function(e){return e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket),e=e.replace(/,/g,","+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator),e=e.replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator),e=e.replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator),e=e.replace(/&/g,"&"+this.uniqueConcateOperator),e=e.replace(/=/g,"="+this.uniqueEqualOperator),e=e.replace(/\^/g,"^"+this.uniqueExpOperator),(e=e.replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)},e.prototype.getModuleName=function(){return"selection"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),Scroll=function(){function e(e){this.clientX=0,this.isKeyScroll=!0,this.parent=e,this.addEventListener(),this.initProps()}return e.prototype.onContentScroll=function(e){var t,r,n=this.parent.getMainContent().parentElement,i=e.scrollLeft,o=e.scrollTop||n.scrollTop,a=i&&this.parent.enableRtl?this.initScrollValue-i:i;if(this.parent.allowAutoFill){var s=document.querySelector("#"+this.parent.element.id+"_autofilloptionbtn-popup"),l=document.querySelector("#"+this.parent.element.id+"_autofilloptionbtn");if(s){ej2Base.getComponent(l,ej2Splitbuttons.DropDownButton).toggle()}}if(!ej2Base.isNullOrUndefined(i)&&this.prevScroll.scrollLeft!==a){var d=a>this.prevScroll.scrollLeft;r=this.offset.left.size,this.offset.left=this.getColOffset(a,d,e.skipHidden),e.preventScroll||(this.parent.getColumnHeaderContent().scrollLeft=i,this.parent.getMainContent().scrollLeft=i,e.scrollLeft=i),t={cur:this.offset.left,prev:{idx:this.leftIndex,size:r},increase:d,preventScroll:e.preventScroll},this.updateTopLeftCell(d),this.parent.notify(onHorizontalScroll,t),this.parent.scrollSettings.enableVirtualization||!d||this.parent.scrollSettings.isFinite||this.updateNonVirtualCols(),this.leftIndex=t.prev.idx,this.prevScroll.scrollLeft=a}if(this.prevScroll.scrollTop!==o){e.skipRowVirualScroll&&(this.prevScroll.scrollTop=0,this.offset.top={idx:0,size:0});var p=o>this.prevScroll.scrollTop;r=this.offset.top.size,this.offset.top=this.getRowOffset(o,p),t={cur:this.offset.top,prev:{idx:this.topIndex,size:r},increase:p,preventScroll:e.preventScroll},this.updateTopLeftCell(p),e.preventScroll&&this.offset.top.idx<=this.parent.getThreshold("row")?this.offset.top={idx:0,size:0}:e.skipRowVirualScroll?t.prev.idx=t.cur.idx:this.parent.notify(onVerticalScroll,t),this.parent.scrollSettings.enableVirtualization||!p||this.parent.scrollSettings.isFinite||this.updateNonVirtualRows(),this.topIndex=t.prev.idx,this.prevScroll.scrollTop=o}var h={isEdit:!1};if(this.parent.notify(isFormulaBarEdit,h),h.isEdit){this.parent.element.querySelector(".e-formula-bar").focus()}this.isKeyScroll=!0},e.prototype.updateScrollValue=function(e){void 0!==e.scrollLeft&&(this.prevScroll.scrollLeft=e.scrollLeft+(this.prevScroll.scrollLeft-this.offset.left.size),this.offset.left.size=e.scrollLeft),void 0!==e.scrollTop&&(this.prevScroll.scrollTop=e.scrollTop+(this.prevScroll.scrollTop-this.offset.top.size),this.offset.top.size=e.scrollTop)},e.prototype.updateNonVirtualRows=function(){var e=this.parent.getActiveSheet(),t=this.parent.getThreshold("row");this.offset.top.idx>e.rowCount-(this.parent.viewport.rowCount+t)&&(this.parent.renderModule.refreshUI({rowIndex:e.rowCount,colIndex:0,direction:"first",refresh:"RowPart"},getCellAddress(e.rowCount,0)+":"+getCellAddress(e.rowCount+t-1,e.colCount-1)),this.parent.setSheetPropertyOnMute(e,"rowCount",e.rowCount+t),this.parent.viewport.bottomIndex=e.rowCount-1)},e.prototype.updateNonVirtualCols=function(){var e=this.parent.getActiveSheet(),t=this.parent.getThreshold("col");this.offset.left.idx>e.colCount-(this.parent.viewport.colCount+t)&&(this.parent.renderModule.refreshUI({rowIndex:0,colIndex:e.colCount,direction:"first",refresh:"ColumnPart"},getCellAddress(0,e.colCount)+":"+getCellAddress(e.rowCount-1,e.colCount+t-1)),this.parent.setSheetPropertyOnMute(e,"colCount",e.colCount+t),this.parent.viewport.rightIndex=e.colCount-1)},e.prototype.updateTopLeftCell=function(e){var t=this.parent.getActiveSheet(),r=this.offset.top.idx,n=this.offset.left.idx;e||(r=skipHiddenIdx(t,r,!0),n=skipHiddenIdx(t,n,!0,"columns")),this.parent.updateTopLeftCell(r,n)},e.prototype.getRowOffset=function(e,t){var r=this.offset.top.size,n=this.parent.getActiveSheet(),i=t?this.offset.top.idx+1:this.offset.top.idx?this.offset.top.idx-1:0,o=this.parent.frozenRowCount(n),a=this.parent.scrollSettings.isFinite?n.rowCount:1/0;for(e=Math.round(e);i<a;)if(t){if(r+=getRowHeight(n,i-1+o,!0),Math.abs(Math.round(r)-e)<=1)return{idx:i,size:r};if(Math.round(r)>e)return{idx:i-1,size:r-getRowHeight(n,i-1+o,!0)};i++}else{if(0===r)return{idx:0,size:0};if((r-=getRowHeight(n,i+o,!0))<0&&(r=0),Math.abs(Math.round(r)-e)<=1)return{idx:i,size:r};if(Math.round(r)<e)return r+=getRowHeight(n,i+o,!0),Math.round(r)>e?{idx:i,size:r-getRowHeight(n,i+o,!0)<0?0:r-getRowHeight(n,i+o,!0)}:{idx:skipHiddenIdx(n,i+1,!0),size:r};i--}return{idx:this.offset.top.idx,size:this.offset.top.size}},e.prototype.getColOffset=function(e,t,r){for(var n=this.offset.left.size,i=this.parent.getActiveSheet(),o=t?this.offset.left.idx+1:this.offset.left.idx?this.offset.left.idx-1:0,a=this.parent.frozenColCount(i),s=this.parent.scrollSettings.isFinite?i.colCount:1/0;o<s;)if(t){if(n+=getColumnWidth(i,o-1+a,r,!0),Math.abs(Math.round(n)-e)<=1)return{idx:o,size:n};if(Math.round(n)>e)return{idx:o-1,size:n-getColumnWidth(i,o-1+a,r,!0)};o++}else{if(0===n)return{idx:0,size:0};if((n-=getColumnWidth(i,o+a,r,!0))<0&&(n=0),Math.abs(Math.round(n)-e)<=1)return{idx:o,size:n};if(Math.round(n)<e)return n+=getColumnWidth(i,o+a,r,!0),Math.round(n)>e?(n-=getColumnWidth(i,o+a,r,!0),{idx:o,size:n<0?0:n}):{idx:skipHiddenIdx(i,o+1,!0,"columns"),size:n};o--}return{idx:this.offset.left.idx,size:this.offset.left.size}},e.prototype.contentLoaded=function(e){if(!this.parent.scrollSettings.enableVirtualization){var t=this.parent.createElement("div",{className:"e-virtualtrack"});this.updateNonVirualScrollWidth({scrollTrack:t}),this.parent.getScrollElement().appendChild(t)}e.left&&(this.parent.getScrollElement().scrollLeft=e.left),this.setScrollEvent(),this.parent.enableRtl&&(this.initScrollValue=this.parent.getScrollElement().scrollLeft)},e.prototype.updateNonVirualScrollWidth=function(e){e.scrollTrack||(e.scrollTrack=this.parent.getScrollElement().getElementsByClassName("e-virtualtrack")[0]),e.scrollTrack.style.width=Math.abs(this.parent.getContentTable().getBoundingClientRect().width)+"px"},e.prototype.onHeaderWheel=function(e){e.preventDefault(),this.parent.getMainContent().parentElement.scrollTop+=e.deltaY,this.parent.getScrollElement().scrollLeft+=e.deltaX},e.prototype.onContentWheel=function(e){0!==e.deltaX&&(e.preventDefault(),this.parent.getScrollElement().scrollLeft+=e.deltaX)},e.prototype.scrollHandler=function(e){this.onContentScroll({scrollLeft:e.target.scrollLeft})},e.prototype.updateScroll=function(e){ej2Base.isNullOrUndefined(e.left)?this.parent.sheetModule.contentPanel.scrollTop=e.top:this.parent.getScrollElement().scrollLeft=e.left},e.prototype.setScrollEvent=function(e){void 0===e&&(e={set:!0}),e.set?(ej2Base.EventHandler.add(this.parent.sheetModule.contentPanel,"scroll",this.onContentScroll,this),ej2Base.EventHandler.add(this.parent.getColumnHeaderContent(),"wheel",this.onHeaderWheel,this),ej2Base.EventHandler.add(this.parent.getSelectAllContent(),"wheel",this.onHeaderWheel,this),ej2Base.EventHandler.add(this.parent.getMainContent(),"wheel",this.onContentWheel,this),ej2Base.EventHandler.add(this.parent.getRowHeaderContent(),"wheel",this.onContentWheel,this),ej2Base.EventHandler.add(this.parent.getScrollElement(),"scroll",this.scrollHandler,this)):(ej2Base.EventHandler.remove(this.parent.sheetModule.contentPanel,"scroll",this.onContentScroll),ej2Base.EventHandler.remove(this.parent.getColumnHeaderContent(),"wheel",this.onHeaderWheel),ej2Base.EventHandler.remove(this.parent.getSelectAllContent(),"wheel",this.onHeaderWheel),ej2Base.EventHandler.remove(this.parent.getMainContent(),"wheel",this.onContentWheel),ej2Base.EventHandler.remove(this.parent.getRowHeaderContent(),"wheel",this.onContentWheel),ej2Base.EventHandler.remove(this.parent.getScrollElement(),"scroll",this.scrollHandler))},e.prototype.initProps=function(){this.topIndex=0,this.leftIndex=0,this.prevScroll={scrollLeft:0,scrollTop:0},this.offset={left:{idx:0,size:0},top:{idx:0,size:0}}},e.prototype.setPadding=function(){this.parent.sheetModule.contentPanel.style.overflowY="scroll";var e=getScrollBarWidth();if(e>0){var t=this.parent.getColumnHeaderContent(),r=this.parent.enableRtl?{margin:"marginLeft",border:"borderLeftWidth"}:{margin:"marginRight",border:"borderRightWidth"};t.parentElement.style[r.margin]=e+"px",t.style[r.border]="1px"}},e.prototype.setClientX=function(e){if("mousedown"!==e.type&&"mouse"!==e.pointerType){var t={touchSelectionStarted:!1};if(this.parent.notify(selectionStatus,t),!t.touchSelectionStarted){this.clientX=this.getPointX(e);var r=document.getElementById(this.parent.element.id+"_sheet");ej2Base.EventHandler.add(r,ej2Base.Browser.isPointer?"pointermove":"touchmove",this.onTouchScroll,this),ej2Base.EventHandler.add(r,ej2Base.Browser.isPointer?"pointerup":"touchend",this.pointerUpHandler,this)}}},e.prototype.getPointX=function(e){return e.touches&&e.touches.length?e.touches[0].clientX:e.clientX},e.prototype.onTouchScroll=function(e){if("mouse"!==e.pointerType){var t=this.getPointX(e),r=this.clientX-t,n=this.parent.element.getElementsByClassName("e-scroller")[0];(r>10||r<-10)&&n.scrollLeft+r>=0&&(e.preventDefault(),this.clientX=t,getUpdateUsingRaf(function(){n.scrollLeft+=r}))}},e.prototype.pointerUpHandler=function(){var e=document.getElementById(this.parent.element.id+"_sheet");ej2Base.EventHandler.remove(e,ej2Base.Browser.isPointer?"pointermove":"touchmove",this.onTouchScroll),ej2Base.EventHandler.remove(e,ej2Base.Browser.isPointer?"pointerup":"touchend",this.pointerUpHandler)},e.prototype.addEventListener=function(){this.parent.on(contentLoaded,this.contentLoaded,this),this.parent.on(onContentScroll,this.onContentScroll,this),this.parent.on(updateScroll,this.updateScroll,this),this.parent.on(deInitProperties,this.initProps,this),this.parent.on(spreadsheetDestroyed,this.destroy,this),this.parent.on(setScrollEvent,this.setScrollEvent,this),this.parent.on(mouseDown,this.setClientX,this),this.parent.on(updateScrollValue,this.updateScrollValue,this),this.parent.scrollSettings.enableVirtualization||(this.parent.on(virtualContentLoaded,this.updateNonVirualScrollWidth,this),this.parent.on(colWidthChanged,this.updateNonVirualScrollWidth,this))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.off(contentLoaded,this.contentLoaded),this.parent.off(onContentScroll,this.onContentScroll),this.parent.off(updateScroll,this.updateScroll),this.parent.off(deInitProperties,this.initProps),this.parent.off(spreadsheetDestroyed,this.destroy),this.parent.off(setScrollEvent,this.setScrollEvent),this.parent.off(mouseDown,this.setClientX),this.parent.off(updateScrollValue,this.updateScrollValue),this.parent.scrollSettings.enableVirtualization||(this.parent.off(virtualContentLoaded,this.updateNonVirualScrollWidth),this.parent.off(colWidthChanged,this.updateNonVirualScrollWidth))},e}(),VirtualScroll=function(){function e(e){this.scroll=[],this.parent=e,this.addEventListener()}return e.prototype.createVirtualElement=function(e){var t=this.parent.getActiveSheet(),r=this.parent.getMainContent();this.content=this.parent.createElement("div",{className:"e-virtualable"}),this.content.appendChild(r.querySelector(".e-table")),r.appendChild(this.content);var n,i=r.appendChild(this.parent.createElement("div",{className:"e-virtualtrack"})),o=0;this.parent.sheets.length>this.scroll.length&&this.initScroll();var a=this.parent.viewport.bottomIndex;t.rowCount>a+1||t.usedRange.rowIndex>a?(!this.parent.scrollSettings.isFinite&&t.rowCount<=t.usedRange.rowIndex&&this.parent.setSheetPropertyOnMute(t,"rowCount",t.usedRange.rowIndex+1),this.setScrollCount(t.rowCount,"row")):(this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(t,"rowCount",a+1),this.scroll[this.parent.activeSheetIndex].rowCount=t.rowCount);var s=this.parent.frozenRowCount(t),l=getCellIndexes(t.topLeftCell);e.top&&(o=e.top,t.frozenRows&&(o+=getRowsHeight(t,l[0],s-1,!0)),s=getCellIndexes(t.paneTopLeftCell)[0]),o+=getRowsHeight(t,s,this.scroll[this.parent.activeSheetIndex].rowCount-1,!0),a=this.parent.viewport.rightIndex;var d=0,p=this.parent.frozenColCount(t);e.left?(d=e.left,p&&(d+=getColumnsWidth(t,l[1],p-1,!0)),s=getCellIndexes(t.paneTopLeftCell)[1]):s=p,t.colCount>a+1||t.usedRange.colIndex>a?(!this.parent.scrollSettings.isFinite&&t.colCount<=t.usedRange.colIndex&&this.parent.setSheetPropertyOnMute(t,"colCount",t.usedRange.colIndex+1),d+=getColumnsWidth(t,s,a,!0),this.setScrollCount(t.colCount,"col"),n=d+getColumnsWidth(t,a+1,this.scroll[this.parent.activeSheetIndex].colCount-1,!0)):(this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(t,"colCount",a+1),d+=getColumnsWidth(t,s,t.colCount-1,!0),this.scroll[this.parent.activeSheetIndex].colCount=t.colCount,n=d),ej2Base.isNullOrUndefined(this.parent.viewport.leftIndex)&&(this.parent.viewport.leftIndex=0),ej2Base.isNullOrUndefined(this.parent.viewport.topIndex)&&(this.parent.viewport.topIndex=0),e.left&&(d=getColumnsWidth(t,this.parent.viewport.leftIndex+p,a,!0)),ej2Base.isNullOrUndefined(this.translateX)&&(this.translateX=0),ej2Base.isNullOrUndefined(this.translateY)&&(this.translateY=0),r=this.parent.getRowHeaderContent(),this.rowHeader=this.content.cloneNode(),this.rowHeader.appendChild(r.querySelector(".e-table")),r.appendChild(this.rowHeader);var h=r.appendChild(i.cloneNode());this.rowHeader.style.transform="translate(0px, "+this.translateY+"px)",r=this.parent.getColumnHeaderContent(),this.colHeader=this.content.cloneNode(),this.colHeader.appendChild(r.querySelector(".e-table")),r.appendChild(this.colHeader);var c=r.appendChild(i.cloneNode());this.colHeader.style.width=d+"px",h.style.height=o+"px",c.style.width=n+"px",this.colHeader.style.transform="translate("+this.translateX+"px, 0px)",this.content.style.transform="translate("+this.translateX+"px, "+this.translateY+"px)",this.content.style.width=d+"px",i.style.height=o+"px",i.style.width=n+"px",this.parent.allowScrolling&&this.parent.getScrollElement().appendChild(c.cloneNode(!0))},e.prototype.initScroll=function(){for(var e=0;e<this.parent.sheets.length;)this.scroll[e]||this.scroll.push({rowCount:0,colCount:0}),e++},e.prototype.setScrollCount=function(e,t){var r=this.parent.activeSheetIndex;this.scroll[r][t+"Count"]&&this.scroll[r][t+"Count"]===e||(this.scroll[r][t+"Count"]=e)},e.prototype.getRowAddress=function(e){var t=this.parent.getActiveSheet();return getRangeAddress([e[0],t.frozenColumns?getCellIndexes(t.topLeftCell)[1]:this.parent.viewport.leftIndex,e[1],this.parent.viewport.rightIndex])},e.prototype.getColAddress=function(e){var t=this.parent.getActiveSheet();return getRangeAddress([t.frozenRows?getCellIndexes(t.topLeftCell)[0]:this.parent.viewport.topIndex,e[0],this.parent.viewport.bottomIndex,e[1]])},e.prototype.updateScrollCount=function(e,t,r){void 0===r&&(r=e);var n=this.parent.getActiveSheet(),i=e+this.parent.viewport[t+"Count"]+1+r,o=this.scroll[this.parent.activeSheetIndex][t+"Count"];if(i<o){if(n[t+"Count"]===o)return;i=o}this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(n,t+"Count",i)},e.prototype.onVerticalScroll=function(e){var t=e.cur.idx,r=e.cur.size,n=e.prev.idx,i=Math.abs(t-n),o=this.parent.getThreshold("row");if(i>Math.round(o/2)){var a=void 0,s=void 0,l=void 0,d=this.parent.getActiveSheet();if(t<=o&&!e.increase){if(this.translateY&&n>o){this.translateY=0;var p=this.parent.frozenColCount(d),h=this.parent.frozenRowCount(d);if(e.preventScroll)this.parent.viewport.topIndex=n-(o-h);else{var c=p?getCellIndexes(d.topLeftCell)[1]:this.parent.viewport.leftIndex,u=p?[h,this.parent.viewport.leftIndex+p]:[];if(i<this.parent.viewport.rowCount+o){(a=skipHiddenIdx(d,h,!0))<0&&(a=h),s=skipHiddenIdx(d,this.parent.viewport.topIndex+h-1,!1),this.parent.viewport.topIndex=skipHiddenIdx(d,a-h,!0);var g=this.hiddenCount(a,s),f=skipHiddenIdx(d,this.parent.viewport.bottomIndex-(s-a+1-g),e.increase);this.parent.viewport.bottomIndex-=s-a+1-g+this.hiddenCount(f,this.parent.viewport.bottomIndex),this.parent.renderModule.refreshUI({colIndex:c,rowIndex:a,direction:"last",refresh:"RowPart",skipUpdateOnFirst:!0,frozenIndexes:u},this.getRowAddress([a,skipHiddenIdx(d,s,!1)]))}else{var m=this.parent.viewport.leftIndex;this.parent.renderModule.refreshUI({rowIndex:0,colIndex:c,refresh:"Row",skipUpdateOnFirst:!0,frozenIndexes:u,skipTranslate:!0}),p&&(this.parent.viewport.leftIndex=m),this.translate({refresh:"Row"})}focus(this.parent.element),t=0}}this.updateScrollCount(o,"row")}if(n<o&&(i=Math.abs(t-o)),!e.increase&&this.parent.scrollSettings.isFinite&&this.parent.viewport.bottomIndex===skipHiddenIdx(d,d.rowCount-1,!1)){var v=this.parent.viewport.topIndex+getRangeIndexes(d.topLeftCell)[0]-1;if(t>v)return void(e.prev.idx=t);i=v-t}if(t>o){if(l=this.parent.viewport.topIndex,this.parent.viewport.topIndex=t-o,e.increase&&l>this.parent.viewport.topIndex)return void(this.parent.viewport.topIndex=l);h=this.parent.frozenRowCount(d);if(e.preventScroll)this.setThresholdHeight(r,o,h),this.translate({refresh:"Row"});else{c=(p=this.parent.frozenColCount(d))?getCellIndexes(d.topLeftCell)[1]:this.parent.viewport.leftIndex;var C=[];if(d.frozenColumns&&(C=[h,this.parent.viewport.leftIndex+p]),i<this.parent.viewport.rowCount+o)if(e.increase){if(a=this.parent.viewport.bottomIndex+1,s=this.parent.viewport.bottomIndex+(this.parent.viewport.topIndex-l),(s-=this.hiddenCount(l,this.parent.viewport.topIndex-1))<=this.parent.viewport.bottomIndex)return this.parent.viewport.topIndex=skipHiddenIdx(d,this.parent.viewport.topIndex,e.increase),void this.setThresholdHeight(r,o,h);var y=this.parent.skipHidden(a,s,"rows",!1),x=this.checkLastIdx(y[1],"row");a=y[0],s=x.index,this.parent.viewport.topIndex=skipHiddenIdx(d,this.parent.viewport.topIndex-x.diff,!this.parent.scrollSettings.isFinite),this.setThresholdHeight(r,t-this.parent.viewport.topIndex,h,!!x.diff),this.parent.viewport.bottomIndex=s,this.parent.renderModule.refreshUI({colIndex:c,rowIndex:a,direction:"first",refresh:"RowPart",frozenIndexes:C},this.getRowAddress([a,s]))}else{if(this.parent.viewport.topIndex=a=skipHiddenIdx(d,this.parent.viewport.topIndex,!1),a<0&&(this.parent.viewport.topIndex=a=0),a=skipHiddenIdx(d,a+h,!0),(s=skipHiddenIdx(d,l-1,!1))<0||s<a)return void(this.parent.viewport.topIndex=l);g=this.hiddenCount(a,s);this.parent.viewport.bottomIndex-=s-a+1-g,this.parent.viewport.bottomIndex=skipHiddenIdx(d,this.parent.viewport.bottomIndex,!1),a=this.parent.skipHidden(a,s)[0],this.setThresholdHeight(r,t-this.parent.viewport.topIndex,h),this.parent.renderModule.refreshUI({colIndex:c,rowIndex:a,direction:"last",refresh:"RowPart",frozenIndexes:C},this.getRowAddress([a,s]))}else l=this.parent.viewport.leftIndex,this.parent.viewport.topIndex=skipHiddenIdx(d,this.parent.viewport.topIndex,!1),this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:c,refresh:"Row",frozenIndexes:C,skipTranslate:!0}),p&&(this.parent.viewport.leftIndex=l),this.setThresholdHeight(r,t-this.parent.viewport.topIndex,h),this.translate({refresh:"Row"});this.updateScrollCount(t,"row",o),this.focusSheet()}}e.prev.idx=t}},e.prototype.hiddenCount=function(e,t,r){void 0===r&&(r="rows");for(var n=0,i=this.parent.getActiveSheet(),o=e;o<=t;o++)i[r][o]&&i[r][o].hidden&&n++;return n},e.prototype.checkLastIdx=function(e,t){var r=0;if(this.parent.scrollSettings.isFinite){var n=this.parent.getActiveSheet(),i=n[t+"Count"]-1;e>i&&(r=e-i,e=skipHiddenIdx(n,i,!1))}return{index:e,diff:r}},e.prototype.onHorizontalScroll=function(e){var t=e.cur.idx,r=e.cur.size,n=e.prev.idx,i=Math.abs(t-n),o=this.parent.getThreshold("col");if(i>Math.round(o/2)){var a=void 0,s=void 0,l=void 0,d=this.parent.getActiveSheet();if(t<=o&&!e.increase){if(this.translateX&&n>o){this.translateX=0;var p=this.parent.frozenColCount(d),h=this.parent.frozenRowCount(d);if(e.preventScroll)this.parent.viewport.leftIndex=n-(o-p);else{var c=h?getCellIndexes(d.topLeftCell)[0]:this.parent.viewport.topIndex,u=h?[this.parent.viewport.topIndex+h,p]:[];if(i<this.parent.viewport.colCount+o){(a=skipHiddenIdx(d,p,!0,"columns"))<0&&(a=p),s=skipHiddenIdx(d,this.parent.viewport.leftIndex+p-1,!1,"columns"),this.parent.viewport.leftIndex=skipHiddenIdx(d,a-p,!0,"columns");var g=this.hiddenCount(a,s,"columns"),f=skipHiddenIdx(d,this.parent.viewport.rightIndex-(s-a+1-g),e.increase,"columns");this.parent.viewport.rightIndex-=s-a+1-g+this.hiddenCount(f,this.parent.viewport.rightIndex,"columns"),this.parent.renderModule.refreshUI({rowIndex:c,colIndex:a,direction:"last",refresh:"ColumnPart",skipUpdateOnFirst:!0,frozenIndexes:u},this.getColAddress([a,skipHiddenIdx(d,s,!1,"columns")]))}else{var m=this.parent.viewport.topIndex;this.parent.renderModule.refreshUI({rowIndex:c,colIndex:0,refresh:"Column",skipUpdateOnFirst:!0,frozenIndexes:u,skipTranslate:!0}),h&&(this.parent.viewport.topIndex=m),this.translate({refresh:"Column"})}focus(this.parent.element),t=0}}this.updateScrollCount(o,"col")}if(n<o&&(i=Math.abs(t-o)),!e.increase&&this.parent.scrollSettings.isFinite&&this.parent.viewport.rightIndex===d.colCount-1){var v=this.parent.viewport.leftIndex+getRangeIndexes(d.topLeftCell)[1]-1;if(v+=this.hiddenCount(this.parent.viewport.leftIndex,v),t>v)return void(e.prev.idx=t);i=v-t}if(t>o){if(l=this.parent.viewport.leftIndex,this.parent.viewport.leftIndex=t-o,e.increase&&l>this.parent.viewport.leftIndex)return void(this.parent.viewport.leftIndex=l);p=this.parent.frozenColCount(d);if(e.preventScroll)this.setThresholdWidth(r,o,p),this.translate({refresh:"Column"});else{c=(h=this.parent.frozenRowCount(d))?getCellIndexes(d.topLeftCell)[0]:this.parent.viewport.topIndex;var C=[];if(h&&(C=[h+this.parent.viewport.topIndex,p]),i<this.parent.viewport.colCount+o)if(e.increase){if(a=this.parent.viewport.rightIndex+1,s=this.parent.viewport.rightIndex+(this.parent.viewport.leftIndex-l),(s-=this.hiddenCount(l,this.parent.viewport.leftIndex-1,"columns"))<=this.parent.viewport.rightIndex)return this.parent.viewport.leftIndex=skipHiddenIdx(d,this.parent.viewport.leftIndex,e.increase,"columns"),void this.setThresholdWidth(r,o,p);var y=this.parent.skipHidden(a,s,"columns",!1),x=this.checkLastIdx(y[1],"col");a=y[0],s=x.index,this.parent.viewport.leftIndex=skipHiddenIdx(d,this.parent.viewport.leftIndex-x.diff,!this.parent.scrollSettings.isFinite,"columns"),this.setThresholdWidth(r,t-this.parent.viewport.leftIndex,p,!!x.diff),this.parent.viewport.rightIndex=s,this.parent.renderModule.refreshUI({rowIndex:c,colIndex:a,direction:"first",refresh:"ColumnPart",frozenIndexes:C},this.getColAddress([a,s]))}else{if(a=skipHiddenIdx(d,this.parent.viewport.leftIndex,!1,"columns"),this.parent.viewport.leftIndex=a,a<0&&(this.parent.viewport.leftIndex=a=0),a=skipHiddenIdx(d,a+p,!0,"columns"),(s=skipHiddenIdx(d,l-1,!1,"columns"))<0||s<a)return void(this.parent.viewport.leftIndex=l);g=this.hiddenCount(a,s,"columns");this.parent.viewport.rightIndex-=s-a+1-g,this.parent.viewport.rightIndex=skipHiddenIdx(d,this.parent.viewport.rightIndex,!1,"columns"),a=this.parent.skipHidden(a,s,"columns")[0],this.setThresholdWidth(r,t-this.parent.viewport.leftIndex,p),this.parent.renderModule.refreshUI({rowIndex:c,colIndex:a,direction:"last",refresh:"ColumnPart",frozenIndexes:C},this.getColAddress([a,s]))}else l=this.parent.viewport.topIndex,this.parent.viewport.leftIndex=skipHiddenIdx(d,this.parent.viewport.leftIndex,!1,"columns"),this.parent.renderModule.refreshUI({rowIndex:c,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:C,skipTranslate:!0}),h&&(this.parent.viewport.topIndex=l),this.setThresholdWidth(r,t-this.parent.viewport.leftIndex,p),this.translate({refresh:"Column"});this.updateScrollCount(t,"col",o),this.focusSheet()}}e.prev.idx=t}},e.prototype.focusSheet=function(){document.activeElement.classList.contains("e-text-findNext-short")&&ej2Base.closest(document.activeElement,"#"+this.parent.element.id)||focus(this.parent.element)},e.prototype.setThresholdHeight=function(e,t,r,n){var i,o=this.parent.getActiveSheet(),a=this.parent.viewport.topIndex+r;if(n){var s=this.parent.getMainContent().querySelector(".e-virtualtrack");if(!s)return void(this.translateY=getRowsHeight(o,0,a-1,!0));e=parseInt(s.style.height,10),i=this.parent.viewport.bottomIndex}else i=a+t-1;this.translateY=e-getRowsHeight(o,a,i,!0)},e.prototype.setThresholdWidth=function(e,t,r,n){var i,o=this.parent.getActiveSheet(),a=this.parent.viewport.leftIndex+r;if(n){var s=this.parent.getMainContent().querySelector(".e-virtualtrack");if(!s)return void(this.translateY=getColumnsWidth(o,0,a-1,!0));e=parseInt(s.style.width,10),i=this.parent.viewport.rightIndex}else i=a+t-1;this.translateX=e-getColumnsWidth(o,a,i,!0)},e.prototype.translate=function(e){if(!e.skipTranslate&&this.content){var t=this.translateX||0;t=this.parent.enableRtl?-t:t,"Row"!==e.refresh&&"RowPart"!==e.refresh||(this.content.style.transform="translate("+t+"px, "+this.translateY+"px)",this.rowHeader.style.transform="translate(0px, "+this.translateY+"px)"),"Column"!==e.refresh&&"ColumnPart"!==e.refresh||(this.content.style.transform="translate("+t+"px, "+this.translateY+"px)",this.colHeader.style.transform="translate("+t+"px, 0px)")}},e.prototype.updateColumnWidth=function(e){if("Column"===e.refresh){this.content.style.width="";var t=this.parent.getActiveSheet(),r=getColumnsWidth(t,this.parent.viewport.leftIndex+this.parent.frozenColCount(t),this.parent.viewport.rightIndex,!0);if(this.colHeader.style.width=r+"px",this.content.style.width=r+"px",!this.parent.scrollSettings.isFinite||e.isUpdate){var n=this.parent.element.querySelector(".e-scroller .e-virtualtrack");if(!n)return;var i=parseInt(n.style.width,10),o=r+this.translateX+this.parent.viewport.beforeFreezeWidth;if(o>i){var a=o-i;n.style.width=i+a+"px"}else{a=i-o;var s=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];i-a<parseInt(s.style.width,10)&&(n.style.width=s.style.width)}}}else if(!this.parent.scrollSettings.isFinite){s=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];var l=parseInt(s.style.height,10),d=this.content.getBoundingClientRect().height+this.translateY+this.parent.viewport.beforeFreezeHeight;if(d>l){a=d-l;s.style.height=l+a+"px"}else{a=l-d;var p=this.parent.getRowHeaderContent().getElementsByClassName("e-virtualtrack")[0];l-a<parseInt(p.style.height,10)&&(s.style.height=p.style.height)}}},e.prototype.updateRowColCount=function(e){if(this.scroll.length){var t=this.parent.getActiveSheet();if("row"===e.update){if(e.index!==this.scroll[this.parent.activeSheetIndex].rowCount-1){var r=this.getVTrackHeight("height"),n=r;if(e.index>=this.scroll[this.parent.activeSheetIndex].rowCount?void 0===e.start?n+=getRowsHeight(t,this.scroll[this.parent.activeSheetIndex].rowCount,e.index,!0):n+=getRowsHeight(t,e.start,e.end,!0):void 0===e.start?n-=getRowsHeight(t,e.index+1,this.scroll[this.parent.activeSheetIndex].rowCount-1,!0):n-=getRowsHeight(t,e.start,e.end,!0),!e.isDelete&&n<r)return;this.scroll[this.parent.activeSheetIndex].rowCount=e.index+1,this.updateVTrack(this.rowHeader,n,"height"),this.scroll[this.parent.activeSheetIndex].rowCount>t.rowCount&&this.parent.setSheetPropertyOnMute(t,"rowCount",this.scroll[this.parent.activeSheetIndex].rowCount)}}else if(e.index!==this.scroll[this.parent.activeSheetIndex].colCount-1){var i=this.getVTrackHeight("width"),o=i;if(e.index>=this.scroll[this.parent.activeSheetIndex].colCount?void 0===e.start?o+=getColumnsWidth(t,this.scroll[this.parent.activeSheetIndex].colCount,e.index,!0):o+=getColumnsWidth(t,e.start,e.end,!0):void 0===e.start?o-=getColumnsWidth(t,e.index+1,this.scroll[this.parent.activeSheetIndex].colCount-1,!0):o-=getColumnsWidth(t,e.start,e.end,!0),!e.isDelete&&o<i)return;this.scroll[this.parent.activeSheetIndex].colCount=e.index+1,this.updateVTrack(this.colHeader,o,"width"),this.scroll[this.parent.activeSheetIndex].colCount>t.colCount&&this.parent.setSheetPropertyOnMute(t,"colCount",this.scroll[this.parent.activeSheetIndex].colCount)}}},e.prototype.getVTrackHeight=function(e){var t=this.content.nextElementSibling.style[e];if(t.includes("e+")){var r=(t=t.split("px")[0]).split("e+");return Number(r[0])*Math.pow(10,Number(r[1]))}return parseFloat(t)},e.prototype.updateVTrackHeight=function(e){e.rowIdx<this.scroll[this.parent.activeSheetIndex].rowCount&&this.updateVTrack(this.rowHeader,this.getVTrackHeight("height")+e.threshold,"height"),e.rowIdx<this.parent.viewport.topIndex&&(this.translateY+=e.threshold,this.translate({refresh:"Row"}))},e.prototype.updateVTrackWidth=function(e){if(e.colIdx>=this.parent.viewport.leftIndex&&e.colIdx<=this.parent.viewport.rightIndex){var t=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualtrack")[0];t.style.width=parseFloat(t.style.width)+e.threshold+"px";var r=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];r.style.width=parseFloat(r.style.width)+e.threshold+"px";var n=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualable")[0];n.style.width=parseFloat(n.style.width)+e.threshold+"px";var i=this.parent.getMainContent().getElementsByClassName("e-virtualable")[0];i.style.width=parseFloat(i.style.width)+e.threshold+"px"}else this.parent.scrollModule.offset.left.size+=e.threshold,this.translateX+=e.threshold,this.translate({refresh:"Column"})},e.prototype.updateVTrack=function(e,t,r){e.nextElementSibling.style[r]=t+"px",this.content.nextElementSibling.style[r]=t+"px","width"===r&&this.parent.allowScrolling&&(this.parent.getScrollElement().firstElementChild.style.width=t+"px")},e.prototype.deInitProps=function(){this.parent.viewport.leftIndex=null,this.parent.viewport.topIndex=null,this.parent.viewport.bottomIndex=null,this.translateX=null,this.translateY=null},e.prototype.updateScrollProps=function(e){var t=this;void 0===e&&(e={sheetIndex:0,sheets:this.parent.sheets}),0===this.scroll.length?this.initScroll():e.sheets.forEach(function(){t.scroll.splice(e.sheetIndex,0,{rowCount:0,colCount:0})})},e.prototype.sliceScrollProps=function(e){ej2Base.isNullOrUndefined(e.sheetIndex)?this.scroll.length=0:this.scroll.splice(e.sheetIndex,1)},e.prototype.updateTranslate=function(e){if(e.height){if(e.isRender)this.translateY-=e.height;else{var t=parseInt(this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0].style.height,10);e.isHide?(this.updateVTrack(this.rowHeader,t-e.height,"height"),this.setThresholdHeight(this.translateY,e.prevSize-1-this.parent.viewport.topIndex+1,this.parent.frozenRowCount(this.parent.getActiveSheet()))):(this.updateVTrack(this.rowHeader,t+e.height,"height"),this.translateY=this.translateY+e.size)}this.translate({refresh:"Row"})}e.width&&(this.translateX-=e.width,this.translate({refresh:"Column"}))},e.prototype.addEventListener=function(){this.parent.on(beforeContentLoaded,this.createVirtualElement,this),this.parent.on(beforeVirtualContentLoaded,this.translate,this),this.parent.on(virtualContentLoaded,this.updateColumnWidth,this),this.parent.on(updateTableWidth,this.updateColumnWidth,this),this.parent.on(onVerticalScroll,this.onVerticalScroll,this),this.parent.on(onHorizontalScroll,this.onHorizontalScroll,this),this.parent.on(updateRowColCount,this.updateRowColCount,this),this.parent.on(rowHeightChanged,this.updateVTrackHeight,this),this.parent.on(colWidthChanged,this.updateVTrackWidth,this),this.parent.on(deInitProperties,this.deInitProps,this),this.parent.on(sheetsDestroyed,this.sliceScrollProps,this),this.parent.on(sheetCreated,this.updateScrollProps,this),this.parent.on(updateTranslate,this.updateTranslate,this),this.parent.on(spreadsheetDestroyed,this.destroy,this)},e.prototype.destroy=function(){this.removeEventListener(),this.rowHeader=null,this.colHeader=null,this.content=null,this.parent=null,this.scroll.length=0,this.translateX=null,this.translateY=null},e.prototype.removeEventListener=function(){this.parent.off(beforeContentLoaded,this.createVirtualElement),this.parent.off(beforeVirtualContentLoaded,this.translate),this.parent.off(virtualContentLoaded,this.updateColumnWidth),this.parent.off(updateTableWidth,this.updateColumnWidth),this.parent.off(onVerticalScroll,this.onVerticalScroll),this.parent.off(onHorizontalScroll,this.onHorizontalScroll),this.parent.off(updateRowColCount,this.updateRowColCount),this.parent.off(rowHeightChanged,this.updateVTrackHeight),this.parent.off(colWidthChanged,this.updateVTrackWidth),this.parent.off(sheetsDestroyed,this.sliceScrollProps),this.parent.off(sheetCreated,this.updateScrollProps),this.parent.off(updateTranslate,this.updateTranslate),this.parent.off(spreadsheetDestroyed,this.destroy)},e}(),KeyboardNavigation=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(keyDown,this.keyDownHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(keyDown,this.keyDownHandler)},e.prototype.keyDownHandler=function(e){var t=this;if(!this.parent.isEdit&&(document.activeElement.classList.contains("e-spreadsheet")||ej2Base.closest(document.activeElement,".e-sheet"))&&!ej2Base.closest(e.target,".e-name-box")){var r=void 0,n=this.parent.enableRtl,i=this.parent.getActiveSheet(),o={e:e,isFilterCell:!1},a=getCellIndexes(i.activeCell);if([9,37,38,39,40,33,34].indexOf(e.keyCode)>-1&&e.preventDefault(),e.shiftKey&&this.shiftSelection(e),e.shiftKey||!e.altKey||38!==e.keyCode&&40!==e.keyCode||this.parent.notify(filterCellKeyDown,o),!e.shiftKey&&(!n&&37===e.keyCode||n&&39===e.keyCode)||e.shiftKey&&9===e.keyCode)if(a[1]>0)a[1]-=1,r=!0;else{var s=this.parent.getMainContent();0===a[1]&&s.scrollLeft&&!n&&(s.scrollLeft=0)}else if(e.shiftKey&&13===e.keyCode){if(!this.parent.element.querySelector(".e-find-toolbar"))if(a[0]>0)a[0]-=1,r=!0;else{s=this.parent.getMainContent().parentElement;0===a[0]&&s.scrollTop&&(s.scrollTop=0)}}else if(o.isFilterCell||e.shiftKey||38!==e.keyCode){if(!e.shiftKey&&(!n&&39===e.keyCode||n&&37===e.keyCode)||9===e.keyCode){(l=getCell(a[0],a[1],i))&&l.colSpan>1&&(a[1]+=l.colSpan-1),a[1]<i.colCount-1&&(a[1]+=1,r=!0)}else if(!o.isFilterCell&&!e.shiftKey&&40===e.keyCode||13===e.keyCode){var l;(l=getCell(a[0],a[1],i))&&l.rowSpan>1&&(a[0]+=l.rowSpan-1),a[0]<i.rowCount-1&&(a[0]+=1,r=!0)}else if(!e.shiftKey&&(34===e.keyCode||33===e.keyCode)&&(!this.parent.scrollModule||this.parent.scrollModule.isKeyScroll)){var d=this.parent.element.querySelector(".e-main-panel"),p=0;if(34===e.keyCode)p=d.getBoundingClientRect().height+d.scrollTop;else if((p=d.scrollTop-d.getBoundingClientRect().height)<0)return;var h=getCellIndexes(this.parent.getActiveSheet().activeCell)[0],c=getCellIndexes(this.parent.getActiveSheet().paneTopLeftCell)[0],u=h-c;this.parent.scrollModule&&(this.parent.scrollModule.isKeyScroll=!1),d.scrollTop=p,getUpdateUsingRaf(function(){c=getCellIndexes(t.parent.getActiveSheet().paneTopLeftCell)[0],t.parent.notify(cellNavigate,{range:[c+u,a[1]],preventAnimation:!0})})}}else if(a[0]>0)a[0]-=1,r=!0;else{s=this.parent.getMainContent().parentElement;0===a[0]&&s.scrollTop&&(s.scrollTop=0)}if(r&&(!this.parent.scrollModule||this.parent.scrollModule.isKeyScroll)){if(40===e.keyCode||38===e.keyCode||13===e.keyCode)for(;isHiddenRow(i,a[0]);)if((40===e.keyCode||!e.shiftKey&&13===e.keyCode)&&(a[0]=a[0]+1),(38===e.keyCode||e.shiftKey&&13===e.keyCode)&&(a[0]=a[0]-1,a[0]<0))return;if(37===e.keyCode||39===e.keyCode||9===e.keyCode)for(;isHiddenCol(i,a[1]);)if((39===e.keyCode||!e.shiftKey&&9===e.keyCode)&&(a[1]=a[1]+1),(37===e.keyCode||e.shiftKey&&9===e.keyCode)&&(a[1]=a[1]-1,a[1]<0))return;this.scrollNavigation(a,!1);var g=getRangeAddress(a),f=function(e){g!==i.selectedRange&&(t.parent.setSheetPropertyOnMute(i,"activeCell",g),t.parent.notify(cellNavigate,{range:a,preventAnimation:e}))};if(this.parent.scrollModule&&this.parent.scrollModule.isKeyScroll){if(g===i.selectedRange)return;getUpdateUsingRaf(f.bind(this,!0))}else f()}}e.target.classList.contains("e-sheet-rename")&&(32===e.keyCode?e.stopPropagation():13!==e.keyCode&&27!==e.keyCode||this.parent.notify(renameSheet,e))},e.prototype.shiftSelection=function(e){var t=this.parent.getActiveSheet(),r=getRangeIndexes(t.selectedRange),n=getSwapRange(r),i=!0;if(38===e.keyCode){for(var o=n[1];o<=n[3];o++){var a=getCell(r[2],o,this.parent.getActiveSheet());if(!ej2Base.isNullOrUndefined(a)&&a.rowSpan&&a.rowSpan<0){r[2]=r[2]-(Math.abs(a.rowSpan)+1),i=!1;break}}i&&(r[2]=r[2]-1),r[2]<0&&(r[2]=0)}if(40===e.keyCode){for(o=n[1];o<=n[3];o++){a=getCell(r[2],o,this.parent.getActiveSheet());if(!ej2Base.isNullOrUndefined(a)&&a.rowSpan&&a.rowSpan>0){r[2]=r[2]+Math.abs(a.rowSpan),i=!1;break}}i&&(r[2]=r[2]+1)}if(39===e.keyCode){for(o=n[0];o<=n[2];o++){a=getCell(o,r[3],this.parent.getActiveSheet());if(!ej2Base.isNullOrUndefined(a)&&a.colSpan&&a.colSpan>0){r[3]=r[3]+Math.abs(a.colSpan),i=!1;break}}i&&(r[3]=r[3]+1)}if(37===e.keyCode){for(o=n[0];o<=n[2];o++){a=getCell(o,r[3],this.parent.getActiveSheet());if(!ej2Base.isNullOrUndefined(a)&&a.colSpan&&a.colSpan<0){r[3]=r[3]-(Math.abs(a.colSpan)+1),i=!1;break}}i&&(r[3]=r[3]-1),r[3]<0&&(r[3]=0)}if(e.shiftKey&&e.ctrlKey&&!this.parent.scrollSettings.enableVirtualization){var s=[t.usedRange.rowIndex,t.usedRange.colIndex];37===e.keyCode&&(r[3]<=s[1]?r[3]=0:r[3]=s[1]),38===e.keyCode&&(r[2]<=s[0]?r[2]=0:r[2]=s[0]),39===e.keyCode&&(r[3]<=s[1]?r[3]=s[1]:r[3]=this.parent.getActiveSheet().colCount),40===e.keyCode&&(r[2]<=s[0]?r[2]=s[0]:r[2]=this.parent.getActiveSheet().rowCount)}if(37===e.keyCode||39===e.keyCode||38===e.keyCode||40===e.keyCode){for(var l=getCellIndexes(t.activeCell);isHiddenRow(this.parent.getActiveSheet(),r[2]);)40===e.keyCode&&(r[2]=r[2]+1),38===e.keyCode&&(r[2]=r[2]-1);this.parent.selectRange(getRangeAddress(r)),this.scrollNavigation([isColumnSelected(t,r)?l[0]:r[2],isRowSelected(t,r)?l[1]:r[3]],!1)}},e.prototype.scrollNavigation=function(e,t){if(this.parent.allowScrolling){var r=this.parent.enableRtl?-1:1,n=this.parent.getMainContent().parentElement,i=this.parent.getScrollElement(),o=this.parent.getActiveSheet(),a=getSwapRange(getRangeIndexes(o.selectedRange)),s=getCellIndexes(o.topLeftCell),l=this.parent.frozenRowCount(o),d=this.parent.frozenColCount(o),p=getCellIndexes(o.paneTopLeftCell),h=skipHiddenIdx(o,e[0]<l?s[0]:p[0],!0),c=e[1]<d?s[1]:p[1],u=this.parent.scrollModule.offset.top.size;if(n.scrollTop)if(l&&e[0]!==a[2]){if(e[0]===l)return void(n.scrollTop=0);e[0]===l-1&&(n.scrollTop=0)}else if(e[0]===skipHiddenIdx(o,0,!0))return void(n.scrollTop=0);if(i&&i.scrollLeft)if(d&&e[1]!==a[3]){if(e[1]===d)return void(i.scrollLeft=0);e[1]===d-1&&(i.scrollLeft=0)}else if(e[1]===skipHiddenIdx(o,0,!0,"columns"))return void(i.scrollLeft=0);this.getBottomIdx(h)<=e[0]||t?(n.scrollTop=u+getRowHeight(o,skipHiddenIdx(o,p[0],!0),!0),this.parent.scrollModule.isKeyScroll=!1):h>e[0]&&(n.scrollTop=u-Math.ceil(getRowHeight(o,e[0],!0)),this.parent.scrollModule.isKeyScroll=!1);var g=this.getRightIdx(c);(g<=e[1]||t)&&i?(i.scrollLeft+=getColumnWidth(o,g,null,!0)*r,this.parent.scrollModule.isKeyScroll=!1):c>e[1]&&i&&(i.scrollLeft-=getColumnWidth(o,e[1],null,!0)*r,this.parent.scrollModule.isKeyScroll=!1)}},e.prototype.getBottomIdx=function(e){for(var t=0,r=this.parent.getActiveSheet(),n=(r.frozenRows?this.parent.viewport.height-this.parent.sheetModule.getColHeaderHeight(r,!0):this.parent.viewport.height)-17||20,i=e;;i++)if((t+=getRowHeight(r,i,!0))>=n)return i},e.prototype.getRightIdx=function(e){for(var t=0,r=this.parent.getActiveSheet(),n=this.parent.getMainContent().parentElement.offsetWidth-this.parent.sheetModule.getRowHeaderWidth(r)-this.parent.sheetModule.getScrollSize(),i=e;;i++)if((t+=getColumnWidth(r,i,null,!0))>=n)return i},e.prototype.getModuleName=function(){return"keyboardNavigation"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),KeyboardShortcut=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(keyDown,this.keyDownHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(keyDown,this.keyDownHandler)},e.prototype.isTrgtNotInput=function(e){var t=e.target;return!(ej2Base.closest(t,".e-filter-popup")||ej2Base.closest(t,".e-find-dlg")||ej2Base.closest(t,".e-hyperlink-dlg")||ej2Base.closest(t,".e-sheet-tab")||ej2Base.closest(t,".e-name-box")||ej2Base.closest(t,".e-link-dialog"))},e.prototype.keyDownHandler=function(e){if((e.ctrlKey||e.metaKey)&&this.isTrgtNotInput(e)){if(ej2Base.closest(e.target,".e-find-dlg")||([79,83].indexOf(e.keyCode)>-1?e.preventDefault():65!==e.keyCode||this.parent.isEdit||e.preventDefault()),79===e.keyCode)ej2Base.select("#"+this.parent.element.id+"_fileUpload",this.parent.element).click();else if(83===e.keyCode)this.parent.saveUrl&&this.parent.allowSave&&this.parent.notify(exportDialog,null);else if(67===e.keyCode)this.parent.notify(copy,{promise:Promise});else if(75===e.keyCode){var t=getCellIndexes(this.parent.getActiveSheet().activeCell),r=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[t[0]],n=void 0;e.preventDefault(),ej2Base.isNullOrUndefined(r)||(n=r.cells[t[1]]),ej2Base.isNullOrUndefined(n)&&setCell(t[0],t[1],this.parent.getActiveSheet(),n,!1),n&&n.hyperlink?this.parent.notify(editHyperlink,null):this.parent.notify(initiateHyperlink,null)}else 90===e.keyCode?this.parent.isEdit||(e.preventDefault(),this.parent.notify(performUndoRedo,{isUndo:!0})):89===e.keyCode?this.parent.isEdit||(e.preventDefault(),this.parent.notify(performUndoRedo,{isUndo:!1})):82!==e.keyCode&&68!==e.keyCode||(e.preventDefault(),this.parent.notify(fillRange,{verticalFill:68===e.keyCode}));var i=this.parent.sheets[this.parent.getActiveSheet().id-1],o=void 0;if(i){var a=getCellIndexes(i.activeCell),s=getCell(a[0],a[1],i);o=i.isProtected&&isLocked(s,getColumn(i,a[1]))}if(70===e.keyCode&&(e.preventDefault(),this.parent.notify(ribbonFind,null)),!(o&&i.isProtected&&86!==e.keyCode||70===e.keyCode)){if(71===e.keyCode)e.preventDefault(),this.parent.notify(gotoDlg,null);else if(72===e.keyCode)e.preventDefault(),this.parent.notify(findDlg,null);else if(88===e.keyCode)this.parent.notify(cut,{promise:Promise});else if(86===e.keyCode)this.parent.notify(paste,{isAction:!0});else if(66===e.keyCode){e.preventDefault();l="bold"===(l=this.parent.getCellStyleValue(["fontWeight"],getCellIndexes(this.parent.getActiveSheet().activeCell)).fontWeight)?"normal":"bold",this.parent.notify(setCellFormat,{style:{fontWeight:l},onActionUpdate:!0,refreshRibbon:!0})}else if(73===e.keyCode){e.preventDefault();var l;l="italic"===(l=this.parent.getCellStyleValue(["fontStyle"],getCellIndexes(this.parent.getActiveSheet().activeCell)).fontStyle)?"normal":"italic",this.parent.notify(setCellFormat,{style:{fontStyle:l},onActionUpdate:!0,refreshRibbon:!0})}else 85===e.keyCode?(e.preventDefault(),this.parent.notify(textDecorationUpdate,{style:{textDecoration:"underline"},refreshRibbon:!0})):53===e.keyCode&&(e.preventDefault(),this.parent.notify(textDecorationUpdate,{style:{textDecoration:"line-through"},refreshRibbon:!0}));e.shiftKey&&76===e.keyCode&&(this.parent.isEdit||(e.preventDefault(),this.parent.notify(initiateFilterUI,{})))}}27===e.keyCode&&this.parent.notify(clearCopy,null)},e.prototype.getModuleName=function(){return"keyboardShortcut"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),CellFormat=function(){function e(e){this.checkHeight=!1,this.parent=e,this.row=e.createElement("tr",{className:"e-row"}),this.parent.on(initialLoad,this.addEventListener,this)}return e.prototype.applyCellFormat=function(e){var t=Object.keys(e.style),r=this.parent.getActiveSheet();if(!(e.lastCell&&getMaxHgt(r,e.rowIdx)<=20)||t.length){var n=e.cell||this.parent.getCell(e.rowIdx,e.colIdx);if(n){if(this.updateMergeBorder(e,r),void 0!==e.style.border||void 0!==e.style.borderTop||void 0!==e.style.borderLeft){var i={};Object.keys(e.style).forEach(function(t){i[t]=e.style[t]}),void 0!==i.border&&(Object.assign(n.style,{borderRight:e.style.border,borderBottom:e.style.border}),this.setLeftBorder(e.style.border,n,e.rowIdx,e.colIdx,e.row,e.onActionUpdate,e.first,r),this.setTopBorder(e.style.border,n,e.rowIdx,e.colIdx,e.pRow,e.pHRow,e.onActionUpdate,e.first,e.lastCell,e.manualUpdate,r),delete i.border),void 0!==i.borderTop&&(this.setTopBorder(e.style.borderTop,n,e.rowIdx,e.colIdx,e.pRow,e.pHRow,e.onActionUpdate,e.first,e.lastCell,e.manualUpdate,r),delete i.borderTop),void 0!==i.borderLeft&&(this.setLeftBorder(e.style.borderLeft,n,e.rowIdx,e.colIdx,e.row,e.onActionUpdate,e.first,r),delete i.borderLeft),Object.keys(i).length&&(void 0!==i.borderBottom&&this.setThickBorderHeight(i.borderBottom,e.rowIdx,e.colIdx,n,e.row,e.hRow,e.onActionUpdate,e.lastCell,e.manualUpdate),Object.assign(n.style,i))}else{void 0!==e.style.borderBottom&&this.setThickBorderHeight(e.style.borderBottom,e.rowIdx,e.colIdx,n,e.row,e.hRow,e.onActionUpdate,e.lastCell,e.manualUpdate),Object.assign(n.style,e.style);var o=getCell(e.rowIdx,e.colIdx,r);if(o&&(o.rowSpan||o.colSpan)&&n.offsetHeight>0){(l=getTextHeight(this.parent,o.style||this.parent.cellStyle))>n.offsetHeight&&setRowEleHeight(this.parent,r,n.offsetHeight,e.rowIdx)}}if(e.isHeightCheckNeeded){var a=getCell(e.rowIdx,e.colIdx,r,null,!0);if(r.rows[e.rowIdx]&&r.rows[e.rowIdx].customHeight){if(!a.wrap&&(e.style.fontSize||e.style.fontFamily)){var s=getRowHeight(r,e.rowIdx,!0)-getBorderHeight(e.rowIdx,e.colIdx,r);s<getTextHeight(this.parent,a.style)?n.style.lineHeight=s+"px":n.style.lineHeight&&(n.style.lineHeight="")}}else if(e.manualUpdate)this.checkHeight||(this.checkHeight=this.isHeightCheckNeeded(e.style,e.onActionUpdate)),n&&n.children[0]&&"e-cf-databar"===n.children[0].className&&e.style.fontSize&&(n.children[0].querySelector(".e-databar-value").style.fontSize=e.style.fontSize),this.updateRowHeight(e.rowIdx,e.colIdx,e.lastCell,e.onActionUpdate),a.wrap&&(e.style.fontSize||e.style.fontFamily)&&(n.style.lineHeight=parseFloat(a.style&&a.style.fontSize||this.parent.cellStyle.fontSize)*getLineHeight(a.style&&a.style.fontFamily?a.style:this.parent.cellStyle)+"pt");else if(!a.wrap&&this.isHeightCheckNeeded(e.style)&&setMaxHgt(r,e.rowIdx,e.colIdx,getTextHeightWithBorder(this.parent,e.rowIdx,e.colIdx,r,e.style)),e.lastCell){var l;(l=getMaxHgt(r,e.rowIdx))>20&&l>getRowHeight(r,e.rowIdx)&&setRowEleHeight(this.parent,r,l,e.rowIdx,e.row,e.hRow,this.parent.scrollSettings.isFinite)}}}else this.updateRowHeight(e.rowIdx,e.colIdx,!0,e.onActionUpdate)}},e.prototype.updateRowHeight=function(e,t,r,n){if(this.checkHeight){var i=0,o=void 0,a=this.parent.getActiveSheet(),s=getCell(e,t,a,null,!0),l=this.parent.getCell(e,t);if(!s.rowSpan&&!s.colSpan){if(i=getTextHeightWithBorder(this.parent,e,t,a,s.style||this.parent.cellStyle,s.wrap?getLines(this.parent.getDisplayText(s),getExcludedColumnWidth(a,e,t),s.style,this.parent.cellStyle):1),!ej2Base.isNullOrUndefined(s.value)){if(s.value.toString().indexOf("\n")>-1){var d=void 0,p=s.value.split("\n"),h=0,c=p.length;for(d=0;d<c;d++){var u=getLines(p[d],getExcludedColumnWidth(a,e,t),s.style,this.parent.cellStyle);0===u&&(u=1),h+=u}i=getTextHeightWithBorder(this.parent,e,t,a,s.style||this.parent.cellStyle,h)}}if(i<20&&(i=20),l&&l.children[0]&&"e-cf-databar"===l.children[0].className&&(l.children[0].style.height="100%",l.children[0].firstElementChild.nextElementSibling.style.height="100%"),setMaxHgt(a,e,t,i),r){this.checkHeight=!1;var g=a.frozenRows?this.parent.getRow(e,null,a.frozenColumns):this.parent.getRow(e);if(!g)return;var f=getRowHeight(a,e);o=getMaxHgt(a,e);(n?o!==f:o>f)&&setRowEleHeight(this.parent,a,o,e,g,null,!0)}}}},e.prototype.updateMergeBorder=function(e,t){var r=getCell(e.rowIdx,e.colIdx,t,null,!0),n={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};if(this.parent.notify(activeCellMergedRange,n),r.rowSpan>1&&!e.style.borderBottom){var i=getCell(n.range[2],n.range[1],t,null,!0);i.style&&i.style.borderBottom&&(e.style.borderBottom=i.style.borderBottom)}if(r.colSpan>1&&!e.style.borderRight){var o=getCell(n.range[0],n.range[3],t,null,!0);o.style&&o.style.borderRight&&(e.style.borderRight=o.style.borderRight)}},e.prototype.isHeightCheckNeeded=function(e,t){var r=Object.keys(e);return(t?r.indexOf("fontSize")>-1:r.indexOf("fontSize")>-1&&Number(e.fontSize.split("pt")[0])>12)||r.indexOf("fontFamily")>-1||r.indexOf("borderTop")>-1||r.indexOf("borderBottom")>-1},e.prototype.setLeftBorder=function(e,t,r,n,i,o,a,s){if(!a||!a.includes("Column")){var l=this.parent.getCell(r,n-1,i);if(l){var d=getCell(r,n-1,s,!1,!0);if(d.rowSpan&&1!==d.rowSpan||d.colSpan&&1!==d.colSpan){var p={range:[r,n-1,r,n-1]};if(this.parent.notify(activeCellMergedRange,p),(d=getCell(p.range[0],p.range[1],s,!1,!0)).style&&d.style.borderRight&&"none"!==d.style.borderRight)return;if((d=getCell(p.range[0],p.range[3],s,null,!0)).style&&d.style.borderRight&&"none"!==d.style.borderRight)return;t.style.borderLeft=e}else o&&""!==e&&n===this.parent.viewport.leftIndex&&(this.parent.getMainContent().scrollLeft-=this.getBorderSize(e)),l.style.borderRight="none"===e?l.style.borderRight:e}else t.style.borderLeft=e}},e.prototype.setTopBorder=function(e,t,r,n,i,o,a,s,l,d,p){if(!s||!s.includes("Row")){var h=this.parent.getCell(r-1,n,i);if(h){var c=getCell(r-1,n,p,!1,!0);if(c.rowSpan&&1!==c.rowSpan||c.colSpan&&1!==c.colSpan){var u={range:[r-1,n,r-1,n]};if(this.parent.notify(activeCellMergedRange,u),(c=getCell(u.range[0],u.range[1],p,!1,!0)).style&&c.style.borderBottom&&"none"!==c.style.borderBottom)return;if((c=getCell(u.range[2],u.range[1],p,null,!0)).style&&c.style.borderBottom&&"none"!==c.style.borderBottom)return;t.style.borderTop=e}else{if(isHiddenRow(p,r-1)){var g=[Number(h.parentElement.getAttribute("aria-rowindex"))-1,n];if(this.parent.getCellStyleValue(["bottomPriority"],g).bottomPriority)return}a&&""!==e&&p.topLeftCell.includes(""+(r+1))&&(this.parent.getMainContent().parentElement.scrollTop-=this.getBorderSize(e)),this.setThickBorderHeight(e,r-1,n,h,i,o,a,l,d),h.style.borderBottom="none"===e?h.style.borderBottom:e}}else t.style.borderTop=e}},e.prototype.setThickBorderHeight=function(e,t,r,n,i,o,a,s,l){var d=e?this.getBorderSize(e):1,p=this.parent.getActiveSheet();if(d>2&&(!p.rows[t]||!p.rows[t].customHeight))if(l)this.checkHeight||(this.checkHeight=!0),this.updateRowHeight(t,r,s,a);else{var h=getRowHeight(p,t),c=Math.ceil(this.parent.calculateHeight(this.parent.getCellStyleValue(["fontFamily","fontSize"],[t,r]),1,3));c>h&&(setRowEleHeight(this.parent,p,c,t,i,o,!1),this.parent.notify(rowHeightChanged,{rowIdx:t,threshold:c-20}))}!a||!s&&this.checkHeight||!(d<3)||p.rows[t]&&p.rows[t].customHeight||(this.checkHeight||(this.checkHeight=!0),this.updateRowHeight(t,r,s,a))},e.prototype.getBorderSize=function(e){var t=e.split(" ")[0];return"thin"===t?1:"medium"===t?2:"thick"===t?3:parseInt(t,10)?parseInt(t,10):1},e.prototype.clearObj=function(e){var t,r,n=e.options,i=n.range?n.range.indexOf("!")>0?n.range.split("!")[1]:n.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,o=n.range&&n.range.indexOf("!")>0?getSheetIndex(this.parent,n.range.split("!")[0]):this.parent.activeSheetIndex,a=getRangeIndexes(i),s=this.parent.sheets[o],l=a[0],d=a[2],p={range:i,type:n.type,requestType:"clear",sheetIndex:o};if(e.isPublic||this.parent.notify(beginAction,{action:"beforeClear",eventArgs:p}),"Clear Formats"===n.type||"Clear All"===n.type)for(this.parent.notify(clearCFRule,{range:i,isPublic:!1,isclearFormat:!0});l<=d;l++)for(t=a[1],r=a[3];t<=r;t++){var h=getCell(l,t,s),c=this.parent.getCell(l,t);h&&(h.formula&&this.parent.notify(clearFormulaDependentCells,{cellRef:getRangeAddress([l,t,l,t])}),h.wrap&&this.parent.notify(wrapEvent,{range:[l,t,l,t],wrap:!1,sheet:s}),h.hyperlink&&(ej2Base.removeClass(c.querySelectorAll(".e-hyperlink"),"e-hyperlink-style"),"Clear All"===n.type&&this.parent.removeHyperlink(getRangeAddress([l,t,l,t]))))}"Clear Hyperlinks"!==n.type?(this.parent.notify(clear,{range:s.name+"!"+i,type:n.type}),this.parent.serviceLocator.getService("cell").refreshRange(getRangeIndexes(i)),e.isPublic||(p={range:s.name+"!"+i,type:n.type,sheetIndex:o},this.parent.notify("actionComplete",{eventArgs:p,action:"clear"})),this.parent.notify(addHighlight,{range:i,isclearFormat:!0}),this.parent.notify(selectRange,{address:i}),this.parent.notify(activeCellChanged,null)):this.parent.removeHyperlink(i)},e.prototype.addEventListener=function(){this.parent.on(applyCellFormat,this.applyCellFormat,this),this.parent.on(clearViewer,this.clearObj,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(initialLoad,this.addEventListener),this.parent.off(applyCellFormat,this.applyCellFormat),this.parent.off(clearViewer,this.clearObj))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null,this.row=null,this.checkHeight=null},e.prototype.getModuleName=function(){return"cellformat"},e}(),Resize=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(contentLoaded,this.wireEvents,this),this.parent.on(autoFit,this.autoFit,this),this.parent.on(setAutoFit,this.setAutoFitHandler,this)},e.prototype.autoFit=function(e){for(var t=e.isRow?this.parent.getRowHeaderTable():this.parent.getColHeaderTable().rows[0],r=e.startIndex;r<=e.endIndex;r++)this.trgtEle=e.isRow?this.parent.getRow(r,t):this.parent.getCell(null,r,t),this.setAutofit(r,!e.isRow)},e.prototype.wireEvents=function(){var e=this.parent.getRowHeaderContent(),t=this.parent.element.getElementsByClassName("e-header-panel")[0];t&&(ej2Base.EventHandler.add(t,"dblclick",this.dblClickHandler,this),ej2Base.EventHandler.add(e,"dblclick",this.dblClickHandler,this),ej2Base.EventHandler.add(t,"mousedown",this.mouseDownHandler,this),ej2Base.EventHandler.add(e,"mousedown",this.mouseDownHandler,this),this.wireResizeCursorEvent(e,t))},e.prototype.wireResizeCursorEvent=function(e,t){ej2Base.EventHandler.add(e,"mousemove",this.setTarget,this),ej2Base.EventHandler.add(t,"mousemove",this.setTarget,this)},e.prototype.unWireResizeCursorEvent=function(){ej2Base.EventHandler.remove(this.parent.getRowHeaderContent(),"mousemove",this.setTarget);var e=this.parent.element.getElementsByClassName("e-header-panel")[0];e&&ej2Base.EventHandler.remove(e,"mousemove",this.setTarget)},e.prototype.unwireEvents=function(){ej2Base.EventHandler.remove(this.parent.getColumnHeaderContent(),"dblclick",this.dblClickHandler),ej2Base.EventHandler.remove(this.parent.getRowHeaderContent(),"dblclick",this.dblClickHandler),ej2Base.EventHandler.remove(this.parent.getColumnHeaderContent(),"mousedown",this.mouseDownHandler),ej2Base.EventHandler.remove(this.parent.getRowHeaderContent(),"mousedown",this.mouseDownHandler),this.unWireResizeCursorEvent()},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(contentLoaded,this.wireEvents),this.parent.off(autoFit,this.autoFit),this.parent.off(setAutoFit,this.setAutoFitHandler))},e.prototype.mouseMoveHandler=function(e){var t=this.parent.element.getElementsByClassName("e-colresize-handler")[0],r=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];this.resizeTooltip(null,!0,e),(t||r)&&(this.isMouseMoved=!0,t?e.x>this.trgtEle.parentElement.firstChild.getBoundingClientRect().left&&(t.style.left=e.clientX-document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect().left+"px"):r&&e.y>=this.trgtEle.parentElement.parentElement.firstChild.getBoundingClientRect().top&&(r.style.top=e.clientY-document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect().top+"px"))},e.prototype.mouseDownHandler=function(e){if(ej2Base.closest(e.target,".e-header-cell")){if(this.event=e,this.trgtEle=e.target,this.trgtEle.parentElement.classList.contains("e-hide-end")||this.trgtEle.classList.contains("e-hide-end")){var t=this.trgtEle.offsetHeight,r=e.offsetY;(t>=10&&r<5||t-2<8&&r<Math.ceil((r-2)/2))&&this.trgtEle.classList.add("e-skip-resize")}this.updateTarget(e,this.trgtEle);var n=this.trgtEle,i=n.classList.contains("e-colresize")?"e-colresize-handler":n.classList.contains("e-rowresize")?"e-rowresize-handler":"";this.createResizeHandler(n,i),this.unWireResizeCursorEvent(),ej2Base.EventHandler.add(this.parent.element,"mousemove",this.mouseMoveHandler,this),ej2Base.EventHandler.add(document,"mouseup",this.mouseUpHandler,this)}},e.prototype.mouseUpHandler=function(e){var t=this.parent.element.getElementsByClassName("e-resize-handle")[0];this.resizeOn(e),this.isMouseMoved=null;var r=document.querySelector(".e-header-tooltip");t&&(ej2Base.detach(t),this.updateCursor()),r&&r.remove(),ej2Base.EventHandler.remove(document,"mouseup",this.mouseUpHandler),ej2Base.EventHandler.remove(this.parent.element,"mousemove",this.mouseMoveHandler),this.wireResizeCursorEvent(this.parent.getRowHeaderContent(),this.parent.element.getElementsByClassName("e-header-panel")[0]),this.parent.notify(positionAutoFillElement,null),this.parent.notify(hideAutoFillOptions,null)},e.prototype.dblClickHandler=function(e){if(ej2Base.closest(e.target,".e-header-cell")){if(this.trgtEle=e.target,this.updateTarget(e,this.trgtEle),this.trgtEle.classList.contains("e-colresize")){var t=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1,r=getColumnWidth(this.parent.getActiveSheet(),t)+"px";this.trgtEle.classList.contains("e-unhide-column")?this.showHiddenColumns(t-1):this.setAutofit(t,!0,r)}else if(this.trgtEle.classList.contains("e-rowresize")){var n=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,i=getRowHeight(this.parent.getActiveSheet(),n)+"px";this.setAutofit(n,!1,i)}this.parent.notify(positionAutoFillElement,null)}},e.prototype.setTarget=function(e){if(ej2Base.closest(e.target,".e-header-cell")){var t=e.target,r=this.parent.getActiveSheet();if(r.isProtected&&(!r.protectSettings.formatColumns||!r.protectSettings.formatRows)){if(!r.protectSettings.formatRows&&!r.protectSettings.formatColumns)return;if(r.protectSettings.formatRows&&ej2Base.closest(t,".e-colhdr-table"))return;if(r.protectSettings.formatColumns&&ej2Base.closest(t,".e-rowhdr-table"))return}var n,i,o,a;if(ej2Base.closest(t,".e-header-row")){o=e.offsetX,i=t.offsetWidth,a="e-colresize";(s=this.getColPrevSibling(t))&&!s.classList.contains("e-select-all-cell")?n=s:Number(t.getAttribute("aria-colindex"))>1&&(n=t)}else if(ej2Base.closest(t,".e-row")){o=e.offsetY,i=t.offsetHeight,a="e-rowresize";var s;(s=this.getRowPrevSibling(t))?n=s.firstElementChild:Number(t.parentElement.getAttribute("aria-rowindex"))>1&&(n=t)}if(i-2<8&&o!==Math.ceil((i-2)/2))o<Math.ceil((i-2)/2)?(t.classList.add(a),n.classList.add(a)):o>Math.ceil((i-2)/2)&&t.classList.add(a);else if(i-5<o&&o<=i&&i>=10)t.classList.add(a);else if(o<5&&n&&i>=10)t.classList.add(a),n.classList.add(a);else for(var l=this.parent.element.getElementsByClassName(a),d=0;d<l.length;d++)l[d].classList.remove(a)}},e.prototype.getColPrevSibling=function(e){var t=this.parent.frozenColCount(this.parent.getActiveSheet());return e.previousElementSibling||(t&&ej2Base.closest(e,".e-column-header")?this.parent.getSelectAllContent().querySelector(".e-header-row").lastElementChild:null)},e.prototype.getRowPrevSibling=function(e){var t=this.parent.frozenRowCount(this.parent.getActiveSheet());return e.parentElement.previousElementSibling||(t&&ej2Base.closest(e,".e-row-header")?this.parent.getSelectAllContent().querySelector("tbody").lastElementChild:null)},e.prototype.updateTarget=function(e,t){if(ej2Base.closest(t,".e-header-row")){if(t.offsetWidth<10&&e.offsetX<Math.ceil((t.offsetWidth-2)/2)||e.offsetX<5&&t.offsetWidth>=10&&t.classList.contains("e-colresize")){var r=this.parent.getActiveSheet(),n=Number(this.trgtEle.getAttribute("aria-colindex"))-2;(i=this.getColPrevSibling(t))&&!isHiddenCol(r,n)?this.trgtEle=i:n>-1&&this.trgtEle.classList.add("e-unhide-column")}}else if(t.offsetHeight<10&&e.offsetY<Math.ceil((t.offsetHeight-2)/2)||e.offsetY<5&&t.offsetHeight>=10&&t.classList.contains("e-rowresize")){var i;r=this.parent.getActiveSheet(),n=Number(t.parentElement.getAttribute("aria-rowindex"))-2;if((i=this.getRowPrevSibling(t))||isHiddenRow(r,n))if("dblclick"===e.type&&isHiddenRow(r,n)){var o=getSwapRange(getRangeIndexes(r.selectedRange)),a=void 0;a=n<=o[2]&&n>o[0]?{startIndex:o[0],endIndex:o[2],hide:!1,autoFit:!0}:{startIndex:n,endIndex:n,hide:!1,autoFit:!0},this.parent.notify(hideShow,a)}else isHiddenRow(r,n)||(this.trgtEle=i.getElementsByClassName("e-header-cell")[0])}},e.prototype.setAutoFitHandler=function(e){this.setAutofit(e.idx,e.isCol)},e.prototype.setAutofit=function(e,t,r){var n=0,i=this.parent.getActiveSheet(),o=this.parent.getMainContent(),a=t?getColumnWidth(this.parent.getActiveSheet(),e)+"px":getRowHeight(this.parent.getActiveSheet(),e)+"px",s=[],l=0,d=o.getElementsByClassName("e-content-table")[0];if(this.parent.getActiveSheet().showHeaders){(t?this.parent.getColHeaderTable():this.parent.getRowHeaderTable()).getElementsByTagName("tr")}var p=!1,h=0;if(t){for(var c=i.rows.length,u=0;u<c;u++)if(i.rows[u]&&i.rows[u].cells&&i.rows[u].cells[e]){getCell(u,e,i).wrap&&(p=!0,h++);if((m=this.parent.createElement("td",{className:"e-cell"})).textContent=this.parent.getDisplayText(i.rows[u].cells[e]),i.rows[u].cells[e].style){(v=i.rows[u].cells[e].style).fontFamily&&(m.style.fontFamily=v.fontFamily),v.fontSize&&(m.style.fontSize=v.fontSize)}s[n]=m,n++}}else for(var g=i.rows[e]&&i.rows[e].cells?i.rows[e].cells.length:0,f=0;f<g;f++)if(i.rows[e]&&i.rows[e].cells[f]){getCell(e,f,i).wrap&&(p=!0,h++);var m;if((m=this.parent.createElement("td")).textContent=this.parent.getDisplayText(i.rows[e].cells[f]),i.rows[e].cells[f].style){var v;(v=i.rows[e].cells[f].style).fontFamily&&(m.style.fontFamily=v.fontFamily),v.fontSize&&(m.style.fontSize=v.fontSize)}s[n]=m,n++}if(0===h){var C=findMaxValue(d,s,t,this.parent,r,p);t&&(C=this.getFloatingElementWidth(C,e));var y=0===C?parseInt(a,10):C,x=parseInt(a,10)>y?-(parseInt(a,10)-y):y-parseInt(a,10);if(t)if(e>=this.parent.viewport.leftIndex&&e<=this.parent.viewport.rightIndex)getColumn(i,e).width=y>0?y:0,this.resizeStart(e,this.parent.getViewportIndex(e,!0),y+"px",t,!0,r),this.parent.notify(colWidthChanged,{threshold:x,colIdx:e});else{var b,S=getColumnWidth(i,e);b=y>0?-(S-y):-S,this.parent.notify(colWidthChanged,{threshold:b,colIdx:e}),getColumn(i,e).width=y>0?y:0}else if(!t)if(e>=this.parent.viewport.topIndex&&e<=this.parent.viewport.bottomIndex)y=y>20?y:20,l=getRowHeight(i,e),x=y>0?-(l-y):-l,setRowHeight(i,e,y>0?y:0),setRow(i,e,{customHeight:!1}),this.resizeStart(e,this.parent.getViewportIndex(e),y+"px",t,!0,r),this.parent.notify(rowHeightChanged,{threshold:x,rowIdx:e});else{l=getRowHeight(i,e);var w;w=y>0?-(l-y):-l,this.parent.notify(rowHeightChanged,{threshold:w,rowIdx:e}),setRowHeight(i,e,y>0?y:0)}}this.parent.selectRange(this.parent.getActiveSheet().selectedRange)},e.prototype.createResizeHandler=function(e,t){var r=this.parent.createElement("div",{className:t});r.classList.add("e-resize-handle");var n=document.getElementById(this.parent.element.id+"_sheet");e.classList.contains("e-colresize")?(r.style.height=this.parent.getMainContent().parentElement.clientHeight+this.parent.getColumnHeaderContent().offsetHeight+"px",r.style.left=this.event.clientX-n.getBoundingClientRect().left+"px",r.style.top="0px"):e.classList.contains("e-rowresize")&&(r.style.width=this.parent.getMainContent().parentElement.clientWidth+"px",r.style.left="0px",r.style.top=this.event.clientY-n.getBoundingClientRect().top+"px"),n.appendChild(r),this.resizeTooltip(e,!1),this.updateCursor()},e.prototype.resizeTooltip=function(e,t,r){if(t){var n=document.querySelector(".e-header-tooltip"),i=this.parent.element.getElementsByClassName("e-colresize-handler")[0],o=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];if(i){var a=r.clientX-Math.round(this.trgtEle.getBoundingClientRect().left);n&&(n.firstChild.textContent=a>0?"Width:("+a.toString()+" pixels)":"Width: 0.00")}else if(o){var s=r.clientY-Math.round(this.trgtEle.getBoundingClientRect().top);n&&(n.firstChild.textContent=s>0?"Height:("+s.toString()+" pixels)":"Height: 0.00")}}else{var l=e.classList.contains("e-colresize"),d=e.classList.contains("e-rowresize");if(l||d){var p=l?"e-colresize-handler":"e-rowresize-handler",h=new ej2Popups.Tooltip({cssClass:"e-header-tooltip",showTipPointer:!1});l?h.content="Width:("+Math.round(e.getBoundingClientRect().width).toString()+" pixels)":d&&(h.content="Height:("+Math.round(e.getBoundingClientRect().height).toString()+" pixels)",h.offsetX=-(this.parent.getMainContent().parentElement.clientWidth/2-Math.round(e.getBoundingClientRect().width))),h.appendTo("."+p),h.open(),h.refresh()}}},e.prototype.setColWidth=function(e,t,r,n){var i=this.parent.getActiveSheet(),o=getDPRValue(r)-n;if(o<0&&n<-o&&(o=-n),r>0){if(this.isMouseMoved&&this.trgtEle.classList.contains("e-unhide-column"))return this.showHiddenColumns(e,r),void this.parent.notify(completeAction,{eventArgs:{index:e,width:"0px",isCol:!0,sheetIdx:this.parent.activeSheetIndex,oldWidth:n+"px",hide:!1},action:"resize"});this.resizeStart(e,t,r+"px",!0,!1,n+"px"),setColumn(i,e,{width:r,customWidth:!0}),this.parent.notify(colWidthChanged,{threshold:o,colIdx:e,checkWrapCell:!0})}else this.isMouseMoved&&(this.parent.hideColumn(e),this.showHideCopyIndicator(),this.parent.notify(completeAction,{eventArgs:{index:e,width:"0px",isCol:!0,sheetIdx:this.parent.activeSheetIndex,oldWidth:n+"px",hide:!0},action:"resize"}))},e.prototype.showHideCopyIndicator=function(){var e=this.parent.element.getElementsByClassName("e-copy-indicator")[0],t=!1;e&&(ej2Base.detach(e),this.parent.notify(hideAutoFillElement,null),t=!0),t&&this.parent.notify(contentLoaded,{})},e.prototype.showHiddenColumns=function(e,t){var r,n,i,o=this.parent.getActiveSheet(),a=getRangeIndexes(o.selectedRange);if(e>=a[1]&&e<=a[3]&&a[2]===o.rowCount-1&&getCellIndexes(o.activeCell)[0]===getCellIndexes(o.topLeftCell)[0]?(r=a[1],n=a[3],i=this.parent.getMainContent().querySelector("colgroup")):r=n=e,void 0!==t)for(var s=r;s<=n;s++)setColumn(o,s,{width:t,customWidth:!0}),s>=this.parent.viewport.leftIndex&&s<=this.parent.viewport.rightIndex&&!isHiddenCol(o,s)&&(i.children[this.parent.getViewportIndex(s,!0)].style.width=t+"px");this.trgtEle.classList.remove("e-unhide-column"),this.parent.hideColumn(r,n,!1),this.showHideCopyIndicator(),void 0===t&&this.autoFit({isRow:!1,startIndex:r,endIndex:n})},e.prototype.setRowHeight=function(e,t,r,n){var i=this.parent.getActiveSheet(),o=this.parent.frozenColCount(i),a=parseInt(this.parent.getRow(e,null,o).style.height,10),s=r,l=getDPRValue(parseInt(s,10))-a;l<0&&a<-l&&(l=-a),this.resizeStart(e,t,s,!1,!1,n),setRow(i,e,{height:parseInt(s,10)>0?parseInt(s,10):0,customHeight:!0}),this.parent.notify(rowHeightChanged,{threshold:l,rowIdx:e,isCustomHgt:!0})},e.prototype.resizeOn=function(e){var t,r,n=this,i=this.parent.getActiveSheet(),o=getRangeIndexes(i.activeCell),a=getCell(o[0],o[1],i);if(this.trgtEle.classList.contains("e-rowresize")){var s=Number(this.trgtEle.parentElement.getAttribute("aria-rowindex"))-2;if(this.isMouseMoved&&isHiddenRow(i,s)&&this.trgtEle.classList.contains("e-skip-resize")&&e.clientY>this.trgtEle.getBoundingClientRect().top){this.trgtEle.classList.remove("e-skip-resize");var l={startIndex:s,endIndex:s,hide:!1,skipAppend:!0};this.parent.notify(hideShow,l);var d=this.parent.getRowHeaderTable().tBodies[0],p=this.parent.getContentTable().tBodies[0];l.hdrRow.style.display="none",l.row.style.display="none",d.insertBefore(l.hdrRow,d.children[l.insertIdx]),p.insertBefore(l.row,p.children[l.insertIdx]),this.trgtEle=l.hdrRow.firstElementChild,l.hdrRow.nextElementSibling.classList.remove("e-hide-end"),l.mergeCollection.forEach(function(e){n.parent.notify(setMerge,e)})}else if(this.trgtEle.classList.contains("e-skip-resize")){if(this.trgtEle.classList.remove("e-skip-resize"),!this.isMouseMoved&&isHiddenRow(i,s)||!this.trgtEle.parentElement.previousElementSibling)return;this.trgtEle=this.trgtEle.parentElement.previousElementSibling.getElementsByClassName("e-header-cell")[0]}r=t=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,t=this.parent.getViewportIndex(r);var h=this.parent.frozenColCount(i),c=this.parent.getRow(r,null,h).style.height,u=e.clientY-this.event.clientY+parseInt(c,10);if(u<=0)return this.parent.hideRow(r),this.showHideCopyIndicator(),setRow(i,r,{height:0,customHeight:!0}),void this.parent.notify(completeAction,{eventArgs:{index:r,height:"0px",isCol:!1,sheetIdx:this.parent.activeSheetIndex,oldHeight:c},action:"resize"});if(this.setRowHeight(r,t,u+"px",c),a&&a.rowSpan){var g=this.parent.getCell(o[0],o[1]);this.parent.element.querySelector(".e-active-cell").style.height=g.offsetHeight+"px"}if("none"===this.trgtEle.parentElement.style.display){var f=this.parent.getActiveSheet(),m=getSwapRange(getRangeIndexes(f.selectedRange));if(r<=m[2]&&r>m[0]){u=getRowHeight(f,r);for(var v=void 0,C=m[0];C<=m[2];C++)C!==r&&(c=getRowHeight(f,C)+"px",setRow(f,C,{customHeight:!0,height:u}),isHiddenRow(f,C)?v||(v=C):(this.parent.getRow(C).style.height=u+"px",f.showHeaders&&(this.parent.getRow(C,this.parent.getRowHeaderTable()).style.height=u+"px")),this.parent.notify(completeAction,{eventArgs:{index:C,height:u+"px",isCol:!1,sheetIdx:this.parent.activeSheetIndex,oldHeight:c},action:"resize"}));this.parent.hideRow(m[0],r-1,!1),this.showHideCopyIndicator(),t+=Math.abs(r-v)}else 0===t||isHiddenRow(f,r-1)?0!==t&&this.trgtEle.parentElement.classList.add("e-hide-end"):this.trgtEle.parentElement.previousElementSibling.classList.remove("e-hide-start"),this.parent.selectRange(f.selectedRange);this.trgtEle.parentElement.style.display="",this.parent.getContentTable().rows[t].style.display=""}}else if(this.trgtEle.classList.contains("e-colresize")){this.isMouseMoved&&this.trgtEle.classList.contains("e-unhide-column")&&e.clientX<this.trgtEle.getBoundingClientRect().left&&(this.trgtEle.classList.remove("e-unhide-column"),this.trgtEle.previousElementSibling&&(this.trgtEle=this.trgtEle.previousElementSibling)),t=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1;var y=void 0;if(this.trgtEle.classList.contains("e-unhide-column")?(t-=1,y=0):y=getColumnWidth(this.parent.getActiveSheet(),t),this.setColWidth(t,this.parent.getViewportIndex(t,!0),e.clientX-this.event.clientX+y,y),a&&a.colSpan){g=this.parent.getCell(o[0],o[1]);this.parent.element.querySelector(".e-active-cell").style.width=g.offsetWidth+"px"}}a&&a.format&&a.format.indexOf("*")>-1&&this.parent.notify(rowFillHandler,{cell:a,value:a.format[a.format.indexOf("*")+1].toString(),rowIdx:o[0],colIdx:o[1]})},e.prototype.resizeStart=function(e,t,r,n,i,o){setResize(e,t,r,n,this.parent);var a,s,l=i?"resizeToFit":"resize";n?(a={index:e,width:r,isCol:n,sheetIdx:this.parent.activeSheetIndex,oldWidth:o},s=o!==r):(a={index:e,height:r,isCol:n,sheetIdx:this.parent.activeSheetIndex,oldHeight:o},s=o!==r),s&&this.parent.notify(completeAction,{eventArgs:a,action:l})},e.prototype.updateCursor=function(){this.parent.element.getElementsByClassName("e-colresize-handler")[0]?this.parent.element.classList.add("e-col-resizing"):this.parent.element.classList.contains("e-col-resizing")&&this.parent.element.classList.remove("e-col-resizing"),this.parent.element.getElementsByClassName("e-rowresize-handler")[0]?this.parent.element.classList.add("e-row-resizing"):this.parent.element.classList.contains("e-row-resizing")&&this.parent.element.classList.remove("e-row-resizing")},e.prototype.getFloatingElementWidth=function(e,t){var r=e,n={filterRange:[],hasFilter:!1};return this.parent.notify(getFilterRange,n),n.hasFilter&&n.filterRange&&n.filterRange[1]<=t&&n.filterRange[3]>=t&&(r=e+22),r},e.prototype.destroy=function(){this.unwireEvents(),this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"resize"},e}(),CollaborativeEditing=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.refreshClients=function(e){updateAction(e,this.parent)},e.prototype.addEventListener=function(){this.parent.on(collaborativeUpdate,this.refreshClients,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(collaborativeUpdate,this.refreshClients)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"collaborativeEditing"},e}(),ShowHide=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.hideShow=function(e){var t=this.parent.getActiveSheet();if(!t.frozenRows&&!t.frozenColumns){if(e.startIndex>e.endIndex){var r=e.startIndex;e.startIndex=e.endIndex,e.endIndex=r}e.actionUpdate&&(e.cancel=!1,this.parent.notify(beginAction,{eventArgs:e,action:"hideShow"}),e.cancel)||(e.isCol?this.hideCol(e):this.hideRow(e),e.actionUpdate&&this.parent.notify(completeAction,{eventArgs:e,action:"hideShow"}))}},e.prototype.hideRow=function(e){var t,r,n,i,o,a,s=this,l=this.parent.getActiveSheet(),d=0,p=Object.assign({},e),h=this.parent.scrollSettings.isFinite;if(h){if(p.startIndex>=l.rowCount)return;p.endIndex>=l.rowCount&&(p.endIndex=l.rowCount-1),a=0}if(p.hide){for(var c,u=void 0,g=void 0,f=h&&p.endIndex===skipHiddenIdx(l,l.rowCount-1,!1),m=p.startIndex;m<=p.endIndex;m++)if(!isHiddenRow(l,m))if(void 0===r&&(l.showHeaders&&(c=this.parent.getRowHeaderTable()),u=this.parent.getContentTable(),r=this.parent.getViewportIndex(m),d=0),o={hidden:!0},p.isFiltering&&(o.isFiltered=!0),setRow(l,m,o),h&&(a+=getRowHeight(l,m,!0,!0)),this.refreshChart(m,"rows"),g=u&&u.rows[r]){if(!i)for(var v=0;v<=l.usedRange.colIndex;v++)if(((t=getCell(m,v,l)||{}).colSpan||t.rowSpan)&&(p.startIndex>=this.parent.viewport.topIndex||this.parent.scrollSettings.enableVirtualization)){i=!0;break}if(i)continue;if(l.showHeaders&&ej2Base.detach(c.rows[r]),ej2Base.detach(g),d++,(g=u.rows[r])&&m===p.endIndex){var C=void 0,y=(n=skipHiddenIdx(l,m+1,!0))!==skipHiddenIdx(l,0,!0)&&n===(this.parent.viewport.topIndex>=p.startIndex?p.endIndex+1:this.parent.viewport.topIndex)?"Row":"";for(v=this.parent.viewport.leftIndex;v<=this.parent.viewport.rightIndex;v++){""!==(V=this.parent.getCellStyleValue(["borderTop"],[n,v]).borderTop)&&(C=g.cells[v],this.parent.notify(applyCellFormat,{onActionUpdate:!1,rowIdx:n,colIdx:v,style:{borderTop:V},row:g,pRow:g.previousElementSibling,first:y,cell:C}))}}}else m<=this.parent.viewport.bottomIndex?d++:d--;if(i&&(p.startIndex>=this.parent.viewport.topIndex||!this.parent.scrollSettings.enableVirtualization))return this.parent.selectRange(l.selectedRange),void this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Row"});if(!d)return;this.parent.selectRange(l.selectedRange);var x=function(){l.showHeaders&&(0===r?c.rows[0]&&c.rows[0].classList.add("e-hide-end"):(c&&c.rows[r-1]&&c.rows[r-1].classList.add("e-hide-start"),c&&c.rows[r]&&c.rows[r].classList.add("e-hide-end")))};if(this.parent.scrollSettings.enableVirtualization){var b=p.startIndex,S=p.startIndex;if(this.parent.viewport.topIndex>=p.startIndex){if(p.isFiltering&&this.parent.viewport.topIndex!==p.startIndex)return void(p.aboveViewport=!0);this.parent.viewport.topIndex=p.endIndex+1}p.startIndex=this.parent.viewport.bottomIndex+1,p.endIndex=p.startIndex+d-1;var w=this.parent.skipHidden(p.startIndex,p.endIndex,"rows",!1);if(p.startIndex=w[0],p.endIndex=w[1],h){var I=function(){var e=s.parent.viewport.topIndex;s.parent.viewport.bottomIndex=p.endIndex=skipHiddenIdx(l,l.rowCount-1,!1),b=s.parent.viewport.topIndex=s.parent.renderModule.decreaseHidden(p.endIndex-(s.parent.viewport.rowCount+2*s.parent.getThreshold("row")),p.endIndex),s.parent.notify(setScrollEvent,{set:!1}),s.parent.notify(updateTranslate,{isHide:!0,height:a,prevSize:e});var t={skipRowVirualScroll:!0};t.scrollTop=s.parent.getMainContent().parentElement.scrollTop,s.parent.notify(onContentScroll,t),getUpdateUsingRaf(function(){return s.parent.notify(setScrollEvent,{set:!0})}),s.parent.renderModule.refreshUI({rowIndex:s.parent.viewport.topIndex,colIndex:s.parent.viewport.leftIndex,refresh:"Row",skipTranslate:!0})};if(p.startIndex>=l.rowCount)return this.parent.viewport.topIndex===skipHiddenIdx(l,0,!0)?(x(),this.parent.notify(updateTranslate,{isHide:!0,height:a}),void(f&&(this.parent.viewport.bottomIndex=skipHiddenIdx(l,l.rowCount-1,!1)))):void I();if(p.endIndex>=l.rowCount)return void I();this.parent.notify(updateTranslate,{isHide:!0,height:a})}this.parent.viewport.bottomIndex=p.endIndex,d>this.parent.viewport.rowCount+2*this.parent.getThreshold("row")?(b=b<1?S+1:b-1,this.parent.updateTopLeftCell(b,null),this.parent.renderModule.refreshSheet()):this.parent.renderModule.refreshUI({colIndex:this.parent.viewport.leftIndex,direction:"",refresh:"RowPart"},getCellAddress(p.startIndex,this.parent.viewport.leftIndex)+":"+getCellAddress(p.endIndex,this.parent.viewport.rightIndex))}x()}else{var R=void 0,E=void 0,k=void 0,F=(g=void 0,void 0),A=void 0,B=void 0,T=void 0,D=p.startIndex-1,N=void 0,O=[],L=void 0,H="lastElementChild",j=0;if(h){var M=skipHiddenIdx(l,l.rowCount-1,!1);if(this.parent.viewport.bottomIndex===M)if(this.parent.viewport.topIndex===skipHiddenIdx(l,0,!0))L=!0;else{var _=getRangeIndexes(l.topLeftCell)[0];l.rowCount-1-_+1-this.parent.hiddenCount(_,l.rowCount-1)<this.parent.viewport.rowCount+Math.round(this.parent.getThreshold("row")/2)&&(H="firstElementChild")}}m=p.startIndex;for(var P=p.endIndex;m<=P;m++)if(isHiddenRow(l,m))if(void 0===N)if(o={hidden:!1},p.isFiltering&&(o.isFiltered=!1),!L&&m>this.parent.viewport.bottomIndex){if(setRow(l,m,o),void 0===T)return}else{void 0===T&&(T=m),setRow(l,m,o),h&&(a+=getRowHeight(l,m,!0,!0)),this.refreshChart(m,"rows"),void 0===r&&(R=document.createDocumentFragment(),E=document.createDocumentFragment(),F=this.parent.serviceLocator.getService("row"),l.showHeaders&&this.parent.getRowHeaderTable()&&(A=this.parent.getRowHeaderTable().tBodies[0]),B=this.parent.getContentTable()?this.parent.getContentTable().tBodies[0]:this.parent.getContentTable(),m<this.parent.viewport.topIndex&&(this.parent.viewport.topIndex=m),r=0===m?0:this.parent.getViewportIndex(m)),D++,l.showHeaders&&(k=F.refresh(m,null,null,!0),R.appendChild(k),A&&A.childElementCount&&!L&&ej2Base.detach(A[H])),g=E.appendChild(F.refresh(m,g,k)),B&&B.childElementCount&&!L&&(ej2Base.detach(B[H]),"firstElementChild"===H&&(void 0!==r&&r-1>-1&&(r-=1),j+=getRowHeight(l,this.parent.viewport.topIndex,!0),this.parent.viewport.topIndex=skipHiddenIdx(l,this.parent.viewport.topIndex+1,!0)));for(v=this.parent.viewport.leftIndex;v<=this.parent.viewport.rightIndex;v++)if(void 0!==(t=getCell(m,v,l)||{}).rowSpan){var U={range:[m,v,m,v],isAction:!1,merge:!0,type:"All",skipChecking:!0};this.parent.notify(activeCellMergedRange,U),O.length&&U.range[1]===O[O.length-1].range[1]||O.push(U)}}else P=m;else{if(p.startIndex===p.endIndex){for(var v=0;v<=l.usedRange.colIndex;v++)this.parent.notify(addHighlight,{range:getRangeAddress([p.startIndex,v]),td:void 0});return}void 0===r?D++:N=m}if(void 0===r)return;if(this.parent.viewport.bottomIndex=this.parent.viewport.topIndex+this.parent.viewport.rowCount+2*this.parent.getThreshold("row"),d=this.parent.hiddenCount(this.parent.viewport.topIndex,p.startIndex)+this.parent.hiddenCount(p.endIndex+1,this.parent.viewport.bottomIndex),this.parent.viewport.bottomIndex+=d,h&&this.parent.viewport.bottomIndex>=l.rowCount&&(this.parent.viewport.bottomIndex=skipHiddenIdx(l,l.rowCount-1,!1)),p.insertIdx=e.insertIdx=r,p.row=e.row=E.querySelector(".e-row"),p.mergeCollection=e.mergeCollection=O,l.showHeaders&&(e.hdrRow=p.hdrRow=R.querySelector(".e-row"),0!==r&&!isHiddenRow(l,D-1)&&A.children[r-1]&&A.children[r-1].classList.remove("e-hide-start"),0!==p.startIndex&&isHiddenRow(l,p.startIndex-1)&&p.hdrRow.classList.add("e-hide-end"),isHiddenRow(l,D+1)?R.lastElementChild.classList.add("e-hide-start"):A.children[r]&&A.children[r].classList.remove("e-hide-end")),g&&B&&B.children[r]){n=skipHiddenIdx(l,D+1,!0);for(m=this.parent.viewport.leftIndex;m<=this.parent.viewport.rightIndex;m++){var V;if(""!==(V=this.parent.getCellStyleValue(["borderTop"],[n,m]).borderTop)){this.parent.notify(applyCellFormat,{onActionUpdate:!1,rowIdx:n,colIdx:m,style:{borderTop:V},pRow:g,cell:B.children[r].children[m],first:""});var z=skipHiddenIdx(l,T-1,!1);z>-1?!B.children[r-1]||this.parent.getCellStyleValue(["borderBottom"],[z,m]).borderBottom||this.parent.getCellStyleValue(["borderTop"],[T,m]).borderTop||(B.children[r-1].children[m].style.borderBottom=""):B.children[r].children[m].style.borderTop=""}}}if(p.skipAppend)return;h&&this.parent.notify(updateTranslate,{height:a,size:j}),Math.abs(D-T)>this.parent.viewport.rowCount+2*this.parent.getThreshold("row")?this.parent.renderModule.refreshSheet():(l.showHeaders&&A&&A.insertBefore(R,A.children[r]),B&&B.insertBefore(E,B.children[r]),this.parent.selectRange(l.selectedRange),p.autoFit&&l.showHeaders&&this.parent.notify(autoFit,{startIndex:p.startIndex,endIndex:p.endIndex,isRow:!0}),O.forEach(function(e){s.parent.notify(setMerge,e)}),void 0!==N&&N!==p.endIndex&&(p.startIndex=N,this.hideRow(p)))}},e.prototype.hideCol=function(e){for(var t,r=this,n=this.parent.getActiveSheet(),i=[],o=[],a=getCellIndexes(n.topLeftCell),s=e.startIndex;s<=e.endIndex;s++)(e.hide?!isHiddenCol(n,s):isHiddenCol(n,s))&&(setColumn(n,s,{hidden:e.hide}),this.refreshChart(s,"columns"),this.parent.scrollSettings.enableVirtualization&&(s<this.parent.viewport.leftIndex||s>this.parent.viewport.rightIndex)?s<this.parent.viewport.leftIndex&&o.push(s):(i.push(s),e.hide&&a[1]===s&&(t=!0)));if(o.length||i.length)if(e.hide){if(!i.length)return;if((i.length<=this.parent.getThreshold("col")||!this.parent.scrollSettings.enableVirtualization)&&this.removeCell(n,i),this.parent.scrollSettings.enableVirtualization){if(i[0]===this.parent.viewport.leftIndex&&(this.parent.viewport.leftIndex=skipHiddenIdx(n,i[i.length-1]+1,!0,"columns")),t){var l=0;if(i.slice(0,i.indexOf(a[1])).forEach(function(e){l+=getColumnWidth(n,e,!0)}),l){this.parent.notify(setScrollEvent,{set:!1});var d=this.parent.getMainContent();d.scrollLeft-=l,this.parent.notify(onContentScroll,{scrollLeft:d.scrollLeft,preventScroll:!0,skipHidden:!0}),getUpdateUsingRaf(function(){return r.parent.notify(setScrollEvent,{set:!0})})}}if(this.parent.scrollSettings.isFinite){var p=skipHiddenIdx(n,n.colCount-1,!1,"columns"),h=this.parent.viewport.leftIndex,c=this.parent.viewport.rightIndex;if(c+i.length>=p){var u=skipHiddenIdx(n,h-(c+i.length-p),!1,"columns");return u>-1&&(this.parent.viewport.leftIndex=u,this.parent.viewport.leftIndex-=this.parent.hiddenCount(c,p)),this.parent.viewport.rightIndex=p,h!==this.parent.viewport.leftIndex||c!==this.parent.viewport.rightIndex?this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===skipHiddenIdx(n,0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"}):this.parent.notify(updateTableWidth,{refresh:"Column",isUpdate:!0}),void this.parent.selectRange(n.selectedRange)}}if(i.length<=this.parent.getThreshold("col")){var g=this.parent.skipHidden(this.parent.viewport.rightIndex+1,this.parent.viewport.rightIndex+i.length,"columns");this.parent.viewport.rightIndex=g[1],this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:g[0],direction:"",refresh:"ColumnPart"},""+getRangeAddress([this.parent.viewport.topIndex,g[0],this.parent.viewport.bottomIndex,g[1]]))}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===skipHiddenIdx(n,0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"})}this.parent.selectRange(n.selectedRange)}else{if(o.length){if(o.sort(function(e,t){return e-t}),this.parent.scrollSettings.enableVirtualization&&o[0]<this.parent.getThreshold("col")){var f=getCellIndexes(n.topLeftCell)[0]+1;this.parent.setSheetPropertyOnMute(n,"topLeftCell","A"+f),this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,rowIndex:this.parent.viewport.topIndex,colIndex:0,refresh:"Column"}),this.parent.selectRange(n.selectedRange)}else this.parent.goTo(getCellAddress(this.parent.viewport.topIndex,o[0]));return}i.length<=this.parent.getThreshold("col")||!this.parent.scrollSettings.enableVirtualization?(this.appendCell(n,i),this.parent.scrollSettings.enableVirtualization&&this.parent.notify(virtualContentLoaded,{refresh:"Column",prevRowColCnt:{rowCount:n.rowCount,colCount:n.colCount}})):this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===skipHiddenIdx(n,0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"}),this.parent.selectRange(n.selectedRange)}},e.prototype.removeCell=function(e,t){var r,n,i,o,a,s,l=this,d=0,p=this.parent.getViewportIndex(t[0],!0)+1;this.parent.scrollSettings.enableVirtualization?(r=this.parent.viewport.topIndex,n=this.parent.viewport.bottomIndex):(r=0,n=e.rowCount-1);var h,c=this.parent.getContentTable(),u=c.getElementsByTagName("colgroup")[0];if(e.showHeaders){var g=this.parent.getColHeaderTable();a=g.getElementsByTagName("colgroup")[0],i=g.rows[0]}for(var f=t.length-1;r<=n;)isHiddenRow(e,r)?r++:(o=c.rows[d],t.forEach(function(n,c){if(ej2Base.detach(o.cells[p]),0===d&&(e.showHeaders&&(ej2Base.detach(i.cells[p]),ej2Base.detach(a.children[p])),ej2Base.detach(u.children[p])),0===c&&void 0!==(s=getCell(r,n,e)||{}).colSpan&&(void 0===s.rowSpan||s.colSpan>1)&&l.parent.notify(hiddenMerge,{rowIdx:r,colIdx:n,model:"col",start:t[0],end:t[f]}),c===f){h=skipHiddenIdx(e,n+1,!0,"columns");var g=l.parent.getCellStyleValue(["borderLeft"],[d,h]).borderLeft;""!==g&&l.parent.notify(applyCellFormat,{onActionUpdate:!1,rowIdx:d,colIdx:h,style:{borderLeft:g},row:o,first:""}),void 0!==(s=getCell(r,n,e)||{}).colSpan&&(void 0===s.rowSpan||s.colSpan>1)&&l.parent.notify(hiddenMerge,{rowIdx:r,colIdx:n,model:"col",start:t[0],end:t[f],isEnd:!0})}}),r++,d++);p-1>-1&&e.showHeaders&&i.cells[p-1]&&i.cells[p-1].classList.add("e-hide-start"),e.showHeaders&&i.cells[p]&&i.cells[p].classList.add("e-hide-end")},e.prototype.appendCell=function(e,t){var r,n,i,o,a,s,l=this,d=0;this.parent.scrollSettings.enableVirtualization?(r=this.parent.viewport.topIndex,n=this.parent.viewport.bottomIndex):(r=0,n=e.rowCount-1);var p=this.parent.getContentTable(),h=this.parent.getColHeaderTable(),c=p.getElementsByTagName("colgroup")[0];e.showHeaders&&(a=h.getElementsByTagName("colgroup")[0],i=h.rows[0]);var u=this.parent.serviceLocator.getService("cell");t.sort(function(e,t){return e-t});for(var g,f,m,v=[],C=[],y=t.length-1;r<=n;)isHiddenRow(e,r)?r++:(o=p.rows[d],t.forEach(function(n,p){if(0===d&&(C[p]=l.parent.getViewportIndex(n,!0),c.children[C[p]]?(c.insertBefore(l.parent.sheetModule.updateCol(e,n),c.children[C[p]]),e.showHeaders&&(m=i.cells[C[p]],0===p&&t[p]&&!isHiddenCol(e,t[p]-1)&&m.previousElementSibling.classList.remove("e-hide-start"),i.insertBefore(u.renderColHeader(n),m),p===y&&m.classList.remove("e-hide-end"))):(c.appendChild(l.parent.sheetModule.updateCol(e,n)),e.showHeaders&&i.appendChild(u.renderColHeader(n))),ej2Base.detach(c.lastChild),e.showHeaders&&(ej2Base.detach(i.lastChild),p===y&&(ej2Base.detach(a),h.insertBefore(c.cloneNode(!0),h.tHead[0])))),ej2Base.detach(o.lastChild),m=o.cells[C[p]],f=u.render({rowIdx:r,colIdx:n,cell:getCell(r,n,e),address:getCellAddress(r,n),lastCell:n===y,isHeightCheckNeeded:!0,first:n!==skipHiddenIdx(e,0,!0,"columns")&&n===l.parent.viewport.leftIndex?"Column":"",checkNextBorder:p===y?"Column":""}),m?o.insertBefore(f,m):o.appendChild(f),0===p&&f.previousSibling){""!==l.parent.getCellStyleValue(["borderLeft"],[d,skipHiddenIdx(e,t[t.length-1]+1,!0,"columns")]).borderLeft&&(s=skipHiddenIdx(e,t[0]-1,!1,"columns"))>-1&&!l.parent.getCellStyleValue(["borderRight"],[d,s]).borderRight&&!l.parent.getCellStyleValue(["borderLeft"],[d,t[0]]).borderLeft&&(f.previousSibling.style.borderRight="")}if(void 0!==(g=getCell(d,n,e)||{}).colSpan&&(void 0===g.rowSpan||g.colSpan>1)){var x={range:[d,n,d,n],isAction:!1,merge:!0,type:"All",skipChecking:!0};l.parent.notify(activeCellMergedRange,x),v.length&&x.range[1]===v[v.length-1].range[1]||v.push(x)}}),r++,d++);v.forEach(function(e){l.parent.notify(setMerge,e)}),this.parent.viewport.rightIndex=skipHiddenIdx(e,this.parent.viewport.rightIndex-t.length,!1,"columns")},e.prototype.refreshChart=function(e,t){this.parent.notify(refreshChart,{rIdx:e,showHide:t})},e.prototype.addEventListener=function(){this.parent.on(hideShow,this.hideShow,this),this.parent.on(spreadsheetDestroyed,this.destroy,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.off(hideShow,this.hideShow),this.parent.off(spreadsheetDestroyed,this.destroy)},e}(),SpreadsheetHyperlink=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(initiateHyperlink,this.initiateHyperlinkHandler,this),this.parent.on(editHyperlink,this.editHyperlinkHandler,this),this.parent.on(openHyperlink,this.openHyperlinkHandler,this),this.parent.on(click,this.hyperlinkClickHandler,this),this.parent.on(createHyperlinkElement,this.createHyperlinkElementHandler,this),this.parent.on(keyUp,this.keyUpHandler,this),this.parent.on(deleteHyperlink,this.removeHyperlink,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(initiateHyperlink,this.initiateHyperlinkHandler),this.parent.off(editHyperlink,this.editHyperlinkHandler),this.parent.off(openHyperlink,this.openHyperlinkHandler),this.parent.off(click,this.hyperlinkClickHandler),this.parent.off(createHyperlinkElement,this.createHyperlinkElementHandler),this.parent.off(keyUp,this.keyUpHandler),this.parent.off(deleteHyperlink,this.removeHyperlink))},e.prototype.getModuleName=function(){return"spreadsheetHyperlink"},e.prototype.keyUpHandler=function(e){var t=e.target;if(ej2Base.closest(t,".e-document")){var r=document.querySelector(".e-hyp-text"),n=this.parent.element.querySelector(".e-hyperlink-alert-span"),i=(ej2Base.closest(t,".e-hyperlink-dlg")||ej2Base.closest(t,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;r&&r.value&&(isCellReference(r.value.toUpperCase())?n&&(n.remove(),i.removeAttribute("disabled")):(this.showDialog(),i.setAttribute("disabled","true")))}if(t.classList.contains("e-text")&&ej2Base.closest(t,".e-cont")&&ej2Base.closest(t,".e-webpage")&&ej2Base.closest(t,".e-webpage").getElementsByClassName("e-cont")[1]===t.parentElement){i=(ej2Base.closest(t,".e-hyperlink-dlg")||ej2Base.closest(t,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;if(""!==t.value)i.removeAttribute("disabled");else{!!ej2Base.closest(t,".e-link-dialog").querySelector(".e-webpage").querySelectorAll(".e-cont")[1].querySelector(".e-text").value||i.setAttribute("disabled","true")}}},e.prototype.initiateHyperlinkHandler=function(){var e=this,t=this.parent.serviceLocator.getService(locale),r=this.parent.getActiveSheet();if(!r.isProtected||r.protectSettings.insertLink){if(!this.parent.element.querySelector(".e-hyperlink-dlg")){var n=this.parent.serviceLocator.getService(dialog);n.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-hyperlink-dlg",header:t.getConstant("InsertLink"),beforeOpen:function(t){var r={dialogName:"InsertLinkDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel&&(t.cancel=!0),n.dialogInstance.content=e.hyperlinkContent(),n.dialogInstance.dataBind(),focus(e.parent.element)},open:function(){setTimeout(function(){focus(n.dialogInstance.element.querySelectorAll(".e-webpage input")[1])})},buttons:[{buttonModel:{content:t.getConstant("Insert"),isPrimary:!0,disabled:!0},click:function(){e.dlgClickHandler(),n.hide()}}]})}}else this.parent.notify(editAlert,null)},e.prototype.dlgClickHandler=function(){var e,t,r=this.parent.element.querySelector(".e-link-dialog").getElementsByClassName("e-content")[0].querySelector(".e-item.e-active");if(r)if(r.querySelector(".e-webpage")){e=r.getElementsByClassName("e-cont")[0].querySelector(".e-text").value;var n={address:t=r.getElementsByClassName("e-cont")[1].querySelector(".e-text").value};this.parent.insertHyperlink(n,this.parent.getActiveSheet().activeCell,e,!1)}else{e=r.getElementsByClassName("e-cont")[0].querySelector(".e-text").value,t=r.getElementsByClassName("e-cont")[1].querySelector(".e-text").value;var i=r.getElementsByClassName("e-cont")[2];if(i.getElementsByClassName("e-list-item")[0].querySelector(".e-active")){n={address:t=r.getElementsByClassName("e-cont")[2].querySelector(".e-active").textContent+"!"+t.toUpperCase()};this.parent.insertHyperlink(n,this.parent.getActiveSheet().activeCell,e,!1)}else if(i.querySelector(".e-active"))for(var o=r.getElementsByClassName("e-cont")[2].querySelector(".e-active").textContent,a=0;a<this.parent.definedNames.length;a++)if(this.parent.definedNames[a].name===o){n={address:this.parent.definedNames[a].name};this.parent.insertHyperlink(n,this.parent.getActiveSheet().activeCell,e,!1)}}},e.prototype.showDialog=function(){this.parent.element.querySelector(".e-hyperlink-alert-span")&&this.parent.element.querySelector(".e-hyperlink-alert-span").remove();var e=this.parent.serviceLocator.getService(locale),t=this.parent.createElement("span",{className:"e-hyperlink-alert-span",innerHTML:e.getConstant("HyperlinkAlert")});(this.parent.element.querySelector(".e-hyperlink-dlg")||this.parent.element.querySelector(".e-edithyperlink-dlg")).querySelector(".e-dlg-content").appendChild(t)},e.prototype.editHyperlinkHandler=function(){var e=this,t=this.parent.serviceLocator.getService(locale),r=this.parent.serviceLocator.getService(dialog);r.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-edithyperlink-dlg",header:t.getConstant("EditLink"),beforeOpen:function(t){var n={dialogName:"EditLinkDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),r.dialogInstance.content=e.hyperEditContent(),r.dialogInstance.dataBind(),focus(e.parent.element)},open:function(){setTimeout(function(){r.dialogInstance.element.querySelector(".e-webpage")?focus(r.dialogInstance.element.querySelectorAll(".e-webpage input")[1]):focus(r.dialogInstance.element.querySelectorAll(".e-document input")[1])})},buttons:[{buttonModel:{content:t.getConstant("Update"),isPrimary:!0},click:function(){e.dlgClickHandler(),r.hide()}}]})},e.prototype.openHyperlinkHandler=function(){var e=getCellIndexes(this.parent.getActiveSheet().activeCell),t=this.parent.getCell(e[0],e[1]);t.getElementsByClassName("e-hyperlink")[0]&&(t=t.querySelector(".e-hyperlink")),this.hlOpenHandler(t)},e.prototype.hlOpenHandler=function(e){var t=this;if(e.classList.contains("e-hyperlink")){var r=["",""],n=void 0,i=!0;e.style.color="#551A8B",ej2Base.closest(e,".e-cell")&&(ej2Base.closest(e,".e-cell").style.color="#551A8B");var o=this.parent.getActiveSheet(),a=parseInt(e.parentElement.getAttribute("aria-colindex"),10)-1,s=parseInt(e.parentElement.parentElement.getAttribute("aria-rowindex"),10)-1,l=o.rows[s].cells[a].hyperlink,d=void 0,p={hyperlink:l,cell:this.parent.getActiveSheet().activeCell,target:"_blank",cancel:!1};if(this.parent.trigger(beforeHyperlinkClick,p),p.cancel)return;var h={hyperlink:l=p.hyperlink,cell:this.parent.getActiveSheet().activeCell};"string"==typeof l&&(d=l),"object"==typeof l&&(d=l.address);var c=d;if(-1===d.indexOf("http://")&&-1===d.indexOf("https://")&&-1===d.indexOf("ftp://")){if(!ej2Base.isNullOrUndefined(d)){if(this.parent.definedNames)for(var u=0;u<this.parent.definedNames.length;u++)if(this.parent.definedNames[u].name===d){d=(d=this.parent.definedNames[u].refersTo).slice(1);break}-1!==d.indexOf("!")?-1!==(r=d.split("!"))[0].indexOf(" ")&&(r[0]=r[0].slice(1,r[0].length-1)):(r[0]=this.parent.getActiveSheet().name,r[1]=d);var g;for(u=0;u<this.parent.sheets.length;u++)this.parent.sheets[u].name===r[0]&&(g=u);if(o=this.parent.sheets[g],-1!==r[1].indexOf(":")){var f=r[1].indexOf(":"),m=r[1].substr(0,f),v=r[1].substr(f+1,r[1].length);m=m.replace("$",""),(v=v.replace("$","")).match(/\D/g)&&!v.match(/[0-9]/g)&&m.match(/\D/g)&&!m.match(/[0-9]/g)?(m+="1",v+=o.rowCount,r[1]=m+":"+v):!v.match(/\D/g)&&v.match(/[0-9]/g)&&!m.match(/\D/g)&&m.match(/[0-9]/g)&&(n=[parseInt(m,10)-1,0,parseInt(v,10)-1,o.colCount-1],i=!1)}var C=void 0,y=this.parent.definedNames;if(!ej2Base.isNullOrUndefined(y))for(u=0;u<y.length;u++)if(y[u].name===c){C=!0;break}if(isCellReference(r[1])||C){if(n=i?getRangeIndexes(r[1]):n,this.parent.scrollSettings.enableVirtualization&&(n[0]=n[0]>=this.parent.viewport.topIndex?n[0]-this.parent.viewport.topIndex:n[0],n[1]=n[1]>=this.parent.viewport.leftIndex?n[1]-this.parent.viewport.leftIndex:n[1]),!ej2Base.isNullOrUndefined(o)){var x=getRangeAddress(n);if(o===this.parent.getActiveSheet())getUpdateUsingRaf(function(){t.parent.goTo(x)});else{if(x.indexOf(":")>=0){var b=x.split(":");x=b[0]===b[1]?b[0]:x}getUpdateUsingRaf(function(){t.parent.goTo(t.parent.sheets[g].name+"!"+x)})}}}else this.showInvalidHyperlinkDialog()}}else this.isValidUrl(d)?window.open(d,p.target):this.showInvalidHyperlinkDialog();this.parent.trigger(afterHyperlinkClick,h)}},e.prototype.isValidUrl=function(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)},e.prototype.showInvalidHyperlinkDialog=function(){var e=this.parent.serviceLocator.getService(dialog),t=this.parent.serviceLocator.getService(locale);e.show({width:323,isModal:!0,showCloseIcon:!0,header:t.getConstant("Hyperlink"),content:t.getConstant("InvalidHyperlinkAlert"),buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:function(){e.hide()}}]},!1)},e.prototype.hyperlinkClickHandler=function(e){var t=e.target;if(ej2Base.closest(t,".e-link-dialog")&&ej2Base.closest(t,".e-toolbar-item")){var r=(d=ej2Base.closest(t,".e-hyperlink-dlg")||ej2Base.closest(t,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild,n=d.querySelector(".e-document"),i=d.querySelector(".e-webpage"),o=i?i.querySelectorAll(".e-cont")[0].querySelector(".e-text").value:n.querySelectorAll(".e-cont")[0].querySelector(".e-text").value,a=n?n.querySelectorAll(".e-cont")[0].querySelector(".e-text").value:o;if(ej2Base.closest(t,".e-toolbar-items").getElementsByClassName("e-toolbar-item")[1].classList.contains("e-active")){var s=n.querySelectorAll(".e-cont")[2].querySelector(".e-active");n.querySelectorAll(".e-cont")[0].querySelector(".e-text").value=o,ej2Base.closest(s,".e-list-item").classList.contains("e-level-2")&&r.hasAttribute("disabled")?r.removeAttribute("disabled"):ej2Base.closest(s,".e-list-item").classList.contains("e-level-1")&&!r.hasAttribute("disabled")&&r.setAttribute("disabled","true")}else{var l=!i.querySelectorAll(".e-cont")[1].querySelector(".e-text").value;i.querySelectorAll(".e-cont")[0].querySelector(".e-text").value=a,l&&!r.hasAttribute("disabled")?r.setAttribute("disabled","true"):!l&&r.hasAttribute("disabled")&&r.removeAttribute("disabled")}}if(ej2Base.closest(t,".e-list-item")&&t.classList.contains("e-fullrow")){var d,p=this.parent.element.getElementsByClassName("e-link-dialog")[0].getElementsByClassName("e-content")[0].getElementsByClassName("e-active")[0].getElementsByClassName("e-cont")[1].getElementsByClassName("e-text")[0];r=(d=ej2Base.closest(t,".e-hyperlink-dlg")||ej2Base.closest(t,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;ej2Base.closest(t,".e-list-item").classList.contains("e-level-2")?("defName"===ej2Base.closest(t,".e-list-item").getAttribute("data-uid")?p.classList.contains("e-disabled")||p.hasAttribute("readonly")||(p.setAttribute("readonly","true"),p.classList.add("e-disabled"),p.setAttribute("disabled","true")):"sheet"===ej2Base.closest(t,".e-list-item").getAttribute("data-uid")&&p.classList.contains("e-disabled")&&p.hasAttribute("readonly")&&(p.removeAttribute("readonly"),p.classList.remove("e-disabled"),p.removeAttribute("disabled")),r.hasAttribute("disabled")&&r.removeAttribute("disabled")):ej2Base.closest(t,".e-list-item").classList.contains("e-level-1")&&r.setAttribute("disabled","true")}else this.hlOpenHandler(t)},e.prototype.createHyperlinkElementHandler=function(e){var t=e.cell,r=e.td,n=this.parent.createElement("a",{className:"e-hyperlink e-hyperlink-style"});if(n.style.color="#00e",ej2Base.isNullOrUndefined(t.hyperlink))r.querySelector("a")&&t.hyperlink&&"string"==typeof t.hyperlink&&r.querySelector("a").setAttribute("href",t.hyperlink);else{var i=t.hyperlink;"string"==typeof i?(-1===i.indexOf("http://")&&-1===i.indexOf("https://")&&-1===i.indexOf("ftp://")&&-1!==i.indexOf("www.")&&(i="http://"+i),0===i.indexOf("http://")||0===i.indexOf("https://")||0===i.indexOf("ftp://")?(n.setAttribute("href",i),n.setAttribute("target","_blank")):(i.includes("=")||i.includes("!"))&&n.setAttribute("ref",i),n.innerText=""!==r.innerText?r.innerText:i,r.textContent="",r.innerText="",r.appendChild(n)):"object"==typeof i&&(0===i.address.indexOf("http://")||0===i.address.indexOf("https://")||0===i.address.indexOf("ftp://")?(n.setAttribute("href",i.address),n.setAttribute("target","_blank")):(i.address.includes("=")||i.address.includes("!"))&&n.setAttribute("ref",i.address),"Accounting"===getTypeFromFormat(t.format)?n.innerHTML=r.innerHTML:n.innerText=""!==r.innerText?r.innerText:i.address,r.textContent="",r.innerText="",r.appendChild(n))}},e.prototype.hyperEditContent=function(){var e=!0,t=this.hyperlinkContent(),r=getRangeIndexes(this.parent.getActiveSheet().activeCell),n=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[r[0]].cells[r[1]];this.parent.scrollSettings.enableVirtualization&&(r[0]=r[0]-this.parent.viewport.topIndex,r[1]=r[1]-this.parent.viewport.leftIndex);var i,o=this.parent.getDisplayText(n),a=n.hyperlink;"string"==typeof a?(i=a,o=o||i,-1===i.indexOf("http://")&&-1===i.indexOf("https://")&&-1===i.indexOf("ftp://")&&(e=!1)):"object"==typeof a&&(i=a.address,o=o||i,-1===i.indexOf("http://")&&-1===i.indexOf("https://")&&-1===i.indexOf("ftp://")&&(e=!1));for(var s=0,l=0,d=this.parent.definedNames,p=this.parent.sheets,h=0,c=d.length;h<c;h++)d[h].name===i&&s++;for(h=0,c=p.length;h<c;h++)i.includes(p[h].name)&&l++;0===s&&0===l&&(e=!0);var u=t.querySelector(".e-content");if(e){var g=u.querySelector(".e-webpage");if(g.getElementsByClassName("e-cont")[0].getElementsByClassName("e-text")[0].setAttribute("value",o),"string"==typeof a)g.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",a);else{g.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",a.address)}}else{var f=void 0,m=u.querySelector(".e-document");m.getElementsByClassName("e-cont")[0].getElementsByClassName("e-text")[0].setAttribute("value",o);var v=void 0;if(this.parent.definedNames)for(h=0;h<this.parent.definedNames.length;h++)if(this.parent.definedNames[h].name===i){f=!0;break}if(f){var C=m.getElementsByClassName("e-cont")[1].getElementsByClassName("e-text")[0];C.setAttribute("readonly","true"),C.classList.add("e-disabled"),C.setAttribute("disabled","true");var y=m.getElementsByClassName("e-cont")[2].querySelectorAll(".e-list-item.e-level-1")[1];for(h=0;h<y.getElementsByTagName("li").length;h++)y.getElementsByTagName("li")[h].innerText===i&&y.getElementsByTagName("li")[h].classList.add("e-active")}else{i&&-1!==i.indexOf("!")&&(v=i.split("!"));var x=v[0];m.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",v[1]);for(y=m.getElementsByClassName("e-cont")[2].querySelectorAll(".e-list-item.e-level-1")[0],h=0;h<y.getElementsByTagName("li").length;h++)if(y.getElementsByTagName("li")[h].innerText===x){if(y.getElementsByTagName("li")[h].classList.contains("e-active"))break;y.getElementsByTagName("li")[h].classList.add("e-active")}else y.getElementsByTagName("li")[h].classList.contains("e-active")&&y.getElementsByTagName("li")[h].classList.remove("e-active")}}return t},e.prototype.hyperlinkContent=function(){var e,t,r=this.parent.serviceLocator.getService(locale),n=0,i=0,o=!0,a=!0,s=getRangeIndexes(this.parent.getActiveSheet().activeCell),l=this.parent.getActiveSheet(),d=getCell(s[0],s[1],l),p=!0;if(d){p=!!(d.value&&"string"==typeof d.value&&null!==d.value.match("[A-Za-z]+")||""===d.value||ej2Base.isNullOrUndefined(d.value));var h=d.hyperlink;if("string"==typeof h){-1===(c=h).indexOf("http://")&&-1===c.indexOf("https://")&&-1===c.indexOf("ftp://")&&(t=h,o=!1)}else if("object"==typeof h){var c;-1===(c=h.address).indexOf("http://")&&-1===c.indexOf("https://")&&-1===c.indexOf("ftp://")&&(t=h.address,o=!1)}if(t){for(var u=0,g=0,f=this.parent.definedNames,m=this.parent.sheets,v=0,C=m.length;v<C;v++)t.includes(m[v].name)&&g++;var y=0;for(C=f.length;y<C;y++)f[y].name===t&&u++;0===u&&0===g&&(o=!0)}if(i=o?0:1,this.parent.definedNames)for(var x=0;x<this.parent.definedNames.length;x++)if(this.parent.definedNames[x].name===t){e=!0,a=!1;break}}var b=this.parent.createElement("div",{className:"e-link-dialog"}),S=this.parent.createElement("div",{className:"e-webpage"}),w=this.parent.createElement("div",{className:"e-document"});new ej2Navigations.Tab({selectedItem:i,items:[{header:{text:r.getConstant("WebPage")},content:S},{header:{text:r.getConstant("ThisDocument")},content:w}]}).appendTo(b),o?b.querySelector(".e-toolbar-items").querySelector(".e-indicator").setAttribute("style","left: 0; right: 136px"):b.querySelector(".e-toolbar-items").querySelector(".e-indicator").setAttribute("style","left: 136px; right: 0");var I=this.parent.createElement("div",{className:"e-cont"}),R=this.parent.createElement("div",{className:"e-cont"}),E=this.parent.createElement("div",{className:"e-header",innerHTML:r.getConstant("DisplayText")}),k=this.parent.createElement("div",{className:"e-header",innerHTML:r.getConstant("Url")}),F=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});p||(F.classList.add("e-disabled"),F.setAttribute("readonly","true"),F.setAttribute("disabled","true")),d&&ej2Base.isNullOrUndefined(d.hyperlink)&&F.setAttribute("value",this.parent.getDisplayText(d));var A=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});F.setAttribute("placeholder",r.getConstant("EnterTheTextToDisplay")),A.setAttribute("placeholder",r.getConstant("EnterTheUrl")),I.appendChild(F),I.insertBefore(E,F),R.appendChild(A),R.insertBefore(k,A),S.appendChild(R),S.insertBefore(I,R);for(var B=[],T=[],D=this.parent.sheets;n<this.parent.sheets.length;n++){var N=this.parent.sheets[n].name;"Visible"===this.parent.sheets[n].state&&(D[n]===this.parent.getActiveSheet()?B.push({nodeId:"sheet",nodeText:-1!==N.indexOf(" ")?"'"+N+"'":N,selected:!0}):B.push({nodeId:"sheet",nodeText:-1!==N.indexOf(" ")?"'"+N+"'":N}))}for(n=0;n<this.parent.definedNames.length;n++)T.push({nodeId:"defName",nodeText:this.parent.definedNames[n].name});var O=[{nodeId:"01",nodeText:r.getConstant("CellReference"),expanded:a,nodeChild:B},{nodeId:"02",nodeText:r.getConstant("DefinedNames"),expanded:e,nodeChild:T}],L=new ej2Navigations.TreeView({fields:{dataSource:O,id:"nodeId",text:"nodeText",child:"nodeChild"}}),H=this.parent.createElement("div",{className:"e-cont"}),j=this.parent.createElement("div",{className:"e-header",innerHTML:r.getConstant("CellReference")}),M=this.parent.createElement("input",{className:"e-input e-text e-hyp-text",attrs:{type:"Text"}});M.setAttribute("value","A1"),H.appendChild(M),H.insertBefore(j,M);var _=this.parent.createElement("div",{className:"e-cont"}),P=this.parent.createElement("div",{className:"e-header",innerHTML:r.getConstant("DisplayText")}),U=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});p||(U.classList.add("e-disabled"),U.setAttribute("readonly","true"),U.setAttribute("disabled","true")),d&&ej2Base.isNullOrUndefined(d.hyperlink)&&U.setAttribute("value",this.parent.getDisplayText(d)),U.setAttribute("placeholder",r.getConstant("EnterTheTextToDisplay")),_.appendChild(U),_.insertBefore(P,U);var V=this.parent.createElement("div",{className:"e-cont"}),z=this.parent.createElement("div",{className:"e-header",innerHTML:r.getConstant("Sheet")}),q=this.parent.createElement("div",{className:"e-refcont"});return V.appendChild(q),V.insertBefore(z,q),w.appendChild(H),w.insertBefore(_,H),L.appendTo(q),w.appendChild(V),b},e.prototype.removeHyperlink=function(e){var t=getCell(e.rowIdx,e.colIdx,e.sheet);t&&t.hyperlink&&("string"==typeof t.hyperlink?t.value=t.value?t.value:t.hyperlink:t.value=t.value?t.value:t.hyperlink.address,delete t.hyperlink,t.style&&(delete t.style.textDecoration,delete t.style.color),t.validation&&t.validation.isHighlighted&&t.style.backgroundColor&&(t.style.color="#ff0000"),e.sheet===this.parent.getActiveSheet()&&(t.style&&this.parent.notify(refreshRibbonIcons,null),e.preventRefresh||this.parent.serviceLocator.getService("cell").refreshRange([e.rowIdx,e.colIdx,e.rowIdx,e.colIdx])))},e}(),UndoRedo=function(){function e(e){this.undoCollection=[],this.redoCollection=[],this.isUndo=!1,this.undoRedoStep=100,this.parent=e,this.addEventListener()}return e.prototype.setActionData=function(e){var t,r=this.parent.getActiveSheet(),n=[],i=[],o=e.args,a=o.eventArgs,s={};switch(o.action){case"format":t=getRangeIndexes(o.eventArgs.range);break;case"clipboard":s=a.copiedInfo,t=getRangeIndexes(getRangeFromAddress(a.pastedRange)),s&&s.isCut&&(i=this.getCellDetails(s.range,getSheet(this.parent,getSheetIndexFromId(this.parent,s.sId)),"clipboard"));break;case"beforeSort":(t=getRangeIndexes(o.eventArgs.range))[0]===t[2]&&t[2]-t[0]==0&&(t[0]=0,t[1]=0,t[2]=r.usedRange.rowIndex,t[3]=r.usedRange.colIndex);break;case"beforeCellSave":case"cellDelete":t=getRangeIndexes(a.address);break;case"beforeWrap":case"beforeReplace":t=this.parent.getAddressInfo(a.address).indices;break;case"beforeClear":case"beforeInsertImage":case"beforeInsertChart":case"filter":t=getRangeIndexes(a.range);break;case"autofill":t=getRangeIndexes(a.fillRange);break;case"removeValidation":t=getRangeIndexes(a.range)}n=this.getCellDetails(t,r,o.action),this.beforeActionData={cellDetails:n,cutCellDetails:i}},e.prototype.getBeforeActionData=function(e){e.beforeDetails=this.beforeActionData},e.prototype.performUndoRedo=function(e){var t=e.isUndo?this.undoCollection.pop():this.redoCollection.pop();this.isUndo=e.isUndo;var r;if(t){switch(t.action){case"cellSave":case"format":case"sorting":case"wrap":case"cellDelete":case"autofill":case"removeValidation":r=!(t=this.performOperation(t,e.preventEvt,e.preventReSelect)).preventEvent,delete t.preventEvent;break;case"clipboard":t=this.undoForClipboard(t,e.isUndo),r=!0;break;case"resize":t=this.undoForResize(t);break;case"hideShow":t.eventArgs.hide=!t.eventArgs.hide,updateAction(t,this.parent);break;case"replace":t=this.performOperation(t);break;case"insert":case"filter":updateAction(t,this.parent,!e.isUndo),r="filter"===t.action;break;case"delete":updateAction(t,this.parent,!e.isUndo);break;case"validation":case"addHighlight":case"removeHighlight":updateAction(t,this.parent,!e.isUndo);break;case"merge":t.eventArgs.merge=!t.eventArgs.merge,updateAction(t,this.parent);break;case"clear":t=this.performOperation(t);break;case"conditionalFormat":updateAction(t,this.parent,!e.isUndo,this.undoCollection);break;case"clearCF":case"insertImage":case"imageRefresh":updateAction(t,this.parent,!e.isUndo);break;case"insertChart":case"deleteChart":case"chartRefresh":case"addDefinedName":updateAction(t,this.parent,!e.isUndo)}if(e.isUndo?this.redoCollection.push(t):this.undoCollection.push(t),this.undoCollection.length>this.undoRedoStep&&this.undoCollection.splice(0,1),this.redoCollection.length>this.undoRedoStep&&this.redoCollection.splice(0,1),this.updateUndoRedoIcons(),!e.isPublic&&!r){this.parent.notify(triggerDataChange,ej2Base.extend({isUndo:e.isUndo},t,null,!0));var n=Object.assign({},t.eventArgs);n.requestType=e.isUndo?"undo":"redo",delete n.beforeActionData,this.parent.notify(completeAction,{eventArgs:n,action:"undoRedo"})}this.parent.notify(refreshRibbonIcons,null)}},e.prototype.updateUndoRedoCollection=function(e){var t=["clipboard","format","sorting","cellSave","resize","resizeToFit","wrap","hideShow","replace","validation","merge","clear","conditionalFormat","clearCF","insertImage","imageRefresh","insertChart","deleteChart","chartRefresh","filter","cellDelete","autofill","addDefinedName","removeValidation","removeHighlight","addHighlight"];"insert"!==e.args.action&&"delete"!==e.args.action||"Sheet"===e.args.eventArgs.modelType||t.push(e.args.action);var r=e.args.action;if(-1!==t.indexOf(r)||e.isPublic){var n=e.args.eventArgs;if("clipboard"===r||"sorting"===r||"format"===r||"cellSave"===r||"wrap"===r||"replace"===r||"validation"===r||"clear"===r||"conditionalFormat"===r||"clearCF"===r||"insertImage"===r||"imageRefresh"===r||"insertChart"===r||"chartRefresh"===r||"filter"===r||"cellDelete"===r||"autofill"===r||"removeValidation"===r||"addDefinedName"===r){var i={beforeDetails:{cellDetails:[]}};this.parent.notify(getBeforeActionData,i),n.beforeActionData=i.beforeDetails}if("clipboard"===r&&n.copiedInfo&&n.copiedInfo.isExternal){var o=this.parent.getAddressInfo(n.pastedRange);n.copiedInfo.cellDetails=this.getCellDetails(o.indices,getSheet(this.parent,o.sheetIndex),r)}this.undoCollection.push(e.args),this.redoCollection=[],this.undoCollection.length>this.undoRedoStep&&this.undoCollection.splice(0,1),this.updateUndoRedoIcons()}},e.prototype.clearUndoRedoCollection=function(){this.undoCollection=[],this.redoCollection=[],this.updateUndoRedoIcons()},e.prototype.updateUndoRedoIcons=function(){var e=this.parent.serviceLocator.getService(locale);this.parent.notify(enableToolbarItems,[{tab:e.getConstant("Home"),items:[this.parent.element.id+"_undo"],enable:this.undoCollection.length>0}]),this.parent.notify(enableToolbarItems,[{tab:e.getConstant("Home"),items:[this.parent.element.id+"_redo"],enable:this.redoCollection.length>0}])},e.prototype.undoForClipboard=function(e,t){var r,n=this,i=e.eventArgs,o=i.pastedRange.split("!"),a=getRangeIndexes(o[1]),s=getSheetIndex(this.parent,o[0]),l=getSheet(this.parent,s),d=i.copiedInfo,p=i.beforeActionData,h=this.checkRefreshNeeded(s);if("imagePaste"===e.eventArgs.requestType){var c=i.copiedShapeInfo;this.isUndo?(r=c.pictureElem,c.isCut?(this.parent.notify(deleteImage,{id:r.id,sheetIdx:i.pasteSheetIndex+1}),this.parent.notify(createImageElement,{options:{src:r.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:c.height,width:c.width,imageId:r.id},range:c.copiedRange,isPublic:!1,isUndoRedo:!0})):this.parent.notify(deleteImage,{id:i.pastedPictureElement.id,sheetIdx:i.pasteSheetIndex+1})):c.isCut?(r=c.pictureElem,this.parent.notify(deleteImage,{id:r.id,sheetIdx:c.sId}),this.parent.notify(createImageElement,{options:{src:r.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:c.height,width:c.width,imageId:r.id},range:c.pastedRange,isPublic:!1,isUndoRedo:!0})):(r=i.pastedPictureElement,this.parent.notify(createImageElement,{options:{src:r.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:r.offsetHeight,width:r.offsetWidth,imageId:r.id},range:c.pastedRange,isPublic:!1,isUndoRedo:!0}))}else{var u=ej2Base.extend({},i,null,!0);if(this.isUndo){if(u.copiedInfo.isExternal||(u.copiedInfo.isCut||(u.copiedInfo.isCut=!0),u.copiedInfo.sId=l.id,u.copiedInfo.range=a),u.copiedRange=u.pastedRange,u.pastedRange=i.copiedRange,this.parent.notify(beginAction,{eventArgs:u,action:"clipboard",preventAction:!0}),d.isCut){var g=p.cutCellDetails;this.updateCellDetails(g,getSheet(this.parent,getSheetIndexFromId(this.parent,d.sId)),getSwapRange(d.range),h,e)}p&&this.updateCellDetails(p.cellDetails,l,a,h,e),setMaxHgt(l,a[0],a[1],getRowHeight(l,a[0]));var f=getMaxHgt(l,a[0]);setRowEleHeight(this.parent,l,f,a[0]),i.mergeCollection.forEach(function(e){e.merge=!e.merge,n.parent.notify(setMerge,e),e.merge=!e.merge}),delete u.beforeActionData,this.parent.notify(completeAction,{eventArgs:u,action:"clipboard",preventAction:!0})}else if(d.isExternal){this.parent.notify(beginAction,{eventArgs:u,action:"clipboard",preventAction:!0});var m=this.parent.getAddressInfo(i.pastedRange);this.updateCellDetails(d.cellDetails,getSheet(this.parent,m.sheetIndex),m.indices,!0,e),delete u.beforeActionData,this.parent.notify(completeAction,{eventArgs:u,action:"clipboard",preventAction:!0})}else{(i.copiedInfo.isCut?this.parent.cut(i.copiedRange):this.parent.copy(i.copiedRange)).then(function(){n.parent.notify(beginAction,{eventArgs:u,action:"clipboard",preventAction:!0}),n.parent.notify(paste,{range:o?getIndexesFromAddress(i.pastedRange):o,sIdx:o?getSheetIndex(n.parent,getSheetNameFromAddress(i.pastedRange)):o,type:i.type,isAction:!1,isInternal:!0}),delete u.beforeActionData,n.parent.notify(completeAction,{eventArgs:u,action:"clipboard",preventAction:!0})})}h&&(this.parent.notify(selectRange,{address:o[1]}),this.parent.notify(positionAutoFillElement,{}))}return e},e.prototype.undoForResize=function(e){var t=e.eventArgs;if(void 0===t.hide)if(t.isCol){var r=t.oldWidth;t.oldWidth=t.width,t.width=r}else{r=t.oldHeight;t.oldHeight=t.height,t.height=r}else t.hide=!t.hide;updateAction(e,this.parent);var n=this.parent.getActiveSheet(),i=getRangeIndexes(n.activeCell),o=getCell(i[0],i[1],n);if(o&&o.rowSpan){var a=this.parent.getCell(i[0],i[1]);this.parent.element.querySelector(".e-active-cell").style.height=a.offsetHeight+"px"}else if(o&&o.colSpan){a=this.parent.getCell(i[0],i[1]);this.parent.element.querySelector(".e-active-cell").style.width=a.offsetWidth+"px"}return e},e.prototype.performOperation=function(e,t,r){var n=this,i=e.eventArgs,o={eventArgs:Object.assign({},i),action:e.action,preventAction:!0};"cellSave"!==e.action&&("cellDelete"===e.action&&this.isUndo?e.preventEvent=!0:this.parent.notify(beginAction,o));var a=[],s=getRangeIndexes((a="autofill"===e.action?i.fillRange.split("!"):"cellSave"===e.action||"wrap"===e.action||"replace"===e.action||"cellDelete"===e.action?i.address.split("!"):i.range.split("!"))[1]),l=s,d=getSheetIndex(this.parent,a[0]),p=getSheet(this.parent,d),h=i.beforeActionData,c=this.checkRefreshNeeded(d),u={cellIdx:[s[0],s[1]],isUnique:!1,uniqueRange:""};this.parent.notify(checkUniqueRange,u);var g=function(e,t){if(d===n.parent.activeSheetIndex){var r=n.parent.getCell(s[0]-1,n.parent.sortCollection[e].columnIndex);r&&(r=ej2Base.select(".e-filter-icon",r))&&(t?r.classList.add("e-sort"+("Ascending"===n.parent.sortCollection[e].order?"asc":"desc")+"-filter"):r.classList.remove("e-sort"+("Ascending"===n.parent.sortCollection[e].order?"asc":"desc")+"-filter"))}};if(this.isUndo){if(u.isUnique&&i.formula&&i.formula.indexOf("UNIQUE")>-1){if("#SPILL!"!==getCell((v=getRangeIndexes(u.uniqueRange))[0],v[1],this.parent.getActiveSheet()).value)for(var f=v[0];f<=v[2];f++)for(var m=v[1];m<=v[3];m++)f===v[0]&&m===v[1]&&(m+=1),this.parent.updateCell({value:""},getRangeAddress([f,m]))}if(this.updateCellDetails(h.cellDetails,p,s,c,e,t,o),u.isUnique&&"cellDelete"===e.action&&i.isSpill){for(var v,C=getCell((v=getRangeIndexes(u.uniqueRange))[0],v[1],this.parent.getActiveSheet()),y=v[0];y<=v[2];y++)for(f=v[1];f<=v[3];f++)for(m=s[0];m<=s[2];m++)for(var x=s[1];x<=s[3];x++)y===m&&f===x||this.parent.updateCell({value:""},getCellAddress(y,f));C.value="#SPILL!",this.parent.updateCell(C,getCellAddress(v[0],v[1]))}if(!i.isSpill&&""!==u.uniqueRange){var b=getRangeIndexes(u.uniqueRange);for(f=b[0];f<=b[2];f++)for(m=b[1];m<=b[3];m++)f===b[0]&&m===b[1]&&(m+=1),this.parent.updateCell({value:""},getRangeAddress([f,m]));this.parent.notify(reApplyFormula,null)}if("sorting"===e.action&&this.parent.sortCollection&&i.previousSort)for(y=0;y<this.parent.sortCollection.length;y++)if(this.parent.sortCollection[y].sheetIndex===d){g(y,!1),this.parent.sortCollection.splice(y,1),i.previousSort.order?(this.parent.sortCollection.splice(y,0,i.previousSort),g(y,!0)):this.parent.sortCollection.length||(this.parent.sortCollection=void 0);break}}else{var S=e.eventArgs,w=getRangeIndexes(p.activeCell),I=this.parent.getCellStyleValue(["textDecoration"],w).textDecoration;if(S&&S.style&&S.style.textDecoration){var R=S.style.textDecoration,E=R,k=void 0,F=!1;"underline"===I?E="underline"===R?"none":"underline line-through":"line-through"===I?E="line-through"===R?"none":"underline line-through":"underline line-through"===I&&(E="underline"===R?"line-through":"underline",F=!0),"none"===E&&(F=!0),S.style.textDecoration=E,e.eventArgs=S,this.parent.notify(setCellFormat,{style:{textDecoration:E},range:w,refreshRibbon:!0,onActionUpdate:!0});for(y=l[0];y<=l[2];y++)for(f=l[1];f<=l[3];f++)if(y!==w[0]||f!==w[1]){if(k={},"none"===(I=this.parent.getCellStyleValue(["textDecoration"],[y,f]).textDecoration)){if(F)continue;k.textDecoration=R}else if("underline"===I||"line-through"===I)if(F){if(R!==I)continue;k.textDecoration="none"}else k.textDecoration=R!==I?"underline line-through":R;else if("underline line-through"===I){if(!F)continue;k.textDecoration="underline"===R?"line-through":"underline"}this.parent.notify(setCellFormat,{style:{textDecoration:k.textDecoration},range:[y,f,y,f],refreshRibbon:!0,onActionUpdate:!0})}S.style.textDecoration=R,e.eventArgs=S}else{if(!ej2Base.isNullOrUndefined(i.oldValue)&&i.oldValue!==i.value&&u.isUnique){var A=getRangeIndexes(u.uniqueRange);if("#SPILL!"!==getCell(A[0],A[1],this.parent.getActiveSheet()).value)for(f=A[0];f<=A[2];f++)for(m=A[1];m<=A[3];m++)f===A[0]&&m===A[1]&&(this.parent.updateCell({value:"#SPILL!"},getRangeAddress([A[0],A[1]])),m+=1),this.parent.updateCell({value:""},getRangeAddress([f,m]))}if(updateAction(e,this.parent,!0,null,o),u.isUnique&&"cellDelete"===e.action&&i.isSpill){var B=getRangeIndexes(u.uniqueRange),T=!1;for(y=B[0];y<=B[1];y++)for(f=B[1];f<=B[3];f++)y===B[0]&&f===B[1]&&f++,getCell(y,f,p)&&!ej2Base.isNullOrUndefined(getCell(y,f,p).value)&&""!==getCell(y,f,p).value&&(T=!0);if(!T){(C=getCell(B[0],B[1],this.parent.getActiveSheet())).value="",this.parent.updateCell(C,getCellAddress(B[0],B[1])),this.parent.notify(reApplyFormula,null)}}}if("sorting"===e.action&&i.previousSort){var D=void 0;if(this.parent.sortCollection){for(y=0;y<this.parent.sortCollection.length;y++)if(this.parent.sortCollection[y].sheetIndex===d){g(y,!1),D=y,this.parent.sortCollection.splice(y,1);break}}else this.parent.sortCollection=[],D=0;this.parent.sortCollection.splice(D,0,{sortRange:a[1],sheetIndex:d,columnIndex:getColIndex(i.sortOptions.sortDescriptors.field),order:i.sortOptions.sortDescriptors.order}),g(D,!0)}}return"autofill"===e.action&&(a[1]=this.isUndo?e.eventArgs.dataRange:e.eventArgs.selectedRange),c&&!r&&this.parent.notify(selectRange,{address:a[1]}),this.parent.notify(showAggregate,{}),e.preventEvent||this.parent.notify(completeAction,o),e},e.prototype.getCellDetails=function(e,t,r){for(var n,i=[],o="cellDelete"===r,a=(e=getSwapRange(e))[0];a<=e[2];a++)if(!o||!(getRow(t,a)||{}).isFiltered)for(var s=e[1];s<=e[3];s++)n=getCell(a,s,t),i.push({rowIndex:a,colIndex:s,format:n?n.format:null,isLocked:n?n.isLocked:null,style:n&&n.style?Object.assign({},n.style):null,value:n?n.value:"",formula:n?n.formula:"",wrap:n&&n.wrap,rowSpan:n&&n.rowSpan,colSpan:n&&n.colSpan,hyperlink:n&&n.hyperlink,image:n&&n.image&&n.chart,validation:n&&n.validation});return i},e.prototype.updateCellDetails=function(e,t,r,n,i,o,a){for(var s,l,d,p,h=this,c=e.length,u=i&&!o&&("cellSave"===i.action||"cellDelete"===i.action||"autofill"===i.action||"clipboard"===i.action),g=0;g<c;g++){if((l=getCell(e[g].rowIndex,e[g].colIndex,t,!1,!0)).style&&i&&"format"===i.action&&(!l.style.borderTop||e[g].style&&e[g].style.borderTop||this.parent.setBorder({borderTop:""},t.name+"!"+getCellAddress(e[g].rowIndex,e[g].colIndex)),!l.style.borderLeft||e[g].style&&e[g].style.borderLeft||this.parent.setBorder({borderLeft:""},t.name+"!"+getCellAddress(e[g].rowIndex,e[g].colIndex)),!l.style.fontSize||e[g].style&&e[g].style.fontSize||(l.style.fontSize="11pt",p=!0,this.parent.notify(applyCellFormat,{style:{fontSize:"11pt"},rowIdx:e[g].rowIndex,colIdx:e[g].colIndex,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:!0})),!l.style.fontFamily||e[g].style&&e[g].style.fontFamily||(p=!0,l.style.fontFamily="Calibri",this.parent.notify(applyCellFormat,{style:{fontFamily:"Calibri"},rowIdx:e[g].rowIndex,colIdx:e[g].colIndex,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:!0}))),d={element:null,value:e[g].value,oldValue:l.value,address:t.name+"!"+getCellAddress(e[g].rowIndex,e[g].colIndex),displayText:this.parent.getDisplayText(e[g]),formula:e[g].formula},0===g&&u&&"cellSave"===i.action&&(a.eventArgs=d,this.parent.notify(beginAction,a)),setCell(e[g].rowIndex,e[g].colIndex,t,{value:e[g].value,format:e[g].format,isLocked:e[g].isLocked,style:e[g].style&&Object.assign({},e[g].style),formula:e[g].formula,wrap:e[g].wrap,rowSpan:e[g].rowSpan,colSpan:e[g].colSpan,hyperlink:e[g].hyperlink}),this.parent.notify(workbookEditOperation,{action:"updateCellValue",address:[e[g].rowIndex,e[g].colIndex,e[g].rowIndex,e[g].colIndex],value:e[g].formula?e[g].formula:e[g].value}),(i&&"wrap"===i.action&&i.eventArgs.wrap||l.wrap&&i&&"autofill"===i.action)&&this.parent.notify(wrapEvent,{range:[e[g].rowIndex,e[g].colIndex,e[g].rowIndex,e[g].colIndex],wrap:!1,sheet:t}),i&&"removeValidation"===i.action&&e[g].validation){var f={type:e[g].validation.type,operator:e[g].validation.operator,value1:e[g].validation.value1,value2:e[g].validation.value2,ignoreBlank:e[g].validation.ignoreBlank,inCellDropDown:e[g].validation.inCellDropDown};this.parent.notify(cellValidation,{rules:f,range:i.eventArgs.range})}i&&e[g].hyperlink&&"clear"===i.action&&(i.eventArgs.range=t.name+"!"+getRangeAddress([e[g].rowIndex,e[g].colIndex,e[g].rowIndex,e[g].colIndex]),s=this.parent.getCell(e[g].rowIndex,e[g].colIndex),"Clear All"===i.eventArgs.type||"Clear Hyperlinks"===i.eventArgs.type?this.parent.addHyperlink(e[g].hyperlink,i.eventArgs.range):"Clear Formats"===i.eventArgs.type&&ej2Base.addClass(s.querySelectorAll(".e-hyperlink"),"e-hyperlink-style")),u&&e[g].value!==l.value&&this.parent.trigger("cellSave",d)}n&&(this.parent.serviceLocator.getService("cell").refreshRange(r,!1,!1,!0),p&&getUpdateUsingRaf(function(){return h.parent.selectRange(t.selectedRange)}))},e.prototype.checkRefreshNeeded=function(e){var t=!0;return e!==this.parent.activeSheetIndex&&(this.parent.activeSheetIndex=e,this.parent.dataBind(),t=!1),t},e.prototype.addEventListener=function(){this.parent.on(performUndoRedo,this.performUndoRedo,this),this.parent.on(updateUndoRedoCollection,this.updateUndoRedoCollection,this),this.parent.on(setActionData,this.setActionData,this),this.parent.on(getBeforeActionData,this.getBeforeActionData,this),this.parent.on(clearUndoRedoCollection,this.clearUndoRedoCollection,this),this.parent.on(setUndoRedo,this.updateUndoRedoIcons,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(performUndoRedo,this.performUndoRedo),this.parent.off(updateUndoRedoCollection,this.updateUndoRedoCollection),this.parent.off(setActionData,this.setActionData),this.parent.off(getBeforeActionData,this.getBeforeActionData),this.parent.off(clearUndoRedoCollection,this.clearUndoRedoCollection),this.parent.off(setUndoRedo,this.updateUndoRedoIcons))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"undoredo"},e}(),WrapText=function(){function e(e){this.parent=e,this.wrapCell=this.parent.createElement("span",{className:"e-wrap-content"}),this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(ribbonClick,this.ribbonClickHandler,this),this.parent.on(wrapEvent,this.wrapTextHandler,this),this.parent.on(rowHeightChanged,this.rowHeightChangedHandler,this),this.parent.on(colWidthChanged,this.colWidthChanged,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ribbonClick,this.ribbonClickHandler),this.parent.off(wrapEvent,this.wrapTextHandler),this.parent.off(rowHeightChanged,this.rowHeightChangedHandler),this.parent.off(colWidthChanged,this.colWidthChanged))},e.prototype.wrapTextHandler=function(e){if(e.initial||inView(this.parent,e.range,!0)){for(var t=void 0,r=void 0,n=void 0,i=void 0,o=void 0,a=void 0,s=void 0,l=void 0,d=e.range[0];d<=e.range[2];d++){i=0,a=(s=getRow(e.sheet,d).customHeight)||e.isCustomHgt;for(var p=e.range[1];p<=e.range[3];p++)if(!((r=getCell(d,p,e.sheet,null,!0)).rowSpan<0||r.colSpan<0)){var h=r.rowSpan>1||r.colSpan>1;if((t=e.initial?e.td:this.parent.getCell(d,p))?(e.wrap?(l=getLineHeight(r.style&&r.style.fontFamily?r.style:this.parent.cellStyle),t.classList.add(WRAPTEXT)):(t.classList.remove(WRAPTEXT),l=null),(a||h)&&this.updateWrapCell(d,p,e.sheet,t)):l=null,ej2Base.Browser.isIE&&t.classList.add("e-ie-wrap"),!a&&!h){n=getExcludedColumnWidth(e.sheet,d,p,r.colSpan>1?p+r.colSpan-1:p);if((y=this.parent.getDisplayText(r).toString()).indexOf("\n")<0){var c=this.parent.element.querySelector(".e-spreadsheet-edit");c&&c.textContent.indexOf("\n")>-1&&(y=c.textContent)}if(y)if(e.wrap){t&&t.classList.contains("e-alt-unwrap")&&t.classList.remove("e-alt-unwrap");var u=void 0,g=0,f=void 0;if(y.indexOf("\n")>-1){var m=y.split("\n"),v=m.length;for(f=0;f<v;f++)0===(u=getLines(m[f],n,r.style,this.parent.cellStyle))&&(u=1),g+=u;u=g}else u=getLines(y,n,r.style,this.parent.cellStyle);if(o=getTextHeightWithBorder(this.parent,d,p,e.sheet,r.style||this.parent.cellStyle,u,l),i=Math.max(i,o),r.rowSpan>1){var C=getRowsHeight(e.sheet,d,d+(r.rowSpan-1));if(C>=i)return;o=i=getRowHeight(e.sheet,d)+(i-C)}setMaxHgt(e.sheet,d,p,o)}else y.indexOf("\n")>-1&&t.classList.add("e-alt-unwrap"),o=getTextHeightWithBorder(this.parent,d,p,e.sheet,r.style||this.parent.cellStyle,1,l),setMaxHgt(e.sheet,d,p,o),i=Math.max(getMaxHgt(e.sheet,d),20);else e.wrap&&y||(setMaxHgt(e.sheet,d,p,20),i=Math.max(getMaxHgt(e.sheet,d),20));p===e.range[3]&&(e.wrap&&i>20&&getMaxHgt(e.sheet,d)<=i||(!e.wrap||!y)&&getMaxHgt(e.sheet,d)<getRowHeight(e.sheet,d)&&getRowHeight(e.sheet,d)>20)&&setRowEleHeight(this.parent,e.sheet,i,d,e.row,e.hRow)}if(a&&!h){var y=this.parent.getDisplayText(r);e.wrap?t&&t.classList.contains("e-alt-unwrap")&&t.classList.remove("e-alt-unwrap"):y.indexOf("\n")>-1&&t.classList.add("e-alt-unwrap")}e.wrap&&t?s?t.style.lineHeight&&(t.style.lineHeight=""):t.style.lineHeight=parseFloat(r.style&&r.style.fontSize||this.parent.cellStyle.fontSize)*l+"pt":t&&(t.style.lineHeight="")}}e.initial||this.parent.notify(positionAutoFillElement,null)}},e.prototype.ribbonClickHandler=function(e){var t=ej2Base.closest(e.originalEvent.target,".e-btn");if(t&&t.id===this.parent.element.id+"_wrap"){var r=t.classList.contains("e-active"),n=getAddressFromSelectedRange(this.parent.getActiveSheet()),i={address:n,wrap:r,cancel:!1};this.parent.notify(beginAction,{action:"beforeWrap",eventArgs:i}),i.cancel||(wrap(this.parent.getActiveSheet().selectedRange,r,this.parent),this.parent.notify(completeAction,{action:"wrap",eventArgs:{address:n,wrap:r}}))}},e.prototype.rowHeightChangedHandler=function(e){if(e.isCustomHgt)for(var t=this.parent.getActiveSheet(),r=void 0,n=this.parent.viewport.leftIndex,i=this.parent.viewport.rightIndex;n<=i;n++)getCell(e.rowIdx,n,t,!1,!0).wrap&&(r=this.parent.getCell(e.rowIdx,n),this.updateWrapCell(e.rowIdx,n,t,r),r.style.lineHeight&&(r.style.lineHeight=""))},e.prototype.colWidthChanged=function(e){if(e.checkWrapCell)for(var t=this.parent.getActiveSheet(),r=this.parent.viewport.topIndex,n=this.parent.viewport.bottomIndex;r<=n;r++)getCell(r,e.colIdx,t,!1,!0).wrap&&this.updateWrapCell(r,e.colIdx,t,this.parent.getCell(r,e.colIdx))},e.prototype.updateWrapCell=function(e,t,r,n){if(n&&!n.querySelector(".e-wrap-content")){for(var i=this.wrapCell.cloneNode(),o=n.querySelector(".e-filter-btn");n.childElementCount;)i.appendChild(n.firstElementChild);if(o&&(n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o)),!getCell(e,t,r,!1,!0).hyperlink){var a=n.lastChild;a&&3===a.nodeType?(i.appendChild(document.createTextNode(a.textContent)),a.textContent=""):(i.appendChild(document.createTextNode(n.textContent)),n.textContent="")}n.appendChild(i)}},e.prototype.getModuleName=function(){return"wrapText"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),Insert=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.insert=function(e){var t;switch(e.isAction&&(t=!0,delete e.isAction),t&&this.parent.notify(beginAction,{eventArgs:e,action:"insert"}),this.parent.notify(beforeInsert,e),e.modelType){case"Sheet":this.parent.notify(insertSheetTab,{startIdx:e.index,endIdx:e.index+(e.model.length-1),preventUpdate:!t}),this.parent.renderModule.refreshSheet(),focus(this.parent.element);break;case"Row":if(!this.parent.scrollSettings.enableVirtualization||e.index<=this.parent.viewport.bottomIndex){if(this.parent.scrollSettings.enableVirtualization){if(e.freezePane){this.parent.renderModule.refreshSheet();break}var r=getSheet(this.parent,e.activeSheetIndex);e.index>=this.parent.viewport.topIndex&&this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.topIndex===skipHiddenIdx(this.parent.getActiveSheet(),0,!0),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Row"});var n=getCellIndexes(r.topLeftCell)[0];e.index<n&&(this.parent.notify(updateScrollValue,{scrollTop:getRowsHeight(r,0,n-1,!0)}),this.parent.goTo(getCellAddress(e.index,0)))}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,rowIndex:this.parent.viewport.topIndex,colIndex:0,refresh:"Row"});this.parent.selectRange(this.parent.getActiveSheet().selectedRange)}break;case"Column":if(!this.parent.scrollSettings.enableVirtualization||e.index<=this.parent.viewport.rightIndex){if(e.freezePane){this.parent.renderModule.refreshSheet();break}if(this.parent.scrollSettings.enableVirtualization){r=getSheet(this.parent,e.activeSheetIndex);e.index>=this.parent.viewport.topIndex&&this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===skipHiddenIdx(this.parent.getActiveSheet(),0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Column"});var i=getCellIndexes(r.topLeftCell)[1];e.index<i&&(this.parent.notify(updateScrollValue,{scrollLeft:getColumnsWidth(r,0,i-1,!0)}),this.parent.goTo(getCellAddress(0,e.index)))}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,rowIndex:0,colIndex:this.parent.viewport.leftIndex,refresh:"Column"});this.parent.selectRange(this.parent.getActiveSheet().selectedRange)}}this.refreshImgElement(e.model.length,this.parent.activeSheetIndex,e.modelType,e.index),t?this.parent.notify(completeAction,{eventArgs:e,action:"insert"}):e.isUndoRedo||(e.isMethod=!0,this.parent.notify(triggerDataChange,{eventArgs:e,action:"insert"}))},e.prototype.refreshImgElement=function(e,t,r,n){for(var i,o=this.parent.sheets[t],a=[0,0,o.usedRange.rowIndex,o.usedRange.colIndex],s=0;s<=a[2];s++)for(var l=a[1];l<=a[3];l++)(i=getCell(s,l,o))&&i.image&&i.image.length>0&&("Row"===r&&s>=n||"Column"===r&&l>=n)&&this.parent.notify(refreshImagePosition,{rowIdx:s,colIdx:l,sheetIdx:t,type:r,count:e,status:"insert"})},e.prototype.addEventListener=function(){this.parent.on(insert,this.insert,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(insert,this.insert)},e.prototype.getModuleName=function(){return"insert"},e}(),Delete=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.delete=function(e){var t;if(e.isAction&&(t=!0,delete e.isAction),t&&this.parent.notify(beginAction,{eventArgs:e,action:"delete"}),"Sheet"===e.modelType){var r=e.activeSheetIndex>=e.startIndex&&e.activeSheetIndex<=e.endIndex;r&&this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(e.startIndex<this.parent.sheets.length?e.startIndex:e.startIndex?e.startIndex-1:0)},!0),this.parent.notify(refreshSheetTabs,null),r&&this.parent.renderModule.refreshSheet(!1,!1,!0)}else"Row"===e.modelType?(!this.parent.scrollSettings.enableVirtualization||e.startIndex<=this.parent.viewport.bottomIndex)&&(e.freezePane?this.parent.renderModule.refreshSheet(!1,!1,!0):this.parent.scrollSettings.enableVirtualization?e.startIndex<getCellIndexes(this.parent.getActiveSheet().topLeftCell)[0]?(this.parent.updateTopLeftCell(e.startIndex-1<0?0:e.startIndex-1,null),this.parent.renderModule.refreshSheet(!1,!1,!0)):(this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.topIndex===skipHiddenIdx(this.parent.getActiveSheet(),0,!0),rowIndex:this.parent.viewport.topIndex,refresh:"Row",colIndex:this.parent.viewport.leftIndex}),this.parent.selectRange(this.parent.getActiveSheet().selectedRange)):(this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,refresh:"Row",rowIndex:this.parent.viewport.topIndex,colIndex:0}),this.parent.selectRange(this.parent.getActiveSheet().selectedRange))):(!1!==e.refreshSheet&&(!this.parent.scrollSettings.enableVirtualization||e.startIndex<=this.parent.viewport.rightIndex)&&(e.freezePane||!0===e.refreshSheet?this.parent.renderModule.refreshSheet(!1,!1,!0):this.parent.scrollSettings.enableVirtualization?e.startIndex<getCellIndexes(this.parent.getActiveSheet().topLeftCell)[1]?(this.parent.updateTopLeftCell(null,e.startIndex-1<0?0:e.startIndex-1),this.parent.renderModule.refreshSheet(!1,!1,!0)):(this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex===skipHiddenIdx(this.parent.getActiveSheet(),0,!0,"columns"),rowIndex:this.parent.viewport.topIndex,refresh:"Column",colIndex:this.parent.viewport.leftIndex,insertDelete:!0}),this.parent.selectRange(this.parent.getActiveSheet().selectedRange)):(this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,refresh:"Column",rowIndex:0,colIndex:this.parent.viewport.leftIndex,insertDelete:!0}),this.parent.selectRange(this.parent.getActiveSheet().selectedRange))),delete e.refreshSheet);this.refreshImgElement(e.deletedModel.length,this.parent.activeSheetIndex,e.modelType,e.startIndex),t?this.parent.notify(completeAction,{eventArgs:e,action:"delete"}):e.isUndoRedo||(e.isMethod=!0,this.parent.notify(triggerDataChange,{eventArgs:e,action:"delete"}))},e.prototype.refreshImgElement=function(e,t,r,n){for(var i,o=this.parent.sheets[t],a=[0,0,o.usedRange.rowIndex,o.usedRange.colIndex],s=0;s<=a[2];s++)for(var l=a[1];l<=a[3];l++)(i=getCell(s,l,o))&&i.image&&i.image.length>0&&("Row"===r&&s>=n||"Column"===r&&l>=n)&&this.parent.notify(refreshImagePosition,{rowIdx:s,colIdx:l,sheetIdx:t,type:r,count:e,status:"delete"})},e.prototype.addEventListener=function(){this.parent.on(deleteAction,this.delete,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(deleteAction,this.delete)},e.prototype.getModuleName=function(){return"delete"},e}(),DataValidation=function(){function e(e){this.data=[],this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener();var e=ej2Base.select("#"+this.parent.element.id+"_datavalidation-popup");e&&e.remove(),this.parent=null},e.prototype.addEventListener=function(){ej2Base.EventHandler.add(this.parent.element,"dblclick",this.listOpen,this),this.parent.on(initiateDataValidation,this.initiateDataValidationHandler,this),this.parent.on(invalidData,this.invalidDataHandler,this),this.parent.on(isValidation,this.checkDataValidation,this),this.parent.on(activeCellChanged,this.listHandler,this),this.parent.on(keyUp,this.keyUpHandler,this),this.parent.on(removeDataValidation,this.removeValidationHandler,this),this.parent.on(validationHighlight,this.InvalidElementHandler,this)},e.prototype.removeEventListener=function(){ej2Base.EventHandler.remove(this.parent.element,"dblclick",this.listOpen),this.parent.isDestroyed||(this.parent.off(initiateDataValidation,this.initiateDataValidationHandler),this.parent.off(invalidData,this.invalidDataHandler),this.parent.off(isValidation,this.checkDataValidation),this.parent.off(activeCellChanged,this.listHandler),this.parent.off(keyUp,this.keyUpHandler),this.parent.off(removeDataValidation,this.removeValidationHandler),this.parent.off(validationHighlight,this.InvalidElementHandler))},e.prototype.removeValidationHandler=function(){var e=this.parent.getActiveSheet(),t=this.getRange(e.selectedRange),r={range:e.name+"!"+t,cancel:!1};if(this.parent.notify(beginAction,{eventArgs:r,action:"removeValidation"}),!r.cancel){var n=getRangeIndexes(t),i=getCell(n[0],n[1],e,!1,!0),o=i.validation&&"List"===i.validation.type;if(this.parent.notify(cellValidation,{range:t,isRemoveValidation:!0}),o&&!i.validation){var a=this.parent.getCell(n[0],n[1]);a&&a.getElementsByClassName("e-validation-list")[0]&&(this.listObj.destroy(),a.removeChild(a.getElementsByClassName("e-validation-list")[0]))}this.parent.notify(completeAction,{eventArgs:r,action:"removeValidation"})}},e.prototype.keyUpHandler=function(e){var t=e.target,r=this.parent.element.querySelector(".e-datavalidation-dlg");if(ej2Base.closest(t,".e-values")&&r&&13!==e.keyCode){var n=r.querySelector(".e-values"),i=n.querySelector(".e-dlg-error"),o=r.querySelector(".e-footer-content").querySelector(".e-primary");o.hasAttribute("disabled")&&o.removeAttribute("disabled"),i&&n.removeChild(i)}},e.prototype.listOpen=function(e){var t=e.target;this.listObj&&t.classList.contains("e-cell")&&t.querySelector(".e-validation-list")&&this.listObj.showPopup()},e.prototype.invalidDataHandler=function(e){e.isRemoveHighlight?(this.parent.notify(beginAction,{eventArgs:{range:this.parent.dataValidationRange},action:"removeHighlight"}),this.parent.removeInvalidHighlight(),this.parent.notify(completeAction,{eventArgs:{range:this.parent.dataValidationRange},action:"removeHighlight"})):(this.parent.notify(beginAction,{eventArgs:{range:this.parent.dataValidationRange},action:"addHighlight"}),this.parent.addInvalidHighlight(),this.parent.notify(completeAction,{eventArgs:{range:this.parent.dataValidationRange},action:"addHighlight"}))},e.prototype.listHandler=function(){var e=this;if(this.parent.allowDataValidation){var t=this.parent.getActiveSheet(),r=getCellIndexes(t.activeCell),n=getCell(r[0],r[1],t),i=this.parent.getCell(r[0],r[1]);if(!i)return;document.getElementsByClassName("e-validation-list")[0]&&(ej2Base.remove(document.getElementsByClassName("e-validation-list")[0]),this.data=[]);var o=n&&n.validation||t.columns&&t.columns[r[1]]&&t.columns[r[1]].validation;if(o&&"List"===o.type&&(o.ignoreBlank=!!ej2Base.isNullOrUndefined(o.ignoreBlank)||o.ignoreBlank,o.inCellDropDown=!!ej2Base.isNullOrUndefined(o.inCellDropDown)||o.inCellDropDown,o.inCellDropDown)){var a=this.parent.createElement("div",{className:"e-validation-list"}),s=this.parent.createElement("input",{id:this.parent.element.id+"listValid"});a.appendChild(s),o.inCellDropDown||(a.style.display="none");var l=i.getElementsByClassName("e-wrap-content")[0]||i;l.insertBefore(a,l.firstChild);var d=this.updateDataSource(n,o);this.listObj=new ej2Dropdowns.DropDownList({index:this.setDropDownListIndex(d,n),dataSource:d,fields:{text:"text",value:"id"},width:"0px",popupHeight:"200px",change:function(){return e.listValueChange(e.listObj.text)},open:function(r){if(r.popup.offsetX=4-(i.offsetWidth-20),r.popup.offsetY=-13,r.popup.element.style.width=i.offsetWidth-1+"px",ej2Base.Browser.isDevice&&e.parent.scrollModule){var n=e.parent.scrollModule.offset,o=e.parent.viewport;r.popup.offsetY+=o.topIndex?n.top.size-getRowsHeight(t,o.topIndex+1,n.top.idx,!0):0,r.popup.offsetX+=o.leftIndex?n.left.size-getColumnsWidth(t,o.leftIndex+1,n.left.idx,!0):0,r.popup.refresh()}}}),this.listObj.appendTo("#"+this.parent.element.id+"listValid")}n&&n.validation&&(n.validation=o)}},e.prototype.setDropDownListIndex=function(e,t){if(t&&t.value)for(var r=0,n=e.length;r<n;r++)if(e[r].text===t.value.toString())return r;return null},e.prototype.updateDataSource=function(e,t){var r=this;this.data=[];var n=0,i=this.parent.definedNames,o=t.value1,a=-1!==o.indexOf("=");if(i.length>0&&a)for(var s=o.split("=")[1],l=0,d=i.length;l<d;l++)if(i[l].name===s){for(var p=i[l].refersTo;p.includes("'");)p=p.replace("'","");o=p}if(a){var h=o.indexOf("!")>-1?getSheet(this.parent,getSheetIndex(this.parent,o.split("=")[1].split("!")[0])):this.parent.getActiveSheet(),c=o.indexOf("!")>-1?o.split("!")[1]:o.split("=")[1],u=this.parent.getActiveSheet();if(h.name!==u.name){var g,f=getRangeIndexes(u.selectedRange);h.ranges.forEach(function(e){e.info&&e.info.loadedRange&&e.info.loadedRange.length||(g=!0)}),g&&(this.parent.showSpinner(),getData(this.parent,h.name+"!"+c).then(function(){if(r.parent.hideSpinner(),u.name===r.parent.getActiveSheet().name){var n=getRangeIndexes(r.parent.getActiveSheet().selectedRange);n[0]===f[0]&&n[1]===f[1]&&(r.listObj.dataSource=r.updateDataSource(e,t),r.listObj.dataBind())}}))}var m=void 0,v=c.split(":");if(v[0].match(/[a-z]+$/gi)&&v[1].match(/[a-z]+$/gi)||v[0].match(/^[0-9]/g)&&v[1].match(/^[0-9]/g)){var C=this.parent.getIndexes(c);m=C.isCol?[0,C.startIdx,h.usedRange.rowIndex,C.startIdx]:[C.startIdx,0,C.startIdx,h.usedRange.colIndex]}else m=getRangeIndexes(c);for(var y=m[0];y<=m[2];y++){h.rows[y]||setRow(h,y,{});for(var x=m[1];x<=m[3];x++){h.rows[y].cells||setCell(y,x,h,{}),n+=1,e=h.rows[y].cells[x];var b=this.parent.getDisplayText(e)||"";t.ignoreBlank&&""===b||this.data.push({text:b,id:"list-"+n})}}}else{var S=o.split(",");for(l=0;l<S.length;l++)n+=1,this.data.push({text:S[l],id:"list-"+n})}return this.data},e.prototype.listValueChange=function(e){this.parent.notify(formulaBarOperation,{action:"refreshFormulabar",value:e});var t=this.parent.getActiveSheet(),r=getIndexesFromAddress(t.activeCell),n=Object.assign({},getCell(r[0],r[1],t));t.isProtected&&isLocked(n,getColumn(t,r[1]))?this.parent.notify(editAlert,null):(this.parent.notify(workbookEditOperation,{action:"updateCellValue",address:t.activeCell,value:e}),this.parent.serviceLocator.getService("cell").refreshRange(r),this.parent.trigger("cellSave",{value:e,oldValue:n&&n.value,address:t.name+"!"+t.activeCell,displayText:this.parent.getDisplayText(getCell(r[0],r[1],t))}))},e.prototype.getRange=function(e){var t=this.parent.getActiveSheet(),r=getRangeIndexes(e),n=t.rowCount,i=t.colCount;return r[2]===n-1&&0===r[0]?e=e.replace(/[0-9]/g,""):r[3]===i-1&&0===r[2]&&(e=e.replace(/\D/g,"")),e},e.prototype.initiateDataValidationHandler=function(e,t){var r,n,i,o,a,s=this,l=this.parent.serviceLocator.getService(locale),d=!0,p=!0,h=!0,c=this.parent.getActiveSheet(),u=c.selectedRange,g=getRangeIndexes(u);u=this.getRange(u);var f=this.validateRange(g,c);if(!f.extendValidation&&!f.moreValidation||e){for(var m=g[0];m<=g[2];m++)if(c.rows[m])for(var v=g[1];v<=g[3];v++)c.rows[m].cells&&c.rows[m].cells[v]&&(a=c.rows[m].cells[v]).validation&&(h=!1,r=a.validation.type,n=a.validation.operator,i=a.validation.value1,o=a.validation.value2,d=ej2Base.isNullOrUndefined(a.validation.ignoreBlank)?d:a.validation.ignoreBlank,p=ej2Base.isNullOrUndefined(a.validation.inCellDropDown)?p:a.validation.inCellDropDown);if(h)for(var C=g[1];C<=g[3];C++){var y=getColumn(c,C);y&&y.validation&&(h=!1,r=y.validation.type,n=y.validation.operator,i=y.validation.value1,o=y.validation.value2,d=ej2Base.isNullOrUndefined(y.validation.ignoreBlank)?d:y.validation.ignoreBlank,p=ej2Base.isNullOrUndefined(y.validation.inCellDropDown)?p:y.validation.inCellDropDown)}if(!this.parent.element.querySelector(".e-datavalidation-dlg")){var x=this.parent.serviceLocator.getService(dialog);x.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-datavalidation-dlg",header:l.getConstant("DataValidation"),target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(e){var a={dialogName:"ValidationDialog",element:e.element,target:e.target,cancel:e.cancel};s.parent.trigger("dialogBeforeOpen",a),a.cancel&&(e.cancel=!0),t&&(h=!0),x.dialogInstance.content=s.dataValidationContent(h,r,n,i,o,d,p,u),x.dialogInstance.dataBind(),focus(s.parent.element)},buttons:[{buttonModel:{content:l.getConstant("CLEARALL"),cssClass:"e-btn e-clearall-btn e-flat"},click:function(){x.dialogInstance.content=s.dataValidationContent(!0,r,n,i,o,d,p,u),x.dialogInstance.dataBind(),focus(s.parent.element)}},{buttonModel:{content:l.getConstant("APPLY"),isPrimary:!0},click:function(){s.dlgClickHandler(x)}}]}),x.dialogInstance.refresh()}}else f.moreValidation&&this.moreValidationDlg(),f.extendValidation&&this.extendValidationDlg()},e.prototype.dataValidationContent=function(e,t,r,n,i,o,a,s){var l=this,d=this.parent.serviceLocator.getService(locale),p=e?"0":n,h=e?"0":i,c=this.parent.createElement("div",{className:"e-validation-dlg"}),u=this.parent.createElement("div",{className:"e-cellrange"}),g=this.parent.createElement("div",{className:"e-allowdata"}),f=this.parent.createElement("div",{className:"e-values"}),m=this.parent.createElement("div",{className:"e-ignoreblank"});c.appendChild(u),c.appendChild(g),c.appendChild(f),c.appendChild(m);var v=this.parent.createElement("span",{className:"e-header",innerHTML:d.getConstant("CellRange")}),C=this.parent.createElement("input",{className:"e-input",attrs:{value:s}});u.appendChild(v),u.appendChild(C);var y=this.parent.createElement("div",{className:"e-allow"}),x=this.parent.createElement("div",{className:"e-data"});g.appendChild(y),g.appendChild(x);var b=this.parent.createElement("span",{className:"e-header",innerHTML:d.getConstant("Allow")});this.typeData=[{text:d.getConstant("WholeNumber"),id:"type-1"},{text:d.getConstant("Decimal"),id:"type-2"},{text:d.getConstant("Date"),id:"type-3"},{text:d.getConstant("Time"),id:"type-4"},{text:d.getConstant("TextLength"),id:"type-5"},{text:d.getConstant("List"),id:"type-6"}],this.operatorData=[{text:d.getConstant("Between"),id:"operator-1"},{text:d.getConstant("NotBetween"),id:"operator-2"},{text:d.getConstant("EqualTo"),id:"operator-3"},{text:d.getConstant("NotEqualTo"),id:"operator-4"},{text:d.getConstant("Greaterthan"),id:"operator-5"},{text:d.getConstant("Lessthan"),id:"operator-6"},{text:d.getConstant("GreaterThanOrEqualTo"),id:"operator-7"},{text:d.getConstant("LessThanOrEqualTo"),id:"operator-8"}];var S=this.parent.createElement("input",{className:"e-select"}),w=0;if(!e)for(var I=0;I<this.typeData.length;I++)if(t===this.typeData[I].text.replace(" ","")){w=I;break}if(e||"List"!==t){var R=0,E=this.parent.createElement("span",{className:"e-header",innerHTML:d.getConstant("Data")}),k=this.parent.createElement("input",{className:"e-select"});if(!e)for(I=0;I<this.operatorData.length;I++)if(r===this.FormattedValue(this.operatorData[I].text)){R=I;break}x.appendChild(E),x.appendChild(k),this.dataList=new ej2Dropdowns.DropDownList({dataSource:this.operatorData,index:R,popupHeight:"200px",change:function(){l.userInput(A,l.dataList)}}),this.dataList.appendTo(k)}else{var F=this.parent.createElement("input",{className:"e-checkbox"});x.appendChild(F);new ej2Buttons.CheckBox({label:d.getConstant("InCellDropDown"),checked:a}).appendTo(F)}y.appendChild(b),y.appendChild(S);var A=new ej2Dropdowns.DropDownList({dataSource:this.typeData,index:w,popupHeight:"200px",change:function(){l.userInput(A,l.dataList)}});if(A.appendTo(S),e||"List"!==A.value&&("Between"===this.dataList.value||"Not between"===this.dataList.value)){var B=this.parent.createElement("div",{className:"e-minimum"}),T=this.parent.createElement("div",{className:"e-maximum"});f.appendChild(B),f.appendChild(T);var D=this.parent.createElement("span",{className:"e-header",innerHTML:d.getConstant("Minimum")}),N=this.parent.createElement("span",{className:"e-header",innerHTML:d.getConstant("Maximum")}),O=this.parent.createElement("input",{id:"minvalue",className:"e-input",attrs:{value:p}}),L=this.parent.createElement("input",{id:"maxvalue",className:"e-input",attrs:{value:h}});B.appendChild(D),B.appendChild(O),T.appendChild(N),T.appendChild(L);new ej2Inputs.NumericTextBox({value:0}).appendTo("#minvalue");new ej2Inputs.NumericTextBox({value:0}).appendTo("#maxvalue")}else if(e||" List"!==t){H=this.parent.createElement("span",{className:"e-header",innerHTML:d.getConstant("Value")}),j=this.parent.createElement("input",{className:"e-input",attrs:{value:p}});f.appendChild(H),f.appendChild(j)}else{var H=this.parent.createElement("span",{className:"e-header",innerHTML:d.getConstant("Sources")}),j=this.parent.createElement("input",{className:"e-input",attrs:{value:p}});f.appendChild(H),f.appendChild(j)}var M=o,_=this.parent.createElement("input",{className:"e-checkbox"});m.appendChild(_);return new ej2Buttons.CheckBox({label:d.getConstant("IgnoreBlank"),checked:M}).appendTo(_),c},e.prototype.validateRange=function(e,t){for(var r=!1,n=!1,i=[],o=[],a=[],s=[],l=e[0];l<=e[2];l++)if(t.rows[l])for(var d=e[1];d<=e[3];d++)if(t.rows[l].cells&&t.rows[l].cells[d]){(m=t.rows[l].cells[d]).validation&&(i.push(m.validation.type),o.push(m.validation.operator),a.push(m.validation.value1),s.push(m.validation.value2))}for(var p=e[1];p<=e[3];p++){(v=getColumn(t,p))&&v.validation&&(i.push(v.validation.type),o.push(v.validation.operator),a.push(v.validation.value1),s.push(v.validation.value2))}var h=[];for(p=0;p<i.length;p++)-1===h.indexOf(i[p])&&h.push(i[p]);if(h.length>1&&(r=!0),!r){h=[];for(var c=0;c<o.length;c++)-1===h.indexOf(o[c])&&h.push(o[c]);h.length>1&&(r=!0)}if(!r){h=[];for(c=0;c<a.length;c++)-1===h.indexOf(a[c])&&h.push(a[c]);h.length>1&&(r=!0)}if(!r){h=[];for(c=0;c<s.length;c++)-1===h.indexOf(s[c])&&h.push(s[c]);h.length>1&&(r=!0)}if(!r){for(var u=0,g=0,f=e[0];f<=e[2];f++)if(t.rows[f])for(d=e[1];d<=e[3];d++)if(t.rows[f].cells&&t.rows[f].cells[d]){var m;g++,(m=t.rows[f].cells[d]).validation&&u++}if(0===u)for(p=e[1];p<=e[3];p++){var v;(v=getColumn(t,p))&&v.validation&&u++}u>0&&g>1&&u!==g&&(n=!0)}return{moreValidation:r,extendValidation:n}},e.prototype.moreValidationDlg=function(){var e=this,t=this.parent.serviceLocator.getService(locale),r=this.parent.serviceLocator.getService(dialog),n=!1,i={width:350,isModal:!0,showCloseIcon:!0,cssClass:"e-goto-dlg",header:t.getConstant("Spreadsheet"),beforeOpen:function(n){var i={dialogName:"MoreValidation",element:n.element,target:n.target,cancel:n.cancel};e.parent.trigger("dialogBeforeOpen",i),i.cancel&&(n.cancel=!0),r.dialogInstance.content=t.getConstant("MoreValidation"),r.dialogInstance.dataBind(),focus(e.parent.element)},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){r.hide(),n=!0}}],close:function(){n?(e.initiateDataValidationHandler(!0),n=!1):r.hide()}};r.show(i)},e.prototype.extendValidationDlg=function(){var e=this,t=this.parent.serviceLocator.getService(locale),r=this.parent.serviceLocator.getService(dialog),n=!1,i=!1,o={width:550,isModal:!0,showCloseIcon:!0,cssClass:"e-goto-dlg",header:t.getConstant("Spreadsheet"),beforeOpen:function(n){var i={dialogName:"ExtendValidation",element:n.element,target:n.target,cancel:n.cancel};e.parent.trigger("dialogBeforeOpen",i),i.cancel&&(n.cancel=!0),r.dialogInstance.content=t.getConstant("ExtendValidation"),r.dialogInstance.dataBind(),focus(e.parent.element)},buttons:[{buttonModel:{content:t.getConstant("Yes"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){r.hide(),n=!0}},{buttonModel:{content:t.getConstant("No"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){r.hide(),n=!0,i=!0}}],close:function(){n?(e.initiateDataValidationHandler(!0,i),n=!1):r.hide()}};r.show(o)},e.prototype.userInput=function(e,t){for(var r=this.parent.element.querySelector(".e-datavalidation-dlg").querySelector(".e-validation-dlg"),n=r.querySelector(".e-allowdata"),i=r.querySelector(".e-values"),o=this.parent.serviceLocator.getService(locale),a=n.querySelector(".e-data");i.lastChild;)i.removeChild(i.lastChild);if("List"===e.value){for(;a.lastChild;)a.removeChild(a.lastChild);var s=this.parent.createElement("input",{className:"e-checkbox"});a.appendChild(s);new ej2Buttons.CheckBox({label:o.getConstant("InCellDropDown"),checked:!0}).appendTo(s)}else if(a.getElementsByClassName("e-checkbox-wrapper")[0]){for(;a.lastChild;)a.removeChild(a.lastChild);var l=this.parent.createElement("span",{className:"e-header",innerHTML:"Data"}),d=this.parent.createElement("input",{className:"e-select"});a.appendChild(l),a.appendChild(d),t.appendTo(d)}if("List"===e.value||"Between"!==t.value&&"Not between"!==t.value){var p="List"===e.value?o.getConstant("Sources"):o.getConstant("Value"),h=this.parent.createElement("span",{className:"e-header",innerHTML:p}),c="List"===e.value?this.parent.createElement("input",{className:"e-input",attrs:{placeholder:"Enter value"}}):this.parent.createElement("input",{className:"e-input",attrs:{value:"0"}});i.appendChild(h),i.appendChild(c)}else{var u=this.parent.createElement("div",{className:"e-minimum"}),g=this.parent.createElement("div",{className:"e-maximum"});i.appendChild(u),i.appendChild(g);var f=this.parent.createElement("span",{className:"e-header",innerHTML:o.getConstant("Minimum")}),m=this.parent.createElement("span",{className:"e-header",innerHTML:o.getConstant("Maximum")}),v=this.parent.createElement("input",{id:"min",className:"e-input",attrs:{value:"0"}}),C=this.parent.createElement("input",{id:"max",className:"e-input",attrs:{value:"0"}});new ej2Inputs.NumericTextBox({value:0}).appendTo("min");new ej2Inputs.NumericTextBox({value:0}).appendTo("max"),u.appendChild(f),u.appendChild(v),g.appendChild(m),g.appendChild(C)}},e.prototype.dlgClickHandler=function(e){this.parent.dataValidationRange=this.parent.dataValidationRange+this.parent.getActiveSheet().selectedRange+",";var t,r,n=this.parent.serviceLocator.getService(locale),i=this.parent.element.querySelector(".e-datavalidation-dlg"),o=i.querySelector(".e-footer-content"),a=i.getElementsByClassName("e-dlg-content")[0].getElementsByClassName("e-validation-dlg")[0],s=a.getElementsByClassName("e-allowdata")[0],l=s.getElementsByClassName("e-allow")[0].getElementsByTagName("input")[0],d=s.getElementsByClassName("e-data")[0].getElementsByTagName("input")[0],p=a.getElementsByClassName("e-values")[0],h=p.getElementsByTagName("input")[0].value,c=p.getElementsByTagName("input")[1]?p.getElementsByTagName("input")[1].value:"",u="true"===a.querySelector(".e-ignoreblank").querySelector(".e-checkbox-wrapper").getAttribute("aria-checked"),g=s.querySelector(".e-data").querySelector(".e-checkbox-wrapper")?!!s.querySelector(".e-data").querySelector(".e-checkbox-wrapper").querySelector(".e-check"):null,f=a.querySelector(".e-cellrange").getElementsByTagName("input")[0].value,m=l.value;d&&(r=d.value,r=this.FormattedValue(r)),m&&(m=m.replace(" ",""));var v=[],C=[];""!==h&&C.push(h),""!==c&&C.push(c);var y=!0;if("List"===m)if(-1!==h.indexOf("=")){if(-1!==h.indexOf(":")){var x=h.indexOf("!")>-1?h.split("!")[1]:h.split("=")[1],b=!(h.indexOf("!")>-1)||getSheetIndex(this.parent,h.split("=")[1].split("!")[0])>-1;v=x.split(":");var S=!!x.match(/[a-z]/gi)&&v[0].replace(/[0-9]/g,"")===v[1].replace(/[0-9]/g,""),w=!!x.match(/\d/g)&&v[0].replace(/\D/g,"")===v[1].replace(/\D/g,"");(y=!!b&&(!!S||!!w))||(t=n.getConstant("DialogError"))}}else h.length>256&&(y=!1,t=n.getConstant("ListLengthError"));if(y){var I=this.parent.getActiveSheet(),R=m,E=this.isDialogValidator(C,R,r);if("Between"===r&&!isNaN(parseFloat(h))&&!isNaN(parseFloat(c))&&parseFloat(h)>parseFloat(c)&&(E.isValidate=!1,E.errorMsg=n.getConstant("MinMaxError")),t=E.errorMsg,y=E.isValidate){var k=getCellIndexes(I.activeCell),F=getCell(k[0],k[1],I,!1,!0),A=F.validation&&"List"===F.validation.type,B={range:f,value1:h,value2:c,ignoreBlank:u,type:m,operator:r,inCellDropDown:g,cancel:!1};if(this.parent.notify(beginAction,{eventArgs:B,action:"validation"}),!B.cancel){if(this.parent.notify(cellValidation,{rules:{type:B.type,operator:B.operator,value1:B.value1,value2:c,ignoreBlank:B.ignoreBlank,inCellDropDown:B.inCellDropDown},range:B.range}),(F=getCell(k[0],k[1],I,!1,!0)).validation){if(A){var T=this.parent.getCell(k[0],k[1]);T&&T.getElementsByClassName("e-validation-list")[0]&&(this.listObj.destroy(),T.removeChild(T.getElementsByClassName("e-validation-list")[0]))}"List"===F.validation.type&&this.listHandler()}delete B.cancel,this.parent.notify(completeAction,{eventArgs:B,action:"validation"}),document.getElementsByClassName("e-validationerror-dlg")[0]||(e.dialogInstance?e.dialogInstance.hide():e.hide())}}}if(!y){var D=this.parent.createElement("div",{className:"e-dlg-error",id:"e-invalid",innerHTML:t});p.appendChild(D),o.querySelector(".e-primary").setAttribute("disabled","true")}},e.prototype.FormattedValue=function(e){switch(e){case"Between":e="Between";break;case"Not between":e="NotBetween";break;case"Equal to":e="EqualTo";break;case"Not equal to":e="NotEqualTo";break;case"Greater than":e="GreaterThan";break;case"Less than":e="LessThan";break;case"Greater than or equal to":e="GreaterThanOrEqualTo";break;case"Less than or equal to":e="LessThanOrEqualTo";break;default:e="Between"}return e},e.prototype.isDialogValidator=function(e,t,r){var n,i=this.parent.serviceLocator.getService(locale),o=0;if("List"===t?!(e.length>0):"Between"===r||"NotBetween"===r?2!==e.length:!(e.length>0))n={isValidate:!1,errorMsg:i.getConstant("EmptyError")};else{for(var a=0;a<e.length;a++){var s=checkIsFormula(e[a])?this.parent.computeExpression(e[a]).toString():e[a];if(!(n=this.formatValidation(s,t)).isValidate)break;o+=1}n.isValidate=o===e.length}return{isValidate:n.isValidate,errorMsg:n.errorMsg}},e.prototype.isValidationHandler=function(e){var t=this.parent.serviceLocator.getService(locale);e.value=e.value?e.value:"";var r,n,i,o=e.value,a=this.parent.sheets[e.sheetIdx],s=getCell(e.range[0],e.range[1],a),l=getColumn(a,e.range[1]);if(s&&s.validation?i=s.validation:l&&l.validation&&(i=l.validation),i){var d=i.value1,p=i.value2;checkIsFormula(d)&&"List"!==i.type&&(d=this.parent.computeExpression(d).toString()),checkIsFormula(p)&&"List"!==i.type&&(p=this.parent.computeExpression(p).toString()),checkIsFormula(e.value)&&"List"!==i.type&&(e.value=this.parent.computeExpression(e.value).toString());var h=e.value,c=i.operator||"Between",u=i.type||"WholeNumber",g=!!ej2Base.isNullOrUndefined(i.ignoreBlank)||i.ignoreBlank,f=this.formatValidation(e.value,u);if(r=f.isValidate,n=f.errorMsg,r){if(r=!1,"Date"===u||"Time"===u){e.value=e.value.toString().slice(e.value.toString().indexOf(" ")+1,e.value.length);for(var m=0;m<3;m++){e.value=0===m?e.value:1===m?d:p;var v={value:e.value,rowIndex:e.range[0],colIndex:e.range[1],sheetIndex:e.sheetIdx,updatedVal:""};""!==e.value&&this.parent.notify(checkDateFormat,v);var C=v.updatedVal;0===m&&""===C?h=e.value:0===m?h=C:1===m?d=C:p=C}}else if("TextLength"===i.type){v={value:e.value,rowIndex:e.range[0],colIndex:e.range[1],sheetIndex:e.sheetIdx,updatedVal:""};this.parent.notify(checkDateFormat,v);h=""!==(C=v.updatedVal)?C.toString().length.toString():e.value.toString().length.toString()}if("List"===u)if(-1!==d.indexOf("="))for(m=0;m<this.data.length;m++)e.value.toString()===this.data[m].text&&(r=!0);else{var y=d.split(",");for(m=0;m<y.length;m++)e.value.toString()===y[m]&&(r=!0)}else switch("Decimal"===u||"Time"===u?(h=parseFloat(h.toString()),d=parseFloat(d.toString()),p=p?parseFloat(p.toString()):null):(h=parseInt(h.toString(),10),d=parseInt(d.toString(),10),p=p?parseInt(p.toString(),10):null),c){case"EqualTo":r=h===d||!(!g||""!==o);break;case"NotEqualTo":r=h!==d||!(!g||""!==o);break;case"Between":r=h>=d&&h<=p||!(!g||""!==o);break;case"NotBetween":r=!(h>=d&&h<=p);break;case"GreaterThan":r=h>d||!(!g||""!==o);break;case"LessThan":r=h<d||!(!g||""!==o);break;case"GreaterThanOrEqualTo":r=h>=d||!(!g||""!==o);break;case"LessThanOrEqualTo":r=h<=d||!(!g||""!==o)}}}if(n=t.getConstant("ValidationError"),r){var x=this.parent.getCellStyleValue(["backgroundColor","color"],[e.range[0],e.range[1]]);isHiddenRow(a,e.range[0])||this.parent.notify(applyCellFormat,{style:x,rowIdx:e.range[0],colIdx:e.range[1],isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:!0})}return{isValidate:r,errorMsg:n}},e.prototype.checkDataValidation=function(e){var t=getCell(e.range[0],e.range[1],this.parent.getActiveSheet()),r={skip:!1,value:""};if(t.validation){if(checkIsFormula(t.validation.value1)&&!isCellReference(t.validation.value1.substring(1,t.validation.value1.length))&&t.validation.value1.indexOf("(")>-1){var n=t.validation.value1;n=n.substring(n.indexOf("=")+1,n.indexOf("(")),r.value=n.toUpperCase(),this.parent.notify(formulaInValidation,r)}if(!r.skip&&checkIsFormula(t.validation.value2)&&!isCellReference(t.validation.value2.substring(1,t.validation.value2.length))&&t.validation.value1.indexOf("(")>-1){var i=t.validation.value2;i=i.substring(i.indexOf("=")+1,i.indexOf("(")),r.value=i.toUpperCase(),this.parent.notify(formulaInValidation,r)}}if(!r.skip){var o=this.isValidationHandler({value:e.value,range:e.range,sheetIdx:e.sheetIdx});!o.isValidate&&e.isCell&&this.validationErrorHandler(o.errorMsg),this.parent.allowDataValidation=o.isValidate}},e.prototype.formatValidation=function(e,t){var r,n=this.parent.element.getElementsByClassName("e-sheet-panel")[0],i=this.parent.createElement("form",{id:"formId",className:"form-horizontal"}),o=this.parent.createElement("input",{id:"e-validation",innerHTML:e});o.setAttribute("name","validation"),o.setAttribute("type","text"),o.setAttribute("value",e),i.appendChild(o),n.appendChild(i);var a;switch(t){case"Date":a={rules:{validation:{date:!0}},customPlacement:function(e,t){r=t.innerText}};break;case"Decimal":a={rules:{validation:{number:!0}},customPlacement:function(e,t){r=t.innerText}};break;case"WholeNumber":a={rules:{validation:{regex:/^\d*\.?[0]*$/}},customPlacement:function(e,t){r=t.innerText}}}var s=new ej2Inputs.FormValidator("#formId",a).validate();return n.removeChild(n.getElementsByClassName("form-horizontal")[0]),{isValidate:s,errorMsg:r}},e.prototype.InvalidElementHandler=function(e){var t=e.rowIdx,r=e.colIdx,n=e.isRemoveHighlightedData;if(n){if(n){var i=this.parent.getCellStyleValue(["backgroundColor","color"],[t,r]);this.parent.notify(applyCellFormat,{style:i,rowIdx:t,colIdx:r,cell:e.td})}}else this.parent.notify(applyCellFormat,{style:{backgroundColor:"#ffff00",color:"#ff0000"},rowIdx:t,colIdx:r,cell:e.td})},e.prototype.validationErrorHandler=function(e){var t=this,r=document.getElementsByClassName("e-spreadsheet-edit")[0],n=this.parent.serviceLocator.getService(locale);if(!this.parent.element.querySelector(".e-validationerror-dlg")){var i=this.parent.serviceLocator.getService(dialog),o={width:400,height:200,isModal:!0,showCloseIcon:!0,cssClass:"e-validationerror-dlg",target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(n){var o={dialogName:"ValidationErrorDialog",element:n.element,target:n.target,cancel:n.cancel,content:e};t.parent.trigger("dialogBeforeOpen",o),o.cancel&&(t.errorDlgHandler(i,"Cancel"),n.cancel=!0),r.focus(),i.dialogInstance.content=o.content,i.dialogInstance.dataBind()},buttons:[{buttonModel:{content:n.getConstant("Retry"),isPrimary:!0},click:function(){t.errorDlgHandler(i,"Retry")}},{buttonModel:{content:n.getConstant("Cancel")},click:function(){t.errorDlgHandler(i,"Cancel")}}]};i.show(o,!1)}},e.prototype.errorDlgHandler=function(e,t){if("Retry"===t){var r=document.getElementsByClassName("e-spreadsheet-edit")[0];e.hide(),r.innerText&&(window.getSelection().selectAllChildren(r),this.listObj&&this.listObj.showPopup())}else{var n=getCellIndexes(this.parent.getActiveSheet().activeCell),i=getCell(n[0],n[1],this.parent.getActiveSheet()),o=i?this.parent.getDisplayText(i):"";this.parent.notify(editOperation,{action:"cancelEdit",value:o,refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!1,trigEvent:!0}),e.hide()}},e.prototype.getModuleName=function(){return"dataValidation"},e}(),ProtectSheet=function(){function e(e){this.password="",this.parent=e,this.init()}return e.prototype.init=function(){this.addEventListener()},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(applyProtect,this.protect,this),this.parent.on(protectSheet,this.protectSheetHandler,this),this.parent.on(editAlert,this.editProtectedAlert,this),this.parent.on(applyLockCells,this.lockCellsHandler,this),this.parent.on(protectWorkbook,this.protectWorkbook,this),this.parent.on(keyUp,this.KeyUpHandler,this),this.parent.on(unProtectWorkbook,this.unProtectWorkbook,this),this.parent.on(UnProtectWorksheet,this.unProtectsheet,this),this.parent.on(unProtectSheetPassword,this.unProtectSheetPassword,this),this.parent.on(getPassWord,this.getPassWord,this),this.parent.on(importProtectWorkbook,this.importProtectWorkbook,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(applyProtect,this.protect),this.parent.off(protectSheet,this.protectSheetHandler),this.parent.off(editAlert,this.editProtectedAlert),this.parent.off(applyLockCells,this.lockCellsHandler),this.parent.off(protectWorkbook,this.protectWorkbook),this.parent.off(keyUp,this.KeyUpHandler),this.parent.off(unProtectWorkbook,this.unProtectWorkbook),this.parent.off(UnProtectWorksheet,this.unProtectsheet),this.parent.off(unProtectSheetPassword,this.unProtectSheetPassword),this.parent.off(getPassWord,this.getPassWord),this.parent.off(importProtectWorkbook,this.importProtectWorkbook))},e.prototype.protect=function(e){this.parent.notify(clearCopy,null),e.isActive?(this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"isProtected",!1),this.parent.notify(updateToggleItem,{props:"Protect"}),this.parent.notify(protectSheet,{isActive:e.isActive}),this.parent.notify(protectSelection,null)):this.createDialogue()},e.prototype.createDialogue=function(){var e=this,t=this.parent.serviceLocator.getService(locale),r=[{text:t.getConstant("SelectCells"),id:"1"},{text:t.getConstant("FormatCells"),id:"2"},{text:t.getConstant("FormatRows"),id:"3"},{text:t.getConstant("FormatColumns"),id:"4"},{text:t.getConstant("InsertLinks"),id:"5"}];this.optionList=new ej2Lists.ListView({width:"250px",dataSource:r,showCheckBox:!0,select:this.dialogOpen.bind(this)});var n=this.parent.createElement("div",{className:"e-sheet-password-dialog"}),i=this.parent.createElement("div",{className:"e-sheet-password-content"}),o=this.parent.createElement("div",{className:"e-header",innerHTML:t.getConstant("SheetPassword")}),a=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});a.setAttribute("placeholder",t.getConstant("EnterThePassword")),i.appendChild(a),i.insertBefore(o,a),n.appendChild(i);var s=this.parent.createElement("div",{className:"e-protect-content",innerHTML:t.getConstant("ProtectAllowUser")});this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"isProtected",!1);var l=new ej2Buttons.CheckBox({checked:!0,label:t.getConstant("ProtectContent"),cssClass:"e-protect-checkbox"}),d=this.parent.createElement("div",{className:"e-protect-option-list",id:this.parent.element.id+"_option_list"}),p=this.parent.createElement("div",{className:"e-header-content",innerHTML:t.getConstant("ProtectSheet")}),h=this.parent.createElement("input",{id:this.parent.element.id+"_protect_check",attrs:{type:"checkbox"}});this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({header:p.outerHTML,content:n.outerHTML+h.outerHTML+s.outerHTML+d.outerHTML,showCloseIcon:!0,isModal:!0,cssClass:"e-protect-dlg",beforeOpen:function(t){var r={dialogName:"ProtectSheetDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel&&(t.cancel=!0),focus(e.parent.element)},open:function(){e.okBtnFocus()},beforeClose:function(){var t=document.getElementById(e.parent.element.id+"_protect_check");ej2Base.EventHandler.remove(t,"focus",e.okBtnFocus),ej2Base.EventHandler.remove(l.element,"click",e.checkBoxClickHandler),focus(e.parent.element)},buttons:[{click:this.selectOption.bind(this,this.dialog,this),buttonModel:{content:t.getConstant("Ok"),isPrimary:!0}},{click:this.cancelClick.bind(this,this.dialog,this),buttonModel:{content:t.getConstant("Cancel")}}]},!1),l.appendTo("#"+this.parent.element.id+"_protect_check"),this.optionList.appendTo("#"+this.parent.element.id+"_option_list"),this.optionList.selectMultipleItems([{id:"1"}]),ej2Base.EventHandler.add(l.element,"click",this.checkBoxClickHandler,this)},e.prototype.okBtnFocus=function(){var e=this;document.getElementById(this.parent.element.id+"_protect_check").addEventListener("focus",function(){e.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus()})},e.prototype.cancelClick=function(){var e=document.querySelector(".e-protect-dlg");ej2Base.getComponent(e,"dialog").destroy()},e.prototype.checkBoxClickHandler=function(){!1===document.getElementById(this.parent.element.id+"_protect_check").checked?this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").disabled=!0:(this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").disabled=!1,this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus())},e.prototype.dialogOpen=function(){this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus()},e.prototype.selectOption=function(){var e=this.parent.getActiveSheet(),t=this.parent.element.querySelector(".e-sheet-password-dialog").getElementsByClassName("e-sheet-password-content")[0].querySelector(".e-input");0===t.value.length?(this.parent.setSheetPropertyOnMute(e,"isProtected",!0),this.parent.setSheetPropertyOnMute(e,"password",t.value),this.updateProtectSheet(t.value),this.dialog.hide(),e.protectSettings.selectCells||this.parent.notify(hideAutoFillElement,null)):this.reEnterSheetPassword()},e.prototype.selectSheetPassword=function(){var e=this.parent.serviceLocator.getService(locale),t=this.parent.getActiveSheet(),r=this.parent.element.querySelector(".e-sheet-password-dialog").getElementsByClassName("e-sheet-password-content")[0].querySelector(".e-input"),n=this.parent.element.querySelector(".e-reenterpwd-dialog").getElementsByClassName("e-reenterpwd-content")[0].querySelector(".e-input"),i=this.parent.createElement("span",{className:"e-reenterpwd-alert-span"});if(r.value===n.value){this.parent.setSheetPropertyOnMute(t,"isProtected",!0),this.parent.setSheetPropertyOnMute(t,"password",r.value),this.updateProtectSheet(r.value),this.dialog.hide();var o=document.querySelector(".e-protect-dlg");ej2Base.getComponent(o,"dialog").destroy(),t.protectSettings.selectCells||this.parent.notify(hideAutoFillElement,null)}else""===r.value?i.textContent=e.getConstant("PasswordAlertMsg"):""===n.value?i.textContent=e.getConstant("ConfirmPasswordAlertMsg"):r.value!==n.value&&(i.textContent=e.getConstant("PasswordAlert")),this.parent.element.querySelector(".e-reenterpwd-dlg").querySelector(".e-reenterpwd-dialog").appendChild(i)},e.prototype.updateProtectSheet=function(e){var t=this.parent.serviceLocator.getService(locale),r=this.optionList.getSelectedItems(),n={selectCells:r.text.indexOf(t.getConstant("SelectCells"))>-1,formatCells:r.text.indexOf(t.getConstant("FormatCells"))>-1,formatRows:r.text.indexOf(t.getConstant("FormatRows"))>-1,formatColumns:r.text.indexOf(t.getConstant("FormatColumns"))>-1,insertLink:r.text.indexOf(t.getConstant("InsertLinks"))>-1};this.parent.protectSheet(null,n,e),this.parent.notify(protectSelection,null),this.parent.notify(clearUndoRedoCollection,null)},e.prototype.protectSheetHandler=function(){var e=this.parent.getActiveSheet(),t=this.parent.element.id,r=[t+"_undo",t+"_redo",t+"_cut",t+"_copy",t+"_paste",t+"_number_format",t+"_font_name",t+"_font_size",t+"_bold",t+"_italic",t+"_line-through",t+"_underline",t+"_font_color_picker",t+"_fill_color_picker",t+"_borders",t+"_merge_cells",t+"_text_align",t+"_vertical_align",t+"_wrap",t+"_sorting",t+"_clear",t+"_conditionalformatting"],n=[t+"_cut",t+"_copy",t+"_number_format",t+"_font_name",t+"_font_size",t+"_bold",t+"_italic",t+"_line-through",t+"_underline",t+"_font_color_picker",t+"_fill_color_picker",t+"_borders",t+"_text_align",t+"_vertical_align",t+"_wrap",t+"_sorting",t+"_clear",t+"_conditionalformatting"],i=[t+"_insert_function"],o=[t+"_hyperlink",t+"_",t+"_chart"],a=[t+"_image"],s=[t+"_find"],l=[t+"_datavalidation"],d=[t+"_chart"],p=document.getElementById(this.parent.element.id+"_sheet_panel");p&&(e.isProtected&&e.protectSettings.selectCells?p.classList.remove("e-protected"):p.classList.add("e-protected"),e.isProtected||p.classList.remove("e-protected")),this.parent.dataBind(),this.parent.notify(protectCellFormat,{disableHomeBtnId:r,enableHomeBtnId:n,enableFrmlaBtnId:i,enableInsertBtnId:o,findBtnId:s,dataValidationBtnId:l,imageBtnId:a,chartBtnId:d}),this.parent.notify(enableFormulaInput,null),e.isProtected&&this.parent.notify(updateToggleItem,{props:"Protect"})},e.prototype.editProtectedAlert=function(){var e=this,t=this.parent.serviceLocator.getService(locale);this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({content:t.getConstant("EditAlert"),isModal:!0,closeOnEscape:!0,showCloseIcon:!0,width:"400px",cssClass:"e-editAlert-dlg",beforeOpen:function(r){var n={dialogName:"EditAlertDialog",content:t.getConstant("EditAlert"),element:r.element,target:r.target,cancel:r.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(r.cancel=!0,getUpdateUsingRaf(function(){return e.dialog.destroyDialog()})),e.dialog.dialogInstance.content=n.content,focus(e.parent.element)},close:function(){return focus(e.parent.element)}})},e.prototype.lockCellsHandler=function(e){var t=this.parent.getActiveSheet(),r={isLocked:!!e.isLocked&&e.isLocked};setCell(e.rowIdx,e.colIdx,t,r,!0)},e.prototype.protectWorkbook=function(){var e=this,t=this.parent.serviceLocator.getService(locale),r=this.parent.serviceLocator.getService(dialog);r.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-protectworkbook-dlg",header:t.getConstant("ProtectWorkbook"),beforeOpen:function(t){var n={dialogName:"ProtectWorkbook",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),r.dialogInstance.content=e.passwordProtectContent(),r.dialogInstance.dataBind(),e.parent.element.focus()},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:function(){e.alertMessage(),e.dlgClickHandler(r)}}]})},e.prototype.passwordProtectContent=function(){var e=this.parent.serviceLocator.getService(locale),t=this.parent.createElement("div",{className:"e-password-dialog"}),r=this.parent.createElement("div",{className:"e-password-content"}),n=this.parent.createElement("div",{className:"e-password-content"}),i=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("Password")}),o=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("ConfirmPassword")}),a=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}}),s=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return a.setAttribute("placeholder",e.getConstant("EnterThePassword")),s.setAttribute("placeholder",e.getConstant("EnterTheConfirmPassword")),r.appendChild(a),r.insertBefore(i,a),n.appendChild(s),n.insertBefore(o,s),t.appendChild(n),t.insertBefore(r,n),t},e.prototype.KeyUpHandler=function(e){var t=e.target;if(t.classList.contains("e-text")&&ej2Base.closest(t,".e-password-content")&&ej2Base.closest(t,".e-password-dialog")&&ej2Base.closest(t,".e-password-dialog").getElementsByClassName("e-password-content")[1]===t.parentElement){var r=ej2Base.closest(t,".e-protectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==t.value?r.removeAttribute("disabled"):r.setAttribute("disabled","true")}if(t.classList.contains("e-text")&&ej2Base.closest(t,".e-unprotectpwd-content")&&ej2Base.closest(t,".e-unprotectpwd-dialog")&&ej2Base.closest(t,".e-unprotectpwd-dialog").getElementsByClassName("e-unprotectpwd-content")[0]===t.parentElement){var n=ej2Base.closest(t,".e-unprotectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==t.value?n.removeAttribute("disabled"):n.setAttribute("disabled","true")}if(t.classList.contains("e-text")&&ej2Base.closest(t,".e-reenterpwd-content")&&ej2Base.closest(t,".e-reenterpwd-dialog")&&ej2Base.closest(t,".e-reenterpwd-dialog").getElementsByClassName("e-reenterpwd-content")[0]===t.parentElement){var i=ej2Base.closest(t,".e-reenterpwd-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==t.value?i.removeAttribute("disabled"):i.setAttribute("disabled","true")}if(t.classList.contains("e-text")&&ej2Base.closest(t,".e-unprotectsheetpwd-content")&&ej2Base.closest(t,".e-unprotectsheetpwd-dialog")&&ej2Base.closest(t,".e-unprotectsheetpwd-dialog").getElementsByClassName("e-unprotectsheetpwd-content")[0]===t.parentElement){var o=ej2Base.closest(t,".e-unprotectworksheet-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==t.value?o.removeAttribute("disabled"):o.setAttribute("disabled","true")}if(t.classList.contains("e-text")&&ej2Base.closest(t,".e-importprotectpwd-content")&&ej2Base.closest(t,".e-importprotectpwd-dialog")&&ej2Base.closest(t,".e-importprotectpwd-dialog").getElementsByClassName("e-importprotectpwd-content")[0]===t.parentElement){o=ej2Base.closest(t,".e-importprotectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==t.value?o.removeAttribute("disabled"):o.setAttribute("disabled","true")}},e.prototype.alertMessage=function(){var e=this.parent.element.querySelector(".e-pwd-alert-span"),t=this.parent.element.querySelector(".e-unprotectpwd-alert-span"),r=this.parent.element.querySelector(".e-importprotectpwd-alert-span"),n=this.parent.element.querySelector(".e-reenterpwd-alert-span"),i=this.parent.element.querySelector(".e-unprotectsheetpwd-alert-span");e&&e.remove(),t&&t.remove(),r&&r.remove(),n&&n.remove(),i&&i.remove()},e.prototype.dlgClickHandler=function(e){var t=this.parent.serviceLocator.getService(locale),r=this.parent.element.querySelector(".e-password-dialog").getElementsByClassName("e-password-content")[0].querySelector(".e-input"),n=this.parent.element.querySelector(".e-password-dialog").getElementsByClassName("e-password-content")[1].querySelector(".e-input"),i=this.parent.createElement("span",{className:"e-pwd-alert-span"});r.value===n.value?(this.parent.password=r.value,this.parent.isProtected=!0,e.hide(),this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.parent.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled")),this.parent.notify(updateToggleItem,{props:"Protectworkbook"})):""===r.value?i.textContent=t.getConstant("PasswordAlertMsg"):""===n.value?i.textContent=t.getConstant("ConfirmPasswordAlertMsg"):r.value!==n.value&&(i.textContent=t.getConstant("PasswordAlert")),this.parent.element.querySelector(".e-protectworkbook-dlg").querySelector(".e-dlg-content").appendChild(i)},e.prototype.unProtectWorkbook=function(){var e=this,t=this.parent.serviceLocator.getService(locale),r=this.parent.serviceLocator.getService(dialog);r.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-unprotectworkbook-dlg",header:t.getConstant("UnProtectWorkbook"),beforeOpen:function(t){var n={dialogName:"UnProtectWorkbook",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),r.dialogInstance.content=e.unProtectPasswordContent(),r.dialogInstance.dataBind(),e.parent.element.focus()},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){e.alertMessage(),e.unprotectdlgOkClick(r)}}]})},e.prototype.unProtectsheet=function(e){var t=this,r=this.parent.serviceLocator.getService(locale),n=this.parent.serviceLocator.getService(dialog);n.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-unprotectworksheet-dlg",header:r.getConstant("UnProtectWorksheet"),beforeOpen:function(e){var r={dialogName:"UnProtectSheet",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0),n.dialogInstance.content=t.unProtectSheetPasswordContent(),n.dialogInstance.dataBind(),t.parent.element.focus()},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,disabled:!this.parent.openModule.isImportedFile||-1!==this.parent.openModule.unProtectSheetIdx.indexOf(this.parent.activeSheetIndex)},click:function(){t.alertMessage(),t.unprotectSheetdlgOkClick(n,e&&e.isImportedSheet)}}]})},e.prototype.reEnterSheetPassword=function(){var e=this,t=this.parent.serviceLocator.getService(locale),r=this.parent.serviceLocator.getService(dialog);r.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-reenterpwd-dlg",header:t.getConstant("ConfirmPassword"),beforeOpen:function(t){var n={dialogName:"Re-enterPassword",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),r.dialogInstance.content=e.reEnterSheetPasswordContent(),r.dialogInstance.dataBind(),e.parent.element.focus()},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){e.alertMessage(),e.selectSheetPassword()}}]})},e.prototype.unProtectPasswordContent=function(){var e=this.parent.serviceLocator.getService(locale),t=this.parent.createElement("div",{className:"e-unprotectpwd-dialog"}),r=this.parent.createElement("div",{className:"e-unprotectpwd-content"}),n=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("EnterThePassword")}),i=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return r.appendChild(i),r.insertBefore(n,i),t.appendChild(r),t},e.prototype.reEnterSheetPasswordContent=function(){var e=this.parent.serviceLocator.getService(locale),t=this.parent.createElement("div",{className:"e-reenterpwd-dialog"}),r=this.parent.createElement("div",{className:"e-reenterpwd-content"}),n=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("ReEnterPassword")}),i=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return r.appendChild(i),r.insertBefore(n,i),t.appendChild(r),t},e.prototype.unProtectSheetPasswordContent=function(){var e=this.parent.serviceLocator.getService(locale),t=this.parent.createElement("div",{className:"e-unprotectsheetpwd-dialog"}),r=this.parent.createElement("div",{className:"e-unprotectsheetpwd-content"}),n=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("EnterThePassword")}),i=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return r.appendChild(i),r.insertBefore(n,i),t.appendChild(r),t},e.prototype.unprotectdlgOkClick=function(e){var t=this.parent.serviceLocator.getService(locale),r=this.parent.element.querySelector(".e-unprotectpwd-dialog").getElementsByClassName("e-unprotectpwd-content")[0].querySelector(".e-input");if(this.parent.password===r.value)e.hide(),this.parent.password="",this.parent.isProtected=!1,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),document.getElementById(this.parent.element.id+"_protectworkbook").classList.remove("e-active"),this.parent.notify(updateToggleItem,{props:"Protectworkbook"});else{var n=this.parent.createElement("span",{className:"e-unprotectpwd-alert-span",innerHTML:t.getConstant("UnProtectPasswordAlert")});this.parent.element.querySelector(".e-unprotectworkbook-dlg").querySelector(".e-dlg-content").appendChild(n)}},e.prototype.unprotectSheetdlgOkClick=function(e,t){var r=this.parent.serviceLocator.getService(locale),n=this.parent.getActiveSheet(),i=this.parent.element.querySelector(".e-unprotectsheetpwd-dialog").getElementsByClassName("e-unprotectsheetpwd-content")[0].querySelector(".e-input");if(t&&0===n.password.length){var o={sheetPassword:i.value,sheetIndex:this.parent.activeSheetIndex};this.parent.open(o)}else if(n.password===i.value)e.hide(),this.unProtectSheetPassword();else{var a=this.parent.createElement("span",{className:"e-unprotectsheetpwd-alert-span",innerHTML:r.getConstant("UnProtectPasswordAlert")});this.parent.element.querySelector(".e-unprotectworksheet-dlg").querySelector(".e-dlg-content").appendChild(a)}},e.prototype.unProtectSheetPassword=function(){var e=this.parent.getActiveSheet(),t=this.parent.activeSheetIndex;this.parent.setSheetPropertyOnMute(e,"isProtected",!e.isProtected),this.parent.setSheetPropertyOnMute(e,"password","");var r=!e.isProtected;this.parent.notify(applyProtect,{isActive:r,id:this.parent.element.id+"_protect"}),this.parent.openModule.isImportedFile&&-1===this.parent.openModule.unProtectSheetIdx.indexOf(t)&&this.parent.openModule.unProtectSheetIdx.push(t)},e.prototype.getPassWord=function(e){e.passWord=this.password},e.prototype.importProtectWorkbook=function(e){var t=this,r=this.parent.serviceLocator.getService(locale),n=this.parent.serviceLocator.getService(dialog);n.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-importprotectworkbook-dlg",header:r.getConstant("UnProtectWorkbook"),beforeOpen:function(r){var i={dialogName:"ImportProtectWorkbook",element:r.element,target:r.target,cancel:r.cancel};t.parent.trigger("dialogBeforeOpen",i),i.cancel&&(r.cancel=!0),n.dialogInstance.content=t.importProtectPasswordContent(e),n.dialogInstance.dataBind(),t.parent.element.focus()},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){t.alertMessage(),t.importOkClick(e)}}]})},e.prototype.importProtectPasswordContent=function(e){var t=this.parent.serviceLocator.getService(locale),r=this.parent.createElement("div",{className:"e-importprotectpwd-dialog"}),n=this.parent.createElement("div",{className:"e-importprotectpwd-content"}),i=this.parent.createElement("span",{className:"e-header",innerHTML:'"'+e.file.name+'" '+t.getConstant("IsProtected")}),o=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return o.setAttribute("placeholder",t.getConstant("EnterThePassword")),n.appendChild(i),n.appendChild(o),r.appendChild(n),r},e.prototype.importOkClick=function(e){var t=this.parent.element.querySelector(".e-importprotectpwd-dialog").getElementsByClassName("e-importprotectpwd-content")[0].querySelector(".e-input");this.parent.password=t.value;var r={file:e.file,password:t.value};this.parent.open(r)},e.prototype.getModuleName=function(){return"protectSheet"},e}(),FindAndReplace=function(){function e(e){this.shortValue="",this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(findDlg,this.renderFindDlg,this),this.parent.on(gotoDlg,this.renderGotoDlg,this),this.parent.on(goto,this.gotoHandler,this),this.parent.on(findHandler,this.findHandler,this),this.parent.on(replace,this.replaceHandler,this),this.parent.on(showDialog,this.showDialog,this),this.parent.on(replaceAllDialog,this.replaceAllDialog,this),this.parent.on(findKeyUp,this.findKeyUp,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(findDlg,this.renderFindDlg),this.parent.off(gotoDlg,this.renderGotoDlg),this.parent.off(goto,this.gotoHandler),this.parent.off(findHandler,this.findHandler),this.parent.off(replace,this.replaceHandler),this.parent.off(showDialog,this.showDialog),this.parent.off(replaceAllDialog,this.replaceAllDialog),this.parent.off(findKeyUp,this.findKeyUp))},e.prototype.renderFindDlg=function(){var e=this,t=this.parent.serviceLocator.getService(locale),r=this.parent.serviceLocator.getService(dialog);if(ej2Base.isNullOrUndefined(this.parent.element.querySelector(".e-find-dlg"))){var n={isModal:!1,showCloseIcon:!0,cssClass:"e-find-dlg",allowDragging:!0,header:t.getConstant("FindAndReplace"),closeOnEscape:!1,beforeOpen:function(t){var n={dialogName:"FindAndReplaceDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),r.dialogInstance.content=e.findandreplaceContent(),r.dialogInstance.dataBind(),focus(e.parent.element)},buttons:[{buttonModel:{content:t.getConstant("FindPreviousBtn"),isPrimary:!0,cssClass:"e-btn-findPrevious",disabled:!0},click:function(t){e.dialogMessage(),t&&13===t.keyCode?e.findDlgClick("next"):e.findDlgClick("prev")}},{buttonModel:{content:t.getConstant("FindNextBtn"),isPrimary:!0,cssClass:"e-btn-findNext",disabled:!0},click:function(){e.dialogMessage(),e.findDlgClick("next")}},{buttonModel:{content:t.getConstant("ReplaceBtn"),isPrimary:!0,cssClass:"e-btn-replace",disabled:!0},click:function(){e.dialogMessage(),e.findDlgClick("replace")}},{buttonModel:{content:t.getConstant("ReplaceAllBtn"),isPrimary:!0,cssClass:"e-btn-replaceAll",disabled:!0},click:function(){e.dialogMessage(),e.findDlgClick("replaceAll")}}],open:function(){if(e.parent.element.querySelector(".e-text-findNext").value){var t=e.parent.element.querySelector(".e-btn-findPrevious");ej2Base.getComponent(t,"btn").disabled=!1,ej2Base.getComponent(e.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!1}},close:function(){r.hide()}};r.show(n,!1)}else r.hide()},e.prototype.dialogMessage=function(){this.parent.element.querySelector(".e-replace-alert-span")?this.parent.element.querySelector(".e-replace-alert-span").remove():this.parent.element.querySelector(".e-find-alert-span")&&this.parent.element.querySelector(".e-find-alert-span").remove()},e.prototype.renderGotoDlg=function(){var e=this,t=this.parent.serviceLocator.getService(locale),r=this.parent.serviceLocator.getService(dialog);if(ej2Base.isNullOrUndefined(this.parent.element.querySelector(".e-find-dlg"))){var n={width:300,isModal:!1,showCloseIcon:!0,cssClass:"e-goto-dlg",allowDragging:!0,header:t.getConstant("GotoHeader"),beforeOpen:function(t){var n={dialogName:"GoToDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),r.dialogInstance.content=e.GotoContent(),r.dialogInstance.dataBind(),focus(e.parent.element)},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){e.gotoHandler()}}],close:function(){r.hide()},open:function(){e.textFocus()}};r.show(n,!1)}else r.hide()},e.prototype.textFocus=function(){var e=this;this.parent.element.querySelector(".e-text-goto").addEventListener("focus",function(){e.parent.element.querySelector(".e-goto-alert-span")&&e.parent.element.querySelector(".e-goto-alert-span").remove()})},e.prototype.findDlgClick=function(e){"prev"===e?this.findHandler({findOption:e}):"next"===e?this.findHandler({findOption:e}):this.replaceHandler({findDlgArgs:e})},e.prototype.findHandler=function(e){var t=this.parent.element.querySelector(".e-text-findNext");t||(t=this.parent.element.querySelector(".e-text-findNext-short"))||this.gotoAlert();var r=t.value;if(""!==t.value){var n=this.parent.activeSheetIndex,i=this.parent.element.querySelector(".e-findnreplace-checkcase"),o=void 0;if(i){o=ej2Base.getComponent(i,"checkbox").checked}else o=!1;var a=this.parent.element.querySelector(".e-findnreplace-checkmatch"),s=void 0;if(a){s=ej2Base.getComponent(a,"checkbox").checked}else s=!1;var l=this.parent.element.querySelector(".e-findnreplace-searchby"),d=void 0;if(l){d=ej2Base.getComponent(l,"dropdownlist").value.toString()}else d="By Row";var p=this.parent.element.querySelector(".e-findnreplace-searchwithin"),h=void 0;if(p){h=ej2Base.getComponent(p,"dropdownlist").value.toString()}else h="Sheet";var c={value:r,sheetIndex:n,findOpt:e.findOption,mode:h,isCSen:o,isEMatch:s,searchBy:d,isAction:!0};"next"===e.findOption||"prev"===e.findOption?this.parent.find(c):"count"===e.countArgs.countOpt&&(this.parent.notify(count,c),e.countArgs.findCount=c.findCount)}},e.prototype.replaceHandler=function(e){var t=this.parent.activeSheetIndex,r=this.parent.element.querySelector(".e-text-findNext"),n=this.parent.element.querySelector(".e-text-replaceInp"),i=this.parent.element.querySelector(".e-findnreplace-checkcase"),o=ej2Base.getComponent(i,"checkbox"),a=this.parent.element.querySelector(".e-findnreplace-checkmatch"),s=ej2Base.getComponent(a,"checkbox"),l=this.parent.element.querySelector(".e-findnreplace-searchby"),d=ej2Base.getComponent(l,"dropdownlist"),p=this.parent.element.querySelector(".e-findnreplace-searchwithin"),h=ej2Base.getComponent(p,"dropdownlist"),c={value:r.value,mode:h.value.toString(),isCSen:o.checked,isEMatch:s.checked,searchBy:d.value.toString(),findOpt:"next",replaceValue:n.value,replaceBy:e.findDlgArgs?e.findDlgArgs:e.replaceMode,sheetIndex:t};this.parent.replace(c)},e.prototype.gotoHandler=function(e){if(e)this.parent.goTo(e.address);else{var t=this.parent.element.querySelector(".e-text-goto").value,r=t.split("");if(""===t||isNaN(parseInt(r[1],10)))return void this.gotoAlert();var n=t.toString().toUpperCase();this.parent.goTo(n)}},e.prototype.gotoAlert=function(){var e=this.parent.serviceLocator.getService(locale),t=this.parent.createElement("span",{className:"e-goto-alert-span",innerHTML:e.getConstant("InsertingEmptyValue")});this.parent.element.querySelector(".e-goto-alert-span")&&this.parent.element.querySelector(".e-goto-alert-span").remove(),this.parent.element.querySelector(".e-goto-dlg").querySelector(".e-dlg-content").appendChild(t)},e.prototype.showDialog=function(){this.parent.element.querySelector(".e-replace-alert-span")&&this.parent.element.querySelector(".e-replace-alert-span").remove();var e=this.parent.serviceLocator.getService(locale),t=this.parent.createElement("span",{className:"e-find-alert-span",innerHTML:e.getConstant("NoElements")});this.parent.element.querySelector(".e-find-dlg")&&this.parent.element.querySelector(".e-find-dlg").querySelector(".e-dlg-content").appendChild(t)},e.prototype.replaceAllDialog=function(e){this.parent.element.querySelector(".e-find-alert-span")&&this.parent.element.querySelector(".e-find-alert-span").remove();var t=this.parent.serviceLocator.getService(locale),r=this.parent.createElement("span",{className:"e-replace-alert-span",innerHTML:e.count+t.getConstant("ReplaceAllEnd")+e.replaceValue});this.parent.element.querySelector(".e-find-dlg")&&this.parent.element.querySelector(".e-find-dlg").querySelector(".e-dlg-content").appendChild(r)},e.prototype.findKeyUp=function(e){if(e.target.classList.contains("e-text-findNext")){var t=this.parent.element.querySelector(".e-text-findNext").value;if(ej2Base.isNullOrUndefined(t)||""===t)ej2Base.getComponent(this.parent.element.querySelector(".e-btn-findPrevious"),"btn").disabled=!0,ej2Base.getComponent(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!0,this.dialogMessage();else{var r=this.parent.element.querySelector(".e-btn-findPrevious");ej2Base.getComponent(r,"btn").disabled=!1,ej2Base.getComponent(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!1}}var n=this.parent.element.querySelector(".e-text-findNext").value,i=this.parent.element.querySelector(".e-text-replaceInp").value;ej2Base.isNullOrUndefined(n)||ej2Base.isNullOrUndefined(i)||""===n||""===i?(ej2Base.getComponent(this.parent.element.querySelector(".e-btn-replace"),"btn").disabled=!0,ej2Base.getComponent(this.parent.element.querySelector(".e-btn-replaceAll"),"btn").disabled=!0):!1===this.parent.getActiveSheet().isProtected&&(ej2Base.getComponent(this.parent.element.querySelector(".e-btn-replace"),"btn").disabled=!1,ej2Base.getComponent(this.parent.element.querySelector(".e-btn-replaceAll"),"btn").disabled=!1)},e.prototype.findandreplaceContent=function(){this.parent.element.querySelector(".e-text-findNext-short")&&(this.shortValue=this.parent.element.querySelector(".e-text-findNext-short").value);var e=this.parent.createElement("div",{className:"e-link-dialog"}),t=this.parent.createElement("div",{className:"e-find"}),r=this.parent.createElement("div",{className:"e-findCheck"}),n=this.parent.serviceLocator.getService(locale);e.appendChild(t);var i=this.parent.createElement("div",{className:"e-cont"}),o=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("FindWhat")}),a=this.parent.createElement("input",{className:"e-input e-text-findNext",attrs:{type:"Text",placeholder:n.getConstant("FindValue"),value:this.shortValue}});i.appendChild(a),i.insertBefore(o,a),t.appendChild(i);var s=new ej2Inputs.TextBox({width:"70%"});s.createElement=this.parent.createElement,s.appendTo(a);var l=this.parent.createElement("div",{className:"e-cont"}),d=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("ReplaceWith")}),p=this.parent.createElement("input",{className:"e-input e-text-replaceInp",attrs:{type:"Text",placeholder:n.getConstant("ReplaceValue")}});l.appendChild(p),l.insertBefore(d,p),t.appendChild(l);var h=new ej2Inputs.TextBox({width:"70%"});h.createElement=this.parent.createElement,h.appendTo(p);var c=[{Id:"Sheet",Within:n.getConstant("Sheet")},{Id:"Workbook",Within:n.getConstant("Workbook")}],u=new ej2Dropdowns.DropDownList({dataSource:c,cssClass:"e-searchby",fields:{value:"Id",text:"Within"},width:"50%",index:0}),g=this.parent.createElement("input",{className:"e-findnreplace-searchwithin",attrs:{type:"select",label:n.getConstant("SearchBy")}}),f=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("SearchWithin")});t.appendChild(f),t.appendChild(g),u.createElement=this.parent.createElement,u.appendTo(g);var m=[{Id:"By Row",Search:n.getConstant("ByRow")},{Id:"By Column",Search:n.getConstant("ByColumn")}],v=new ej2Dropdowns.DropDownList({dataSource:m,cssClass:"e-searchby",fields:{value:"Id",text:"Search"},width:"50%",index:0}),C=this.parent.createElement("input",{className:"e-findnreplace-searchby",attrs:{type:"select",label:n.getConstant("SearchBy")}}),y=this.parent.createElement("p",{className:"e-header",innerHTML:n.getConstant("SearchBy")});t.appendChild(y),t.appendChild(C),v.createElement=this.parent.createElement,v.appendTo(C);var x=new ej2Buttons.CheckBox({label:n.getConstant("MatchCase"),checked:!1,cssClass:"e-findnreplace-casecheckbox"}),b=this.parent.createElement("input",{className:"e-findnreplace-checkcase",attrs:{type:"checkbox"}});r.appendChild(b),x.createElement=this.parent.createElement,x.appendTo(b);var S=new ej2Buttons.CheckBox({label:n.getConstant("MatchExactCellElements"),checked:!1,cssClass:"e-findnreplace-exactmatchcheckbox"}),w=this.parent.createElement("input",{className:"e-findnreplace-checkmatch",attrs:{type:"checkbox"}});return r.appendChild(w),S.createElement=this.parent.createElement,S.appendTo(w),t.appendChild(r),e},e.prototype.GotoContent=function(){var e=this.parent.serviceLocator.getService(locale),t=this.parent.createElement("div",{className:"e-link-dialog"}),r=this.parent.createElement("div",{className:"e-goto"});t.appendChild(r);var n=this.parent.createElement("div",{className:"e-cont"}),i=this.parent.createElement("p",{className:"e-header",innerHTML:e.getConstant("Reference")}),o=new ej2Inputs.TextBox({placeholder:e.getConstant("EntercellAddress")}),a=this.parent.createElement("input",{className:"e-text-goto",attrs:{type:"Text"}});return n.appendChild(a),n.insertBefore(i,a),r.appendChild(n),o.createElement=this.parent.createElement,o.appendTo(a),t},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"findAndReplace"},e}(),Merge=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.merge=function(e){var t=this;e.showDialog?this.parent.serviceLocator.getService(dialog).show({target:this.parent.element,height:180,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(locale).getConstant("PasteMergeAlert"),beforeOpen:function(e){var r={dialogName:"MergeDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0),focus(t.parent.element)}}):this.parent.serviceLocator.getService("cell").refresh(e.rowIdx,e.colIdx,e.lastCell,e.element)},e.prototype.hideHandler=function(e){var t=this.parent.getActiveSheet(),r={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify(activeCellMergedRange,r),r.range=r.range;var n=getCell(r.range[0],r.range[1],t)||{},i="row"===e.model?r.range[0]:r.range[1],o=i+((n[e.model+"Span"]||1)-1);if(!(!e.isEnd&&(e.start===i||isHiddenCol(t,i))||e.isEnd&&e.start>i&&!isHiddenCol(t,i))&&n[e.model+"Span"]>1&&o>=e.start)if("row"===e.model?isHiddenRow(t,i):isHiddenCol(t,i)){if(e.end<o&&(o-e.end>1||n.rowSpan>1)){var a=this.parent.getCell(e.rowIdx,e.end+1);if(a&&(o-e.end>1&&(a.colSpan=o-e.end),a.style.display=""),n.rowSpan>1){var s=n.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(n.rowSpan-1));s>1&&(a.rowSpan=s)}}}else this.merge({rowIdx:r.range[0],colIdx:r.range[1]})},e.prototype.checkPrevMerge=function(e){var t,r,n,i=this.parent.getActiveSheet();e.isRow?e.rowIdx-1>-1&&isHiddenRow(i,e.rowIdx-1)&&(void 0===(t=getCell(e.rowIdx-1,e.colIdx,i)||{}).rowSpan&&void 0===t.colSpan||!(void 0===t.colSpan||t.colSpan>1||e.colIdx-1>-1&&isHiddenCol(i,e.colIdx-1))||(r={range:[e.rowIdx-1,e.colIdx,e.rowIdx-1,e.colIdx]},this.parent.notify(activeCellMergedRange,r),r.range=r.range,isHiddenRow(i,r.range[0])&&r.range[2]>=e.rowIdx&&(t=getCell(r.range[0],r.range[1],i)||{}).rowSpan>1&&((n=r.range[2]-e.rowIdx+1-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(r.range[2]-e.rowIdx)))>1&&(e.td.rowSpan=n,e.td.style.display=""),t.colSpan>1&&!(e.colIdx-1>-1&&isHiddenCol(i,e.colIdx-1))&&(n=t.colSpan-this.parent.hiddenCount(e.colIdx,e.colIdx+(t.colSpan-1),"columns"))>1&&(e.td.colSpan=n,e.td.style.display="")))):e.colIdx-1>-1&&isHiddenCol(i,e.colIdx-1)&&(void 0===(t=getCell(e.rowIdx,e.colIdx-1,i)||{}).colSpan&&void 0===t.rowSpan||!(void 0===t.rowSpan||t.rowSpan>1||e.rowIdx-1>-1&&isHiddenRow(i,e.rowIdx-1))||(r={range:[e.rowIdx,e.colIdx-1,e.rowIdx,e.colIdx-1]},this.parent.notify(activeCellMergedRange,r),r.range=r.range,isHiddenCol(i,r.range[1])&&r.range[3]>=e.colIdx&&(t=getCell(r.range[0],r.range[1],i)||{}).colSpan>1&&((n=r.range[3]-e.colIdx+1-this.parent.hiddenCount(e.colIdx,e.colIdx+(t.colSpan-1),"columns"))>1&&(e.td.colSpan=n,e.td.style.display=""),t.rowSpan>1&&!(e.rowIdx-1>-1&&isHiddenRow(i,e.rowIdx-1))&&(n=t.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(t.rowSpan-1)))>1&&(e.td.rowSpan=n,e.td.style.display=""))))},e.prototype.checkMerge=function(e){var t=this.parent.getActiveSheet(),r=getCell(e.rowIdx,e.colIdx,t)||{};if(e.isRow){if(void 0===r.colSpan||isHiddenCol(t,e.colIdx-1)){if((n={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]}).range=n.range,this.parent.notify(activeCellMergedRange,n),isHiddenCol(t,e.colIdx-1)&&!isHiddenCol(t,n.range[1])||e.isFreezePane&&n.range[0]<this.parent.frozenRowCount(t))return void(e.insideFreezePane=n.range[0]<this.parent.frozenRowCount(t));r=getCell(n.range[0],n.range[1],t);(i=n.range[2]-e.rowIdx+1-this.parent.hiddenCount(e.rowIdx,n.range[2]))>1&&(this.merge({rowIdx:n.range[0],colIdx:n.range[1],element:e.td}),e.td.rowSpan=i,e.td.style.display="")}}else if(void 0===r.rowSpan||isHiddenRow(t,e.rowIdx-1)){var n;if((n={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]}).range=n.range,this.parent.notify(activeCellMergedRange,n),isHiddenRow(t,e.rowIdx-1)&&!isHiddenRow(t,n.range[0])||e.isFreezePane&&n.range[1]<this.parent.frozenColCount(t))return void(e.insideFreezePane=n.range[1]<this.parent.frozenColCount(t));r=getCell(n.range[0],n.range[1],t);var i;(i=n.range[3]-e.colIdx+1-this.parent.hiddenCount(e.colIdx,n.range[3],"columns"))>1&&(this.merge({rowIdx:n.range[0],colIdx:n.range[1],element:e.td}),e.td.colSpan=i,e.td.style.display="")}},e.prototype.addEventListener=function(){this.parent.on(applyMerge,this.merge,this),this.parent.on(hiddenMerge,this.hideHandler,this),this.parent.on(checkPrevMerge,this.checkPrevMerge,this),this.parent.on(checkMerge,this.checkMerge,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(applyMerge,this.merge),this.parent.off(hiddenMerge,this.hideHandler),this.parent.off(checkPrevMerge,this.checkPrevMerge),this.parent.off(checkMerge,this.checkMerge))},e.prototype.getModuleName=function(){return"merge"},e}(),ConditionalFormatting=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener()},e.prototype.addEventListener=function(){this.parent.on(cFRender,this.cFInitialRender,this),this.parent.on(cFInitialCheck,this.cFInitialCheckHandler,this),this.parent.on(checkConditionalFormat,this.checkConditionalFormatHandler,this),this.parent.on(initiateConditionalFormat,this.initiateCFHandler,this),this.parent.on(setCF,this.setCFHandler,this),this.parent.on(clearCF,this.clearCFHandler,this),this.parent.on(clearCells,this.addClearCFHandler,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(cFRender,this.cFInitialRender),this.parent.off(cFInitialCheck,this.cFInitialCheckHandler),this.parent.off(checkConditionalFormat,this.checkConditionalFormatHandler),this.parent.off(initiateConditionalFormat,this.initiateCFHandler),this.parent.off(setCF,this.setCFHandler),this.parent.off(clearCF,this.clearCFHandler))},e.prototype.setCF=function(e){e.range=e.range||this.parent.getActiveSheet().selectedRange;var t={range:e.range,type:e.type,cFColor:e.cFColor,value:e.value,sheetIdx:this.parent.activeSheetIndex,cancel:!1};this.parent.notify(beginAction,{eventArgs:t,action:"conditionalFormat"}),t.cancel||(e.type=t.type,e.cFColor=t.cFColor,e.value=t.value,e.range=t.range,this.parent.notify(setCFRule,{conditionalFormat:e,isAction:!0}),delete t.cancel,this.parent.notify(completeAction,{eventArgs:t,action:"conditionalFormat"}))},e.prototype.addClearCFHandler=function(e){for(var t=this.parent.getActiveSheet(),r=e.conditionalFormats,n=e.oldRange,i=e.selectedRange,o=t.conditionalFormats,a=r.length-1;a>=0;a--){for(var s=!1,l=0;l<o.length;l++)if(o[l].type===r[a].type&&o[l].range===r[a].range){s=!0,o[l].range=n[a],t.conditionalFormats[l].range=n[a];for(var d=getRangeIndexes(i),p=n[a].split(","),h=0;h<p.length;h++)for(var c=getRangeIndexes(p[h]),u=c[0];u<=c[2];u++)for(var g=c[1];g<=c[3];g++)for(var f=d[0];f<=d[2];f++)for(var m=d[1];m<=d[3];m++)if(f===u&&m===g){var v=this.parent.getCell(u,g),C=t.rows[u]&&t.rows[u].cells[g]?t.rows[u].cells[g]:null;C&&this.cFInitialCheckHandler({rowIdx:u,colIdx:g,cell:C,td:v,conditionalFormat:o[l]})}}if(!s){var y=r[a];y.range=n[a],this.parent.notify(setCFRule,{conditionalFormat:y})}}},e.prototype.clearCFHandler=function(e){var t=this.parent.getActiveSheet(),r=this.parent.getCell(e.rIdx,e.cIdx),n=getCell(e.rIdx,e.cIdx,t);if(r){if(r.classList.remove("e-redft"),r.classList.remove("e-yellowft"),r.classList.remove("e-greenft"),r.classList.remove("e-redf"),r.classList.remove("e-redt"),r.classList.remove("e-iconset"),r.style){if(r.style.backgroundColor){r.style.backgroundColor="";var i=this.parent.getCellStyleValue(["backgroundColor"],[e.rIdx,e.cIdx]);this.parent.notify(applyCellFormat,{style:i,rowIdx:e.rIdx,colIdx:e.cIdx})}if(r.style.color){r.style.color="";i=this.parent.getCellStyleValue(["color"],[e.rIdx,e.cIdx]);this.parent.notify(applyCellFormat,{style:i,rowIdx:e.rIdx,colIdx:e.cIdx})}}r.querySelector(".e-cf-databar")&&(r.removeChild(r.querySelector(".e-cf-databar")),r.textContent=this.parent.getDisplayText(n)),r.querySelector(".e-iconsetspan")&&(r.removeChild(r.querySelector(".e-iconsetspan")),r.textContent=this.parent.getDisplayText(n))}},e.prototype.setCFHandler=function(e){"cf_databars"===e.action?this.setCF({type:e.id}):"cf_colorscales"===e.action?this.setCF({type:e.id}):"cf_iconsets"===e.action&&this.setCF({type:e.id})},e.prototype.initiateCFHandler=function(e){var t=this,r=this.parent.serviceLocator.getService(locale),n=this.parent.serviceLocator.getService(dialog);n.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-conditionalformatting-dlg",header:e.action.replace("...",""),target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(){n.dialogInstance.content=t.cFDlgContent(e.action),n.dialogInstance.dataBind(),focus(t.parent.element)},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn e-clearall-btn e-flat"},click:function(){n.dialogInstance.element.getElementsByClassName("e-clearall-btn")[0].disabled||(t.dlgClickHandler(e.action),n.hide())}}]}),n.dialogInstance.refresh()},e.prototype.dlgClickHandler=function(e){var t="",r="",n=this.parent.element.querySelector(".e-conditionalformatting-dlg").getElementsByClassName("e-dlg-content")[0].querySelector(".e-cf-dlg"),i=n.querySelector(".e-cfmain");if(i){var o=i.getElementsByTagName("input")[0];o&&o.parentElement.classList.contains("e-cfmain")&&(t=i.getElementsByTagName("input")[0].value),r=i.getElementsByTagName("input")[1]?n.querySelector(".e-cfmain").getElementsByTagName("input")[1].value:"";var a=ej2Base.getNumberDependable(this.parent.locale,"");t=t.split(a).join("").split(",").join(""),r=r.split(a).join("").split(",").join("")}var s=this.getCFColor(n.querySelector(".e-cfsub").getElementsByTagName("input")[0].value),l="Duplicate Values..."===e?n.querySelector(".e-cfmain").getElementsByTagName("input")[0].value:this.getType(e);""!==t&&""!==r?this.setCF({type:l,cFColor:s,value:t+","+r}):""!==t?this.setCF({type:l,cFColor:s,value:t}):this.setCF({type:l,cFColor:s,value:r})},e.prototype.getType=function(e){var t=this.parent.serviceLocator.getService(locale),r="";switch(e){case t.getConstant("GreaterThan")+"...":r="GreaterThan";break;case t.getConstant("LessThan")+"...":r="LessThan";break;case t.getConstant("Between")+"...":r="Between";break;case t.getConstant("CFEqualTo")+"...":r="EqualTo";break;case t.getConstant("TextThatContains")+"...":r="ContainsText";break;case t.getConstant("ADateOccuring")+"...":r="DateOccur";break;case t.getConstant("Top10Items")+"...":r="Top10Items";break;case t.getConstant("Bottom10Items")+"...":r="Bottom10Items";break;case t.getConstant("Top10")+" %...":r="Top10Percentage";break;case t.getConstant("Bottom10")+" %...":r="Bottom10Percentage";break;case t.getConstant("AboveAverage")+"...":r="AboveAverage";break;case t.getConstant("BelowAverage")+"...":r="BelowAverage"}return r},e.prototype.getCFColor=function(e){var t=this.parent.serviceLocator.getService(locale),r="RedFT";switch(e){case t.getConstant("LightRedFillWithDarkRedText"):r="RedFT";break;case t.getConstant("YellowFillWithDarkYellowText"):r="YellowFT";break;case t.getConstant("GreenFillWithDarkGreenText"):r="GreenFT";break;case t.getConstant("RedFill"):r="RedF";break;case t.getConstant("RedText"):r="RedT"}return r},e.prototype.cFDlgContent=function(e){var t=this.getDlgText(e),r=this.parent.serviceLocator.getService(locale),n=this.parent.createElement("div",{className:"e-cf-dlg"}),i=this.parent.createElement("div",{className:"e-cfmain"}),o=this.parent.createElement("div",{className:"e-cfsub"}),a=this.parent.createElement("span",{className:"e-header e-top-header",innerHTML:t}),s=this.parent.createElement("input",{className:"e-input",id:"valueInput",attrs:{type:"text"}}),l=this.parent.createElement("input",{className:"e-select"}),d=this.parent.createElement("span",{className:"e-header",innerHTML:r.getConstant("With")}),p=this.parent.createElement("input",{className:"e-select"});n.appendChild(i),n.appendChild(o),i.appendChild(a);var h;if(e!==r.getConstant("DuplicateValues")+"..."){if(e!==r.getConstant("AboveAverage")+"..."&&e!==r.getConstant("BelowAverage")+"..."){i.appendChild(s),h=!0;var c=e===r.getConstant("Top10")+" %..."||e===r.getConstant("Bottom10")+" %...";if(e===r.getConstant("Top10Items")+"..."||e===r.getConstant("Bottom10Items")+"..."||c){s.maxLength=c?3:4;new ej2Inputs.NumericTextBox({value:10,min:1,max:c?100:1e3,format:"###"}).appendTo(s)}}}else{i.appendChild(l);var u=[{text:r.getConstant("Duplicate"),id:"duplicate"},{text:r.getConstant("Unique"),id:"unique"}];new ej2Dropdowns.DropDownList({dataSource:u,index:0,popupHeight:"200px"}).appendTo(l)}if(e===r.getConstant("Between")+"..."){var g=this.parent.createElement("span",{className:"e-header e-header-2",innerHTML:r.getConstant("And")}),f=this.parent.createElement("input",{className:"e-input e-between"});i.appendChild(g),i.appendChild(f),f.addEventListener("input",this.validateCfInput.bind(this))}h&&(this.validateCfInput({target:s}),s.addEventListener("input",this.validateCfInput.bind(this))),o.appendChild(d),o.appendChild(p);var m=[{text:r.getConstant("LightRedFillWithDarkRedText"),value:"redft",id:"redft"},{text:r.getConstant("YellowFillWithDarkYellowText"),id:"yellowft"},{text:r.getConstant("GreenFillWithDarkGreenText"),id:"greenft"},{text:r.getConstant("RedFill"),id:"redf"},{text:r.getConstant("RedText"),id:"redt"}];return new ej2Dropdowns.DropDownList({dataSource:m,index:0,popupHeight:"200px"}).appendTo(p),n},e.prototype.validateCfInput=function(e){var t=this.parent.serviceLocator.getService(dialog),r=e.target.value,n=t.dialogInstance.element.getElementsByClassName("e-clearall-btn")[0];r&&(e.target.classList.contains("e-between")||e.target.parentElement.querySelector(".e-between"))&&(r=e.target.parentElement.querySelector(e.target.classList.contains("e-between")?".e-input":".e-between").value),n.disabled=!r.trim()},e.prototype.checkCellHandler=function(e,t,r){for(var n=!1,i=r.range.trim().split(","),o=0;o<i.length;o++){var a=i[o],s=getRangeIndexes(a=a.indexOf(":")>-1?a:a+":"+a);if(e>=s[0]&&e<=s[2]&&t>=s[1]&&t<=s[3]){n=!0;break}}return n},e.prototype.getDlgText=function(e){var t=this.parent.serviceLocator.getService(locale),r="";switch(e){case t.getConstant("GreaterThan")+"...":r=t.getConstant("FormatCellsGreaterThan");break;case t.getConstant("LessThan")+"...":r=t.getConstant("FormatCellsLessThan");break;case t.getConstant("Between")+"...":r=t.getConstant("FormatCellsBetween");break;case t.getConstant("CFEqualTo")+"...":r=t.getConstant("FormatCellsEqualTo");break;case t.getConstant("TextThatContains")+"...":r=t.getConstant("FormatCellsThatContainTheText");break;case t.getConstant("ADateOccuring")+"...":r=t.getConstant("FormatCellsThatContainADateOccurring");break;case t.getConstant("DuplicateValues")+"...":r=t.getConstant("FormatCellsDuplicate");break;case t.getConstant("Top10Items")+"...":case t.getConstant("Top10")+" %...":r=t.getConstant("FormatCellsTop");break;case t.getConstant("Bottom10Items")+"...":case t.getConstant("Bottom10")+" %...":r=t.getConstant("FormatCellsBottom");break;case t.getConstant("AboveAverage")+"...":r=t.getConstant("FormatCellsAbove");break;case t.getConstant("BelowAverage")+"...":r=t.getConstant("FormatCellsBelow")}return r},e.prototype.cFInitialRender=function(e){var t=this.parent.getActiveSheet().conditionalFormats;if(t)for(var r=0;r<t.length;r++){this.checkCellHandler(e.rowIdx,e.colIdx,t[r])&&this.cFInitialCheckHandler({rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.cell,td:e.td,conditionalFormat:t[r]})}},e.prototype.triggetConditionalFormatEvent=function(e,t){t&&(e.conditionalFormat.value||"AboveAverage"===e.conditionalFormat.type||"BelowAverage"===e.conditionalFormat.type||"Duplicate"===e.conditionalFormat.type)&&this.parent.trigger("beforeConditionalFormat",e)},e.prototype.cFInitialCheckHandler=function(e){var t,r=!1,n=["e-redft","e-yellowft","e-greenft","e-redf","e-redt"],i=e.cell.value||"",o=e.td||this.parent.getCell(e.rowIdx,e.colIdx);if(o){var a=e.conditionalFormat;if(a.type=a.type||"GreaterThan",a.cFColor=a.cFColor?a.cFColor:a.format?a.cFColor:"RedFT",r=this.cFRCheck(a,i,o,e.rowIdx,e.colIdx,!0),this.triggetConditionalFormatEvent({conditionalFormat:a,cell:e.cell,element:o,address:getCellAddress(e.rowIdx,e.colIdx),apply:r},e.isAction),r){for(var s=0;s<n.length;s++)if(o.classList.contains(n[s])){o.classList.remove(n[s]);break}a.format&&a.format.style&&(t=a.format.style);var l={};a.cFColor?(o.classList.add("e-"+a.cFColor.toLowerCase()),l=this.setFormat(l,a)):l=t,l.backgroundColor&&o.style.setProperty("background-color",l.backgroundColor),l.color&&o.style.setProperty("color",l.color),l.fontWeight&&o.style.setProperty("font-weight",l.fontWeight),l.fontStyle&&o.style.setProperty("font-style",l.fontStyle),l.textDecoration&&o.style.setProperty("text-decoration",l.textDecoration)}}},e.prototype.checkConditionalFormatHandler=function(e){if(!e.preventIfSheetNotRendered||ej2Base.closest(this.parent.getMainContent(),".e-sheet")){var t,r=!1,n=!1,i=this.parent.getActiveSheet(),o=e.cell,a=e.td||this.parent.getCell(e.rowIdx,e.colIdx),s=i.conditionalFormats,l=o?ej2Base.isNullOrUndefined(o.value)?"":o.value:"",d=["e-redft","e-yellowft","e-greenft","e-redf","e-redt"];if(s&&!(s.length<1))for(var p=s.length-1;p>=0;p--){for(var h=s[p].range.trim().split(","),c=0;c<h.length;c++){if(g=(g=h[c]).indexOf(":")>-1?g:g+":"+g,t=getRangeIndexes(g),e.rowIdx>=t[0]&&e.colIdx>=t[1]&&e.rowIdx<=t[2]&&e.colIdx<=t[3]){n=!0;break}}if(n){if("GreaterThanLessThanEqualToBetweenContainsTextDateOccur".includes(i.conditionalFormats[p].type)){var u=getCell(e.rowIdx,e.colIdx,i)&&getCell(e.rowIdx,e.colIdx,i).value?getCell(e.rowIdx,e.colIdx,i).value:"";r=(!ej2Base.isNullOrUndefined(u)||""!==u)&&this.cFRCheck(i.conditionalFormats[p],u,a),this.setColor(a,e.rowIdx,e.colIdx,p,r,e.isAction)}else if("Top10ItemsBottom10ItemsTop10%Bottom10%AboveAverageBelowAverageDuplicateUnique".includes(i.conditionalFormats[p].type))for(c=0;c<h.length;c++)for(var g,f=(t=getRangeIndexes(g=(g=h[c]).indexOf(":")>-1?g:g+":"+g))[0];f<=t[2];f++){i.rows[f]||setRow(i,f,{});for(var m=t[1];m<=t[3];m++){i.rows[f].cells&&i.rows[f].cells[m]||setCell(f,m,i,{});u=getCell(f,m,i)&&getCell(f,m,i).value?getCell(f,m,i).value:"";r=this.cFRCheck(i.conditionalFormats[p],u,a,f,m,!1),a=this.parent.getCell(f,m),this.setColor(a,f,m,p,r,e.isAction)}}else if("BlueDataBarGreenDataBarRedDataBarOrangeDataBarLightBlueDataBarPurpleColorScaleGYRColorScaleRYGColorScaleGWRColorScaleRWGColorScaleBWRColorScaleRWBColorScaleWRColorScaleRWColorScaleGWColorScaleWGColorScaleGYColorScaleYGColorScaleThreeArrowsThreeArrowsGrayFourArrowsGrayFourArrowsFiveArrowsGrayFiveArrowsThreeTrafficLights1ThreeTrafficLights2ThreeSignsFourTrafficLightsFourRedToBlackThreeSymbolsThreeSymbols2ThreeFlagsFourRatingFiveQuartersFiveRatingThreeTrianglesThreeStarsFiveBoxes".includes(i.conditionalFormats[p].type)){for(var v=0;v<d.length;v++)a.classList.contains(d[v])&&a.classList.remove(d[v]);r=this.cFRCheck(i.conditionalFormats[p],l,a,e.rowIdx,e.colIdx,!1)}n=!1}if(r)break}}},e.prototype.setColor=function(e,t,r,n,i,o){var a=this.parent.getActiveSheet(),s=a.conditionalFormats;this.triggetConditionalFormatEvent({conditionalFormat:s[n],cell:getCell(t,r,a),element:e,address:getCellAddress(t,r),apply:i},o);var l=["e-redft","e-yellowft","e-greenft","e-redf","e-redt"],d=!1;if(s[n].cFColor)e&&e.classList.contains("e-"+s[n].cFColor.toLowerCase())&&(d=!0);else if(s[n].format.style.backgroundColor&&e.style.backgroundColor){var p=this.hexToRgb(s[n].format.style.backgroundColor);"rgb("+p.r+", "+p.g+", "+p.b+")"===e.style.backgroundColor&&(d=!0)}if(i){if(d)for(var h=0;h<l.length;h++)if(e.classList.contains(l[h])){e.classList.remove(l[h]);break}var c={};s[n].cFColor?(e&&e.classList.add("e-"+s[n].cFColor.toLowerCase()),c=this.setFormat(c,s[n])):c=s[n].format.style,this.parent.notify(applyCellFormat,{style:c,rowIdx:t,colIdx:r,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0})}else{if(d){for(h=0;h<l.length;h++)if(e.classList.contains(l[h])){e.classList.remove(l[h]);break}e.removeAttribute("style")}var u=getCell(t,r,this.parent.getActiveSheet(),null,!0);c=ej2Base.extend({},this.parent.commonCellStyle,u.style);this.parent.notify(applyCellFormat,{style:c,rowIdx:t,colIdx:r})}},e.prototype.hexToRgb=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},e.prototype.cFRCheck=function(e,t,r,n,i,o){var a="",s="",l=t.toString();if(e.value){var d=e.value.split(",").filter(function(e){return!!e.trim()});if(d.length>1)if(d[0].split("(").length>1){for(var p="",h=0;h<d.length;h++)(p+=d[h]+",").split("(").length===p.split(")").length&&""===a&&(a=p.substring(0,p.length-1),p="");s=p.substring(0,p.length-1)}else{a=d[0];for(h=1;h<d.length;h++)s+=h+1===d.length?d[h]:d[h]+","}else a=1===d.length?d[0]:e.value}var c=!1,u=e.type;"BlueDataBarGreenDataBarRedDataBarOrangeDataBarLightBlueDataBarPurpleDataBar".includes(u)&&(u="DataBar"),"GYRColorScaleRYGColorScaleGWRColorScaleRWGColorScaleBWRColorScaleRWBColorScaleWRColorScaleRWColorScaleGWColorScaleWGColorScaleGYColorScaleYGColorScale".includes(u)&&(u="ColorScale"),"ThreeArrowsThreeArrowsGrayFourArrowsGrayFourArrowsFiveArrowsGrayFiveArrowsThreeTrafficLights1ThreeTrafficLights2ThreeSignsFourTrafficLightsFourRedToBlackThreeSymbolsThreeSymbols2ThreeFlagsFourRatingFiveQuartersFiveRatingThreeTrianglesThreeStarsFiveBoxes".includes(u)&&(u="IconSet");var g={};switch(u){case"GreaterThan":c=this.isGreaterThanLessThan(e,l,a,!0);break;case"LessThan":c=this.isGreaterThanLessThan(e,l,a,!1);break;case"Between":c=this.isBetWeen(e,l,a,s);break;case"EqualTo":c=this.isEqualTo(e,l,a);break;case"ContainsText":c=this.isContainsText(l,a);break;case"DateOccur":g={value:a,rowIndex:0,colIndex:0,sheetIndex:0,updatedVal:""},this.parent.notify(checkDateFormat,g),l===g.updatedVal&&(c=!0);break;case"Unique":case"Duplicate":c=this.isDuplicateUnique(l,e);break;case"Top10Items":c=this.isTopBottomTenValue(l,a,e,!0);break;case"Bottom10Items":c=this.isTopBottomTenValue(l,a,e,!1);break;case"Top10Percentage":c=this.isTopBottomTenPercentage(l,a,e,!0);break;case"Bottom10Percentage":c=this.isTopBottomTenPercentage(l,a,e,!1);break;case"AboveAverage":c=this.isAboveBelowAverage(l,a,e,!0);break;case"BelowAverage":c=this.isAboveBelowAverage(l,a,e,!1);break;case"DataBar":case"ColorScale":case"IconSet":this.isDataBarColorScalesIconSets(u,l,e,r,n,i,o)}return c},e.prototype.isDataBarColorScalesIconSets=function(e,t,r,n,i,o,a){var s=this.parent.getActiveSheet();if(a)"DataBar"===e?this.applyDataBars(t,r,n,i,o):"ColorScale"===e?this.applyColorScale(t,r,n,i,o):this.applyIconSet(t,r,n,i,o);else{n=null;for(var l=r.range.split(","),d=0;d<l.length;d++)for(var p=getRangeIndexes(l[d]),h=p[0];h<=p[2];h++)for(var c=p[1];c<=p[3];c++)if(getCell(h,c,s)){var u=getCell(h,c,s).value;n=this.parent.getCell(h,c),"DataBar"===e?this.applyDataBars(u,r,n,h,c):"ColorScale"===e?this.applyColorScale(u,r,n,h,c):this.applyIconSet(u,r,n,h,c)}}},e.prototype.applyIconSet=function(e,t,r,n,i){var o=parseInt(e,10),a=this.getIconList(t.type).split(","),s=[],l=this.parent.getActiveSheet(),d=l.rows[n]&&l.rows[n].cells[i]?l.rows[n].cells[i]:null;if(d){for(var p=r||this.parent.getMainContent().getElementsByClassName("e-row")[n].getElementsByClassName("e-cell")[i],h=t.range.split(","),c=0;c<h.length;c++){var u=getRangeIndexes(h[c]);s=this.getNumericArray(u,s)}var g,f=(s=s.sort(function(e,t){return e-t}))[0],m=s[s.length-1];if(3===a.length){var v=f+.33*(m-f);g="e-"+(o>=f+.67*(m-f)?a[0].trim():o>=v?a[1].trim():a[2].trim())}else if(4===a.length){var C=f+.25*(m-f),y=f+.5*(m-f);g="e-"+(o>=(x=f+.75*(m-f))?a[0].trim():o>=y?a[1].trim():o>=C?a[2].trim():a[3].trim())}else if(5===a.length){C=f+.2*(m-f),y=f+.4*(m-f);var x=f+.6*(m-f);g="e-"+(o>=f+.8*(m-f)?a[0].trim():o>=x?a[1].trim():o>=y?a[2].trim():o>=C?a[3].trim():a[4].trim())}if(!ej2Base.isNullOrUndefined(d)){var b=this.parent.createElement("span",{className:"e-icon"});b.classList.add("e-iconsetspan"),b.classList.add(g),this.applyIconSetIcon({rowIndex:n,colIndex:i},b,p)}}},e.prototype.applyIconSetIcon=function(e,t,r){var n=this.parent.getActiveSheet(),i=getCell(e.rowIndex,e.colIndex,n).value,o=r;o.classList.contains("e-iconset")&&o.querySelector(".e-iconsetspan")&&o.removeChild(o.querySelector(".e-iconsetspan")),isNumber(i)&&(o.insertBefore(t,o.childNodes[0]),o.classList.add("e-iconset"))},e.prototype.getIconList=function(e){switch(e){case"ThreeArrows":return"3arrows-1,3arrows-2,3arrows-3";case"ThreeArrowsGray":return"3arrowsgray-1,3arrowsgray-2,3arrowsgray-3";case"FourArrowsGray":return"4arrowsgray-1,4arrowsgray-2,4arrowsgray-3,4arrowsgray-4";case"FourArrows":return"4arrows-1,4arrows-2,4arrows-3,4arrows-4";case"FiveArrowsGray":return"5arrowsgray-1,5arrowsgray-2,5arrowsgray-3,5arrowsgray-4,5arrowsgray-5";case"FiveArrows":return"5arrows-1,5arrows-2,5arrows-3,5arrows-4,5arrows-5";case"ThreeTrafficLights1":return"3trafficlights-1,3trafficlights-2,3trafficlights-3";case"ThreeTrafficLights2":return"3rafficlights2-1,3rafficlights2-2,3rafficlights2-3";case"ThreeSigns":return"3signs-1,3signs-2,3signs-3";case"FourTrafficLights":return"4trafficlights-1,4trafficlights-2,4trafficlights-3,4trafficlights-4";case"FourRedToBlack":return"4redtoblack-1,4redtoblack-2,4redtoblack-3,4redtoblack-4";case"ThreeSymbols":return"3symbols-1,3symbols-2,3symbols-3";case"ThreeSymbols2":return"3symbols2-1,3symbols2-2,3symbols2-3";case"ThreeFlags":return"3flags-1,3flags-2,3flags-3";case"FourRating":return"4rating-1,4rating-2,4rating-3,4rating-4";case"FiveQuarters":return"5quarters-1,5quarters-2,5quarters-3,5quarters-4,5quarters-5";case"FiveRating":return"5rating-1,5rating-2,5rating-3,5rating-4,5rating-5";case"ThreeTriangles":return"3triangles-1,3triangles-2,3triangles-3";case"ThreeStars":return"3stars-1,3stars-2,3stars-3";case"FiveBoxes":return"5boxes-1,5boxes-2,5boxes-3,5boxes-4,5boxes-5"}return"3arrows-1,3arrows-2,3arrows-3"},e.prototype.applyColorScale=function(e,t,r,n,i){var o,a=this.parent.getActiveSheet(),s=parseInt(e,10),l=[],d=this.getColor(t.type),p=a.rows[n]&&a.rows[n].cells[i]?a.rows[n].cells[i]:null;if(p){for(var h=t.range.split(","),c=r||this.parent.getMainContent().getElementsByClassName("e-row")[n].getElementsByClassName("e-cell")[i],u=0;u<h.length;u++){var g=getRangeIndexes(h[u]);l=this.getNumericArray(g,l)}l=l.sort(function(e,t){return e-t}).reverse();for(var f=0;f<l.length;f++)if(l[f]===s){o=f;break}var m=0===o?d[0]:o===l.length-1?d[d.length-1]:3===l.length&&1===o?d[1]:this.getGradient(o,d[0],d[1],d[2],l.length);if(!ej2Base.isNullOrUndefined(p)){var v={};ej2Base.isNullOrUndefined(o)?(v=this.parent.getCellStyleValue(["backgroundColor"],[n,i]),c.style.backgroundColor=v.backgroundColor):(v={backgroundColor:m},c.style.backgroundColor=m)}}},e.prototype.applyDataBars=function(e,t,r,n,i){var o=this.parent.getActiveSheet(),a={},s={},l="",d="",p=t.type,h=o.rows[n].cells&&o.rows[n].cells[i]?o.rows[n].cells[i]:null;if(h){for(var c,u=[],g=this.parent.getMainContent().getElementsByClassName("e-row")[n],f=r||this.parent.getMainContent().getElementsByClassName("e-row")[n].getElementsByClassName("e-cell")[i],m=g&&g.style?parseInt(g.style.height,10):20,v=[],C=[],y=0,x=parseInt(e,10),b=t.range.split(","),S=0;S<b.length;S++){var w=getRangeIndexes(b[S]);u=this.getNumericArray(w,u)}for(var I=0;I<u.length;I++)for(var R=0;R<u.length;R++)u[R]>0?v.push(u[R]):C.push(u[R]);if(p="BlueDataBar"===p?"B":"GreenDataBar"===p?"G":"RedDataBar"===p?"R":"OrangeDataBar"===p?"O":"LightBlueDataBar"===p?"LB":"PurpleDataBar"===p?"P":"",l=this.getColor(p)[0],d=this.getColor("R")[0],v=v.sort(function(e,t){return e-t}).reverse(),(C=C.sort(function(e,t){return e-t})).length&&v.length)c=v[0]+Math.abs(C[0]),y=Math.abs(C[0]/c*100);else{if(!C.length&&!v.length)return;c=C.length?C[0]:v[0]}if(f&&(ej2Base.isNullOrUndefined(x)||""===e)&&f.getElementsByClassName("e-cf-databar")[0]&&f.removeChild(f.getElementsByClassName("e-cf-databar")[0]),isNumber(x)){var E=this.parent.createElement("div",{id:"spreadsheet-databar",className:"e-cf-databar"}),k=this.parent.createElement("span",{id:"spreadsheet-leftspan",className:"e-databar"}),F=this.parent.createElement("span",{id:"spreadsheet-rightspan",className:"e-databar"}),A=this.parent.createElement("span",{id:"spreadsheet-dataspan",className:"e-databar-value"}),B=void 0;a=k.style,s=F.style,E.appendChild(A),E.insertBefore(F,A),E.insertBefore(k,F),f.querySelector(".e-iconsetspan")&&(B=f.querySelector(".e-iconsetspan")),f.textContent="",f.appendChild(E),B&&f.insertBefore(B,f.firstElementChild),A.innerHTML=this.parent.getDisplayText(h),E.style.height=m-1+"px",A.style.fontSize="11pt",C.length?v.length?x>-1?(a.width=y+"%",a.height=m-3+"px",a.backgroundColor="transparent",a.left="0px",s.width=Math.ceil(Math.abs(x/c*100))+"%",s.height=m-3+"px",s.backgroundColor=p=l,s.left=y+"%"):x<0&&(a.width=Math.ceil(Math.abs(x/c*100))+"%",a.height=m-3+"px",a.backgroundColor=d,a.width===y+"%"?a.left="0px":a.right=100-y+"%"):(s.width=Math.ceil(Math.abs(x/c*100))+"%",s.height=m-3+"px",s.backgroundColor=p=d,s.left="0px"):(s.width=Math.ceil(Math.abs(x/c*100))+"%",s.height=m-3+"px",s.backgroundColor=p=l,s.left="0px")}}},e.prototype.getNumericArray=function(e,t){for(var r=this.parent.getActiveSheet(),n=e[0];n<=e[2];n++)for(var i=e[1];i<=e[3];i++){var o=getCell(n,i,r)&&getCell(n,i,r).value?getCell(n,i,r).value:"";if(ej2Base.isNullOrUndefined(o)||isNumber(o)||isDateTime(o)){var a=parseInt(o,10);ej2Base.isNullOrUndefined(o)||""===o||t.push(a)}}return t},e.prototype.getColor=function(e){if("LB"===e)return["#008aef"];for(var t=e.split(""),r=[],n=0;n<t.length;n++)switch(t[n]){case"G":r.push("#63be7b");break;case"Y":r.push("#ffeb84");break;case"R":r.push("#f8696b");break;case"W":r.push("#ffffff");break;case"B":r.push("#5a8ac6");break;case"O":r.push("#ffb628");break;case"LB":r.push("#008aef");break;case"P":r.push("#d6007b")}return r},e.prototype.getGradient=function(e,t,r,n,i){if(ej2Base.isNullOrUndefined(n))return this.getLinear(t,r,e/i);var o=i/2;return e>=o?this.getLinear(r,n,Math.abs((e-o)/o)):this.getLinear(t,r,e/o)},e.prototype.getLinear=function(e,t,r){return"#"+this.byteLinear(e[1]+e[2],t[1]+t[2],r)+this.byteLinear(e[3]+e[4],t[3]+t[4],r)+this.byteLinear(e[5]+e[6],t[5]+t[6],r)},e.prototype.byteLinear=function(e,t,r){var n=parseInt(e,16)*(1-r)+parseInt(t,16)*r|0;return Math.abs(n).toString(16)},e.prototype.isGreaterThanLessThan=function(e,t,r,n){var i=new RegExp(/[^.-a-zA-Z 0-9]+/g),o=!1;if(isNumber(t))if(isNumber(r))o=n?parseFloat(t)>parseFloat(r.replace(i,"")):parseFloat(t)<parseFloat(r.replace(i,""));else{var a={value:r,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1};this.parent.notify(checkDateFormat,a),a.isDate||a.isTime?(o=n?t>a.updatedVal:t<a.updatedVal,e.value=a.updatedVal.toString()):o=n?t.toLowerCase()>r.toLowerCase():t.toLowerCase()<r.toLowerCase()}else""===t&&Number(r)>0&&!n&&(o=!0);return o},e.prototype.isBetWeen=function(e,t,r,n){var i=new RegExp(/[^.-a-zA-Z 0-9]+/g),o=!1;if(r=r.replace(i,""),n=n.replace(i,""),isNumber(t))if(isNumber(r))o=parseFloat(t)>=parseFloat(r)&&parseFloat(t)<=parseFloat(n);else if(r&&n){var a={value:r,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1},s={value:n,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1};this.parent.notify(checkDateFormat,a),this.parent.notify(checkDateFormat,s),(a.isDate||a.isTime)&&(s.isDate||s.isTime)?(o=t>=a.updatedVal&&t<=s.updatedVal,e.value=a.updatedVal.toString()+","+s.updatedVal.toString()):o=t.toLowerCase()>=r.toLowerCase()&&t.toLowerCase()<=n.toLowerCase()}return o},e.prototype.isEqualTo=function(e,t,r){var n=new RegExp(/[^.-a-zA-Z 0-9]+/g),i=!1;if(isNumber(t))if(isNumber(r))i=parseFloat(t)===parseFloat(r.replace(n,""));else{var o={value:r,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1};this.parent.notify(checkDateFormat,o),o.isTime||o.isDate?(i=t===o.updatedVal,e.value=o.updatedVal.toString()):i=t.toLowerCase()===r.toLowerCase()}return i},e.prototype.isContainsText=function(e,t){var r=new RegExp(/[^.-a-zA-Z 0-9]+/g),n=!1;return ej2Base.isNullOrUndefined(e)||!e.length?n=!1:isNumber(t.replace(r,""))?(t=t.replace(r,""),isDateTime(e)&&(e=dateToInt(e).toString()),n=e.indexOf(t)>-1):isDateTime(t)?(isDateTime(e)&&(e=dateToInt(e).toString()),n=e.indexOf(dateToInt(t).toString())>-1):n=e.toLowerCase().indexOf(t.toLowerCase())>-1,n},e.prototype.isTopBottomTenValue=function(e,t,r,n){var i=this.parent.getActiveSheet(),o=new RegExp(/[^.-a-zA-Z 0-9]+/g),a=parseInt(e,10),s=parseInt(t,10),l=!1;if(isNumber(t)){isNumber(e)?(a=parseFloat(e),s=parseFloat(t.replace(o,""))):isDateTime(e)&&(a=dateToInt(e),s=parseFloat(t));for(var d=[],p=void 0,h=r.range.split(","),c=0;c<h.length;c++)for(var u=getRangeIndexes(h[c]),g=u[0];g<=u[2];g++)for(var f=u[1];f<=u[3];f++)(p=getCell(g,f,i)&&getCell(g,f,i).value?getCell(g,f,i).value:"")&&isNumber(p)&&(p=parseFloat(p),d.push(p));l=(d=(d=n?d.sort(function(e,t){return e-t}).reverse():d.sort(function(e,t){return e-t})).slice(0,s)).indexOf(a)>-1}return l},e.prototype.isTopBottomTenPercentage=function(e,t,r,n){var i=this.parent.getActiveSheet(),o=new RegExp(/[^.-a-zA-Z 0-9]+/g),a=parseInt(e,10),s=parseInt(t,10),l=!1;if(isNumber(t)){isNumber(e)?(a=parseFloat(e),s=parseFloat(t.replace(o,""))):isDateTime(e)&&(a=dateToInt(e),s=parseFloat(t));for(var d=[],p=void 0,h=0,c=void 0,u=r.range.split(","),g=0;g<u.length;g++)for(var f=getRangeIndexes(u[g]),m=f[0];m<=f[2];m++)for(var v=f[1];v<=f[3];v++)(p=getCell(m,v,i)&&getCell(m,v,i).value?getCell(m,v,i).value:"")&&isNumber(p)&&(p=parseFloat(p),d.push(p)),h++;c=s/(100/h),c=Math.ceil(c),l=(d=(d=n?d.sort(function(e,t){return e-t}).reverse():d.sort(function(e,t){return e-t})).slice(0,c||1)).indexOf(a)>-1}return l},e.prototype.isAboveBelowAverage=function(e,t,r,n){for(var i,o=this.parent.getActiveSheet(),a=parseFloat(e),s=r.range.split(","),l=[],d=0,p=0;p<s.length;p++)for(var h=getRangeIndexes(s[p]),c=h[0];c<=h[2];c++)for(var u=h[1];u<=h[3];u++)(i=getCell(c,u,o)&&getCell(c,u,o).value?getCell(c,u,o).value:"")&&isNumber(i)&&(i=parseFloat(i),l.push(i));for(var g=0;g<l.length;g++)d+=l[g];return d/=l.length,n?a>d:a<d},e.prototype.isDuplicateUnique=function(e,t){var r,n=t.type,i=0,o=this.parent.getActiveSheet(),a=e,s=t.range.split(",");if(ej2Base.isNullOrUndefined(a)||""===a)return!1;for(var l=0;l<s.length;l++)for(var d=getRangeIndexes(s[l]),p=d[0];p<=d[2];p++)for(var h=d[1];h<=d[3];h++)if((r=getCell(p,h,o)&&getCell(p,h,o).value?getCell(p,h,o).value.toString():"")&&""!==r&&2===(i=a.toLowerCase()===r.toLowerCase()?i+1:i))return"Duplicate"===n;return"Duplicate"!==n},e.prototype.setFormat=function(e,t){switch(t.cFColor){case"RedFT":e.backgroundColor="#ffc7ce",e.color="#9c0055";break;case"YellowFT":e.backgroundColor="#ffeb9c",e.color="#9c6500";break;case"GreenFT":e.backgroundColor="#c6efce",e.color="#006100";break;case"RedF":e.backgroundColor="#ffc7ce";break;case"RedT":e.color="#9c0055"}return e},e.prototype.getModuleName=function(){return"conditionalFormatting"},e}(),AutoFill=function(){function e(e){this.fillOptionIndex=0,this.parent=e,this.addEventListener()}return e.prototype.getfillItems=function(){var e=this.parent.serviceLocator.getService(locale);return[{text:e.getConstant("CopyCells")},{text:e.getConstant("FillSeries")},{text:e.getConstant("FillFormattingOnly")},{text:e.getConstant("FillWithoutFormatting")}]},e.prototype.init=function(){this.createAutoFillElement()},e.prototype.createAutoFillElement=function(){var e=this.parent.getMainContent(),t=this.parent.createElement("div",{className:"e-autofill"});e.appendChild(t),this.autoFillElement=t,this.getautofillDDB({id:this.parent.element.id+"_autofilloptionbtn",appendElem:e})},e.prototype.getautofillDDB=function(e){var t=this,r=this.parent.createElement("button",{id:e.id,className:"e-filloption"});return r.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text"})),this.autoFillDropDown=new ej2Splitbuttons.DropDownButton({cssClass:"e-dragfill-ddb",iconCss:"e-icons e-dragfill-icon",items:this.getfillItems(),createPopupOnClick:!0,select:function(e){t.autoFillOptionClick({type:t.getFillType(e.item.text)})},beforeOpen:function(){return t.autoFillClick()}}),this.autoFillDropDown.createElement=this.parent.createElement,this.autoFillDropDown.appendTo(r),e.appendElem.appendChild(r),this.autoFillDropDown},e.prototype.getFillType=function(e){var t=this.parent.serviceLocator.getService(locale);return e===t.getConstant("CopyCells")?"CopyCells":e===t.getConstant("FillSeries")?"FillSeries":e===t.getConstant("FillFormattingOnly")?"FillFormattingOnly":"FillWithoutFormatting"},e.prototype.autoFillClick=function(){var e=this.parent.serviceLocator.getService(locale),t={fillType:"FillSeries",disableItems:[""]};this.parent.notify(getFillInfo,t),this.autoFillDropDown.setProperties({items:this.getfillItems()},!0),this.autoFillDropDown.removeItems(t.disableItems),this.refreshAutoFillOption(e.getConstant(t.fillType))},e.prototype.getFillRange=function(e,t,r,n){switch(n){case"Up":return[r.rowIndex,e.colIndex,e.rowIndex-1,t.colIndex];case"Right":return[e.rowIndex,t.colIndex+1,t.rowIndex,r.colIndex];case"Down":return[t.rowIndex+1,e.colIndex,r.rowIndex,t.colIndex];case"Left":return[e.rowIndex,r.colIndex,t.rowIndex,e.colIndex-1]}},e.prototype.autoFillOptionClick=function(e){var t=this.parent.serviceLocator.getService(locale),r=this.parent.getActiveSheet(),n=getRangeIndexes(this.parent.selectionModule.dAutoFillCell),i=getRangeIndexes(r.selectedRange),o=n[0],a=n[1],s=n[2],l=n[3],d=this.getDirection({rowIndex:s,colIndex:l},{rowIndex:i[2],colIndex:i[3]}),p=getSwapRange([o,a,s,l]),h=this.getFillRange({rowIndex:o,colIndex:a},{rowIndex:s,colIndex:l},{rowIndex:i[2],colIndex:i[3]},d);this.refreshAutoFillOption(t.getConstant(e.type)),this.parent.notify(performUndoRedo,{isUndo:!0,isPublic:!0,preventEvt:"FillWithoutFormatting"===e.type,preventReSelect:!0});var c={dataRange:r.name+"!"+getRangeAddress(p),fillRange:r.name+"!"+getRangeAddress(h),direction:d,fillType:e.type,isFillOptClick:!0};this.isVerticalFill="Down"===c.direction||"Up"===c.direction,this.parent.notify(setAutoFill,c),this.positionAutoFillElement({isautofill:!0});var u={dataRange:c.dataRange,fillRange:c.fillRange,fillType:c.fillType,direction:c.direction,selectedRange:r.name+"!"+getRangeAddress(i)};this.parent.notify(completeAction,{eventArgs:u,action:"autofill"}),this.parent.notify(showAggregate,{}),this.autoFillClick()},e.prototype.refreshAutoFillOption=function(e){for(var t=0;t<this.autoFillDropDown.items.length;t++)this.autoFillDropDown.items[t].iconCss="";for(t=0;t<this.autoFillDropDown.items.length;t++)this.autoFillDropDown.items[t].text===e&&(this.autoFillDropDown.items[t].iconCss="e-icons e-selected-icon");["Copy Cells","Fill Series","Fill Formatting Only","Fill Without Formatting"].indexOf(e)<0&&(this.autoFillDropDown.items[this.fillOptionIndex].iconCss=""),this.autoFillDropDown.dataBind()},e.prototype.positionAutoFillElement=function(e){var t,r,n,i=0,o=0,a=this.parent.getActiveSheet(),s=getSwapRange(getRangeIndexes(a.selectedRange)),l=-5,d=-5,p=6,h=6,c=0===s[1]&&s[3]===a.colCount-1,u=0===s[0]&&s[2]===a.rowCount-1,g=s[2],f=s[3],m=this.parent.getCell(g,f);if(isHiddenCol(a,s[3])||isHiddenRow(a,s[2])||m&&m.classList.contains("e-formularef-selection"))this.hideAutoFillElement();else if(!a.isProtected&&!a.protectSettings.selectCells||a.protectSettings.selectCells)if(c?(l=-5,d=-1,p=6,h=2,g=s[2],f=s[1]):u&&(d=-5,l=0,p=1,h=6,g=s[0],f=s[3]),a.frozenColumns||a.frozenRows){if(u||c?(setPosition(this.parent,this.autoFillElement,s,"e-autofill",e&&e.preventAnimation),this.parent.autoFillSettings.showFillOptions&&e&&e.isautofill&&setPosition(this.parent,this.autoFillDropDown.element,s,"e-filloption")):(setPosition(this.parent,this.autoFillElement,[g,f,g,f],"e-autofill",e&&e.preventAnimation),this.parent.autoFillSettings.showFillOptions&&e&&e.isautofill&&setPosition(this.parent,this.autoFillDropDown.element,[g,f,g,f],"e-filloption")),this.autoFillElement){this.autoFillCell={rowIndex:g,colIndex:f};var v=this.parent.element.querySelectorAll(".e-autofill")[0];if(v){var C=v.getBoundingClientRect();this.autoFillElementPosition={left:C.left,top:C.top}}}}else if(n=getCellPosition(a,[g,f,g,f],this.parent.frozenRowCount(a),this.parent.frozenColCount(a),this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth),t=getRowsHeight(a,g,g,!0),r=getColumnsWidth(a,f,f,!0),u||(i+=t),c||(o+=r),i+=Math.round(n.top)+l,o+=Math.round(n.left)+d,this.autoFillElement){ej2Base.removeClass([this.autoFillElement],"e-hide"),this.autoFillElement.style.top=i+"px",this.autoFillElement.style.left=o+"px",this.autoFillCell={rowIndex:g,colIndex:f};C=this.autoFillElement.getBoundingClientRect();this.autoFillElementPosition={left:C.left,top:C.top},this.parent.autoFillSettings.showFillOptions&&e&&e.isautofill&&(ej2Base.removeClass([this.autoFillDropDown.element],"e-hide"),this.autoFillDropDown.element.style.top=i+p+"px",this.autoFillDropDown.element.style.left=o+h+"px")}},e.prototype.hideAutoFillElement=function(){var e=this.parent.element;e.querySelectorAll(".e-autofill").forEach(function(t){e&&ej2Base.addClass([t],"e-hide")})},e.prototype.hideAutoFillOptions=function(){var e=this.parent.element;e.querySelectorAll(".e-filloption").forEach(function(t){e&&ej2Base.addClass([t],"e-hide")})},e.prototype.selectAutoFillRange=function(e){var t={clientY:getClientY(e.e),target:e.e.target},r={clientX:getClientX(e.e),target:e.e.target},n=this.parent.getActiveSheet();this.parent.notify(getRowIdxFromClientY,t),this.parent.notify(getColIdxFromClientX,r);var i,o=this.getAutoFillRange({rowIndex:t.clientY,colIndex:r.clientX});return i=o&&o.fillRange?[o.startCell.rowIndex,o.startCell.colIndex,o.endCell.rowIndex,o.endCell.colIndex]:getRangeIndexes(n.selectedRange),e.indexes=i,i},e.prototype.getAutoFillRange=function(e){var t=this.parent.getActiveSheet(),r=this.autoFillCell,n=getSwapRange(getRangeIndexes(t.selectedRange)),i=n[0],o=n[1],a=n[2],s=n[3],l=isInRange(n,[e.rowIndex,e.colIndex,e.rowIndex,e.colIndex],!0),d={rowIndex:i,colIndex:o},p={rowIndex:n[0],colIndex:n[1]},h={rowIndex:n[2],colIndex:n[3]},c={rowIndex:a,colIndex:s},u=this.modifyRangeForMerge(e.rowIndex,e.colIndex,r.rowIndex,r.colIndex,n);return e.rowIndex<r.rowIndex?i-e.rowIndex>e.colIndex-s&&i-e.rowIndex>o-e.colIndex?l?{startCell:d,endCell:{rowIndex:e.rowIndex,colIndex:s}}:{startCell:c,endCell:{rowIndex:u.rowIndex,colIndex:o},fillRange:[u.rowIndex,o,i-1,s],direction:"Up"}:e.colIndex>r.colIndex?{startCell:d,endCell:{rowIndex:a,colIndex:e.colIndex},fillRange:[i,s+1,a,e.colIndex],direction:"Right"}:e.colIndex<r.colIndex?l?{startCell:d,endCell:c}:{startCell:c,endCell:{rowIndex:i,colIndex:e.colIndex},fillRange:[i,e.colIndex,a,o-1],direction:"Left"}:{startCell:p,endCell:h}:e.colIndex>r.colIndex?e.rowIndex-a>e.colIndex-s?{startCell:d,endCell:{rowIndex:e.rowIndex,colIndex:s},fillRange:[a+1,o,e.rowIndex,s],direction:"Down"}:{startCell:d,endCell:{rowIndex:a,colIndex:u.colIndex},fillRange:[i,s+1,a,u.colIndex],direction:"Right"}:e.colIndex<r.colIndex?e.rowIndex-a>s-e.colIndex||e.rowIndex-i>s-e.colIndex&&e.rowIndex!==a?{startCell:d,endCell:{rowIndex:e.rowIndex,colIndex:s},fillRange:[a+1,o,e.rowIndex,s],direction:"Down"}:l?{startCell:d,endCell:c}:{startCell:c,endCell:{rowIndex:i,colIndex:u.colIndex},fillRange:[i,u.colIndex,a,o-1],direction:"Left"}:e.rowIndex>r.rowIndex?{startCell:d,endCell:{rowIndex:u.rowIndex,colIndex:s},fillRange:[a+1,o,u.rowIndex,s],direction:"Down"}:(e.rowIndex===r.rowIndex&&(e.colIndex,r.colIndex),{startCell:p,endCell:h})},e.prototype.modifyRangeForMerge=function(e,t,r,n,i){var o={rowIndex:e,colIndex:t};if(this.isMergedRange(i)){var a=i[2]-i[0]+1,s=i[3]-i[1]+1,l=void 0;e<r?(l=(i[2]-e+1)%a)&&e-(a-l)>=0&&(o.rowIndex=e-(a-l)):t>n?(l=(t-i[1]+1)%s)&&(o.colIndex=t+(s-l)):t<n?(l=(i[3]-t+1)%s)&&t-(s-l)>=0&&(o.colIndex=t-(s-l)):e>r&&(l=(e-i[0]+1)%a)&&(o.rowIndex=e+(a-l))}return o},e.prototype.performAutoFill=function(e){if(e.event.clientX>this.autoFillElementPosition.left&&e.event.clientX<this.autoFillElementPosition.left+10&&e.event.clientY>this.autoFillElementPosition.top&&e.event.clientY<this.autoFillElementPosition.top+10)this.positionAutoFillElement({isautofill:!1});else{var t={clientY:getClientY(e.event),target:e.event.target},r={clientX:getClientX(e.event),target:e.event.target},n=this.parent.getActiveSheet();this.parent.notify(getRowIdxFromClientY,t),this.parent.notify(getColIdxFromClientX,r);var i=this.getAutoFillRange({rowIndex:t.clientY,colIndex:r.clientX});if(i&&i.fillRange){var o={dataRange:n.name+"!"+e.dAutoFillCell,fillRange:n.name+"!"+getRangeAddress(i.fillRange),direction:i.direction,fillType:this.parent.autoFillSettings.fillType,cancel:!1};if(this.parent.notify(beginAction,{eventArgs:o,action:"autofill"}),o.cancel)return;var a=isLockedCells(this.parent,i.fillRange);if(n.isProtected&&a)return void this.parent.notify(editAlert,null);this.performAutoFillAction(o,i,a),this.isMergedRange(getRangeIndexes(o.dataRange))&&this.parent.renderModule.refreshSheet(),this.positionAutoFillElement({isautofill:!this.isMergedRange(getRangeIndexes(o.fillRange))})}}},e.prototype.refreshCell=function(e){this.parent.serviceLocator.getService("cell").refreshRange([e.rowIndex,e.colIndex,e.rowIndex,e.colIndex])},e.prototype.isRange=function(e){return e&&(e[0]!==e[2]||e[1]!==e[3])},e.prototype.fillRange=function(e){var t={dataRange:"",fillRange:"",direction:"Down",fillType:"CopyCells"},r=this.parent.getActiveSheet(),n=getSwapRange(getRangeIndexes(r.selectedRange)),i=n[0],o=n[1],a=n[2],s=n[3],l=this.getDirection({rowIndex:i,colIndex:o},{rowIndex:a,colIndex:s},e.verticalFill),d=e.verticalFill?"Down"===l:"Right"===l;if(this.isRange(n)&&d)e.verticalFill?(t.dataRange=r.name+"!"+getRangeAddress([i,o,i,s]),t.fillRange=r.name+"!"+getRangeAddress([i+1,o,a,s])):(t.dataRange=r.name+"!"+getRangeAddress([i,o,a,o]),t.fillRange=r.name+"!"+getRangeAddress([i,o+1,a,s]));else{if(e.verticalFill){if(!i)return;t.dataRange=r.name+"!"+getRangeAddress([i-1,o,i-1,s])}else{if(!o)return;t.dataRange=r.name+"!"+getRangeAddress([i,o-1,a,o-1])}t.fillRange=r.name+"!"+getRangeAddress(n)}t.direction=e.verticalFill?"Down":"Right",t.fillType="CopyCells",r.isProtected||this.performAutoFillAction(t)},e.prototype.getDirection=function(e,t,r){if(r=ej2Base.isNullOrUndefined(r)?this.isVerticalFill:r){if(t.rowIndex<e.rowIndex)return"Up";if(t.rowIndex>e.rowIndex)return"Down";if(t.colIndex>e.colIndex)return"Right";if(t.colIndex<e.colIndex)return"Left"}else{if(t.colIndex>e.colIndex)return"Right";if(t.colIndex<e.colIndex)return"Left";if(t.rowIndex<e.rowIndex)return"Up";if(t.rowIndex>e.rowIndex)return"Down"}return null},e.prototype.performAutoFillAction=function(e,t,r){var n=this,i=this.parent.getActiveSheet(),o=this.parent.serviceLocator.getService(locale);if(this.isMergedRange(getRangeIndexes(e.fillRange))){var a=this.parent.serviceLocator.getService(dialog);a.show({target:this.parent.element,isModal:!0,showCloseIcon:!0,height:180,width:400,content:o.getConstant("AutoFillMergeAlertMsg"),buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(locale).getConstant("Ok"),isPrimary:!0},click:function(){a.hide(),n.parent.selectRange(e.dataRange)}}],close:function(){a.hide(),n.parent.selectRange(e.dataRange)}},!1)}else{this.isVerticalFill="Down"===e.direction||"Up"===e.direction,this.parent.notify(setAutoFill,{dataRange:e.dataRange,fillRange:e.fillRange,direction:e.direction,fillType:e.fillType,isLockedCell:r});var s=t?getRangeAddress([t.startCell.rowIndex,t.startCell.colIndex,t.endCell.rowIndex,t.endCell.colIndex]):i.selectedRange;updateSelectedRange(this.parent,s,i);var l={dataRange:e.dataRange,fillRange:e.fillRange,fillType:e.fillType,direction:e.direction,selectedRange:s};this.parent.notify(completeAction,{eventArgs:l,action:"autofill"}),this.parent.notify(showAggregate,{})}},e.prototype.getRangeData=function(e){for(var t,r=[],n=this.parent.getActiveSheet(),i=e.range[0],o=e.range[1],a=e.range[2],s=e.range[3],l=o;i<=a;)if(isHiddenRow(n,i))i++;else{for(o=l;o<=s;)isHiddenCol(n,o)?o++:(t=getCell(i,o,n),r.push(t),o++);i++}return r},e.prototype.isMergedRange=function(e){var t=0,r=this.getRangeData({range:e,sheetIdx:this.parent.activeSheetIndex});for(t=0;t<r.length;t++)if(r[t]&&(r[t].rowSpan||r[t].colSpan))return!0;return!1},e.prototype.addEventListener=function(){this.parent.on(contentLoaded,this.init,this),this.parent.on(positionAutoFillElement,this.positionAutoFillElement,this),this.parent.on(hideAutoFillOptions,this.hideAutoFillOptions,this),this.parent.on(hideAutoFillElement,this.hideAutoFillElement,this),this.parent.on(performAutoFill,this.performAutoFill,this),this.parent.on(fillRange,this.fillRange,this),this.parent.on(selectAutoFillRange,this.selectAutoFillRange,this),this.parent.on(refreshCell,this.refreshCell,this),this.parent.on(getautofillDDB,this.getautofillDDB,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(contentLoaded,this.init),this.parent.off(positionAutoFillElement,this.positionAutoFillElement),this.parent.off(hideAutoFillOptions,this.hideAutoFillOptions),this.parent.off(hideAutoFillElement,this.hideAutoFillElement),this.parent.off(performAutoFill,this.performAutoFill),this.parent.off(fillRange,this.fillRange),this.parent.off(selectAutoFillRange,this.selectAutoFillRange),this.parent.off(refreshCell,this.refreshCell),this.parent.off(getautofillDDB,this.getautofillDDB))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"autofill"},e}(),__extends$8=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__assign$1=function(){return(__assign$1=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},__decorate$7=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},RibbonHeader=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$8(t,e),__decorate$7([ej2Base.Property("")],t.prototype,"text",void 0),__decorate$7([ej2Base.Property("")],t.prototype,"iconCss",void 0),__decorate$7([ej2Base.Property("left")],t.prototype,"iconPosition",void 0),t}(ej2Base.ChildProperty),RibbonItem=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$8(t,e),__decorate$7([ej2Base.Complex({},RibbonHeader)],t.prototype,"header",void 0),__decorate$7([ej2Base.Collection([],ej2Navigations.Item)],t.prototype,"content",void 0),__decorate$7([ej2Base.Property("")],t.prototype,"cssClass",void 0),__decorate$7([ej2Base.Property(!1)],t.prototype,"disabled",void 0),t}(ej2Base.ChildProperty),Ribbon$1=function(e){function t(t,r){return e.call(this,t)||this}return __extends$8(t,e),t.prototype.preRender=function(){},t.prototype.render=function(){this.element.id||(this.element.id=ej2Base.getUniqueID("ribbon")),this.renderRibbon()},t.prototype.destroy=function(){var t=this.element.querySelector(".e-drop-icon");if(t&&t.removeEventListener("click",this.ribbonExpandCollapse.bind(this)),this.menuItems.length){var r=document.getElementById(this.element.id+"_menu");r&&ej2Base.getComponent(r,"menu").destroy()}this.toolbarObj.destroy(),this.tabObj.destroy(),this.element.innerHTML="",this.toolbarObj=null,this.tabObj=null,e.prototype.destroy.call(this)},t.prototype.getTabItems=function(){var e=this,t=[];return this.menuItems.length&&t.push({header:{text:this.initMenu(this.menuItems)},content:this.toolbarObj.element,cssClass:"e-menu-tab"}),this.items.forEach(function(r){t.push({header:r.header,content:e.toolbarObj.element})}),t},t.prototype.initMenu=function(e){var t=this,r=this.createElement("ul",{id:this.element.id+"_menu"});this.element.appendChild(r);var n=new ej2Navigations.Menu({cssClass:"e-file-menu",items:e,showItemOnClick:!0,beforeOpen:function(r){r.parentItem.text===e[0].text&&(n.showItemOnClick=!1),t.trigger("beforeOpen",r)},select:function(e){t.trigger("fileMenuItemSelect",e)},beforeClose:function(r){"mouseover"!==r.event.type||ej2Base.closest(r.event.target,".e-menu-popup")?(t.trigger("beforeClose",r),r.parentItem&&r.parentItem.text!==e[0].text||requestAnimationFrame(function(){return n.setProperties({showItemOnClick:!0},!0)})):r.cancel=!0},beforeItemRender:function(e){t.trigger("beforeFileMenuItemRender",e)}});return n.createElement=this.createElement,n.appendTo(r),r.parentElement},t.prototype.renderRibbon=function(){var e=this,t=this.createElement("div"),r=this.createElement("div");this.toolbarObj=new ej2Navigations.Toolbar({items:this.items[this.selectedTab].content,clicked:function(t){return e.trigger("clicked",t)}}),this.toolbarObj.createElement=this.createElement,this.toolbarObj.appendTo(r),this.tabObj=new ej2Navigations.Tab({selectedItem:this.getIndex(this.selectedTab),animation:{next:{duration:0},previous:{duration:0}},items:this.getTabItems(),selecting:function(t){if(e.menuItems.length&&0===t.selectingIndex)t.cancel=!0;else{if(t.selectingIndex===e.getIndex(e.selectedTab))return;e.updateToolbar(e.getIndex(t.selectingIndex,!0)),e.toolbarObj.dataBind(),e.element.classList.contains("e-collapsed")&&ej2Base.EventHandler.remove(t.selectedItem,"click",e.ribbonExpandCollapse);var r=void 0;e.menuItems.length?((r=__assign$1({},t)).selectingIndex-=1,r.selectedIndex-=1):r=t,e.trigger("selecting",r)}},selected:function(t){t.selectedIndex!==e.getIndex(e.selectedTab)&&(e.setProperties({selectedTab:e.getIndex(t.selectedIndex,!0)},!0),e.element.classList.contains("e-collapsed")&&(e.element.classList.remove("e-collapsed"),e.trigger("expandCollapse",{element:e.toolbarObj.element,expanded:!0})))},created:function(){e.toolbarObj.refreshOverflow()}}),this.element.appendChild(t),this.tabObj.createElement=this.createElement,this.tabObj.appendTo(t);var n=this.createElement("span",{className:"e-drop-icon e-icons"});n.addEventListener("click",this.ribbonExpandCollapse.bind(this)),this.element.appendChild(n)},t.prototype.ribbonExpandCollapse=function(e){var t,r={element:this.toolbarObj.element,expanded:!0};this.element.classList.contains("e-collapsed")?(t=this.tabObj.element.querySelector(".e-tab-header").getElementsByClassName("e-toolbar-item")[this.tabObj.selectedItem],this.element.classList.remove("e-collapsed"),t.classList.add("e-active"),ej2Base.EventHandler.remove(t,"click",this.ribbonExpandCollapse),this.trigger("expandCollapse",r)):(t=this.tabObj.element.querySelector(".e-tab-header .e-toolbar-item.e-active"),this.element.classList.add("e-collapsed"),r.expanded=!1,t.classList.remove("e-active"),ej2Base.EventHandler.add(t,"click",this.ribbonExpandCollapse,this),this.trigger("expandCollapse",r))},t.prototype.getIndex=function(e,t){return this.menuItems.length?t?e-1:e+1:e},t.prototype.updateToolbar=function(e){this.toolbarObj.items=this.items[e].content,this.toolbarObj.dataBind()},t.prototype.enableMenuItems=function(e,t,r){void 0===t&&(t=!0),this.menuItems.length&&ej2Base.getComponent(document.getElementById(this.element.id+"_menu"),"menu").enableItems(e,t,r)},t.prototype.hideMenuItems=function(e,t,r){if(void 0===t&&(t=!0),this.menuItems.length){var n=ej2Base.getComponent(document.getElementById(this.element.id+"_menu"),"menu");t?n.hideItems(e,r):n.showItems(e,r)}},t.prototype.addMenuItems=function(e,t,r,n){if(void 0===r&&(r=!0),this.menuItems.length){var i=ej2Base.getComponent(document.getElementById(this.element.id+"_menu"),"menu");r?i.insertAfter(e.reverse(),t,n):i.insertBefore(e,t,n)}},t.prototype.hideTabs=function(e,t){var r=this;void 0===t&&(t=!0);var n,i,o,a;if(t||(a=this.isAllHidden()),e.forEach(function(e){(n=r.getTabIndex(e,-1))>-1&&(t?r.items[n].cssClass.includes(" e-hide")||(r.items[n].cssClass=r.items[n].cssClass+" e-hide",r.tabObj.items[r.getIndex(n)].cssClass=r.items[n].cssClass,void 0===i&&n===r.selectedTab&&(i=!0),o=!0):r.items[n].cssClass.includes(" e-hide")&&(r.items[n].cssClass=r.items[n].cssClass.replace(" e-hide",""),r.tabObj.items[r.getIndex(n)].cssClass=r.items[n].cssClass,void 0===i&&n===r.selectedTab&&(i=!0),o=!0))}),this.setProperties({items:this.items},!0),this.tabObj.items=this.tabObj.items,this.tabObj.dataBind(),t&&(a=this.isAllHidden())&&(i=!1),!t&&a&&(i=!i),o&&a&&(this.element.classList.contains("e-collapsed")?(this.element.classList.remove("e-collapsed"),this.element.querySelector(".e-drop-icon").classList.remove("e-hide")):(this.element.classList.add("e-collapsed"),this.element.querySelector(".e-drop-icon").classList.add("e-hide"))),i)for(var s=0;s<this.items.length;s++)if(!this.items[s].cssClass.includes(" e-hide")){this.tabObj.selectedItem=this.getIndex(s),this.tabObj.dataBind();break}},t.prototype.isAllHidden=function(){for(var e=!0,t=0;t<this.items.length;t++)if(!this.items[t].cssClass.includes(" e-hide")){e=!1;break}return e},t.prototype.enableTabs=function(e,t){var r=this;void 0===t&&(t=!0),e.forEach(function(e){var n=r.getTabIndex(e,-1);n>-1&&(r.items[n].disabled=!t,n=r.getIndex(n),r.tabObj.enableTab(n,t))}),this.setProperties({items:this.items},!0)},t.prototype.addTabs=function(e,t){var r=this,n=this.getTabIndex(t);e.forEach(function(e){e=new RibbonItem(r.items[0],"items",e,!0),r.items.splice(n,0,e),r.tabObj.addTab([{header:e.header,content:r.toolbarObj.element}],r.getIndex(n)),n++}),this.setProperties({items:this.items},!0),this.setProperties({selectedTab:this.getIndex(this.tabObj.selectedItem,!0)},!0)},t.prototype.getTabIndex=function(e,t){if(void 0===t&&(t=this.items.length),e)for(var r=0;r<this.items.length;r++)if(this.items[r].header.text===e){t=r;break}return t},t.prototype.addToolbarItems=function(e,t,r){var n=this,i=this.getTabIndex(e);ej2Base.isNullOrUndefined(r)&&(r=this.items[i].content.length),t.forEach(function(e){e=new ej2Navigations.Item(n.items[i].content[0],"content",e,!0),n.items[i].content.splice(r,0,e),r++}),this.setProperties({items:this.items},!0),i===this.selectedTab&&t.length&&this.updateToolbar(i)},t.prototype.enableItems=function(e,t,r){if(void 0===r&&(r=!0),t){var n=this.getTabIndex(e,-1);if(n<0)return;for(var i=0;i<t.length;i++){if("string"==typeof t[i])for(var o=0;o<this.items[n].content.length;o++)if(this.items[n].content[o].id===t[i]){t[i]=o;break}if("string"==typeof t[i]){if(t.length-1>i)continue;return}this.items[n].content[t[i]].disabled=!r,n!==this.selectedTab&&this.setProperties({items:this.items},!0)}n===this.selectedTab&&this.updateToolbar(n)}else this.toolbarObj.disable(!r)},t.prototype.hideToolbarItems=function(e,t,r){var n=this;void 0===r&&(r=!0);for(var i,o=0;o<this.items.length;o++)if(this.items[o].header.text===e){i=o,t.forEach(function(e){n.items[i].content[e]&&(r?n.items[i].content[e].cssClass.includes(" e-hide")||(n.items[i].content[e].cssClass=n.items[i].content[e].cssClass+" e-hide"):n.items[i].content[e].cssClass.includes(" e-hide")&&(n.items[i].content[e].cssClass=n.items[i].content[e].cssClass.replace(" e-hide","")))});break}this.setProperties({items:this.items},!0),void 0!==i&&i===this.selectedTab&&this.updateToolbar(i)},t.prototype.getModuleName=function(){return"ribbon"},t.prototype.getPersistData=function(){return this.addOnPersist([])},t.prototype.onPropertyChanged=function(e,t){for(var r=0,n=Object.keys(e);r<n.length;r++){switch(n[r]){case"selectedTab":this.tabObj.selectedItem=this.getIndex(e.selectedTab),this.tabObj.dataBind()}}},__decorate$7([ej2Base.Property("")],t.prototype,"cssClass",void 0),__decorate$7([ej2Base.Property(!0)],t.prototype,"menuType",void 0),__decorate$7([ej2Base.Collection([],ej2Navigations.MenuItem)],t.prototype,"menuItems",void 0),__decorate$7([ej2Base.Property(0)],t.prototype,"selectedTab",void 0),__decorate$7([ej2Base.Collection([],RibbonItem)],t.prototype,"items",void 0),__decorate$7([ej2Base.Event()],t.prototype,"selecting",void 0),__decorate$7([ej2Base.Event()],t.prototype,"fileMenuItemSelect",void 0),__decorate$7([ej2Base.Event()],t.prototype,"beforeFileMenuItemRender",void 0),__decorate$7([ej2Base.Event()],t.prototype,"beforeOpen",void 0),__decorate$7([ej2Base.Event()],t.prototype,"beforeClose",void 0),__decorate$7([ej2Base.Event()],t.prototype,"selectFormat",void 0),__decorate$7([ej2Base.Event()],t.prototype,"clicked",void 0),__decorate$7([ej2Base.Event()],t.prototype,"created",void 0),__decorate$7([ej2Base.Event()],t.prototype,"expandCollapse",void 0),t=__decorate$7([ej2Base.NotifyPropertyChanges],t)}(ej2Base.Component),ColorPicker$1=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.render=function(){var e=this,t=this.parent.element.id,r=this.parent.createElement("input",{attrs:{type:"color"}});this.fontColorPicker=new ej2Inputs.ColorPicker({value:"#000000ff",mode:"Palette",showButtons:!1,presetColors:fontColor,enableOpacity:!1,beforeClose:function(){return e.beforeCloseHandler(e.fontColorPicker)},open:this.openHandler.bind(this),beforeModeSwitch:function(t){return e.beforeModeSwitch(e.fontColorPicker,t)},change:function(t){var r={style:{color:e.fontColorPicker.getValue(t.currentValue.rgba)},onActionUpdate:!0};e.parent.notify(setCellFormat,r),r.cancel?e.fontColorPicker.setProperties({value:e.fontColorPicker.getValue(t.previousValue.rgba,"HEXA")},!0):e.updateSelectedColor(r.style.color,e.fontColorPicker.element),focus(e.parent.element)},created:function(){return e.wireFocusEvent(e.fontColorPicker.element,"#000000")}}),this.fontColorPicker.createElement=this.parent.createElement,this.parent.element.appendChild(r),this.fontColorPicker.appendTo(r),r.parentElement.id=t+"_font_color_picker",ej2Base.addClass([r.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-font-color"]),r=this.parent.createElement("input",{attrs:{type:"color"}}),this.filColorPicker=new ej2Inputs.ColorPicker({value:"#ffff00ff",mode:"Palette",presetColors:fillColor,showButtons:!1,enableOpacity:!1,open:this.openHandler.bind(this),beforeClose:function(){return e.beforeCloseHandler(e.filColorPicker)},beforeModeSwitch:function(t){return e.beforeModeSwitch(e.filColorPicker,t)},change:function(t){var r={style:{backgroundColor:e.filColorPicker.getValue(t.currentValue.rgba)},onActionUpdate:!0};e.parent.notify(setCellFormat,r),r.cancel?e.filColorPicker.setProperties({value:e.filColorPicker.getValue(t.previousValue.rgba,"HEXA")},!0):e.updateSelectedColor(r.style.backgroundColor,e.filColorPicker.element),focus(e.parent.element)},created:function(){return e.wireFocusEvent(e.filColorPicker.element,"#ffff00")}}),this.filColorPicker.createElement=this.parent.createElement,this.parent.element.appendChild(r),this.filColorPicker.appendTo(r),r.parentElement.id=t+"_fill_color_picker",ej2Base.addClass([r.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-fill-color"])},e.prototype.updateSelectedColor=function(e,t){t.nextElementSibling.querySelector(".e-selected-color").style.borderBottomColor=e},e.prototype.wireFocusEvent=function(e,t){var r=this;this.updateSelectedColor(t,e),(e=e.parentElement.querySelector(".e-split-colorpicker")).addEventListener("focus",function(){focus(r.parent.element)})},e.prototype.openHandler=function(e){e.element.querySelector(".e-mode-switch-btn").title=this.parent.serviceLocator.getService(locale).getConstant("MoreColors")},e.prototype.beforeCloseHandler=function(e){e.modeSwitcher||e.setProperties({modeSwitcher:!0},!0),e.showButtons&&e.setProperties({showButtons:!1},!0)},e.prototype.beforeModeSwitch=function(e,t){var r=this.parent.serviceLocator.getService(locale);"Picker"===t.mode?(e.showButtons=!0,e.dataBind(),t.element.querySelector(".e-apply").title=r.getConstant("Apply"),t.element.querySelector(".e-cancel").title=r.getConstant("Cancel"),t.element.querySelector(".e-mode-switch-btn").title=r.getConstant("StandardColors")):(e.showButtons=!1,e.dataBind(),t.element.querySelector(".e-mode-switch-btn").title=r.getConstant("MoreColors"))},e.prototype.destroy=function(){this.parent&&(this.removeEventListener(),this.fontColorPicker.destroy(),this.fontColorPicker=null,this.filColorPicker.destroy(),this.filColorPicker=null,this.parent=null)},e.prototype.addEventListener=function(){this.parent.on(beforeRibbonCreate,this.render,this),this.parent.on("destroyRibbonComponents",this.destroy,this),this.parent.on(spreadsheetDestroyed,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.off(beforeRibbonCreate,this.render),this.parent.off("destroyRibbonComponents",this.destroy),this.parent.on(spreadsheetDestroyed,this.destroy,this)},e}(),Ribbon$$1=function(){function e(e){this.border="1px solid #000000",this.fontNameIndex=5,this.numPopupWidth=0,this.findValue="",this.preTabIdx=1,this.chartThemeIndex=5,this.parent=e,this.addEventListener(),this.initDefaultFormats(),new ColorPicker$1(e)}return e.prototype.getModuleName=function(){return"ribbon"},e.prototype.initRibbon=function(e){this.parent.showRibbon||!this.ribbon?(this.parent.notify(beforeRibbonCreate,{}),this.parent.isMobileView()?this.createMobileView():this.createRibbon(e)):this.destroy()},e.prototype.getRibbonMenuItems=function(){var e=this.parent.serviceLocator.getService(locale),t=this.parent.element.id;return[{text:this.parent.isMobileView()?"":e.getConstant("File"),iconCss:this.parent.isMobileView()?"e-icons e-file-menu-icon":null,id:t+"_File",items:[{text:e.getConstant("New"),id:t+"_New",iconCss:"e-new e-icons"},{text:e.getConstant("Open"),id:t+"_Open",iconCss:"e-open e-icons"},{text:e.getConstant("SaveAs"),iconCss:"e-save e-icons",id:t+"_Save_As",items:[{text:e.getConstant("ExcelXlsx"),id:t+"_Xlsx",iconCss:"e-xlsx e-icons"},{text:e.getConstant("ExcelXls"),id:t+"_Xls",iconCss:"e-xls e-icons"},{text:e.getConstant("CSV"),id:t+"_Csv",iconCss:"e-csv e-icons"},{text:e.getConstant("PDF"),id:t+"_Pdf",iconCss:"e-pdf e-icons"}]}]}]},e.prototype.getRibbonItems=function(){var e=this,t=this.parent.element.id,r=this.parent.serviceLocator.getService(locale),n=[{header:{text:r.getConstant("Home")},content:[{prefixIcon:"e-undo-icon",tooltipText:r.getConstant("Undo")+" (Ctrl+Z)",id:t+"_undo",disabled:!0},{prefixIcon:"e-redo-icon",tooltipText:r.getConstant("Redo")+" (Ctrl+Y)",id:t+"_redo",disabled:!0},{type:"Separator",id:t+"_separator_1"},{prefixIcon:"e-cut-icon",tooltipText:r.getConstant("Cut")+" (Ctrl+X)",id:t+"_cut"},{prefixIcon:"e-copy-icon",tooltipText:r.getConstant("Copy")+" (Ctrl+C)",id:t+"_copy"},{tooltipText:r.getConstant("Paste")+" (Ctrl+V)",template:this.getPasteBtn(t),id:t+"_paste",disabled:!0},{type:"Separator",id:t+"_separator_2"},{template:this.getNumFormatDDB(t),tooltipText:r.getConstant("NumberFormat"),id:t+"_number_format"},{type:"Separator",id:t+"_separator_3"},{template:this.getFontNameDDB(t),tooltipText:r.getConstant("Font"),id:t+"_font_name"},{type:"Separator",id:t+"_separator_4"},{template:this.getFontSizeDDB(t),tooltipText:r.getConstant("FontSize"),id:t+"_font_size"},{type:"Separator",id:t+"_separator_5"},{template:this.getBtn(t,"bold"),tooltipText:r.getConstant("Bold")+" (Ctrl+B)",id:t+"_bold"},{template:this.getBtn(t,"italic"),tooltipText:r.getConstant("Italic")+" (Ctrl+I)",id:t+"_italic"},{template:this.getBtn(t,"line-through"),tooltipText:r.getConstant("Strikethrough")+" (Ctrl+5)",id:t+"_line-through"},{template:this.getBtn(t,"underline"),tooltipText:r.getConstant("Underline")+" (Ctrl+U)",id:t+"_underline"},{template:document.getElementById(t+"_font_color_picker"),tooltipText:r.getConstant("TextColor"),id:t+"_font_color_picker"},{type:"Separator",id:t+"_separator_6"},{template:document.getElementById(t+"_fill_color_picker"),tooltipText:r.getConstant("FillColor"),id:t+"_fill_color_picker"},{template:this.getBordersDBB(t),tooltipText:r.getConstant("Borders"),id:t+"_borders"},{template:this.getMergeSplitBtn(t),tooltipText:r.getConstant("MergeCells"),id:t+"_merge_cells",disabled:!0},{type:"Separator",id:t+"_separator_7"},{template:this.getTextAlignDDB(t),tooltipText:r.getConstant("HorizontalAlignment"),id:t+"_text_align"},{template:this.getVerticalAlignDDB(t),tooltipText:r.getConstant("VerticalAlignment"),id:t+"_vertical_align"},{template:this.getBtn(t,"wrap",!1),tooltipText:""+r.getConstant("WrapText"),id:t+"_wrap"}]},{header:{text:r.getConstant("Insert")},content:[{prefixIcon:"e-hyperlink-icon",text:r.getConstant("Link"),id:t+"_hyperlink",tooltipText:r.getConstant("Link"),click:function(){e.getHyperlinkDlg()}},{prefixIcon:"e-image-icon",text:r.getConstant("Image"),id:t+"_image",tooltipText:r.getConstant("Image"),click:function(){ej2Base.select("#"+t+"_imageUpload",e.parent.element).click()}}]},{header:{text:r.getConstant("Formulas")},content:[{prefixIcon:"e-insert-function",tooltipText:r.getConstant("InsertFunction"),text:r.getConstant("InsertFunction"),id:t+"_insert_function"}]},{header:{text:r.getConstant("Data")},content:[{prefixIcon:"e-protect-icon",text:r.getConstant("ProtectSheet"),id:t+"_protect",tooltipText:r.getConstant("ProtectSheet")},{prefixIcon:"e-password-protect-icon",text:r.getConstant("ProtectWorkbook"),id:t+"_protectworkbook",tooltipText:r.getConstant("ProtectWorkbook")},{type:"Separator",id:t+"_separator_8"},{template:this.datavalidationDDB(t),tooltipText:r.getConstant("DataValidation"),id:t+"_datavalidation"}]},{header:{text:r.getConstant("View")},content:[{prefixIcon:"e-hide-headers",text:this.getLocaleText("Headers"),id:t+"_headers",tooltipText:this.getLocaleText("Headers")},{type:"Separator",id:t+"_separator_9"},{prefixIcon:"e-hide-gridlines",text:this.getLocaleText("GridLines"),id:t+"_gridlines",tooltipText:this.getLocaleText("GridLines")},{type:"Separator",id:t+"_separator_13"},{prefixIcon:"e-freeze-pane",text:r.getConstant("FreezePanes"),id:t+"_freezepanes",tooltipText:r.getConstant("FreezePanes")},{prefixIcon:"e-freeze-row",text:r.getConstant("FreezeRows"),id:t+"_freezerows",tooltipText:r.getConstant("FreezeRows")},{prefixIcon:"e-freeze-column",text:r.getConstant("FreezeColumns"),id:t+"_freezecolumns",tooltipText:r.getConstant("FreezeColumns")}]}];return this.parent.allowConditionalFormat&&n.find(function(e){return e.header&&e.header.text===r.getConstant("Home")}).content.push({type:"Separator",id:t+"_separator_10"},{template:this.getCFDBB(t),tooltipText:r.getConstant("ConditionalFormatting"),id:t+"_conditionalformatting"}),this.parent.allowChart&&n.find(function(e){return e.header&&e.header.text===r.getConstant("Insert")}).content.push({type:"Separator",id:t+"_separator_11"},{template:this.getChartDDB(t,!0),text:r.getConstant("Chart"),tooltipText:r.getConstant("Chart"),id:t+"_chart"}),this.parent.allowCellFormatting&&n.find(function(e){return e.header&&e.header.text===r.getConstant("Home")}).content.push({type:"Separator",id:t+"_separator_12"},{template:this.getClearDDB(t),tooltipText:r.getConstant("Clear"),id:t+"_clear"}),(this.parent.allowSorting||this.parent.allowFiltering)&&n.find(function(e){return e.header&&e.header.text===r.getConstant("Home")}).content.push({template:this.getSortFilterDDB(t),tooltipText:r.getConstant("SortAndFilter"),id:t+"_sorting"}),this.parent.allowFindAndReplace&&n.find(function(e){return e.header&&e.header.text===r.getConstant("Home")}).content.push({template:this.getFindBtn(t),prefixIcon:"e-tbar-search-icon tb-icons",tooltipText:r.getConstant("FindReplaceTooltip"),id:t+"_find"}),n},e.prototype.getPasteBtn=function(e){var t=this,r=this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_paste"})),n=this.parent.serviceLocator.getService(locale);return this.pasteSplitBtn=new ej2Splitbuttons.SplitButton({iconCss:"e-icons e-paste-icon",items:[{text:n.getConstant("All"),id:"All"},{text:n.getConstant("Values"),id:"Values"},{text:n.getConstant("Formats"),id:"Formats"}],createPopupOnClick:!0,select:function(e){t.parent.notify(paste,{type:e.item.id,isAction:!0,isInternal:!0})},click:function(){t.parent.notify(paste,{isAction:!0,isInternal:!0})},close:function(){focus(t.parent.element)}}),this.pasteSplitBtn.createElement=this.parent.createElement,this.pasteSplitBtn.appendTo(r),r.parentElement},e.prototype.getHyperlinkDlg=function(){var e,t=getRangeIndexes(this.parent.getActiveSheet().activeCell),r=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[t[0]];ej2Base.isNullOrUndefined(r)||(e=r.cells[t[1]]),ej2Base.isNullOrUndefined(e)&&setCell(t[0],t[1],this.parent.getActiveSheet(),e,!1),e&&e.hyperlink?this.parent.notify(editHyperlink,null):this.parent.notify(initiateHyperlink,null)},e.prototype.passwordProtectDlg=function(){this.parent.password.length>0?this.parent.notify(unProtectWorkbook,null):document.getElementById(this.parent.element.id+"_protectworkbook").classList.contains("e-active")?(document.getElementById(this.parent.element.id+"_protectworkbook").classList.remove("e-active"),this.parent.showSheetTabs&&this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled")):this.parent.notify(protectWorkbook,null)},e.prototype.getLocaleText=function(e,t){var r,n=this.parent.serviceLocator.getService(locale);return this.parent.getActiveSheet()["show"+e]?(t&&document.getElementById(this.parent.element.id+"_sheet").classList.remove("e-hide-"+e.toLowerCase()),r=n.getConstant("Hide"+e)):(t&&document.getElementById(this.parent.element.id+"_sheet").classList.add("e-hide-"+e.toLowerCase()),r=n.getConstant("Show"+e)),r},e.prototype.getLocaleProtectText=function(e,t){var r,n=this.parent.serviceLocator.getService(locale);return this.parent.getActiveSheet().isProtected?(t&&this.parent.getMainContent().classList.remove("e-hide-"+e.toLowerCase()),r=n.getConstant("Unprotect"+e)):(t&&this.parent.getMainContent().classList.add("e-hide-"+e.toLowerCase()),r=n.getConstant("Protect"+e)),r},e.prototype.getLocaleProtectWorkbook=function(e,t){var r,n=this.parent.serviceLocator.getService(locale);return this.parent.isProtected?(t&&this.parent.getMainContent().classList.remove("e-hide-"+e.toLowerCase()),r=n.getConstant(e)):(t&&this.parent.getMainContent().classList.add("e-hide-"+e.toLowerCase()),r=n.getConstant(e)),r},e.prototype.insertDesignChart=function(){var e=this,t=this.parent.serviceLocator.getService(locale),r=this.ribbon.items.length-1;if(this.preTabIdx=this.ribbon.selectedTab,this.parent.allowChart&&this.ribbon.items[r]&&this.ribbon.items[r].header.text!==t.getConstant("ChartDesign")){var n=this.parent.element.id,i=[{header:{text:t.getConstant("ChartDesign")},content:[{template:this.getAddChartEleDBB(n),tooltipText:t.getConstant("AddChartElement"),id:n+"add_chart_ element_chart"},{type:"Separator"},{prefixIcon:"e-switch-row-column-icon",text:t.getConstant("SwitchRowColumn"),tooltipText:t.getConstant("SwitchRowColumn"),id:n+"switch_row_column_chart",click:function(){e.parent.notify(chartDesignTab,{switchRowColumn:!0})}},{type:"Separator"},{template:this.getChartThemeDDB(n),tooltipText:t.getConstant("ChartTheme"),id:n+"_chart_theme"},{type:"Separator"},{template:this.getChartDDB(n,!1),tooltipText:t.getConstant("ChartType"),id:n+"_chart_type"}]}];this.parent.addRibbonTabs(i),r=this.ribbon.items.length,this.ribbon.tabObj.select(r)}},e.prototype.removeDesignChart=function(){var e=this.parent.serviceLocator.getService(locale),t=this.ribbon.items.length-1;this.parent.allowChart&&this.ribbon.items[t]&&this.ribbon.items[t].header.text===e.getConstant("ChartDesign")&&(this.ribbon.tabObj.select(this.preTabIdx+1),this.parent.hideRibbonTabs([e.getConstant("ChartDesign")],!0),document.getElementsByClassName("e-addchart-ddb").length>0&&document.getElementsByClassName("e-addchart-ddb")[0].remove(),document.getElementsByClassName("e-chart-type-ddb").length>0&&document.getElementsByClassName("e-chart-type-ddb")[0].remove(),document.getElementsByClassName("e-charttheme-ddb").length>0&&document.getElementsByClassName("e-charttheme-ddb")[0].remove(),delete this.ribbon.items[t].content[0],this.ribbon.items.length=this.ribbon.items.length-1)},e.prototype.createRibbon=function(e){var t=this.parent.createElement("div",{id:this.parent.element.id+"_ribbon"});if(this.ribbon=new Ribbon$1({selectedTab:0,menuItems:this.getRibbonMenuItems(),items:this.getRibbonItems(),fileMenuItemSelect:this.fileMenuItemSelect.bind(this),beforeOpen:this.fileMenuBeforeOpen.bind(this),beforeClose:this.fileMenuBeforeClose.bind(this),clicked:this.toolbarClicked.bind(this),created:this.ribbonCreated.bind(this),selecting:this.tabSelecting.bind(this),expandCollapse:this.expandCollapseHandler.bind(this),beforeFileMenuItemRender:this.beforeRenderHandler.bind(this)}),this.ribbon.createElement=this.parent.createElement,e&&e.uiUpdate){var r=this.parent.element.querySelector(".e-formula-bar-panel")||document.getElementById(this.parent.element.id+"_sheet_panel");this.parent.element.insertBefore(t,r)}else this.parent.element.appendChild(t);this.ribbon.appendTo(t)},e.prototype.tabSelecting=function(e){if(e.selectingIndex!==this.ribbon.selectedTab){if(this.parent.allowChart){var t=this.parent.serviceLocator.getService(locale);if(this.ribbon.items[e.selectingIndex]&&this.ribbon.items[e.selectingIndex].header.text===t.getConstant("Insert")&&this.createChartDdb(document.getElementById(this.parent.element.id+"_chart-btn"),!0),this.ribbon.items[e.selectedIndex]&&this.ribbon.items[e.selectedIndex].header.text===t.getConstant("Insert"))for(var r=this.ribbon.items[e.selectedIndex].content,n=r.length-1;n>=0;n--)if(r[n].id===this.parent.element.id+"_chart"){var i=r[n].template;i&&i.classList.contains("e-dropdown-btn")&&this.destroyComponent(i,"dropdown-btn");break}}this.refreshRibbonContent(e.selectingIndex),this.parent.notify(tabSwitch,{activeTab:e.selectingIndex})}},e.prototype.beforeRenderHandler=function(e){var t=this.parent.serviceLocator.getService(locale);e.item.text!==t.getConstant("Open")||this.parent.openUrl&&this.parent.allowOpen||e.element.classList.add("e-disabled"),e.item.text!==t.getConstant("SaveAs")||this.parent.saveUrl&&this.parent.allowSave||e.element.classList.add("e-disabled")},e.prototype.getChartThemeDDB=function(e){var t=this,r=this.parent.createElement("button",{id:e+"_chart_theme"});return r.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"Material"})),this.chartThemeDDB=new ej2Splitbuttons.DropDownButton({items:this.getChartThemeDdbItems(),createPopupOnClick:!0,select:function(e){return t.chartThemeDDBSelect(e)},close:function(){return t.parent.element.focus()},cssClass:"e-flat e-charttheme-ddb",beforeOpen:function(e){return t.tBarDdbBeforeOpen(e.element,e.items)}}),this.chartThemeDDB.createElement=this.parent.createElement,this.chartThemeDDB.appendTo(r),r},e.prototype.getNumFormatDDB=function(e){var t=this,r=this.parent.createElement("button",{id:e+"_number_format"});return r.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"General"})),this.numFormatDDB=new ej2Splitbuttons.DropDownButton({items:this.getNumFormatDdbItems(e),createPopupOnClick:!0,select:function(e){return t.numDDBSelect(e)},open:function(e){return t.numDDBOpen(e)},beforeItemRender:function(e){return t.previewNumFormat(e)},close:function(){return focus(t.parent.element)},cssClass:"e-flat e-numformat-ddb",beforeOpen:function(e){return t.tBarDdbBeforeOpen(e.element,e.items)}}),this.numFormatDDB.createElement=this.parent.createElement,this.numFormatDDB.appendTo(r),r},e.prototype.getFontSizeDDB=function(e){var t=this;return this.fontSizeDdb=new ej2Splitbuttons.DropDownButton({cssClass:"e-font-size-ddb",content:"11",createPopupOnClick:!0,items:[{text:"8"},{text:"9"},{text:"10"},{text:"11"},{text:"12"},{text:"14"},{text:"16"},{text:"18"},{text:"20"},{text:"22"},{text:"24"},{text:"26"},{text:"28"},{text:"36"},{text:"48"},{text:"72"}],beforeOpen:function(e){t.tBarDdbBeforeOpen(e.element,e.items),t.refreshSelected(t.fontSizeDdb,e.element,"content","text")},select:function(e){var r={style:{fontSize:e.item.text+"pt"},onActionUpdate:!0};t.parent.notify(setCellFormat,r),r.cancel||(t.fontSizeDdb.content=r.style.fontSize.split("pt")[0],t.fontSizeDdb.dataBind())},close:function(){return focus(t.parent.element)}}),this.fontSizeDdb.createElement=this.parent.createElement,this.fontSizeDdb.appendTo(this.parent.createElement("button",{id:e+"_font_size"})),this.fontSizeDdb.element},e.prototype.getChartDDB=function(e,t){var r,n=this.parent.serviceLocator.getService(locale);return t?(r=this.parent.createElement("button",{id:e+"_chart-btn"})).appendChild(this.parent.createElement("span",{id:e+"_chart",innerHTML:n.getConstant("Chart")})):((r=this.parent.createElement("button",{id:e+"_chart-type-btn"})).appendChild(this.parent.createElement("span",{id:e+"_chart_type",innerHTML:n.getConstant("ChartType")})),this.createChartDdb(r,!1)),r},e.prototype.createChartDdb=function(e,t){var r,n=this,i=this.parent.serviceLocator.getService(locale),o=t?"e-chart-menu":"e-chart-type-menu",a=this.parent.createElement("ul",{id:this.parent.element.id+(t?"_chart_menu":"_chart_type_menu")}),s=new ej2Splitbuttons.DropDownButton({iconCss:"e-icons "+(t?"e-chart-icon":"e-chart-type-icon"),cssClass:t?"e-chart-ddb":"e-chart-type-ddb",target:a,createPopupOnClick:!0,beforeOpen:function(e){r=n.createChartMenu(a,o,i,s),n.tBarDdbBeforeOpen(e.element,r.items)},beforeClose:function(e){e.event&&ej2Base.closest(e.event.target,"."+o)?e.cancel=!0:r.destroy()},close:function(){return focus(n.parent.element)}});s.createElement=this.parent.createElement,s.appendTo(e)},e.prototype.createChartMenu=function(e,t,r,n){var i=this,o=new ej2Navigations.Menu({cssClass:t,items:[{iconCss:"e-icons e-column",text:r.getConstant("Column"),items:[{id:"column_chart"}]},{iconCss:"e-icons e-bar",text:r.getConstant("Bar"),items:[{id:"bar_chart"}]},{iconCss:"e-icons e-area",text:r.getConstant("Area"),items:[{id:"area_chart"}]},{iconCss:"e-icons e-pie-doughnut",text:r.getConstant("PieAndDoughnut"),items:[{id:"pie_doughnut_chart"}]},{iconCss:"e-icons e-line",text:r.getConstant("Line"),items:[{id:"line_chart"}]},{iconCss:"e-icons e-scatter",text:r.getConstant("Scatter"),items:[{id:"scatter_chart"}]}],orientation:"Vertical",beforeOpen:function(e){e.parentItem.text===r.getConstant("Column")?(e.element.firstChild.appendChild(a),e.element.parentElement.classList.add("e-column-chart")):e.parentItem.text===r.getConstant("Bar")?(e.element.firstChild.appendChild(m),e.element.parentElement.classList.add("e-bar-chart")):e.parentItem.text===r.getConstant("Area")?(e.element.firstChild.appendChild(E),e.element.parentElement.classList.add("e-area-chart")):e.parentItem.text===r.getConstant("Line")?(e.element.firstChild.appendChild(D),e.element.parentElement.classList.add("e-line-chart")):e.parentItem.text===r.getConstant("PieAndDoughnut")?(e.element.firstChild.appendChild(M),e.element.parentElement.classList.add("e-pie-doughnut-chart")):e.parentItem.text===r.getConstant("Radar")?(e.element.firstChild.appendChild(z),e.element.parentElement.classList.add("e-radar-chart")):e.parentItem.text===r.getConstant("Scatter")&&(e.element.firstChild.appendChild(Y),e.element.parentElement.classList.add("e-scatter-chart"))},select:function(e){return i.chartSelected(e,n)}}),a=this.parent.createElement("div",{id:"column_main",className:"e-column-main"}),s=this.parent.createElement("div",{id:"column1_text",className:"e-column1-text",innerHTML:r.getConstant("Column")}),l=this.parent.createElement("div",{id:"column1_cont",className:"e-column1-cont"}),d=this.parent.createElement("div",{id:"column2_cont",className:"e-column2-cont"});a.appendChild(s),a.appendChild(l);var p=this.parent.createElement("span",{id:"clusteredColumn",className:"e-clusteredcolumn e-column-icon e-menu-icon e-icons"}),h=this.parent.createElement("span",{id:"stackedColumn",className:"e-stackedcolumn e-column-icon e-menu-icon e-icons"}),c=this.parent.createElement("span",{id:"stackedColumn100",className:"e-stackedcolumn100 e-column-icon e-menu-icon e-icons"}),u=this.parent.createElement("span",{id:"clusteredColumn3D",className:"e-clusteredColumn3D e-column-icon"}),g=this.parent.createElement("span",{id:"stackedColumn3D",className:"e-stackedColumn3D e-column-icon"}),f=this.parent.createElement("span",{id:"stackedColumn1003D",className:"e-stackedColumn1003D e-column-icon"});p.title=r.getConstant("ClusteredColumn"),h.title=r.getConstant("StackedColumn"),c.title=r.getConstant("StackedColumn100"),f.title=r.getConstant("OrangeDataBar"),g.title=r.getConstant("LightblueDataBar"),u.title=r.getConstant("PurpleDataBar"),l.appendChild(p),l.appendChild(h),l.appendChild(c),d.appendChild(u),d.appendChild(g),d.appendChild(f);var m=this.parent.createElement("div",{id:"bar_main",className:"e-bar-main"}),v=this.parent.createElement("div",{id:"bar1_text",className:"e-bar1-text",innerHTML:r.getConstant("Bar")}),C=this.parent.createElement("div",{id:"bar1_cont",className:"e-bar1-cont"}),y=this.parent.createElement("div",{id:"bar2_cont",className:"e-bar2-cont"});m.appendChild(v),m.appendChild(C);var x=this.parent.createElement("span",{id:"clusteredBar",className:"e-clusteredbar e-bar-icon e-menu-icon e-icons"}),b=this.parent.createElement("span",{id:"stackedBar",className:"e-stackedbar e-bar-icon e-menu-icon e-icons"}),S=this.parent.createElement("span",{id:"stackedBar100",className:"e-stackedbar100 e-bar-icon e-menu-icon e-icons"}),w=this.parent.createElement("span",{id:"clusteredBar3D",className:"e-clusteredBar3D e-bar-icon"}),I=this.parent.createElement("span",{id:"stackedBar3D",className:"e-stackedBar3D e-bar-icon"}),R=this.parent.createElement("span",{id:"stackedBar1003D",className:"e-stackedBar1003D e-bar-icon"});x.title=r.getConstant("ClusteredBar"),b.title=r.getConstant("StackedBar"),S.title=r.getConstant("StackedBar100"),R.title=r.getConstant("OrangeDataBar"),I.title=r.getConstant("LightblueDataBar"),w.title=r.getConstant("PurpleDataBar"),C.appendChild(x),C.appendChild(b),C.appendChild(S),y.appendChild(w),y.appendChild(I),y.appendChild(R);var E=this.parent.createElement("div",{id:"area_main",className:"e-area-main"}),k=this.parent.createElement("div",{id:"area_text",className:"e-area-text",innerHTML:r.getConstant("Area")}),F=this.parent.createElement("div",{id:"area_cont",className:"e-area-cont"});E.appendChild(k),E.appendChild(F);var A=this.parent.createElement("span",{id:"area",className:"e-area e-area-icon e-menu-icon e-icons"}),B=this.parent.createElement("span",{id:"stackedArea",className:"e-stackedarea e-area-icon e-menu-icon e-icons"}),T=this.parent.createElement("span",{id:"stackedArea100",className:"e-stackedarea100 e-area-icon e-menu-icon e-icons"});A.title=r.getConstant("Area"),B.title=r.getConstant("StackedArea"),T.title=r.getConstant("StackedArea100"),F.appendChild(A),F.appendChild(B),F.appendChild(T);var D=this.parent.createElement("div",{id:"line_main",className:"e-line-main"}),N=this.parent.createElement("div",{id:"line_text",className:"e-line-text",innerHTML:r.getConstant("Line")}),O=this.parent.createElement("div",{id:"line_cont",className:"e-line-cont"});D.appendChild(N),D.appendChild(O);var L=this.parent.createElement("span",{id:"line",className:"e-line e-line-icon e-menu-icon e-icons"}),H=this.parent.createElement("span",{id:"stackedLine",className:"e-stackedline e-line-icon e-menu-icon e-icons"}),j=this.parent.createElement("span",{id:"stackedline100",className:"e-stackedline100 e-line-icon e-menu-icon e-icons"});L.title=r.getConstant("Line"),H.title=r.getConstant("StackedLine"),j.title=r.getConstant("StackedLine100"),O.appendChild(L),O.appendChild(H),O.appendChild(j);var M=this.parent.createElement("div",{id:"pie_main",className:"e-pie-main"}),_=this.parent.createElement("div",{id:"pie_text",className:"e-pie-text",innerHTML:r.getConstant("Pie")}),P=this.parent.createElement("div",{id:"pie_cont",className:"e-pie-cont"});M.appendChild(_),M.appendChild(P);var U=this.parent.createElement("span",{id:"pie",className:"e-pie e-pie-icon e-menu-icon e-icons"}),V=this.parent.createElement("span",{id:"doughnut",className:"e-doughnut e-pie-icon e-menu-icon e-icons"});U.title=r.getConstant("Pie"),V.title=r.getConstant("Doughnut"),P.appendChild(U),P.appendChild(V);var z=this.parent.createElement("div",{id:"radar_main",className:"e-radar-main"}),q=this.parent.createElement("div",{id:"radar_text",className:"e-radar-text",innerHTML:"Radar"}),W=this.parent.createElement("div",{id:"radar_cont",className:"e-radar-cont"});z.appendChild(q),z.appendChild(W);var G=this.parent.createElement("span",{id:"radar",className:"e-radar e-radar-icon e-menu-icon e-icons"}),$=this.parent.createElement("span",{id:"radar_markers",className:"e-radar-markers e-radar-icon e-menu-icon e-icons"});G.title=r.getConstant("BlueDataBar"),$.title=r.getConstant("GreenDataBar"),W.appendChild(G),W.appendChild($);var Y=this.parent.createElement("div",{id:"scatter_main",className:"e-scatter-main"}),X=this.parent.createElement("div",{id:"scatter_text",className:"e-scatter-text",innerHTML:r.getConstant("Scatter")}),K=this.parent.createElement("div",{id:"scatter_cont",className:"e-scatter-cont"});Y.appendChild(X),Y.appendChild(K);var Z=this.parent.createElement("span",{id:"scatter",className:"e-scatter e-scatter-icon e-menu-icon e-icons"});return Z.title=r.getConstant("Scatter"),K.appendChild(Z),o.createElement=this.parent.createElement,o.appendTo(e),e.classList.add("e-ul"),o},e.prototype.getAddChartEleDBB=function(e){var t,r=this,n=this.parent.serviceLocator.getService(locale),i=this.parent.createElement("ul",{id:e+"_add_chart_menu"});this.addChartDdb=new ej2Splitbuttons.DropDownButton({iconCss:"e-icons e-addchart-icon",cssClass:"e-addchart-ddb",target:i,createPopupOnClick:!0,close:function(){return focus(r.parent.element)},beforeOpen:function(e){t=r.createAddChartMenu(i,n),r.tBarDdbBeforeOpen(e.element,t.items)},beforeClose:function(e){e.event&&ej2Base.closest(e.event.target,".e-addchart-menu")?e.cancel=!0:t.destroy()}}),this.addChartDdb.createElement=this.parent.createElement;var o=this.parent.createElement("button",{id:e+"_addchart"});return o.appendChild(this.parent.createElement("span",{id:e+"_chart",innerHTML:n.getConstant("AddChartElement")})),this.addChartDdb.appendTo(o),this.addChartDdb.element},e.prototype.createAddChartMenu=function(e,t){var r=new ej2Navigations.Menu({cssClass:"e-addchart-menu",title:t.getConstant("AddChartElement"),items:[{iconCss:"e-icons e-axes",text:t.getConstant("Axes"),items:[{iconCss:"e-icons e-ph-axes",id:"PHAxes",text:t.getConstant("PrimaryHorizontal")},{iconCss:"e-icons e-pv-axes",id:"PVAxes",text:t.getConstant("PrimaryVertical")}]},{iconCss:"e-icons e-axis-title",text:t.getConstant("AxisTitle"),items:[{iconCss:"e-icons e-ph-axistitle",id:"PHAxisTitle",text:t.getConstant("PrimaryHorizontal")},{iconCss:"e-icons e-pv-axistitle",id:"PVAxisTitle",text:t.getConstant("PrimaryVertical")}]},{iconCss:"e-icons e-chart-title",text:t.getConstant("ChartTitle"),items:[{iconCss:"e-icons e-ct-none",id:"ChartTitleNone",text:t.getConstant("None")},{iconCss:"e-icons e-ct-abovechart",id:"ChartTitleAbove",text:t.getConstant("AboveChart")}]},{iconCss:"e-icons e-data-labels",text:t.getConstant("DataLabels"),items:[{iconCss:"e-icons e-dl-none",id:"DLNone",text:t.getConstant("None")},{iconCss:"e-icons e-dl-center",id:"DLCenter",text:t.getConstant("Center")},{iconCss:"e-icons e-dl-insideend",id:"DLInsideend",text:t.getConstant("InsideEnd")},{iconCss:"e-icons e-dl-insidebase",id:"DLInsidebase",text:t.getConstant("InsideBase")},{iconCss:"e-icons e-dl-outsideend",id:"DLOutsideend",text:t.getConstant("OutsideEnd")}]},{iconCss:"e-icons e-gridlines",text:t.getConstant("Gridlines"),items:[{iconCss:"e-icons e-gl-major-horizontal",id:"GLMajorHorizontal",text:t.getConstant("PrimaryMajorHorizontal")},{iconCss:"e-icons e-gl-major-vertical",id:"GLMajorVertical",text:t.getConstant("PrimaryMajorVertical")},{iconCss:"e-icons e-gl-minor-horizontal",id:"GLMinorHorizontal",text:t.getConstant("PrimaryMinorHorizontal")},{iconCss:"e-icons e-gl-minor-vertical",id:"GLMinorVertical",text:t.getConstant("PrimaryMinorVertical")}]},{iconCss:"e-icons e-legends",text:t.getConstant("Legends"),items:[{iconCss:"e-icons e-legends-none",id:"LegendNone",text:t.getConstant("None")},{iconCss:"e-icons e-legends-right",id:"LegendsRight",text:t.getConstant("Right")},{iconCss:"e-icons e-legends-left",id:"LegendsLeft",text:t.getConstant("Left")},{iconCss:"e-icons e-legends-bottom",id:"LegendsBottom",text:t.getConstant("Bottom")},{iconCss:"e-icons e-legends-top",id:"LegendsTop",text:t.getConstant("Top")}]}],orientation:"Vertical",select:this.addChartEleSelected.bind(this)});return r.createElement=this.parent.createElement,r.appendTo(e),e.classList.add("e-ul"),r},e.prototype.getCFDBB=function(e){var t,r=this,n=this.parent.createElement("ul",{id:e+"_cf_menu"});return this.cFDdb=new ej2Splitbuttons.DropDownButton({iconCss:"e-icons e-conditionalformatting-icon",cssClass:"e-cf-ddb",target:n,createPopupOnClick:!0,close:function(){return focus(r.parent.element)},beforeOpen:function(e){t=r.createCFMenu(n),r.tBarDdbBeforeOpen(e.element,t.items)},beforeClose:function(e){e.event&&ej2Base.closest(e.event.target,".e-cf-menu")?e.cancel=!0:t.destroy()}}),this.cFDdb.createElement=this.parent.createElement,this.cFDdb.appendTo(this.parent.createElement("button",{id:e+"_conditionalformatting"})),this.cFDdb.element},e.prototype.createCFMenu=function(e){var t=this.parent.serviceLocator.getService(locale),r=new ej2Navigations.Menu({cssClass:"e-cf-menu",items:[{iconCss:"e-icons e-hlcellrules",text:t.getConstant("HighlightCellsRules"),items:[{iconCss:"e-icons e-greaterthan",id:"cf_greaterthan",text:t.getConstant("GreaterThan")+"..."},{iconCss:"e-icons e-lessthan",id:"cf_lessthan",text:t.getConstant("LessThan")+"..."},{iconCss:"e-icons e-between",id:"cf_between",text:t.getConstant("Between")+"..."},{iconCss:"e-icons e-equalto",id:"cf_eqaulto",text:t.getConstant("CFEqualTo")+"..."},{iconCss:"e-icons e-textcontains",id:"cf_textthatcontains",text:t.getConstant("TextThatContains")+"..."},{iconCss:"e-icons e-adateoccuring",id:"cf_adateoccuring",text:t.getConstant("ADateOccuring")+"..."},{iconCss:"e-icons e-duplicate",id:"cf_duplicatevalues",text:t.getConstant("DuplicateValues")+"..."}]},{iconCss:"e-icons e-topbottomrules",text:t.getConstant("TopBottomRules"),items:[{iconCss:"e-icons e-top10items",id:"cf_top10items",text:t.getConstant("Top10Items")+"..."},{iconCss:"e-icons e-top10",id:"cf_top10",text:t.getConstant("Top10")+" %..."},{iconCss:"e-icons e-bottom10items",id:"cf_bottom10items",text:t.getConstant("Bottom10Items")+"..."},{iconCss:"e-icons e-bottom10",id:"cf_bottom10",text:t.getConstant("Bottom10")+" %..."},{iconCss:"e-icons e-aboveaverage",id:"cf_aboveaverage",text:t.getConstant("AboveAverage")+"..."},{iconCss:"e-icons e-belowaverage",id:"cf_belowaverage",text:t.getConstant("BelowAverage")+"..."}]},{iconCss:"e-icons e-databars",text:t.getConstant("DataBars"),items:[{id:"cf_databars"}]},{iconCss:"e-icons e-colorscales",text:t.getConstant("ColorScales"),items:[{id:"cf_colorscales"}]},{iconCss:"e-icons e-iconsets",text:t.getConstant("IconSets"),items:[{id:"cf_iconsets"}]},{iconCss:"e-icons e-clearrules",text:t.getConstant("ClearRules"),items:[{id:"cf_cr_cells",text:t.getConstant("SelectedCells")},{id:"cf_cr_sheet",text:t.getConstant("EntireSheet")}]}],orientation:"Vertical",beforeOpen:function(e){e.parentItem.text===t.getConstant("DataBars")?(e.element.firstChild.appendChild(n),e.element.parentElement.classList.add("e-databars")):e.parentItem.text===t.getConstant("ColorScales")?(e.element.firstChild.appendChild(c),e.element.parentElement.classList.add("e-colorscales")):e.parentItem.text===t.getConstant("IconSets")&&(e.element.firstChild.appendChild(F),e.element.parentElement.classList.add("e-iconsets"))},select:this.cFSelected.bind(this)}),n=this.parent.createElement("div",{id:"db",className:"e-db"}),i=this.parent.createElement("div",{id:"db1",className:"e-db1"}),o=this.parent.createElement("div",{id:"db2",className:"e-db2"});n.appendChild(i),n.appendChild(o);var a=this.parent.createElement("span",{id:"BlueDataBar",className:"e-bdatabar e-databar-icon"}),s=this.parent.createElement("span",{id:"GreenDataBar",className:"e-gdatabar e-databar-icon"}),l=this.parent.createElement("span",{id:"RedDataBar",className:"e-rdatabar e-databar-icon"}),d=this.parent.createElement("span",{id:"OrangeDataBar",className:"e-odatabar e-databar-icon"}),p=this.parent.createElement("span",{id:"LightBlueDataBar",className:"e-lbdatabar e-databar-icon"}),h=this.parent.createElement("span",{id:"PurpleDataBar",className:"e-pdatabar e-databar-icon"});a.title=t.getConstant("BlueDataBar"),s.title=t.getConstant("GreenDataBar"),l.title=t.getConstant("RedDataBar"),d.title=t.getConstant("OrangeDataBar"),p.title=t.getConstant("LightblueDataBar"),h.title=t.getConstant("PurpleDataBar"),i.appendChild(a),i.appendChild(s),i.appendChild(l),o.appendChild(d),o.appendChild(p),o.appendChild(h),r.createElement=this.parent.createElement;var c=this.parent.createElement("div",{id:"db",className:"e-cs"}),u=this.parent.createElement("div",{id:"cs1",className:"e-cs1"}),g=this.parent.createElement("div",{id:"cs2",className:"e-cs2"}),f=this.parent.createElement("div",{id:"cs3",className:"e-cs3"});c.appendChild(u),c.appendChild(g),c.appendChild(f);var m=this.parent.createElement("span",{id:"GYRColorScale",className:"e-gyr e-colorscale-icon"}),v=this.parent.createElement("span",{id:"RYGColorScale",className:"e-ryg e-colorscale-icon"}),C=this.parent.createElement("span",{id:"GWRColorScale",className:"e-gwr e-colorscale-icon"}),y=this.parent.createElement("span",{id:"RWGColorScale",className:"e-rwg e-colorscale-icon"}),x=this.parent.createElement("span",{id:"BWRColorScale",className:"e-bwr e-colorscale-icon"}),b=this.parent.createElement("span",{id:"RWBColorScale",className:"e-rwb e-colorscale-icon"}),S=this.parent.createElement("span",{id:"WRColorScale",className:"e-wr e-colorscale-icon"}),w=this.parent.createElement("span",{id:"RWColorScale",className:"e-rw e-colorscale-icon"}),I=this.parent.createElement("span",{id:"GWColorScale",className:"e-gw e-colorscale-icon"}),R=this.parent.createElement("span",{id:"WGColorScale",className:"e-wg e-colorscale-icon"}),E=this.parent.createElement("span",{id:"GYColorScale",className:"e-gy e-colorscale-icon"}),k=this.parent.createElement("span",{id:"YGColorScale",className:"e-yg e-colorscale-icon"});m.title=t.getConstant("GYRColorScale"),v.title=t.getConstant("RYGColorScale"),C.title=t.getConstant("GWRColorScale"),y.title=t.getConstant("RWGColorScale"),x.title=t.getConstant("BWRColorScale"),b.title=t.getConstant("RWBColorScale"),S.title=t.getConstant("WRColorScale"),w.title=t.getConstant("RWColorScale"),I.title=t.getConstant("GWColorScale"),R.title=t.getConstant("WGColorScale"),E.title=t.getConstant("GYColorScale"),k.title=t.getConstant("YGColorScale"),u.appendChild(m),u.appendChild(v),u.appendChild(C),u.appendChild(y),g.appendChild(x),g.appendChild(b),g.appendChild(S),g.appendChild(w),f.appendChild(I),f.appendChild(R),f.appendChild(E),f.appendChild(k);var F=this.parent.createElement("div",{id:"is",className:"e-is"}),A=this.parent.createElement("div",{id:"is1",className:"e-is1",innerHTML:"Directional"}),B=this.parent.createElement("div",{id:"is2",className:"e-is2"}),T=this.parent.createElement("div",{id:"is3",className:"e-is3",innerHTML:"Shapes"}),D=this.parent.createElement("div",{id:"is4",className:"e-is4"}),N=this.parent.createElement("div",{id:"is5",className:"e-is5",innerHTML:"Indicators"}),O=this.parent.createElement("div",{id:"is6",className:"e-is6"}),L=this.parent.createElement("div",{id:"is7",className:"e-is7",innerHTML:"Ratings"}),H=this.parent.createElement("div",{id:"is8",className:"e-is8"});A.title=t.getConstant("GYColorScale"),B.title=t.getConstant("YGColorScale"),T.title=t.getConstant("GYColorScale"),D.title=t.getConstant("YGColorScale"),N.title=t.getConstant("GYColorScale"),O.title=t.getConstant("YGColorScale"),L.title=t.getConstant("GYColorScale"),H.title=t.getConstant("YGColorScale"),F.appendChild(A),F.appendChild(B),F.appendChild(T),F.appendChild(D),F.appendChild(N),F.appendChild(O),F.appendChild(L),F.appendChild(H);var j=this.parent.createElement("div",{id:"ThreeArrows",className:"e-3arrows e-is-wrapper"}),M=this.parent.createElement("div",{id:"ThreeArrowsGray",className:"e-3arrowsgray e-is-wrapper"}),_=this.parent.createElement("div",{id:"ThreeTriangles",className:"e-3triangles e-is-wrapper"}),P=this.parent.createElement("div",{id:"FourArrowsGray",className:"e-4arrowsgray e-is-wrapper"}),U=this.parent.createElement("div",{id:"FourArrows",className:"e-4arrows e-is-wrapper"}),V=this.parent.createElement("div",{id:"FiveArrowsGray",className:"e-5arrowsgray e-is-wrapper"}),z=this.parent.createElement("div",{id:"FiveArrows",className:"e-5arrows e-is-wrapper"});j.title=t.getConstant("ThreeArrowsColor"),M.title=t.getConstant("ThreeArrowsGray"),_.title=t.getConstant("ThreeTriangles"),P.title=t.getConstant("FourArrowsColor"),U.title=t.getConstant("FourArrowsGray"),V.title=t.getConstant("FiveArrowsColor"),z.title=t.getConstant("FiveArrowsGray"),B.appendChild(j),B.appendChild(M),B.appendChild(_),B.appendChild(P),B.appendChild(U),B.appendChild(V),B.appendChild(z);var q=this.parent.createElement("div",{id:"ThreeTrafficLights1",className:"e-3trafficlights e-is-wrapper"}),W=this.parent.createElement("div",{id:"ThreeTrafficLights2",className:"e-3rafficlights2 e-is-wrapper"}),G=this.parent.createElement("div",{id:"ThreeSigns",className:"e-3signs e-is-wrapper"}),$=this.parent.createElement("div",{id:"FourTrafficLights",className:"e-4trafficlights e-is-wrapper"}),Y=this.parent.createElement("div",{id:"FourRedToBlack",className:"e-4redtoblack e-is-wrapper"});q.title=t.getConstant("ThreeTrafficLights1"),W.title=t.getConstant("ThreeTrafficLights2"),G.title=t.getConstant("ThreeSigns"),$.title=t.getConstant("FourTrafficLights"),Y.title=t.getConstant("RedToBlack"),D.appendChild(q),D.appendChild(W),D.appendChild(G),D.appendChild($),D.appendChild(Y);var X=this.parent.createElement("div",{id:"ThreeSymbols",className:"e-3symbols e-is-wrapper"}),K=this.parent.createElement("div",{id:"ThreeSymbols2",className:"e-3symbols2 e-is-wrapper"}),Z=this.parent.createElement("div",{id:"ThreeFlags",className:"e-3flags e-is-wrapper"});X.title=t.getConstant("ThreeSymbols1"),K.title=t.getConstant("ThreeSymbols2"),Z.title=t.getConstant("ThreeFlags"),O.appendChild(X),O.appendChild(K),O.appendChild(Z);var Q=this.parent.createElement("div",{id:"ThreeStars",className:"e-3stars e-is-wrapper"}),J=this.parent.createElement("div",{id:"FourRating",className:"e-4rating e-is-wrapper"}),ee=this.parent.createElement("div",{id:"FiveQuarters",className:"e-5quarters e-is-wrapper"}),te=this.parent.createElement("div",{id:"FiveRating",className:"e-5rating e-is-wrapper"}),re=this.parent.createElement("div",{id:"FiveBoxes",className:"e-5boxes e-is-wrapper"});return Q.title=t.getConstant("ThreeStars"),J.title=t.getConstant("FourRatings"),ee.title=t.getConstant("FiveQuarters"),te.title=t.getConstant("FiveRatings"),re.title=t.getConstant("FiveBoxes"),H.appendChild(Q),H.appendChild(J),H.appendChild(ee),H.appendChild(te),H.appendChild(re),j.appendChild(this.createElement("span","e-3arrows-1 e-iconsetspan")),j.appendChild(this.createElement("span","e-3arrows-2 e-iconsetspan")),j.appendChild(this.createElement("span","e-3arrows-3 e-iconsetspan")),M.appendChild(this.createElement("span","e-3arrowsgray-1 e-iconsetspan")),M.appendChild(this.createElement("span","e-3arrowsgray-2 e-iconsetspan")),M.appendChild(this.createElement("span","e-3arrowsgray-3 e-iconsetspan")),_.appendChild(this.createElement("span","e-3triangles-1 e-iconsetspan")),_.appendChild(this.createElement("span","e-3triangles-2 e-iconsetspan")),_.appendChild(this.createElement("span","e-3triangles-3 e-iconsetspan")),P.appendChild(this.createElement("span","e-4arrowsgray-1 e-iconsetspan")),P.appendChild(this.createElement("span","e-4arrowsgray-2 e-iconsetspan")),P.appendChild(this.createElement("span","e-4arrowsgray-3 e-iconsetspan")),P.appendChild(this.createElement("span","e-4arrowsgray-4 e-iconsetspan")),U.appendChild(this.createElement("span","e-4arrows-1 e-iconsetspan")),U.appendChild(this.createElement("span","e-4arrows-2 e-iconsetspan")),U.appendChild(this.createElement("span","e-4arrows-3 e-iconsetspan")),U.appendChild(this.createElement("span","e-4arrows-4 e-iconsetspan")),V.appendChild(this.createElement("span","e-5arrowsgray-1 e-iconsetspan")),V.appendChild(this.createElement("span","e-5arrowsgray-2 e-iconsetspan")),V.appendChild(this.createElement("span","e-5arrowsgray-3 e-iconsetspan")),V.appendChild(this.createElement("span","e-5arrowsgray-4 e-iconsetspan")),V.appendChild(this.createElement("span","e-5arrowsgray-5 e-iconsetspan")),z.appendChild(this.createElement("span","e-5arrows-1 e-iconsetspan")),z.appendChild(this.createElement("span","e-5arrows-2 e-iconsetspan")),z.appendChild(this.createElement("span","e-5arrows-3 e-iconsetspan")),z.appendChild(this.createElement("span","e-5arrows-4 e-iconsetspan")),z.appendChild(this.createElement("span","e-5arrows-5 e-iconsetspan")),q.appendChild(this.createElement("span","e-3trafficlights-1 e-iconsetspan")),q.appendChild(this.createElement("span","e-3trafficlights-2 e-iconsetspan")),q.appendChild(this.createElement("span","e-3trafficlights-3 e-iconsetspan")),W.appendChild(this.createElement("span","e-3rafficlights2-1 e-iconsetspan")),W.appendChild(this.createElement("span","e-3rafficlights2-2 e-iconsetspan")),W.appendChild(this.createElement("span","e-3rafficlights2-3 e-iconsetspan")),G.appendChild(this.createElement("span","e-3signs-1 e-iconsetspan")),G.appendChild(this.createElement("span","e-3signs-2 e-iconsetspan")),G.appendChild(this.createElement("span","e-3signs-3 e-iconsetspan")),$.appendChild(this.createElement("span","e-4trafficlights-1 e-iconsetspan")),$.appendChild(this.createElement("span","e-4trafficlights-2 e-iconsetspan")),$.appendChild(this.createElement("span","e-4trafficlights-3 e-iconsetspan")),$.appendChild(this.createElement("span","e-4trafficlights-4 e-iconsetspan")),Y.appendChild(this.createElement("span","e-4redtoblack-1 e-iconsetspan")),Y.appendChild(this.createElement("span","e-4redtoblack-2 e-iconsetspan")),Y.appendChild(this.createElement("span","e-4redtoblack-3 e-iconsetspan")),Y.appendChild(this.createElement("span","e-4redtoblack-4 e-iconsetspan")),X.appendChild(this.createElement("span","e-3symbols-1 e-iconsetspan")),X.appendChild(this.createElement("span","e-3symbols-2 e-iconsetspan")),X.appendChild(this.createElement("span","e-3symbols-3 e-iconsetspan")),K.appendChild(this.createElement("span","e-3symbols2-1 e-iconsetspan")),K.appendChild(this.createElement("span","e-3symbols2-2 e-iconsetspan")),K.appendChild(this.createElement("span","e-3symbols2-3 e-iconsetspan")),Z.appendChild(this.createElement("span","e-3flags-1 e-iconsetspan")),Z.appendChild(this.createElement("span","e-3flags-2 e-iconsetspan")),Z.appendChild(this.createElement("span","e-3flags-3 e-iconsetspan")),Q.appendChild(this.createElement("span","e-3stars-1 e-iconsetspan")),Q.appendChild(this.createElement("span","e-3stars-2 e-iconsetspan")),Q.appendChild(this.createElement("span","e-3stars-3 e-iconsetspan")),J.appendChild(this.createElement("span","e-4rating-1 e-iconsetspan")),J.appendChild(this.createElement("span","e-4rating-2 e-iconsetspan")),J.appendChild(this.createElement("span","e-4rating-3 e-iconsetspan")),J.appendChild(this.createElement("span","e-4rating-4 e-iconsetspan")),ee.appendChild(this.createElement("span","e-5quarters-1 e-iconsetspan")),ee.appendChild(this.createElement("span","e-5quarters-2 e-iconsetspan")),ee.appendChild(this.createElement("span","e-5quarters-3 e-iconsetspan")),ee.appendChild(this.createElement("span","e-5quarters-4 e-iconsetspan")),ee.appendChild(this.createElement("span","e-5quarters-5 e-iconsetspan")),te.appendChild(this.createElement("span","e-5rating-1 e-iconsetspan")),te.appendChild(this.createElement("span","e-5rating-2 e-iconsetspan")),te.appendChild(this.createElement("span","e-5rating-3 e-iconsetspan")),te.appendChild(this.createElement("span","e-5rating-4 e-iconsetspan")),te.appendChild(this.createElement("span","e-5rating-5 e-iconsetspan")),re.appendChild(this.createElement("span","e-5boxes-1 e-iconsetspan")),re.appendChild(this.createElement("span","e-5boxes-2 e-iconsetspan")),re.appendChild(this.createElement("span","e-5boxes-3 e-iconsetspan")),re.appendChild(this.createElement("span","e-5boxes-4 e-iconsetspan")),re.appendChild(this.createElement("span","e-5boxes-5 e-iconsetspan")),r.createElement=this.parent.createElement,r.appendTo(e),e.classList.add("e-ul"),r},e.prototype.createElement=function(e,t){return this.parent.createElement(e,{className:t})},e.prototype.getBordersDBB=function(e){var t=this,r=this.parent.createElement("ul",{id:e+"_borders_menu"});this.cPickerEle=this.parent.createElement("input",{id:e+"_cell_border_color",attrs:{type:"color"}}),this.parent.element.appendChild(this.cPickerEle),this.colorPicker=new ej2Inputs.ColorPicker({cssClass:"e-border-colorpicker",mode:"Palette",inline:!0,change:function(e){var r=t.border.split(" ");r[2]=e.currentValue.hex,t.border=r.join(" ")}}),this.colorPicker.createElement=this.parent.createElement,this.colorPicker.appendTo(this.cPickerEle);var n;return this.bordersDdb=new ej2Splitbuttons.DropDownButton({iconCss:"e-icons e-bottom-borders",cssClass:"e-borders-ddb",target:r,createPopupOnClick:!0,beforeOpen:function(e){n=t.createBorderMenu(r),t.tBarDdbBeforeOpen(e.element,n.items,1)},beforeClose:function(e){e.event&&ej2Base.closest(e.event.target,".e-borders-menu")?e.cancel=!0:n.destroy()},close:function(){return focus(t.parent.element)}}),this.bordersDdb.createElement=this.parent.createElement,this.bordersDdb.appendTo(this.parent.createElement("button",{id:e+"_borders"})),this.bordersDdb.element},e.prototype.createBorderMenu=function(e){var t=this,r=this.parent.serviceLocator.getService(locale),n=this.parent.element.id,i=new ej2Navigations.Menu({cssClass:"e-borders-menu",items:[{iconCss:"e-icons e-top-borders",text:r.getConstant("TopBorders")},{iconCss:"e-icons e-left-borders",text:r.getConstant("LeftBorders")},{iconCss:"e-icons e-right-borders",text:r.getConstant("RightBorders")},{iconCss:"e-icons e-bottom-borders",text:r.getConstant("BottomBorders")},{iconCss:"e-icons e-all-borders",text:r.getConstant("AllBorders")},{iconCss:"e-icons e-horizontal-borders",text:r.getConstant("HorizontalBorders")},{iconCss:"e-icons e-vertical-borders",text:r.getConstant("VerticalBorders")},{iconCss:"e-icons e-outside-borders",text:r.getConstant("OutsideBorders")},{iconCss:"e-icons e-inside-borders",text:r.getConstant("InsideBorders")},{iconCss:"e-icons e-no-borders",text:r.getConstant("NoBorders")},{separator:!0},{text:r.getConstant("BorderColor"),items:[{id:n+"_border_colors"}]},{text:r.getConstant("BorderStyle"),items:[{iconCss:"e-icons e-selected-icon",id:n+"_1px"},{id:n+"_2px"},{id:n+"_3px"},{id:n+"_dashed"},{id:n+"_dotted"},{id:n+"_double"}]}],orientation:"Vertical",beforeOpen:function(e){if("Border Color"===e.parentItem.text){t.colorPicker.refresh();var r=t.colorPicker.element.parentElement;e.element.firstElementChild.appendChild(r),r.style.display="inline-block",e.element.parentElement.classList.add("e-border-color")}else e.element.classList.add("e-border-style")},beforeClose:function(e){if("Border Color"===e.parentItem.text)if(!ej2Base.closest(e.event.target,".e-border-colorpicker")||ej2Base.closest(e.event.target,".e-apply")||ej2Base.closest(e.event.target,".e-cancel")){t.colorPicker=ej2Base.getComponent(t.cPickerEle,"colorpicker"),"Picker"===t.colorPicker.mode&&(t.colorPicker.mode="Palette",t.colorPicker.dataBind());var r=t.colorPicker.element.parentElement;r.style.display="",t.parent.element.appendChild(r)}else e.cancel=!0},onOpen:function(e){"Border Color"===e.parentItem.text&&(e.element.parentElement.style.overflow="visible")},select:function(e){return t.borderSelected(e,i)}});return i.createElement=this.parent.createElement,i.appendTo(e),e.classList.add("e-ul"),i},e.prototype.chartSelected=function(e,t){var r=!ej2Base.isNullOrUndefined(ej2Base.closest(e.element,".e-chart-menu")),n=e.element.id;if("column_chartbar_chartarea_chartpie_doughnut_chartline_chartradar_chartscatter_chart".includes(n)){var i=e.event.target.id;this.parent.notify(insertChart,{action:n,id:i,isChart:r})}!e.item||e.item.items&&e.item.items.length||t.toggle()},e.prototype.addChartEleSelected=function(e){var t=e.element.id;this.parent.notify(chartDesignTab,{addChartEle:t}),!e.item||e.item.items&&e.item.items.length||this.addChartDdb.toggle()},e.prototype.cFSelected=function(e){var t=e.element.id;if("cf_greaterthancf_lessthancf_betweencf_eqaultocf_textthatcontainscf_adateoccuringcf_duplicatevaluescf_top10itemscf_top10cf_bottom10itemscf_bottom10cf_aboveaveragecf_belowaverage".includes(t))this.parent.notify(initiateConditionalFormat,{action:e.item.text});else if("cf_databarscf_colorscales".includes(t)){var r=e.event.target.id;this.parent.notify(setCF,{action:t,id:r})}else if("cf_iconsets"===e.element.id){var n=e.event.target,i=""===n.id?n.parentElement.id:n.id;this.parent.notify(setCF,{action:t,id:i})}if("cf_cr_cells"===t)this.parent.notify(clearCFRule,{range:this.parent.getActiveSheet().selectedRange,isPublic:!1});else if("cf_cr_sheet"===t){var o=this.parent.getActiveSheet(),a=getRangeAddress([0,0,o.rowCount-1,o.colCount-1]);this.parent.conditionalFormat=null,this.parent.notify(clearCFRule,{range:a,isPublic:!1})}!e.item||e.item.items&&e.item.items.length||this.cFDdb.toggle()},e.prototype.borderSelected=function(e,t){if(!e.item.items.length&&e.item.id!==this.parent.element.id+"_border_colors"){if(!e.item.text){var r=this.parent.element.id,n=this.border.split(" "),i="solid"===n[1]?r+"_"+n[0]:r+"_"+n[1];if(i===e.item.id)return;return e.item.id===r+"_1px"||e.item.id===r+"_2px"||e.item.id===r+"_3px"?(n[0]=e.item.id.split(r+"_")[1],n[1]="solid"):(n[1]=e.item.id.split(r+"_")[1],n[0]="double"===n[1]?"3px":"1px"),this.border=n.join(" "),t.items[12].items.forEach(function(t){t.id===i&&(t.iconCss=null),t.id===e.item.id&&(t.iconCss="e-icons e-selected-icon")}),void t.setProperties({items:t.items},!0)}switch(this.bordersDdb.toggle(),this.parent.showSpinner(),e.item.text){case"Top Borders":this.parent.notify(setCellFormat,{style:{borderTop:this.border},onActionUpdate:!0});break;case"Left Borders":this.parent.notify(setCellFormat,{style:{borderLeft:this.border},onActionUpdate:!0});break;case"Right Borders":this.parent.notify(setCellFormat,{style:{borderRight:this.border},onActionUpdate:!0});break;case"Bottom Borders":this.parent.notify(setCellFormat,{style:{borderBottom:this.border},onActionUpdate:!0});break;case"All Borders":this.parent.notify(setCellFormat,{style:{border:this.border},onActionUpdate:!0});break;case"Horizontal Borders":this.parent.notify(setCellFormat,{style:{border:this.border},onActionUpdate:!0,borderType:"Horizontal"});break;case"Vertical Borders":this.parent.notify(setCellFormat,{style:{border:this.border},onActionUpdate:!0,borderType:"Vertical"});break;case"Outside Borders":this.parent.notify(setCellFormat,{style:{border:this.border},onActionUpdate:!0,borderType:"Outer"});break;case"Inside Borders":this.parent.notify(setCellFormat,{style:{border:this.border},onActionUpdate:!0,borderType:"Inner"});break;case"No Borders":this.parent.notify(setCellFormat,{style:{border:""},onActionUpdate:!0})}this.parent.hideSpinner()}},e.prototype.getFontNameDDB=function(e){var t=this,r=this.parent.createElement("button",{id:e+"_font_name"});return r.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"Calibri"})),this.fontNameDdb=new ej2Splitbuttons.DropDownButton({cssClass:"e-font-family",items:this.getFontFamilyItems(),createPopupOnClick:!0,select:function(e){var r={style:{fontFamily:e.item.text},onActionUpdate:!0};t.parent.notify(setCellFormat,r),r.cancel||t.refreshFontNameSelection(r.style.fontFamily)},close:function(){return focus(t.parent.element)},beforeOpen:function(e){return t.tBarDdbBeforeOpen(e.element,e.items)}}),this.fontNameDdb.createElement=this.parent.createElement,this.fontNameDdb.appendTo(r),r},e.prototype.getBtn=function(e,t,r){void 0===r&&(r=!0);var n=new ej2Buttons.Button({iconCss:"e-icons e-"+t+"-icon",isToggle:!0});return n.createElement=this.parent.createElement,n.appendTo(this.parent.createElement("button",{id:e+"_"+t,attrs:{type:"button"}})),r&&n.element.addEventListener("click",this.toggleBtnClicked.bind(this)),n.element},e.prototype.datavalidationDDB=function(e){var t,r=this,n=this.parent.serviceLocator.getService(locale);return this.datavalidationDdb=new ej2Splitbuttons.DropDownButton({cssClass:"e-datavalidation-ddb",iconCss:"e-datavalidation-icon e-icons",content:n.getConstant("DataValidation"),items:[{text:n.getConstant("DataValidation")},{text:n.getConstant("HighlightInvalidData")},{text:n.getConstant("ClearHighlight")},{text:n.getConstant("ClearValidation")}],createPopupOnClick:!0,beforeOpen:function(e){r.refreshSelected(r.datavalidationDdb,e.element,"iconCss")},select:function(e){switch(e.item.text){case n.getConstant("DataValidation"):r.parent.notify(initiateDataValidation,null);break;case n.getConstant("HighlightInvalidData"):r.parent.notify(invalidData,{isRemoveHighlight:!1});break;case n.getConstant("ClearHighlight"):r.parent.notify(invalidData,{isRemoveHighlight:!0});break;case n.getConstant("ClearValidation"):r.parent.notify(removeDataValidation,null);break;default:t=e.item.text===n.getConstant("SortAscending")?"Ascending":"Descending",r.parent.notify(applySort,{sortOptions:{sortDescriptors:{order:t}}})}},close:function(){return focus(r.parent.element)}}),this.datavalidationDdb.createElement=this.parent.createElement,this.datavalidationDdb.appendTo(this.parent.createElement("button",{id:e+"_datavalidation"})),this.datavalidationDdb.element},e.prototype.getTextAlignDDB=function(e){var t=this;return this.textAlignDdb=new ej2Splitbuttons.DropDownButton({cssClass:"e-align-ddb",iconCss:"e-icons e-left-icon",items:[{iconCss:"e-icons e-left-icon"},{iconCss:"e-icons e-center-icon"},{iconCss:"e-icons e-right-icon"}],beforeItemRender:this.alignItemRender.bind(this),createPopupOnClick:!0,beforeOpen:function(e){t.refreshSelected(t.textAlignDdb,e.element,"iconCss")},select:function(e){var r={style:{textAlign:e.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0};t.parent.notify(setCellFormat,r),r.cancel||(t.textAlignDdb.iconCss="e-icons e-"+r.style.textAlign+"-icon",t.textAlignDdb.dataBind())},close:function(){return focus(t.parent.element)}}),this.textAlignDdb.createElement=this.parent.createElement,this.textAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_text_align"})),this.textAlignDdb.element},e.prototype.getVerticalAlignDDB=function(e){var t=this;return this.verticalAlignDdb=new ej2Splitbuttons.DropDownButton({cssClass:"e-align-ddb",iconCss:"e-icons e-bottom-icon",items:[{iconCss:"e-icons e-top-icon"},{iconCss:"e-icons e-middle-icon"},{iconCss:"e-icons e-bottom-icon"}],beforeItemRender:this.alignItemRender.bind(this),createPopupOnClick:!0,beforeOpen:function(e){t.refreshSelected(t.verticalAlignDdb,e.element,"iconCss")},select:function(e){var r={style:{verticalAlign:e.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0};t.parent.notify(setCellFormat,r),r.cancel||(t.verticalAlignDdb.iconCss="e-icons e-"+r.style.verticalAlign+"-icon",t.verticalAlignDdb.dataBind())},close:function(){return focus(t.parent.element)}}),this.verticalAlignDdb.createElement=this.parent.createElement,this.verticalAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_vertical_align"})),this.verticalAlignDdb.element},e.prototype.getMergeSplitBtn=function(e){var t=this;this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_merge"}));var r=this.parent.serviceLocator.getService(locale);return this.mergeSplitBtn=new ej2Splitbuttons.SplitButton({cssClass:"e-merge-ddb",iconCss:"e-icons e-merge-icon",createPopupOnClick:!0,items:[{text:r.getConstant("MergeAll"),id:e+"_merge_all"},{text:r.getConstant("MergeHorizontally"),id:e+"_merge_horizontally"},{text:r.getConstant("MergeVertically"),id:e+"_merge_vertically"},{separator:!0,id:e+"_merge_separator"},{text:r.getConstant("Unmerge"),id:e+"_unmerge"}],select:this.mergeSelectHandler.bind(this),close:function(){return focus(t.parent.element)},click:function(e){e.element.classList.contains("e-active")?(t.toggleActiveState(!1),t.unMerge()):(t.toggleActiveState(!0),t.merge(t.parent.element.id+"_merge_all"))},created:function(){t.mergeSplitBtn.element.title=r.getConstant("MergeCells"),t.mergeSplitBtn.element.nextElementSibling.title=r.getConstant("SelectMergeType")}}),this.mergeSplitBtn.createElement=this.parent.createElement,this.mergeSplitBtn.appendTo("#"+e+"_merge"),this.mergeSplitBtn.element.parentElement},e.prototype.mergeSelectHandler=function(e){e.item.id===this.parent.element.id+"_unmerge"?this.unMerge():this.merge(e.item.id)},e.prototype.unMerge=function(){this.parent.showSpinner(),this.parent.notify(setMerge,{merge:!1,range:this.parent.getActiveSheet().selectedRange,isAction:!0,refreshRibbon:!0,type:"All"}),this.parent.hideSpinner()},e.prototype.merge=function(e){for(var t,r,n=this,i=this.parent.getActiveSheet(),o=getRangeIndexes(i.selectedRange),a=o[0];a<=o[2];a++)for(var s=o[1];s<=o[3];s++)a===o[0]&&s===o[1]&&e.includes("merge_all")||a===o[0]&&e.includes("merge_vertically")||s===o[1]&&e.includes("_merge_horizontally")||((t=getCell(a,s,i)||{}).value||t.formula)&&(r=!0);if(r){var l=this.parent.serviceLocator.getService(dialog);l.show({target:this.parent.element,height:200,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(locale).getConstant("MergeCellsAlert"),beforeOpen:function(e){var t={dialogName:"MergeAlertDialog",element:e.element,target:e.target,cancel:e.cancel};n.parent.trigger("dialogBeforeOpen",t),t.cancel&&(e.cancel=!0),focus(n.parent.element)},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(locale).getConstant("Ok"),isPrimary:!0},click:function(){l.hide(),n.performMerge(e)}}]})}else this.performMerge(e)},e.prototype.performMerge=function(e){var t=this.parent.element.id;switch(this.parent.showSpinner(),e){case t+"_merge_all":this.parent.notify(setMerge,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"All",isAction:!0,refreshRibbon:!0});break;case t+"_merge_horizontally":this.parent.notify(setMerge,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"Horizontally",isAction:!0});break;case t+"_merge_vertically":this.parent.notify(setMerge,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"Vertically",isAction:!0})}this.parent.hideSpinner()},e.prototype.getSortFilterDDB=function(e){var t,r=this,n=this.parent.serviceLocator.getService(locale);return this.sortingDdb=new ej2Splitbuttons.DropDownButton({cssClass:"e-sort-filter-ddb",iconCss:"e-icons e-sort-filter-icon",items:[{text:n.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc"},{text:n.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc"},{text:n.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom"},{separator:!0},{text:n.getConstant("Filter"),iconCss:"e-icons e-filter-apply",id:e+"_applyfilter"},{text:n.getConstant("ClearAllFilter"),iconCss:"e-icons e-filter-clear",id:e+"_clearfilter"},{text:n.getConstant("ReapplyFilter"),iconCss:"e-icons e-filter-reapply",id:e+"_reapplyfilter"}],createPopupOnClick:!0,beforeItemRender:function(t){var i={isFiltered:!1,isClearAll:!0};if(r.parent.notify(getFilteredColumn,i),r.parent.allowSorting||t.item.text!==n.getConstant("SortAscending")&&t.item.text!==n.getConstant("SortDescending")&&t.item.text!==n.getConstant("CustomSort")+"..."||t.element.classList.add("e-disabled"),r.parent.allowFiltering||t.item.text!==n.getConstant("Filter")||t.element.classList.add("e-disabled"),t.item.id===e+"_clearfilter"||t.item.id===e+"_reapplyfilter")i.isFiltered?t.element.classList.remove("e-disabled"):t.element.classList.add("e-disabled");else if(t.item.id===e+"_applyfilter"){var o=r.parent.getActiveSheet();(o.frozenColumns||o.frozenRows)&&t.element.classList.add("e-disabled")}},beforeOpen:function(e){r.refreshSelected(r.sortingDdb,e.element,"iconCss")},select:function(e){switch(e.item.text){case n.getConstant("Filter"):r.parent.notify(initiateFilterUI,{});break;case n.getConstant("ClearAllFilter"):r.parent.notify(clearFilter,{isAction:!0});break;case n.getConstant("ReapplyFilter"):r.parent.notify(reapplyFilter,null);break;case n.getConstant("CustomSort")+"...":r.parent.notify(initiateCustomSort,null);break;default:t=e.item.text===n.getConstant("SortAscending")?"Ascending":"Descending",r.parent.notify(applySort,{sortOptions:{sortDescriptors:{order:t}}})}},close:function(){return focus(r.parent.element)}}),this.sortingDdb.createElement=this.parent.createElement,this.sortingDdb.appendTo(this.parent.createElement("button",{id:e+"_sorting"})),this.sortingDdb.element},e.prototype.getFindBtn=function(e){var t=this.parent.createElement("button",{id:e+"_findbtn",attrs:{type:"button"}});return this.findDdb=new ej2Buttons.Button({cssClass:"e-spreadsheet-find-ddb",iconCss:"e-icons e-search-icon"}),this.findDdb.createElement=this.parent.createElement,this.findDdb.appendTo(t),t.onclick=this.findToolDlg.bind(this),this.findDdb.element},e.prototype.findToolDlg=function(){var e=this;if(ej2Base.isNullOrUndefined(this.parent.element.querySelector(".e-findtool-dlg"))){var t,r=this.parent.createElement("div",{className:"e-input-group"}),n=this.parent.createElement("input",{className:"e-input e-text-findNext-short",attrs:{type:"Text"}});this.findValue&&(n.value=this.findValue);var i=this.parent.serviceLocator.getService(locale);n.setAttribute("placeholder",i.getConstant("FindValue"));var o=this.parent.createElement("span",{className:"e-input-group-icon"}),a=n.value;n.onkeyup=function(r){var i=e.parent.getActiveSheet(),s=function(){if(n)if(13===r.keyCode)n.value&&"0 of 0"!==o.textContent&&(e.parent.notify(findHandler,{findOption:r.shiftKey?"prev":"next"}),e.updateCount(o,r.shiftKey));else{var s=n.value;if(a===s)return;a=s;var l=function(){if(n){var r=n.value;if(r===s){var i={countOpt:"count",findCount:""};e.parent.notify(findHandler,{countArgs:i}),o.textContent=i.findCount,ej2Base.isNullOrUndefined(r)||""===r||"0 of 0"===i.findCount?(t.enableItems(1,!1),t.enableItems(2,!1),o.textContent="0 of 0"):ej2Base.isNullOrUndefined(r)&&"0 of 0"===i.findCount||(t.enableItems(1,!0),t.enableItems(2,!0))}}};i.usedRange.rowIndex*i.usedRange.rowIndex<1e3?l():setTimeout(l())}};i.usedRange.rowIndex*i.usedRange.rowIndex<1e3?s():setTimeout(s())},r.appendChild(n),r.appendChild(o);var s=[{type:"Input",template:r},{prefixIcon:"e-icons e-prev-icon",tooltipText:"Find Previous",type:"Button",cssClass:"e-findRib-prev",disabled:!0},{prefixIcon:"e-icons e-next-icon",tooltipText:"Find Next",type:"Button",cssClass:"e-findRib-next",disabled:!0},{type:"Separator"},{prefixIcon:"e-icons e-option-icon",tooltipText:"More Options",type:"Button",cssClass:"e-findRib-more"},{prefixIcon:"e-icons e-close",tooltipText:"Close",type:"Button",cssClass:"e-findRib-close"}];t=new ej2Navigations.Toolbar({clicked:function(t){"e-findRib-next"===t.item.cssClass?(e.parent.notify(findHandler,{findOption:"next"}),e.updateCount(o)):"e-findRib-prev"===t.item.cssClass?(e.parent.notify(findHandler,{findOption:"prev"}),e.updateCount(o,!0)):"e-findRib-more"===t.item.cssClass&&(e.parent.notify(findDlg,null),e.findDialog.hide())},width:"auto",height:"auto",items:s,cssClass:"e-find-toolObj"});var l=this.parent.createElement("div",{className:"e-find-toolbar"}),d=this.parent.createElement("div",{className:"e-dlg-div"});this.findDialog=new ej2Popups.Dialog({isModal:!1,showCloseIcon:!1,cssClass:"e-findtool-dlg",content:l,visible:!1,allowDragging:!0,target:this.parent.element.querySelector(".e-sheet"),beforeOpen:function(){ej2Base.EventHandler.add(document,"click",e.closeDialog,e)},open:function(){if(e.findValue){var r={countOpt:"count",findCount:""};e.parent.notify(findHandler,{countArgs:r}),o.textContent=r.findCount}else o.textContent="0 of 0";e.textFocus(t.element)},beforeClose:function(){e.findValue=n.value||null,t.destroy();var r=document.querySelector(".e-find-toolbar");r&&ej2Base.EventHandler.remove(r,"focus",e.textFocus),ej2Base.EventHandler.remove(document,"click",e.closeDialog),focus(e.parent.element)},created:function(){t.createElement=e.parent.createElement,t.appendTo(l),e.findDialog.width=getComputedStyle(document.querySelector(".e-findtool-dlg")).width;var r=e.parent.element.querySelector(".e-main-panel").getBoundingClientRect(),n=e.findDialog.width.toString();e.findDialog.position={X:r.width-parseInt(n,10)-(e.parent.allowScrolling?getScrollBarWidth():0),Y:e.parent.getActiveSheet().showHeaders?31:0},e.findDialog.dataBind(),e.findDialog.show()}}),this.findDialog.createElement=this.parent.createElement,this.findDialog.appendTo(d)}else ej2Base.isNullOrUndefined(this.parent.element.querySelector(".e-findtool-dlg"))||(this.findDialog.hide(),ej2Base.detach(this.parent.element.querySelector(".e-findtool-dlg")),this.findDialog=null,focus(this.parent.element))},e.prototype.updateCount=function(e,t){var r,n=e.textContent.split(" ");t?(r=Number(n[0])-1)<1&&(r=Number(n[2])):(r=Number(n[0])+1)>Number(n[2])&&(r=1),n[0]=r.toString(),e.textContent=n.join(" ")},e.prototype.closeDialog=function(e){if((ej2Base.closest(e.target,".e-findRib-close")||!ej2Base.closest(e.target,".e-spreadsheet"))&&!ej2Base.isNullOrUndefined(this.findDialog)){this.findDialog.hide();var t=this.parent.element.querySelector(".e-findtool-dlg");t&&ej2Base.detach(t),this.findDialog=null}},e.prototype.textFocus=function(e){document.querySelector(".e-find-toolbar").addEventListener("focus",function(){var e=document.querySelector(".e-text-findNext-short");e.focus(),e.classList.add("e-input-focus"),e.setSelectionRange(0,e.value.length)})},e.prototype.getClearDDB=function(e){var t=this,r=this.parent.serviceLocator.getService(locale);return this.clearDdb=new ej2Splitbuttons.DropDownButton({cssClass:"e-clear-ddb",iconCss:"e-icons e-clear-icon",items:[{text:r.getConstant("ClearAll")},{text:r.getConstant("ClearFormats")},{text:r.getConstant("ClearContents")},{text:r.getConstant("ClearHyperlinks")}],createPopupOnClick:!0,select:function(e){return t.parent.notify(clearViewer,{options:{type:e.item.text}})},close:function(){return focus(t.parent.element)}}),this.clearDdb.createElement=this.parent.createElement,this.clearDdb.appendTo(this.parent.createElement("button",{id:e+"_clear"})),this.clearDdb.element},e.prototype.ribbonCreated=function(){this.ribbon.element.querySelector(".e-drop-icon").title=this.parent.serviceLocator.getService(locale).getConstant("CollapseToolbar")},e.prototype.alignItemRender=function(e){var t=e.item.iconCss.split(" e-")[1].split("-icon")[0];t=t[0].toUpperCase()+t.slice(1,t.length),e.element.title=this.parent.serviceLocator.getService(locale).getConstant("Align"+t)},e.prototype.toggleBtnClicked=function(e){var t,r,n,i,o,a=ej2Base.closest(e.target,".e-btn"),s=this.parent.element.id,l=a.id,d=setCellFormat;switch(l){case s+"_bold":r={fontWeight:"normal"},n={fontWeight:"bold"},o="fontWeight";break;case s+"_italic":r={fontStyle:"normal"},n={fontStyle:"italic"},o="fontStyle";break;case s+"_line-through":d=textDecorationUpdate,n=r={textDecoration:"line-through"},o="textDecoration";break;case s+"_underline":d=textDecorationUpdate,n=r={textDecoration:"underline"},o="textDecoration"}a.classList.contains("e-active")?(t=n[o],i={style:n,onActionUpdate:!0},this.parent.notify(d,i),i.cancel&&a.classList.remove("e-active")):(t=r[o],i={style:r,onActionUpdate:!0},this.parent.notify(d,i),i.cancel&&a.classList.add("e-active")),i.cancel||t===i.style[o]||this.refreshToggleBtn(getCellIndexes(this.parent.getActiveSheet().activeCell)),focus(this.parent.element)},e.prototype.getCellStyleValue=function(e,t){var r=getCell(t[0],t[1],this.parent.getActiveSheet()),n=this.parent.cellStyle[e];return r&&r.style&&r.style[e]&&(n=r.style[e]),n},e.prototype.refreshSelected=function(e,t,r,n){void 0===n&&(n=r);for(var i=0;i<e.items.length;i++)if(e.items[i][n]===e[r]){t.children[i].classList.add("e-selected");break}},e.prototype.expandCollapseHandler=function(e){var t=this.ribbon.element.querySelector(".e-drop-icon"),r=this.parent.serviceLocator.getService(locale);e.expanded?t.title=r.getConstant("CollapseToolbar"):t.title=r.getConstant("ExpandToolbar"),this.parent.setPanelSize()},e.prototype.getChartThemeDdbItems=function(){var e=this.parent.serviceLocator.getService(locale);return[{id:"Material",text:e.getConstant("Material")},{id:"Fabric",text:e.getConstant("Fabric")},{id:"Bootstrap",text:e.getConstant("Bootstrap")},{id:"HighContrastLight",text:e.getConstant("HighContrastLight")},{id:"MaterialDark",text:e.getConstant("MaterialDark")},{id:"FabricDark",text:e.getConstant("FabricDark")},{id:"HighContrast",text:e.getConstant("HighContrast")},{id:"BootstrapDark",text:e.getConstant("BootstrapDark")},{id:"Bootstrap4",text:e.getConstant("Bootstrap4")},{id:"Bootstrap5Dark",text:e.getConstant("Bootstrap5Dark")},{id:"Bootstrap5",text:e.getConstant("Bootstrap5")},{id:"TailwindDark",text:e.getConstant("TailwindDark")},{id:"Tailwind",text:e.getConstant("Tailwind")}]},e.prototype.getNumFormatDdbItems=function(e){var t=this.parent.serviceLocator.getService(locale);return[{id:e+"_General",text:t.getConstant("General")},{id:e+"_Number",text:t.getConstant("Number")},{id:e+"_Currency",text:t.getConstant("Currency")},{id:e+"_Accounting",text:t.getConstant("Accounting")},{id:e+"_ShortDate",text:t.getConstant("ShortDate")},{id:e+"_LongDate",text:t.getConstant("LongDate")},{id:e+"_Time",text:t.getConstant("Time")},{id:e+"_Percentage",text:t.getConstant("Percentage")},{id:e+"_Fraction",text:t.getConstant("Fraction")},{id:e+"_Scientific",text:t.getConstant("Scientific")},{id:e+"_Text",text:t.getConstant("Text")},{id:e+"_Custom",text:t.getConstant("Custom")}]},e.prototype.getFontFamilyItems=function(){return[{text:"Arial"},{text:"Arial Black"},{text:"Axettac Demo"},{text:"Batang"},{text:"Book Antiqua"},{text:"Calibri",iconCss:"e-icons e-selected-icon"},{text:"Courier"},{text:"Courier New"},{text:"Din Condensed"},{text:"Georgia"},{text:"Helvetica"},{text:"Helvetica New"},{text:"Roboto"},{text:"Tahoma"},{text:"Times New Roman"},{text:"Verdana"}]},e.prototype.numDDBSelect=function(e){var t=this.parent.serviceLocator.getService(locale),r=getCellIndexes(this.parent.getActiveSheet().activeCell),n=getCell(r[0],r[1],this.parent.getActiveSheet()),i={format:getFormatFromType(e.item.id.split(this.parent.element.id+"_")[1]),range:this.parent.getActiveSheet().selectedRange,cancel:!1,requestType:"NumberFormat"};e.item.text===t.getConstant("Custom")&&n&&(i.format=n.format);var o={range:this.parent.getActiveSheet().name+"!"+i.range,format:i.format,requestType:"NumberFormat"};this.parent.trigger("beforeCellFormat",i),this.parent.notify(beginAction,{eventArgs:i,action:"format"}),i.cancel||(this.parent.notify(applyNumberFormatting,i),this.parent.notify(selectionComplete,{type:"mousedown"}),e.item.text===t.getConstant("Custom")?this.renderCustomFormatDialog():(this.refreshNumFormatSelection(e.item.text),this.parent.notify(completeAction,{eventArgs:o,action:"format"})))},e.prototype.renderCustomFormatDialog=function(){var e=this,t=this.parent.serviceLocator.getService(locale),r=getCellIndexes(this.parent.getActiveSheet().activeCell),n=getCell(r[0],r[1],this.parent.getActiveSheet()),i=this.parent.createElement("div"),o=this.parent.createElement("div",{className:"e-custom-dialog"}),a=this.parent.createElement("button",{className:"e-btn",innerHTML:t.getConstant("APPLY")}),s=this.parent.createElement("div",{className:"e-custom-sample",innerHTML:t.getConstant("CustomFormatSample")+":"}),l=this.parent.createElement("input",{className:"e-input e-dialog-input",attrs:{type:"text",name:"input",placeholder:"Custom Number Format",spellcheck:"false"}}),d=this.parent.createElement("div",{className:"e-custom-listview"}),p=this.parent.serviceLocator.getService(dialog),h=new ej2Lists.ListView({dataSource:this.formatData,select:function(e){l.value=e.text}});o.appendChild(l),o.appendChild(a),o.appendChild(s),o.appendChild(d),h.appendTo(d),a.addEventListener("click",function(){var r=l.value,n={range:e.parent.getActiveSheet().name+"!"+e.parent.getActiveSheet().selectedRange,format:r,requestType:"NumberFormat"};e.parent.numberFormat(r);var i={text:r};e.checkNewFormats(r)&&r.length>0&&e.formatData.push(i),e.refreshNumFormatSelection(t.getConstant("Custom")),e.parent.notify(completeAction,{eventArgs:n,action:"format"}),p.hide()}),p.show({header:t.getConstant("CustomFormat"),cssClass:"e-custom-format-dlg",height:this.parent.cssClass.indexOf("e-bigger")>-1?502:480,width:440,isModal:!0,showCloseIcon:!0,content:o,footerTemplate:i});var c={text:n.format};h.selectItem(c)},e.prototype.checkNewFormats=function(e){var t=!0;return this.formatData.forEach(function(r){r.text===e&&(t=!1)}),t},e.prototype.initDefaultFormats=function(){this.formatData=[{text:"General"},{text:"0"},{text:"0.00"},{text:"#,##0"},{text:"#,##0.00"},{text:"#,##0_);(#,##0)"},{text:"#,##0_);[Red](#,##0)"},{text:"#,##0.00_);(#,##0.00)"},{text:"#,##0.00_);[Red](#,##0.00)"},{text:"$#,##0_);($#,##0)"},{text:"$#,##0_);[Red]($#,##0)"},{text:"$#,##0.00_);($#,##0.00)"},{text:"$#,##0.00_);[Red]($#,##0.00)"},{text:"0%"},{text:"0.00%"},{text:"0.00E+00"},{text:"##0.0E+0"},{text:"# ?/?"},{text:"# ??/??"},{text:"dd-mm-yy"},{text:"dd-mmm-yy"},{text:"dd-mmm"},{text:"mmm-yy"},{text:"h:mm AM/PM"},{text:"h:mm:ss AM/PM"},{text:"h:mm"},{text:"h:mm:ss"},{text:"dd-mm-yy h:mm"},{text:"mm:ss"},{text:"mm:ss.0"},{text:"@"},{text:"[h]:mm:ss"},{text:'_($* #,##0_);_($* (#,##0);_($* "-"_);_(@_)'},{text:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)'},{text:'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)'},{text:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)'}]},e.prototype.chartThemeDDBSelect=function(e){this.parent.notify(selectionComplete,{type:"mousedown"}),this.refreshChartThemeSelection(e.item.id),this.parent.notify(chartDesignTab,{chartTheme:e.item.id})},e.prototype.tBarDdbBeforeOpen=function(e,t,r){void 0===r&&(r=0);var n=this.parent.viewport.height,i=parseInt(getComputedStyle(e.firstElementChild).height,10)*(t.length-r)+2*parseInt(getComputedStyle(e).paddingTop,10);if(r){var o=getComputedStyle(e.querySelector(".e-separator"));i+=r*(parseInt(o.borderBottomWidth,10)+2*parseInt(o.marginTop,10))}i>n?(e.style.height=n+"px",e.style.overflowY="auto"):e.style.height&&(e.style.height="",e.style.overflowY="")},e.prototype.numDDBOpen=function(e){this.numPopupWidth=0;for(var t=e.element.querySelectorAll("span.e-numformat-preview-text"),r=0,n=t.length;r<n;r++)this.numPopupWidth<t[r].offsetWidth&&(this.numPopupWidth=t[r].offsetWidth);var i=this.numPopupWidth+160;document.querySelector(".e-numformat-ddb.e-dropdown-popup").style.width=i+"px"},e.prototype.previewNumFormat=function(e){var t=getCellIndexes(this.parent.getActiveSheet().activeCell),r=getCell(t[0],t[1],this.parent.getActiveSheet()),n={type:e.item.text,formattedText:"",value:r&&r.value?r.value:"",format:getFormatFromType(e.item.id.split(this.parent.element.id+"_")[1]),sheetIndex:this.parent.activeSheetIndex,onLoad:!0};if("Custom"!==e.item.text){var i=this.parent.createElement("div",{className:"e-numformat-text",styles:"width:100%",innerHTML:e.element.innerHTML});e.element.innerHTML="",this.parent.notify(getFormattedCellObject,n);var o=this.parent.createElement("span",{className:"e-numformat-preview-text",styles:"float:right;",innerHTML:n.formattedText.toString()});i.appendChild(o),e.element.appendChild(i)}},e.prototype.refreshRibbonContent=function(e){if(this.ribbon){ej2Base.isNullOrUndefined(e)&&(e=this.ribbon.selectedTab);var t=this.parent.serviceLocator.getService(locale),r=this.parent.getActiveSheet();switch(this.ribbon.items[e].header.text){case t.getConstant("Home"):this.refreshHomeTabContent(getCellIndexes(r.activeCell));break;case t.getConstant("Insert"):case t.getConstant("Formulas"):break;case t.getConstant("Data"):this.refreshDataTabContent(e);break;case t.getConstant("View"):this.refreshViewTabContent(e)}}},e.prototype.refreshHomeTabContent=function(e){ej2Base.isNullOrUndefined(document.getElementById(this.parent.element.id+"_number_format"))||(this.numFormatDDB=ej2Base.getComponent(document.getElementById(this.parent.element.id+"_number_format"),ej2Splitbuttons.DropDownButton));var t=this.parent.getActiveSheet(),r=getCellIndexes(this.parent.getActiveSheet().activeCell),n=this.parent.serviceLocator.getService(locale),i=getCell(r[0],r[1],this.parent.getActiveSheet())||{},o=getTypeFromFormat(i.format?i.format:"General");if(this.numFormatDDB&&(t.isProtected&&!t.protectSettings.formatCells?(o="General",this.refreshNumFormatSelection(o)):(i.format&&"General"===o&&(o="Custom"),this.refreshNumFormatSelection(n.getConstant(o)))),this.fontNameDdb&&(t.isProtected&&!t.protectSettings.formatCells?this.refreshFontNameSelection("Calibri"):this.refreshFontNameSelection(this.getCellStyleValue("fontFamily",e))),this.fontSizeDdb){var a=this.getCellStyleValue("fontSize",e);t.isProtected&&!t.protectSettings.formatCells?this.fontSizeDdb.content="11":(a=a.includes("pt")?a.split("pt")[0]:"11")!==this.fontSizeDdb.content&&(this.fontSizeDdb.content=a,this.fontSizeDdb.dataBind())}if(this.textAlignDdb){var s=this.getCellStyleValue("textAlign",e);if(t.isProtected&&!t.protectSettings.formatCells)this.textAlignDdb.iconCss="e-icons e-left-icon";else{void 0===i.value||"left"!==s||"Accounting"!==o&&!isNumber(i.value)||(s="right");(a="e-icons e-"+s.toLowerCase()+"-icon")!==this.textAlignDdb.iconCss&&(this.textAlignDdb.iconCss=a,this.textAlignDdb.dataBind())}}if(this.verticalAlignDdb){a="e-icons e-"+this.getCellStyleValue("verticalAlign",e).toLowerCase()+"-icon";t.isProtected&&!t.protectSettings.formatCells?this.verticalAlignDdb.iconCss="e-icons e-bottom-icon":a!==this.verticalAlignDdb.iconCss&&(this.verticalAlignDdb.iconCss=a,this.verticalAlignDdb.dataBind())}if(this.refreshToggleBtn(e),!t.isProtected&&(i.rowSpan>1||i.colSpan>1))this.enableToolbarItems([{tab:n.getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:!0}]),this.toggleActiveState(!0);else{var l=getRangeIndexes(t.selectedRange);this.enableToolbarItems([{tab:n.getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:l[0]!==l[2]||l[1]!==l[3]}]),this.toggleActiveState(!1)}},e.prototype.toggleActiveState=function(e){var t=this.parent.serviceLocator.getService(locale);this.parent.getActiveSheet().isProtected||(e?(this.mergeSplitBtn.element.classList.add("e-active"),this.mergeSplitBtn.element.title=t.getConstant("UnmergeCells")):(this.mergeSplitBtn.element.classList.contains("e-active")&&this.mergeSplitBtn.element.classList.remove("e-active"),this.mergeSplitBtn.element.title=t.getConstant("MergeCells")))},e.prototype.refreshToggleBtn=function(e){var t,r,n,i=this,o=this.parent.getActiveSheet(),a=this.parent.element.id,s=getCell(e[0],e[1],o),l=["fontWeight","fontStyle","textDecoration","textDecoration"];["bold","italic","line-through","underline","wrap"].forEach(function(d,p){(t=document.getElementById(a+"_"+d))&&(o.isProtected&&!o.protectSettings.formatCells?t.classList.remove("e-active"):"wrap"===d?n=s&&s.wrap:(r=i.getCellStyleValue(l[p],e).toLowerCase(),n=r.indexOf(d)>-1),n?t.classList.add("e-active"):t.classList.contains("e-active")&&t.classList.remove("e-active"))})},e.prototype.refreshFontNameSelection=function(e){e=e.split('"').join(""),this.fontNameDdb.element.firstElementChild.textContent=e;for(var t=0;t<this.fontNameDdb.items.length;t++)if(this.fontNameDdb.items[t].text===e){this.fontNameDdb.items[t].iconCss="e-icons e-selected-icon",t!==this.fontNameIndex&&(this.fontNameDdb.items[this.fontNameIndex].iconCss=""),this.fontNameDdb.setProperties({items:this.fontNameDdb.items},!0),this.fontNameIndex=t;break}["Arial","Arial Black","Axettac Demo","Batang","Book Antiqua","Calibri","Courier","Courier New","Din Condensed","Georgia","Helvetica","Helvetica New","Roboto","Tahoma","Times New Roman","Verdana"].indexOf(e)<0&&(this.fontNameDdb.items[this.fontNameIndex].iconCss="")},e.prototype.refreshNumFormatSelection=function(e){for(var t=0;t<this.numFormatDDB.items.length;t++)""!==this.numFormatDDB.items[t].iconCss&&(this.numFormatDDB.items[t].iconCss=""),this.numFormatDDB.items[t].text===e&&(this.numFormatDDB.items[t].iconCss="e-icons e-selected-icon");this.numFormatDDB.element.firstElementChild.textContent=e,this.numFormatDDB.setProperties({items:this.numFormatDDB.items},!0)},e.prototype.refreshChartThemeSelection=function(e){if(e!==this.chartThemeDDB.items[this.chartThemeIndex].text){this.chartThemeDDB.element.firstElementChild.textContent=this.getChartThemeText(e);for(var t=0;t<this.chartThemeDDB.items.length;t++)if(this.chartThemeDDB.items[t].id===e){this.chartThemeDDB.items[t].iconCss="e-icons e-selected-icon",this.chartThemeDDB.items[this.chartThemeIndex].iconCss="",this.chartThemeDDB.setProperties({items:this.chartThemeDDB.items},!0),this.chartThemeIndex=t;break}}},e.prototype.getChartThemeText=function(e){var t=this.parent.serviceLocator.getService(locale),r="";switch(e){case"Material":r=t.getConstant("Material");break;case"Fabric":r=t.getConstant("Fabric");break;case"Bootstrap":r=t.getConstant("Bootstrap");break;case"HighContrastLight":r=t.getConstant("HighContrastLight");break;case"MaterialDark":r=t.getConstant("MaterialDark");break;case"FabricDark":r=t.getConstant("FabricDark");break;case"HighContrast":r=t.getConstant("HighContrast");break;case"BootstrapDark":r=t.getConstant("BootstrapDark");break;case"Bootstrap4":r=t.getConstant("Bootstrap4");break;case"Bootstrap5Dark":r=t.getConstant("Bootstrap5Dark");break;case"Bootstrap5":r=t.getConstant("Bootstrap5");break;case"TailwindDark":r=t.getConstant("TailwindDark");break;case"Tailwind":r=t.getConstant("Tailwind")}return r},e.prototype.fileMenuItemSelect=function(e){var t=this,r=ej2Base.extend({cancel:!1},e);this.parent.trigger("fileMenuItemSelect",r);var n,i=this.parent.element.id;if(!r.cancel)switch(e.item.id){case i+"_Open":ej2Base.select("#"+i+"_fileUpload",this.parent.element).click();break;case i+"_Xlsx":case i+"_Xls":case i+"_Csv":case i+"_Pdf":this.parent.notify(exportDialog,e);break;case i+"_New":(n=this.parent.serviceLocator.getService(dialog)).show({height:200,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(locale).getConstant("DestroyAlert"),beforeOpen:function(e){var r={dialogName:"DestroySheetDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0),focus(t.parent.element)},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(locale).getConstant("Ok"),isPrimary:!0},click:function(){n.hide(),t.blankWorkbook()}}]})}},e.prototype.blankWorkbook=function(){this.parent.notify(clearCopy,null),this.parent.sheets.length=0,this.parent.sheetNameCount=1,this.parent.notify(sheetsDestroyed,{}),this.parent.createSheet(),this.parent.activeSheetIndex=this.parent.sheets.length-1,this.parent.notify(refreshSheetTabs,{}),this.parent.notify(workbookFormulaOperation,{action:"initSheetInfo"}),this.parent.renderModule.refreshSheet(),this.parent.openModule.isImportedFile=!1,this.parent.openModule.unProtectSheetIdx=[]},e.prototype.toolbarClicked=function(e){if("spreadsheet_find"!==e.item.id){var t=this.parent.element.id,r=this.parent.getActiveSheet(),n=void 0,i=void 0,o=void 0,a=void 0,s=void 0;switch(e.item.id){case t+"_headers":if(n={isShow:!r.showHeaders,sheetIdx:this.parent.activeSheetIndex,cancel:!1},this.parent.notify(completeAction,{eventArgs:n,action:"headers"}),n.cancel)return;this.parent.setSheetPropertyOnMute(r,"showHeaders",!r.showHeaders),this.parent.serviceLocator.getService("sheet").showHideHeaders(),this.toggleRibbonItems({props:"Headers",activeTab:this.ribbon.selectedTab}),focus(this.parent.element);break;case t+"_gridlines":if(i={isShow:!r.showGridLines,sheetIdx:this.parent.activeSheetIndex,cancel:!1},this.parent.notify(completeAction,{eventArgs:i,action:"gridLines"}),i.cancel)return;this.parent.setSheetPropertyOnMute(r,"showGridLines",!r.showGridLines),this.toggleRibbonItems({props:"GridLines",activeTab:this.ribbon.selectedTab}),focus(this.parent.element);break;case t+"_protect":this.parent.openModule.isImportedFile&&-1===this.parent.openModule.unProtectSheetIdx.indexOf(this.parent.activeSheetIndex)?this.parent.notify(UnProtectWorksheet,{isImportedSheet:!0}):r.password&&r.password.length>0?this.parent.notify(UnProtectWorksheet,null):(this.parent.setSheetPropertyOnMute(r,"isProtected",!r.isProtected),o=!r.isProtected,this.parent.notify(applyProtect,{isActive:o,id:t+"_protect"}));break;case t+"_undo":this.parent.notify(performUndoRedo,{isUndo:!0});break;case t+"_redo":this.parent.notify(performUndoRedo,{isUndo:!1});break;case t+"_freezepanes":a=getCellIndexes(r.topLeftCell),s=r.frozenRows||r.frozenColumns?a:getCellIndexes(r.activeCell),this.parent.notify(freeze,{row:s[0]-a[0],column:s[1]-a[1],isAction:!0});break;case t+"_freezerows":this.parent.notify(freeze,{row:r.frozenRows?0:getCellIndexes(r.activeCell)[0]-getCellIndexes(r.topLeftCell)[0],column:r.frozenColumns,isAction:!0});break;case t+"_freezecolumns":this.parent.notify(freeze,{row:r.frozenRows,column:r.frozenColumns?0:getCellIndexes(r.activeCell)[1]-getCellIndexes(r.topLeftCell)[1],isAction:!0});break;case t+"_protectworkbook":this.parent.password.length>0?this.parent.notify(unProtectWorkbook,null):this.parent.isProtected?(this.parent.isProtected=!1,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),this.toggleRibbonItems({props:"Protectworkbook",activeTab:this.ribbon.selectedTab})):this.parent.element.querySelector(".e-add-sheet-tab").classList.contains("e-disabled")?this.toggleRibbonItems({props:"Protectworkbook",activeTab:this.ribbon.selectedTab}):this.parent.notify(protectWorkbook,null)}this.parent.notify(ribbonClick,e)}},e.prototype.toggleRibbonItems=function(e){var t="",r=this.parent.serviceLocator.getService(locale).getConstant("View"),n=this.parent.serviceLocator.getService(locale).getConstant("Data");if(this.ribbon.items[this.ribbon.selectedTab].header.text===r){if(ej2Base.isNullOrUndefined(e.activeTab))for(var i=0,o=this.ribbon.items.length;i<o;i++)if(this.ribbon.items[i].header.text===r){e.activeTab=i;break}var a=this.getLocaleText(e.props,"GridLines"===e.props),s=this.parent.element.id+"_"+e.props.toLowerCase(),l=this.ribbon.items[e.activeTab].content.length;for(i=void 0;i<l;i++)"Separator"!==this.ribbon.items[e.activeTab].content[i].type&&this.ribbon.items[e.activeTab].content[i].id===s&&(this.ribbon.items[e.activeTab].content[i].text=a,this.ribbon.setProperties({items:this.ribbon.items},!0));this.ribbon.items[this.ribbon.selectedTab].header.text===r&&this.updateToggleText(e.props.toLowerCase(),a)}if(this.ribbon.items[this.ribbon.selectedTab].header.text===n){if(ej2Base.isNullOrUndefined(e.activeTab)){i=0;for(var d=this.ribbon.items.length;i<d;i++)if(this.ribbon.items[i].header.text===n){e.activeTab=i;break}}if((s=this.parent.element.id+"_"+e.props.toLowerCase())===this.parent.element.id+"_protect"){var p=this.ribbon.items[this.ribbon.selectedTab].content.length,h=void 0;for(h=0;h<p&&this.ribbon.items[this.ribbon.selectedTab].content[h].id!==this.parent.element.id+"_protect";h++);t=this.getLocaleProtectText("Sheet",!0)}else if(s===this.parent.element.id+"_protectworkbook"){var c=this.ribbon.items[this.ribbon.selectedTab].content.length;h=void 0;for(h=0;h<c&&this.ribbon.items[this.ribbon.selectedTab].content[h].id!==this.parent.element.id+"_protectworkbook";h++);this.parent.isProtected||this.parent.password.length>0?t=this.getLocaleProtectWorkbook("UnProtectWorkbook"):this.parent.isProtected||(t=this.getLocaleProtectWorkbook("ProtectWorkbook"))}for(l=this.ribbon.items[e.activeTab].content.length,i=void 0;i<l;i++)"Separator"!==this.ribbon.items[e.activeTab].content[i].type&&this.ribbon.items[e.activeTab].content[i].id===s&&(this.ribbon.items[e.activeTab].content[i].text=t,this.ribbon.setProperties({items:this.ribbon.items},!0));this.ribbon.items[this.ribbon.selectedTab].header.text===n&&this.updateToggleText(e.props.toLowerCase(),t)}},e.prototype.enableFileMenuItems=function(e){this.ribbon.enableMenuItems(e.items,e.enable,e.isUniqueId)},e.prototype.hideRibbonTabs=function(e){this.ribbon.hideTabs(e.tabs,e.hide)},e.prototype.addRibbonTabs=function(e){this.ribbon.addTabs(e.items,e.insertBefore);ej2Base.select(".e-ribbon .e-tab-header .e-toolbar-item:not(.e-menu-tab).e-hide",this.parent.element)&&this.parent.updateActiveBorder(ej2Base.selectAll(".e-ribbon .e-tab-header .e-toolbar-item:not(.e-menu-tab)",this.parent.element)[this.ribbon.selectedTab])},e.prototype.updateToggleText=function(e,t){var r=this;getUpdateUsingRaf(function(){var n=ej2Base.select("#"+r.parent.element.id+"_"+e+" .e-tbar-btn-text",r.ribbon.element);n&&(n.textContent=t)}),"headers"===e&&this.findDialog&&(this.findDialog.position.Y=this.parent.getActiveSheet().showHeaders?31:0,this.findDialog.dataBind())},e.prototype.refreshViewTabContent=function(e){for(var t=this.parent.element.id,r=this.parent.getActiveSheet(),n=this.parent.serviceLocator.getService(locale),i=0;i<this.ribbon.items[e].content.length;i++)"Separator"!==this.ribbon.items[e].content[i].type&&(this.ribbon.items[e].content[i].id===t+"_headers"&&this.updateViewTabContent(e,"Headers",i),this.ribbon.items[e].content[i].id===t+"_gridlines"&&this.updateViewTabContent(e,"GridLines",i),this.ribbon.items[e].content[i].id===t+"_freezepanes"&&(r.frozenRows||r.frozenColumns?this.ribbon.items[e].content[i].text===n.getConstant("FreezePanes")&&this.updateToggleText("freezepanes",this.updateRibbonItemText("Unfreeze","Panes",i,e)):this.ribbon.items[e].content[i].text===n.getConstant("UnfreezePanes")&&this.updateToggleText("freezepanes",this.updateRibbonItemText("Freeze","Panes",i,e))),this.ribbon.items[e].content[i].id===t+"_freezerows"&&(r.frozenRows?this.ribbon.items[e].content[i].text===n.getConstant("FreezeRows")&&this.updateToggleText("freezerows",this.updateRibbonItemText("Unfreeze","Rows",i,e)):this.ribbon.items[e].content[i].text===n.getConstant("UnfreezeRows")&&this.updateToggleText("freezerows",this.updateRibbonItemText("Freeze","Rows",i,e))),this.ribbon.items[e].content[i].id===t+"_freezecolumns"&&(r.frozenColumns?this.ribbon.items[e].content[i].text===n.getConstant("FreezeColumns")&&this.updateToggleText("freezecolumns",this.updateRibbonItemText("Unfreeze","Columns",i,e)):this.ribbon.items[e].content[i].text===n.getConstant("UnfreezeColumns")&&this.updateToggleText("freezecolumns",this.updateRibbonItemText("Freeze","Columns",i,e))))},e.prototype.updateViewTabContent=function(e,t,r){var n=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(locale);n["show"+t]?this.ribbon.items[e].content[r].text===i.getConstant("Show"+t)&&this.updateToggleText(t.toLowerCase(),this.updateRibbonItemText("Hide",t,r,e)):this.ribbon.items[e].content[r].text===i.getConstant("Hide"+t)&&this.updateToggleText(t.toLowerCase(),this.updateRibbonItemText("Show",t,r,e))},e.prototype.updateRibbonItemText=function(e,t,r,n){var i=this.parent.serviceLocator.getService(locale).getConstant(e+t);return this.ribbon.items[n].content[r].text=i,this.ribbon.setProperties({items:this.ribbon.items},!0),i},e.prototype.refreshDataTabContent=function(e){for(var t,r=this.parent.element.id,n=0;n<this.ribbon.items[e].content.length;n++)if("Separator"!==this.ribbon.items[e].content[n].type){if(this.ribbon.items[e].content[n].id===r+"_protect"){if(this.updateDataTabContent(e,"Sheet",n),t)break;t=!0}this.ribbon.items[e].content[n].id===r+"_protectworkbook"&&this.updateDataTabContent(e,"Workbook",n)}},e.prototype.updateDataTabContent=function(e,t,r){var n=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(locale);if("Sheet"===t)n.isProtected?this.ribbon.items[e].content[r].text===i.getConstant("Protect"+t)&&(this.ribbon.items[e].content[r].cssClass="e-active",this.updateProtectBtn("Unprotect",t,r,e)):this.updateProtectBtn("Protect",t,r,e);else if("Workbook"===t){var o=this.parent.serviceLocator.getService(locale);this.parent.isProtected?this.ribbon.items[e].content[r].text===o.getConstant("Protect"+t)&&this.updateToggleText("protectworkbook",this.updateRibbonItemText("UnProtect",t,r,e)):this.ribbon.items[e].content[r].text===o.getConstant("UnProtect"+t)&&this.updateToggleText("protectworkbook",this.updateRibbonItemText("Protect",t,r,e))}},e.prototype.updateProtectBtn=function(e,t,r,n){var i=this.parent.serviceLocator.getService(locale).getConstant(e+t);this.ribbon.items[n].content[r].text=i,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText("protect",i)},e.prototype.updateProtectWorkbookBtn=function(e,t,r,n){var i=this.parent.serviceLocator.getService(locale).getConstant(e);this.ribbon.items[n].content[r].text=i,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText("protectworkbook",i)},e.prototype.addToolbarItems=function(e){this.ribbon.addToolbarItems(e.tab,e.items,e.index)},e.prototype.enableToolbarItems=function(e){var t=this;e.forEach(function(e){t.ribbon.enableItems(e.tab||t.ribbon.items[t.ribbon.selectedTab].header.text,e.items,e.enable)})},e.prototype.createMobileView=function(){var e=this,t=this.parent.element.id,r=this.parent.createElement("div",{className:"e-header-toolbar"}),n=this.parent.createElement("ul");r.appendChild(n);var i=new ej2Navigations.Toolbar({items:[{prefixIcon:"e-tick-icon",align:"Left",id:t+"focused_tick",cssClass:"e-focused-tick"},{template:n,align:"Right",id:t+"file_menu"}],clicked:function(r){switch(r.item.id){case t+"focused_tick":e.parent.element.classList.remove("e-mobile-focused"),e.parent.renderModule.setSheetPanelSize()}},created:function(){var t=new ej2Navigations.Menu({cssClass:"e-mobile e-file-menu",enableRtl:!0,showItemOnClick:!0,items:e.getRibbonMenuItems(),select:e.fileMenuItemSelect.bind(e),beforeOpen:function(t){t.element.parentElement.classList.remove("e-rtl"),e.fileMenuBeforeOpen(t)},beforeClose:e.fileMenuBeforeClose.bind(e)});t.createElement=e.parent.createElement,t.appendTo(n)}});i.createElement=this.parent.createElement,i.appendTo(r),this.parent.element.insertBefore(r,this.parent.element.firstElementChild),this.renderMobileToolbar()},e.prototype.renderMobileToolbar=function(){var e=this,t=this.parent.createElement("div",{className:"e-toolbar-panel e-ribbon"}),r=this.parent.createElement("div"),n=this.parent.createElement("button");t.appendChild(r),t.appendChild(n),t.style.display="block",this.parent.element.appendChild(t);var i=new ej2Splitbuttons.DropDownButton({cssClass:"e-caret-hide",content:this.ribbon.items[0].header.text,items:[{text:this.ribbon.items[0].header.text},{text:this.ribbon.items[1].header.text},{text:this.ribbon.items[2].header.text},{text:this.ribbon.items[3].header.text}],createPopupOnClick:!0,select:function(t){t.item.text!==i.content&&(o.element.style.display="none",i.content=t.item.text,i.dataBind(),o.items=e.ribbon.items[i.items.indexOf(t.item)+1].content,o.width="calc(100% - "+n.getBoundingClientRect().width+"px)",o.element.style.display="",o.dataBind(),o.items[0].text=t.item.text,o.dataBind())},open:function(e){var t=e.element.parentElement,r=t.getBoundingClientRect(),n=ej2Popups.calculatePosition(i.element,"right","bottom");t.style.left=n.left-r.width+"px",t.style.top=n.top-r.height+"px";for(var o=0;o<i.items.length;o++)if(i.content===i.items[o].text){e.element.children[o].classList.add("e-selected");break}},close:function(){return focus(e.parent.element)}});i.createElement=this.parent.createElement,i.appendTo(n);var o=new ej2Navigations.Toolbar({width:"calc(100% - "+n.getBoundingClientRect().width+"px)",items:this.ribbon.items[0].content,clicked:this.toolbarClicked.bind(this)});o.createElement=this.parent.createElement,o.appendTo(r),t.style.display=""},e.prototype.fileMenuBeforeOpen=function(e){var t,r=this,n=this.parent.serviceLocator.getService(locale),i=[".xlsx",".xls",".csv",".pdf"];e.parentItem.text===n.getConstant("SaveAs")&&[].slice.call(e.element.children).forEach(function(e,n){t=r.parent.createElement("div",{innerHTML:e.innerHTML}),e.innerHTML="",t.appendChild(r.parent.createElement("span",{className:"e-extension",innerHTML:i[n]})),e.appendChild(t)}),this.parent.trigger("fileMenuBeforeOpen",e)},e.prototype.enableRibbonTabs=function(e){this.ribbon.enableTabs(e.tabs,e.enable)},e.prototype.fileMenuBeforeClose=function(e){this.parent.trigger("fileMenuBeforeClose",e)},e.prototype.hideFileMenuItems=function(e){this.ribbon.hideMenuItems(e.items,e.hide,e.isUniqueId)},e.prototype.addFileMenuItems=function(e){this.ribbon.addMenuItems(e.items,e.text,e.insertAfter,e.isUniqueId)},e.prototype.hideToolbarItems=function(e){this.ribbon.hideToolbarItems(e.tab,e.indexes,e.hide)},e.prototype.protectSheetHandler=function(e){var t=this.parent.getActiveSheet(),r=this.parent.serviceLocator.getService(locale);t.isProtected&&t.protectSettings.formatCells||!t.isProtected?(this.parent.allowCellFormatting?this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId,enable:!0}]):this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId.slice(2,14),enable:!1}]),this.parent.allowWrap||this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId.slice(14,15),enable:!1}]),this.parent.allowNumberFormatting||this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.enableHomeBtnId.slice(2,3),enable:!1}]),this.parent.notify(setUndoRedo,null)):this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.disableHomeBtnId,enable:!1}]),t.isProtected&&t.protectSettings.insertLink||!t.isProtected?!this.parent.allowHyperlink||t.isProtected&&t.protectSettings.insertLink?this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.enableInsertBtnId.slice(0,1),enable:!1}]):this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.enableInsertBtnId,enable:!0}]):this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.enableInsertBtnId,enable:!1}]),t.isProtected&&t.protectSettings.selectCells||!t.isProtected?this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.findBtnId,enable:!0}]):this.enableToolbarItems([{tab:r.getConstant("Home"),items:e.findBtnId,enable:!1}]);var n,i=this.ribbon.items[this.ribbon.selectedTab].content.length;for(n=0;n<i&&this.ribbon.items[this.ribbon.selectedTab].content[n].id!==this.parent.element.id+"_protectworkbook";n++);t.isProtected?(this.parent.isProtected&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook")&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook").querySelector(".e-tbar-btn-text").textContent===r.getConstant("UnProtectWorkbook")?this.ribbon.items[this.ribbon.selectedTab].header.text===r.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=r.getConstant("UnProtectWorkbook")):this.ribbon.items[this.ribbon.selectedTab].header.text===r.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=r.getConstant("ProtectWorkbook")),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.imageBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Data"),items:e.dataValidationBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Formulas"),items:e.enableFrmlaBtnId,enable:!1}]),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.chartBtnId,enable:!1}])):(this.parent.isProtected&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook")&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook").querySelector(".e-tbar-btn-text").textContent===r.getConstant("UnProtectWorkbook")?this.ribbon.items[this.ribbon.selectedTab].header.text===r.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=r.getConstant("UnProtectWorkbook")):this.ribbon.items[this.ribbon.selectedTab].header.text===r.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=r.getConstant("ProtectWorkbook")),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.imageBtnId,enable:this.parent.allowImage}]),this.enableToolbarItems([{tab:r.getConstant("Data"),items:e.dataValidationBtnId,enable:this.parent.allowDataValidation}]),this.enableToolbarItems([{tab:r.getConstant("Formulas"),items:e.enableFrmlaBtnId,enable:!0}]),this.enableToolbarItems([{tab:r.getConstant("Insert"),items:e.chartBtnId,enable:this.parent.allowChart}]))},e.prototype.updateMergeItem=function(e){if("mousemove"===e.type||"pointermove"===e.type||e.shiftKey&&"mousedown"===e.type){var t=getRangeIndexes(this.parent.getActiveSheet().selectedRange);t[1]===t[3]&&t[0]===t[2]||this.parent.getActiveSheet().isProtected||!this.parent.allowMerge||(this.enableToolbarItems([{tab:this.parent.serviceLocator.getService(locale).getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:!0}]),this.toggleActiveState(!1))}},e.prototype.updateCustomFormats=function(e){if(this.checkNewFormats(e.format.toString())&&e.format.toString().length>0){var t={text:e.format.toString()};this.formatData.push(t)}},e.prototype.addEventListener=function(){this.parent.on(ribbon,this.initRibbon,this),this.parent.on(enableToolbarItems,this.enableToolbarItems,this),this.parent.on(activeCellChanged,this.refreshRibbonContent,this),this.parent.on(updateToggleItem,this.toggleRibbonItems,this),this.parent.on(enableFileMenuItems,this.enableFileMenuItems,this),this.parent.on(hideRibbonTabs,this.hideRibbonTabs,this),this.parent.on(addRibbonTabs,this.addRibbonTabs,this),this.parent.on(addToolbarItems,this.addToolbarItems,this),this.parent.on(hideFileMenuItems,this.hideFileMenuItems,this),this.parent.on(addFileMenuItems,this.addFileMenuItems,this),this.parent.on(hideToolbarItems,this.hideToolbarItems,this),this.parent.on(enableRibbonTabs,this.enableRibbonTabs,this),this.parent.on(protectCellFormat,this.protectSheetHandler,this),this.parent.on(selectionComplete,this.updateMergeItem,this),this.parent.on(refreshRibbonIcons,this.refreshRibbonContent,this),this.parent.on(insertDesignChart,this.insertDesignChart,this),this.parent.on(removeDesignChart,this.removeDesignChart,this),this.parent.on(ribbonFind,this.findToolDlg,this),this.parent.on(blankWorkbook,this.blankWorkbook,this),this.parent.on(updateCustomFormatsFromImport,this.updateCustomFormats,this)},e.prototype.destroy=function(){var e=this.parent.element,t=this.ribbon.element,r=this.cPickerEle,n=e.id;["bold","italic","line-through","underline"].forEach(function(t){destroyComponent(ej2Base.select("#"+n+"_"+t,e),ej2Buttons.Button)}),this.pasteSplitBtn.destroy(),this.pasteSplitBtn=null,this.mergeSplitBtn.destroy(),this.mergeSplitBtn=null,this.numFormatDDB.destroy(),this.numFormatDDB=null,this.fontSizeDdb.destroy(),this.fontSizeDdb=null,this.fontNameDdb.destroy(),this.fontNameDdb=null,this.textAlignDdb.destroy(),this.textAlignDdb=null,this.verticalAlignDdb.destroy(),this.verticalAlignDdb=null,this.sortingDdb.destroy(),this.sortingDdb=null,this.clearDdb.destroy(),this.clearDdb=null,this.colorPicker.destroy(),this.colorPicker=null,this.destroyComponent(n+"_borders_menu","menu"),this.bordersDdb.destroy(),this.bordersDdb=null,this.findDdb.destroy(),this.findDdb=null,this.destroyComponent(n+"_chart_menu","menu"),this.destroyComponent(n+"_chart_type_menu","menu"),this.destroyComponent(n+"_chart-btn","dropdown-btn"),this.destroyComponent(n+"_chart-type-btn","dropdown-btn"),this.destroyComponent(n+"_cf_menu","menu"),this.cFDdb.destroy(),this.cFDdb=null,this.detachPopupElement(n),this.parent.notify("destroyRibbonComponents",null),this.ribbon.destroy(),t&&ej2Base.detach(t),this.ribbon=null,r&&ej2Base.detach(r),this.cPickerEle=null,this.findDialog&&this.findDialog.destroy(),this.removeEventListener()},e.prototype.destroyComponent=function(e,t){var r="string"==typeof e?document.getElementById(e):e;if(r){if("menu"!==t||r.childElementCount){var n=ej2Base.getComponent(r,t);if(n&&(n.destroy(),"dropdown-btn"===t)){var i=document.getElementById(r.id+"-popup");i&&ej2Base.detach(i)}}"menu"===t&&ej2Base.detach(r)}},e.prototype.detachPopupElement=function(e){["_conditionalformatting","_chart-type-btn","_chart-btn","_borders"].forEach(function(t){var r=document.getElementById(""+e+t+"-popup");r&&ej2Base.detach(r)})},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ribbon,this.initRibbon),this.parent.off(enableToolbarItems,this.enableToolbarItems),this.parent.off(activeCellChanged,this.refreshRibbonContent),this.parent.off(updateToggleItem,this.toggleRibbonItems),this.parent.off(enableFileMenuItems,this.enableFileMenuItems),this.parent.off(hideRibbonTabs,this.hideRibbonTabs),this.parent.off(addRibbonTabs,this.addRibbonTabs),this.parent.off(addToolbarItems,this.addToolbarItems),this.parent.off(hideFileMenuItems,this.hideFileMenuItems),this.parent.off(addFileMenuItems,this.addFileMenuItems),this.parent.off(hideToolbarItems,this.hideToolbarItems),this.parent.off(enableRibbonTabs,this.enableRibbonTabs),this.parent.off(protectCellFormat,this.protectSheetHandler),this.parent.off(selectionComplete,this.updateMergeItem),this.parent.off(refreshRibbonIcons,this.refreshRibbonContent),this.parent.off(insertDesignChart,this.insertDesignChart),this.parent.off(removeDesignChart,this.removeDesignChart),this.parent.on(ribbonFind,this.findToolDlg,this),this.parent.off(blankWorkbook,this.blankWorkbook),this.parent.off(updateCustomFormatsFromImport,this.updateCustomFormats))},e}(),FormulaBar=function(){function e(e){this.categoryCollection=[],this.formulaCollection=[],this.isGoto=!1,this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"formulaBar"},e.prototype.createFormulaBar=function(e){if(this.parent.showFormulaBar||!this.insertFnRipple){var t=this.parent.serviceLocator.getService(locale),r=this.parent.element.id,n=this.parent.createElement("div",{className:"e-formula-bar-panel"});if(!this.parent.isMobileView()){var i=this.parent.createElement("input",{id:r+"_name_box",attrs:{type:"text"}});n.appendChild(i),this.comboBoxInstance=new ej2Dropdowns.ComboBox({value:"A1",cssClass:"e-name-box",width:"",noRecordsTemplate:"",fields:{text:"name",value:"refersTo"},beforeOpen:this.nameBoxBeforeOpen.bind(this),blur:this.nameBoxBlur.bind(this),select:this.nameBoxSelect.bind(this),change:function(){}}),this.comboBoxInstance.createElement=this.parent.createElement,this.comboBoxInstance.appendTo(i),this.comboBoxInstance.element.parentElement.title=t.getConstant("NameBox")}n.appendChild(this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-insert-function",attrs:{title:t.getConstant("InsertFunction")}})).appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons"})),this.insertFnRipple=ej2Base.rippleEffect(n,{selector:".e-insert-function"}),n.appendChild(this.parent.createElement("div",{className:"e-separator"}));var o=n.appendChild(this.parent.createElement("textarea",{className:"e-formula-bar e-css",id:r+"_formula_input",attrs:{title:t.getConstant("FormulaBar"),spellcheck:"false"}}));o.rows=1,this.parent.isMobileView()?(o.placeholder=t.getConstant("MobileFormulaBarPlaceHolder"),ej2Base.EventHandler.add(o,"focus",this.textAreaFocusIn,this),ej2Base.EventHandler.add(o,"blur",this.textAreaFocusOut,this)):n.appendChild(this.parent.createElement("span",{className:"e-drop-icon e-icons",attrs:{title:t.getConstant("ExpandFormulaBar")}})),e&&e.uiUpdate?this.parent.element.insertBefore(n,document.getElementById(r+"_sheet_panel")):this.parent.element.appendChild(n)}else this.destroy()},e.prototype.textAreaFocusIn=function(){var e=this.parent.element.querySelector(".e-formula-bar-panel"),t=this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-formula-submit"});t.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-tick-icon"})),e.classList.add("e-focused"),e.appendChild(t)},e.prototype.textAreaFocusOut=function(){var e=this.parent.element.querySelector(".e-formula-bar-panel");e.classList.remove("e-focused"),ej2Base.detach(e.querySelector(".e-formula-submit"))},e.prototype.keyDownHandler=function(e){var t=e.target;if(this.parent.isEdit&&!this.parent.getActiveSheet().isProtected){if((checkIsFormula(t.value)||t.validity&&0===t.value.toString().indexOf("="))&&16===e.keyCode)return;t.classList.contains("e-formula-bar")&&this.parent.notify(editOperation,{action:"refreshEditor",value:t.value,refreshEditorElem:!0})}},e.prototype.keyUpHandler=function(e){if(this.parent.isEdit){var t=e.target;if(t.classList.contains("e-formula-bar")){var r={action:"getCurrentEditValue",editedValue:""};this.parent.notify(editOperation,r),r.editedValue!==t.value&&16!==e.keyCode&&this.parent.notify(editOperation,{action:"refreshEditor",value:t.value,refreshEditorElem:!0})}}},e.prototype.nameBoxBeforeOpen=function(e){this.comboBoxInstance.element.classList.contains("e-name-editing")?e.cancel=!0:this.comboBoxInstance.element.select()},e.prototype.nameBoxBlur=function(){this.comboBoxInstance.element.classList.contains("e-name-editing")&&(this.comboBoxInstance.element.classList.remove("e-name-editing"),this.UpdateValueAfterMouseUp())},e.prototype.nameBoxSelect=function(e){if(e.isInteracted){var t=e.itemData.refersTo.substr(1),r=getSheetIndex(this.parent,getSheetNameFromAddress(t));if(void 0===r)return;var n=getRangeFromAddress(t),i=getSheet(this.parent,r);if(-1!==n.indexOf(":")){var o=n.indexOf(":"),a=n.substr(0,o),s=n.substr(o+1,n.length);a=a.replace("$",""),(s=s.replace("$","")).match(/\D/g)&&!s.match(/[0-9]/g)&&a.match(/\D/g)&&!a.match(/[0-9]/g)?n=(a+="1")+":"+(s+=i.rowCount):!s.match(/\D/g)&&s.match(/[0-9]/g)&&!a.match(/\D/g)&&a.match(/[0-9]/g)&&(n=(a=getCellAddress(parseInt(a,10)-1,0))+":"+(s=getCellAddress(parseInt(s,10)-1,i.colCount-1)))}r===this.parent.activeSheetIndex?(this.parent.selectRange(n),focus(this.parent.element)):(updateSelectedRange(this.parent,n,i),this.parent.activeSheetIndex=r)}},e.prototype.formulaBarUpdateHandler=function(e){var t,r=this,n=this.parent.getActiveSheet().selectedRange.split(":"),i={action:"getElement",element:null};this.parent.notify(editOperation,i);var o=this.parent.element.querySelector(".e-formula-bar"),a=new ej2Base.Internationalization;if("mousemove"===e.type||"pointermove"===e.type){var s=getRangeIndexes(n[0]),l=getRangeIndexes(n[1]);t=Math.abs(s[0]-l[0])+1+"R x "+(Math.abs(s[1]-l[1])+1)+"C",this.parent.isEdit&&(e.target&&!e.target.classList.contains("e-spreadsheet-edit")?this.parent.notify(editValue,null):i.element&&(o.value=i.element.textContent))}else{t=n[0];this.parent.getData(getSheetName(this.parent)+"!"+t).then(function(n){var s,l="";n.forEach(function(n){var d=n&&n.format?getTypeFromFormat(n.format):"General";if(n){if(!ej2Base.isNullOrUndefined(n.value))if("Invalid Date"===(s=intToDate(Number(n.value))).toString()||"ShortDate"!==d&&"LongDate"!==d)"Invalid Date"!==s.toString()&&"Time"===d?(Number(n.value)>=1&&(l=a.formatDate(s,{type:"dateTime",skeleton:"yMd"})+" "),l+=a.formatDate(s,{type:"dateTime",skeleton:"hms"})):l=n.value;else if((l=a.formatDate(s,{type:"date",skeleton:"yMd"}))&&l.indexOf("/")>-1||l.indexOf("-")>0){var p=l.split(/-|\//),h=n?n.format:"";("dd-MM-yyyy"===h||"dd/MM/yyyy"===h)&&Number(p[0])<=12&&Number(p[1])<=31&&(l=p[1]+"/"+p[0]+"/"+p[2])}n.formula&&(l=n.formula)}var c={action:"getCurrentEditValue",editedValue:""};r.parent.notify(editOperation,c);var u=c.editedValue&&0===c.editedValue.toString().indexOf("=")||checkIsFormula(c.editedValue),g=document.getElementById(r.parent.element.id+"_formula_input"),f=getRangeIndexes(t),m=r.parent.getCell(f[0],f[1]);if(!n||n.formula||!m||"Time"===d&&l)g.value=l;else if(void 0===n.value||r.isDateTimeType(n.format)&&n.value&&"Invalid Date"!==intToDate(Number(n.value)).toString()||ej2Base.isNullOrUndefined(n.format)){var v=r.isDateTimeType(n.format);if(v){var C=new ej2Base.Internationalization,y="date"===v?"M/d/yyyy":"h:mm:ss a";"dd-MM-yyyy"!==n.format&&"dd/MM/yyyy"!==n.format||(y=n.format),g.value=C.formatDate(intToDate(parseFloat(n.value)),{type:v,format:y})}else n.validation&&"List"===n.validation.type?g.value=(m.lastElementChild||m).textContent:g.value=m.textContent}else g.value=n.value;ej2Base.isNullOrUndefined(l)||u||r.parent.notify(editOperation,{action:"refreshEditor",value:g.value,refreshEditorElem:!0}),r.parent.isEdit&&(e.target&&!e.target.classList.contains("e-spreadsheet-edit")?r.parent.notify(editValue,null):i.element&&(o.value=i.element.textContent))})})}this.updateComboBoxValue(t)},e.prototype.isDateTimeType=function(e){var t;return[":","hh","h","mm:ss","h:mm:ss"].forEach(function(r){e&&e.indexOf(r)>-1&&(t="time")}),t||(["/","-d","-m","-y","dd","mm","yy"].forEach(function(r){e&&e.indexOf(r)>-1&&(t="date")}),t)},e.prototype.UpdateValueAfterMouseUp=function(){this.updateComboBoxValue(this.parent.getActiveSheet().selectedRange.split(":")[0])},e.prototype.updateComboBoxValue=function(e){var t=this.parent.getActiveSheet(),r={action:"getNameFromRange",range:getSheetName(this.parent)+"!"+t.selectedRange,definedName:null};if(this.parent.notify(formulaOperation,r),r.definedName&&(e=r.definedName.name),!this.parent.isMobileView()){if(this.comboBoxInstance.text===e)return;this.comboBoxInstance.text=e,this.comboBoxInstance.dataBind()}},e.prototype.disabletextarea=function(){var e=this.getFormulaBar();this.parent.getActiveSheet().isProtected?e.disabled=!0:e.disabled=!1},e.prototype.formulaBarScrollEdit=function(){var e=getRangeIndexes(this.parent.getActiveSheet().selectedRange),t=getCellIndexes(this.parent.getActiveSheet().topLeftCell);e[0]<t[0]&&(this.parent.goTo(this.parent.getActiveSheet().selectedRange),this.isGoto=!0),this.parent.notify(editOperation,{action:"startEdit",refreshCurPos:!1})},e.prototype.formulaBarClickHandler=function(e){var t=this,r=e.target,n=this.parent.getActiveSheet(),i=n.isProtected,o=getCellIndexes(n.activeCell),a=isLocked(getCell(o[0],o[1],n),getColumn(n,o[1]));if(r.classList.contains("e-drop-icon")&&ej2Base.closest(r,".e-formula-bar-panel"))this.toggleFormulaBar(r);else if(r.classList.contains("e-formula-bar"))this.parent.isEdit||i&&(!i||a)?i&&a&&this.parent.notify(editAlert,null):this.formulaBarScrollEdit();else if(r.parentElement&&r.parentElement.classList.contains("e-name-box"))if(r.classList.contains("e-ddl-icon")){var s={action:"getNames",names:[]};this.parent.notify(formulaOperation,s),this.comboBoxInstance.dataSource=s.names}else this.comboBoxInstance.element.classList.add("e-name-editing"),this.comboBoxInstance.element.select();if(!ej2Base.isNullOrUndefined(r.offsetParent)&&(r.offsetParent.classList.contains("e-insert-function")||r.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===r.offsetParent.id||this.parent.element.id+"_insert_function"===r.id||r.parentElement.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===r.parentElement.id)){if(i)return void this.parent.notify(editAlert,null);var l=!this.parent.isEdit,d={action:"getCurrentEditValue",editedValue:""};if(!l){s={action:"isFormulaEditing",isFormulaEdit:!1};this.parent.notify(formulaOperation,s),l=s.isFormulaEdit,this.parent.notify(editOperation,d)}if(l||""===d.editedValue){""===d.editedValue&&this.parent.notify(editOperation,{action:"refreshEditor",value:"="});var p=this.parent.serviceLocator.getService(locale),h=this.parent.createElement("div",{className:"e-formula-description",id:this.parent.element.id+"_description_content"}),c=this.parent.createElement("div",{className:"e-category-content",id:this.parent.element.id+"_category_content",innerHTML:p.getConstant("PickACategory")}),u=this.parent.createElement("input",{className:"e-formula-category",id:this.parent.element.id+"_formula_category"}),g=this.parent.createElement("div",{className:"e-formula-list",id:this.parent.element.id+"_formula_list"}),f=this.parent.createElement("div",{className:"e-description-content",innerHTML:p.getConstant("Description")}),m=this.parent.createElement("div",{className:"e-header-content",innerHTML:p.getConstant("InsertFunction")}),v={action:"getFormulaCategory",categoryCollection:[]};this.parent.notify(workbookFormulaOperation,v),this.categoryCollection=v.categoryCollection,this.categoryList=new ej2Dropdowns.DropDownList({dataSource:this.categoryCollection,index:0,width:"285px",popupHeight:"210px",select:this.dropDownSelect.bind(this)});var C={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(workbookFormulaOperation,C),this.formulaCollection=C.formulaCollection,this.formulaList=new ej2Lists.ListView({dataSource:this.formulaCollection.sort(),actionComplete:this.updateFormulaList.bind(this),select:this.listSelected.bind(this),width:"285px",height:"200px"}),this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({header:m.outerHTML,content:c.outerHTML+u.outerHTML+g.outerHTML+f.outerHTML+h.outerHTML,width:"320px",height:"485px",cssClass:"e-spreadsheet-function-dlg",showCloseIcon:!0,isModal:!0,beforeOpen:function(e){var r={dialogName:"InsertFunctionDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0),focus(t.parent.element)},open:this.dialogOpen.bind(this),beforeClose:this.dialogBeforeClose.bind(this),close:this.dialogClose.bind(this),buttons:[{click:this.selectFormula.bind(this,this.dialog,this),buttonModel:{content:p.getConstant("Ok"),isPrimary:!0}}]}),this.categoryList.appendTo("#"+this.parent.element.id+"_formula_category"),this.formulaList.appendTo("#"+this.parent.element.id+"_formula_list"),ej2Base.EventHandler.add(this.formulaList.element,"dblclick",this.formulaClickHandler,this)}}},e.prototype.toggleFormulaBar=function(e){var t=e.parentElement,r=this.parent.serviceLocator.getService(locale);t.classList.contains("e-expanded")?(t.classList.remove("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=1,e.title=r.getConstant("ExpandFormulaBar")):(t.classList.add("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=3,e.title=r.getConstant("CollapseFormulaBar")),this.parent.setPanelSize()},e.prototype.dialogOpen=function(){this.focusOkButton()},e.prototype.dialogClose=function(){var e={action:"getCurrentEditValue",editedValue:""};this.parent.notify(editOperation,e),"="===e.editedValue.toString().trim()&&this.parent.notify(editOperation,{action:"refreshEditor",value:""})},e.prototype.dialogBeforeClose=function(){ej2Base.EventHandler.remove(this.formulaList.element,"dblclick",this.formulaClickHandler);var e=document.getElementsByClassName("e-spreadsheet-function-dlg")[0].querySelector(".e-dlg-content");e.parentNode.removeChild(e),this.dialog.dialogInstance.storeActiveElement=document.getElementById(this.parent.element.id+"_edit")},e.prototype.selectFormula=function(e,t){var r=t.formulaList.getSelectedItems().text,n=getSheet(this.parent,this.parent.activeSheetIndex);this.parent.isEdit?this.parent.notify(editOperation,{action:"refreshEditor",value:r+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(editOperation,{action:"startEdit",value:"="+r+"(",address:n.activeCell}),this.parent.notify(formulaBarOperation,{action:"refreshFormulabar",value:"="+r+"("})),e.hide()},e.prototype.listSelected=function(){this.updateFormulaDescription()},e.prototype.updateFormulaList=function(){this.activeListFormula(),this.updateFormulaDescription()},e.prototype.dropDownSelect=function(e){this.formulaCollection=[];var t={action:"getLibraryFormulas",formulaCollection:[]};if("All"===e.item.textContent)this.parent.notify(workbookFormulaOperation,t),this.formulaCollection=t.formulaCollection;else{var r={action:"dropDownSelectFormulas",formulaCollection:[],selectCategory:e.item.textContent};this.parent.notify(workbookFormulaOperation,r),this.formulaCollection=r.formulaCollection}this.formulaList.dataSource=this.formulaCollection.sort()},e.prototype.focusOkButton=function(){document.getElementsByClassName("e-spreadsheet-function-dlg")[0].querySelector(".e-dlg-content").nextElementSibling.firstElementChild.focus()},e.prototype.activeListFormula=function(){var e=document.getElementById(this.parent.element.id+"_formula_list").children[0].children[0].firstElementChild;this.formulaList.selectItem(e)},e.prototype.updateFormulaDescription=function(){var e=this.formulaList.getSelectedItems().text,t={action:"getFormulaDescription",description:"",selectedList:e};this.parent.notify(workbookFormulaOperation,t),this.focusOkButton();var r=document.getElementById(this.parent.element.id+"_description_content");e="AND"===e?"CalculateAND":"OR"===e?"CalculateOR":e,r.innerHTML=this.parent.serviceLocator.getService(locale).getConstant(e)},e.prototype.formulaClickHandler=function(e){var t=e.target,r=getSheet(this.parent,this.parent.activeSheetIndex);(t.offsetParent.classList.contains("e-text-content")||t.classList.contains("e-list-item"))&&(this.parent.isEdit?this.parent.notify(editOperation,{action:"refreshEditor",value:t.innerText+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(editOperation,{action:"startEdit",value:"="+t.innerText+"(",address:r.activeCell}),this.parent.notify(formulaBarOperation,{action:"refreshFormulabar",value:"="+t.innerText+"("})),this.dialog.hide())},e.prototype.addEventListener=function(){this.parent.on(formulaBar,this.createFormulaBar,this),this.parent.on(click,this.formulaBarClickHandler,this),this.parent.on(keyDown,this.keyDownHandler,this),this.parent.on(keyUp,this.keyUpHandler,this),this.parent.on(selectionComplete,this.formulaBarUpdateHandler,this),this.parent.on(mouseUpAfterSelection,this.UpdateValueAfterMouseUp,this),this.parent.on(formulaBarOperation,this.editOperationHandler,this),this.parent.on(enableFormulaInput,this.disabletextarea,this),this.parent.on(isFormulaBarEdit,this.isFormulaBarEdit,this)},e.prototype.destroy=function(){this.removeEventListener(),this.comboBoxInstance.destroy(),this.comboBoxInstance=null,this.insertFnRipple(),this.insertFnRipple=null;var e=this.parent.element.querySelector(".e-formula-bar-panel");e&&ej2Base.detach(e)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(formulaBar,this.createFormulaBar),this.parent.off(click,this.formulaBarClickHandler),this.parent.off(keyDown,this.keyDownHandler),this.parent.off(keyUp,this.keyUpHandler),this.parent.off(selectionComplete,this.formulaBarUpdateHandler),this.parent.off(mouseUpAfterSelection,this.UpdateValueAfterMouseUp),this.parent.off(formulaBarOperation,this.editOperationHandler),this.parent.off(enableFormulaInput,this.disabletextarea),this.parent.off(isFormulaBarEdit,this.isFormulaBarEdit))},e.prototype.editOperationHandler=function(e){switch(e.action){case"refreshFormulabar":this.getFormulaBar().value=ej2Base.isUndefined(e.value)?"":e.value;break;case"getElement":e.element=this.getFormulaBar()}},e.prototype.isFormulaBarEdit=function(e){this.parent.isEdit&&this.isGoto?e.isEdit=!0:e.isEdit=!1},e.prototype.getFormulaBar=function(){return ej2Base.select("#"+this.parent.element.id+"_formula_input",this.parent.element)},e}(),Formula=function(){function e(e){this.isFormulaBar=!1,this.isFormula=!1,this.isPopupOpened=!1,this.isPreventClose=!1,this.isSubFormula=!1,this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"formula"},e.prototype.destroy=function(){this.removeEventListener(),this.autocompleteInstance&&(this.autocompleteInstance.destroy(),this.autocompleteInstance.element&&this.autocompleteInstance.element.remove()),this.autocompleteInstance=null,this.parent=null},e.prototype.addEventListener=function(){this.parent.on(formulaOperation,this.performFormulaOperation,this),this.parent.on(keyUp,this.keyUpHandler,this),this.parent.on(keyDown,this.keyDownHandler,this),this.parent.on(click,this.formulaClick,this),this.parent.on(refreshFormulaDatasource,this.refreshFormulaDatasource,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(formulaOperation,this.performFormulaOperation),this.parent.off(keyUp,this.keyUpHandler),this.parent.off(keyDown,this.keyDownHandler),this.parent.off(click,this.formulaClick),this.parent.off(refreshFormulaDatasource,this.refreshFormulaDatasource))},e.prototype.performFormulaOperation=function(e){var t=this,r=e.action,n=this.parent.serviceLocator.getService(locale);switch(r){case"renderAutoComplete":this.renderAutoComplete();break;case"endEdit":this.endEdit();break;case"addDefinedName":e.isAdded=this.addDefinedName(e.definedName);break;case"getNames":e.sheetName||(e.sheetName=getSheetName(this.parent)),e.names=this.getNames(e.sheetName);break;case"getNameFromRange":e.definedName=this.getNameFromRange(e.range);break;case"isFormulaEditing":e.isFormulaEdit=this.isFormula;break;case"isCircularReference":this.parent.serviceLocator.getService(dialog).show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:n.getConstant("CircularReference"),beforeOpen:function(e){var r={dialogName:"CircularReferenceDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}}),e.argValue="0"}},e.prototype.renderAutoComplete=function(){if(!ej2Base.select("#"+this.parent.element.id+"_ac",this.parent.element)){var e=this.parent.createElement("input",{id:this.parent.element.id+"_ac",className:"e-ss-ac"});this.parent.element.appendChild(e);var t={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(workbookFormulaOperation,t);var r={dataSource:t.formulaCollection,cssClass:"e-ss-atc",popupWidth:"130px",allowFiltering:!0,filterType:"StartsWith",sortOrder:"Ascending",open:this.onSuggestionOpen.bind(this),close:this.onSuggestionClose.bind(this),select:this.onSelect.bind(this),actionComplete:this.onSuggestionComplete.bind(this)};this.autocompleteInstance=new ej2Dropdowns.AutoComplete(r,e),this.autocompleteInstance.createElement=this.parent.createElement}},e.prototype.onSuggestionOpen=function(e){var t=this;this.isPopupOpened=!0,e.popup.relateTo=this.getRelateToElem(),e.popup.element.firstChild.style.maxHeight="180px",new Promise(function(e,t){setTimeout(function(){e()},100)}).then(function(){t.triggerKeyDownEvent(keyCodes.DOWN)})},e.prototype.onSuggestionClose=function(e){this.isPreventClose?e.cancel=!0:this.isPopupOpened=!1},e.prototype.onSelect=function(e){var t="="+e.itemData.value+"(";if(this.isSubFormula){var r=this.getEditingValue(),n=r.lastIndexOf(this.getArgumentSeparator());n>-1?t=r.slice(0,n+1):(n=r.lastIndexOf("("))>-1&&(t=r.slice(0,n+1)),t+=e.itemData.value+"("}if(this.parent.notify(editOperation,{action:"refreshEditor",value:t,refreshFormulaBar:!0,refreshEditorElem:!0,refreshCurPos:!this.isFormulaBar}),this.isPopupOpened){this.hidePopUp();var i=ej2Base.select("#"+this.parent.element.id+"_ac_popup");i&&ej2Base.detach(i),this.isPopupOpened=!1}},e.prototype.onSuggestionComplete=function(e){this.isPreventClose=e.result.length>0,this.isPreventClose||(e.cancel=!0,this.hidePopUp())},e.prototype.refreshFormulaDatasource=function(){var e={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(workbookFormulaOperation,e),this.autocompleteInstance.dataSource=e.formulaCollection},e.prototype.keyUpHandler=function(e){if(this.parent.isEdit){var t=this.getEditingValue();this.isFormula=checkIsFormula(t),(this.isFormula||this.isPopupOpened)&&(e.keyCode!==keyCodes.TAB&&this.isFormula&&(t=this.getSuggestionKeyFromFormula(t)),this.refreshFormulaSuggestion(e,t))}else this.isPopupOpened&&this.hidePopUp()},e.prototype.keyDownHandler=function(e){var t=e.keyCode;if(this.isFormula){if(this.isPopupOpened)switch(t){case keyCodes.UP:case keyCodes.DOWN:e.preventDefault(),this.triggerKeyDownEvent(t);break;case keyCodes.TAB:e.preventDefault(),this.triggerKeyDownEvent(keyCodes.ENTER)}}else{var r=e.target;if(r.id===this.parent.element.id+"_name_box")switch(t){case keyCodes.ENTER:this.addDefinedName({name:r.value}),focus(this.parent.element);break;case keyCodes.ESC:focus(this.parent.element)}}},e.prototype.formulaClick=function(e){if(this.parent.isEdit){var t=e.target;this.isFormulaBar=t.classList.contains("e-formula-bar")}},e.prototype.refreshFormulaSuggestion=function(e,t){if(t.length>0){var r=this.autocompleteInstance.element,n=e.keyCode,i=this.isPopupOpened;this.isNavigationKey(n)||(r.value=t,r.dispatchEvent(new Event("input")),r.dispatchEvent(new Event("keyup")),i&&this.triggerKeyDownEvent(keyCodes.DOWN))}else this.isPopupOpened&&(this.isPreventClose=!1,this.hidePopUp())},e.prototype.endEdit=function(){if(this.isSubFormula=!1,this.isPreventClose=!1,this.isFormula=!1,this.isFormulaBar=!1,this.isPopupOpened){this.hidePopUp();var e=ej2Base.select("#"+this.parent.element.id+"_ac_popup");e&&ej2Base.detach(e),this.isPopupOpened=!1}},e.prototype.hidePopUp=function(){this.autocompleteInstance.hidePopup()},e.prototype.getSuggestionKeyFromFormula=function(e){var t="";if(e=e.substr(1)){var r=e.lastIndexOf("("),n=(e=e.substr(r+1)).split(this.getArgumentSeparator());1===n.length?(t=n[0],this.isSubFormula=r>-1):(t=n[n.length-1],this.isSubFormula=!0);var i=t.match(/\w/);(!i||i&&0!==i.index)&&(t="")}return t},e.prototype.getRelateToElem=function(){var e={action:"getElement"};return this.isFormulaBar?this.parent.notify(formulaBarOperation,e):this.parent.notify(editOperation,e),e.element},e.prototype.getEditingValue=function(){var e={action:"getCurrentEditValue",editedValue:""};return this.parent.notify(editOperation,e),e.editedValue},e.prototype.isNavigationKey=function(e){return e===keyCodes.UP||e===keyCodes.DOWN||e===keyCodes.LEFT||e===keyCodes.RIGHT},e.prototype.triggerKeyDownEvent=function(e){var t=this.autocompleteInstance.element;t.dispatchEvent(new Event("input"));var r=new Event("keydown");r.keyCode=e,r.which=e,r.altKey=!1,r.shiftKey=!1,r.ctrlKey=!1,t.dispatchEvent(r)},e.prototype.getArgumentSeparator=function(){var e={action:"getArgumentSeparator",argumentSeparator:""};return this.parent.notify(workbookFormulaOperation,e),e.argumentSeparator},e.prototype.getNames=function(e){return this.parent.definedNames.filter(function(t){return"Workbook"===t.scope||""===t.scope||t.scope===e})},e.prototype.getNameFromRange=function(e){var t=e.slice(0,e.indexOf(":")),r=e.slice(e.indexOf("!")+1).split(":"),n=r.length>1&&r[0]===r[1],i=this.parent.definedNames.filter(function(r){return!(!n||r.refersTo!=="="+t)||r.refersTo==="="+e});return i&&i[0]},e.prototype.addDefinedName=function(e){var t=this,r=e.name,n=!1;if(r&&isCellReference(r.toUpperCase()))return this.parent.goTo(r),n;if(!e.refersTo){var i=getSheet(this.parent,this.parent.activeSheetIndex),o=getSheetName(this.parent);o=-1!==o.indexOf(" ")?"'"+o+"'":o;var a=i.selectedRange;if(!ej2Base.isNullOrUndefined(a)){var s=a.indexOf(":"),l=a.substr(0,s),d=a.substr(s+1,a.length);parseInt(d.replace(/\D/g,""),10)===i.rowCount&&1===parseInt(l.replace(/\D/g,""),10)?(d=d.replace(/[0-9]/g,""),a="$"+(l=l.replace(/[0-9]/g,""))+":$"+d):getCellIndexes(d)[1]===i.colCount-1&&0===getCellIndexes(l)[1]?(d=d.replace(/\D/g,""),a="$"+(l=l.replace(/\D/g,""))+":$"+d):a=l===d?l:a}e.refersTo=o+"!"+a,e.scope="Workbook"}if(r.length>0&&/^([a-zA-Z_0-9.]){0,255}$/.test(r)){var p={action:"addDefinedName",definedName:e,isAdded:!1};this.parent.notify(workbookFormulaOperation,p),n=p.isAdded,p.isAdded||this.parent.serviceLocator.getService(dialog).show({content:this.parent.serviceLocator.getService(locale).getConstant("DefineNameExists"),width:"300",beforeOpen:function(e){var r={dialogName:"DefineNameExistsDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}})}else this.parent.serviceLocator.getService(dialog).show({content:this.parent.serviceLocator.getService(locale).getConstant("DefineNameInValid"),width:"300",beforeOpen:function(e){var r={dialogName:"DefineNameInValidDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}});return n},e}(),SheetTabs=function(){function e(e){this.aggregateContent="",this.selaggregateCnt="Sum",this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"sheetTabs"},e.prototype.createSheetTabs=function(){var e=this;if(this.parent.showSheetTabs||!this.tabInstance){var t=this.parent.serviceLocator.getService(locale),r=this.parent.createElement("div",{className:"e-sheet-tab-panel",id:this.parent.element.id+"_sheet_tab_panel"}),n=this.parent.createElement("button",{className:"e-add-sheet-tab e-btn e-css e-flat e-icon-btn"+(this.parent.allowInsert?"":" e-disabled"),attrs:{title:t.getConstant("AddSheet")}});n.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-add-icon"})),n.addEventListener("click",this.addSheetTab.bind(this)),n.disabled=!this.parent.allowInsert,r.appendChild(n),this.addBtnRipple=ej2Base.rippleEffect(r,{selector:".e-add-sheet-tab"});var i=this.parent.createElement("button",{attrs:{title:t.getConstant("ListAllSheets")}});r.appendChild(i),this.parent.element.appendChild(r);var o=this.getSheetTabItems();this.dropDownInstance=new ej2Splitbuttons.DropDownButton({iconCss:"e-icons",items:o.ddbItems,createPopupOnClick:!0,beforeItemRender:function(t){var r=e.parent.sheets[e.dropDownInstance.items.indexOf(t.item)];"Hidden"===r.state?t.element.classList.add("e-hide"):"VeryHidden"===r.state&&(t.element.style.display="none")},select:function(t){return e.updateSheetTab({idx:e.dropDownInstance.items.indexOf(t.item)})},beforeOpen:function(t){return e.beforeOpenHandler(e.dropDownInstance,t.element)},open:function(t){return e.openHandler(e.dropDownInstance,t.element,"left")},cssClass:"e-sheets-list e-flat e-caret-hide",close:function(){return focus(e.parent.element)}}),this.dropDownInstance.createElement=this.parent.createElement,this.dropDownInstance.appendTo(i);var a,s=this.parent.createElement("div",{className:"e-sheet-tab"});this.tabInstance=new ej2Navigations.Tab({selectedItem:this.parent.activeSheetIndex,overflowMode:"Scrollable",items:o.tabItems,scrollStep:250,selecting:function(t){if(t.selectingIndex!==t.selectedIndex)if(a)a=!1;else{var r={currentSheetIndex:t.selectingIndex,previousSheetIndex:t.selectedIndex,cancel:!1};e.parent.notify(beginAction,{eventArgs:r,action:"gotoSheet"}),a=r.cancel}},selected:function(t){if(t.selectedIndex!==t.previousIndex){if(a)return e.tabInstance.selectedItem=t.previousIndex,e.tabInstance.dataBind(),void focus(e.parent.element);if(e.parent.notify(removeDesignChart,{}),e.parent.isEdit){var r=window.getSelection(),n={action:"getCurrentEditValue",editedValue:""};e.parent.notify(editOperation,n);var i=!!n.editedValue&&checkIsFormula(n.editedValue,!0);!i&&r&&r.focusNode&&r.focusNode.classList&&r.focusNode.classList.contains("e-formula-bar-panel")&&(i=checkIsFormula(e.parent.element.querySelector(".e-formula-bar").value,!0)),i||e.parent.endEdit()}e.parent.activeSheetIndex=t.selectedIndex,e.parent.dataBind(),e.updateDropDownItems(t.selectedIndex,t.previousIndex),focus(e.parent.element);var o={action:"registerGridInCalc",sheetID:(t.selectedIndex+1).toString()};e.parent.notify(workbookFormulaOperation,o),e.parent.notify(completeAction,{eventArgs:{previousSheetIndex:t.previousIndex,currentSheetIndex:t.selectedIndex},action:"gotoSheet"})}},created:function(){var t=e.tabInstance.element.querySelector(".e-toolbar-items");t.classList.add("e-sheet-tabs-items"),ej2Base.EventHandler.add(t,"dblclick",e.renameSheetTab,e)}}),r.appendChild(s),this.tabInstance.createElement=this.parent.createElement,this.tabInstance.appendTo(s),ej2Base.EventHandler.remove(this.tabInstance.element,"keydown",this.tabInstance.spaceKeyDown);for(var l,d=o.tabItems.length,p=0;p<d;p++){var h={action:"addSheet",sheetName:"Sheet"+(l=getSheet(this.parent,p)).id,sheetId:l.id,visibleName:l.name};this.parent.notify(workbookFormulaOperation,h)}this.parent.notify(workbookFormulaOperation,{action:"initiateDefinedNames"}),this.parent.notify(protectSheet,null)}else this.destroy()},e.prototype.updateDropDownItems=function(e,t){t>-1&&(this.dropDownInstance.items[t].iconCss=""),this.dropDownInstance.items[e].iconCss="e-selected-icon e-icons",this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0)},e.prototype.beforeOpenHandler=function(e,t){var r=this.parent.viewport.height;parseInt(getComputedStyle(t.firstElementChild).height,10)*e.items.length+2*parseInt(getComputedStyle(t).paddingTop,10)>r&&(t.style.height=r+"px",t.style.overflowY="auto"),t.parentElement.style.visibility="hidden"},e.prototype.openHandler=function(e,t,r){var n,i=t.parentElement;if(-1===ej2Popups.isCollide(i).indexOf("bottom")){n="auto"===t.style.overflowY?this.parent.viewport.height:i.getBoundingClientRect().height;var o=ej2Popups.calculatePosition(e.element,r,"top");"right"===r&&(o.left-=i.getBoundingClientRect().width),i.style.left=o.left+"px",i.style.top=o.top-n+"px"}i.style.visibility=""},e.prototype.getSheetTabItems=function(){var e,t=this,r=[],n=[];return this.parent.sheets.forEach(function(i,o){e=getSheetName(t.parent,o).replace(/</g,"&lt;").replace(/>/g,"&gt;"),r.push({header:{text:e},visible:"Visible"===i.state}),n.push({text:e,iconCss:o===t.parent.activeSheetIndex?"e-selected-icon e-icons":""})}),{tabItems:r,ddbItems:n}},e.prototype.refreshSheetTab=function(){var e=this.getSheetTabItems();this.dropDownInstance.items=e.ddbItems,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.items=e.tabItems,this.tabInstance.selectedItem=this.parent.activeSheetIndex,this.tabInstance.dataBind()},e.prototype.addSheetTab=function(){this.parent.notify(editOperation,{action:"getCurrentEditValue",editedValue:""}),this.parent.notify(insertModel,{model:this.parent,start:this.parent.activeSheetIndex+1,end:this.parent.activeSheetIndex+1,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex+1}),focus(this.parent.element)},e.prototype.insertSheetTab=function(e){this.parent.notify(removeDesignChart,{}),e.preventUpdate&&e.startIdx!==this.tabInstance.selectedItem||(this.dropDownInstance.items[this.tabInstance.selectedItem].iconCss="");for(var t=e.startIdx;t<=e.endIdx;t++){var r=this.parent.sheets[t].name.replace(/</g,"&lt;").replace(/>/g,"&gt;");this.dropDownInstance.items.splice(t,0,{text:r}),this.tabInstance.addTab([{header:{text:r},content:""}],t)}e.preventUpdate&&e.startIdx!==this.tabInstance.selectedItem||(this.dropDownInstance.items[e.startIdx].iconCss="e-selected-icon e-icons"),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),e.preventUpdate?e.startIdx!==this.tabInstance.selectedItem&&this.refreshSheetTab():this.updateSheetTab({idx:e.startIdx})},e.prototype.updateSheetTab=function(e){if("activeSheetChanged"===e.name)e.idx=this.parent.skipHiddenSheets(e.idx);else if("Hidden"===this.parent.sheets[e.idx].state){if(this.parent.isProtected)return;this.parent.setSheetPropertyOnMute(this.parent.sheets[e.idx],"state","Visible"),this.tabInstance.hideTab(e.idx,!1)}this.tabInstance.selectedItem=e.idx,this.tabInstance.dataBind(),this.parent.notify(protectSheet,null)},e.prototype.switchSheetTab=function(e){var t=ej2Base.closest(e.event.target,".e-toolbar-item");if(t){for(var r=t.querySelector(".e-tab-text").textContent,n=[],i=this.parent.element.id+"_cmenu",o=0,a=this.parent.sheets.length;o<a;o++)if(this.parent.sheets[o].name===r){this.parent.activeSheetIndex!==o&&this.updateSheetTab({idx:o});break}e.element.classList.contains("e-contextmenu")&&e.items[0]&&e.items[0].id===this.parent.element.id+"_cmenu_insert_sheet"&&(1===this.skipHiddenSheets()&&n.push(i+"_hide_sheet",i+"_delete_sheet"),this.parent.allowInsert||n.push(i+"_insert_sheet"),!this.parent.allowDelete&&n.indexOf(i+"_delete_sheet")>-1&&n.push(i+"_delete_sheet")),(this.parent.password.length>0||this.parent.isProtected)&&(n.indexOf(i+"_insert_sheet")>-1&&n.push(i+"_insert_sheet"),n.indexOf(i+"_delete_sheet")>-1&&n.push(i+"_delete_sheet"),n.push(i+"_duplicate",i+"_rename")),this.parent.enableContextMenuItems(n,!1,!0)}},e.prototype.skipHiddenSheets=function(){var e=this.parent.sheets.length;return this.parent.sheets.forEach(function(t){"Visible"!==t.state&&--e}),e},e.prototype.renameSheetTab=function(){var e=this.tabInstance.element.querySelector(".e-toolbar-item.e-active");if(e){var t=(e=e.querySelector(".e-text-wrap")).querySelector(".e-tab-text").textContent,r={eventArgs:{name:t,index:this.parent.getActiveSheet().id},action:"renameSheet",cancel:!1};if(this.parent.trigger("actionBegin",r),r.cancel)return;var n=this.parent.createElement("input",{id:this.parent.element.id+"_rename_input",className:"e-input e-sheet-rename",styles:"width: "+e.getBoundingClientRect().width+"px",attrs:{type:"text",name:"Rename",required:"",value:t,spellcheck:"false",maxlength:"31"}});e.firstElementChild.style.display="none",e.appendChild(n),ej2Base.EventHandler.add(document,"mousedown touchstart",this.renameInputFocusOut,this),ej2Base.EventHandler.add(n,"input",this.updateWidth,this),n.focus(),n.setSelectionRange(0,t.length),ej2Base.EventHandler.remove(ej2Base.closest(e,".e-toolbar-items"),"dblclick",this.renameSheetTab)}},e.prototype.updateWidth=function(e){var t=e.target,r=t.value.length,n=t.value.split(" ");if(n.length){var i=n.length-1;r-=i,r+=.5*i}t.style.width=r+"ch"},e.prototype.renameInputFocusOut=function(e){var t=e.target;if("mousedown"!==e.type&&"touchstart"!==e.type||!t.classList.contains("e-sheet-rename")&&!ej2Base.closest(t,".e-dlg-container")){if(t=document.getElementById(this.parent.element.id+"_rename_input"),"keydown"===e.type&&27===e.keyCode)return this.removeRenameInput(t),void focus(this.parent.element);var r=t.value,n=this.parent.serviceLocator.getService(locale);if(r){var i=this.tabInstance.selectedItem;if(r.match(new RegExp(".*[\\[\\]\\*\\\\/\\?].*")))this.showRenameDialog(t,n.getConstant("SheetRenameInvalidAlert"));else{if(this.parent.sheets[i].name!==r)for(var o=0,a=this.parent.sheets.length;o<a;o++)if(o!==this.parent.activeSheetIndex&&this.parent.sheets[o].name.toLowerCase()===r.toLowerCase())return void this.showRenameDialog(t,n.getConstant("SheetRenameAlreadyExistsAlert"));var s=this.removeRenameInput(t);this.parent.sheets[i].name!==r&&(this.parent.setSheetPropertyOnMute(this.parent.sheets[i],"name",r),this.updateSheetName({value:r,idx:i,items:s})),("keydown"===e.type||ej2Base.closest(e.target,".e-spreadsheet"))&&focus(this.parent.element)}}else this.showRenameDialog(t,n.getConstant("SheetRenameEmptyAlert"));this.parent.notify(completeAction,{eventArgs:{index:this.parent.getActiveSheet().id,value:r},action:"renameSheet"})}},e.prototype.updateSheetName=function(e){var t=this.tabInstance.items[e.idx].header.text.replace(/&lt;/g,"<").replace(/&gt;/g,">"),r=e.value.replace(/</g,"&lt;").replace(/>/g,"&gt;");this.tabInstance.items[e.idx].header.text=r,this.dropDownInstance.items[e.idx].text=r,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),e.items.querySelector(".e-toolbar-item.e-active .e-tab-text").textContent="",e.items.querySelector(".e-toolbar-item.e-active .e-tab-text").appendChild(document.createTextNode(e.value)),e.value.indexOf("  ")>-1?this.tabInstance.setProperties({items:this.tabInstance.items},!0):this.tabInstance.dataBind(),this.parent.notify(workbookFormulaOperation,{action:"renameUpdation",value:e.value,pName:t})},e.prototype.hideSheet=function(){this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"state","Hidden"),this.tabInstance.hideTab(this.parent.activeSheetIndex)},e.prototype.removeRenameInput=function(e){var t=e.parentElement.querySelector(".e-tab-text"),r=ej2Base.closest(e,".e-toolbar-items");return ej2Base.EventHandler.add(r,"dblclick",this.renameSheetTab,this),ej2Base.EventHandler.remove(document,"mousedown touchstart",this.renameInputFocusOut),ej2Base.EventHandler.remove(e,"input",this.updateWidth),ej2Base.remove(e),t.style.display="",r},e.prototype.showRenameDialog=function(e,t){var r=this;this.parent.serviceLocator.getService(dialog).show({target:document.getElementById(this.parent.element.id+"_sheet_panel"),height:180,width:400,isModal:!0,showCloseIcon:!0,content:t,beforeOpen:function(t){var n={dialogName:"SheetRenameDialog",element:t.element,target:t.target,cancel:t.cancel};r.parent.trigger("dialogBeforeOpen",n),n.cancel&&(t.cancel=!0),e.focus()},close:function(){return e.setSelectionRange(0,e.value.length)}})},e.prototype.focusRenameInput=function(){var e=document.getElementById(this.parent.element.id+"_rename_input");e&&e.focus()},e.prototype.removeSheetTab=function(e){var t=this;if(!e.count||e.count!==this.parent.sheets.length){var r=this.parent.serviceLocator.getService(locale);if(this.skipHiddenSheets()>1){var n=e.sheetName?getSheet(this.parent,getSheetIndex(this.parent,e.sheetName)):this.parent.getActiveSheet(),i=e.index||getSheetIndex(this.parent,n.name),o={index:i,sheetCount:this.parent.sheets.length,sheetName:n.name};if(!(!n.rows||!n.rows.length)&&(1!==n.rows.length||!(!n.rows[0].cells||!n.rows[0].cells.length))){var a=this.parent.serviceLocator.getService(dialog);e.clicked?this.forceDelete(i):a.show({height:200,width:400,isModal:!0,showCloseIcon:!0,content:r.getConstant("DeleteSheetAlert"),beforeOpen:function(e){var r={dialogName:"DeleteSheetDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0),focus(t.parent.element)},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0},click:function(){a.hide(),t.forceDelete(i),t.parent.notify(clearUndoRedoCollection,null),e&&!e.isAction&&(o.sheetCount=t.parent.sheets.length,t.parent.notify(completeAction,{eventArgs:o,action:"removeSheet"}))}}]})}else this.parent.notify(workbookFormulaOperation,{action:"deleteSheetTab",sheetId:getSheet(this.parent,i).id}),this.destroySheet(i),this.parent.notify(clearUndoRedoCollection,null),e&&!e.isAction&&(o.sheetCount=this.parent.sheets.length,this.parent.notify(completeAction,{eventArgs:o,action:"removeSheet"}))}else this.parent.serviceLocator.getService(dialog).show({target:document.getElementById(this.parent.element.id+"_sheet_panel"),height:180,width:400,isModal:!0,showCloseIcon:!0,content:r.getConstant("DeleteSingleLastSheetAlert"),beforeOpen:function(e){var r={dialogName:"DeleteSingleSheetDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0),focus(t.parent.element)}})}},e.prototype.forceDelete=function(e){this.parent.notify(removeDesignChart,{}),this.parent.notify(workbookFormulaOperation,{action:"deleteSheetTab",sheetId:getSheet(this.parent,e).id}),this.destroySheet(e)},e.prototype.destroySheet=function(e){var t=e||this.parent.activeSheetIndex;this.parent.removeSheet(t),this.parent.notify(sheetsDestroyed,{sheetIndex:t}),this.dropDownInstance.items.splice(t,1),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.removeTab(t);var r=this.parent.skipHiddenSheets(this.tabInstance.selectedItem);this.parent.activeSheetIndex=r,this.parent.setProperties({activeSheetIndex:r},!0),this.parent.renderModule.refreshSheet(),this.tabInstance.selectedItem=r,this.tabInstance.dataBind(),this.updateDropDownItems(r),this.parent.notify(protectSheet,null),focus(this.parent.element)},e.prototype.showAggregate=function(){var e=this;if(!isSingleCell(getRangeIndexes(this.parent.getActiveSheet().selectedRange))){var t={Count:0,Sum:"0",Avg:"0",Min:"0",Max:"0",countOnly:!0};if(this.parent.notify(aggregateComputation,t),t.Count>1){this.aggregateContent=t.countOnly?"Count":this.selaggregateCnt,t.countOnly&&(this.aggregateContent="Count",delete t.Sum,delete t.Avg,delete t.Min,delete t.Max);var r=t.countOnly?"e-aggregate-list e-flat e-aggregate-list-countonly e-caret-hide":"e-aggregate-list e-flat";delete t.countOnly;var n=this.aggregateContent,i=n+": "+t[n];if(this.aggregateDropDown)this.updateAggregateContent(i,t);else{var o=this.parent.createElement("button",{id:this.parent.element.id+"_aggregate"});document.getElementById(this.parent.element.id+"_sheet_tab_panel").appendChild(o),this.aggregateDropDown=new ej2Splitbuttons.DropDownButton({content:i,items:this.getAggregateItems(t),createPopupOnClick:!0,select:function(r){e.parent.notify(aggregateComputation,t),e.updateAggregateContent(r.item.text,{Count:t.Count,Sum:t.Sum,Avg:t.Avg,Min:t.Min,Max:t.Max},!0)},beforeOpen:function(t){return e.beforeOpenHandler(e.aggregateDropDown,t.element)},open:function(t){return e.openHandler(e.aggregateDropDown,t.element,"right")},close:function(){return focus(e.parent.element)},cssClass:r}),this.aggregateDropDown.createElement=this.parent.createElement,this.aggregateDropDown.appendTo(o)}}else this.removeAggregate()}},e.prototype.getAggregateItems=function(e){var t,r,n=this,i=[];return Object.keys(e).forEach(function(o){e[o]!==aggregateComputation&&(t=o+": "+e[o],r=o===n.aggregateContent?"e-selected-icon e-icons":"",i.push({text:t,iconCss:r}))}),i},e.prototype.updateAggregateContent=function(e,t,r){this.aggregateContent=e.split(": ")[0],r&&(this.selaggregateCnt=e.split(": ")[0]),this.aggregateDropDown.content=e,this.aggregateDropDown.dataBind(),this.aggregateDropDown.setProperties({items:this.getAggregateItems(t)},!0)},e.prototype.removeAggregate=function(){ej2Base.isNullOrUndefined(this.aggregateDropDown)||(this.aggregateDropDown.destroy(),ej2Base.remove(this.aggregateDropDown.element),this.aggregateDropDown=null)},e.prototype.addEventListener=function(){this.parent.on(sheetTabs,this.createSheetTabs,this),this.parent.on(refreshSheetTabs,this.refreshSheetTab,this),this.parent.on(insertSheetTab,this.insertSheetTab,this),this.parent.on(removeSheetTab,this.removeSheetTab,this),this.parent.on(renameSheetTab,this.renameSheetTab,this),this.parent.on(cMenuBeforeOpen,this.switchSheetTab,this),this.parent.on(activeSheetChanged,this.updateSheetTab,this),this.parent.on(renameSheet,this.renameInputFocusOut,this),this.parent.on(activeCellChanged,this.removeAggregate,this),this.parent.on(onVerticalScroll,this.focusRenameInput,this),this.parent.on(onHorizontalScroll,this.focusRenameInput,this),this.parent.on(sheetNameUpdate,this.updateSheetName,this),this.parent.on(hideSheet,this.hideSheet,this),this.parent.on(showAggregate,this.showAggregate,this)},e.prototype.destroy=function(){this.removeEventListener(),this.dropDownInstance.destroy(),this.dropDownInstance=null,this.tabInstance.destroy(),this.tabInstance=null,this.removeAggregate(),this.aggregateContent=null,this.addBtnRipple(),this.addBtnRipple=null,ej2Base.EventHandler.remove(document,"mousedown touchstart",this.renameInputFocusOut);var e=document.getElementById(this.parent.element.id+"_sheet_tab_panel");e&&ej2Base.remove(e),this.parent=null},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(sheetTabs,this.createSheetTabs),this.parent.off(refreshSheetTabs,this.refreshSheetTab),this.parent.off(insertSheetTab,this.insertSheetTab),this.parent.off(removeSheetTab,this.removeSheetTab),this.parent.off(renameSheetTab,this.renameSheetTab),this.parent.off(cMenuBeforeOpen,this.switchSheetTab),this.parent.off(activeSheetChanged,this.updateSheetTab),this.parent.off(renameSheet,this.renameInputFocusOut),this.parent.off(activeCellChanged,this.removeAggregate),this.parent.off(onVerticalScroll,this.focusRenameInput),this.parent.off(onHorizontalScroll,this.focusRenameInput),this.parent.off(sheetNameUpdate,this.updateSheetName),this.parent.off(hideSheet,this.hideSheet),this.parent.off(showAggregate,this.showAggregate))},e}(),Open=function(){function e(e){this.isImportedFile=!1,this.unProtectSheetIdx=[],this.parent=e,this.addEventListener(),this.renderFileUpload()}return e.prototype.addEventListener=function(){this.parent.on(openSuccess,this.openSuccess,this),this.parent.on(openFailure,this.openFailed,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(openSuccess,this.openSuccess),this.parent.off(openFailure,this.openFailed))},e.prototype.renderFileUpload=function(){var e=this.parent.element.id+"_fileUpload";this.parent.element.appendChild(this.parent.createElement("input",{id:e,attrs:{type:"file",accept:".xls, .xlsx, .csv, .xlsm",name:"fileUpload"}}));var t=document.getElementById(e);t.onchange=this.fileSelect.bind(this),t.onerror=this.openFailed.bind(this),t.style.display="none"},e.prototype.fileSelect=function(e){var t=e.target.files[0];if(!(t&&t.length<1)){var r={file:t};this.parent.open(r),document.getElementById(this.parent.element.id+"_fileUpload").value=""}},e.prototype.openSuccess=function(e){var t=this,r=["UnsupportedFile","InvalidUrl","NeedPassword","InCorrectPassword","InCorrectSheetPassword","CorrectSheetPassword"];if(r.indexOf(e.data)>-1)if(r[2]===e.data)this.parent.element.querySelector(".e-importprotectworkbook-dlg")||this.parent.notify(importProtectWorkbook,e.eventArgs);else if(r[3]===e.data){var n=this.parent.serviceLocator.getService(locale),i=this.parent.createElement("span",{className:"e-importprotectpwd-alert-span",innerHTML:n.getConstant("InCorrectPassword")});this.parent.element.querySelector(".e-importprotectworkbook-dlg").querySelector(".e-dlg-content").appendChild(i)}else if(r[4]===e.data){n=this.parent.serviceLocator.getService(locale),i=this.parent.createElement("span",{className:"e-unprotectsheetpwd-alert-span",innerHTML:n.getConstant("InCorrectPassword")});this.parent.element.querySelector(".e-unprotectworksheet-dlg").querySelector(".e-dlg-content").appendChild(i)}else{if(r[5]!==e.data){return this.parent.serviceLocator.getService(dialog).hide(),this.parent.serviceLocator.getService(dialog).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant(e.data),width:"300",beforeOpen:function(e){var r={dialogName:"OpenDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}}),void this.parent.hideSpinner()}this.parent.isOpen=!1,this.parent.notify(unProtectSheetPassword,null);this.parent.serviceLocator.getService(dialog).hide(),this.parent.hideSpinner()}else{this.parent.serviceLocator.getService(dialog).hide(),this.parent.showSpinner()}this.parent.element&&r[5]!==e.data&&(e.isOpenFromJson||(this.parent.trigger("openComplete",{response:e}),this.parent.notify(completeAction,{response:e,action:"import"})),this.parent.renderModule.refreshSheet(e.isOpenFromJson),this.parent.notify(refreshSheetTabs,this),this.isImportedFile=!0,this.unProtectSheetIdx=[],this.parent.hideSpinner())},e.prototype.openFailed=function(e){this.parent.trigger("openFailure",e),this.parent.hideSpinner()},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"open"},e}(),Save=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(beginSave,this.initiateSave,this),this.parent.on(saveCompleted,this.saveCompleted,this),this.parent.on(saveError,this.showErrorDialog,this),this.parent.on(exportDialog,this.exportDialog,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(beginSave,this.initiateSave),this.parent.off(saveCompleted,this.saveCompleted),this.parent.off(saveError,this.showErrorDialog),this.parent.off(exportDialog,this.exportDialog))},e.prototype.getModuleName=function(){return"save"},e.prototype.initiateSave=function(){this.parent.showSpinner()},e.prototype.saveCompleted=function(){this.parent.hideSpinner()},e.prototype.showErrorDialog=function(e){var t=this;this.parent.serviceLocator.getService(dialog).show({target:this.parent.element,isModal:!0,showCloseIcon:!0,height:180,width:400,content:e.content,beforeOpen:function(){return focus(t.parent.element)}})},e.prototype.exportDialog=function(e){var t=this,r=this.parent.serviceLocator.getService(locale),n=this.parent.serviceLocator.getService(dialog),i=e?e.item.id.split("_")[1]:"xlsx";if(ej2Base.isNullOrUndefined(this.parent.element.querySelector(".e-find-dlg"))){var o={isModal:!0,showCloseIcon:!0,cssClass:"e-open-dlg",allowDragging:!1,header:r.getConstant("SaveAs"),beforeOpen:function(e){var o={dialogName:r.getConstant("SaveAs"),element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",o),o.cancel&&(e.cancel=!0),n.dialogInstance.content=t.OpenContent(i),n.dialogInstance.dataBind(),t.parent.element.querySelector(".e-text-open").setSelectionRange(0,t.parent.element.querySelector(".e-text-open").value.length),focus(t.parent.element)},buttons:[{buttonModel:{content:r.getConstant("Save"),isPrimary:!0,cssClass:"e-btn-open-ok"},click:function(){var r=t.parent.element.querySelector(".e-text-open").value;if(t.checkValidName(r)){n.hide();var i=e?e.item.id.split(t.parent.element.id+"_")[1]:"Xlsx";t.parent.save({saveType:i,fileName:r})}else{var o=t.parent.element.querySelector(".e-btn-open-ok");ej2Base.getComponent(o,"btn").disabled=!0;var a=t.parent.serviceLocator.getService(locale),s=0===r.length?a.getConstant("EmptyFileName"):r.length>218?a.getConstant("LargeName"):a.getConstant("FileNameError"),l=t.parent.createElement("span",{className:"e-file-alert-span",innerHTML:s});t.parent.element.querySelector(".e-file-alert-span")&&t.parent.element.querySelector(".e-file-alert-span").remove(),t.parent.element.querySelector(".e-open-dlg").querySelector(".e-dlg-content").appendChild(l)}}}],close:function(){n.hide()}};n.show(o)}else n.hide()},e.prototype.checkValidName=function(e){var t=!0;return(e.match(new RegExp('.*[\\[\\]\\*\\\\/\\?\\:\\<\\>\\|\\"].*'))||e.length<1||e.length>218)&&(t=!1),t},e.prototype.OpenContent=function(e){var t=this,r=this.parent.serviceLocator.getService(locale),n=this.parent.createElement("div",{className:"e-open-dialog"}),i=this.parent.createElement("div",{className:"e-open-head"}),o=this.parent.createElement("div",{className:"e-input-group"});n.appendChild(i),n.appendChild(o);var a=this.parent.createElement("p",{className:"e-header",innerHTML:r.getConstant("FileName")}),s=this.parent.createElement("input",{className:"e-input e-text-open",attrs:{type:"Text"}}),l=this.parent.createElement("span",{className:"e-input-group-icon"});return s.onkeyup=function(e){if(t.parent.element.querySelector(".e-file-alert-span")&&13!==e.keyCode){var r=t.parent.element.querySelector(".e-btn-open-ok");ej2Base.getComponent(r,"btn").disabled=!1,t.parent.element.querySelector(".e-file-alert-span").remove()}},i.appendChild(a),l.textContent="."+e.toLowerCase(),o.appendChild(s),s.setAttribute("value","Sample"),o.appendChild(l),n},e}(),ContextMenu$1=function(){function e(e){this.parent=e,this.init()}return e.prototype.init=function(){this.initContextMenu(),this.addEventListener()},e.prototype.initContextMenu=function(){var e=document.createElement("ul");e.id=this.parent.element.id+"_contextmenu",this.parent.element.appendChild(e),this.contextMenuInstance=new ej2Navigations.ContextMenu({cssClass:"e-spreadsheet-contextmenu",target:"#"+this.parent.element.id,filter:"e-numericcontainer e-active-cell e-selection e-row e-header-row e-select-all-cell e-sheet-tabs-items",select:this.selectHandler.bind(this),beforeOpen:this.beforeOpenHandler.bind(this),beforeClose:this.beforeCloseHandler.bind(this)},e)},e.prototype.beforeCloseHandler=function(e){this.parent.trigger("contextMenuBeforeClose",e)},e.prototype.selectHandler=function(e){var t=ej2Base.extend({cancel:!1},e);this.parent.trigger("contextMenuItemSelect",t);var r,n,i,o=this.parent.element.id+"_cmenu";if(!t.cancel){var a=void 0;switch(e.item.id){case o+"_cut":this.parent.notify(cut,{invokeCopy:!0,promise:Promise});break;case o+"_copy":this.parent.notify(copy,{invokeCopy:!0,promise:Promise});break;case o+"_paste":this.parent.notify(paste,{isAction:!0,isInternal:!0});break;case o+"_pastevalues":this.parent.notify(paste,{type:"Values",isAction:!0,isInternal:!0});break;case o+"_pasteformats":this.parent.notify(paste,{type:"Formats",isAction:!0,isInternal:!0});break;case o+"_rename":this.parent.notify(renameSheetTab,{});break;case o+"_delete_sheet":this.parent.notify(removeSheetTab,{});break;case o+"_insert_sheet":this.parent.notify(insertModel,{model:this.parent,start:this.parent.activeSheetIndex,end:this.parent.activeSheetIndex,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex});break;case o+"_hide_sheet":this.parent.notify(hideSheet,null);break;case o+"_duplicate":duplicateSheet(this.parent,void 0,!0);break;case o+"_move_right":moveSheet(this.parent,this.parent.activeSheetIndex+1,null,!0);break;case o+"_move_left":moveSheet(this.parent,this.parent.activeSheetIndex-1,null,!0);break;case o+"_ascending":this.parent.notify(applySort,null);break;case o+"_descending":this.parent.notify(applySort,{sortOptions:{sortDescriptors:{order:"Descending"}}});break;case o+"_customsort":this.parent.notify(initiateCustomSort,null);break;case o+"_filtercellvalue":this.parent.notify(filterByCellValue,null);break;case o+"_clearfilter":r=getColumnHeaderText(getCellIndexes(this.parent.getActiveSheet().activeCell)[1]+1),this.parent.notify(clearFilter,{field:r});break;case o+"_reapplyfilter":this.parent.notify(reapplyFilter,null);break;case o+"_hide_row":a=getRangeIndexes(this.parent.getActiveSheet().selectedRange),this.parent.notify(hideShow,{startIndex:a[0],endIndex:a[2],hide:!0,isCol:!1,actionUpdate:!0}),focus(this.parent.element);break;case o+"_unhide_row":a=getRangeIndexes(this.parent.getActiveSheet().selectedRange),this.parent.notify(hideShow,{startIndex:a[0],endIndex:a[2],hide:!1,isCol:!1,actionUpdate:!0}),focus(this.parent.element);break;case o+"_hide_column":a=getRangeIndexes(this.parent.getActiveSheet().selectedRange),this.parent.notify(hideShow,{startIndex:a[1],endIndex:a[3],hide:!0,isCol:!0,actionUpdate:!0}),focus(this.parent.element);break;case o+"_unhide_column":a=getRangeIndexes(this.parent.getActiveSheet().selectedRange),this.parent.notify(hideShow,{startIndex:a[1],endIndex:a[3],hide:!1,isCol:!0,actionUpdate:!0}),focus(this.parent.element);break;case o+"_insert_row_above":case o+"_delete_row":a=getRangeIndexes(this.parent.getActiveSheet().selectedRange),this.parent.notify(e.item.id.substr(o.length+1,6)+"Model",{model:this.parent.getActiveSheet(),start:a[0],end:a[2],modelType:"Row",isAction:!0,insertType:"above"}),focus(this.parent.element);break;case o+"_insert_row_below":a=getSwapRange(getRangeIndexes(this.parent.getActiveSheet().selectedRange)),this.parent.notify(insertModel,{model:this.parent.getActiveSheet(),start:a[2]+1,end:a[2]+1+(a[2]-a[0]),modelType:"Row",isAction:!0,insertType:"below"}),focus(this.parent.element);break;case o+"_insert_column_before":case o+"_delete_column":a=getRangeIndexes(this.parent.getActiveSheet().selectedRange),this.parent.notify(e.item.id.substr(o.length+1,6)+"Model",{model:this.parent.getActiveSheet(),start:a[1],end:a[3],modelType:"Column",isAction:!0,insertType:"before"}),focus(this.parent.element);break;case o+"_insert_column_after":a=getSwapRange(getRangeIndexes(this.parent.getActiveSheet().selectedRange)),this.parent.notify(insertModel,{model:this.parent.getActiveSheet(),start:a[3]+1,end:a[3]+1+(a[3]-a[1]),modelType:"Column",isAction:!0,insertType:"after"}),focus(this.parent.element);break;case o+"_hyperlink":this.parent.notify(initiateHyperlink,null);break;case o+"_editHyperlink":this.parent.notify(editHyperlink,null);break;case o+"_openHyperlink":this.parent.notify(openHyperlink,null);break;case o+"_removeHyperlink":this.parent.removeHyperlink(this.parent.getActiveSheet().selectedRange);break;case o+"_protect":n=this.parent.getActiveSheet(),this.parent.setSheetPropertyOnMute(n,"isProtected",!n.isProtected),i=!n.isProtected,this.parent.notify(applyProtect,{isActive:i})}}},e.prototype.getInsertModel=function(e,t){for(var r=[],n=e;n<=t;n++)n===e?r.push({index:n}):r.push({});return r},e.prototype.beforeOpenHandler=function(e){var t,r=e.event.target,n=this.getTarget(r);if(e.element.classList.contains("e-contextmenu")){var i=this.parent.getActiveSheet();if(e.event.target&&(r.classList.contains("e-rowresize")||r.classList.contains("e-colresize"))){var o=getRangeIndexes(i.selectedRange);if(!(r.classList.contains("e-rowresize")?0===o[1]&&o[3]===i.colCount-1:0===o[0]&&o[2]===i.rowCount-1))return void(e.cancel=!0);t=(r.classList.contains("e-rowresize")?this.parent.hiddenCount(o[0],o[2])!==Math.abs(o[2]-o[0])+1:this.parent.hiddenCount(o[1],o[3],"columns")!==Math.abs(o[3]-o[1])+1)?this.getDataSource(n):this.getDataSource(n,r)}else{if("Content"===n){var a=0===(o=getRangeIndexes(i.selectedRange))[1]&&o[3]===i.colCount-1,s=0===o[0]&&o[2]===i.rowCount-1;n=a&&s?"SelectAll":a?"RowHeader":s?"ColumnHeader":"Content"}t=this.getDataSource(n)}this.contextMenuInstance.items=t,this.contextMenuInstance.dataBind()}else t=e.items;if("ColumnHeader"===n||"RowHeader"===n){if(e.element&&e.element.childElementCount>0){var l="ColumnHeader"===n?e.element.querySelector("#"+this.parent.element.id+"_cmenu_insert_column"):e.element.querySelector("#"+this.parent.element.id+"_cmenu_insert_row"),d="ColumnHeader"===n?e.element.querySelector("#"+this.parent.element.id+"_cmenu_delete_column"):e.element.querySelector("#"+this.parent.element.id+"_cmenu_delete_row");this.parent.allowInsert&&l.classList.contains("e-disabled")?l.classList.remove("e-disabled"):this.parent.allowInsert&&!this.parent.element.querySelector(".e-selectall.e-highlight")||l.classList.contains("e-disabled")||l.classList.add("e-disabled"),this.parent.allowDelete&&d.classList.contains("e-disabled")?d.classList.remove("e-disabled"):this.parent.allowDelete||d.classList.contains("e-disabled")||d.classList.add("e-disabled")}}else if("Footer"===n){var p=getSheetIndex(this.parent,r.textContent);0===p&&e.element.querySelector("#"+this.parent.element.id+"_cmenu_move_left").classList.add("e-disabled"),p===this.parent.sheets.length-1&&e.element.querySelector("#"+this.parent.element.id+"_cmenu_move_right").classList.add("e-disabled")}this.parent.trigger("contextMenuBeforeOpen",e),this.parent.notify(cMenuBeforeOpen,ej2Base.extend(e,{target:n,items:t}))},e.prototype.getTarget=function(e){return ej2Base.closest(e,".e-sheet-content")?"Content":ej2Base.closest(e,".e-column-header")?e.classList.contains("e-header-cell")?"ColumnHeader":"Content":ej2Base.closest(e,".e-row-header")?e.classList.contains("e-header-cell")?"RowHeader":"Content":ej2Base.closest(e,".e-sheet-tabs-items")?"Footer":ej2Base.closest(e,".e-selectall-container")?e.classList.contains("e-header-cell")?ej2Base.closest(e,".e-header-row")?"ColumnHeader":"RowHeader":ej2Base.closest(e,".e-select-all-cell")?"SelectAll":"Content":""},e.prototype.getDataSource=function(e,t){var r=this.parent.serviceLocator.getService(locale),n=[],i=this.parent.element.id+"_cmenu";if("Content"===e)this.setClipboardData(n,r,i),n.push({separator:!0}),this.setFilterItems(n,i),this.setSortItems(n,i),n.push({separator:!0}),this.setHyperLink(n,i);else if("RowHeader"===e){this.setClipboardData(n,r,i);var o=getRangeIndexes((a=this.parent.getActiveSheet()).selectedRange);this.setInsertDeleteItems(n,r,"Row",i,[o[0],o[2]],["Above","Below"]),a.frozenRows||a.frozenColumns||t&&!t.classList.contains("e-rowresize")&&t.parentElement&&t.parentElement.classList.value.includes("e-hide")||this.setHideShowItems(n,r,"Row",i,[o[0],o[2]])}else if("ColumnHeader"===e){this.setClipboardData(n,r,i);var a;o=getRangeIndexes((a=this.parent.getActiveSheet()).selectedRange);this.setInsertDeleteItems(n,r,"Column",i,[o[1],o[3]],["Before","After"]),a.frozenRows||a.frozenColumns||t&&t.classList.value.includes("e-hide")||this.setHideShowItems(n,r,"Column",i,[o[1],o[3]])}else"SelectAll"===e?(this.setClipboardData(n,r,i),this.setFilterItems(n,i),this.setSortItems(n,i)):"Footer"===e&&(n.push({text:r.getConstant("Insert"),id:i+"_insert_sheet"}),n.push({text:r.getConstant("Delete"),iconCss:"e-icons e-delete",id:i+"_delete_sheet"}),n.push({text:r.getConstant("DuplicateSheet"),id:i+"_duplicate"}),n.push({text:r.getConstant("Rename"),id:i+"_rename"}),n.push({text:r.getConstant("Hide"),id:i+"_hide_sheet"}),this.setProtectSheetItems(n,i),n.push({text:r.getConstant("MoveRight"),id:i+"_move_right"}),n.push({text:r.getConstant("MoveLeft"),id:i+"_move_left"}));return n},e.prototype.setProtectSheetItems=function(e,t){var r=this.parent.serviceLocator.getService(locale);this.parent.getActiveSheet().isProtected?e.push({text:r.getConstant("UnprotectSheet"),id:t+"_protect",iconCss:"e-icons e-protect-icon"}):e.push({text:r.getConstant("ProtectSheet"),id:t+"_protect",iconCss:"e-icons e-protect-icon"})},e.prototype.setFilterItems=function(e,t){if(this.parent.allowFiltering){var r=this.parent.serviceLocator.getService(locale),n={clearFilterText:null,isFiltered:!1};this.parent.notify(getFilteredColumn,n),e.push({text:r.getConstant("Filter"),id:t+"_filter",iconCss:"",items:[{text:n.clearFilterText,iconCss:"e-icons e-filter-clear",id:t+"_clearfilter"},{text:r.getConstant("ReapplyFilter"),iconCss:"e-icons e-filter-reapply",id:t+"_reapplyfilter"},{separator:!0},{text:r.getConstant("FilterCellValue"),iconCss:"",id:t+"_filtercellvalue"}]})}},e.prototype.setSortItems=function(e,t){var r=this.parent.serviceLocator.getService(locale);this.parent.allowSorting&&e.push({text:r.getConstant("Sort"),id:t+"_sort",iconCss:"e-icons e-sort-icon",items:[{text:r.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc",id:t+"_ascending"},{text:r.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc",id:t+"_descending"},{text:r.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom",id:t+"_customsort"}]})},e.prototype.setHyperLink=function(e,t){var r=this.parent.getActiveSheet();if(this.parent.allowHyperlink){var n=this.parent.serviceLocator.getService(locale);!document.activeElement.getElementsByClassName("e-hyperlink")[0]&&!document.activeElement.classList.contains("e-hyperlink")||r.isProtected&&!r.protectSettings.insertLink?e.push({text:n.getConstant("Hyperlink"),iconCss:"e-icons e-hyperlink-icon",id:t+"_hyperlink"}):e.push({text:n.getConstant("EditHyperlink"),iconCss:"e-icons e-edithyperlink-icon",id:t+"_editHyperlink"},{text:n.getConstant("OpenHyperlink"),iconCss:"e-icons e-openhyperlink-icon",id:t+"_openHyperlink"},{text:n.getConstant("RemoveHyperlink"),iconCss:"e-icons e-removehyperlink-icon",id:t+"_removeHyperlink"})}},e.prototype.setClipboardData=function(e,t,r){this.parent.enableClipboard&&(e.push({text:t.getConstant("Cut"),iconCss:"e-icons e-cut-icon",id:r+"_cut"}),e.push({text:t.getConstant("Copy"),iconCss:"e-icons e-copy-icon",id:r+"_copy"}),e.push({text:t.getConstant("Paste"),iconCss:"e-icons e-paste-icon",id:r+"_paste"}),e.push({text:t.getConstant("PasteSpecial"),id:r+"_pastespecial",items:[{text:t.getConstant("Values"),id:r+"_pastevalues"},{text:t.getConstant("Formats"),id:r+"_pasteformats"}]}))},e.prototype.setInsertDeleteItems=function(e,t,r,n,i,o){e.push({separator:!0}),["Insert","Delete"].forEach(function(a){i[0]===i[1]?e.push({text:t.getConstant(""+a+r),id:n+"_"+a.toLowerCase()+"_"+r.toLowerCase()}):e.push({text:t.getConstant(""+a+r+"s"),id:n+"_"+a.toLowerCase()+"_"+r.toLowerCase()}),"Insert"===a&&(e[e.length-1].items=[],o.forEach(function(r){e[e.length-1].items.push({text:t.getConstant(r),id:e[e.length-1].id+"_"+r.toLowerCase()})}))})},e.prototype.setHideShowItems=function(e,t,r,n,i){if(i[0]===i[1])e.push({text:t.getConstant("Hide"+r),id:n+"_hide_"+r.toLowerCase()});else{var o=i[0];i[0]=i[0]>i[1]?i[1]:i[0],i[1]=i[1]>o?i[1]:o,e.push({text:t.getConstant("Hide"+r+"s"),id:n+"_hide_"+r.toLowerCase()})}this.parent.hiddenCount(i[0],i[1],r.toLowerCase()+"s")&&e.push({text:t.getConstant("UnHide"+r+"s"),id:n+"_unhide_"+r.toLowerCase()})},e.prototype.addEventListener=function(){this.parent.on(addContextMenuItems,this.addItemsHandler,this),this.parent.on(removeContextMenuItems,this.removeItemsHandler,this),this.parent.on(enableContextMenuItems,this.enableItemsHandler,this)},e.prototype.addItemsHandler=function(e){e.insertAfter?this.contextMenuInstance.insertAfter(e.items,e.text,e.isUniqueId):this.contextMenuInstance.insertBefore(e.items,e.text,e.isUniqueId)},e.prototype.removeItemsHandler=function(e){this.contextMenuInstance.removeItems(e.items,e.isUniqueId)},e.prototype.enableItemsHandler=function(e){this.contextMenuInstance.enableItems(e.items,e.enable,e.isUniqueId)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(addContextMenuItems,this.addItemsHandler),this.parent.off(removeContextMenuItems,this.removeItemsHandler),this.parent.off(enableContextMenuItems,this.enableItemsHandler))},e.prototype.getModuleName=function(){return"contextMenu"},e.prototype.destroy=function(){this.removeEventListener(),this.contextMenuInstance.destroy();var e=document.getElementById(this.parent.element.id+"_contextmenu");e&&ej2Base.detach(e),this.parent=null},e}(),NumberFormat=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.refreshCellElement=function(e){var t=this.parent.getCell(e.rowIndex,e.colIndex);ej2Base.isNullOrUndefined(t)||this.parent.refreshNode(t,e)},e.prototype.getTextSpace=function(e){e.width=getTextWidth(e.char,e.cell.style,this.parent.cellStyle)},e.prototype.rowFillHandler=function(e){var t,r,n=e.td?e.td:this.parent.getCell(e.rowIdx,e.colIdx);if(n){e.formatText&&(n.innerHTML=e.formatText.toString()),e.secText&&((r=this.parent.createElement("span")).classList.add("e-fill-sec"),r.innerHTML=e.secText.toString()),n.children.length?t=n.querySelector(".e-fill"):((t=this.parent.createElement("span")).style.flexGrow="1",t.classList.add("e-fill"),n.appendChild(t),r&&n.appendChild(r)),t.innerHTML="";var i=getTextWidth(e.value.toString(),e.cell.style,this.parent.cellStyle),o=Math.round(t.offsetWidth/i);e.formatText=e.value.repeat(o),t.innerHTML=e.formatText}},e.prototype.addEventListener=function(){this.parent.on(refreshCellElement,this.refreshCellElement,this),this.parent.on(rowFillHandler,this.rowFillHandler,this),this.parent.on(getTextSpace,this.getTextSpace,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(refreshCellElement,this.refreshCellElement),this.parent.off(rowFillHandler,this.rowFillHandler),this.parent.off(getTextSpace,this.getTextSpace))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"numberFormat"},e}(),Sort=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(applySort,this.applySortHandler,this),this.parent.on(sortComplete,this.sortCompleteHandler,this),this.parent.on(initiateCustomSort,this.initiateCustomSortHandler,this),this.parent.on(sortImport,this.sortImport,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(applySort,this.applySortHandler),this.parent.off(sortComplete,this.sortCompleteHandler),this.parent.off(initiateCustomSort,this.initiateCustomSortHandler),this.parent.off(sortImport,this.sortImport))},e.prototype.getModuleName=function(){return"sort"},e.prototype.isValidSortRange=function(){var e=this.parent.getActiveSheet(),t=getSwapRange(getIndexesFromAddress(e.selectedRange));return!(t[0]>e.usedRange.rowIndex||t[1]>e.usedRange.colIndex)},e.prototype.sortImport=function(e){for(var t,r=this.parent.sortCollection,n=this.parent.getActiveSheet().usedRange.rowIndex-1,i=e?e.sheetIdx:this.parent.activeSheetIndex,o=0;o<r.length;o++)if(r[o].sheetIndex===i)for(var a=0;a<n;a++)if((t=this.parent.getCell(a,r[o].columnIndex))&&t.querySelector(".e-filter-icon"))return void("Ascending"===r[o].order||"OnTop"===r[o].order?t.querySelector(".e-filter-icon").classList.contains("e-sortasc-filter")||t.querySelector(".e-filter-icon").classList.add("e-sortasc-filter"):t.querySelector(".e-filter-icon").classList.contains("e-sortdesc-filter")||t.querySelector(".e-filter-icon").classList.add("e-sortdesc-filter"))},e.prototype.sortRangeAlertHandler=function(e){var t=this,r=this.parent.serviceLocator.getService(dialog),n=this.parent.serviceLocator.getService(locale);r.show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:e.error,beforeOpen:function(i){var o={dialogName:e.error===n.getConstant("MultiRangeSortError")?"MultiRangeSortDialog":"SortRangeDialog",content:e.error,element:i.element,target:i.target,cancel:i.cancel};t.parent.trigger("dialogBeforeOpen",o),o.cancel&&(i.cancel=!0),r.dialogInstance.content=o.content}}),this.parent.hideSpinner()},e.prototype.initiateCustomSortHandler=function(){var e=this,t=this.parent.serviceLocator.getService(locale),r=this.parent.getActiveSheet();if(this.isValidSortRange()&&0!=r.rows.length)if(isDiscontinuousRange(r.selectedRange))this.sortRangeAlertHandler({error:t.getConstant("MultiRangeSortError")});else{var n,i=this.parent.serviceLocator.getService(dialog);i.show({height:400,width:560,isModal:!0,showCloseIcon:!0,cssClass:"e-customsort-dlg",header:t.getConstant("CustomSort"),beforeOpen:function(t){var r={dialogName:"CustomSortDialog",element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",r),r.cancel&&(t.cancel=!0),i.dialogInstance.content=e.customSortContent(),i.dialogInstance.dataBind(),focus(e.parent.element)},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:function(){var t=i.dialogInstance.content,r=ej2Base.getComponent(t.getElementsByClassName("e-list-sort e-listview e-lib")[0],"listview").dataSource;e.clearError();var o=t.getElementsByClassName("e-sort-error")[0];o.style.display="block",e.validateError(r,t,o)||(n={sortDescriptors:r,containsHeader:t.getElementsByClassName("e-sort-checkheader")[0].checked,caseSensitive:t.getElementsByClassName("e-sort-checkcase")[0].checked},i.hide())}}],close:function(){n&&getUpdateUsingRaf(function(){return e.applySortHandler({sortOptions:n})})}})}else this.sortRangeAlertHandler({error:t.getConstant("SortOutOfRangeError")})},e.prototype.validateError=function(e,t,r){var n=this.parent.serviceLocator.getService(locale);if(e.some(function(e){return""===e.field.toString()}))return Array.prototype.some.call(t.getElementsByClassName("e-sort-field"),function(e){var t=!ej2Base.getComponent(e,"dropdownlist").value;return t&&e.parentElement.classList.add("e-error"),t}),r.innerText=n.getConstant("SortEmptyFieldError"),!0;var i=new Set,o="",a="";if(e.some(function(e){return o=e.field.toString(),i.size===i.add(e.field).size})){var s=0;return Array.prototype.some.call(t.getElementsByClassName("e-sort-field"),function(e){var t=ej2Base.getComponent(e,"dropdownlist");return t.value===o&&(e.parentElement.classList.add("e-error"),a=t.text,s++),2===s}),r.innerHTML="<strong>"+a+"</strong>"+n.getConstant("SortDuplicateFieldError"),!0}return!1},e.prototype.customSortContent=function(){var e=this.parent.createElement("div",{className:"e-sort-dialog"}),t=this.getFields(),r=ej2Base.getUniqueID("customSort"),n=this.getCustomListview(r);this.setHeaderTab(e,n,t);var i=this.parent.createElement("div",{className:"e-sort-listsection",styles:""});e.appendChild(i);var o=this.parent.createElement("div",{className:"e-list-sort",styles:""});i.appendChild(o),n.createElement=this.parent.createElement,n.appendTo(o),this.renderListItem(r,n,!0,t);var a=this.parent.createElement("div",{className:"e-sort-error"});return e.appendChild(a),e},e.prototype.getFields=function(){var e=this.parent.getActiveSheet(),t=getSwapRange(getIndexesFromAddress(e.selectedRange));if(t[0]===t[2]&&t[2]-t[0]==0){t[0]=0,t[1]=0,t[3]=e.usedRange.colIndex;var r={filterRange:[],hasFilter:!1};this.parent.notify(getFilterRange,r),r.hasFilter&&r.filterRange&&(t[0]=r.filterRange[0])}var n,i=[];for(t[1];t[1]<=t[3];t[1]++){var o=getCell(t[0],t[1],e);if(o&&o.value){var a={formattedText:o.value,value:o.value,format:o.format,onLoad:!0};o.format&&this.parent.notify(getFormattedCellObject,a),n=a.formattedText}else n="Column "+getColumnHeaderText(t[1]+1);i.push({text:n,value:"Column "+getColumnHeaderText(t[1]+1)})}return i},e.prototype.setHeaderTab=function(e,t,r){var n=this,i=this.parent.serviceLocator.getService(locale),o=this.parent.createElement("div",{className:"e-sort-header",styles:"",innerHTML:""});e.appendChild(o);var a=this.parent.createElement("button",{className:"e-btn e-sort-addbtn e-flat",innerHTML:i.getConstant("AddColumn")}),s=this.parent.element.querySelector(".e-customsort-dlg .e-footer-content");s.insertBefore(a,s.firstElementChild),a.addEventListener("click",function(){if(t){var e=ej2Base.getUniqueID("customSort");t.addItem([{id:e,text:i.getConstant("ThenBy"),field:"",order:"ascending"}]),n.renderListItem(e,t,l.checked,r,!0)}});var l=new ej2Buttons.CheckBox({label:i.getConstant("ContainsHeader"),checked:!0,change:function(t){var n=t.checked?{text:"text",value:"value"}:{text:"value"};Array.prototype.forEach.call(e.getElementsByClassName("e-sort-field e-dropdownlist e-lib"),function(e){var t=ej2Base.getComponent(e,"dropdownlist");t.dataSource=null,t.dataSource=r,t.fields=n,t.dataBind()})},cssClass:"e-sort-headercheckbox"}),d=this.parent.createElement("input",{className:"e-sort-checkheader",attrs:{type:"checkbox"}});o.appendChild(d),l.createElement=this.parent.createElement,l.appendTo(d);var p=new ej2Buttons.CheckBox({label:i.getConstant("CaseSensitive"),checked:!1,cssClass:"e-sort-casecheckbox"}),h=this.parent.createElement("input",{className:"e-sort-checkcase",attrs:{type:"checkbox"}});o.appendChild(h),p.createElement=this.parent.createElement,p.appendTo(h)},e.prototype.getCustomListview=function(e){var t=[{id:e,text:this.parent.serviceLocator.getService(locale).getConstant("SortBy"),field:"",order:"ascending"}];ej2Base.enableRipple(!1);return new ej2Lists.ListView({dataSource:t,fields:{id:"id"},height:"100%",template:'<div class="e-sort-listwrapper"><span class="text">${text}</span><div class="e-sort-row"><div class="e-sort-field"></div><div class="e-sort-order"><span class="e-sort-ordertxt" style="display:none;">${order}</span></div><span class="e-icons e-sort-delete"></span></div>',cssClass:"e-sort-template"})},e.prototype.deleteHandler=function(e,t){e.getElementsByClassName("e-sort-delete")[0].addEventListener("click",function(){e&&t.removeItem(e)})},e.prototype.renderListItem=function(e,t,r,n,i){var o=this,a=this.parent.serviceLocator.getService(locale),s=t.element.querySelector("li[data-uid="+e+"]"),l=r?{text:"text",value:"value"}:{text:"value"},d=s.getElementsByClassName("e-sort-field")[0],p=new ej2Dropdowns.DropDownList({dataSource:n,width:"auto",cssClass:"e-sort-field-ddl",fields:l,placeholder:a.getConstant("SelectAColumn"),change:function(r){r.value&&(Array.prototype.some.call(t.dataSource,function(t){return t.id===e&&(t.field=r.value.toString().replace("Column ","")),t.id===e}),o.clearError())}});p.createElement=this.parent.createElement,p.appendTo(d),i||(p.index=0);var h=s.getElementsByClassName("e-sort-order")[0],c="ascending"===h.getElementsByClassName("e-sort-ordertxt")[0].innerText.toLocaleLowerCase(),u=new ej2Buttons.RadioButton({label:a.getConstant("SortAscending"),name:"sortAZ_"+e,value:"ascending",checked:c,cssClass:"e-sort-radiobutton",change:function(r){o.setRadioBtnValue(t,e,r.value)}}),g=this.parent.createElement("input",{id:"orderAsc_"+e,className:"e-sort-radioasc",styles:"",attrs:{type:"radio"}});h.appendChild(g),u.createElement=this.parent.createElement,u.appendTo(g);var f=new ej2Buttons.RadioButton({label:a.getConstant("SortDescending"),name:"sortAZ_"+e,value:"descending",checked:!c,cssClass:"e-sort-radiobutton",change:function(r){o.setRadioBtnValue(t,e,r.value)}}),m=this.parent.createElement("input",{id:"orderDesc_"+e,className:"e-sort-radiodesc",styles:"",attrs:{type:"radio"}});h.appendChild(m),f.createElement=this.parent.createElement,f.appendTo(m),this.deleteHandler(s,t)},e.prototype.setRadioBtnValue=function(e,t,r){r&&Array.prototype.some.call(e.dataSource,function(e){return e.id===t&&(e.order=r),e.id===t})},e.prototype.clearError=function(){var e=document.getElementsByClassName("e-sort-dialog")[0],t=e.getElementsByClassName("e-sort-error")[0];"none"!==t.style.display&&""!==t.innerHTML&&(t.style.display="none",Array.prototype.forEach.call(e.getElementsByClassName("e-error"),function(e){e.classList.remove("e-error")}))},e.prototype.applySortHandler=function(e){var t=this,r=this.parent.getActiveSheet(),n=e&&e.range||r.selectedRange,i=getSwapRange(getIndexesFromAddress(n)),o=e&&e.sortOptions||{sortDescriptors:{}},a=i[0]===i[2],s={filterRange:[],hasFilter:!1,sheetIdx:this.parent.activeSheetIndex};this.parent.notify(getFilterRange,s),s.hasFilter&&(a?inRange(s.filterRange,i[0],i[1]):s.filterRange[0]===i[0]&&(this.parent.element.querySelector(".e-selectall.e-highlight")||i[1]>=s.filterRange[1]&&i[1]<=s.filterRange[3]||i[3]>=s.filterRange[1]&&i[3]<=s.filterRange[3]))&&(i[0]=s.filterRange[0],i[1]=s.filterRange[1],i[2]=r.usedRange.rowIndex,i[3]=r.usedRange.colIndex,o.containsHeader=!0,a=!1);var l={range:n=getRangeAddress(i),sortOptions:o,cancel:!1};if(this.parent.trigger(beforeSort,l),!l.cancel){this.parent.notify(beginAction,{eventArgs:l,action:"beforeSort"}),this.parent.showSpinner();var d=new Promise(function(e,t){e(void 0)}),p={args:{range:l.range,sortOptions:l.sortOptions,checkForHeader:a&&n!==l.range},promise:d,previousSort:e&&e.previousSort};this.parent.notify(initiateSort,p),p.promise.then(function(e){return t.sortCompleteHandler(e),t.parent.trigger(sortComplete,e),t.parent.notify(completeAction,{eventArgs:e,action:"sorting"}),Promise.resolve(e)}).catch(function(e){return t.sortRangeAlertHandler({error:e}),Promise.reject(e)})}},e.prototype.sortCompleteHandler=function(e){for(var t=getIndexesFromAddress(e.range),r=t[0];r<=t[2];r++)for(var n=t[1];n<=t[3];n++)this.parent.notify(workbookFormulaOperation,{action:"refreshCalculate",rowIndex:r,colIndex:n});this.parent.serviceLocator.getService("cell").refreshRange(t,!0,!0),this.parent.hideSpinner()},e}(),Filter=function(){function e(e){this.parent=e,this.filterCollection=new Map,this.filterRange=new Map,this.filterBtn=e.createElement("div",{className:"e-filter-btn e-control e-btn e-lib e-filter-iconbtn e-icon-btn"}),this.filterBtn.appendChild(e.createElement("span",{className:"e-btn-icon e-icons e-filter-icon"})),this.addEventListener()}return e.prototype.destroy=function(){this.removeEventListener(),this.filterRange=null,this.filterCollection=null,this.parent=null},e.prototype.addEventListener=function(){this.parent.on(filterRangeAlert,this.filterRangeAlertHandler,this),this.parent.on(initiateFilterUI,this.initiateFilterUIHandler,this),this.parent.on(mouseDown,this.filterMouseDownHandler,this),this.parent.on(renderFilterCell,this.renderFilterCellHandler,this),this.parent.on(ej2Grids.beforeFltrcMenuOpen,this.beforeFilterMenuOpenHandler,this),this.parent.on(ej2Grids.filterCmenuSelect,this.closeDialog,this),this.parent.on(reapplyFilter,this.reapplyFilterHandler,this),this.parent.on(filterByCellValue,this.filterByCellValueHandler,this),this.parent.on(clearFilter,this.clearFilterHandler,this),this.parent.on(getFilteredColumn,this.getFilteredColumnHandler,this),this.parent.on(cMenuBeforeOpen,this.cMenuBeforeOpenHandler,this),this.parent.on(ej2Grids.filterCboxValue,this.filterCboxValueHandler,this),this.parent.on(getFilterRange,this.getFilterRangeHandler,this),this.parent.on(filterCellKeyDown,this.filterCellKeyDownHandler,this),this.parent.on(getFilteredCollection,this.getFilteredCollection,this),this.parent.on(contentLoaded,this.updateFilter,this),this.parent.on(updateFilter,this.updateFilter,this),this.parent.on(beforeInsert,this.beforeInsertHandler,this),this.parent.on(beforeDelete,this.beforeDeleteHandler,this),this.parent.on(sheetsDestroyed,this.deleteSheetHandler,this),this.parent.on(clear,this.clearHanlder,this),this.parent.on(ej2Grids.filterDialogCreated,this.filterDialogCreatedHandler,this),this.parent.on(ej2Grids.filterDialogClose,this.removeFilterClass,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(filterRangeAlert,this.filterRangeAlertHandler),this.parent.off(initiateFilterUI,this.initiateFilterUIHandler),this.parent.off(mouseDown,this.filterMouseDownHandler),this.parent.off(renderFilterCell,this.renderFilterCellHandler),this.parent.off(ej2Grids.beforeFltrcMenuOpen,this.beforeFilterMenuOpenHandler),this.parent.off(ej2Grids.filterCmenuSelect,this.closeDialog),this.parent.off(reapplyFilter,this.reapplyFilterHandler),this.parent.off(filterByCellValue,this.filterByCellValueHandler),this.parent.off(clearFilter,this.clearFilterHandler),this.parent.off(getFilteredColumn,this.getFilteredColumnHandler),this.parent.off(cMenuBeforeOpen,this.cMenuBeforeOpenHandler),this.parent.on(ej2Grids.filterCboxValue,this.filterCboxValueHandler),this.parent.off(getFilterRange,this.getFilterRangeHandler),this.parent.off(filterCellKeyDown,this.filterCellKeyDownHandler),this.parent.off(getFilteredCollection,this.getFilteredCollection),this.parent.off(contentLoaded,this.updateFilter),this.parent.off(updateFilter,this.updateFilter),this.parent.off(beforeInsert,this.beforeInsertHandler),this.parent.off(beforeDelete,this.beforeDeleteHandler),this.parent.off(sheetsDestroyed,this.deleteSheetHandler),this.parent.off(clear,this.clearHanlder),this.parent.off(ej2Grids.filterDialogCreated,this.filterDialogCreatedHandler),this.parent.off(ej2Grids.filterDialogClose,this.removeFilterClass))},e.prototype.getModuleName=function(){return"filter"},e.prototype.isInValidFilterRange=function(e,t){var r=getSwapRange(getIndexesFromAddress(t||e.selectedRange));return r[0]>e.usedRange.rowIndex||r[1]>e.usedRange.colIndex},e.prototype.filterRangeAlertHandler=function(e){var t=this;this.parent.serviceLocator.getService(dialog).show({content:e.error,isModal:!0,height:180,width:400,showCloseIcon:!0,beforeOpen:function(e){var r={dialogName:"FilterRangeDialog",element:e.element,target:e.target,cancel:e.cancel};t.parent.trigger("dialogBeforeOpen",r),r.cancel&&(e.cancel=!0)}}),this.parent.hideSpinner()},e.prototype.beforeFilterMenuOpenHandler=function(e){var t=this.parent.serviceLocator.getService(locale);e.element.classList.add("e-spreadsheet-contextmenu");var r=e.element.querySelector("ul");this.addMenuItem(r,t.getConstant("SortDescending"),"e-filter-sortdesc","e-sort-desc"),this.addMenuItem(r,t.getConstant("SortAscending"),"e-filter-sortasc","e-sort-asc"),e.element.appendChild(r)},e.prototype.addMenuItem=function(e,t,r,n){var i=this.parent.createElement("li",{className:r+" e-menu-item"});i.innerHTML=t,i.insertBefore(this.parent.createElement("span",{className:"e-menu-icon e-icons "+n}),i.firstChild),e.insertBefore(i,e.firstChild)},e.prototype.initiateFilterUIHandler=function(e){var t=this,r=e?e.predicates:null,n=e.sIdx;n||0===n||(n=this.parent.activeSheetIndex);var i;e.promise&&(i=new ej2Data.Deferred,e.promise=i.promise);var o=function(){i&&i.resolve()},a=e.isInternal||e.isCut;if(this.filterRange.size>0&&this.filterRange.has(n)&&!this.parent.isOpen&&!r)return this.removeFilter(n,a,!1,e.isUndoRedo),void o();var s=getSheet(this.parent,n);if(this.isInValidFilterRange(s,e.range)){var l=this.parent.serviceLocator.getService(locale);return this.filterRangeAlertHandler({error:l.getConstant("FilterOutOfRangeError")}),void o()}var d,p=e.range||s.selectedRange;if(a||(d={range:p,cancel:!1},e.predicates?(d.predicates=e.predicates,d.previousPredicates=[].slice.call(this.filterCollection.get(n))):d.filterOptions={predicates:e.predicates},this.parent.notify(beginAction,{action:"filter",eventArgs:d,preventAction:e.isUndoRedo}),!d.cancel)){if(e.range||!a&&p!==d.range)a||(p=d.range);else{var h=getRangeIndexes(p);h[0]===h[2]&&h[1]===h[3]&&(p=getRangeAddress(h=getDataRange(h[0],h[1],s)),a||(d.range=p))}if(r){if(r.length){this.processRange(s,n,p,!0);var c=this.filterRange.get(n).slice();c[0]=c[0]+1,c[2]=s.usedRange.rowIndex,c[1]=c[3]=getColIndex(r[0].field);var u=s.name+"!"+this.getPredicateRange(c,r.slice(1,r.length)),g=getRangeAddress(c);return void getData(this.parent,u,!0,!0,null,!0,null,null,!1,g).then(function(n){t.filterSuccessHandler(new ej2Data.DataManager(n),{action:"filtering",filterCollection:r,field:r[0].field,sIdx:e.sIdx,isUndoRedo:e.isUndoRedo||a,isInternal:a,prevPredicates:d&&d.previousPredicates}),o()})}this.clearFilterHandler(),o()}else this.processRange(s,n,p),o();a||this.parent.notify(completeAction,{action:"filter",eventArgs:d,preventAction:e.isUndoRedo})}else o()},e.prototype.processRange=function(e,t,r,n){var i=getSwapRange(getIndexesFromAddress(r||e.selectedRange));i[0]===i[2]&&i[1]===i[3]?(i[0]=0,i[1]=0,i[2]=e.usedRange.rowIndex,i[3]=e.usedRange.colIndex):i[3]>e.usedRange.colIndex&&(i[3]=e.usedRange.colIndex),this.filterRange.set(t,i),this.filterCollection.set(t,[]),n||this.refreshFilterRange(i,!1,t)},e.prototype.removeFilter=function(e,t,r,n){var i,o=this.filterRange.get(e).slice(),a=getRangeAddress(o);if(t||(i={range:a,cancel:!1},this.parent.notify(beginAction,{action:"filter",eventArgs:i,preventAction:n}),!i.cancel)){if((this.filterCollection.get(e).length||r)&&this.clearFilterHandler({preventRefresh:r}),this.filterRange.delete(e),this.filterCollection.delete(e),this.refreshFilterRange(o,!0,e),this.parent.filterCollection)for(var s=0,l=void 0,d=0,p=this.parent.filterCollection.length;d<p;d++)(l=this.parent.filterCollection[s]).sheetIndex===e&&l.filterRange===a?this.parent.filterCollection.splice(s,1):s++;t||this.parent.notify(completeAction,{action:"filter",eventArgs:i,preventAction:n})}},e.prototype.filterByCellValueHandler=function(){var e=this,t=this.parent.activeSheetIndex,r=this.parent.getActiveSheet();if(this.isInValidFilterRange(r)){var n=this.parent.serviceLocator.getService(locale);this.filterRangeAlertHandler({error:n.getConstant("FilterOutOfRangeError")})}else{var i=getCellIndexes(r.activeCell);this.isFilterRange(t,i[0],i[1])||this.processRange(r,t);var o=this.filterRange.get(t).slice();o[0]=o[0]+1,o[2]=r.usedRange.rowIndex,o[1]=o[3]=i[1];var a=getColumnHeaderText(i[1]+1),s=this.getColumnType(r,i[1]+1,o),l=[{field:a,operator:"equal",matchCase:!1,type:s,value:getCell(i[0],i[1],r,!1,!0).value}],d=r.name+"!"+this.getPredicateRange(o,this.filterCollection.get(t)),p=getRangeAddress(o);getData(this.parent,d,!0,!0,null,!0,null,null,!1,p).then(function(t){e.filterSuccessHandler(new ej2Data.DataManager(t),{action:"filtering",filterCollection:l,field:a,isFilterByValue:!0})})}},e.prototype.renderFilterCellHandler=function(e){var t=ej2Base.isNullOrUndefined(e.sIdx)?this.parent.activeSheetIndex:e.sIdx;if(t===this.parent.activeSheetIndex&&this.isFilterCell(t,e.rowIndex,e.colIndex)){if(!e.td)return;var r=e.td.querySelector(".e-filter-icon");r?r.className="e-btn-icon e-icons e-filter-icon"+this.getFilterSortClassName(e.colIndex,t):((r=this.filterBtn.cloneNode(!0)).firstElementChild.className+=this.getFilterSortClassName(e.colIndex,t),e.td.insertBefore(r,e.td.firstChild))}},e.prototype.getFilterSortClassName=function(e,t){for(var r=getColumnHeaderText(e+1),n="",i=this.filterCollection.get(t),o=this.parent.sortCollection,a=0;a<i.length;a++)if(i[a].field===r){n=" e-filtered";break}if(o)for(a=0;a<o.length;a++)if(o[a].sheetIndex===t&&o[a].columnIndex===e){n+="Ascending"===o[a].order?" e-sortasc-filter":" e-sortdesc-filter";break}return n},e.prototype.refreshFilterRange=function(e,t,r){var n=r;n||0===n||(n=this.parent.activeSheetIndex),e||this.filterRange.get(n)||(e=[0,0,0,0]);for(var i=e||this.filterRange.get(n).slice(),o=i[1];o<=i[3];o++){var a=this.parent.getCell(i[0],o);if(t){if(a&&a.hasChildNodes()){var s=a.querySelector(".e-filter-btn");s&&s.parentElement.removeChild(s)}}else this.renderFilterCellHandler({td:a,rowIndex:i[0],colIndex:o,sIdx:n})}this.parent.sortCollection&&this.parent.notify(sortImport,null)},e.prototype.isFilterCell=function(e,t,r){var n=this.filterRange.get(e);return n&&n[0]===t&&n[1]<=r&&n[3]>=r},e.prototype.isFilterRange=function(e,t,r){var n=this.filterRange.get(e);return n&&n[0]<=t&&n[2]>=t&&n[1]<=r&&n[3]>=r},e.prototype.getFilteredColumnHandler=function(e){var t=this.parent.activeSheetIndex,r=this.parent.serviceLocator.getService(locale);if(e.clearFilterText=r.getConstant("ClearFilter"),this.filterRange.has(t)){var n=this.filterCollection.get(t);if(e.isClearAll)return void(e.isFiltered=n&&n.length>0);var i=this.filterRange.get(t).slice(),o=this.parent.getActiveSheet(),a=getCellIndexes(o.activeCell);if(this.isFilterRange(t,a[0],a[1])){e.field=getColumnHeaderText(a[1]+1);var s=getCell(i[0],a[1],o),l=this.parent.getDisplayText(s);e.clearFilterText=r.getConstant("ClearFilterFrom")+'"'+(l?l.toString():"Column "+e.field)+'"',n.some(function(t){return e.isFiltered=t.field===e.field,e.isFiltered})}}},e.prototype.cMenuBeforeOpenHandler=function(e){var t=this.parent.element.id+"_cmenu";if(e.parentItem&&e.parentItem.id===t+"_filter"&&""===e.target){var r={isFiltered:!1};this.getFilteredColumnHandler(r),this.parent.enableContextMenuItems([t+"_clearfilter",t+"_reapplyfilter"],!!r.isFiltered,!0)}},e.prototype.closeDialog=function(){var e=document.querySelector(".e-filter-popup");if(e&&e.id.includes(this.parent.element.id)){var t=ej2Base.getComponent(e,"dialog");ej2Base.EventHandler.remove(e,getStartEvent(),this.filterMouseDownHandler),t&&t.hide(),this.removeFilterClass()}},e.prototype.removeFilterClass=function(){"relative"===this.parent.element.style.position&&(this.parent.element.style.position=""),this.parent.element.classList.contains("e-filter-open")&&this.parent.element.classList.remove("e-filter-open")},e.prototype.isPopupOpened=function(){var e=document.querySelector(".e-filter-popup");return e&&e.id.includes(this.parent.element.id)&&"none"!==e.style.display},e.prototype.filterCellKeyDownHandler=function(e){var t=this.parent.activeSheetIndex,r=this.parent.getActiveSheet(),n=getCellIndexes(r.activeCell);if(this.isFilterCell(t,n[0],n[1])){e.isFilterCell=!0;var i=getCellPosition(r,n),o=this.parent.getCell(n[0],n[1]);this.isPopupOpened()&&this.closeDialog(),this.openDialog(o,i.left,o?o.getBoundingClientRect().bottom:i.top)}else e.isFilterCell=!1},e.prototype.filterMouseDownHandler=function(e){if(!(ej2Base.Browser.isDevice&&"mousedown"===e.type||this.parent.getActiveSheet().isProtected)){var t=e.target;if(t.classList.contains("e-filter-icon")){if(this.isPopupOpened())return void this.closeDialog();this.openDialog(t,e.x,t.getBoundingClientRect().bottom)}else this.isPopupOpened()&&(t.classList.contains("e-searchinput")||t.classList.contains("e-searchclear")||!t.offsetParent||t.offsetParent.classList.contains("e-filter-popup")?this.selectSortItemHandler(t):this.closeDialog())}},e.prototype.openDialog=function(e,t,r){var n=this,i=ej2Grids.parentsUntil(e,"e-cell"),o=parseInt(i.getAttribute("aria-colindex"),10),a=getColumnHeaderText(o);this.parent.showSpinner();var s=this.parent.activeSheetIndex,l=this.filterRange.get(s).slice(),d=this.parent.getActiveSheet(),p=getCell(l[0],o-1,d),h=this.parent.getDisplayText(p);l[0]=l[0]+1,l[2]=d.usedRange.rowIndex;var c=[l[0],o-1,l[2],o-1],u=d.name+"!"+this.getPredicateRange(c,this.filterCollection.get(s)),g=getRangeAddress(c);getData(this.parent,u,!0,!0,null,!0,null,null,!1,g).then(function(i){var p;i.some(function(e,t){return e&&(p=new ej2Data.DataManager(i.slice(t))),!!e});var c=n.parent.element.getBoundingClientRect();t-=c.left,r-=c.top,n.parent.element.style.position="relative",n.parent.element.classList.add("e-filter-open");var u=n.getColumnType(d,o,l),g={type:u,field:a,format:"date"===u?n.getDateFormatFromColumn(d,o,l):null,displayName:h||"Column "+a,dataSource:p,height:n.parent.element.classList.contains("e-bigger")?800:500,columns:[],hideSearchbox:!1,filteredColumns:n.filterCollection.get(s),column:{field:a,filter:{}},handler:n.filterSuccessHandler.bind(n,new ej2Data.DataManager(i)),target:e,position:{X:t,Y:r},localeObj:n.parent.serviceLocator.getService(locale)};new ej2Grids.ExcelFilterBase(n.parent,n.getLocalizedCustomOperators()).openDialog(g);var f=document.querySelector(".e-filter-popup"),m=n.parent.element.getBoundingClientRect(),v=e.getBoundingClientRect();if(f){var C=v.right-f.offsetWidth;f.style.left=C<1?(C+f.offsetWidth-m.left).toString()+"px":(C-m.left).toString()+"px"}if(f&&f.id.includes(n.parent.element.id)){ej2Base.EventHandler.add(f,getStartEvent(),n.filterMouseDownHandler,n),f.style.top="0px",f.style.visibility="hidden",f.classList.contains("e-hide")&&f.classList.remove("e-hide");var y=f.getBoundingClientRect().height;y<400&&(y=400);var x=c.height-r;f.style.top=(y>x?r-Math.abs(y-x):r)+"px",f.style.visibility=""}n.parent.hideSpinner()})},e.prototype.getPredicateRange=function(e,t){var r=getRangeAddress(e);if(t&&t.length){var n,i;t.forEach(function(t){t.field&&(n=""+t.field+(e[0]+1)+":"+t.field+(e[2]+1),r.includes(n)||(r+=","+n,(i=getColIndex(t.field))<e[1]&&(e[1]=i),i>e[3]&&(e[3]=i)))})}return r},e.prototype.filterDialogCreatedHandler=function(){var e=document.querySelector(".e-filter-popup");e&&e.id.includes(this.parent.element.id)&&e.classList.contains("e-popup-close")&&e.classList.add("e-hide")},e.prototype.filterCboxValueHandler=function(e){if(e.column&&e.data){var t=e.column.field;if(e.value){var r=getCellIndexes(t+e.data.dataObj.__rowIndex),n=getCell(r[0],r[1],this.parent.getActiveSheet());n&&n.format&&(e.value=this.parent.getDisplayText(n))}}},e.prototype.selectSortItemHandler=function(e){var t=e.classList.contains("e-filter-sortasc")?"Ascending":e.classList.contains("e-filter-sortdesc")?"Descending":null;if(t){var r=this.parent.getActiveSheet(),n=this.parent.activeSheetIndex,i=this.filterRange.get(n).slice();i[0]=i[0]+1,i[2]=r.usedRange.rowIndex,this.parent.sortCollection=this.parent.sortCollection?this.parent.sortCollection:[];for(var o,a=0;a<this.parent.sortCollection.length;a++)this.parent.sortCollection[a]&&this.parent.sortCollection[a].sheetIndex===n&&(o=this.parent.sortCollection[a],this.parent.sortCollection.splice(a,1));this.parent.sortCollection.push({sortRange:getRangeAddress(i),columnIndex:getIndexesFromAddress(r.activeCell)[1],order:t,sheetIndex:n}),o||(o={order:""}),this.parent.notify(applySort,{sortOptions:{sortDescriptors:{order:t}},previousSort:o,range:getRangeAddress(i)}),this.refreshFilterRange(),this.closeDialog()}},e.prototype.filterSuccessHandler=function(e,t){var r=t.sIdx;r||0===r||(r=this.parent.activeSheetIndex);var n=t.prevPredicates||[].slice.call(this.filterCollection.get(r));t.isFilterByValue&&!n.length&&(n=void 0);for(var i=this.filterCollection.get(r),o=new ej2Data.DataManager(i),a=new ej2Data.Query,s=o.executeLocal(a.where("field","equal",t.field)),l=0;l<s.length;l++){for(var d=-1,p=0;p<i.length;p++)if(i[p].field===s[l].field){d=p;break}-1!==d&&i.splice(d,1)}if("filtering"===t.action&&(i=i.concat(t.filterCollection)).length)for(var h=0;h<i.length;h++)t.field=i[h].field;this.filterCollection.set(r,i);var c={datasource:e,predicates:this.getPredicates(r)};this.filterRange.get(r)[2]=getSheet(this.parent,r).usedRange.rowIndex,this.applyFilter(c,getRangeAddress(this.filterRange.get(r)),r,n,t.isUndoRedo,!1,t.isInternal)},e.prototype.applyFilter=function(e,t,r,n,i,o,a){var s=this,l={range:t,predicates:[].slice.call(this.filterCollection.get(r)),previousPredicates:n,cancel:!1};if(i||(this.parent.notify(beginAction,{action:"filter",eventArgs:l}),!l.cancel)){t.indexOf("!")<0&&(t=this.parent.sheets[r].name+"!"+t),this.parent.showSpinner();var d={args:{range:t,filterOptions:e},promise:new Promise(function(e,t){e(void 0)}),refresh:o};this.parent.notify(initiateFilter,d),d.promise.then(function(e){return s.refreshFilterRange(),s.parent.notify(getFilteredCollection,null),s.parent.hideSpinner(),a||(delete l.cancel,s.parent.notify(completeAction,{action:"filter",eventArgs:l,preventAction:i})),Promise.resolve(e)}).catch(function(e){return s.filterRangeAlertHandler({error:e}),Promise.reject(e)})}},e.prototype.getPredicates=function(e){for(var t=[],r=ej2Grids.CheckBoxFilterBase.getPredicate(this.filterCollection.get(e)),n=0,i=Object.keys(r);n<i.length;n++){var o=i[n];t.push(r[o])}return t},e.prototype.getColumnType=function(e,t,r){for(var n=0,i=0,o=0,a=r[0];a<=e.usedRange.rowIndex;a++){var s=getCell(a,t-1,e);if(s)if(s.format){switch(getTypeFromFormat(s.format).toLowerCase()){case"number":case"currency":case"accounting":case"percentage":n++;break;case"shortdate":case"longdate":o++;break;case"time":n++;break;default:i++}}else"string"==typeof s.value||void 0===s.value||null===s.value?i++:n++;else i++}return n>i&&n>o&&n>0?"number":i>n&&i>o&&i>0?"string":o>n&&o>i&&o>0?"date":"datetime"},e.prototype.getDateFormatFromColumn=function(e,t,r){for(var n,i=r[0];i<=r[2];i++){var o=getCell(i,t-1,e);if(o&&o.format){n=o.format;break}}return n},e.prototype.clearFilterHandler=function(e){if(e&&e.field)this.filterSuccessHandler(null,{action:"clear-filter",filterCollection:[],field:e.field});else{var t=e&&e.isAction,r={isFiltered:!1,isClearAll:!0};if(this.getFilteredColumnHandler(r),r.isFiltered||e&&e.preventRefresh){var n=void 0,i=this.parent.getActiveSheet(),o=this.filterRange.get(this.parent.activeSheetIndex);if(t&&(n={range:getRangeAddress(o),predicates:[],previousPredicates:this.filterCollection.get(this.parent.activeSheetIndex),cancel:!1},this.parent.notify(beginAction,{action:"filter",eventArgs:n}),n.cancel))return;this.filterCollection.set(this.parent.activeSheetIndex,[]);for(var a=this.parent.filterCollection,s=0,l=a&&a.length;s<l;s++)if(a[s].sheetIndex===this.parent.activeSheetIndex){a.splice(s,1);break}if(this.parent.scrollSettings.enableVirtualization&&i.usedRange.rowIndex-o[0]+1>this.parent.viewport.rowCount+2*this.parent.getThreshold("row")||i.frozenColumns||i.frozenRows){for(s=0,l=i.usedRange.rowIndex;s<=l;s++)setRow(i,s,{hidden:!1,isFiltered:!1});e&&e.preventRefresh||this.parent.renderModule.refreshSheet(!1,!0,!0)}else this.refreshFilterRange(),this.parent.notify(hideShow,{startIndex:o[0],endIndex:i.usedRange.rowIndex,hide:!1,isFiltering:!0});t&&(delete n.cancel,this.parent.notify(completeAction,{action:"filter",eventArgs:n}))}}},e.prototype.reapplyFilterHandler=function(e,t){var r=this,n=this.parent.activeSheetIndex;if(this.filterRange.has(n)){var i=this.filterCollection.get(n);if(i&&i.length){var o=getSheet(this.parent,n),a=this.filterRange.get(n).slice();a[0]=a[0]+1,a[2]=o.usedRange.rowIndex,a[1]=a[3]=getColIndex(i[0].field);var s=o.name+"!"+this.getPredicateRange(a,i.slice(1,i.length));getData(this.parent,s,!0,!0,null,!0,null,null,!1,getRangeAddress(a)).then(function(o){var a=r.getPredicates(n);r.applyFilter({predicates:a,datasource:new ej2Data.DataManager(o)},getRangeAddress(r.filterRange.get(n)),n,[].slice.call(i),e,t)})}}},e.prototype.getFilterRangeHandler=function(e){var t=e.sheetIdx;this.filterRange&&this.filterRange.has(t)?(e.hasFilter=!0,e.filterRange=this.filterRange.get(t)):(e.hasFilter=!1,e.filterRange=null)},e.prototype.getLocalizedCustomOperators=function(){var e=this.parent.serviceLocator.getService(locale),t=[{value:"equal",text:e.getConstant("Equal")},{value:"greaterthan",text:e.getConstant("GreaterThan")},{value:"greaterthanorequal",text:e.getConstant("GreaterThanOrEqual")},{value:"lessthan",text:e.getConstant("LessThan")},{value:"lessthanorequal",text:e.getConstant("LessThanOrEqual")},{value:"notequal",text:e.getConstant("NotEqual")}];return{stringOperator:[{value:"startswith",text:e.getConstant("StartsWith")},{value:"endswith",text:e.getConstant("EndsWith")},{value:"contains",text:e.getConstant("Contains")},{value:"equal",text:e.getConstant("Equal")},{value:"notequal",text:e.getConstant("NotEqual")}],numberOperator:t,dateOperator:t,datetimeOperator:t,booleanOperator:[{value:"equal",text:e.getConstant("Equal")},{value:"notequal",text:e.getConstant("NotEqual")}]}},e.prototype.getFilteredCollection=function(){for(var e,t=this.parent.sheets.length,r=[],n=0;n<t;n++){var i={sheetIdx:n,filterRange:void 0,hasFilter:void 0};if(this.getFilterRangeHandler(i),i.hasFilter){for(var o=[],a=[],s=[],l=[],d=[],p=this.filterCollection.get(i.sheetIdx),h=0;h<p.length;h++)if(p[h].field&&p[h].operator){var c=getCellIndexes(p[h].field+"1")[1];o.push(c),a.push(p[h].operator),s.push(ej2Base.isNullOrUndefined(p[h].value)?"":p[h].value),l.push(p[h].type),d.push(p[h].predicate)}var u=getRangeAddress(i.filterRange);e={sheetIndex:i.sheetIdx,filterRange:u,hasFilter:i.hasFilter,column:o,criteria:a,value:s,dataType:l,predicates:d},r.push(e)}}e&&(this.parent.filterCollection=r)},e.prototype.updateFilter=function(e){if(this.parent.filterCollection&&(e.initLoad||e.isOpen)){for(var t=0;t<this.parent.filterCollection.length;t++){var r=this.parent.filterCollection[t],n=r.sheetIndex;0!==t||this.parent.isOpen||e.isOpen||(n=0);var i=[];if(r.column)for(var o=0;o<r.column.length;o++){var a={field:getCellAddress(0,r.column[o]).charAt(0),operator:this.getFilterOperator(r.criteria[o]),value:r.value[o].toString().split("*").join(""),predicate:r.predicates&&r.predicates[o],type:r.dataType&&r.dataType[o]};i.push(a)}for(var s=0;s<i.length-1;s++)i[s].field===i[s+1].field&&(i[s].predicate||(i[s].predicate="or"),i[s+1].predicate||(i[s+1].predicate="or"));this.parent.notify(initiateFilterUI,{predicates:i!==[]?i:null,range:r.filterRange,sIdx:n,isCut:!0})}this.parent.sortCollection&&this.parent.notify(sortImport,null)}},e.prototype.getFilterOperator=function(e){switch(e){case"BeginsWith":e="startswith";break;case"Less":e="lessthan";break;case"EndsWith":e="endswith";break;case"Equal":e="equal";break;case"Notequal":e="notEqual";break;case"Greater":e="greaterthan";break;case"Contains":e="contains";break;case"LessOrEqual":e="lessthanorequal";break;case"GreaterOrEqual":e="greaterthanorequal"}return e},e.prototype.beforeInsertHandler=function(e){if("Column"===e.modelType){var t=ej2Base.isUndefined(e.activeSheetIndex)?this.parent.activeSheetIndex:e.activeSheetIndex;if(this.filterRange.size&&this.filterRange.has(t)){var r=this.filterRange.get(t);(this.isFilterCell(t,r[0],e.index)||e.index<r[1])&&(r[3]+=e.model.length,e.index<=r[1]&&(r[1]+=e.model.length),this.filterCollection.get(t).forEach(function(t){var r=getColIndex(t.field);e.index<=r&&(t.field=getColumnHeaderText(r+e.model.length+1))}),this.parent.sortCollection&&this.parent.sortCollection.forEach(function(r){r.sheetIndex===t&&e.index<=r.columnIndex&&(r.columnIndex+=e.model.length)}),this.getFilteredCollection())}}else if("Sheet"===e.modelType){for(var n=!1,i=0,o=Array.from(this.filterRange.keys()).sort().reverse();i<o.length;i++){var a=o[i];e.index<=a&&(n=!0,this.filterRange.set(a+e.model.length,this.filterRange.get(a)),this.filterRange.delete(a),this.filterCollection.set(a+e.model.length,this.filterCollection.get(a)),this.filterCollection.delete(a))}this.parent.sortCollection&&this.parent.sortCollection.forEach(function(t){e.index<=t.sheetIndex&&(t.sheetIndex+=e.model.length)}),n&&this.getFilteredCollection()}},e.prototype.beforeDeleteHandler=function(e){if("Column"===e.modelType){var t=this.parent.activeSheetIndex;if(this.filterRange.size&&this.filterRange.has(t)){var r=!0,n=this.filterRange.get(t);if(e.start>=n[1]&&e.end<=n[3]?n[3]-=e.end-e.start+1:e.start<n[1]&&e.end<n[1]?(n[1]-=e.end-e.start+1,n[3]-=e.end-e.start+1):e.start<n[1]&&e.end>n[1]&&e.end<n[3]?(n[1]=e.start,n[3]-=e.end-e.start+1):r=!1,r){for(var i=this.filterCollection.get(t),o=void 0,a=i.length-1;a>=0;a--){var s=getColIndex(i[a].field);e.end<s?i[a].field=getColumnHeaderText(s-(e.end-e.start+1)+1):e.start<=s&&e.end>=s&&(o=!0,i.splice(a,1))}var l=this.parent.sortCollection;if(l)for(a=0;a<l.length;a++)if(l[a].sheetIndex===t){if(e.end<l[a].columnIndex){l[a].columnIndex=l[a].columnIndex-(e.end-e.start+1);break}if(e.start<=l[a].columnIndex&&e.end>=l[a].columnIndex){l.splice(a,1);break}}n.some(function(e){return e<0})?(this.removeFilter(t,!0,!0),e.refreshSheet=!0):o&&(i&&i.length?(this.reapplyFilterHandler(!0,!0),e.refreshSheet=!1):(this.clearFilterHandler({preventRefresh:!0}),e.refreshSheet=!0)),this.getFilteredCollection()}}}},e.prototype.deleteSheetHandler=function(e){if(!ej2Base.isUndefined(e.sheetIndex)){for(var t=void 0,r=0,n=Array.from(this.filterRange.keys()).sort().reverse();r<n.length;r++){var i=n[r];t=!0,e.sheetIndex===i?(this.filterRange.delete(i),this.filterCollection.delete(i)):e.sheetIndex<i?(this.filterRange.set(i-1,this.filterRange.get(i)),this.filterRange.delete(i),this.filterCollection.set(i-1,this.filterCollection.get(i)),this.filterCollection.delete(i)):t=!1}var o=this.parent.sortCollection;if(o)for(var a=o.length-1;a>=0;a--)e.sheetIndex===o[a].sheetIndex?o.splice(a,1):e.sheetIndex<o[a].sheetIndex&&(o[a].sheetIndex-=1);t&&this.getFilteredCollection()}},e.prototype.clearHanlder=function(e){var t=this.parent.getAddressInfo(e.range);if(this.filterRange.has(t.sheetIndex)){var r=this.filterRange.get(t.sheetIndex).slice();inRange(t.indices,r[0],r[1])&&inRange(t.indices,r[0],r[3])&&this.removeFilter(t.sheetIndex)}},e}(),SpreadsheetImage=function(){function e(e){this.pictureCount=1,this.parent=e,this.addEventListener(),this.renderImageUpload()}return e.prototype.addEventListener=function(){this.parent.on(insertImage,this.insertImage,this),this.parent.on(refreshImgElem,this.refreshImgElem,this),this.parent.on(refreshImgCellObj,this.refreshImgCellObj,this),this.parent.on(createImageElement,this.createImageElement,this),this.parent.on(deleteImage,this.deleteImage,this),this.parent.on(refreshImagePosition,this.refreshInsDelImagePosition,this)},e.prototype.renderImageUpload=function(){this.parent.element.appendChild(this.parent.createElement("input",{id:this.parent.element.id+"_imageUpload",styles:"display: none;",attrs:{type:"file",accept:".image, .jpg, .png, .gif ,jpeg",name:"fileUpload"}})).onchange=this.imageSelect.bind(this)},e.prototype.imageSelect=function(e){var t=e.target.files[0];t&&(t.type.includes("image")?this.insertImage({file:t}):this.parent.serviceLocator.getService(dialog).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant("UnsupportedFile"),width:"300"}),e.target.value="")},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(insertImage,this.insertImage),this.parent.off(refreshImgCellObj,this.refreshImgCellObj),this.parent.off(createImageElement,this.createImageElement),this.parent.off(deleteImage,this.deleteImage),this.parent.off(refreshImagePosition,this.refreshInsDelImagePosition))},e.prototype.insertImage=function(e,t){var r=this;this.binaryStringVal(e).then(function(e){return r.createImageElement({options:{src:e},range:t,isPublic:!0})})},e.prototype.binaryStringVal=function(e){return new Promise(function(t,r){var n=new FileReader;n.readAsDataURL(e.file),n.onload=function(){return t(n.result)},n.onerror=function(e){return r(e)}})},e.prototype.createImageElement=function(e){var t=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,r=e.range&&e.range.indexOf("!")>0?getSheetIndex(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,n=this.parent.serviceLocator.getService(overlay),i=e.options.imageId?e.options.imageId:this.parent.element.id+"_overlay_picture_"+this.pictureCount,o=getRangeIndexes(t),a=r?this.parent.sheets[r]:this.parent.getActiveSheet();if(!document.getElementById(i)){var s={requestType:"beforeInsertImage",range:a.name+"!"+t,imageData:e.options.src,sheetIndex:r};if(e.isPublic&&this.parent.notify("actionBegin",{eventArgs:s,action:"beforeInsertImage"}),!s.cancel){var l=n.insertOverlayElement(i,t,r);l.style.backgroundImage="url('"+e.options.src+"')",(e.options.height||e.options.left)&&(l.style.height=e.options.height+"px",l.style.width=e.options.width+"px",l.style.top=e.options.top+"px",l.style.left=e.options.left+"px"),(a.frozenRows||a.frozenColumns)&&n.adjustFreezePaneSize(e.options,l,t),e.options.imageId||this.pictureCount++;var d={src:e.options.src,id:i,height:parseFloat(l.style.height.replace("px","")),width:parseFloat(l.style.width.replace("px","")),top:a.frozenRows||a.frozenColumns?o[0]?getRowsHeight(a,0,o[0]-1):0:parseFloat(l.style.top.replace("px","")),left:a.frozenRows||a.frozenColumns?o[1]?getColumnsWidth(a,0,o[1]-1):0:parseFloat(l.style.left.replace("px",""))};this.parent.setUsedRange(o[0],o[1]),(e.isPublic||e.isUndoRedo)&&this.parent.notify(setImage,{options:[d],range:a.name+"!"+t});var p=getCell(o[0],o[1],a);p.image[p.image.length-1].id||(p.image[p.image.length-1].id=d.id),!e.isUndoRedo&&e.isPublic&&(s={requestType:"insertImage",range:a.name+"!"+t,imageHeight:e.options.height?e.options.height:300,imageWidth:e.options.width?e.options.width:400,imageData:e.options.src,id:i,sheetIndex:r},this.parent.notify("actionComplete",{eventArgs:s,action:"insertImage"}))}}},e.prototype.refreshImgElem=function(){var e=document.getElementsByClassName("e-ss-overlay-active")[0];e&&ej2Base.removeClass([e],"e-ss-overlay-active")},e.prototype.refreshInsDelImagePosition=function(e){for(var t,r,n,i=e.count,o=e.sheetIdx,a=this.parent.sheets[o],s=getCell(e.rowIdx,e.colIdx,a),l=s.image.length,d=0;d<l;d++)t=document.getElementById(s.image[d].id),r="Row"===e.type?"insert"===e.status?s.image[d].top+20*i:s.image[d].top-20*i:s.image[d].top,n="Column"===e.type?"insert"===e.status?s.image[d].left+64*i:s.image[d].left-64*i:s.image[d].left,s.image[d].top=r,s.image[d].left=n,t.style.top=r+"px",t.style.left=n+"px"},e.prototype.refreshImgCellObj=function(e){var t,r,n=this.parent.getActiveSheet(),i=getCell(e.prevRowIdx,e.prevColIdx,n),o=getCell(e.currentRowIdx,e.currentColIdx,n),a=i?i.image:[],s=a&&a.length?a.length:0;if(i&&i.image&&a.length>0){for(var l=0;l<s;l++)a[l]&&a[l].id===e.id&&((t=a[l]).height=e.currentHeight,t.width=e.currentWidth,t.top=e.currentTop,t.left=e.currentLeft,a.splice(l,1));if(o&&o.image&&(r=o.image,t&&r.push(t)),setCell(e.currentRowIdx,e.currentColIdx,n,r?{image:r}:{image:[t]},!0),"imageRefresh"===e.requestType&&!e.isUndoRedo){var d={requestType:"imageRefresh",currentRowIdx:e.currentRowIdx,currentColIdx:e.currentColIdx,prevRowIdx:e.prevRowIdx,prevColIdx:e.prevColIdx,prevTop:e.prevTop,prevLeft:e.prevLeft,currentTop:e.currentTop,currentLeft:e.currentLeft,currentHeight:e.currentHeight,currentWidth:e.currentWidth,prevHeight:e.prevHeight,prevWidth:e.prevWidth,id:e.id,sheetIdx:this.parent.activeSheetIndex};this.parent.notify("actionComplete",{eventArgs:d,action:"imageRefresh"})}}},e.prototype.deleteImage=function(e){var t,r,n=this.parent.getActiveSheet(),i=document.getElementById(e.id);if(i){var o=void 0,a=void 0;if(n.frozenRows||n.frozenColumns){var s=i.getBoundingClientRect();o={clientY:s.top},a={clientX:s.left},s.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(o.target=this.parent.getColumnHeaderContent()),s.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(a.target=this.parent.getRowHeaderTable())}else o={clientY:i.offsetTop,isImage:!0},a={clientX:i.offsetLeft,isImage:!0};this.parent.notify(getRowIdxFromClientY,o),this.parent.notify(getColIdxFromClientX,a),document.getElementById(e.id).remove(),t=o.clientY,r=a.clientX,n=this.parent.sheets[this.parent.activeSheetIndex]}else{var l=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,d=e.range&&e.range.indexOf("!")>0?getSheetIndex(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,p=getRangeIndexes(l);t=p[0],r=p[1],n=this.parent.sheets[d]}for(var h=getCell(t,r,n).image,c=h.length,u=0;u<c;u++)h[u].id===e.id&&h.splice(u,1);setCell(t,r,n,{image:h},!0)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.getModuleName=function(){return"spreadsheetImage"},e}();ej2Charts.Chart.Inject(ej2Charts.ColumnSeries,ej2Charts.LineSeries,ej2Charts.BarSeries,ej2Charts.AreaSeries,ej2Charts.StackingColumnSeries,ej2Charts.StackingLineSeries,ej2Charts.StackingBarSeries,ej2Charts.ScatterSeries),ej2Charts.Chart.Inject(ej2Charts.StackingAreaSeries,ej2Charts.Category,ej2Charts.Legend,ej2Popups.Tooltip,ej2Charts.DataLabel),ej2Charts.AccumulationChart.Inject(ej2Charts.PieSeries,ej2Charts.AccumulationTooltip,ej2Charts.AccumulationDataLabel,ej2Charts.AccumulationLegend);var SpreadsheetChart=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(initiateChart,this.initiateChartHandler,this),this.parent.on(refreshChartCellObj,this.refreshChartCellObj,this),this.parent.on(updateChart,this.updateChartHandler,this),this.parent.on(deleteChart,this.deleteChart,this),this.parent.on(clearChartBorder,this.clearBorder,this),this.parent.on(insertChart,this.insertChartHandler,this),this.parent.on(chartRangeSelection,this.chartRangeHandler,this),this.parent.on(chartDesignTab,this.chartDesignTabHandler,this),this.parent.on(addChartEle,this.updateChartElement,this)},e.prototype.insertChartHandler=function(e){var t="Column";switch(e.id){case"clusteredColumn":t="Column";break;case"stackedColumn":t="StackingColumn";break;case"stackedColumn100":t="StackingColumn100";break;case"clusteredBar":t="Bar";break;case"stackedBar":t="StackingBar";break;case"stackedBar100":t="StackingBar100";break;case"area":t="Area";break;case"stackedArea":t="StackingArea";break;case"stackedArea100":t="StackingArea100";break;case"line":t="Line";break;case"stackedLine":t="StackingLine";break;case"stackedLine100":t="StackingLine100";break;case"pie":t="Pie";break;case"doughnut":t="Doughnut";break;case"scatter":t="Scatter"}var r=[{type:t}];e.isChart?this.parent.notify(setChart,{chart:r}):this.parent.notify(chartDesignTab,{chartType:t})},e.prototype.chartRangeHandler=function(){var e=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");if(e)for(var t=e.getElementsByClassName("e-control")[0].id,r=this.parent.chartColl,n=r.length,i=0;i<n;i++){var o=document.getElementById(r[i].id);e&&o&&r[i].id===t&&this.parent.notify(initiateChart,{option:r[i],chartCount:this.parent.chartCount,isRefresh:!0})}},e.prototype.getPropertyValue=function(e,t,r){var n=this.parent.sheets;if(n[r]&&n[r].rows[e]&&n[r].rows[e].cells[t]){var i=getCell(e,t,this.parent.sheets[r]),o="";if(i.format){var a={type:getTypeFromFormat(i.format),value:i&&i.value,format:i&&i.format?i.format:"General",formattedText:i&&i.value,onLoad:!0,isRightAlign:!1,cell:i,rowIndex:e.toString(),colIndex:t.toString()};if(i)if(this.parent.notify(getFormattedCellObject,a),"number"==typeof a.value){var s=new RegExp("[!@#$%^&()+=';,{}|\":<>~_-]","g");a.formattedText=a.formattedText.toString().replace(s,""),o=parseInt(a.formattedText.toString(),10)}else o=a.formattedText.toString()}else o=this.parent.sheets[r].rows[e].cells[t].value;return o=ej2Base.isNullOrUndefined(o)?"":o}return""},e.prototype.updateChartHandler=function(e){var t=this.initiateChartHandler({option:e.chart,isRefresh:!0}),r=this.parent.element.querySelector("."+e.chart.id);if(r){var n=ej2Base.getComponent(r,"chart");ej2Base.isNullOrUndefined(n)&&(n=ej2Base.getComponent(r,"accumulationchart")),n.series=t,n.refresh()}},e.prototype.refreshChartCellObj=function(e){var t,r,n=this.parent.sheets[this.parent.activeSheetIndex],i=getCell(e.prevRowIdx,e.prevColIdx,n),o=getCell(e.currentRowIdx,e.currentColIdx,n),a=i?i.chart:[],s=a&&a.length?a.length:0;if(i&&i.chart){for(var l=0;l<s;l++){var d=document.getElementsByClassName("e-datavisualization-chart e-ss-overlay-active")[0],p=document.getElementById(a[l].id);if(ej2Base.closest(p,"."+d.classList[1])===d){(t=a[l]).height=e.currentHeight,t.width=e.currentWidth,t.top=e.currentTop,t.left=e.currentLeft,a.splice(l,1);for(var h=0,c=this.parent.chartColl.length;h<c;h++)t.id===this.parent.chartColl[h].id&&(t.height=e.currentHeight,this.parent.chartColl[h].width=e.currentWidth,this.parent.chartColl[h].top=e.currentTop,this.parent.chartColl[h].left=e.currentLeft)}}if(o&&o.chart&&(r=o.chart,t&&r.push(t)),setCell(e.currentRowIdx,e.currentColIdx,n,r?{chart:r}:{chart:[t]},!0),"chartRefresh"===e.requestType&&!e.isUndoRedo){var u={requestType:"chartRefresh",currentRowIdx:e.currentRowIdx,currentColIdx:e.currentColIdx,currentWidth:e.currentWidth,prevHeight:e.prevHeight,prevWidth:e.prevWidth,prevRowIdx:e.prevRowIdx,prevColIdx:e.prevColIdx,prevTop:e.prevTop,prevLeft:e.prevLeft,currentTop:e.currentTop,currentLeft:e.currentLeft,currentHeight:e.currentHeight,id:e.id,sheetIdx:this.parent.activeSheetIndex};this.parent.notify("actionComplete",{eventArgs:u,action:"chartRefresh"})}}},e.prototype.processChartRange=function(e,t,r){var n,i,o,a=e[0],s=e[1],l=!1,d=e[2],p=e[3],h=a===d,c=s===p,u=this.getPropertyValue(a,p,t),g=this.getPropertyValue(d,s,t),f=this.getPropertyValue(a,s,t);return isNumber(g)&&f||(l=!0),ej2Base.isNullOrUndefined(f)&&!h&&!c||"Scatter"===r.type&&e[3]-e[1]==1?(n=[a+1,s,d,s],i=[a+1,s+1,d,p],o=[a,s+1,a,p]):ej2Base.isNullOrUndefined(g)||!l||h||c?(i=[a,s,d,p],ej2Base.isNullOrUndefined(u)||isNumber(u)||isDateTime(u)?ej2Base.isNullOrUndefined(f)&&(h||c)&&(o=[a,s,a,p],h?(i[1]=i[1]+1,o[3]=o[1]):i[0]=i[0]+1):(o=[a,s,a,p],i[0]=i[0]+1)):ej2Base.isNullOrUndefined(u)||isNumber(u)&&f?(n=[a,s,d,s],i=[a,s+1,d,p]):(n=[a+1,s,d,s],i=[a+1,s+1,d,p],o=[a,s+1,a,p]),{xRange:n,yRange:i,lRange:o}},e.prototype.toIntrnlRange=function(e,t){return e?"string"==typeof e&&(e=getRangeIndexes[e]):e=getRangeIndexes[this.parent.sheets[t].selectedRange],e},e.prototype.getRangeData=function(e){e.range=this.toIntrnlRange(e.range,e.sheetIdx);var t=[];return this.pushRowData(e,e.range[0],e.range[1],e.range[2],e.range[3],t,[],!0,e.isYvalue),t},e.prototype.pushRowData=function(e,t,r,n,i,o,a,s,l){for(var d=r,p=this.parent.sheets[e.sheetIdx];t<=n;)if(isHiddenRow(p,t))t++;else{for(r=d;r<=i;)if(isHiddenCol(p,r))r++;else{var h="",c=getCell(t,r,p);if(c&&c.format&&!l){var u={value:c&&c.value,format:c&&c.format?c.format:"General",formattedText:c&&c.value,onLoad:!0,type:c&&getTypeFromFormat(c.format),rowIndex:t.toString(),colIndex:r.toString(),isRightAlign:!1,cell:c};this.parent.notify(getFormattedCellObject,u),h=u.formattedText.toString()}else h=c?ej2Base.isNullOrUndefined(c.value)?"":c.value:"";o.push({value:h}),r++}t++}a.push(t)},e.prototype.toArrayData=function(e){for(var t,r=0,n=[],i=e.length;r<i;)t=e[r],Object.keys(t).length?"value"in t&&n.push(t.value):n.push(""),r++;return n},e.prototype.getVirtualXValues=function(e){for(var t=1,r=[];t<e;)r.push(t.toString()),t++;return r},e.prototype.processChartSeries=function(e,t,r,n,i){e=e||{};var o,a,s,l,d,p,h,c="",u={},g={},f=0,m=0,v=[];t=ej2Base.isNullOrUndefined(t)?this.parent.getActiveSheet().index:t;var C=this.parent.sheets[t],y=this.getRangeData({range:n,sheetIdx:t,skipFormula:!0,isYvalue:!0}),x=n[2]-n[0]+1-this.parent.hiddenCount(n[0],n[2],"rows",C),b=n[3]-n[1]+1-this.parent.hiddenCount(n[0],n[2],"columns",C);e.isSeriesInRows?(a=i?this.toArrayData(this.getRangeData({range:i,sheetIdx:t,skipFormula:!1,isYvalue:!1})):this.getVirtualXValues(b+1),r&&(s=this.toArrayData(this.getRangeData({range:r,sheetIdx:t,skipFormula:!1,isYvalue:!1}))),l=x):(a=r?this.toArrayData(this.getRangeData({range:r,sheetIdx:t,skipFormula:!1,isYvalue:!1})):this.getVirtualXValues(x+1),i&&(s=this.toArrayData(this.getRangeData({range:i,sheetIdx:t,skipFormula:!1,isYvalue:!1}))),l=b);var S=a.length,w=e.isSeriesInRows?1:l;for(ej2Base.isNullOrUndefined(e.dataLabelSettings)||(u.visible=e.dataLabelSettings.visible,u.position=e.dataLabelSettings.position);f<l;){for(p=0,d=[],m=e.isSeriesInRows?m:f;p<S;)y[m]&&(isNumber(o=y[m].value)?o=Number(o):(h=dateToInt(o),o=isNaN(h)?0:h),d.push({x:a[p],y:o})),m+=w,p++;if(c=s&&s.length>0?s[f]:"series"+f,e.type){var I=e.type;if("Line"===I||"StackingLine"===I||"StackingLine100"===I)g={dataSource:d,type:e.type,xName:"x",yName:"y",name:c.toString(),marker:{visible:!0,width:10,height:10,dataLabel:u}};else if("Scatter"===I)g={dataSource:d,type:e.type,xName:"x",yName:"y",name:c.toString(),marker:{visible:!1,width:12,height:12,shape:"Circle",dataLabel:u}};else if("Pie"===I||"Doughnut"===I){var R="Pie"===e.type?"0%":"40%",E=u.visible,k=ej2Base.isNullOrUndefined(u.position)?"Inside":"Outer"===u.position?"Outside":"Inside";g={dataSource:d,dataLabel:{visible:!ej2Base.isNullOrUndefined(E)&&E,position:k,name:"text",font:{fontWeight:"600"}},radius:"100%",xName:"x",yName:"y",innerRadius:R}}else g={dataSource:d,type:e.type,xName:"x",yName:"y",name:c.toString(),marker:{dataLabel:u}}}v.push(g),f++}var F;return e.type&&(F={series:v,xRange:e.isSeriesInRows?i:r,yRange:n,lRange:e.isSeriesInRows?r:i}),F},e.prototype.primaryYAxisFormat=function(e){if(ej2Base.isNullOrUndefined(e))return"{value}";var t,r=getCell(e[0],e[1],this.parent.getActiveSheet());if(r&&r.format){if("Accounting"===(t=getTypeFromFormat(r.format)))return"${value}";if("Currency"===t)return"${value}";if("Percentage"===t)return"{value}%"}return"{value}"},e.prototype.focusChartRange=function(e,t,r){var n=["e-rcborderright","e-rcborderbottom","e-vcborderright","e-vcborderbottom","e-bcborderright","e-bcborderbottom"];this.clearBorder();var i,o=this.parent.getActiveSheet(),a=!(!o.frozenRows&&!o.frozenColumns);r&&(a?i=r:this.parent.notify(focusBorder,{startcell:{rowIndex:r[0],colIndex:r[1]},endcell:{rowIndex:r[2],colIndex:r[3]},classes:[n[0],n[1]]})),e&&(a?i?(i[0]=Math.min(r[0],e[0]),i[1]=Math.min(r[1],e[1]),i[2]=Math.max(r[2],e[2]),i[3]=Math.max(r[3],e[3])):i=e:this.parent.notify(focusBorder,{startcell:{rowIndex:e[0],colIndex:e[1]},endcell:{rowIndex:e[2],colIndex:e[3]},classes:[n[2],n[3]]})),a&&i?this.parent.notify(focusBorder,{startcell:{rowIndex:Math.min(i[0],t[0]),colIndex:Math.min(i[1],t[1])},endcell:{rowIndex:Math.max(i[2],t[2]),colIndex:Math.max(i[3],t[3])},classes:[n[4],n[5]]}):this.parent.notify(focusBorder,{startcell:{rowIndex:t[0],colIndex:t[1]},endcell:{rowIndex:t[2],colIndex:t[3]},classes:[n[4],n[5]]})},e.prototype.clearBorder=function(){var e=this.parent.getActiveSheet();if(e.frozenColumns||e.frozenRows){[].slice.call(this.parent.element.getElementsByClassName("e-chart-range")).forEach(function(e){ej2Base.detach(e)})}else for(var t=this.parent.getMainContent(),r=["e-rcborderright","e-rcborderbottom","e-vcborderright","e-vcborderbottom","e-bcborderright","e-bcborderbottom"],n=0,i=r.length;n<i;n++)for(var o=t.querySelectorAll("."+r[n]),a=0,s=o.length;a<s;a++){o[a].classList.remove(r[n])}},e.prototype.initiateChartHandler=function(e){var t=e.option,r=!0;r=!!ej2Base.isNullOrUndefined(e.isInitCell)||!e.isInitCell,e.isUndoRedo=!!ej2Base.isNullOrUndefined(e.isUndoRedo)||e.isUndoRedo;e.isRefresh=!ej2Base.isNullOrUndefined(e.isRefresh)&&e.isRefresh;var n,i,o=this.parent.getActiveSheet(),a=t.range?t.range.indexOf("!")>0?t.range.split("!")[1]:t.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,s=getRangeIndexes(a),l={};if(this.parent.allowChart||!o.isProtected){var d=t.range&&t.range.indexOf("!")>0?getSheetIndex(this.parent,t.range.split("!")[0]):this.parent.activeSheetIndex,p={sheetIndex:d,reqType:"shape",type:"actionBegin",shapeType:"chart",action:"create",options:t,range:a,operation:"create"};if(l=p.options,a=p.range,l=l||{},s.length>0){s[2]-s[0]<s[3]-s[1]&&(n=!0)}l.isSeriesInRows=!!n||!!l.isSeriesInRows&&l.isSeriesInRows,e.dataSheetIdx=ej2Base.isNullOrUndefined(e.dataSheetIdx)?d:e.dataSheetIdx;var h=this.processChartRange(s,e.dataSheetIdx,l),c=h.xRange,u=h.yRange,g=h.lRange;d===this.parent.activeSheetIndex&&r&&this.focusChartRange(c,u,g);var f=this.processChartSeries(l,e.dataSheetIdx,c,u,g),m={majorGridLines:t.primaryXAxis&&t.primaryXAxis.majorGridLines&&!ej2Base.isNullOrUndefined(t.primaryXAxis.majorGridLines.width)?{width:t.primaryXAxis.majorGridLines.width}:{width:0},minorGridLines:t.primaryXAxis&&t.primaryXAxis.minorGridLines&&!ej2Base.isNullOrUndefined(t.primaryXAxis.minorGridLines.width)?{width:t.primaryXAxis.minorGridLines.width}:{width:0},minorTicksPerInterval:t.primaryXAxis&&t.primaryXAxis.minorGridLines&&t.primaryXAxis.minorGridLines.width>0?5:0,lineStyle:{width:0},valueType:"Category",visible:!t.primaryXAxis||t.primaryXAxis.visible,title:t.primaryXAxis?t.primaryXAxis.title:""},v={lineStyle:{width:0},majorGridLines:t.primaryYAxis&&t.primaryYAxis.majorGridLines&&!ej2Base.isNullOrUndefined(t.primaryYAxis.majorGridLines.width)?{width:t.primaryYAxis.majorGridLines.width}:{width:1},minorGridLines:t.primaryYAxis&&t.primaryYAxis.minorGridLines&&!ej2Base.isNullOrUndefined(t.primaryYAxis.minorGridLines.width)?{width:t.primaryYAxis.minorGridLines.width}:{width:0},minorTicksPerInterval:t.primaryYAxis&&t.primaryYAxis.minorGridLines&&t.primaryYAxis.minorGridLines.width>0?5:0,labelFormat:this.primaryYAxisFormat(u),visible:!t.primaryYAxis||t.primaryYAxis.visible,title:t.primaryYAxis?t.primaryYAxis.title:""};if(e.isRefresh)return f.series;if(e.isUndoRedo){if(i={type:t.type,theme:t.theme,isSeriesInRows:t.isSeriesInRows,range:t.range,id:t.id,height:t.height,width:t.width,posRange:e.range,isInitCell:e.isInitCell,cancel:!1},this.parent.notify(beginAction,{eventArgs:i,action:"beforeInsertChart"}),i.cancel)return[];t.type=i.type,t.theme=i.theme,t.isSeriesInRows=i.isSeriesInRows,t.range=i.range,t.id=i.id,t.height=i.height,t.width=i.width}var C=t.id+"_overlay",y=e.isPaste?this.parent.getActiveSheet().index:e.option.range&&e.option.range.indexOf("!")>0?getSheetIndex(this.parent,e.option.range.split("!")[0]):this.parent.activeSheetIndex,x=this.parent.serviceLocator.getService(overlay),b=!ej2Base.isNullOrUndefined(e.isInitCell)&&e.isInitCell?e.range:a,S=x.insertOverlayElement(C,b,y);S.classList.add("e-datavisualization-chart"),S.style.width=t.width+"px",S.style.height=t.height+"px",o.frozenRows||o.frozenColumns?x.adjustFreezePaneSize(t,S,b):(S.style.top=ej2Base.isNullOrUndefined(t.top)?S.style.top:t.top+"px",S.style.left=ej2Base.isNullOrUndefined(t.left)?S.style.left:t.left+"px",t.top=parseInt(S.style.top.replace("px",""),10),t.left=parseInt(S.style.left.replace("px",""),10)),this.parent.notify(overlayEleSize,{height:t.height,width:t.width});var w="Pie"===t.type||"Doughnut"===t.type?{position:"Bottom",visible:!0}:{};ej2Base.isNullOrUndefined(t.legendSettings)||(w.visible=t.legendSettings.visible,w.position=t.legendSettings.position);var I=this.parent.createElement("div",{id:t.id,className:t.id});"Pie"!==t.type&&"Doughnut"!==t.type?(this.chart=new ej2Charts.Chart({primaryXAxis:m,primaryYAxis:v,chartArea:{border:{width:0}},title:t.title,legendSettings:w,theme:t.theme,series:f.series,tooltip:{enable:!0},width:S.style.width,height:S.style.height,load:function(e){var r=t.theme;r=r||"Material",e.chart.theme=r},beforeResize:function(e){e.cancelResizedEvent=!0}}),this.chart.appendTo(I)):(this.chart=new ej2Charts.AccumulationChart({title:t.title,legendSettings:w,theme:t.theme,series:f.series,width:S.style.width,height:S.style.height,center:{x:"50%",y:"50%"},enableSmartLabels:!0,enableAnimation:!0,load:function(e){var r=t.theme;r=r||"Material",e.chart.theme=r},beforeResize:function(e){e.cancelResizedEvent=!0}}),this.chart.appendTo(I)),S.appendChild(I),e.isUndoRedo&&this.parent.notify(completeAction,{eventArgs:i,action:"insertChart"})}},e.prototype.deleteChart=function(e){this.clearBorder();var t=null,r=this.parent.getActiveSheet();if(ej2Base.isNullOrUndefined(e.id)?(t=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active"),e.id=t?t.getElementsByClassName("e-control")[0].id:null):(e.id=e.id.includes("overlay")?e.id:e.id+"_overlay",t=document.getElementById(e.id)),!ej2Base.isNullOrUndefined(e.id)&&!ej2Base.isNullOrUndefined(t)){e.id=e.id.includes("overlay")?e.id:e.id+"_overlay";for(var n,i,o,a,s=!1,l=0,d=this.parent.chartColl.length;l<d;l++)if(this.parent.chartColl[l].id===e.id.split("_overlay")[0]){a=this.parent.chartColl[l];break}var p={id:a.id,range:a.range,type:a.type,theme:a.theme,height:a.height,width:a.width,isSeriesInRows:a.isSeriesInRows,isInitCell:!0,posRange:null,top:a.top,left:a.left,cancel:!1};if(t){var h=void 0,c=void 0;if(r.frozenRows||r.frozenColumns){var u=t.getBoundingClientRect();h={clientY:u.top},c={clientX:u.left},u.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(h.target=this.parent.getColumnHeaderContent()),u.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(c.target=this.parent.getRowHeaderTable())}else h={clientY:t.offsetTop,isImage:!0},c={clientX:t.offsetLeft,isImage:!0};this.parent.notify(deleteChartColl,{id:e.id}),this.parent.notify(getRowIdxFromClientY,h),this.parent.notify(getColIdxFromClientX,c),s=!0,n=h.clientY,i=c.clientX,r=this.parent.sheets[this.parent.activeSheetIndex]}else{this.parent.notify(deleteChartColl,{id:e.id});var g=e.range&&e.range.indexOf("!")>0?getSheetIndex(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,f=getRangeIndexes(e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange);n=f[0],i=f[1],r=this.parent.sheets[g]}var m=getCell(n,i,r);m&&(o=m.chart);var v=o?o.length:null;for(l=0;l<v;l++){var C=document.getElementById(e.id),y=document.getElementById(o[l].id);ej2Base.closest(y,"."+C.classList[1])===C&&o.splice(l,1)}s&&(document.getElementById(e.id).remove(),this.parent.notify(removeDesignChart,{})),setCell(n,i,r,{chart:o},!0),p.posRange=getCellAddress(n,i),e.isUndoRedo||this.parent.notify(completeAction,{eventArgs:p,action:"deleteChart"})}},e.prototype.updateChartModel=function(e,t,r,n,i){var o=t;t=t;var a=this.parent.chartColl[n].id;if(!(i&&["PHAxes","PVAxes","PHAxisTitle","PVAxisTitle","GLMajorHorizontal","GLMajorVertical","GLMinorHorizontal","GLMinorVertical"].indexOf(e)>-1))for(var s=0,l=r.chart.length;s<l;s++)if(r.chart[s].id===a)switch(e){case"PHAxes":case"PHAxisTitle":ej2Base.isNullOrUndefined(r.chart[s].primaryXAxis)&&(r.chart[s].primaryXAxis={},this.parent.chartColl[n].primaryXAxis={}),"PHAxes"===e?(r.chart[s].primaryXAxis.visible=t.primaryXAxis.visible,this.parent.chartColl[n].primaryXAxis.visible=t.primaryXAxis.visible):"PHAxisTitle"===e&&(r.chart[s].primaryXAxis.title=t.primaryXAxis.title,this.parent.chartColl[n].primaryXAxis.title=t.primaryXAxis.title);break;case"PVAxes":case"PVAxisTitle":ej2Base.isNullOrUndefined(r.chart[s].primaryYAxis)&&(r.chart[s].primaryYAxis={},this.parent.chartColl[n].primaryYAxis={}),"PVAxes"===e?(r.chart[s].primaryYAxis.visible=t.primaryYAxis.visible,this.parent.chartColl[n].primaryYAxis.visible=t.primaryYAxis.visible):"PVAxisTitle"===e&&(r.chart[s].primaryYAxis.title=t.primaryYAxis.title,this.parent.chartColl[n].primaryYAxis.title=t.primaryYAxis.title);break;case"ChartTitleNone":case"ChartTitleAbove":r.chart[s].title=t.title,this.parent.chartColl[n].title=t.title;break;case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":if(ej2Base.isNullOrUndefined(r.chart[s].dataLabelSettings)&&(r.chart[s].dataLabelSettings={},this.parent.chartColl[n].dataLabelSettings={}),"DLNone"===e)r.chart[s].dataLabelSettings.visible=!1,this.parent.chartColl[n].dataLabelSettings.visible=!1;else{r.chart[s].dataLabelSettings.visible=!0,this.parent.chartColl[n].dataLabelSettings.visible=!0;var d=void 0;d=i?"Outside"===o.series[0].dataLabel.position?"Outer":"Middle":t.series[0].marker.dataLabel.position,r.chart[s].dataLabelSettings.position=d,this.parent.chartColl[n].dataLabelSettings.position=d}break;case"GLMajorHorizontal":ej2Base.isNullOrUndefined(r.chart[s].primaryYAxis)&&(r.chart[s].primaryYAxis={},this.parent.chartColl[n].primaryYAxis={}),ej2Base.isNullOrUndefined(r.chart[s].primaryYAxis.majorGridLines)&&(r.chart[s].primaryYAxis.majorGridLines={},this.parent.chartColl[n].primaryYAxis.majorGridLines={}),r.chart[s].primaryYAxis.majorGridLines.width=t.primaryYAxis.majorGridLines.width,this.parent.chartColl[n].primaryYAxis.majorGridLines.width=t.primaryYAxis.majorGridLines.width;break;case"GLMajorVertical":ej2Base.isNullOrUndefined(r.chart[s].primaryXAxis)&&(r.chart[s].primaryXAxis={},this.parent.chartColl[n].primaryXAxis={}),ej2Base.isNullOrUndefined(r.chart[s].primaryXAxis.majorGridLines)&&(r.chart[s].primaryXAxis.majorGridLines={},this.parent.chartColl[n].primaryXAxis.majorGridLines={}),r.chart[s].primaryXAxis.majorGridLines.width=t.primaryXAxis.majorGridLines.width,this.parent.chartColl[n].primaryXAxis.majorGridLines.width=t.primaryXAxis.majorGridLines.width;break;case"GLMinorHorizontal":ej2Base.isNullOrUndefined(r.chart[s].primaryYAxis)&&(r.chart[s].primaryYAxis={},this.parent.chartColl[n].primaryYAxis={}),ej2Base.isNullOrUndefined(r.chart[s].primaryYAxis.minorGridLines)&&(r.chart[s].primaryYAxis.minorGridLines={},this.parent.chartColl[n].primaryYAxis.minorGridLines={}),r.chart[s].primaryYAxis.minorGridLines.width=t.primaryYAxis.minorGridLines.width,this.parent.chartColl[n].primaryYAxis.minorGridLines.width=t.primaryYAxis.minorGridLines.width;break;case"GLMinorVertical":ej2Base.isNullOrUndefined(r.chart[s].primaryXAxis)&&(r.chart[s].primaryXAxis={},this.parent.chartColl[n].primaryXAxis={}),ej2Base.isNullOrUndefined(r.chart[s].primaryXAxis.minorGridLines)&&(r.chart[s].primaryXAxis.minorGridLines={},this.parent.chartColl[n].primaryXAxis.minorGridLines={}),r.chart[s].primaryXAxis.minorGridLines.width=t.primaryXAxis.minorGridLines.width,this.parent.chartColl[n].primaryXAxis.minorGridLines.width=t.primaryXAxis.minorGridLines.width;break;case"LegendNone":case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":if(ej2Base.isNullOrUndefined(r.chart[s].legendSettings)&&(r.chart[s].legendSettings={},this.parent.chartColl[n].legendSettings={}),r.chart[s].legendSettings.visible=t.legendSettings.visible,this.parent.chartColl[n].legendSettings.visible=t.legendSettings.visible,"LegendNone"!==e){r.chart[s].legendSettings.position=t.legendSettings.position,this.parent.chartColl[n].legendSettings.position=t.legendSettings.position;break}}},e.prototype.updateChartElement=function(e,t,r,n,i,o){if(!(o&&["PHAxes","PVAxes","PHAxisTitle","PVAxisTitle","GLMajorHorizontal","GLMajorVertical","GLMinorHorizontal","GLMinorVertical"].indexOf(e)>-1)){var a;switch(e){case"PHAxes":(t=t).primaryXAxis.visible=!t.primaryXAxis.visible;break;case"PVAxes":(t=t).primaryYAxis.visible=!t.primaryYAxis.visible;break;case"PHAxisTitle":(t=t).primaryXAxis.title=i;break;case"PVAxisTitle":(t=t).primaryYAxis.title=i;break;case"ChartTitleNone":t.title="";break;case"ChartTitleAbove":t.title=i;break;case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":if(t=t,a=t.series,"DLNone"===e)for(var s=0,l=a.length;s<l;s++)o?a[s].dataLabel.visible=!1:a[s].marker.dataLabel.visible=!1;else for(s=0,l=a.length;s<l;s++)if(o){var d="DLOutsideend"===e?"Outside":"Inside";a[s].dataLabel.visible=!0,a[s].dataLabel.position=d}else{d="DLCenter"===e?"Middle":"DLInsideend"===e?"Top":"DLInsidebase"===e?"Bottom":"DLOutsideend"===e?"Outer":a[0].marker.dataLabel.position;a[s].marker.dataLabel.visible=!0,a[s].marker.dataLabel.position=d}t.series=a,o&&t.refresh();break;case"GLMajorHorizontal":(t=t).primaryYAxis.majorGridLines.width=0===t.primaryYAxis.majorGridLines.width?1:0;break;case"GLMajorVertical":(t=t).primaryXAxis.majorGridLines.width=0===t.primaryXAxis.majorGridLines.width?1:0;break;case"GLMinorHorizontal":(t=t).primaryYAxis.minorTicksPerInterval=0===t.primaryYAxis.minorGridLines.width?5:0,t.primaryYAxis.minorGridLines.width=0===t.primaryYAxis.minorGridLines.width?1:0;break;case"GLMinorVertical":(t=t).primaryXAxis.minorTicksPerInterval=0===t.primaryXAxis.minorGridLines.width?5:0,t.primaryXAxis.minorGridLines.width=0===t.primaryXAxis.minorGridLines.width?1:0;break;case"LegendNone":t.legendSettings.visible=!1;break;case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":t.legendSettings.visible=!0,t.legendSettings.position="LegendsRight"===e?"Right":"LegendsLeft"===e?"Left":"LegendsBottom"===e?"Bottom":"LegendsTop"===e?"Top":t.legendSettings.position}this.updateChartModel(e,t,r,n,o)}},e.prototype.chartDesignTabHandler=function(e){var t,r=!1,n=this.parent.sheets[this.parent.activeSheetIndex],i=e.switchRowColumn,o=e.chartType,a=e.chartTheme,s=e.addChartEle,l=null,d=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");if(d){var p,h;if(n.frozenRows||n.frozenColumns){var c=d.getBoundingClientRect();p={clientY:c.top},h={clientX:c.left},c.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(p.target=this.parent.getColumnHeaderContent()),c.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(h.target=this.parent.getRowHeaderTable())}else p={clientY:d.offsetTop,isImage:!0},h={clientX:d.offsetLeft,isImage:!0};this.parent.notify(getRowIdxFromClientY,p),this.parent.notify(getColIdxFromClientX,h);var u=getCell(p.clientY,h.clientX,n),g=d.querySelector(".e-chart");ej2Base.isNullOrUndefined(g)&&(g=d.querySelector(".e-accumulationchart"));for(var f=g.getAttribute("id"),m=0,v=this.parent.chartColl.length;m<v;m++)f===this.parent.chartColl[m].id&&(t=m);if(g&&(l=ej2Base.getComponent(g,"chart"),ej2Base.isNullOrUndefined(l)&&(l=ej2Base.getComponent(g,"accumulationchart"),r=!0)),i&&!r){this.parent.chartColl[t].isSeriesInRows=!!ej2Base.isNullOrUndefined(this.parent.chartColl[t].isSeriesInRows)||!this.parent.chartColl[t].isSeriesInRows;m=0;for(var C=u.chart.length;m<C;m++)u.chart[m].id===f&&(u.chart[m].isSeriesInRows=!!ej2Base.isNullOrUndefined(u.chart[m].isSeriesInRows)||!u.chart[m].isSeriesInRows);var y=this.initiateChartHandler({option:this.parent.chartColl[t],isRefresh:!0});l.series=y}if(o){var x=this.parent.chartColl[t].type;this.parent.chartColl[t].type=o;for(m=0,C=u.chart.length;m<C;m++)u.chart[m].id===f&&(u.chart[m].type=o);if("Pie"!==o&&"Doughnut"!==o)if("Pie"===x||"Doughnut"===x)this.changeCharType(t);else{m=0;for(var b=(y=l.series).length;m<b;m++)y[m].type=o;l.series=y,l.refresh()}else if("Pie"===x||"Doughnut"===x){for(m=0,b=(y=l.series).length;m<b;m++)y[m].innerRadius="Pie"===o?"0%":"40%";l.series=y,l.refresh()}else this.changeCharType(t)}if(a){this.parent.chartColl[t].theme=a;for(m=0,C=u.chart.length;m<C;m++)u.chart[m].id===f&&(u.chart[m].theme=a);l.theme=a,l.refresh()}if(s)if("ChartTitleAbove"===s||"PHAxisTitle"===s||"PVAxisTitle"===s){if(this.parent.element.getElementsByClassName("e-title-dlg").length>0)return;this.titleDlgHandler(s,l,u,t,r)}else this.updateChartElement(s,l,u,t,"",r)}},e.prototype.changeCharType=function(e){var t=document.getElementById(this.parent.chartColl[e].id),r=ej2Base.closest(t,".e-datavisualization-chart");r.remove(),this.parent.notify(initiateChart,{option:this.parent.chartColl[e],isInitCell:!1,isUndoRedo:!0,isPaste:!1}),t=document.getElementById(this.parent.chartColl[e].id),(r=ej2Base.closest(t,".e-datavisualization-chart")).classList.contains("e-ss-overlay-active")||r.classList.add("e-ss-overlay-active")},e.prototype.titleDlgHandler=function(e,t,r,n,i){var o=this,a="";if(!i||"PHAxisTitle"!==e&&"PVAxisTitle"!==e){var s=this.parent.serviceLocator.getService(locale),l=this.parent.serviceLocator.getService(dialog);l.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-title-dlg",header:"chart_abovechart"===e?s.getConstant("ChartTitle"):"PHAxisTitle"===e?s.getConstant("HorizontalAxisTitle"):s.getConstant("VerticalAxisTitle"),target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(){l.dialogInstance.content=o.titleDlgContent(e,t),l.dialogInstance.dataBind(),o.parent.element.focus()},buttons:[{buttonModel:{content:s.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn e-clearall-btn e-flat"},click:function(){var i=o.parent.element.querySelector(".e-title-dlg").getElementsByClassName("e-title-dlg-content")[0];a=i.getElementsByTagName("input")[0].value,l.hide(),o.updateChartElement(e,t,r,n,a)}}]}),l.dialogInstance.refresh()}},e.prototype.titleDlgContent=function(e,t){var r=this.parent.serviceLocator.getService(locale).getConstant("EnterTitle"),n=this.parent.createElement("div",{className:"e-title-dlg-content"}),i=this.parent.createElement("span",{className:"e-header e-top-header",innerHTML:r}),o=this.parent.createElement("input",{className:"e-input",id:"titleInput",attrs:{type:"text"}});return n.appendChild(i),n.appendChild(o),t&&(o.value="PHAxisTitle"===e?t.primaryXAxis.title?t.primaryXAxis.title:o.value:"PVAxisTitle"===e?t.primaryYAxis.title?t.primaryYAxis.title:o.value:t.title?t.title:o.value),n},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(initiateChart,this.initiateChartHandler),this.parent.off(refreshChartCellObj,this.refreshChartCellObj),this.parent.off(updateChart,this.updateChartHandler),this.parent.off(deleteChart,this.deleteChart),this.parent.off(clearChartBorder,this.clearBorder),this.parent.off(insertChart,this.insertChartHandler),this.parent.off(chartRangeSelection,this.chartRangeHandler),this.parent.off(chartDesignTab,this.chartDesignTabHandler),this.parent.off(addChartEle,this.updateChartElement))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null;var e=null;this.chart&&(e=this.chart.element,this.chart.destroy()),e&&ej2Base.detach(e),this.chart=null},e.prototype.getModuleName=function(){return"spreadsheetChart"},e}(),BasicModule=function(){function e(){Spreadsheet.Inject(Ribbon$$1,FormulaBar,SheetTabs,Selection,Edit,KeyboardNavigation,KeyboardShortcut,Clipboard,DataBind,Open,ContextMenu$1,Save,NumberFormat,CellFormat,Formula,Sort,CollaborativeEditing,UndoRedo,Resize,Filter,SpreadsheetHyperlink,WrapText,Insert,Delete,ProtectSheet,DataValidation,FindAndReplace,Merge,ConditionalFormatting,SpreadsheetImage,SpreadsheetChart,AutoFill)}return e.prototype.getModuleName=function(){return"basic"},e.prototype.destroy=function(){},e}(),AllModule=function(){function e(){Spreadsheet.Inject(Ribbon$$1,FormulaBar,SheetTabs,Selection,Edit,KeyboardNavigation,KeyboardShortcut,Clipboard,DataBind,Open,Save,NumberFormat,CellFormat,Formula,Sort,Resize,CollaborativeEditing,UndoRedo,Filter,SpreadsheetHyperlink,WrapText,Insert,Delete,DataValidation,ProtectSheet,FindAndReplace,Merge,SpreadsheetImage,ConditionalFormatting,SpreadsheetChart,AutoFill)}return e.prototype.getModuleName=function(){return"all"},e.prototype.destroy=function(){},e}(),__extends$9=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__decorate$8=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},ScrollSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$9(t,e),__decorate$8([ej2Base.Property(!1)],t.prototype,"isFinite",void 0),__decorate$8([ej2Base.Property(!0)],t.prototype,"enableVirtualization",void 0),t}(ej2Base.ChildProperty),SelectionSettings=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$9(t,e),__decorate$8([ej2Base.Property("Multiple")],t.prototype,"mode",void 0),t}(ej2Base.ChildProperty),DISABLED="e-disabled",WRAPTEXT="e-wraptext",locale="spreadsheetLocale",dialog="dialog",actionEvents="actionEvents",overlay="shape",fontColor={Custom:["#ffffff","#000000","#e7e6e6","#44546a","#4472c4","#ed7d31","#a5a5a5","#ffc000","#70ad47","#ff0000","#f2f2f2","#808080","#cfcdcd","#d5dce4","#d9e2f3","#fbe4d5","#ededed","#fff2cc","#e2efd9","#ffcccc","#d9d9d9","#595959","#aeaaaa","#acb9ca","#b4c6e7","#f7caac","#dbdbdb","#ffe599","#c5e0b3","#ff8080","#bfbfbf","#404040","#747070","#8496b0","#8eaadb","#f4b083","#c9c9c9","#ffd966","#a8d08d","#ff3333","#a6a6a6","#262626","#3b3838","#323e4f","#2f5496","#c45911","#7b7b7b","#bf8f00","#538135","#b30000","#7f7f7f","#0d0d0d","#161616","#212934","#1f3763","#823b0b","#525252","#7f5f00","#375623","#660000"]},fillColor={Custom:["#ffffff","#000000","#ffff00","#00ff00","#00ffff","#0000ff","#ff0000","#000080","#800080","#996633","#f2f2f2","#808080","#ffffcc","#b3ffb3","#ccffff","#ccccff","#ffcccc","#ccccff","#ff80ff","#f2e6d9","#d9d9d9","#595959","#ffff80","#80ff80","#b3ffff","#8080ff","#ff8080","#8080ff","#ff00ff","#dfbf9f","#bfbfbf","#404040","#ffff33","#33ff33","#33ffff","#3333ff","#ff3333","#0000b3","#b300b3","#c68c53","#a6a6a6","#262626","#e6e600","#00b300","#009999","#000099","#b30000","#000066","#660066","#86592d","#7f7f7f","#0d0d0d","#999900","#006600","#006666","#000066","#660000","#00004d","#4d004d","#734d26"]},keyCodes={UP:38,DOWN:40,LEFT:37,RIGHT:39,FIRSTALPHABET:65,LASTALPHABET:90,SPACE:32,BACKSPACE:8,TAB:9,DELETE:46,ENTER:13,ESC:27},defaultLocale={FindValue:"Find value",ReplaceValue:"Replace value",FindReplaceTooltip:"Find & Replace",InsertingEmptyValue:"Reference value is not valid.",ReplaceAllEnd:" matches replaced with ",ByRow:"By Rows",ByColumn:"By Columns",MatchCase:"Match case   ",MatchExactCellElements:"Match exact cell contents",Replace:"Replace...",Find:"Find and Replace...",Goto:"Goto...",EntercellAddress:"Enter cell address",GotoSpecial:"GotoSpecial...",FindAndReplace:"Find and Replace",FindNextBtn:"Find Next",FindPreviousBtn:"Find Previous",ReplaceBtn:"Replace",ReplaceAllBtn:"Replace All",GotoHeader:"Go To",GotoSpecialHeader:"Go To Special",Sheet:"Sheet",Workbook:"Workbook",NoElements:"We couldn't find what you were looking for.",FindWhat:"Find what",ReplaceWith:"Replace with",Cut:"Cut",Copy:"Copy",Paste:"Paste",PasteSpecial:"Paste Special",Link:"Link",Spreadsheet:"Spreadsheet",SpreadsheetHyperlink:"SpreadsheetHyperlink",Hyperlink:"Hyperlink",EditHyperlink:"Edit Hyperlink",OpenHyperlink:"Open Hyperlink",RemoveHyperlink:"Remove Hyperlink",InvalidHyperlinkAlert:"The address of this site is not valid. Check the address and try again.",InsertLink:"Insert Link",EditLink:"Edit Link",All:"All",Values:"Values",Formats:"Formats",Bold:"Bold",Font:"Font",FontSize:"Font Size",Italic:"Italic",Underline:"Underline",Strikethrough:"Strikethrough",TextColor:"Text Color",FillColor:"Fill Color",HorizontalAlignment:"Horizontal Alignment",AlignLeft:"Align Left",AlignCenter:"Center",AlignRight:"Align Right",VerticalAlignment:"Vertical Alignment",AlignTop:"Align Top",AlignMiddle:"Align Middle",AlignBottom:"Align Bottom",WrapText:"Wrap Text",MergeCells:"Merge Cells",MergeAll:"Merge All",MergeHorizontally:"Merge Horizontally",MergeVertically:"Merge Vertically",Unmerge:"Unmerge",UnmergeCells:"Unmerge Cells",SelectMergeType:"Select Merge Type",MergeCellsAlert:"Merging cells will only preserve the top-leftmost(Uppermost) value. Merge anyway?",PasteMergeAlert:'We can"t do that to a merge cell.',Borders:"Borders",TopBorders:"Top Borders",LeftBorders:"Left Borders",RightBorders:"Right Borders",BottomBorders:"Bottom Borders",AllBorders:"All Borders",HorizontalBorders:"Horizontal Borders",VerticalBorders:"Vertical Borders",OutsideBorders:"Outside Borders",InsideBorders:"Inside Borders",NoBorders:"No Borders",BorderColor:"Border Color",BorderStyle:"Border Style",InsertFunction:"Insert Function",Insert:"Insert",Delete:"Delete",DuplicateSheet:"Duplicate",MoveRight:"Move Right",MoveLeft:"Move Left",Rename:"Rename",Hide:"Hide",FileName:"File Name",EnterName:"Enter Name",InvalidFileName:"File name contains invalid character.",PROPER:"Converts a text to proper case; first letter to uppercase and other letters to lowercase.",Unhide:"Unhide",NameBox:"Name Box",ShowHeaders:"Show Headers",HideHeaders:"Hide Headers",ShowGridLines:"Show Gridlines",ExtendValidation:"The selection contains some cells without data validation. Do you want to extend validation to these cells?",Yes:"Yes",No:"No",HideGridLines:"Hide Gridlines",FreezePanes:"Freeze Panes",FreezeRows:"Freeze Rows",FreezeColumns:"Freeze Columns",UnfreezePanes:"Unfreeze Panes",UnfreezeRows:"Unfreeze Rows",UnfreezeColumns:"Unfreeze Columns",AddSheet:"Add Sheet",ListAllSheets:"List All Sheets",FullScreen:"Full Screen",CollapseToolbar:"Collapse Toolbar",ExpandToolbar:"Expand Toolbar",CollapseFormulaBar:"Collapse Formula Bar",ExpandFormulaBar:"Expand Formula Bar",File:"File",Home:"Home",Formulas:"Formulas",View:"View",New:"New",Open:"Open",SaveAs:"Save As",Update:"Update",ExcelXlsx:"Microsoft Excel",ExcelXls:"Microsoft Excel 97-2003",CSV:"Comma-separated values",FormulaBar:"Formula Bar",Sort:"Sort",SortAscending:"Ascending",SortDescending:"Descending",CustomSort:"Custom Sort",AddColumn:"Add Column",ContainsHeader:"Data contains header",CaseSensitive:"Case sensitive",SortBy:"Sort by",ThenBy:"Then by",SelectAColumn:"Select a column",SortEmptyFieldError:"Sort criteria column should not be empty.",SortDuplicateFieldError:" is mentioned more than once. Duplicate columns must be removed.",SortOutOfRangeError:"Select a cell or range inside the used range and try again.",MultiRangeSortError:"This can't be done on a multiple range selection. Select a single range and try again.",SortAndFilter:"Sort & Filter",Filter:"Filter",ClearAllFilter:"Clear",ClearFilterFrom:"Clear Filter From ",ReapplyFilter:"Reapply",FilterCellValue:"Filter by Value of Selected Cell",FilterOutOfRangeError:"Select a cell or range inside the used range and try again.",HideRow:"Hide Row",HideRows:"Hide Rows",UnHideRows:"UnHide Rows",HideColumn:"Hide Column",HideColumns:"Hide Columns",UnHideColumns:"UnHide Columns",InsertRow:"Insert Row",InsertRows:"Insert Rows",Above:"Above",Below:"Below",InsertColumn:"Insert Column",InsertColumns:"Insert Columns",Before:"Before",After:"After",DeleteRow:"Delete Row",DeleteRows:"Delete Rows",DeleteColumn:"Delete Column",DeleteColumns:"Delete Columns",Ok:"OK",Close:"Close",Cancel:"Cancel",Apply:"Apply",MoreColors:"More Colors",StandardColors:"Standard Colors",General:"General",Number:"Number",Currency:"Currency",Accounting:"Accounting",ShortDate:"Short Date",LongDate:"Long Date",Time:"Time",Percentage:"Percentage",Fraction:"Fraction",Scientific:"Scientific",Text:"Text",Custom:"Custom",MobileFormulaBarPlaceHolder:"Enter value or Formula",NumberFormat:"Number Format",PasteAlert:"You can't paste this here, because the copy area and paste area aren't in the same size. Please try pasting in a different range.",DestroyAlert:"Are you sure you want to destroy the current workbook without saving and create a new workbook?",SheetRenameInvalidAlert:"Sheet name contains invalid character.",SheetRenameEmptyAlert:"Sheet name cannot be empty.",SheetRenameAlreadyExistsAlert:"Sheet name already exists. Please enter another name.",DeleteSheetAlert:"You can't undo deleting sheets, and you might be removing some data. If you don't need it, click OK to delete.",DeleteSingleLastSheetAlert:"A Workbook must contain at least one visible worksheet.",PickACategory:"Pick a category",Description:"Description",UnsupportedFile:"Unsupported File",InvalidUrl:"Invalid URL",SUM:"Adds a series of numbers and/or cells.",SUMIF:"Adds the cells based on specified condition.",SUMIFS:"Adds the cells based on specified conditions.",ABS:"Returns the value of a number without its sign.",RAND:"Returns a random number between 0 and 1.",RANDBETWEEN:"Returns a random integer based on specified values.",FLOOR:"Rounds a number down to the nearest multiple of a given factor.",CEILING:"Rounds a number up to the nearest multiple of a given factor.",PRODUCT:"Multiplies a series of numbers and/or cells.",INT:"Returns a number to the nearest integer.",ROUNDUP:"Rounds a number away from zero.",SUMPRODUCT:"Returns sum of the product of given ranges of arrays.",SORT:"Sorts a range of an array",T:"Checks whether a value is text or not and returns the text.",EXACT:"Checks whether a two text strings are exactly same and returns TRUE or FALSE.",LEN:"Returns a number of characters in a given string.",MOD:"Returns a remainder after a number is divided by divisor.",ODD:"Rounds a positive number up and negative number down to the nearest odd integer.",PI:"Returns the value of pi.",COUNTBLANK:"Returns the number of empty cells in a specified range of cells.",EVEN:"Rounds a positive number up and negative number down to the nearest even integer.",DECIMAL:"Converts a text representation of a number in a given base into a decimal number.",DEGREES:"Converts radians to degrees.",ADDRESS:"Returns a cell reference as text, given specified row and column numbers.",TIME:"Converts hours, minutes, seconds to the time formatted text.",CHAR:"Returns the character from the specified number.",CODE:"Returns the numeric code for the first character in a given string.",DOLLAR:"Converts the number to currency formatted text.",SMALL:"Returns the k-th smallest value in a given array.",LARGE:"Returns the k-th largest value in a given array.",FACT:"Returns the factorial of a number.",MEDIAN:"Returns the median of the given set of numbers.",EDATE:"Returns a date with given number of months before or after the specified date.",DATEVALUE:"Converts a date string into date value.",HOUR:"Returns the number of hours in a specified time string.",SECOND:"Returns the number of seconds in a specified time string.",MINUTE:"Returns the number of minutes in a specified time string.",NOW:"Returns the current date and time.",MONTH:"Returns the number of months in a specified date string.",TODAY:"Returns the current date as date value.",WEEKDAY:"Returns the day of the week corresponding to a date.",AVERAGE:"Calculates average for the series of numbers and/or cells excluding text.",AVERAGEIF:"Calculates average for the cells based on specified criterion.",AVERAGEIFS:"Calculates average for the cells based on specified conditions.",AVERAGEA:"Calculates the average for the cells evaluating TRUE as 1, text and FALSE as 0.",COUNT:"Counts the cells that contain numeric values in a range.",COUNTIF:"Counts the cells based on specified condition.",COUNTIFS:"Counts the cells based on specified conditions.",COUNTA:"Counts the cells that contains values in a range.",MIN:"Returns the smallest number of the given arguments.",MAX:"Returns the largest number of the given arguments.",DATE:"Returns the date based on given year, month, and day.",DAY:"Returns the day from the given date.",DAYS:"Returns the number of days between two dates.",IF:"Returns value based on the given expression.",IFS:"Returns value based on the given multiple expressions.",CalculateAND:"Returns TRUE if all the arguments are TRUE, otherwise returns FALSE.",CalculateOR:"Returns TRUE if any of the arguments are TRUE, otherwise returns FALSE.",IFERROR:"Returns value if no error found else it will return specified value.",CHOOSE:"Returns a value from list of values, based on index number.",INDEX:"Returns a value of the cell in a given range based on row and column number.",FIND:"Returns the position of a string within another string, which is case sensitive",TEXT:"Converts a value to text in specified number format.",CONCATENATE:"Combines two or more strings together.",CONCAT:"Concatenates a list or a range of text strings.",SUBTOTAL:"Returns subtotal for a range using the given function number.",RADIANS:"Converts degrees into radians.",MATCH:"Returns the relative position of a specified value in given range.",LN:"Returns the natural logarithm of a number.",INTERCEPT:"Calculates the point of the Y-intercept line via linear regression.",UNIQUE:"Returns a unique values from a range or array",SLOPE:"Returns the slope of the line from linear regression of the data points.",DefineNameExists:"This name already exists, try different name.",DefineNameInValid:"The name that you entered is not valid.",CircularReference:"When a formula refers to one or more circular references, this may result in an incorrect calculation.",ShowRowsWhere:"Show rows where:",OR:"OR",AND:"AND",CustomFilterDatePlaceHolder:"Choose a date",CustomFilterPlaceHolder:"Enter the value",CustomFilter:"Custom Filter",Between:"Between",DateTimeFilter:"DateTime Filters",Undo:"Undo",Redo:"Redo",DateFilter:"Date Filters",TextFilter:"Text Filters",NumberFilter:"Number Filters",ClearFilter:"Clear Filter",NoResult:"No Matches Found",FilterFalse:"False",FilterTrue:"True",Blanks:"Blanks",SelectAll:"Select All",GreaterThanOrEqual:"Greater Than Or Equal",GreaterThan:"Greater Than",LessThanOrEqual:"Less Than Or Equal",LessThan:"Less Than",NotEqual:"Not Equal",Equal:"Equal",Contains:"Contains",EndsWith:"Ends With",StartsWith:"Starts With",ClearButton:"Clear",FilterButton:"Filter",CancelButton:"Cancel",OKButton:"OK",Search:"Search",ProtectSheet:"Protect Sheet",UnprotectSheet:"Unprotect Sheet",LockCells:"Lock Cells",SelectCells:"Select cells",FormatCells:"Format cells",FormatRows:"Format rows",FormatColumns:"Format columns",InsertLinks:"Insert links",ProtectContent:"Protect the contents of locked cells",ProtectAllowUser:" Allow all users of this worksheet to:",EditAlert:"The cell you're trying to change is protected. To make change, unprotect the sheet.",SearchWithin:"Search within",SearchBy:"Search by",Reference:"Reference",DataValidation:"Data Validation",CLEARALL:"Clear All",APPLY:"Apply",CellRange:"Cell Range",Allow:"Allow",Data:"Data",Minimum:"Minimum",Maximum:"Maximum",IgnoreBlank:"Ignore blank",WholeNumber:"Whole Number",Decimal:"Decimal",Date:"Date",TextLength:"Text Length",List:"List",NotBetween:"Not between",EqualTo:"Equal to",NotEqualTo:"Not equal to",Greaterthan:"Greater than",Lessthan:"Less than",GreaterThanOrEqualTo:"Greater than or equal to",LessThanOrEqualTo:"Less than or equal to",InCellDropDown:"In-cell-dropdown",Sources:"Sources",Value:"Value",Retry:"Retry",EnterValue:"Enter value",DialogError:"The list source must be a reference to single row or column.",MinMaxError:"The Maximum must be greater than or equal to the Minimum.",MoreValidation:"This selection contains more than one validation. \n Erase current settings and continue?",FileNameError:"A file name can't contain characters like \\ / : * ? \" < > [ ] |",ListLengthError:"The list values allows only upto 256 charcters",ValidationError:"This value doesn't match the data validation restrictions defined for the cell.",EmptyError:"You must enter a value",ClearHighlight:"Clear Highlight",HighlightInvalidData:"Highlight Invalid Data",ClearValidation:"Clear Validation",HighlightCellsRules:"Highlight Cells Rules",CFEqualTo:"Equal To",TextThatContains:"Text that Contains",Save:"Save",EmptyFileName:"File name cannot be empty.",LargeName:"The name is too long.",ADateOccuring:"A Date Occuring",DuplicateValues:"Duplicate Values",TopBottomRules:"Top/Bottom Rules",Top10Items:"Top 10 Items",Top10:"Top 10",Bottom10Items:"Bottom 10 Items",Bottom10:"Bottom 10",AboveAverage:"Above Average",BelowAverage:"Below Average",FormatCellsGreaterThan:"Format cells that are GREATER THAN:",FormatCellsLessThan:"Format cells that are LESS THAN:",FormatCellsBetween:"Format cells that are BETWEEN:",FormatCellsEqualTo:"Format cells that are EQUAL TO:",FormatCellsThatContainTheText:"Format cells that contain the text:",FormatCellsThatContainADateOccurring:"Format cells that contain a date occurring:",FormatCellsDuplicate:"Format cells that contain:",FormatCellsTop:"Format cells that rank in the TOP:",FormatCellsBottom:"Format cells that rank in the BOTTOM:",FormatCellsAbove:"Format cells that are ABOVE AVERAGE:",FormatCellsBelow:"Format cells that are BELOW AVERAGE:",With:"with",DataBars:"Data Bars",ColorScales:"Color Scales",IconSets:"Icon Sets",ClearRules:"Clear Rules",SelectedCells:"Clear Rules from Selected Cells",EntireSheet:"Clear Rules from Entire Sheet",ISNUMBER:"Returns true when the value parses as a numeric value.",ROUND:"Rounds a number to a specified number of digits.",GEOMEAN:"Returns the geometric mean of an array or range of positive data.",POWER:"Returns the result of a number raised to power",LOG:"Returns the logarithm of a number to the base that you specify.",TRUNC:"Returns the truncated value of a number to a specified number of decimal places.",EXP:"Returns e raised to the power of the given number.",Clear:"Clear",ClearContents:"Clear Contents",ClearAll:"Clear All",ClearFormats:"Clear Formats",ClearHyperlinks:"Clear Hyperlinks",LightRedFillWithDarkRedText:"Light Red Fill with Dark Red Text",YellowFillWithDarkYellowText:"Yellow Fill with Dark Yellow Text",GreenFillWithDarkGreenText:"Green Fill with Dark Green Text",RedFill:"Red Fill",RedText:"Red Text",Duplicate:"Duplicate",Unique:"Unique",And:"and",WebPage:"WEB PAGE",ThisDocument:"THIS DOCUMENT",DisplayText:"Display Text",Url:"URL",CellReference:"Cell Reference",DefinedNames:"Defined Names",EnterTheTextToDisplay:"Enter the text to display",EnterTheUrl:"Enter the URL",Image:"Image",ConditionalFormatting:"Conditional Formatting",BlueDataBar:"Blue Data Bar",GreenDataBar:"Green Data Bar",RedDataBar:"Red Data Bar",OrangeDataBar:"Orange Data Bar",LightblueDataBar:"Light blue Data Bar",PurpleDataBar:"Purple Data Bar",GYRColorScale:"Green - Yellow - Red Color Scale",RYGColorScale:"Red - Yellow - Green Color Scale",GWRColorScale:"Green - White - Red Color Scale",RWGColorScale:"Red - White - Green Color Scale",BWRColorScale:"Blue - White - Red Color Scale",RWBColorScale:"Red - White - Blue Color Scale",WRColorScale:"White - Red Color Scale",RWColorScale:"Red - White Color Scale",GWColorScale:"Green - White Color Scale",WGColorScale:"White - Green Color Scale",GYColorScale:"Green - Yellow Color Scale",YGColorScale:"Yellow - Green Color Scale",ThreeArrowsColor:"3 Arrows (Colored)",ThreeArrowsGray:"3 Arrows (Gray)",ThreeTriangles:"3 Triangles",FourArrowsColor:"4 Arrows (Gray)",FourArrowsGray:"4 Arrows (Colored)",FiveArrowsColor:"5 Arrows (Gray)",FiveArrowsGray:"5 Arrows (Colored)",ThreeTrafficLights1:"3 Traffic Lights (Unrimmed)",ThreeTrafficLights2:"3 Traffic Lights (Rimmed)",ThreeSigns:"3 Signs",FourTrafficLights:"4 Traffic Lights",RedToBlack:"Red To Black",ThreeSymbols1:"3 Symbols (Circled)",ThreeSymbols2:"3 Symbols (Uncircled)",ThreeFlags:"3 Flags",ThreeStars:"3 Stars",FourRatings:"4 Ratings",FiveQuarters:"5 Quarters",FiveRatings:"5 Ratings",FiveBoxes:"5 Boxes",Chart:"Chart",Column:"Column",Bar:"Bar",Area:"Area",Pie:"Pie",Doughnut:"Doughnut",PieAndDoughnut:"Pie/Doughnut",Line:"Line",Radar:"Radar",Scatter:"Scatter",ChartDesign:"Chart Design",ClusteredColumn:"Clustered Column",StackedColumn:"Stacked Column",StackedColumn100:"100% Stacked Column",ClusteredBar:"Clustered Bar",StackedBar:"Stacked Bar",StackedBar100:"100% Stacked Bar",StackedArea:"Stacked Area",StackedArea100:"100% Stacked Area",StackedLine:"Stacked Line",StackedLine100:"100% Stacked Line",AddChartElement:"Add Chart Element",Axes:"Axes",AxisTitle:"Axis Title",ChartTitle:"Chart Title",DataLabels:"Data Labels",Gridlines:"Gridlines",Legends:"Legends",PrimaryHorizontal:"Primary Horizontal",PrimaryVertical:"Primary Vertical",None:"None",AboveChart:"Above Chart",Center:"Center",InsideEnd:"Inside End",InsideBase:"Inside Base",OutsideEnd:"OutSide End",PrimaryMajorHorizontal:"Primary Major Horizontal",PrimaryMajorVertical:"Primary Major Vertical",PrimaryMinorHorizontal:"Primary Minor Horizontal",PrimaryMinorVertical:"Primary Minor Vertical",Right:"Right",Left:"Left",Bottom:"Bottom",Top:"Top",SwitchRowColumn:"Switch Row/Column",ChartTheme:"Chart Theme",ChartType:"Chart Type",Material:"Material",Fabric:"Fabric",Bootstrap:"Bootstrap",HighContrastLight:"HighContrast Light",MaterialDark:"Material Dark",FabricDark:"Fabric Dark",HighContrast:"HighContrast",BootstrapDark:"Bootstrap Dark",Bootstrap4:"Bootstrap4",Bootstrap5Dark:"Bootstrap5 Dark",Bootstrap5:"Bootstrap5",Tailwind:"Tailwind",TailwindDark:"TailwindDark",VerticalAxisTitle:"Vertical Axis Title",HorizontalAxisTitle:"Horizontal Axis Title",EnterTitle:"Enter Title",ProtectWorkbook:"Protect Workbook",Password:"Password (optional):",unProtectPassword:"Password",EnterThePassword:"Enter the password",ConfirmPassword:"Confirm Password",EnterTheConfirmPassword:"Re-enter your password",PasswordAlert:"Confirmation password is not identical",UnProtectWorkbook:"Unprotect Workbook",UnProtectPasswordAlert:"The password you supplied is not correct.",InCorrectPassword:"Unable to open the file or worksheet with the given password",PasswordAlertMsg:"Please enter the password",ConfirmPasswordAlertMsg:"Please enter the confirm password",IsProtected:"is protected",PDF:"PDF document",AutoFillMergeAlertMsg:"To do this, all the merged cells need to be the same size",FillSeries:"Fill Series",CopyCells:"Copy Cells",FillFormattingOnly:"Fill Formatting Only",FillWithoutFormatting:"Fill Without Formatting",CustomFormat:"Custom Number Formats",CustomFormatSample:"Type",UnProtectWorksheet:"Unprotect Sheet",ReEnterPassword:"Re-enter password to proceed",SheetPassword:"Password to unprotect sheet:"},SheetRender=function(){function e(e){this.colGroupWidth=30,this.parent=e,this.col=e.createElement("col"),this.rowRenderer=e.serviceLocator.getService("row"),this.cellRenderer=e.serviceLocator.getService("cell"),this.addEventListener()}return e.prototype.refreshSelectALLContent=function(){var e,t=this.parent.getActiveSheet();if(t.frozenColumns||t.frozenRows){var r=this.getSelectAllTable().querySelector("thead"),n=this.rowRenderer.render();r.appendChild(n),e=this.parent.createElement("th",{className:"e-select-all-cell"}),n.appendChild(e)}else(e=this.headerPanel.firstElementChild).classList.add("e-select-all-cell");e.appendChild(this.parent.createElement("button",{className:"e-selectall",id:this.parent.element.id+"_select_all"}))},e.prototype.updateLeftColGroup=function(e,t){e&&(this.colGroupWidth=e),t||(t=this.getRowHeaderPanel());var r,n=t.querySelector("table"),i=this.parent.getActiveSheet();if(e)n.querySelector("colgroup").firstElementChild.style.width=this.colGroupWidth+"px";else{r=this.parent.createElement("colgroup");var o=this.col.cloneNode();o.style.width=this.colGroupWidth+"px",r.appendChild(o),n.insertBefore(r,n.querySelector("tbody"))}(i.frozenRows||i.frozenColumns)&&(n=this.getSelectAllTable(),e?n.querySelector("colgroup").firstElementChild.style.width=this.colGroupWidth+"px":n.insertBefore(r.cloneNode(!0),n.querySelector("thead"))),this.setPanelWidth(i,t),this.setPanelHeight(i)},e.prototype.setPanelWidth=function(e,t){var r=this.getScrollSize(!0),n=this.getRowHeaderWidth(e),i=this.parent.enableRtl?"right":"left";if(e.frozenColumns){var o=document.getElementById(this.parent.element.id+"_sheet").getElementsByClassName("e-frozen-column")[0];o.style.height="calc(100% - "+r+"px)",o.style[i]=n-getDPRValue(1)+"Px",o.style.display=""}this.setHeaderPanelWidth(this.getSelectAllContent(),n),this.getColHeaderPanel().style.width="calc(100% - "+n+"px)",this.getColHeaderPanel().style[i]=n+"px",this.setHeaderPanelWidth(t,n),this.getContentPanel().style.width="calc(100% - "+n+"px)",this.getContentPanel().style[i]=n+"px";var a=this.contentPanel.nextElementSibling?this.contentPanel.nextElementSibling:null;a&&(r?a.style.height=r+1+"px":(a.style.height="1px",a.style.borderTopWidth="0px"),(a=a.firstElementChild).style[i]=n+"px",a.style.width="calc(100% - "+n+"px)",ej2Base.Browser.userAgent.indexOf("Mac OS")>-1&&"safari"===ej2Base.Browser.info.name&&(a.style.height="7px",a.style.top="-7px"))},e.prototype.getScrollSize=function(e){var t=this.parent.enableRtl?"margin-left":"margin-right";return parseInt(this.headerPanel.style[t],10)?parseInt(this.headerPanel.style[t],10)+(e?1:0):0},e.prototype.setHeaderPanelWidth=function(e,t){[].slice.call(e.querySelectorAll("col.e-empty")).forEach(function(e){t+=parseInt(e.style.width,10)}),e.style.width=t+"px"},e.prototype.setPanelHeight=function(e){var t=this.getScrollSize(!0);if(e.frozenRows){var r=this.getColHeaderHeight(e);e.showHeaders||e.frozenColumns?this.headerPanel.style.height="":this.headerPanel.style.height=r+"px",this.contentPanel.style.height="calc(100% - "+(r+t)+"px)";var n=document.getElementById(this.parent.element.id+"_sheet").getElementsByClassName("e-frozen-row")[0];n.style.width=ej2Base.Browser.isDevice?"100%":"calc(100% - "+t+"px)",n.style.top=r-1-(e.showHeaders?1:0)+"px",n.style.display=""}else this.contentPanel.style.height="calc(100% - "+((e.showHeaders?getDPRValue(31):0)+t)+"px)"},e.prototype.renderPanel=function(){this.contentPanel=this.parent.createElement("div",{className:"e-main-panel"});var e=this.parent.getActiveSheet(),t=this.parent.element.id;this.contentPanel.appendChild(this.parent.createElement("div",{className:"e-row-header",id:t+"_row_header"})),this.initHeaderPanel(),this.parent.allowScrolling&&this.parent.scrollModule.setPadding();var r=document.getElementById(this.parent.element.id+"_sheet");e.frozenColumns&&r.classList.add("e-frozen-columns"),e.frozenRows&&r.classList.add("e-frozen-rows"),this.updateHideHeaders(e,r),e.showGridLines||r.classList.add("e-hide-gridlines");var n=this.contentPanel.appendChild(this.parent.createElement("div",{className:"e-sheet-content",id:t+"_main_content"}));this.parent.allowScrolling||(n.style.overflow="hidden"),e.frozenRows&&r.appendChild(this.parent.createElement("div",{className:"e-frozen-row",styles:"display: none"})),e.frozenColumns&&r.appendChild(this.parent.createElement("div",{className:"e-frozen-column",styles:"display: none"})),ej2Base.Browser.userAgent.indexOf("Mac OS")>-1&&"safari"===ej2Base.Browser.info.name&&r.classList.add("e-mac-safari")},e.prototype.initHeaderPanel=function(){var e=this.parent.element.id;this.headerPanel=this.parent.createElement("div",{className:"e-header-panel"}),this.headerPanel.appendChild(this.parent.createElement("div",{className:"e-selectall-container",id:e+"_selectall"})),this.headerPanel.appendChild(this.parent.createElement("div",{className:"e-column-header",id:e+"_col_header"}))},e.prototype.createHeaderTable=function(){var e=this.contentPanel.querySelector(".e-row-header"),t=this.parent.getActiveSheet();(t.frozenRows||t.frozenColumns)&&this.updateTable(t.frozenRows?["thead","tbody"]:["thead"],"selectall",this.headerPanel.querySelector(".e-selectall-container")),this.updateTable(t.frozenRows?["thead","tbody"]:["thead"],"colhdr",this.headerPanel.querySelector(".e-column-header")),this.updateTable(["tbody"],"rowhdr",e),this.updateLeftColGroup(null,e)},e.prototype.updateTable=function(e,t,r){var n=this,i=this.parent.createElement("table",{className:"e-table",attrs:{role:"grid"}});i.classList.add("e-"+t+"-table"),r.appendChild(i),e.forEach(function(e){i.appendChild(n.parent.createElement(e))})},e.prototype.renderTable=function(e){var t,r,n,i=this,o=this.parent.getActiveSheet(),a=document.createDocumentFragment();if(a.appendChild(this.headerPanel),a.appendChild(this.contentPanel),this.parent.allowScrolling){var s=this.parent.createElement("div",{className:"e-scrollbar"});s.appendChild(this.parent.createElement("div",{className:"e-scroller"})),a.appendChild(s)}this.createHeaderTable(),this.updateTable(["tbody"],"content",this.contentPanel.lastElementChild);var l,d=this.parent.createElement("colgroup"),p=this.contentPanel.querySelector(".e-sheet-content tbody");this.refreshSelectALLContent();var h=this.getSelectAllContent().querySelector("colgroup"),c=this.getRowHeaderPanel().querySelector("colgroup"),u=this.getSelectAllContent().querySelector("thead .e-header-row"),g=this.contentPanel.querySelector(".e-row-header tbody"),f=this.getSelectAllContent().querySelector("tbody"),m=this.headerPanel.querySelector(".e-column-header thead"),v=this.headerPanel.querySelector(".e-column-header tbody"),C=this.rowRenderer.render();m.appendChild(C),this.getColHeaderTable().insertBefore(d,m);var y=this.parent.frozenRowCount(o),x=this.parent.frozenColCount(o);this.parent.notify(beforeContentLoaded,{top:e.top,left:e.left});var b=o.colCount.toString(),S=o.colCount.toString(),w=e.top&&e.left?"RowColumn":e.top?"Row":e.left?"Column":"";this.parent.getColHeaderTable().setAttribute("aria-colcount",b),this.parent.getRowHeaderTable().setAttribute("aria-rowcount",S);var I;ej2Base.attributes(this.parent.getContentTable(),{"aria-rowcount":S,"aria-colcount":b}),e.cells.forEach(function(a,s){if((t=getRangeIndexes(s))[1]!==e.indexes[1]&&r||(n=i.rowRenderer.render(t[0],!0),x&&y&&t[1]<x&&t[0]<y?((I=f.querySelector(".e-empty"))?f.insertBefore(n,I):f.appendChild(n),r=n):x&&t[1]<x?(g.appendChild(n),r=n):(r=i.rowRenderer.render(t[0]),y&&t[0]<y?(I=v.querySelector(".e-empty"))?v.insertBefore(r,I):v.appendChild(r):p.appendChild(r),t[1]===e.indexes[1]&&(y&&t[0]<y?f.appendChild(n):g.appendChild(n))),t[1]===e.indexes[1]&&n.appendChild(i.cellRenderer.renderRowHeader(t[0]))),r.appendChild(i.cellRenderer.render({colIdx:t[1],rowIdx:t[0],cell:a,address:s,lastCell:t[1]===e.indexes[3],isHeightCheckNeeded:!0,row:r,hRow:n,pRow:r.previousSibling,pHRow:n.previousSibling,isRefreshing:e.isRefreshing,first:w?w.includes("Row")?t[0]===e.indexes[0]?"Row":w.includes("Column")&&t[1]===e.indexes[1]?"Column":"":t[1]===e.indexes[1]?"Column":"":""})),x&&t[1]===x-1&&(r=null),a&&a.format&&(getColorCode(a.format)||a.format.indexOf("*")>-1)&&i.parent.notify(getFormattedCellObject,{cell:a,value:a.value,format:a.format,rowIndex:t[0],colIndex:t[1],td:i.parent.getCell(t[0],t[1])}),t[0]===e.indexes[0])if(x&&t[1]<x){l=i.updateCol(o,t[1],h);var m=c.querySelector(".e-empty");m?c.insertBefore(l.cloneNode(!0),m):c.appendChild(l.cloneNode(!0)),u.appendChild(i.cellRenderer.renderColHeader(t[1]))}else i.updateCol(o,t[1],d),C.appendChild(i.cellRenderer.renderColHeader(t[1]))}),this.parent[isReact]&&this.parent[renderReactTemplates](),p.parentElement.insertBefore(d.cloneNode(!0),p),getUpdateUsingRaf(function(){if(i.parent){var t=i.parent.getMainContent(),r=document.getElementById(i.parent.element.id+"_sheet");if(r.childElementCount>2&&r.querySelector(".e-header-panel")!==i.headerPanel&&removeAllChildren(r),r.appendChild(a),r.style.backgroundColor="",i.checkRowHeightChanged(e,o),e.top&&(t.parentElement.scrollTop=e.top),e.left&&(t.scrollLeft=e.left,i.parent.getColumnHeaderContent().scrollLeft=e.left),i.parent.notify(contentLoaded,e),i.checkTableWidth(o),i.parent.notify(editOperation,{action:"renderEditor"}),e.initLoad||i.parent.isOpen||i.parent.hideSpinner(),setAriaOptions(t,{busy:!1}),i.parent.trigger(dataBound,{}),i.parent.isEdit&&i.parent.notify(initiateEdit,null),e.initLoad){var n=!0;if(i.parent.scrollSettings.enableVirtualization)for(var s=0;s<o.ranges.length;s++)if(o.ranges[s].info.count-1>i.parent.viewport.bottomIndex){n=!1;break}n?i.parent.isReact?setTimeout(function(){i.parent&&i.triggerCreatedEvent()}):i.triggerCreatedEvent():i.parent.isOpen||i.parent.hideSpinner()}}})},e.prototype.triggerCreatedEvent=function(){this.parent.isOpen||this.parent.hideSpinner(),this.parent.createdHandler&&(this.parent.createdHandler.observers?this.parent[created].observers=this.parent.createdHandler.observers:this.parent.setProperties({created:this.parent.createdHandler},!0),this.parent.createdHandler=void 0,this.parent.trigger(created,null),this.parent.notify(clearUndoRedoCollection,null))},e.prototype.checkRowHeightChanged=function(e,t){var r={top:e.top,left:e.left,sheet:t};this.parent.notify(getUpdatedScrollPosition,r),e.top!=r.top&&(this.parent.scrollModule&&this.parent.scrollModule.offset.top.idx&&r.top-e.top<getRowHeight(t,this.parent.scrollModule.offset.top.idx)&&(this.parent.scrollModule.offset.top.size=r.top),e.top=r.top),e.left!=r.left&&(this.parent.scrollModule&&this.parent.scrollModule.offset.left.idx&&r.left-e.left<getColumnWidth(t,this.parent.scrollModule.offset.left.idx)&&(this.parent.scrollModule.offset.left.size=r.left),e.left=r.left)},e.prototype.checkTableWidth=function(e){if(this.parent.scrollSettings.isFinite&&!this.parent.scrollSettings.enableVirtualization&&e.colCount-1===this.parent.viewport.rightIndex){var t=getColumnsWidth(e,this.parent.viewport.leftIndex+this.parent.frozenColCount(e),this.parent.viewport.rightIndex),r=this.getRowHeaderWidth(e),n=this.getScrollSize();t<this.contentPanel.getBoundingClientRect().width-r-n?(this.getContentPanel().style.width=t+"px",this.getColHeaderPanel().style.width=t+"px"):this.getContentPanel().style.width.includes("calc")||(this.getContentPanel().style.width="calc(100% - "+r+"px)",this.getColHeaderPanel().style.width="calc(100% - "+r+"px)")}},e.prototype.refreshColumnContent=function(e){var t,r,n,i,o,a=this,s=0,l=this.parent.getActiveSheet(),d=document.createDocumentFragment(),p=document.createDocumentFragment(),h=this.parent.element.querySelector(".e-sheet-content tbody"),c=this.parent.element.querySelector(".e-column-header tbody"),u=this.parent.element.querySelector(".e-sheet-content colgroup");u=u.cloneNode(),d.appendChild(u),h=d.appendChild(h.cloneNode(!0));var g=u.cloneNode();p.appendChild(g);var f;f=this.parent.element.querySelector(".e-column-header thead");var m=(f=p.appendChild(f.cloneNode(!0))).querySelector("tr");m.innerHTML="";var v=this.parent.frozenRowCount(l),C=this.parent.frozenColCount(l);v&&(c=p.appendChild(c.cloneNode(!0))),e.cells.forEach(function(n,d){if((t=getRangeIndexes(d))[0]===e.indexes[0]&&(o=a.updateCol(l,t[1],g),u.appendChild(o.cloneNode()),m.appendChild(a.cellRenderer.renderColHeader(t[1]))),t[1]-C===e.indexes[1]){if(!(r=t[0]<v?c.children[s]:h.children[s]))return;r.innerHTML="",s++}i=r.appendChild(a.cellRenderer.render({colIdx:t[1],rowIdx:t[0],cell:n,address:d,row:r,pRow:r.previousSibling,first:e.skipUpdateOnFirst||t[1]!==e.indexes[1]?a.parent.scrollSettings.enableVirtualization&&t[0]===e.indexes[0]&&a.parent.viewport.topIndex!==skipHiddenIdx(l,0,!0)?"Row":"":"Column",isRefreshing:!0})),a.checkColMerge(t,e.indexes,i,n),v&&t[0]===v-1&&(s=0)});var y=function(){removeAllChildren(n=a.getColHeaderTable()),n.appendChild(p),removeAllChildren(n=a.getContentTable()),n.appendChild(d),a.parent.notify(virtualContentLoaded,{refresh:"Column",prevRowColCnt:e.prevRowColCnt}),a.parent.isEdit&&a.parent.notify(forRefSelRender,{}),a.parent.allowChart&&a.parent.notify(chartRangeSelection,null),a.parent.isOpen||a.parent.hideSpinner(),setAriaOptions(a.parent.getMainContent(),{busy:!1})};e.insertDelete?y():getUpdateUsingRaf(function(){return y()})},e.prototype.refreshRowContent=function(e){var t,r,n,i,o=this,a=this.colGroupWidth,s=this.parent.getActiveSheet(),l=document.createDocumentFragment(),d=this.parent.createElement("tbody"),p=document.createDocumentFragment(),h=d.cloneNode();p.appendChild(h),l.appendChild(d);var c=this.parent.frozenColCount(s);e.cells.forEach(function(l,p){(t=getRangeIndexes(p))[1]!==e.indexes[1]&&r||(n=o.rowRenderer.render(t[0],!0),c&&t[1]<c?(h.appendChild(n),r=n):(t[1]===e.indexes[1]&&h.appendChild(n),r=o.rowRenderer.render(t[0]),d.appendChild(r)),t[1]===e.indexes[1]&&(n.appendChild(o.cellRenderer.renderRowHeader(t[0])),a=getColGroupWidth(t[0]+1))),c&&(n=h.lastElementChild||n),i=r.appendChild(o.cellRenderer.render({rowIdx:t[0],colIdx:t[1],cell:l,address:p,lastCell:t[1]===e.indexes[3],row:r,hRow:n,pRow:r.previousSibling,pHRow:n.previousSibling,isHeightCheckNeeded:!0,first:e.skipUpdateOnFirst||t[0]!==e.indexes[0]?o.parent.scrollSettings.enableVirtualization&&t[1]===e.indexes[1]&&o.parent.viewport.leftIndex!==skipHiddenIdx(s,0,!0,"columns")?"Column":"":"Row",isRefreshing:!0})),o.checkRowMerge(t,e.indexes,i,l),c&&t[1]===c-1&&(r=null)}),this.colGroupWidth!==a&&this.updateLeftColGroup(a),this.contentPanel.querySelector(".e-row-header tbody")&&(ej2Base.detach(this.contentPanel.querySelector(".e-row-header tbody")),this.getRowHeaderTable().appendChild(p)),this.contentPanel.querySelector(".e-sheet-content tbody")&&(ej2Base.detach(this.contentPanel.querySelector(".e-sheet-content tbody")),this.getContentTable().appendChild(l)),this.parent.notify(virtualContentLoaded,{refresh:"Row",prevRowColCnt:e.prevRowColCnt}),this.parent.allowChart&&this.parent.notify(chartRangeSelection,{}),this.parent.isEdit&&this.parent.notify(forRefSelRender,null),this.parent.isOpen||this.parent.hideSpinner(),setAriaOptions(this.parent.getMainContent(),{busy:!1})},e.prototype.updateCol=function(e,t,r){var n=this.col.cloneNode();if(n.style.width=ej2Base.formatUnit(getColumnWidth(e,t,null,!0)),r){var i=r.querySelector(".e-empty");return i?r.insertBefore(n,i):r.appendChild(n)}return n},e.prototype.updateColContent=function(e){var t=this;getUpdateUsingRaf(function(){var r,n,i,o,a,s,l=0,d=t.parent.getActiveSheet(),p=t.parent.element.querySelector(".e-column-header .e-header-row"),h=p.firstElementChild,c=t.parent.element.querySelector(".e-sheet-content colgroup"),u=t.parent.element.querySelector(".e-column-header colgroup"),g=c.firstElementChild,f=u.firstElementChild,m=t.parent.element.querySelector(".e-sheet-content tbody"),v=t.parent.element.querySelector(".e-column-header tbody"),C=t.parent.frozenRowCount(d),y=t.parent.frozenColCount(d);e.cells.forEach(function(x,b){if(!s){if(r=getRangeIndexes(b),"first"===e.direction&&r[1]===e.indexes[1]&&t.checkColMerge([r[0],t.parent.viewport.leftIndex+y],e.indexes,((r[0]<C?v:m).rows[l]||{cells:[]}).cells[e.indexes[3]-e.indexes[1]+1],getCell(r[0],t.parent.viewport.leftIndex+y,d)||{}),r[0]===e.indexes[0]&&("last"===e.direction?((a=t.col.cloneNode()).style.width=ej2Base.formatUnit(getColumnWidth(d,r[1],null,!0)),c.insertBefore(a,g),u.insertBefore(a.cloneNode(),f),p.insertBefore(t.cellRenderer.renderColHeader(r[1]),h)):(a=t.updateCol(d,r[1],c),u.appendChild(a.cloneNode()),p.appendChild(t.cellRenderer.renderColHeader(r[1]))),t.parent.scrollSettings.enableVirtualization&&e.direction&&(ej2Base.detach(c[e.direction+"ElementChild"]),ej2Base.detach(u[e.direction+"ElementChild"]),ej2Base.detach(p[e.direction+"ElementChild"]))),r[1]===e.indexes[1]){if(r[0]<C)n=v.children[l];else if(!(n=m.children[l]))return void(s=!0);l++,i=n.firstElementChild}o=t.cellRenderer.render({colIdx:r[1],rowIdx:r[0],cell:x,address:b,lastCell:r[1]===e.indexes[3],isHeightCheckNeeded:"first"===e.direction,first:"last"!==e.direction||e.skipUpdateOnFirst||r[1]!==e.indexes[1]?"":"Column",checkNextBorder:"last"===e.direction&&r[3]===e.indexes[3]?"Column":"",isRefreshing:"first"===e.direction}),"last"===e.direction?(t.checkColMerge(r,e.indexes,o,x,((r[0]<C?v:m).rows[l-1]||{cells:[]}).cells[0]),n.insertBefore(o,i)):n.appendChild(o),t.parent.scrollSettings.enableVirtualization&&e.direction&&ej2Base.detach(n[e.direction+"ElementChild"]),C&&r[0]===C-1&&(l=0)}}),t.parent.notify(virtualContentLoaded,{refresh:"Column",prevRowColCnt:e.prevRowColCnt}),t.parent.allowChart&&t.parent.notify(chartRangeSelection,null),t.parent.isEdit&&t.parent.notify(forRefSelRender,{}),t.parent.isOpen||t.parent.hideSpinner(),setAriaOptions(t.parent.getMainContent(),{busy:!1})})},e.prototype.updateRowContent=function(e){var t,r,n,i,o=this,a=this.colGroupWidth,s=this.parent.getActiveSheet(),l=0,d=this.parent.getMainContent().querySelector("tbody"),p=this.parent.getRowHeaderContent().querySelector("tbody"),h=document.createDocumentFragment(),c=document.createDocumentFragment();this.parent.showSpinner();var u,g=this.parent.frozenColCount(s),f=this.parent.frozenRowCount(s);e.cells.forEach(function(m,v){i=getRangeIndexes(v),"first"===e.direction&&i[0]===e.indexes[0]&&(void 0===u&&(u=(i[1]<g?p:d).rows[e.indexes[2]-e.indexes[0]+1]||null),o.checkRowMerge([o.parent.viewport.topIndex+f,i[1]],e.indexes,(u||{cells:[]}).cells[i[1]<g?l+1:l],getCell(o.parent.viewport.topIndex+f,i[1],s)||{})),i[1]!==e.indexes[1]&&t||(r=o.rowRenderer.render(i[0],!0),g&&i[1]<g?(h.appendChild(r),t=r):(t=o.rowRenderer.render(i[0]),c.appendChild(t),i[1]===e.indexes[1]&&h.appendChild(r),o.parent.scrollSettings.enableVirtualization&&e.direction&&ej2Base.detach(d[e.direction+"ElementChild"])),i[1]===e.indexes[1]&&(r.appendChild(o.cellRenderer.renderRowHeader(i[0])),a=getColGroupWidth(i[0]+1),o.parent.scrollSettings.enableVirtualization&&e.direction&&ej2Base.detach(p[e.direction+"ElementChild"]))),g&&(r=h.lastElementChild||r),n=t.appendChild(o.cellRenderer.render({colIdx:i[1],rowIdx:i[2],cell:m,address:v,lastCell:i[1]===e.indexes[3],row:t,pHRow:r.previousSibling,checkNextBorder:"last"===e.direction&&i[2]===e.indexes[2]?"Row":"",pRow:t.previousSibling,isHeightCheckNeeded:"first"===e.direction||""===e.direction,hRow:r,first:"last"!==e.direction||e.skipUpdateOnFirst||i[0]!==e.indexes[0]?"":"Row",isRefreshing:"first"===e.direction})),"last"===e.direction&&d.rows.length&&o.checkRowMerge(i,e.indexes,n,m,(i[1]<g?p:d).rows[0].cells[i[1]<g?l+1:l]),l++,g&&i[1]===g-1&&(t=null,u=void 0,l=0)}),this.colGroupWidth!==a&&this.updateLeftColGroup(a),"last"===e.direction?(p.insertBefore(h,p.firstElementChild),d.insertBefore(c,d.firstElementChild)):(p.appendChild(h),d.appendChild(c)),this.parent.scrollSettings.enableVirtualization&&this.parent.notify(virtualContentLoaded,{refresh:"Row",prevRowColCnt:e.prevRowColCnt}),this.parent.isEdit&&this.parent.notify(forRefSelRender,null),this.parent.allowChart&&this.parent.notify(chartRangeSelection,{}),this.parent.isOpen||this.parent.hideSpinner(),setAriaOptions(this.parent.getMainContent(),{busy:!1})},e.prototype.checkRowMerge=function(e,t,r,n,i){if(this.parent.scrollSettings.enableVirtualization&&r&&(!ej2Base.isNullOrUndefined(n.rowSpan)||!ej2Base.isNullOrUndefined(n.colSpan))){var o=this.parent.frozenRowCount(this.parent.getActiveSheet());if(e[0]===this.parent.viewport.topIndex+o){if(n.rowSpan<0){var a={td:r,rowIdx:e[0],colIdx:e[1],isRow:!0,isFreezePane:!0};if(this.parent.notify(checkMerge,a),a.insideFreezePane)return;this.parent.viewport.topIndex+o>=t[0]&&this.refreshPrevMerge(t[0]+1,e[1])}i&&(i.colSpan>1||i.rowSpan>1)&&this.cellRenderer.refresh(e[0]+(t[2]-t[0])+1,e[1],null,i)}else if(n.rowSpan>1){var s=t[2]+1;e[0]+n.rowSpan-1>s&&e[0]<s&&this.refreshPrevMerge(s,e[1],this.parent.viewport.topIndex+o)}}},e.prototype.refreshPrevMerge=function(e,t,r){var n=this.parent.getCell(e,t,this.parent.getRow(r||0,null,t));n&&n.rowSpan>1&&this.cellRenderer.refresh(e,t,null,n)},e.prototype.checkColMerge=function(e,t,r,n,i){if(this.parent.scrollSettings.enableVirtualization&&r&&e[1]===this.parent.viewport.leftIndex+this.parent.frozenColCount(this.parent.getActiveSheet())&&(!ej2Base.isNullOrUndefined(n.rowSpan)||!ej2Base.isNullOrUndefined(n.colSpan))){if(n.colSpan<0){var o={td:r,colIdx:e[1],rowIdx:e[0],isFreezePane:!0};if(this.parent.notify(checkMerge,o),o.insideFreezePane)return}i&&(i.colSpan>1||i.rowSpan>1)&&this.cellRenderer.refresh(e[0],e[1]+(t[3]-t[1])+1,null,i)}},e.prototype.showHideHeaders=function(){var e=this,t=this.parent.getActiveSheet();getUpdateUsingRaf(function(){if(t.showHeaders){var r=e.getContentPanel();e.setPanelWidth(t,e.getRowHeaderPanel()),e.setPanelHeight(t),document.getElementById(e.parent.element.id+"_sheet").classList.remove("e-hide-headers"),e.getColHeaderPanel().scrollLeft=r.scrollLeft,e.parent.selectRange(t.selectedRange)}else{if(e.updateHideHeaders(t,document.getElementById(e.parent.element.id+"_sheet")),e.setPanelHeight(t),e.parent.frozenColCount(t)||e.parent.frozenRowCount(t))e.setPanelWidth(t,e.getRowHeaderPanel()),e.parent.selectRange(t.selectedRange);else{e.getContentPanel().style.width="";var n=e.parent.enableRtl?"right":"left";e.getContentPanel().style[n]=""}e.getScrollElement().style.left=e.getRowHeaderWidth(t)+"px"}})},e.prototype.updateHideHeaders=function(e,t){e.showHeaders||t.classList.add("e-hide-headers")},e.prototype.rowHeightChange=function(e){if(e.threshold){var t=this.parent.getActiveSheet();e.rowIdx<this.parent.frozenRowCount(t)&&this.setPanelHeight(t)}},e.prototype.colWidthChange=function(e){if(e.threshold){var t=this.parent.getActiveSheet();e.colIdx<this.parent.frozenColCount(t)&&this.setPanelWidth(t,this.getRowHeaderPanel()),this.checkTableWidth(t)}},e.prototype.getRowHeaderWidth=function(e,t){var r=0;if(!t&&e.frozenColumns){var n=getCellIndexes(e.topLeftCell)[1];r=getColumnsWidth(e,n,n+e.frozenColumns-1,!0)}return r+=e.showHeaders?getDPRValue(this.colGroupWidth):0},e.prototype.getColHeaderHeight=function(e,t){var r=getCellIndexes(e.topLeftCell)[0];return(e.showHeaders&&!t?getDPRValue(31):0)+getRowsHeight(e,r,r+e.frozenRows-1,!0)},e.prototype.getSelectAllContent=function(){return this.headerPanel.getElementsByClassName("e-selectall-container")[0]},e.prototype.getScrollElement=function(){var e=this.contentPanel.parentElement||this.contentPanel.nextElementSibling;return e&&e.querySelector(".e-scroller")},e.prototype.getSelectAllTable=function(){return this.headerPanel.getElementsByClassName("e-selectall-table")[0]},e.prototype.getColHeaderTable=function(){return this.headerPanel.getElementsByClassName("e-colhdr-table")[0]},e.prototype.getRowHeaderTable=function(){return this.contentPanel.getElementsByClassName("e-rowhdr-table")[0]},e.prototype.getContentTable=function(){return this.contentPanel.getElementsByClassName("e-content-table")[0]},e.prototype.getRowHeaderPanel=function(){return this.contentPanel.getElementsByClassName("e-row-header")[0]},e.prototype.getColHeaderPanel=function(){return this.headerPanel.getElementsByClassName("e-column-header")[0]},e.prototype.getContentPanel=function(){return this.contentPanel.getElementsByClassName("e-sheet-content")[0]},e.prototype.addEventListener=function(){this.parent.on(created,this.triggerCreatedEvent,this),this.parent.on(rowHeightChanged,this.rowHeightChange,this),this.parent.on(colWidthChanged,this.colWidthChange,this),this.parent.on(spreadsheetDestroyed,this.destroy,this)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.removeEventListener=function(){this.parent.off(created,this.triggerCreatedEvent),this.parent.off(rowHeightChanged,this.rowHeightChange),this.parent.off(colWidthChanged,this.colWidthChange),this.parent.off(spreadsheetDestroyed,this.destroy)},e}(),RowRenderer=function(){function e(e){this.parent=e,this.element=this.parent.createElement("tr",{attrs:{role:"row"}}),this.cellRenderer=e.serviceLocator.getService("cell")}return e.prototype.render=function(e,t,r){var n=this.element.cloneNode();if(void 0===e)return n.classList.add("e-header-row"),n;n.classList.add("e-row");var i=this.parent.getActiveSheet();ej2Base.attributes(n,{"aria-rowindex":(e+1).toString()});var o=getRowHeight(i,e,!0);return n.style.height=o+"px",o<20&&(n.style.lineHeight=o>0?o-1+"px":"0px"),t&&!r&&(o<20&&(n.style.lineHeight=o>=4?o-4+"px":o>0?o-1+"px":"0px",n.classList.contains("e-reach-fntsize")||n.classList.add("e-reach-fntsize")),isHiddenRow(i,e+1)&&!isHiddenRow(i,e-1)&&n.classList.add("e-hide-start"),0!==e&&isHiddenRow(i,e-1)&&!isHiddenRow(i,e+1)&&n.classList.add("e-hide-end")),n},e.prototype.refresh=function(e,t,r,n){var i,o=this.parent.getActiveSheet();if(n)(i=this.render(e,!0,!0)).appendChild(this.cellRenderer.renderRowHeader(e));else{i=this.render(e);for(var a=this.parent.viewport.rightIndex,s=this.parent.viewport.leftIndex;s<=a;s++)isHiddenCol(o,s)||i.appendChild(this.cellRenderer.render({colIdx:s,rowIdx:e,cell:getCell(e,s,o),address:getCellAddress(e,s),lastCell:s===a,row:i,hRow:r,isHeightCheckNeeded:!0,pRow:t,first:e===this.parent.viewport.topIndex&&skipHiddenIdx(o,e,!0)!==skipHiddenIdx(o,0,!0)?"Row":""}))}return i},e}(),CellRenderer=function(){function e(e){this.parent=e,this.element=this.parent.createElement("td"),this.th=this.parent.createElement("th",{className:"e-header-cell"}),this.tableRow=e.createElement("tr",{className:"e-row"}),this.parent.on(updateView,this.updateView,this),this.parent.on("calculateFormula",this.calculateFormula,this)}return e.prototype.renderColHeader=function(e){var t=this.th.cloneNode();ej2Base.attributes(t,{role:"columnheader","aria-colindex":(e+1).toString(),tabindex:"-1"}),t.innerHTML=getColumnHeaderText(e+1);var r=this.parent.getActiveSheet();return isHiddenCol(r,e+1)&&t.classList.add("e-hide-start"),0!==e&&isHiddenCol(r,e-1)&&t.classList.add("e-hide-end"),t},e.prototype.renderRowHeader=function(e){var t=this.element.cloneNode();return ej2Base.addClass([t],"e-header-cell"),ej2Base.attributes(t,{role:"rowheader",tabindex:"-1"}),t.innerHTML=(e+1).toString(),t},e.prototype.render=function(e){var t=this.parent.getActiveSheet();if(e.td=this.element.cloneNode(),e.td.className="e-cell",ej2Base.attributes(e.td,{role:"gridcell","aria-colindex":(e.colIdx+1).toString(),tabindex:"-1"}),this.checkMerged(e))return e.td;e.isRefresh=!1,this.update(e),e.cell&&e.td&&(t.conditionalFormats&&t.conditionalFormats.length&&this.parent.notify(cFRender,{rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.cell,td:e.td,isChecked:!1}),e.td.childElementCount&&"e-cf-databar"===e.td.children[0].className&&(e.cell.style&&e.cell.style.fontSize&&(e.td.children[0].querySelector(".e-databar-value").style.fontSize=e.cell.style.fontSize),e.td.children[0].style.height="100%",e.td.children[0].firstElementChild.nextElementSibling.style.height="100%")),e.td.classList.contains("e-cell-template")||this.parent.notify(renderFilterCell,{td:e.td,rowIndex:e.rowIdx,colIndex:e.colIdx});var r={cell:e.cell,element:e.td,address:e.address,rowIndex:e.rowIdx,colIndex:e.colIdx,needHeightCheck:!1};if(this.parent.trigger("beforeCellRender",r),!t.rows[e.rowIdx]||!t.rows[e.rowIdx].customHeight){if(r.element&&r.element.children.length||r.needHeightCheck){var n=r.element.cloneNode(!0);n.style.width=getColumnWidth(t,e.colIdx,!0)+"px",this.tableRow.appendChild(n)}if(e.lastCell&&this.tableRow.childElementCount||r.needHeightCheck){var i=e.row||this.parent.getRow(e.rowIdx),o=getRowHeight(t,e.rowIdx),a=this.getRowHeightOnInit();if(a>o){var s=getDPRValue(a);i.style.height=s+"px",(e.hRow||this.parent.getRow(e.rowIdx,this.parent.getRowHeaderTable())).style.height=s+"px",setRowHeight(t,e.rowIdx,a)}this.tableRow.innerHTML=""}}return this.setWrapByValue(t,e),r.element},e.prototype.setWrapByValue=function(e,t){t.cell&&!t.cell.wrap&&t.cell.value&&t.cell.value.toString().includes("\n")&&(setCell(t.rowIdx,t.colIdx,e,{wrap:!0},!0),this.parent.notify(wrapEvent,{range:[t.rowIdx,t.colIdx,t.rowIdx,t.colIdx],wrap:!0,initial:!0,sheet:e,td:t.td,row:t.row,hRow:t.hRow}))},e.prototype.update=function(e){var t=this.parent.getActiveSheet(),r=this.processTemplates(e.cell,e.rowIdx,e.colIdx);if(r&&("string"==typeof r?e.td.innerHTML=r:(removeAllChildren(e.td),e.td.appendChild(r)),e.td.classList.add("e-cell-template")),e.isRefresh){if(e.td.rowSpan&&(this.mergeFreezeRow(t,e.rowIdx,e.colIdx,e.td.rowSpan,e.row,!0),e.td.removeAttribute("rowSpan")),e.td.colSpan&&(this.mergeFreezeCol(t,e.rowIdx,e.colIdx,e.td.colSpan,!0),e.td.removeAttribute("colSpan")),this.checkMerged(e))return;e.cell&&!e.cell.hyperlink&&e.td.querySelector(".e-hyperlink")&&e.td.removeChild(e.td.querySelector(".e-hyperlink"))}e.cell&&e.cell.formula&&this.calculateFormula(e);var n={type:e.cell&&getTypeFromFormat(e.cell.format),value:e.cell&&e.cell.value,format:e.cell&&e.cell.format?e.cell.format:"General",formattedText:e.cell&&e.cell.value,onLoad:!0,isRightAlign:!1,cell:e.cell,rowIndex:e.rowIdx,colIndex:e.colIdx,isRowFill:!1};e.cell&&this.parent.notify(getFormattedCellObject,n),this.parent.refreshNode(e.td,{type:n.type,result:n.formattedText,curSymbol:ej2Base.getNumberDependable(this.parent.locale,"USD"),isRightAlign:n.isRightAlign,value:n.value||"",isRowFill:n.isRowFill});var i={};if(e.cell){if(e.cell.style&&(i=e.cell.style.properties?skipDefaultValue(e.cell.style,!0):e.cell.style),e.cell.chart&&e.cell.chart.length>0&&this.parent.notify(setChart,{chart:e.cell.chart,isInitCell:!0,range:getCellAddress(e.rowIdx,e.colIdx)}),e.cell.hyperlink&&this.parent.notify(createHyperlinkElement,{cell:e.cell,td:e.td,rowIdx:e.rowIdx,colIdx:e.colIdx}),e.cell.rowSpan>1){var o=e.cell.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(e.cell.rowSpan-1));o>1&&(e.td.rowSpan=o,this.mergeFreezeRow(t,e.rowIdx,e.colIdx,o,e.row))}if(e.cell.colSpan>1){var a=e.cell.colSpan-this.parent.hiddenCount(e.colIdx,e.colIdx+(e.cell.colSpan-1),"columns");a>1&&(e.td.colSpan=a,this.mergeFreezeCol(t,e.rowIdx,e.colIdx,a))}if(e.cell.image)for(var s=0;s<e.cell.image.length;s++)e.cell.image[s]&&this.parent.notify(createImageElement,{options:{src:e.cell.image[s].src,imageId:e.cell.image[s].id,height:e.cell.image[s].height,width:e.cell.image[s].width,top:e.cell.image[s].top,left:e.cell.image[s].left},range:getRangeAddress([e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]),isPublic:!1})}if(e.isRefresh&&this.removeStyle(e.td,e.rowIdx,e.colIdx),e.lastCell&&this.parent.chartColl&&this.parent.chartColl.length&&this.parent.notify(refreshChart,{cell:e.cell,rIdx:e.rowIdx,cIdx:e.colIdx,sheetIdx:this.parent.activeSheetIndex}),this.applyStyle(e,i),(e.checkCf||e.lastCell&&t.conditionalFormats&&t.conditionalFormats.length)&&this.parent.notify(checkConditionalFormat,{rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.cell,td:e.td}),"Row"===e.checkNextBorder){var l=this.parent.getCellStyleValue(["borderTop"],[Number(this.parent.getContentTable().rows[0].getAttribute("aria-rowindex"))-1,e.colIdx]).borderTop;""===l||e.cell&&e.cell.style&&e.cell.style.bottomPriority||this.parent.notify(applyCellFormat,{style:{borderBottom:l},rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td})}if("Column"===e.checkNextBorder){var d=this.parent.getCellStyleValue(["borderLeft"],[e.rowIdx,e.colIdx+1]).borderLeft;""===d||e.cell&&e.cell.style&&(e.cell.style.borderRight||e.cell.style.border)||this.parent.notify(applyCellFormat,{style:{borderRight:d},rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td})}if(e.cell){if(e.cell.hyperlink&&!e.td.classList.contains("e-cell-template")){var p=void 0;"string"==typeof e.cell.hyperlink?0!==(p=e.cell.hyperlink).indexOf("http://")&&0!==p.indexOf("https://")&&0!==p.indexOf("ftp://")&&(e.cell.hyperlink=0===p.toLowerCase().indexOf("www.")?"http://"+p:p):0!==(p=e.cell.hyperlink.address).indexOf("http://")&&0!==p.indexOf("https://")&&0!==p.indexOf("ftp://")&&(e.cell.hyperlink.address=0===p.toLowerCase().indexOf("www.")?"http://"+p:p),this.parent.notify(createHyperlinkElement,{cell:e.cell,td:e.td,rowIdx:e.rowIdx,colIdx:e.colIdx})}e.cell.wrap&&this.parent.notify(wrapEvent,{range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx],wrap:!0,sheet:t,initial:!0,td:e.td,row:e.row,hRow:e.hRow,isCustomHgt:!e.isRefresh&&getRowHeight(t,e.rowIdx)>20})}var h=e.cell&&e.cell.validation||t.columns&&t.columns[e.colIdx]&&t.columns[e.colIdx].validation;h&&h.isHighlighted&&this.parent.notify(addHighlight,{range:getRangeAddress([e.rowIdx,e.colIdx]),td:e.td}),e.cell&&e.cell.validation&&e.cell.validation.isHighlighted&&this.parent.notify(addHighlight,{range:getRangeAddress([e.rowIdx,e.colIdx]),td:e.td})},e.prototype.applyStyle=function(e,t){(Object.keys(t).length||Object.keys(this.parent.commonCellStyle).length||e.lastCell)&&this.parent.notify(applyCellFormat,{style:ej2Base.extend({},this.parent.commonCellStyle,t),rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td,first:e.first,row:e.row,lastCell:e.lastCell,hRow:e.hRow,pRow:e.pRow,isHeightCheckNeeded:e.isHeightCheckNeeded,manualUpdate:e.manualUpdate,onActionUpdate:e.onActionUpdate})},e.prototype.calculateFormula=function(e){if(void 0!==e.cell.value&&null!==e.cell.value){var t={action:"checkFormulaAdded",added:!0,address:e.address,sheetId:(void 0===e.sheetIndex?this.parent.getActiveSheet():getSheet(this.parent,e.sheetIndex)).id.toString()};if(this.parent.notify(workbookFormulaOperation,t),t.added)return}var r=checkIsFormula(e.cell.formula),n=e.cell.formula.indexOf("UNIQUE")>-1;if(n){var i={toSkip:!1,cellRef:getRangeAddress([e.rowIdx,e.colIdx])};this.parent.notify(getFormulaInfoTable,i),n=i.toSkip}var o={action:"refreshCalculate",value:e.cell.formula,rowIndex:e.rowIdx,colIndex:e.colIdx,isFormula:r,sheetIndex:e.sheetIndex,isRefreshing:e.isRefreshing,skip:n};this.parent.notify(workbookFormulaOperation,o),e.cell.value=getCell(e.rowIdx,e.colIdx,ej2Base.isNullOrUndefined(e.sheetIndex)?this.parent.getActiveSheet():getSheet(this.parent,e.sheetIndex)).value},e.prototype.checkMerged=function(e){if(e.cell&&(e.cell.colSpan<0||e.cell.rowSpan<0)){var t=this.parent.getActiveSheet();if(t.frozenRows||t.frozenColumns){var r={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify(activeCellMergedRange,r);var n=this.parent.frozenRowCount(t),i=this.parent.frozenColCount(t);(t.frozenRows&&t.frozenColumns?r.range[0]<n&&r.range[1]<i?e.rowIdx<n&&e.colIdx<i:r.range[0]<n?e.rowIdx<n:!(r.range[1]<i)||e.colIdx<i:n?r.range[0]>=n||e.rowIdx<n:r.range[1]>=i||e.colIdx<i)&&(e.td.style.display="none")}else e.td.style.display="none";return e.cell.colSpan<0&&(this.parent.notify(checkPrevMerge,e),e.cell.style&&e.cell.style.borderTop&&this.applyStyle(e,{borderTop:e.cell.style.borderTop})),e.cell.rowSpan<0&&(e.isRow=!0,this.parent.notify(checkPrevMerge,e),e.cell.style&&e.cell.style.borderLeft&&this.applyStyle(e,{borderLeft:e.cell.style.borderLeft})),!0}return!1},e.prototype.mergeFreezeRow=function(e,t,r,n,i,o){var a=this.parent.frozenRowCount(e);if(a&&t<a&&t+(n-1)>=a){var s=void 0,l=0,d=void 0,p=this.parent.frozenColCount(e),h=i||this.parent.getRow(t,null,r),c=[].slice.call(h.parentElement.querySelectorAll(".e-empty"));if(o){var u=t+n-a;if(u<c.length)return;var g=0;if(u===c.length){var f=void 0,m=void 0,v=void 0;for(p&&r<p?(m=getCellIndexes(e.topLeftCell)[1],v=p):(m=this.parent.viewport.leftIndex+p,v=this.parent.viewport.rightIndex);m<v;m++)m!==r&&(f=getCell(t,m,e,!1,!0)).rowSpan&&t+f.rowSpan-a>g&&(g=t+f.rowSpan-a);if(g===u)return}else g=u;var C=t+(n-1);for(m=g,v=c.length;m<v;m++)l+=getRowHeight(e,C),C--,ej2Base.detach(c.pop());return this.updateSpanTop(r,p,l,!0),void(c.length||this.updateColZIndex(r,p,!0))}this.updateColZIndex(r,p);for(m=a,v=t+(n-1);m<=v;m++)l+=-(d=getRowHeight(e,m)),a+c.length>m||((s=h.cloneNode()).classList.add("e-empty"),s.style.visibility="hidden",s.style.height=d+"px",h.parentElement.appendChild(s));this.updateSpanTop(r,p,l)}},e.prototype.updateSpanTop=function(e,t,r,n){var i=this.parent.serviceLocator.getService("sheet").contentPanel;if(n){if(!parseInt(i.style.top,10))return;r=parseInt(i.style.top,10)+r}if(t&&e<t&&(n||!parseInt(i.style.top,10)||r<parseInt(i.style.top,10))){i.style.top=r+"px";var o=i.nextElementSibling;o&&(o.style.top=r+"px")}},e.prototype.mergeFreezeCol=function(e,t,r,n,i){var o=this.parent.frozenColCount(e);if(o&&r<o&&r+(n-1)>=o){var a=void 0,s=void 0,l=this.parent.frozenRowCount(e),d=(t<l?this.parent.getSelectAllContent():this.parent.getRowHeaderContent()).querySelector("colgroup"),p=[].slice.call(d.querySelectorAll(".e-empty"));if(i){var h=r+n-o;if(h<p.length)return;var c=0;if(h===p.length){var u=void 0,g=void 0,f=void 0;for(l&&t<o?(g=l,f=getCellIndexes(e.topLeftCell)[0]):(g=this.parent.viewport.bottomIndex,f=this.parent.viewport.topIndex+l);f<g;f++)f!==t&&(u=getCell(f,r,e,!1,!0)).colSpan&&r+u.colSpan-o>c&&(c=r+u.colSpan-o);if(c===h)return}else c=h;for(f=c,g=p.length;f<g;f++)ej2Base.detach(p.pop());return this.parent.serviceLocator.getService("sheet").setPanelWidth(e,this.parent.getRowHeaderContent()),void(p.length||this.updateRowZIndex(t,l,!0))}this.updateRowZIndex(t,l);for(f=o,g=r+(n-1);f<=g;f++)o+p.length>f||((a=d.childNodes[0].cloneNode()).classList.add("e-empty"),a.style.visibility="hidden",s=getColumnWidth(e,f,null,!0),a.style.width=s+"px",d.appendChild(a),f===g&&this.parent.serviceLocator.getService("sheet").setPanelWidth(e,this.parent.getRowHeaderContent()))}},e.prototype.updateColZIndex=function(e,t,r){e<t?this.updateSelectAllZIndex(r):(this.parent.getColumnHeaderContent().style.zIndex=r?"":"2",this.updatedHeaderZIndex(r))},e.prototype.updateSelectAllZIndex=function(e){var t=this.parent.element.querySelector(".e-frozen-row"),r=this.parent.element.querySelector(".e-frozen-column");e?(this.parent.getSelectAllContent().style.zIndex="",t&&(t.style.zIndex=""),r&&(r.style.zIndex="")):this.parent.getRowHeaderContent().style.zIndex||this.parent.getColumnHeaderContent().style.zIndex?(this.parent.getSelectAllContent().style.zIndex="3",t&&(t.style.zIndex="4"),r&&(r.style.zIndex="4")):this.parent.getSelectAllContent().style.zIndex="2"},e.prototype.updatedHeaderZIndex=function(e){if(!e&&"2"===this.parent.getSelectAllContent().style.zIndex){this.parent.getSelectAllContent().style.zIndex="3";var t=this.parent.element.querySelector(".e-frozen-row"),r=this.parent.element.querySelector(".e-frozen-column");r&&(r.style.zIndex="4"),t&&(t.style.zIndex="4")}},e.prototype.updateRowZIndex=function(e,t,r){e<t?this.updateSelectAllZIndex(r):(this.parent.getRowHeaderContent().style.zIndex=r?"":"2",this.updatedHeaderZIndex(r))},e.prototype.processTemplates=function(e,t,r){for(var n,i=this.parent.getActiveSheet(),o=i.ranges,a=0,s=o.length;a<s;a++)if(o[a].template&&(n=getRangeIndexes(o[a].address.length?o[a].address:o[a].startCell))[0]<=t&&n[1]<=r&&n[2]>=t&&n[3]>=r){if(e)return this.compileCellTemplate(o[a].template,e);if(!getCell(t,r,i,!0))return this.compileCellTemplate(o[a].template,getCell(t,r,i,null,!0))}return""},e.prototype.compileCellTemplate=function(e,t){if("string"==typeof e){var r=void 0;return r=0===e.trim().indexOf("#")?document.querySelector(e).innerHTML.trim():e,ej2Base.compile(r)(t,null,null,"",!0)[0].outerHTML}return ej2Base.compile(e)(t,this.parent,"ranges","")[0]},e.prototype.getRowHeightOnInit=function(){var e=this.parent.createElement("table",{className:"e-table e-test-table"});e.appendChild(this.parent.createElement("tbody")).appendChild(this.tableRow),this.parent.element.appendChild(e);var t=Math.round(this.tableRow.getBoundingClientRect().height);return this.parent.element.removeChild(e),t<20?20:t},e.prototype.removeStyle=function(e,t,r){var n;if(e.style.length){var i=(n=this.parent.getCellStyleValue(["borderLeft","border"],[t,r+1])).borderLeft||n.border,o=(n=this.parent.getCellStyleValue(["borderTop","border"],[t+1,r])).borderTop||n.border;i||o?[].slice.call(e.style).forEach(function(t){i&&o?t.includes("border-right")||t.includes("border-bottom")||e.style.removeProperty(t):(!i||t.indexOf("border-right")>-1||o&&"none"!==o)&&(!o||t.indexOf("border-bottom")>-1||i&&"none"!==i)||e.style.removeProperty(t)}):e.removeAttribute("style")}var a=this.parent.getCell(t-1,r);if(a&&a.style.borderBottom){var s=Number(a.parentElement.getAttribute("aria-rowindex"))-1;(n=this.parent.getCellStyleValue(["borderBottom","border"],[s,r])).borderBottom||n.border||(a.style.borderBottom="")}var l=e.previousElementSibling;l&&l.style.borderRight&&(r=Number(l.getAttribute("aria-colindex"))-1,(n=this.parent.getCellStyleValue(["borderRight","border"],[t,r])).borderRight||n.border||(l.style.borderRight=""))},e.prototype.refreshRange=function(e,t,r,n){var i,o,a=this.parent.getActiveSheet(),s=e.slice();if(inView(this.parent,s,!0))for(var l=s[0];l<=s[2];l++)if(!isHiddenRow(a,l))for(var d=s[1];d<=s[3];d++)isHiddenCol(a,d)||(o=this.parent.getCell(l,d))&&(i={rowIdx:l,colIdx:d,td:o,cell:getCell(l,d,a),isRefreshing:t,lastCell:d===s[3],isRefresh:!0,isHeightCheckNeeded:!0,manualUpdate:!0,first:"",onActionUpdate:n},this.update(i),this.parent.notify(renderFilterCell,{td:o,rowIndex:l,colIndex:d}),r&&this.setWrapByValue(a,i))},e.prototype.refresh=function(e,t,r,n,i,o){var a=this.parent.getActiveSheet();if((n||!isHiddenRow(a,e)&&!isHiddenCol(a,t))&&(n||!this.parent.scrollSettings.enableVirtualization||this.parent.insideViewport(e,t))){var s=n||this.parent.getCell(e,t);if(!s)return;var l={rowIdx:e,colIdx:t,td:s,cell:getCell(e,t,a),isRefresh:!0,lastCell:r,isHeightCheckNeeded:!0,manualUpdate:!0,first:"",checkCf:i};this.update(l),this.parent.notify(renderFilterCell,{td:s,rowIndex:e,colIndex:t}),o&&this.setWrapByValue(a,l)}},e.prototype.updateView=function(e){ej2Base.isNullOrUndefined(e.sheetIndex)||e.sheetIndex===this.parent.activeSheetIndex?this.refreshRange(e.indexes,e.refreshing,e.checkWrap):e.refreshing&&this.calculateFormula({cell:getCell(e.indexes[0],e.indexes[1],getSheet(this.parent,e.sheetIndex),!0),rowIdx:e.indexes[0],colIdx:e.indexes[1],sheetIndex:e.sheetIndex})},e}(),Render=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.render=function(){this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(this.parent.activeSheetIndex)},!0),this.parent.isMobileView()||(this.parent.notify(ribbon,null),this.parent.notify(formulaBar,null));var e=this.parent.createElement("div",{id:this.parent.element.id+"_sheet_panel",className:"e-sheet-panel"});this.parent.enableRtl&&e.classList.add("e-rtl"),this.parent.element.appendChild(e),this.parent.showSheetTabs?this.parent.notify(sheetTabs,null):(this.parent.notify(workbookFormulaOperation,{action:"initSheetInfo"}),this.parent.notify(workbookFormulaOperation,{action:"initiateDefinedNames"})),this.parent.isMobileView()&&(this.parent.notify(formulaBar,null),this.parent.notify(ribbon,null)),(this.parent.password.length>0||this.parent.isProtected)&&(this.parent.isProtected=!0,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.parent.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled"))),this.setSheetPanelSize(),this.renderSheet(e),this.checkTopLeftCell(!this.parent.refreshing)},e.prototype.checkTopLeftCell=function(e,t,r,n){var i=this.parent.getActiveSheet();this.parent.showSpinner();var o,a="A1"===i.topLeftCell,s=getCellIndexes(i.topLeftCell);if(i.topLeftCell!==i.paneTopLeftCell&&(i.frozenRows||i.frozenColumns)){var l=getCellIndexes(i.paneTopLeftCell);o=this.parent.scrollSettings.enableVirtualization,a=i.frozenRows&&i.frozenColumns?s[0]+i.frozenRows===l[0]&&s[1]+i.frozenColumns===l[1]:i.frozenRows?s[0]+i.frozenRows===l[0]&&0===s[1]:s[1]+i.frozenColumns===l[1]&&0===s[0],s[0]&&l[0]>s[0]?this.parent.viewport.beforeFreezeHeight=getRowsHeight(i,0,s[0]-1,!0):this.parent.viewport.beforeFreezeHeight=0,s[1]&&l[1]>s[1]?this.parent.viewport.beforeFreezeWidth=getColumnsWidth(i,0,s[1]-1,!0):this.parent.viewport.beforeFreezeWidth=0}else this.parent.viewport.beforeFreezeHeight=this.parent.viewport.beforeFreezeWidth=0;if(!this.parent.scrollSettings.enableVirtualization||a)this.refreshUI({rowIndex:s[0],colIndex:s[1],refresh:"All"},null,e,t),o&&(this.parent.viewport.topIndex=skipHiddenIdx(i,0,!0),this.parent.viewport.leftIndex=skipHiddenIdx(i,0,!0,"columns"));else{var d=i.paneTopLeftCell===i.topLeftCell?s:getCellIndexes(i.paneTopLeftCell),p=this.parent.frozenRowCount(i),h=this.parent.frozenColCount(i),c={preventScroll:!0};c.scrollTop=r||(d[0]>p?getRowsHeight(i,p||0,d[0]-1,!0):0),c.scrollLeft=n||(d[1]>h?getColumnsWidth(i,h||0,d[1]-1,!0):0),this.parent.notify(onContentScroll,c);var u=this.parent.getThreshold("row"),g=i.frozenRows?s[0]:s[0]>u?skipHiddenIdx(i,s[0]-u,!0):0,f=[];i.frozenRows&&f.push(d[0]-u>p?d[0]-u:p),u=this.parent.getThreshold("col");var m=i.frozenColumns?s[1]:s[1]>u?skipHiddenIdx(i,s[1]-u,!0,"columns"):0;i.frozenColumns?(f.length||f.push(p),f.push(d[1]-u>h?d[1]-u:h)):f.length&&f.push(h),this.refreshUI({rowIndex:g,colIndex:m,refresh:"All",top:c.scrollTop,left:c.scrollLeft,frozenIndexes:f},null,e,t),o&&(f[0]>=p&&(this.parent.viewport.topIndex=skipHiddenIdx(i,f[0]-p,!0)),f[1]>=h&&(this.parent.viewport.leftIndex=skipHiddenIdx(i,f[1]-h,!0,"columns")))}},e.prototype.renderSheet=function(e){void 0===e&&(e=document.getElementById(this.parent.element.id+"_sheet_panel")),e.appendChild(this.parent.createElement("div",{className:"e-sheet",id:this.parent.element.id+"_sheet",styles:"background-color: #fff"})),this.parent.serviceLocator.getService("sheet").renderPanel()},e.prototype.refreshUI=function(e,t,r,n){var i=this;"All"!==e.refresh&&this.parent.showSpinner();var o=this.parent.serviceLocator.getService("sheet"),a=this.parent.getActiveSheet(),s=getSheetName(this.parent),l={rowCount:a.rowCount,colCount:a.colCount};if(e.frozenIndexes=e.frozenIndexes?e.frozenIndexes:[],!t)if(this.parent.scrollSettings.enableVirtualization){var d=e.rowIndex+this.parent.viewport.rowCount+2*this.parent.getThreshold("row"),p=e.colIndex+this.parent.viewport.colCount+2*this.parent.getThreshold("col"),h=this.parent.frozenRowCount(a),c=this.parent.frozenColCount(a);e.frozenIndexes.length&&(d+=e.frozenIndexes[0]-h,p+=e.frozenIndexes[1]-c),d+=a.frozenRows,p+=a.frozenColumns;var u=a.rowCount-1,g=0,f=this.parent.skipHidden(e.rowIndex,d,"rows",!1);if(d=f[1],e.rowIndex!==f[0]){(v=getCellIndexes(a.topLeftCell))[0]===e.rowIndex&&this.parent.updateTopLeftCell(f[0],v[1],"row")}this.parent.scrollSettings.isFinite&&d>u&&(g=d-u,d=skipHiddenIdx(a,u,!1),f[0]>skipHiddenIdx(a,0,!0)&&(g=(g=e.rowIndex-g)>-1?g:0,g=this.decreaseHidden(g,e.rowIndex-1),e.top&&g<e.rowIndex&&this.parent.notify(updateTranslate,{height:getRowsHeight(a,g,e.rowIndex-1,!0),isRender:!0}),this.parent.viewport.topIndex=f[0]=g));var m=e.rowIndex=f[0];if(u=a.colCount-1,g=0,f=this.parent.skipHidden(e.colIndex,p,"columns",!1),p=f[1],e.colIndex!==f[0]){var v;(v=getCellIndexes(a.topLeftCell))[1]===e.colIndex&&this.parent.updateTopLeftCell(v[0],f[0],"col")}this.parent.scrollSettings.isFinite&&p>u&&(g=p-u,p=skipHiddenIdx(a,u,!1),f[1]>skipHiddenIdx(a,0,!0,"columns")&&(g=(g=e.colIndex-g)>-1?g:0,g=this.decreaseHidden(g,e.colIndex-1,"columns"),e.left&&g<e.colIndex&&this.parent.notify(updateTranslate,{width:getColumnsWidth(a,g,e.colIndex-1,!0),isRender:!0}),this.parent.viewport.leftIndex=f[0]=g));var C=e.colIndex=f[0];"Row"===e.refresh&&(m+=h,h&&(d+=getCellIndexes(a.topLeftCell)[0])),"Column"===e.refresh&&(C+=c,c&&(p+=getCellIndexes(a.topLeftCell)[1])),this.parent.viewport.topIndex=e.rowIndex,this.parent.viewport.bottomIndex=d,this.parent.viewport.leftIndex=e.colIndex,this.parent.viewport.rightIndex=p,t=getCellAddress(m,C)+":"+getCellAddress(d,p)}else"All"===e.refresh&&this.updateTopLeftScrollPosition(ej2Base.extend(e,{sheet:a})),this.parent.viewport.bottomIndex=a.rowCount-1,this.parent.viewport.rightIndex=a.colCount-1,t=getCellAddress(e.rowIndex,e.colIndex)+":"+getCellAddress(this.parent.viewport.bottomIndex,this.parent.viewport.rightIndex);"All"===e.refresh&&this.parent.trigger(beforeDataBound,{});var y=this.parent.isOpen||this.parent.refreshing;setAriaOptions(this.parent.getMainContent(),{busy:!0});var x=this.parent.sheets.length;getData(this.parent,s+"!"+t,null,null,e.frozenIndexes).then(function(s){if(i.parent&&!(x<i.parent.sheets.length)){var d=i.parent.sheets.indexOf(a);if(-1!==d&&d===i.parent.activeSheetIndex){var p,h=[e.rowIndex,e.colIndex].concat(getCellIndexes(t.split(":")[1]));switch(e.refresh){case"All":o.renderTable({cells:s,indexes:h,top:e.top,left:e.left,initLoad:r,isRefreshing:n,isOpen:y});break;case"Row":o.refreshRowContent({cells:s,indexes:h,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:l}),p={isEdit:!1},i.parent.notify(isFormulaBarEdit,p),p.isEdit&&i.parent.notify(editOperation,{action:"startEdit",refreshCurPos:!1});break;case"Column":o.refreshColumnContent({cells:s,indexes:h,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:l,insertDelete:e.insertDelete});break;case"RowPart":o.updateRowContent({cells:s,indexes:h,direction:e.direction,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:l});break;case"ColumnPart":o.updateColContent({cells:s,indexes:h,direction:e.direction,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:l})}i.parent&&i.parent[isReact]&&i.parent[renderReactTemplates]()}else d>-1&&i.checkTopLeftCell()}}),this.parent.notify(beforeVirtualContentLoaded,{refresh:e.refresh,skipTranslate:e.skipTranslate})},e.prototype.updateTopLeftScrollPosition=function(e){var t=getCellIndexes(e.sheet.topLeftCell),r=getCellIndexes(e.sheet.paneTopLeftCell);if(e.sheet.frozenRows){var n=this.parent.frozenRowCount(e.sheet);r[0]>n&&(e.top=getRowsHeight(e.sheet,n,r[0]-1,!0))}else e.rowIndex&&(e.rowIndex=0),0!==t[0]&&(e.top=getRowsHeight(e.sheet,0,t[0]-1,!0));if(e.sheet.frozenColumns){var i=this.parent.frozenRowCount(e.sheet);r[1]>i&&(e.left=getColumnsWidth(e.sheet,i,r[1]-1,!0))}else e.colIndex&&(e.colIndex=0),0!==t[1]&&(e.left=getColumnsWidth(e.sheet,0,t[1]-1,!0))},e.prototype.removeSheet=function(){ej2Base.remove(document.getElementById(this.parent.element.id+"_sheet"))},e.prototype.refreshSheet=function(e,t,r){var n=0,i=0;if(t){var o=this.parent.element.getElementsByClassName("e-main-panel")[0];o&&(n=o.scrollTop);var a=this.parent.getMainContent();a&&(i=a.scrollLeft)}this.removeSheet(),this.renderSheet(),this.parent.notify(deInitProperties,{}),this.checkTopLeftCell(!1,e,n,i),r&&focus(this.parent.element)},e.prototype.setSheetPanelSize=function(){var e,t=document.getElementById(this.parent.element.id+"_sheet_panel"),r=this.parent.element.getBoundingClientRect();"auto"===this.parent.height?(t.style.height="260px",e=230):(e=r.height-getSiblingsHeight(t),t.style.height=e+"px",e-=32),this.parent.viewport.height=e,this.parent.viewport.width=r.width-32,this.parent.viewport.rowCount=this.roundValue(e,20),this.parent.viewport.colCount=this.roundValue(r.width,64)},e.prototype.roundValue=function(e,t){var r=e/t,n=Math.round(r);return Math.abs(r-n)<.5?n:n-1},e.prototype.moveOrDuplicateSheetHandler=function(e){this.parent.notify(refreshSheetTabs,null),e.refresh&&this.refreshSheet(e.isDuplicate)},e.prototype.decreaseHidden=function(e,t,r){void 0===r&&(r="rows");for(var n=this.parent.getActiveSheet(),i=t;i>=e;i--)if(n[r][i]&&n[r][i].hidden){if(n.frozenColumns||n.frozenRows){"rows"===r?setRow(n,i,{hidden:!1}):setColumn(n,i,{hidden:!1});continue}if(--e<0){e=skipHiddenIdx(n,0,!0,r);break}}return e},e.prototype.instantiateRenderer=function(){this.parent.serviceLocator.register("cell",new CellRenderer(this.parent)),this.parent.serviceLocator.register("row",new RowRenderer(this.parent)),this.parent.serviceLocator.register("sheet",new SheetRender(this.parent))},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(initialLoad,this.instantiateRenderer,this),this.parent.on(dataRefresh,this.refreshSheet,this),this.parent.on(spreadsheetDestroyed,this.destroy,this),this.parent.on(moveOrDuplicateSheet,this.moveOrDuplicateSheetHandler,this),this.parent.on(getUpdatedScrollPosition,this.updateTopLeftScrollPosition,this)},e.prototype.removeEventListener=function(){this.parent.off(initialLoad,this.instantiateRenderer),this.parent.off(dataRefresh,this.refreshSheet),this.parent.off(spreadsheetDestroyed,this.destroy),this.parent.off(moveOrDuplicateSheet,this.moveOrDuplicateSheetHandler),this.parent.off(getUpdatedScrollPosition,this.updateTopLeftScrollPosition)},e}(),Dialog$1=function(){function e(e){this.parent=e}return e.prototype.show=function(e,t){var r,n=this;t=!!ej2Base.isNullOrUndefined(t);var i=e.close||null,o={header:"Spreadsheet",cssClass:this.parent.cssClass,target:this.parent.element,buttons:[]};e.close=function(){n.destroyDialog(),i&&i()},ej2Base.extend(o,e),t&&(r=this.parent.serviceLocator.getService(locale).getConstant(o.buttons.length?"Cancel":"Ok"),o.buttons.push({buttonModel:{content:r,isPrimary:0===o.buttons.length},click:this.hide.bind(this)}));var a=this.parent.createElement("div");document.body.appendChild(a),this.dialogInstance=new ej2Popups.Dialog(o),this.dialogInstance.createElement=this.parent.createElement,this.dialogInstance.appendTo(a),this.dialogInstance.refreshPosition()},e.prototype.destroyDialog=function(){this.dialogInstance.destroy(),ej2Base.remove(this.dialogInstance.element),this.dialogInstance=null},e.prototype.hide=function(){this.dialogInstance&&this.dialogInstance.hide()},e.prototype.destroy=function(){this.parent=null},e}(),ActionEvents=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.initializeActionBegin=function(){var e=this,t=this.parent.beforeCellFormat;this.parent.beforeCellFormat=function(r){e.actionEventHandler({evtArgs:r,evtFunc:t,actionType:"begin",eventType:"format"})};var r=this.parent.beforeOpen;this.parent.beforeOpen=function(t){e.actionEventHandler({evtArgs:t,evtFunc:r,actionType:"begin",eventType:"beforeOpen"})};var n=this.parent.beforeSave;this.parent.beforeSave=function(t){e.actionEventHandler({evtArgs:t,evtFunc:n,actionType:"begin",eventType:"beforeSave"})};var i=this.parent.beforeSort;this.parent.beforeSort=function(t){e.actionEventHandler({evtArgs:t,evtFunc:i,actionType:"begin",eventType:"beforeSort"})}},e.prototype.initializeActionComplete=function(){var e=this,t=this.parent.sortComplete;this.parent.sortComplete=function(r){e.actionEventHandler({evtArgs:r,evtFunc:t,actionType:"complete",eventType:"sorting"})};var r=this.parent.cellSave;this.parent.cellSave=function(t){e.actionEventHandler({evtArgs:t,evtFunc:r,actionType:"complete",eventType:"cellSave"})}},e.prototype.actionEventHandler=function(e){e.evtFunc&&e.evtFunc.apply(this,[e]),"begin"===e.actionType?this.actionBeginHandler({eventArgs:e.evtArgs,action:e.eventType}):this.actionCompleteHandler({eventArgs:e.evtArgs,action:e.eventType})},e.prototype.actionBeginHandler=function(e){var t=e.preventAction;delete e.preventAction,this.parent.trigger("actionBegin",{action:e.action,args:e}),t||"clipboard"!==e.action&&"beforeSort"!==e.action&&"format"!==e.action&&"cellSave"!==e.action&&"beforeWrap"!==e.action&&"beforeReplace"!==e.action&&"filter"!==e.action&&"beforeClear"!==e.action&&"beforeInsertImage"!==e.action&&"beforeInsertChart"!==e.action&&"cellDelete"!==e.action&&"autofill"!==e.action&&"removeValidation"!==e.action||this.parent.notify(setActionData,{args:e}),t&&(e.preventAction=!0)},e.prototype.actionCompleteHandler=function(e){var t=e.preventAction;delete e.preventAction,this.parent.notify(triggerDataChange,e),this.parent.trigger("actionComplete",e),t||"undoRedo"===e.action||"gotoSheet"===e.action||this.parent.notify(updateUndoRedoCollection,{args:e}),this.parent.notify(positionAutoFillElement,null)},e.prototype.addEventListener=function(){this.parent.on(completeAction,this.actionCompleteHandler,this),this.parent.on(beginAction,this.actionBeginHandler,this),this.parent.on(spreadsheetDestroyed,this.removeEventListener,this)},e.prototype.removeEventListener=function(){this.parent.off(completeAction,this.actionCompleteHandler),this.parent.off(beginAction,this.actionBeginHandler),this.parent.off(spreadsheetDestroyed,this.removeEventListener)},e}(),Overlay=function(){function e(e){this.minHeight="300px",this.minWidth="400px",this.isOverlayClicked=!1,this.isResizerClicked=!1,this.currentWidth=400,this.currenHeight=300,this.parent=e}return e.prototype.insertOverlayElement=function(e,t,r){var n=this.parent.createElement("div",{id:e,attrs:{class:"e-ss-overlay"},styles:"width: "+this.minWidth+";  height: "+this.minHeight}),i=getRangeIndexes(t),o=this.parent.sheets[r],a=this.parent.frozenRowCount(o),s=this.parent.frozenColCount(o),l=getCellPosition(o,i,a,s,this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth);if(i[0]>=a&&i[1]<s){var d=this.parent.sheetModule.contentPanel;d.scrollTop&&(l.top-=d.scrollTop,l.top+=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height)}if(i[1]>=s&&i[0]<a){var p=this.parent.getScrollElement();p.scrollLeft&&(l.left-=p.scrollLeft,l.left+=this.parent.sheetModule.getRowHeaderWidth(o))}var h;return i[0]<a||i[1]<s?(h=document.getElementById(this.parent.element.id+"_sheet"),a&&(i[0]>=a?l.top+=(o.showHeaders?31:0)+getRowsHeight(o,getCellIndexes(o.topLeftCell)[0],a-1):s||(l.left+=this.parent.sheetModule.getRowHeaderWidth(o,!0))),s&&(i[1]>=s?l.left+=this.parent.sheetModule.getRowHeaderWidth(o):a||(l.left+=o.showHeaders?31:0))):h=this.parent.getMainContent(),n.style.top=l.top+"px",n.style.left=l.left+"px",h.appendChild(n),this.renderResizeHandles(n),this.addEventListener(n),this.originalWidth=parseFloat(getComputedStyle(n,null).getPropertyValue("width").replace("px","")),this.originalHeight=parseFloat(getComputedStyle(n,null).getPropertyValue("height").replace("px","")),n},e.prototype.adjustFreezePaneSize=function(e,t,r){var n=getRangeIndexes(r),i=this.parent.getActiveSheet(),o=this.parent.frozenRowCount(i),a=this.parent.frozenColCount(i);if(n[0]<o||n[1]<a?(ej2Base.isNullOrUndefined(e.top)||(t.style.top=e.top+(i.showHeaders?31:0)-this.parent.viewport.beforeFreezeHeight+"px"),ej2Base.isNullOrUndefined(e.left)||(t.style.left=e.left+this.parent.sheetModule.getRowHeaderWidth(i,!0)-this.parent.viewport.beforeFreezeWidth+"px")):(ej2Base.isNullOrUndefined(e.top)||(t.style.top=e.top-this.parent.viewport.beforeFreezeHeight-(o?getRowsHeight(i,getCellIndexes(i.topLeftCell)[0],o-1):0)+"px"),ej2Base.isNullOrUndefined(e.left)||(t.style.left=e.left-this.parent.viewport.beforeFreezeWidth-(a?getColumnsWidth(i,getCellIndexes(i.topLeftCell)[1],a-1):0)+"px")),ej2Base.isNullOrUndefined(e.top)){var s=getCellIndexes(i.topLeftCell)[0];e.top=this.parent.viewport.beforeFreezeHeight+(o&&s===n[0]?0:getRowsHeight(i,o?s:0,n[0]-1))}if(ej2Base.isNullOrUndefined(e.left)){var l=getCellIndexes(i.topLeftCell)[1];e.left=this.parent.viewport.beforeFreezeWidth+(a&&l===n[1]?0:getColumnsWidth(i,a?l:0,n[1]-1))}},e.prototype.addEventListener=function(e){var t=e;ej2Base.EventHandler.add(t,"mousedown",this.overlayClickHandler,this),ej2Base.EventHandler.add(t,"mousemove",this.overlayMouseMoveHandler,this),ej2Base.EventHandler.add(document.getElementById(this.parent.element.id+"_sheet"),"mousemove",this.overlayMouseMoveHandler,this),ej2Base.EventHandler.add(document,"mouseup",this.overlayMouseUpHandler,this),this.parent.on(overlayEleSize,this.setOriginalSize,this)},e.prototype.setOriginalSize=function(e){this.originalHeight=e.height,this.originalWidth=e.width},e.prototype.overlayMouseMoveHandler=function(e){var t,r,n,i,o,a,s=e.target,l=document.getElementsByClassName("e-ss-overlay-active")[0],d=this.parent.getActiveSheet(),p=d.frozenRows||d.frozenColumns?[29,this.parent.sheetModule.getRowHeaderWidth(d,!0)]:[-1,-1];if(this.isOverlayClicked&&this.isResizerClicked)switch(this.resizer){case"e-ss-overlay-t":t=Math.max(this.originalMouseY-e.clientY+this.originalHeight,20),r=e.clientY-(this.originalMouseY-this.originalResizeTop),t>20&&r>p[0]&&(l.style.height=t+"px",l.style.top=r+"px",this.resizedReorderTop=r,this.currenHeight=t,this.parent.notify(refreshChartSize,{height:l.style.height,width:l.style.width,overlayEle:l}));break;case"e-ss-overlay-r":(n=this.originalWidth+(e.pageX-this.originalMouseX))>20&&(l.style.width=n+"px",this.currentWidth=n,this.parent.notify(refreshChartSize,{height:l.style.height,width:l.style.width,overlayEle:l}));break;case"e-ss-overlay-b":(i=this.originalHeight+(e.pageY-this.originalMouseY))>20&&(l.style.height=i+"px",this.currenHeight=i,this.parent.notify(refreshChartSize,{height:l.style.height,width:l.style.width,overlayEle:l}));break;case"e-ss-overlay-l":o=Math.max(this.originalMouseX-e.clientX+this.originalWidth,20),a=e.clientX-(this.originalMouseX-this.originalResizeLeft),o>20&&a>p[1]&&(l.style.width=o+"px",l.style.left=a+"px",this.resizedReorderLeft=a,this.currentWidth=o,this.parent.notify(refreshChartSize,{height:l.style.height,width:l.style.width,overlayEle:l}))}else if(this.isOverlayClicked)if(ej2Base.closest(s,".e-sheet")&&!s.classList.contains("e-sheet-content")||s.classList.contains("e-cell")){if(!l)return;var h=e.clientX-this.diffX,c=e.clientY-this.diffY;h>p[1]&&(l.style.left=h+"px"),c>p[0]&&(l.style.top=c+"px"),this.resizedReorderLeft=h<0?0:h,this.resizedReorderTop=c<0?0:c}else this.overlayMouseUpHandler(e,!0)},e.prototype.overlayMouseUpHandler=function(e,t){if(!this.parent.getActiveSheet().isProtected){this.isResizerClicked=!1;var r=e.target,n=document.getElementsByClassName("e-datavisualization-chart e-ss-overlay-active");r.classList.contains("e-ss-overlay")||(r=ej2Base.closest(e.target,".e-datavisualization-chart")?ej2Base.closest(e.target,".e-datavisualization-chart"):r);var i=this.parent.getActiveSheet(),o={prevTop:i.frozenRows||i.frozenColumns?this.prevY:this.originalReorderTop,prevLeft:i.frozenRows||i.frozenColumns?this.prevX:this.originalReorderLeft,currentTop:this.resizedReorderTop>=0?this.resizedReorderTop:this.originalReorderTop,currentLeft:this.resizedReorderLeft>=0?this.resizedReorderLeft:this.originalReorderLeft,id:r.id,currentHeight:this.currenHeight,currentWidth:this.currentWidth,requestType:"imageRefresh",prevHeight:this.originalHeight,prevWidth:this.originalWidth};if(this.isOverlayClicked||t){var a=void 0,s=void 0,l={clientY:o.prevTop,isImage:!0},d={clientX:o.prevLeft,isImage:!0},p=this.parent.element.getElementsByClassName("e-ss-overlay-active")[0];if(i.frozenRows||i.frozenColumns){if(!p)return;l.isImage=!1,d.isImage=!1,l.target=p,d.target=p,o.prevTop<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(l.target=this.parent.getColumnHeaderContent()),o.prevLeft<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(d.target=this.parent.getRowHeaderTable());var h=p.getBoundingClientRect();a={clientY:h.top},s={clientX:h.left},h.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(a.target=this.parent.getColumnHeaderContent()),h.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(s.target=this.parent.getRowHeaderTable())}else a={clientY:o.currentTop,isImage:!0},s={clientX:o.currentLeft,isImage:!0};if(this.parent.notify(getRowIdxFromClientY,l),this.parent.notify(getRowIdxFromClientY,a),this.parent.notify(getColIdxFromClientX,d),this.parent.notify(getColIdxFromClientX,s),a.size&&(o.currentTop=a.size),s.size&&(o.currentLeft=s.size),o.prevRowIdx=l.clientY,o.prevColIdx=d.clientX,o.currentRowIdx=a.clientY,o.currentColIdx=s.clientX,(i.frozenColumns||i.frozenRows)&&!ej2Base.closest(p,".e-sheet-content")){var c=this.parent.frozenColCount(i),u=this.parent.frozenRowCount(i);if(o.currentRowIdx>=u&&o.currentColIdx>=c){var g=parseInt(p.style.top,10),f=parseInt(p.style.left,10);g+=this.parent.sheetModule.contentPanel.scrollTop,g-=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height;f+=this.parent.getScrollElement().scrollLeft,f-=this.parent.sheetModule.getRowHeaderWidth(i),p.style.top=g+"px",p.style.left=f+"px",this.parent.getMainContent().appendChild(p)}}n&&n[0]&&n[0].querySelector(".e-control")&&(o.id=n[0].id),this.originalReorderTop!==this.resizedReorderTop||this.originalReorderLeft!==this.resizedReorderLeft?(o.id=p.id,n&&n[0]?(o.requestType="chartRefresh",this.parent.notify(refreshChartCellObj,o)):this.parent.notify(refreshImgCellObj,o),this.resizedReorderTop=this.originalReorderTop,this.resizedReorderLeft=this.originalReorderLeft):this.currenHeight===this.originalHeight&&this.originalWidth===this.currentWidth||(o.id=r.id.indexOf("overlay")>0?r.id:r.parentElement?r.parentElement.id:"",n&&n[0]?(o.requestType="chartRefresh",this.parent.notify(refreshChartCellObj,o)):this.parent.notify(refreshImgCellObj,o),this.originalHeight=this.currenHeight,this.originalWidth=this.currentWidth)}this.isOverlayClicked=!1}},e.prototype.overlayClickHandler=function(e){if(!this.parent.getActiveSheet().isProtected){this.isOverlayClicked=!0;var t=e.target,r=e.target;t.classList.contains("e-ss-overlay")||(r=t.parentElement,ej2Base.closest(e.target,".e-datavisualization-chart")&&(r=ej2Base.closest(e.target,".e-datavisualization-chart"),this.currentWidth=parseFloat(getComputedStyle(r,null).getPropertyValue("width").replace("px","")),this.currenHeight=parseFloat(getComputedStyle(r,null).getPropertyValue("height").replace("px",""))));var n=this.parent.getActiveSheet();if((n.frozenColumns||n.frozenRows)&&ej2Base.closest(r,".e-sheet-content")){var i=parseInt(r.style.top,10),o=parseInt(r.style.left,10);i-=this.parent.sheetModule.contentPanel.scrollTop,i+=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height;o-=this.parent.getScrollElement().scrollLeft,o+=this.parent.sheetModule.getRowHeaderWidth(n),r.style.top=i+"px",r.style.left=o+"px",document.getElementById(this.parent.element.id+"_sheet").appendChild(r)}this.originalReorderLeft=parseInt(r.style.left,10),this.originalReorderTop=parseInt(r.style.top,10),this.resizedReorderLeft=parseInt(r.style.left,10),this.resizedReorderTop=parseInt(r.style.top,10),this.originalResizeTop=this.originalReorderTop,this.originalResizeLeft=this.originalReorderLeft,this.originalMouseX=e.clientX,this.originalMouseY=e.clientY,this.diffX=this.originalMouseX-this.originalReorderLeft,this.diffY=this.originalMouseY-this.originalReorderTop;var a=document.getElementsByClassName("e-ss-overlay-active")[0];a&&ej2Base.removeClass([a],"e-ss-overlay-active"),document.getElementById(r.id).classList.add("e-ss-overlay-active"),t.classList.contains("e-ss-resizer")&&(this.resizer=t.classList[0],this.originalWidth=parseFloat(getComputedStyle(r,null).getPropertyValue("width").replace("px","")),this.originalHeight=parseFloat(getComputedStyle(r,null).getPropertyValue("height").replace("px","")),this.isResizerClicked=!0),r.classList.contains("e-datavisualization-chart")&&(this.parent.notify(focusChartBorder,{id:r.id}),a||this.parent.notify(insertDesignChart,{id:r.id}));var s=r.getBoundingClientRect();this.prevX=s.left,this.prevY=s.top}},e.prototype.renderResizeHandles=function(e){for(var t,r=["e-ss-overlay-t","e-ss-overlay-r","e-ss-overlay-b","e-ss-overlay-l"],n=0,i=e;r.length>n;)t=this.parent.createElement("div",{attrs:{class:r[n]+" e-ss-resizer"},styles:"width: 8px; height: 8px; border-radius: 4px;"}),i.appendChild(t),n++},e.prototype.removeEventListener=function(){var e=document.getElementById(this.parent.element.id+"_overlay");e&&(ej2Base.EventHandler.remove(e,"mousedown",this.overlayClickHandler),ej2Base.EventHandler.remove(e,"mousemove",this.overlayMouseMoveHandler)),ej2Base.EventHandler.remove(document.getElementById(this.parent.element.id+"_sheet"),"mousemove",this.overlayMouseMoveHandler),ej2Base.EventHandler.remove(document,"mouseup",this.overlayMouseUpHandler),this.parent.off(overlayEleSize,this.setOriginalSize)},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e}(),__extends$10=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__decorate$9=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},Spreadsheet=function(e){function t(t,n){var i=e.call(this,t)||this;return i.dataValidationRange="",i.isValidationHighlighted=!1,i.viewport={rowCount:0,colCount:0,height:0,topIndex:0,leftIndex:0,width:0,bottomIndex:0,rightIndex:0,beforeFreezeHeight:0,beforeFreezeWidth:0},i.needsID=!0,r.Inject(Ribbon$$1,FormulaBar,SheetTabs,Selection,Edit,KeyboardNavigation,KeyboardShortcut,Clipboard,DataBind,Open,ContextMenu$1,Save,NumberFormat,CellFormat,Formula,WrapText,WorkbookEdit,WorkbookOpen,WorkbookSave,WorkbookCellFormat,WorkbookNumberFormat,WorkbookFormula,Sort,WorkbookSort,Resize,UndoRedo,WorkbookFilter,Filter,SpreadsheetHyperlink,WorkbookHyperlink,Insert,Delete,WorkbookInsert,WorkbookDelete,DataValidation,WorkbookDataValidation,ProtectSheet,WorkbookProtectSheet,FindAndReplace,WorkbookFindAndReplace,Merge,WorkbookMerge,SpreadsheetImage,ConditionalFormatting,WorkbookImage,WorkbookConditionalFormat,SpreadsheetChart,WorkbookChart,AutoFill,WorkbookAutoFill),n&&i.appendTo(n),i}__extends$10(t,e),r=t,t.prototype.getCell=function(e,t,r){var n;return this.insideViewport(e,t)&&(r||(r=this.getRow(e,null,t)),t=this.getViewportIndex(t,!0),n=r?r.cells[t]:r),n},t.prototype.getRow=function(e,t,r){if(!t){var n=this.getActiveSheet(),i=this.frozenRowCount(n),o=this.frozenColCount(n);t=ej2Base.isNullOrUndefined(r)||e>i-1&&r>o-1?this.getContentTable():e<i&&r<o?this.sheetModule.getSelectAllTable():e<i?this.getColHeaderTable():this.getRowHeaderTable()}return e=this.getViewportIndex(e),t?t.rows[e]:null},t.prototype.hiddenCount=function(e,t,r,n){void 0===r&&(r="rows"),void 0===n&&(n=this.getActiveSheet());for(var i=0,o=e;o<=t;o++)n[r][o]&&n[r][o].hidden&&i++;return i},t.prototype.getViewportIndex=function(e,t){var r=this.getActiveSheet();if(t){var n=this.frozenColCount(r);if(n){var i=getCellIndexes(r.topLeftCell)[1];if(e<n)return 1+(e-=i);e-=n}}else{var o=this.frozenRowCount(r);if(o){var a=getCellIndexes(r.topLeftCell)[0];if(e<o)return 1+(e-=a);e-=o}}return this.scrollSettings.enableVirtualization&&(t?(e-=this.hiddenCount(this.viewport.leftIndex,e,"columns"),e-=this.viewport.leftIndex):(e-=this.hiddenCount(this.viewport.topIndex,e),e-=this.viewport.topIndex)),e},t.prototype.preRender=function(){e.prototype.preRender.call(this),this.serviceLocator=new ServiceLocator,this.initServices()},t.prototype.initServices=function(){this.serviceLocator.register(locale,new ej2Base.L10n(this.getModuleName(),defaultLocale,this.locale)),this.serviceLocator.register(dialog,new Dialog$1(this)),this.serviceLocator.register(actionEvents,new ActionEvents(this)),this.serviceLocator.register(overlay,new Overlay(this))},t.prototype.render=function(){e.prototype.render.call(this),this.element.setAttribute("tabindex","0"),setAriaOptions(this.element,{role:"grid"}),this.renderModule=new Render(this),this.notify(initialLoad,null),this.renderSpreadsheet(),this.wireEvents(),this.created&&(this[created].observers?this[created].observers.length>0&&(this.createdHandler={observers:this[created].observers},this[created].observers=[]):(this.createdHandler=this.created,this.setProperties({created:void 0},!0)))},t.prototype.renderSpreadsheet=function(){this.cssClass&&ej2Base.addClass([this.element],this.cssClass.split(" ")),this.setHeight(),this.setWidth(),ej2Popups.createSpinner({target:this.element},this.createElement),this.isMobileView()&&-1===this.cssClass.indexOf("e-mobile-view")&&this.element.classList.add("e-mobile-view"),this.sheetModule=this.serviceLocator.getService("sheet"),this.allowScrolling&&(this.scrollModule=new Scroll(this)),this.scrollSettings.enableVirtualization&&new VirtualScroll(this),this.renderModule.render(),new ShowHide(this)},t.prototype.showSpinner=function(){ej2Popups.showSpinner(this.element)},t.prototype.hideSpinner=function(){ej2Popups.hideSpinner(this.element)},t.prototype.protectSheet=function(t,r,n){"string"==typeof t&&(t=getSheetIndex(this,t)),t&&(this.setSheetPropertyOnMute(this.sheets[t],"isProtected",!0),this.setSheetPropertyOnMute(this.sheets[t],"password",n||""),this.setSheetPropertyOnMute(this.sheets[t],"protectSettings",r)),t=this.getActiveSheet().index,this.setSheetPropertyOnMute(this.getActiveSheet(),"isProtected",!0),this.setSheetPropertyOnMute(this.getActiveSheet(),"password",n||""),e.prototype.protectSheet.call(this,t,r,n)},t.prototype.unprotectSheet=function(t){"string"==typeof t&&(t=getSheetIndex(this,t)),t?this.sheets[t].isProtected=!1:this.getActiveSheet().isProtected=!1,e.prototype.unprotectSheet.call(this,t)},t.prototype.find=function(t){var r=this.getActiveSheet().activeCell;if(e.prototype.findHandler.call(this,t),!t.isAction)return r!==this.getActiveSheet().activeCell?this.getActiveSheet().name+"!"+this.getActiveSheet().activeCell:null},t.prototype.replace=function(t){t={value:t.value,mode:t.mode?t.mode:"Sheet",isCSen:!!t.isCSen&&t.isCSen,isEMatch:!!t.isEMatch&&t.isEMatch,searchBy:t.searchBy?t.searchBy:"By Row",replaceValue:t.replaceValue,replaceBy:t.replaceBy,sheetIndex:t.sheetIndex?t.sheetIndex:this.activeSheetIndex,findOpt:t.findOpt?t.findOpt:""},e.prototype.replaceHandler.call(this,t)},t.prototype.findAll=function(e,t,r,n,i){var o=[],a={value:e,mode:t=t||"Sheet",sheetIndex:i=i||this.activeSheetIndex,isCSen:r=r||!1,isEMatch:n=n||!1,findCollection:o};return this.notify(findAllValues,a),o},t.prototype.goTo=function(e){if(e.includes("!")){var t=e.split("!"),r=getSheetIndex(this,t[0]);if(void 0===r)return;if(r!==this.activeSheetIndex){var n=t[1].split(":")[0],i=this.sheets[r];this.setSheetPropertyOnMute(i,"activeCell",n),this.setSheetPropertyOnMute(i,"selectedRange",t[1]);var o=getCellIndexes(n);if(i.frozenColumns||i.frozenRows){var a=getCellIndexes(i.topLeftCell);if(!(i.frozenRows&&o[0]<a[0]||i.frozenColumns&&o[1]<a[1])){var s=this.frozenRowCount(i),l=this.frozenColCount(i),d=[],p=[],h=getCellIndexes(i.paneTopLeftCell);s?(d.push(a[0]),o[0]>=s?p.push(o[0]):p.push(h[0])):(d.push(o[0]),p.push(o[0])),l?(d.push(a[1]),o[1]>=l?p.push(o[1]):p.push(h[1])):(d.push(o[1]),p.push(o[1])),this.setSheetPropertyOnMute(i,"topLeftCell",getCellAddress(d[0],d[1])),this.setSheetPropertyOnMute(i,"paneTopLeftCell",getCellAddress(p[0],p[1]))}}else o[0]<this.viewport.rowCount&&(o[0]=0),o[1]<this.viewport.colCount&&(o[1]=0),this.updateTopLeftCell(o[0],o[1],null,i);return this.activeSheetIndex=r,void this.dataBind()}}var c=getRangeIndexes(e),u=this.getActiveSheet(),g=this.frozenRowCount(u),f=this.frozenColCount(u),m=this.insideViewport(c[0],c[1]);if(m){this.selectRange(e);var v=getCellIndexes(u.paneTopLeftCell),C=this.viewport.height-this.getScrollElement().parentElement.getBoundingClientRect().height,y=0,x=0;if(g)for(var b=getCellIndexes(u.topLeftCell)[0];b<g;b++)if((y+=getRowHeight(u,b))>C){x=b;break}if(0===x)for(b=v[0];b<this.viewport.bottomIndex;b++)if((y+=getRowHeight(u,b))>C){x=b;break}v[2]=x;var S=0;if(y=0,C=this.viewport.width-this.sheetModule.getScrollSize(),f)for(b=getCellIndexes(u.topLeftCell)[1];b<f;b++)if((y+=getColumnWidth(u,b))>C){S=b;break}if(0===S)for(b=v[1];b<this.viewport.rightIndex;b++)if((y+=getColumnWidth(u,b))>C){S=b;break}if(v[3]=S,c[0]>=v[0]&&c[0]<v[2]&&c[1]>=v[1]&&c[1]<v[3])return;if(g||f){if(v=[].concat(getCellIndexes(u.topLeftCell),[g,v[3]]),c[0]>=v[0]&&c[0]<v[2]&&c[1]>=v[1]&&c[1]<v[3])return;if(v[2]=x,v[3]=f,c[0]>=v[0]&&c[0]<v[2]&&c[1]>=v[1]&&c[1]<v[3])return}}var w,I,R,E,k,F,A=this.getMainContent().parentElement;c[0]===g?R=0:(R=getRowsHeight(u,g,c[0]-1,!0),this.scrollSettings.enableVirtualization&&(F=R+this.getContentTable().getBoundingClientRect().height)>(k=parseFloat(A.querySelector(".e-virtualtrack").style.height))&&(F+=10,(w=A.querySelector(".e-virtualtrack")).style.height=F+"px",getUpdateUsingRaf(function(){w.style.height=k+"px"}))),A.scrollTop=R,A=this.element.getElementsByClassName("e-scroller")[0],c[1]===f?R=0:(R=getColumnsWidth(u,f,c[1]-1,!0),this.scrollSettings.enableVirtualization&&(F=R+this.getContentTable().getBoundingClientRect().width)>(E=parseFloat(A.querySelector(".e-virtualtrack").style.width))&&(F+=10,(w=A.querySelector(".e-virtualtrack")).style.width=F+"px",(I=this.getColumnHeaderContent().querySelector(".e-virtualtrack")).style.width=F+"px",(w=this.getMainContent().querySelector(".e-virtualtrack")).style.width=F+"px",getUpdateUsingRaf(function(){w.style.width=E+"px",I.style.width=E+"px"}))),A.scrollLeft=R,m||this.selectRange(e)},t.prototype.insideViewport=function(e,t){var r=this.getActiveSheet();if(r.frozenRows||r.frozenColumns){var n=this.frozenRowCount(r),i=this.frozenColCount(r),o=getCellIndexes(r.topLeftCell);return(e>=o[0]&&e<n||e>=this.viewport.topIndex+n&&e<=this.viewport.bottomIndex)&&(t>=o[1]&&t<i||t>=this.viewport.leftIndex+i&&t<=this.viewport.rightIndex)}return e>=this.viewport.topIndex&&e<=this.viewport.bottomIndex&&t>=this.viewport.leftIndex&&t<=this.viewport.rightIndex},t.prototype.resize=function(){this.renderModule.setSheetPanelSize(),this.scrollSettings.enableVirtualization&&this.renderModule.refreshSheet(!1,!0)},t.prototype.cut=function(e){var t=new Promise(function(e,t){e(void 0)});return this.notify(cut,e?{range:getIndexesFromAddress(e),sId:this.sheets[getSheetIndex(this,getSheetNameFromAddress(e))]?this.sheets[getSheetIndex(this,getSheetNameFromAddress(e))].id:this.getActiveSheet().id,promise:t,invokeCopy:!0,isPublic:!0}:{promise:t,invokeCopy:!0,isPublic:!0}),t},t.prototype.copy=function(e){var t=new Promise(function(e,t){e(void 0)});return this.notify(copy,e?{range:getIndexesFromAddress(e),sId:this.sheets[getSheetIndex(this,getSheetNameFromAddress(e))]?this.sheets[getSheetIndex(this,getSheetNameFromAddress(e))].id:this.getActiveSheet().id,promise:t,invokeCopy:!0,isPublic:!0}:{promise:t,invokeCopy:!0,isPublic:!0}),t},t.prototype.paste=function(e,t){this.notify(paste,{range:e?getIndexesFromAddress(e):e,sIdx:e?getSheetIndex(this,getSheetNameFromAddress(e)):e,type:t,isAction:!0,isInternal:!0})},t.prototype.updateAction=function(e){updateAction(e,this)},t.prototype.setHeight=function(){this.height.toString().indexOf("%")>-1&&(this.element.style.minHeight="400px"),this.element.style.height=ej2Base.formatUnit(this.height)},t.prototype.setWidth=function(){(this.width.toString().indexOf("%")>-1||"auto"===this.width)&&(this.element.style.minWidth="300px"),this.element.style.width=ej2Base.formatUnit(this.width)},t.prototype.setColWidth=function(e,t,r){void 0===e&&(e=64),void 0===t&&(t=0);var n=ej2Base.isNullOrUndefined(r)?this.getActiveSheet():this.sheets[r];if(n){var i=t,o="number"==typeof e?e+"px":e;t=ej2Base.isNullOrUndefined(t)?getCellIndexes(n.activeCell)[1]:t;var a=this.frozenColCount(n),s=a?this.viewport.rightIndex-a:this.viewport.rightIndex;if(n===this.getActiveSheet())if(t>=this.viewport.leftIndex&&t<=s){this.scrollSettings.enableVirtualization&&(t-=this.viewport.leftIndex);var l=void 0;l=n.showHeaders?this.getColumnHeaderContent().getElementsByClassName("e-header-cell")[t]:this.getContentTable().getElementsByClassName("e-row")[0].getElementsByClassName("e-cell")[t];var d=getColumnWidth(n,t,null,!0);(c=getDPRValue(parseInt(o,10))-d)<0&&d<-c&&(getCellIndexes(n.activeCell),c=-d);var p=parseInt(l.getAttribute("aria-colindex"),10)-1;this.getActiveSheet()===n&&(this.notify(colWidthChanged,{threshold:c,colIdx:p,checkWrapCell:!0}),setResize(t,t,o,!0,this))}else{var h=getColumnWidth(n,t),c=void 0;c=parseInt(o,10)>0?-(h-parseInt(o,10)):-h,this.notify(colWidthChanged,{threshold:c,colIdx:t})}getColumn(n,i).width=parseInt(o,10)>0?parseInt(o,10):0,n.columns[i].customWidth=!0,this.notify(positionAutoFillElement,null)}},t.prototype.setRowHeight=function(e,t,r,n){void 0===e&&(e=20),void 0===t&&(t=0);var i=ej2Base.isNullOrUndefined(r)?this.getActiveSheet():this.sheets[r-1];if(i){var o=t,a="number"==typeof e?e+"px":e;t=ej2Base.isNullOrUndefined(t)?getCellIndexes(i.activeCell)[0]:t;var s=this.frozenRowCount(i),l=s?this.viewport.bottomIndex-s:this.viewport.bottomIndex;if(i===this.getActiveSheet())if(t<=l&&t>=this.viewport.topIndex){this.scrollSettings.enableVirtualization&&(t-=this.viewport.topIndex);var d=getRowHeight(i,t,!0);(h=getDPRValue(parseInt(a,10))-d)<0&&d<-h&&(h=-d),this.getActiveSheet()===i&&(this.notify(rowHeightChanged,{threshold:h,rowIdx:t,isCustomHgt:!0}),ej2Base.isNullOrUndefined(n)&&(n=!1),n||(setResize(t,t,a,!1,this),n=!1))}else{var p=getRowHeight(i,t),h=void 0;h=parseInt(a,10)>0?-(p-parseInt(a,10)):-p,this.notify(rowHeightChanged,{threshold:h,rowIdx:t})}setRowHeight(i,o,parseInt(a,10)>0?parseInt(a,10):0),i.rows[o].customHeight=!0,this.notify(positionAutoFillElement,null)}},t.prototype.autoFit=function(e){var t=this.getIndexes(e),r=t.startIdx,n=t.endIdx,i=t.isCol,o=i?getColIndex("XFD"):1048576;if(r<=o)for(n>o&&(n=o);r<=n;r++)this.notify(setAutoFit,{idx:r,isCol:i})},t.prototype.getIndexes=function(e){var t,r,n,i;if(-1!==e.indexOf(":")){var o=e.split(":");n=o[0],i=o[1]}else n=e,i=e;if(!ej2Base.isNullOrUndefined(n)){var a=this.getAddress(n);n=a.address,t=a.isCol}if(!ej2Base.isNullOrUndefined(i)){var s=this.getAddress(i);i=s.address,r=s.isCol}var l=!0===t&&!0===r;return{startIdx:l?getColIndex(n.toUpperCase()):parseInt(n,10),endIdx:l?getColIndex(i.toUpperCase()):parseInt(i,10),isCol:l}},t.prototype.getAddress=function(e){var t;return e.substring(0,1).match(/\D/g)?(t=!0,e=e.replace(/[0-9]/g,""),{address:e,isCol:t}):e.substring(0,1).match(/[0-9]/g)&&e.match(/\D/g)?{address:"",isCol:!1}:(e=(parseInt(e,10)-1).toString(),{address:e,isCol:t})},t.prototype.addHyperlink=function(e,t){this.insertHyperlink(e,t,"",!0)},t.prototype.removeHyperlink=function(e){var t,r,n=this.getActiveSheet();if(e&&-1!==e.indexOf("!")){t=e.split("!");for(var i=this.sheets,o=0;o<i.length;o++)i[o].name===t[0]&&(r=o);n=this.sheets[r],e=t[1]}for(var a=getRangeIndexes(e||this.getActiveSheet().activeCell),s=a[0];s<=a[2];s++)for(var l=a[1];l<=a[3];l++)if(n&&n.rows[s]&&n.rows[s].cells[l]){for(var d=this.getCell(s,l),p=[],h=0;h<d.classList.length;h++)p.push(d.classList[h]);this.notify(deleteHyperlink,{sheet:n,rowIdx:s,colIdx:l});for(h=0;h<p.length;h++)this.getCell(s,l).classList.contains(p[h])||this.getCell(s,l).classList.add(p[h])}},t.prototype.insertHyperlink=function(t,r,n,i){if(this.allowHyperlink){var o=void 0,a=void 0,s=void 0,l=this.getActiveSheet();s=getRangeIndexes(r=r||this.getActiveSheet().activeCell);for(var d=this.getCell(s[0],s[1]),p=[],h=s[0];h<=s[2];h++)for(var c=s[1];c<=s[3];c++)l.rows[h].cells[c]&&l.rows[h].cells[c].validation&&l.rows[h].cells[c].validation.isHighlighted&&d&&"rgb(255, 255, 0)"===d.style.backgroundColor&&(l.rows[h].cells[c].style={backgroundColor:"#ffff00"});for(h=0;d&&h<d.classList.length;h++)p.push(d.classList[h]);var u={hyperlink:t,cell:r,cancel:!1},g={hyperlink:t,cell:r};if(i||this.trigger(beforeHyperlinkCreate,u),!u.cancel){var f={hyperlink:t=u.hyperlink,cell:r=u.cell,triggerEvt:!i};if(this.notify(setLinkModel,f),e.prototype.addHyperlink.call(this,t,r),r&&-1!==r.indexOf("!")){o=r.split("!");for(var m=this.sheets,v=0;v<m.length;v++)m[v].name===o[0]&&(a=v);l=this.sheets[a],r=o[1]}if(!l)return;s=getRangeIndexes(r=r||this.getActiveSheet().activeCell);var C=l.rows[s[0]].cells[s[1]];if(ej2Base.isNullOrUndefined(C.value)||""===C.value?ej2Base.isNullOrUndefined(n)||""===n||(C.value=n):C.value!==n&&(C.value=n),i||this.trigger(afterHyperlinkCreate,g),l===this.getActiveSheet()){this.serviceLocator.getService("cell").refreshRange(s);for(h=0;h<p.length;h++)this.getCell(s[0],s[1]).classList.contains(p[h])||this.getCell(s[0],s[1]).classList.add(p[h]);this.notify(refreshRibbonIcons,null)}}}},t.prototype.addDataValidation=function(t,r){e.prototype.addDataValidation.call(this,t,r)},t.prototype.removeDataValidation=function(t){e.prototype.removeDataValidation.call(this,t)},t.prototype.addInvalidHighlight=function(t){var r=t||this.dataValidationRange;if(this.isValidationHighlighted=!0,r.indexOf(",")>-1)for(var n=r.split(","),i=0;i<n.length-1;i++)e.prototype.addInvalidHighlight.call(this,n[i]);else e.prototype.addInvalidHighlight.call(this,r)},t.prototype.removeInvalidHighlight=function(t){var r=t||this.dataValidationRange;if(this.isValidationHighlighted=!1,r.indexOf(",")>-1)for(var n=r.split(","),i=0;i<n.length-1;i++)e.prototype.removeInvalidHighlight.call(this,n[i]);else e.prototype.removeInvalidHighlight.call(this,r)},t.prototype.conditionalFormat=function(t){e.prototype.conditionalFormat.call(this,t)},t.prototype.clearConditionalFormat=function(t){t=t||this.getActiveSheet().selectedRange,e.prototype.clearConditionalFormat.call(this,t)},t.prototype.setPanelSize=function(){if("auto"!==this.height){var e=document.getElementById(this.element.id+"_sheet_panel");e.style.height=this.element.getBoundingClientRect().height-getSiblingsHeight(e)+"px"}},t.prototype.open=function(t){this.isOpen=!0,e.prototype.open.call(this,t),this.isOpen&&this.showSpinner()},t.prototype.hideRow=function(t,r,n){void 0===r&&(r=t),void 0===n&&(n=!0);var i=this.getActiveSheet();!this.renderModule||i.frozenRows||i.frozenColumns?e.prototype.hideRow.call(this,t,r,n):this.notify(hideShow,{startIndex:t,endIndex:r,hide:n})},t.prototype.hideColumn=function(t,r,n){void 0===r&&(r=t),void 0===n&&(n=!0);var i=this.getActiveSheet();!this.renderModule||i.frozenRows||i.frozenColumns?e.prototype.hideColumn.call(this,t,r,n):this.notify(hideShow,{startIndex:t,endIndex:r,hide:n,isCol:!0})},t.prototype.clear=function(e){this.notify(clearViewer,{options:e,isPublic:!0})},t.prototype.refresh=function(t){this[isReact]&&this[clearTemplate](),t?this.notify(blankWorkbook,{}):e.prototype.refresh.call(this)},t.prototype.insertImage=function(e,t){var r;for(r=0;r<e.length;r++)this.notify(createImageElement,{options:e[r],range:t||this.getActiveSheet().selectedRange,isPublic:!0})},t.prototype.deleteImage=function(e,t){this.notify(deleteImage,{id:e,range:t||this.getActiveSheet().selectedRange})},t.prototype.getRowHeaderContent=function(){return this.sheetModule.getRowHeaderPanel()},t.prototype.getColumnHeaderContent=function(){return this.sheetModule.getColHeaderPanel()},t.prototype.getMainContent=function(){return this.sheetModule.getContentPanel()},t.prototype.getSelectAllContent=function(){return this.sheetModule.getSelectAllContent()},t.prototype.getScrollElement=function(){return this.sheetModule.getScrollElement()},t.prototype.getContentTable=function(){return this.sheetModule.getContentTable()},t.prototype.getRowHeaderTable=function(){return this.sheetModule.getRowHeaderTable()},t.prototype.getColHeaderTable=function(){return this.sheetModule.getColHeaderTable()},t.prototype.getThreshold=function(e){var t=Math.round((this.viewport[e+"Count"]+1)/2);return t<15?15:t},t.prototype.isMobileView=function(){return(this.cssClass.indexOf("e-mobile-view")>-1||ej2Base.Browser.isDevice)&&-1===this.cssClass.indexOf("e-desktop-view")&&!1},t.prototype.getValueRowCol=function(t,r,n,i,o){return e.prototype.getValueRowCol.call(this,t,r,n,i,o)},t.prototype.updateCell=function(t,r){r=r||this.getActiveSheet().activeCell,e.prototype.updateCell.call(this,t,r)},t.prototype.getRowData=function(t,r){return e.prototype.getRowData.call(this,t,r)},t.prototype.sort=function(t,r){var n=this;return this.allowSorting?e.prototype.sort.call(this,t,r).then(function(e){return n.notify(sortComplete,e),Promise.resolve(e)}):Promise.reject()},t.prototype.setValueRowCol=function(t,r,n,i,o){if("circular reference: "===r){var a={action:"isCircularReference",argValue:r};this.notify(formulaOperation,a),r=a.argValue}e.prototype.setValueRowCol.call(this,t,r,n,i,o),this.notify(editOperation,{action:"refreshDependentCellValue",rowIdx:n,colIdx:i,sheetIdx:getSheetIndexFromId(this,t)})},t.prototype.getModuleName=function(){return"spreadsheet"},t.prototype.refreshNode=function(e,t){var r;if(e){if(t){if(t.result=ej2Base.isNullOrUndefined(t.result)?"":t.result.toString(),!t.isRowFill){var n=ej2Base.select(".e-fill",e);n&&(ej2Base.detach(n),e.style.display="table-cell");var i=ej2Base.select(".e-fill-sec",e);i&&ej2Base.detach(i)}var o=ej2Base.select("#"+this.element.id+"_currency",e);if(o&&ej2Base.detach(o),"Accounting"===t.type&&isNumber(t.value))return e.querySelector("a")?e.querySelector("a").textContent=t.result.split(t.curSymbol).join(""):e.innerHTML="",e.appendChild(this.createElement("span",{id:this.element.id+"_currency",innerHTML:""+t.curSymbol,styles:"float: left"})),e.querySelector("a")||(e.innerHTML+=t.result.split(t.curSymbol).join("")),void e.classList.add("e-right-align");var a=void 0;!t.result||"true"!==t.result.toLowerCase()&&"false"!==t.result.toLowerCase()?a="e-right-align":(t.result=t.result.toUpperCase(),a="e-center-align",t.isRightAlign=!0),r=t.result,t.isRightAlign?e.classList.add(a):e.classList.remove(a)}r=ej2Base.isNullOrUndefined(r)?"":r;var s=e.lastChild;e.querySelector(".e-databar-value")&&(s=e.querySelector(".e-databar-value").lastChild),e.querySelector(".e-hyperlink")&&(s=e.querySelector(".e-hyperlink").lastChild);var l=e.querySelector(".e-wrap-content");l&&(l.lastChild||l.appendChild(document.createTextNode("")),s=l.lastChild),!s||3!==s.nodeType&&1!==s.nodeType?e.appendChild(document.createTextNode(r)):t.isRowFill||(s.nodeValue=r)}},t.prototype.calculateHeight=function(e,t,r){void 0===t&&(t=1),void 0===r&&(r=1);var n=e&&e.fontSize||this.cellStyle.fontSize,i="Arial Black"===e.fontFamily?1.44:1.24;return(n.indexOf("pt")>-1?1.33*parseInt(n,10):parseInt(n,10))*i*t+r*i},t.prototype.skipHidden=function(e,t,r,n){void 0===r&&(r="rows"),void 0===n&&(n=this.scrollSettings.isFinite);var i,o=this.getActiveSheet();n&&(i=("rows"===r?o.rowCount:o.colCount)-1);for(var a=e;a<=t;a++)if(o[r][a]&&o[r][a].hidden){if(o.frozenColumns||o.frozenRows){"rows"===r?setRow(o,a,{hidden:!1}):setColumn(o,a,{hidden:!1});continue}if(e===a&&e++,t++,i&&t>i){t=i;break}}return[e,t]},t.prototype.updateActiveBorder=function(e,t){void 0===t&&(t=".e-ribbon");var r=ej2Base.select(t+" .e-tab-header .e-indicator",this.element);r.style.display="none",ej2Base.setStyleAttribute(r,{left:"",right:""}),ej2Base.setStyleAttribute(r,{left:e.offsetLeft+"px",right:e.parentElement.offsetWidth-(e.offsetLeft+e.offsetWidth)+"px"}),r.style.display=""},t.prototype.undo=function(){this.notify(performUndoRedo,{isUndo:!0,isPublic:!0})},t.prototype.redo=function(){this.notify(performUndoRedo,{isUndo:!1,isPublic:!0})},t.prototype.updateUndoRedoCollection=function(e){this.notify(updateUndoRedoCollection,{args:e,isPublic:!0})},t.prototype.addDefinedName=function(e){var t={action:"addDefinedName",isAdded:!1,definedName:e};return this.notify(formulaOperation,t),t.isAdded},t.prototype.removeDefinedName=function(t,r){return e.prototype.removeDefinedName.call(this,t,r)},t.prototype.mouseClickHandler=function(e){this.notify(click,e)},t.prototype.mouseDownHandler=function(e){this.notify(mouseDown,e)},t.prototype.keyUpHandler=function(e){ej2Base.closest(e.target,".e-find-dlg")?this.notify(findKeyUp,e):this.notify(keyUp,e)},t.prototype.keyDownHandler=function(e){ej2Base.closest(e.target,".e-findtool-dlg")||this.notify(keyDown,e)},t.prototype.freeze=function(e){var t={row:e.row,column:e.column,cancel:!1,sheetIndex:this.activeSheetIndex};if(this.notify(beginAction,{eventArgs:t,action:"freezePanes"}),!t.cancel){if(this.on(contentLoaded,this.freezePaneUpdated,this),e.row||e.column){var r=!1;if(this.notify(getFilteredCollection,null),this.filterCollection)for(var n=0,i=this.filterCollection.length;n<i;n++)if(this.filterCollection[n].sheetIndex===this.activeSheetIndex){r=!0;break}r&&this.clearFilter()}this.freezePanes(e.row,e.column),this.notify(refreshRibbonIcons,null)}},t.prototype.freezePaneUpdated=function(){this.off(contentLoaded,this.freezePaneUpdated);var e=this.getActiveSheet();this.notify(completeAction,{eventArgs:{row:e.frozenRows,column:e.frozenColumns,sheetIndex:this.activeSheetIndex},action:"freezePanes"})},t.prototype.wireEvents=function(){ej2Base.EventHandler.add(this.element,"click",this.mouseClickHandler,this),ej2Base.EventHandler.add(this.element,getStartEvent(),this.mouseDownHandler,this),ej2Base.EventHandler.add(this.element,"keyup",this.keyUpHandler,this),ej2Base.EventHandler.add(this.element,"keydown",this.keyDownHandler,this),ej2Base.EventHandler.add(this.element,"noderefresh",this.refreshNode,this),this.on(freeze,this.freeze,this),this.on(refreshInsertDelete,this.refreshInsertDelete,this)},t.prototype.destroy=function(){this[isReact]&&this[clearTemplate](),this.unwireEvents(),this.notify(spreadsheetDestroyed,null),e.prototype.destroy.call(this),this.element.innerHTML="",this.element.removeAttribute("tabindex"),this.element.removeAttribute("role"),this.element.style.removeProperty("height"),this.element.style.removeProperty("width"),this.element.style.removeProperty("min-height"),this.element.style.removeProperty("min-width")},t.prototype.unwireEvents=function(){ej2Base.EventHandler.remove(this.element,"click",this.mouseClickHandler),ej2Base.EventHandler.remove(this.element,getStartEvent(),this.mouseDownHandler),ej2Base.EventHandler.remove(this.element,"keyup",this.keyUpHandler),ej2Base.EventHandler.remove(this.element,"keydown",this.keyDownHandler),ej2Base.EventHandler.remove(this.element,"noderefresh",this.refreshNode),this.off(freeze,this.freeze),this.off(refreshInsertDelete,this.refreshInsertDelete)},t.prototype.refreshInsertDelete=function(e){var t,r=this;e.sheet.ranges.forEach(function(n){n.template&&n.address&&(t=getRangeIndexes(n.address),r.updateRangeOnInsertDelete(e,t)&&(n.address=getRangeAddress(t)))}),this.setSheetPropertyOnMute(e.sheet,"ranges",e.sheet.ranges)},t.prototype.addContextMenuItems=function(e,t,r,n){void 0===r&&(r=!0),this.notify(addContextMenuItems,{items:e,text:t,insertAfter:r,isUniqueId:n})},t.prototype.removeContextMenuItems=function(e,t){this.notify(removeContextMenuItems,{items:e,isUniqueId:t})},t.prototype.enableContextMenuItems=function(e,t,r){void 0===t&&(t=!0),this.notify(enableContextMenuItems,{items:e,enable:t,isUniqueId:r})},t.prototype.enableFileMenuItems=function(e,t,r){void 0===t&&(t=!0),this.notify(enableFileMenuItems,{items:e,enable:t,isUniqueId:r})},t.prototype.hideFileMenuItems=function(e,t,r){void 0===t&&(t=!0),this.notify(hideFileMenuItems,{items:e,hide:t,isUniqueId:r})},t.prototype.addFileMenuItems=function(e,t,r,n){void 0===r&&(r=!0),this.notify(addFileMenuItems,{items:e,text:t,insertAfter:r,isUniqueId:n})},t.prototype.hideRibbonTabs=function(e,t){void 0===t&&(t=!0),this.notify(hideRibbonTabs,{tabs:e,hide:t})},t.prototype.enableRibbonTabs=function(e,t){void 0===t&&(t=!0),this.notify(enableRibbonTabs,{tabs:e,enable:t})},t.prototype.addRibbonTabs=function(e,t){this.notify(addRibbonTabs,{items:e,insertBefore:t})},t.prototype.enableToolbarItems=function(e,t,r){this.notify(enableToolbarItems,[{tab:e,items:t,enable:void 0===r||r}])},t.prototype.hideToolbarItems=function(e,t,r){void 0===r&&(r=!0),this.notify(hideToolbarItems,{tab:e,indexes:t,hide:r})},t.prototype.addToolbarItems=function(e,t,r){this.notify(addToolbarItems,{tab:e,items:t,index:r})},t.prototype.selectRange=function(e){this.notify(selectRange,{address:e})},t.prototype.startEdit=function(){this.notify(editOperation,{action:"startEdit",isNewValueEdit:!1})},t.prototype.closeEdit=function(){this.notify(editOperation,{action:"cancelEdit"})},t.prototype.endEdit=function(){this.notify(editOperation,{action:"endEdit"})},t.prototype.onPropertyChanged=function(t,r){var n=this;e.prototype.onPropertyChanged.call(this,t,r);for(var i=0,o=Object.keys(t);i<o.length;i++){var a=void 0,s=void 0;switch(o[i]){case"enableRtl":if((a=this.getColumnHeaderContent())&&(a=a.parentElement),!a)break;t.enableRtl?(a.style.marginLeft=getScrollBarWidth()+"px",a.style.marginRight="",document.getElementById(this.element.id+"_sheet_panel").classList.add("e-rtl")):(a.style.marginRight=getScrollBarWidth()+"px",a.style.marginLeft="",document.getElementById(this.element.id+"_sheet_panel").classList.remove("e-rtl")),-1===Object.keys(t).indexOf("locale")&&this.renderModule.refreshSheet();break;case"cssClass":r.cssClass&&ej2Base.removeClass([this.element],r.cssClass.split(" ")),t.cssClass&&ej2Base.addClass([this.element],t.cssClass.split(" "));break;case"activeSheetIndex":this.renderModule.refreshSheet(),this.notify(activeSheetChanged,{idx:t.activeSheetIndex});break;case"width":this.setWidth(),this.resize();break;case"height":this.setHeight(),this.resize();break;case"showRibbon":this.notify(ribbon,{uiUpdate:!0});break;case"showFormulaBar":this.notify(formulaBar,{uiUpdate:!0});break;case"showSheetTabs":this.notify(sheetTabs,null);break;case"cellStyle":this.renderModule.refreshSheet();break;case"allowEditing":if(this.allowEditing&&(this.notify(editOperation,{action:"renderEditor"}),this.enableKeyboardNavigation)){this.enableKeyboardNavigation=!1,this.dataBind(),this.enableKeyboardNavigation=!0,this.dataBind();var l=this.selectionSettings.mode;"None"!==l&&(this.selectionSettings.mode="None",this.dataBind(),this.selectionSettings.mode=l,this.dataBind())}break;case"allowInsert":(s=this.element.getElementsByClassName("e-add-sheet-tab")[0])&&(s.disabled=!this.allowInsert,this.allowInsert?s.classList.contains("e-disabled")&&s.classList.remove("e-disabled"):s.classList.contains("e-disabled")||s.classList.add("e-disabled"));break;case"sheets":if(t.sheets===this.sheets){this.renderModule.refreshSheet(),this.notify(refreshSheetTabs,null);break}Object.keys(t.sheets).forEach(function(e,i){var o=t.sheets[e];if(o.ranges&&Object.keys(o.ranges).length){var a,s=Object.keys(o.ranges);s.forEach(function(e,t){o.ranges[e].info||(a=t)}),s.forEach(function(t,r){o.ranges[t].dataSource&&(ej2Base.isUndefined(a)||!ej2Base.isUndefined(a)&&a===r)&&n.notify(dataSourceChanged,{sheetIdx:e,rangeIdx:t,isLastRange:s.length-1===r,changedData:o.ranges[t].dataSource})})}else if(o.paneTopLeftCell&&r.sheets&&r.sheets[e]&&r.sheets[e].paneTopLeftCell){if(n.activeSheetIndex!==Number(e))return;var l=getCellIndexes(o.paneTopLeftCell),d=getCellIndexes(r.sheets[e].paneTopLeftCell);if(l[0]!==d[0]){var p=n.frozenRowCount(n.getActiveSheet()),h=l[0]>p?getRowsHeight(n.getActiveSheet(),p,l[0]-1):0;n.notify(updateScroll,{top:h})}if(l[1]!==d[1]){var c=n.frozenColCount(n.getActiveSheet()),u=l[1]>c?getColumnsWidth(n.getActiveSheet(),c,l[1]-1):0;n.notify(updateScroll,{left:u})}}else 0===i&&n.renderModule.refreshSheet(),n.showSheetTabs&&o.name&&n.notify(sheetNameUpdate,{items:n.element.querySelector(".e-sheet-tabs-items").children[e],value:o.name,idx:e})});break;case"locale":this.refresh();break;case"password":this.password.length>0&&this.showSheetTabs&&(this.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled"));break;case"isProtected":if(this.isProtected){var d=this.element.getElementsByClassName("e-add-sheet-tab")[0];d&&(d.disabled=this.isProtected,this.isProtected?d.classList.contains("e-disabled")&&d.classList.add("e-disabled"):d.classList.contains("e-disabled")||d.classList.remove("e-disabled"))}}}},t.prototype.requiredModules=function(){return getRequiredModules(this)},t.prototype.appendTo=function(t){e.prototype.appendTo.call(this,t)},t.prototype.filter=function(t,r){return this.allowFiltering?(r=r||this.getActiveSheet().selectedRange,e.prototype.filter.call(this,t,r)):Promise.reject()},t.prototype.clearFilter=function(e){this.notify(clearFilter,{field:e})},t.prototype.applyFilter=function(e,t){if(!this.allowFiltering)return Promise.reject();var r={predicates:e,range:t,isInternal:!0,promise:new Promise(function(e,t){e(void 0)})};return this.notify(initiateFilterUI,r),r.promise},t.prototype.addCustomFunction=function(t,r){e.prototype.addCustomFunction.call(this,t,r),this.notify(refreshFormulaDatasource,null)};var r;return __decorate$9([ej2Base.Property("")],t.prototype,"cssClass",void 0),__decorate$9([ej2Base.Property(!0)],t.prototype,"allowScrolling",void 0),__decorate$9([ej2Base.Property(!0)],t.prototype,"allowResizing",void 0),__decorate$9([ej2Base.Property(!0)],t.prototype,"showAggregate",void 0),__decorate$9([ej2Base.Property(!0)],t.prototype,"enableClipboard",void 0),__decorate$9([ej2Base.Property(!0)],t.prototype,"enableContextMenu",void 0),__decorate$9([ej2Base.Property(!0)],t.prototype,"enableKeyboardNavigation",void 0),__decorate$9([ej2Base.Property(!0)],t.prototype,"enableKeyboardShortcut",void 0),__decorate$9([ej2Base.Property(!0)],t.prototype,"allowUndoRedo",void 0),__decorate$9([ej2Base.Property(!0)],t.prototype,"allowWrap",void 0),__decorate$9([ej2Base.Complex({},SelectionSettings)],t.prototype,"selectionSettings",void 0),__decorate$9([ej2Base.Complex({},ScrollSettings)],t.prototype,"scrollSettings",void 0),__decorate$9([ej2Base.Event()],t.prototype,"beforeCellRender",void 0),__decorate$9([ej2Base.Event()],t.prototype,"beforeSelect",void 0),__decorate$9([ej2Base.Event()],t.prototype,"select",void 0),__decorate$9([ej2Base.Event()],t.prototype,"contextMenuBeforeOpen",void 0),__decorate$9([ej2Base.Event()],t.prototype,"fileMenuBeforeOpen",void 0),__decorate$9([ej2Base.Event()],t.prototype,"contextMenuBeforeClose",void 0),__decorate$9([ej2Base.Event()],t.prototype,"dialogBeforeOpen",void 0),__decorate$9([ej2Base.Event()],t.prototype,"fileMenuBeforeClose",void 0),__decorate$9([ej2Base.Event()],t.prototype,"contextMenuItemSelect",void 0),__decorate$9([ej2Base.Event()],t.prototype,"fileMenuItemSelect",void 0),__decorate$9([ej2Base.Event()],t.prototype,"beforeDataBound",void 0),__decorate$9([ej2Base.Event()],t.prototype,"dataBound",void 0),__decorate$9([ej2Base.Event()],t.prototype,"dataSourceChanged",void 0),__decorate$9([ej2Base.Event()],t.prototype,"cellEdit",void 0),__decorate$9([ej2Base.Event()],t.prototype,"cellEditing",void 0),__decorate$9([ej2Base.Event()],t.prototype,"cellSave",void 0),__decorate$9([ej2Base.Event()],t.prototype,"beforeCellSave",void 0),__decorate$9([ej2Base.Event()],t.prototype,"created",void 0),__decorate$9([ej2Base.Event()],t.prototype,"beforeSort",void 0),__decorate$9([ej2Base.Event()],t.prototype,"beforeHyperlinkCreate",void 0),__decorate$9([ej2Base.Event()],t.prototype,"afterHyperlinkCreate",void 0),__decorate$9([ej2Base.Event()],t.prototype,"beforeHyperlinkClick",void 0),__decorate$9([ej2Base.Event()],t.prototype,"afterHyperlinkClick",void 0),__decorate$9([ej2Base.Event()],t.prototype,"beforeConditionalFormat",void 0),__decorate$9([ej2Base.Event()],t.prototype,"actionBegin",void 0),__decorate$9([ej2Base.Event()],t.prototype,"actionComplete",void 0),__decorate$9([ej2Base.Event()],t.prototype,"openComplete",void 0),__decorate$9([ej2Base.Event()],t.prototype,"sortComplete",void 0),t=r=__decorate$9([ej2Base.NotifyPropertyChanges],t)}(Workbook);exports.Workbook=Workbook,exports.Range=Range,exports.UsedRange=UsedRange,exports.Sheet=Sheet,exports.getSheetIndex=getSheetIndex,exports.getSheetIndexFromId=getSheetIndexFromId,exports.getSheetNameFromAddress=getSheetNameFromAddress,exports.getSheetIndexByName=getSheetIndexByName,exports.updateSelectedRange=updateSelectedRange,exports.getSelectedRange=getSelectedRange,exports.getSingleSelectedRange=getSingleSelectedRange,exports.getSheet=getSheet,exports.getSheetNameCount=getSheetNameCount,exports.getMaxSheetId=getMaxSheetId,exports.initSheet=initSheet,exports.getSheetName=getSheetName,exports.moveSheet=moveSheet,exports.duplicateSheet=duplicateSheet,exports.Row=Row,exports.getRow=getRow,exports.setRow=setRow,exports.isHiddenRow=isHiddenRow,exports.getRowHeight=getRowHeight,exports.setRowHeight=setRowHeight,exports.getRowsHeight=getRowsHeight,exports.Column=Column,exports.getColumn=getColumn,exports.setColumn=setColumn,exports.getColumnWidth=getColumnWidth,exports.getColumnsWidth=getColumnsWidth,exports.isHiddenCol=isHiddenCol,exports.Cell=Cell,exports.getCell=getCell,exports.setCell=setCell,exports.skipDefaultValue=skipDefaultValue,exports.wrap=wrap,exports.getColorCode=getColorCode,exports.getCustomColors=getCustomColors,exports.getData=getData,exports.getModel=getModel,exports.processIdx=processIdx,exports.getRangeIndexes=getRangeIndexes,exports.getCellIndexes=getCellIndexes,exports.getColIndex=getColIndex,exports.getCellAddress=getCellAddress,exports.getRangeAddress=getRangeAddress,exports.getColumnHeaderText=getColumnHeaderText,exports.getIndexesFromAddress=getIndexesFromAddress,exports.getRangeFromAddress=getRangeFromAddress,exports.getAddressFromSelectedRange=getAddressFromSelectedRange,exports.getAddressInfo=getAddressInfo,exports.getSwapRange=getSwapRange,exports.isSingleCell=isSingleCell,exports.executeTaskAsync=executeTaskAsync,exports.WorkbookBasicModule=WorkbookBasicModule,exports.WorkbookAllModule=WorkbookAllModule,exports.getWorkbookRequiredModules=getWorkbookRequiredModules,exports.CellStyle=CellStyle,exports.FilterCollection=FilterCollection,exports.SortCollection=SortCollection,exports.DefineName=DefineName,exports.ProtectSettings=ProtectSettings,exports.Hyperlink=Hyperlink,exports.Validation=Validation,exports.Format=Format,exports.ConditionalFormat=ConditionalFormat,exports.LegendSettings=LegendSettings,exports.DataLabelSettings=DataLabelSettings,exports.MajorGridLines=MajorGridLines,exports.MinorGridLines=MinorGridLines,exports.Axis=Axis,exports.Chart=Chart$1,exports.Image=Image,exports.AutoFillSettings=AutoFillSettings,exports.workbookDestroyed=workbookDestroyed,exports.updateSheetFromDataSource=updateSheetFromDataSource,exports.dataSourceChanged=dataSourceChanged,exports.dataChanged=dataChanged,exports.triggerDataChange=triggerDataChange,exports.workbookOpen=workbookOpen,exports.beginSave=beginSave,exports.sortImport=sortImport,exports.ribbonFind=ribbonFind,exports.exportDialog=exportDialog,exports.getFilteredCollection=getFilteredCollection,exports.saveCompleted=saveCompleted,exports.applyNumberFormatting=applyNumberFormatting,exports.getFormattedCellObject=getFormattedCellObject,exports.refreshCellElement=refreshCellElement,exports.setCellFormat=setCellFormat,exports.findAllValues=findAllValues,exports.textDecorationUpdate=textDecorationUpdate,exports.applyCellFormat=applyCellFormat,exports.updateUsedRange=updateUsedRange,exports.updateRowColCount=updateRowColCount,exports.workbookFormulaOperation=workbookFormulaOperation,exports.workbookEditOperation=workbookEditOperation,exports.checkDateFormat=checkDateFormat,exports.getFormattedBarText=getFormattedBarText,exports.activeCellChanged=activeCellChanged,exports.openSuccess=openSuccess,exports.openFailure=openFailure,exports.sheetCreated=sheetCreated,exports.sheetsDestroyed=sheetsDestroyed,exports.aggregateComputation=aggregateComputation,exports.getUniqueRange=getUniqueRange,exports.removeUniquecol=removeUniquecol,exports.checkUniqueRange=checkUniqueRange,exports.reApplyFormula=reApplyFormula,exports.clearFormulaDependentCells=clearFormulaDependentCells,exports.getFormulaInfoTable=getFormulaInfoTable,exports.formulaInValidation=formulaInValidation,exports.beforeSort=beforeSort,exports.initiateSort=initiateSort,exports.sortComplete=sortComplete,exports.sortRangeAlert=sortRangeAlert,exports.initiatelink=initiatelink,exports.beforeHyperlinkCreate=beforeHyperlinkCreate,exports.afterHyperlinkCreate=afterHyperlinkCreate,exports.beforeHyperlinkClick=beforeHyperlinkClick,exports.afterHyperlinkClick=afterHyperlinkClick,exports.addHyperlink=addHyperlink,exports.setLinkModel=setLinkModel,exports.beforeFilter=beforeFilter,exports.initiateFilter=initiateFilter,exports.filterComplete=filterComplete,exports.filterRangeAlert=filterRangeAlert,exports.clearAllFilter=clearAllFilter,exports.wrapEvent=wrapEvent,exports.onSave=onSave,exports.insert=insert,exports.deleteAction=deleteAction,exports.insertModel=insertModel,exports.deleteModel=deleteModel,exports.isValidation=isValidation,exports.cellValidation=cellValidation,exports.addHighlight=addHighlight,exports.dataValidate=dataValidate,exports.findNext=findNext,exports.findPrevious=findPrevious,exports.goto=goto,exports.findWorkbookHandler=findWorkbookHandler,exports.replaceHandler=replaceHandler,exports.replaceAllHandler=replaceAllHandler,exports.showDialog=showDialog,exports.findKeyUp=findKeyUp,exports.removeHighlight=removeHighlight,exports.queryCellInfo=queryCellInfo,exports.count=count,exports.findCount=findCount,exports.protectSheetWorkBook=protectSheetWorkBook,exports.updateToggle=updateToggle,exports.protectsheetHandler=protectsheetHandler,exports.replaceAllDialog=replaceAllDialog,exports.unprotectsheetHandler=unprotectsheetHandler,exports.workBookeditAlert=workBookeditAlert,exports.setLockCells=setLockCells,exports.applyLockCells=applyLockCells,exports.setMerge=setMerge,exports.applyMerge=applyMerge,exports.mergedRange=mergedRange,exports.activeCellMergedRange=activeCellMergedRange,exports.insertMerge=insertMerge,exports.pasteMerge=pasteMerge,exports.hideShow=hideShow,exports.setCFRule=setCFRule,exports.cFInitialCheck=cFInitialCheck,exports.clearCFRule=clearCFRule,exports.initiateClearCFRule=initiateClearCFRule,exports.cFRender=cFRender,exports.clear=clear,exports.clearCF=clearCF,exports.clearCells=clearCells,exports.setImage=setImage,exports.setChart=setChart,exports.initiateChart=initiateChart,exports.refreshRibbonIcons=refreshRibbonIcons,exports.refreshChart=refreshChart,exports.refreshChartSize=refreshChartSize,exports.updateChart=updateChart,exports.deleteChartColl=deleteChartColl,exports.initiateChartModel=initiateChartModel,exports.focusChartBorder=focusChartBorder,exports.saveError=saveError,exports.validationHighlight=validationHighlight,exports.dataRefresh=dataRefresh,exports.updateFilter=updateFilter,exports.beforeInsert=beforeInsert,exports.beforeDelete=beforeDelete,exports.deleteHyperlink=deleteHyperlink,exports.moveOrDuplicateSheet=moveOrDuplicateSheet,exports.setAutoFill=setAutoFill,exports.refreshCell=refreshCell,exports.getFillInfo=getFillInfo,exports.getautofillDDB=getautofillDDB,exports.rowFillHandler=rowFillHandler,exports.getTextSpace=getTextSpace,exports.updateCustomFormatsFromImport=updateCustomFormatsFromImport,exports.cFUndo=cFUndo,exports.refreshClipboard=refreshClipboard,exports.updateView=updateView,exports.selectionComplete=selectionComplete,exports.refreshInsertDelete=refreshInsertDelete,exports.checkConditionalFormat=checkConditionalFormat,exports.beforeCellUpdate=beforeCellUpdate,exports.checkIsFormula=checkIsFormula,exports.isCellReference=isCellReference,exports.isChar=isChar,exports.isRowSelected=isRowSelected,exports.isColumnSelected=isColumnSelected,exports.inRange=inRange,exports.isInRange=isInRange,exports.isLocked=isLocked,exports.isValidCellReference=isValidCellReference,exports.getUpdatedFormula=getUpdatedFormula,exports.updateCell=updateCell,exports.getDataRange=getDataRange,exports.toFraction=toFraction,exports.getGcd=getGcd,exports.intToDate=intToDate,exports.dateToInt=dateToInt,exports.isDateTime=isDateTime,exports.isNumber=isNumber,exports.toDate=toDate,exports.parseIntValue=parseIntValue,exports.workbookLocale=workbookLocale,exports.localeData=localeData,exports.DataBind=DataBind,exports.WorkbookOpen=WorkbookOpen,exports.WorkbookSave=WorkbookSave,exports.WorkbookFormula=WorkbookFormula,exports.WorkbookNumberFormat=WorkbookNumberFormat,exports.getFormatFromType=getFormatFromType,exports.getTypeFromFormat=getTypeFromFormat,exports.WorkbookSort=WorkbookSort,exports.WorkbookFilter=WorkbookFilter,exports.WorkbookImage=WorkbookImage,exports.WorkbookChart=WorkbookChart,exports.WorkbookCellFormat=WorkbookCellFormat,exports.WorkbookEdit=WorkbookEdit,exports.WorkbookHyperlink=WorkbookHyperlink,exports.WorkbookInsert=WorkbookInsert,exports.WorkbookDelete=WorkbookDelete,exports.WorkbookDataValidation=WorkbookDataValidation,exports.WorkbookFindAndReplace=WorkbookFindAndReplace,exports.WorkbookProtectSheet=WorkbookProtectSheet,exports.WorkbookMerge=WorkbookMerge,exports.WorkbookConditionalFormat=WorkbookConditionalFormat,exports.WorkbookAutoFill=WorkbookAutoFill,exports.getRequiredModules=getRequiredModules,exports.ribbon=ribbon,exports.formulaBar=formulaBar,exports.sheetTabs=sheetTabs,exports.refreshSheetTabs=refreshSheetTabs,exports.isFormulaBarEdit=isFormulaBarEdit,exports.initialLoad=initialLoad,exports.contentLoaded=contentLoaded,exports.mouseDown=mouseDown,exports.spreadsheetDestroyed=spreadsheetDestroyed,exports.editOperation=editOperation,exports.formulaOperation=formulaOperation,exports.formulaBarOperation=formulaBarOperation,exports.click=click,exports.keyUp=keyUp,exports.keyDown=keyDown,exports.formulaKeyUp=formulaKeyUp,exports.formulaBarUpdate=formulaBarUpdate,exports.onVerticalScroll=onVerticalScroll,exports.onHorizontalScroll=onHorizontalScroll,exports.beforeContentLoaded=beforeContentLoaded,exports.beforeVirtualContentLoaded=beforeVirtualContentLoaded,exports.virtualContentLoaded=virtualContentLoaded,exports.contextMenuOpen=contextMenuOpen,exports.cellNavigate=cellNavigate,exports.mouseUpAfterSelection=mouseUpAfterSelection,exports.cMenuBeforeOpen=cMenuBeforeOpen,exports.insertSheetTab=insertSheetTab,exports.removeSheetTab=removeSheetTab,exports.renameSheetTab=renameSheetTab,exports.ribbonClick=ribbonClick,exports.refreshRibbon=refreshRibbon,exports.enableToolbarItems=enableToolbarItems,exports.tabSwitch=tabSwitch,exports.selectRange=selectRange,exports.cut=cut,exports.copy=copy,exports.paste=paste,exports.clearCopy=clearCopy,exports.dataBound=dataBound,exports.beforeDataBound=beforeDataBound,exports.addContextMenuItems=addContextMenuItems,exports.removeContextMenuItems=removeContextMenuItems,exports.enableContextMenuItems=enableContextMenuItems,exports.enableFileMenuItems=enableFileMenuItems,exports.hideFileMenuItems=hideFileMenuItems,exports.addFileMenuItems=addFileMenuItems,exports.hideRibbonTabs=hideRibbonTabs,exports.enableRibbonTabs=enableRibbonTabs,exports.addRibbonTabs=addRibbonTabs,exports.addToolbarItems=addToolbarItems,exports.hideToolbarItems=hideToolbarItems,exports.beforeRibbonCreate=beforeRibbonCreate,exports.rowHeightChanged=rowHeightChanged,exports.colWidthChanged=colWidthChanged,exports.onContentScroll=onContentScroll,exports.deInitProperties=deInitProperties,exports.activeSheetChanged=activeSheetChanged,exports.renameSheet=renameSheet,exports.initiateCustomSort=initiateCustomSort,exports.applySort=applySort,exports.collaborativeUpdate=collaborativeUpdate,exports.autoFit=autoFit,exports.updateToggleItem=updateToggleItem,exports.initiateHyperlink=initiateHyperlink,exports.editHyperlink=editHyperlink,exports.openHyperlink=openHyperlink,exports.removeHyperlink=removeHyperlink,exports.createHyperlinkElement=createHyperlinkElement,exports.sheetNameUpdate=sheetNameUpdate,exports.hideSheet=hideSheet,exports.performUndoRedo=performUndoRedo,exports.updateUndoRedoCollection=updateUndoRedoCollection,exports.setActionData=setActionData,exports.getBeforeActionData=getBeforeActionData,exports.clearUndoRedoCollection=clearUndoRedoCollection,exports.initiateFilterUI=initiateFilterUI,exports.renderFilterCell=renderFilterCell,exports.reapplyFilter=reapplyFilter,exports.filterByCellValue=filterByCellValue,exports.clearFilter=clearFilter,exports.getFilteredColumn=getFilteredColumn,exports.completeAction=completeAction,exports.beginAction=beginAction,exports.filterCellKeyDown=filterCellKeyDown,exports.getFilterRange=getFilterRange,exports.setAutoFit=setAutoFit,exports.refreshFormulaDatasource=refreshFormulaDatasource,exports.setScrollEvent=setScrollEvent,exports.initiateDataValidation=initiateDataValidation,exports.validationError=validationError,exports.startEdit=startEdit,exports.invalidData=invalidData,exports.clearInvalid=clearInvalid,exports.protectSheet=protectSheet,exports.applyProtect=applyProtect,exports.unprotectSheet=unprotectSheet,exports.protectCellFormat=protectCellFormat,exports.gotoDlg=gotoDlg,exports.findDlg=findDlg,exports.findHandler=findHandler,exports.replace=replace,exports.created=created,exports.editAlert=editAlert,exports.setUndoRedo=setUndoRedo,exports.enableFormulaInput=enableFormulaInput,exports.protectSelection=protectSelection,exports.hiddenMerge=hiddenMerge,exports.checkPrevMerge=checkPrevMerge,exports.checkMerge=checkMerge,exports.removeDataValidation=removeDataValidation,exports.showAggregate=showAggregate,exports.initiateConditionalFormat=initiateConditionalFormat,exports.setCF=setCF,exports.clearViewer=clearViewer,exports.initiateFormulaReference=initiateFormulaReference,exports.initiateCur=initiateCur,exports.clearCellRef=clearCellRef,exports.editValue=editValue,exports.addressHandle=addressHandle,exports.initiateEdit=initiateEdit,exports.forRefSelRender=forRefSelRender,exports.blankWorkbook=blankWorkbook,exports.insertImage=insertImage,exports.refreshImgElem=refreshImgElem,exports.refreshImgCellObj=refreshImgCellObj,exports.getRowIdxFromClientY=getRowIdxFromClientY,exports.getColIdxFromClientX=getColIdxFromClientX,exports.createImageElement=createImageElement,exports.deleteImage=deleteImage,exports.deleteChart=deleteChart,exports.refreshChartCellObj=refreshChartCellObj,exports.refreshImagePosition=refreshImagePosition,exports.updateTableWidth=updateTableWidth,exports.focusBorder=focusBorder,exports.clearChartBorder=clearChartBorder,exports.insertChart=insertChart,exports.chartRangeSelection=chartRangeSelection,exports.insertDesignChart=insertDesignChart,exports.removeDesignChart=removeDesignChart,exports.chartDesignTab=chartDesignTab,exports.addChartEle=addChartEle,exports.isReact=isReact,exports.renderReactTemplates=renderReactTemplates,exports.clearTemplate=clearTemplate,exports.protectWorkbook=protectWorkbook,exports.unProtectWorkbook=unProtectWorkbook,exports.getPassWord=getPassWord,exports.importProtectWorkbook=importProtectWorkbook,exports.selectionStatus=selectionStatus,exports.freeze=freeze,exports.overlayEleSize=overlayEleSize,exports.updateScroll=updateScroll,exports.positionAutoFillElement=positionAutoFillElement,exports.hideAutoFillOptions=hideAutoFillOptions,exports.performAutoFill=performAutoFill,exports.selectAutoFillRange=selectAutoFillRange,exports.autoFill=autoFill,exports.fillRange=fillRange,exports.UnProtectWorksheet=UnProtectWorksheet,exports.hideAutoFillElement=hideAutoFillElement,exports.unProtectSheetPassword=unProtectSheetPassword,exports.updateTranslate=updateTranslate,exports.getUpdatedScrollPosition=getUpdatedScrollPosition,exports.updateScrollValue=updateScrollValue,exports.getUpdateUsingRaf=getUpdateUsingRaf,exports.removeAllChildren=removeAllChildren,exports.getColGroupWidth=getColGroupWidth,exports.getScrollBarWidth=getScrollBarWidth,exports.getSiblingsHeight=getSiblingsHeight,exports.inView=inView,exports.getCellPosition=getCellPosition,exports.setPosition=setPosition,exports.removeRangeEle=removeRangeEle,exports.locateElem=locateElem,exports.setStyleAttribute=setStyleAttribute$1,exports.getStartEvent=getStartEvent,exports.getMoveEvent=getMoveEvent,exports.getEndEvent=getEndEvent,exports.isTouchStart=isTouchStart,exports.isTouchMove=isTouchMove,exports.isTouchEnd=isTouchEnd,exports.isMouseDown=isMouseDown,exports.isMouseMove=isMouseMove,exports.isMouseUp=isMouseUp,exports.getClientX=getClientX,exports.getClientY=getClientY,exports.getDPRValue=getDPRValue,exports.setAriaOptions=setAriaOptions,exports.destroyComponent=destroyComponent,exports.setResize=setResize,exports.setWidthAndHeight=setWidthAndHeight,exports.setTextLineHeight=setTextLineHeight,exports.findMaxValue=findMaxValue,exports.updateAction=updateAction,exports.hasTemplate=hasTemplate,exports.setRowEleHeight=setRowEleHeight,exports.getTextHeight=getTextHeight,exports.getLineHeight=getLineHeight,exports.getTextWidth=getTextWidth,exports.getLines=getLines,exports.getBorderHeight=getBorderHeight,exports.getExcludedColumnWidth=getExcludedColumnWidth,exports.getTextHeightWithBorder=getTextHeightWithBorder,exports.setMaxHgt=setMaxHgt,exports.getMaxHgt=getMaxHgt,exports.skipHiddenIdx=skipHiddenIdx,exports.focus=focus,exports.isLockedCells=isLockedCells,exports.isDiscontinuousRange=isDiscontinuousRange,exports.clearRange=clearRange,exports.BasicModule=BasicModule,exports.AllModule=AllModule,exports.ScrollSettings=ScrollSettings,exports.SelectionSettings=SelectionSettings,exports.DISABLED=DISABLED,exports.WRAPTEXT=WRAPTEXT,exports.locale=locale,exports.dialog=dialog,exports.actionEvents=actionEvents,exports.overlay=overlay,exports.fontColor=fontColor,exports.fillColor=fillColor,exports.keyCodes=keyCodes,exports.defaultLocale=defaultLocale,exports.Spreadsheet=Spreadsheet,exports.Clipboard=Clipboard,exports.Edit=Edit,exports.Selection=Selection,exports.Scroll=Scroll,exports.VirtualScroll=VirtualScroll,exports.KeyboardNavigation=KeyboardNavigation,exports.KeyboardShortcut=KeyboardShortcut,exports.CellFormat=CellFormat,exports.Resize=Resize,exports.CollaborativeEditing=CollaborativeEditing,exports.ShowHide=ShowHide,exports.SpreadsheetHyperlink=SpreadsheetHyperlink,exports.UndoRedo=UndoRedo,exports.WrapText=WrapText,exports.Insert=Insert,exports.Delete=Delete,exports.DataValidation=DataValidation,exports.ProtectSheet=ProtectSheet,exports.FindAndReplace=FindAndReplace,exports.Merge=Merge,exports.ConditionalFormatting=ConditionalFormatting,exports.AutoFill=AutoFill,exports.Ribbon=Ribbon$$1,exports.FormulaBar=FormulaBar,exports.Formula=Formula,exports.SheetTabs=SheetTabs,exports.Open=Open,exports.Save=Save,exports.ContextMenu=ContextMenu$1,exports.NumberFormat=NumberFormat,exports.Sort=Sort,exports.Filter=Filter,exports.SpreadsheetImage=SpreadsheetImage,exports.SpreadsheetChart=SpreadsheetChart,exports.Render=Render,exports.SheetRender=SheetRender,exports.RowRenderer=RowRenderer,exports.CellRenderer=CellRenderer,exports.Calculate=Calculate,exports.FormulaError=FormulaError,exports.FormulaInfo=FormulaInfo,exports.CalcSheetFamilyItem=CalcSheetFamilyItem,exports.getAlphalabel=getAlphalabel,exports.ValueChangedArgs=ValueChangedArgs,exports.Parser=Parser,exports.CalculateCommon=CalculateCommon,exports.isUndefined=isUndefined$1,exports.getSkeletonVal=getSkeletonVal,exports.getModules=getModules,exports.getValue=getValue$1,exports.setValue=setValue,exports.ModuleLoader=ModuleLoader,exports.BasicFormulas=BasicFormulas,Object.defineProperty(exports,"__esModule",{value:!0})});
//# sourceMappingURL=ej2-spreadsheet.umd.min.js.map
