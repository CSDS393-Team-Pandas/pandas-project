/*!
*  filename: ej2-pivotview.umd.min.js
*  version : 19.4.48
*  Copyright Syncfusion Inc. 2001 - 2020. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@syncfusion/ej2-base"),require("@syncfusion/ej2-data"),require("@syncfusion/ej2-popups"),require("@syncfusion/ej2-grids"),require("@syncfusion/ej2-navigations"),require("@syncfusion/ej2-inputs"),require("@syncfusion/ej2-dropdowns"),require("@syncfusion/ej2-calendars"),require("@syncfusion/ej2-splitbuttons"),require("@syncfusion/ej2-buttons"),require("@syncfusion/ej2-charts"),require("@syncfusion/ej2-excel-export"),require("@syncfusion/ej2-pdf-export")):"function"==typeof define&&define.amd?define(["exports","@syncfusion/ej2-base","@syncfusion/ej2-data","@syncfusion/ej2-popups","@syncfusion/ej2-grids","@syncfusion/ej2-navigations","@syncfusion/ej2-inputs","@syncfusion/ej2-dropdowns","@syncfusion/ej2-calendars","@syncfusion/ej2-splitbuttons","@syncfusion/ej2-buttons","@syncfusion/ej2-charts","@syncfusion/ej2-excel-export","@syncfusion/ej2-pdf-export"],t):t(e.ej={},e.ej2Base,e.ej2Data,e.ej2Popups,e.ej2Grids,e.ej2Navigations,e.ej2Inputs,e.ej2Dropdowns,e.ej2Calendars,e.ej2Splitbuttons,e.ej2Buttons,e.ej2Charts,e.ej2ExcelExport,e.ej2PdfExport)}(this,function(e,t,i,a,r,n,o,s,l,d,h,p,u,c){"use strict";var g=function(){function e(){}return e.getType=function(e){var t=new Date(e);return"boolean"==typeof e?"boolean":isNaN(Number(e))?t instanceof Date&&!isNaN(t.valueOf())?t&&t.getDay()&&(t.getHours()>0||t.getMinutes()>0||t.getSeconds()>0||t.getMilliseconds()>0)?"datetime":"date":typeof e:"number"},e.resetTime=function(e){return e.setHours(0,0,0,0),e},e.getClonedData=function(e){var t=[];if(e)for(var i=0,a=e;i<a.length;i++){for(var r=a[i],n=Object.keys(r),o=0,s={};o<n.length;)s[n[o]]=r[n[o]],o++;t.push(s)}return t},e.getDefinedObj=function(e){var t=0,i={};if(null!==e&&void 0!==e)for(var a=Object.keys(e);t<a.length;)null!==e[a[t]]&&void 0!==e[a[t]]&&(i[a[t]]=e[a[t]]),t++;else i=e;return i},e.inArray=function(e,t){if(t)for(var i=0,a=t.length;i<a;i++)if(t[i]===e)return i;return-1},e.setPivotProperties=function(e,t){e.allowServerDataBinding=!1,e.pivotGridModule&&(e.pivotGridModule.allowServerDataBinding=!1),e.setProperties(t,!0),e.allowServerDataBinding=!0,e.pivotGridModule&&(e.pivotGridModule.allowServerDataBinding=!0)},e.getClonedDataSourceSettings=function(e){return this.getDefinedObj({type:e.type,catalog:e.catalog,cube:e.cube,providerType:e.providerType,url:e.url,localeIdentifier:e.localeIdentifier,excludeFields:t.isNullOrUndefined(e.excludeFields)?[]:e.excludeFields.slice(),expandAll:e.expandAll,allowLabelFilter:e.allowLabelFilter,allowValueFilter:e.allowValueFilter,allowMemberFilter:e.allowMemberFilter,enableSorting:!!e.enableSorting,rows:this.cloneFieldSettings(e.rows),columns:this.cloneFieldSettings(e.columns),filters:this.cloneFieldSettings(e.filters),values:this.cloneFieldSettings(e.values),filterSettings:this.cloneFilterSettings(e.filterSettings),sortSettings:this.cloneSortSettings(e.sortSettings),drilledMembers:this.cloneDrillMemberSettings(e.drilledMembers),valueSortSettings:this.CloneValueSortObject(e.valueSortSettings),valueAxis:e.valueAxis,grandTotalsPosition:e.grandTotalsPosition,formatSettings:this.cloneFormatSettings(e.formatSettings),calculatedFieldSettings:this.cloneCalculatedFieldSettings(e.calculatedFieldSettings),fieldMapping:this.cloneFieldSettings(e.fieldMapping),showSubTotals:e.showSubTotals,showRowSubTotals:e.showRowSubTotals,showColumnSubTotals:e.showColumnSubTotals,showGrandTotals:e.showGrandTotals,showRowGrandTotals:e.showRowGrandTotals,showColumnGrandTotals:e.showColumnGrandTotals,showHeaderWhenEmpty:e.showHeaderWhenEmpty,alwaysShowValueHeader:e.alwaysShowValueHeader,conditionalFormatSettings:this.cloneConditionalFormattingSettings(e.conditionalFormatSettings),emptyCellsTextContent:e.emptyCellsTextContent,groupSettings:this.cloneGroupSettings(e.groupSettings),showAggregationOnValueField:e.showAggregationOnValueField,authentication:this.CloneAuthenticationObject(e.authentication)})},e.updateDataSourceSettings=function(e,i){e&&this.setPivotProperties(e,{dataSourceSettings:this.getDefinedObj({type:i.type,catalog:i.catalog,cube:i.cube,providerType:i.providerType,url:i.url,localeIdentifier:i.localeIdentifier,excludeFields:t.isNullOrUndefined(i.excludeFields)?[]:i.excludeFields,expandAll:i.expandAll,allowLabelFilter:i.allowLabelFilter,allowValueFilter:i.allowValueFilter,allowMemberFilter:i.allowMemberFilter,enableSorting:!!i.enableSorting,rows:i.rows,columns:i.columns,filters:i.filters,values:i.values,filterSettings:i.filterSettings,sortSettings:i.sortSettings,drilledMembers:i.drilledMembers,valueSortSettings:i.valueSortSettings,valueAxis:i.valueAxis,grandTotalsPosition:i.grandTotalsPosition,formatSettings:i.formatSettings,calculatedFieldSettings:i.calculatedFieldSettings,fieldMapping:i.fieldMapping,showSubTotals:i.showSubTotals,showRowSubTotals:i.showRowSubTotals,showColumnSubTotals:i.showColumnSubTotals,showGrandTotals:i.showGrandTotals,showRowGrandTotals:i.showRowGrandTotals,showColumnGrandTotals:i.showColumnGrandTotals,showHeaderWhenEmpty:i.showHeaderWhenEmpty,alwaysShowValueHeader:i.alwaysShowValueHeader,conditionalFormatSettings:i.conditionalFormatSettings,emptyCellsTextContent:i.emptyCellsTextContent,groupSettings:i.groupSettings,showAggregationOnValueField:i.showAggregationOnValueField,authentication:this.CloneAuthenticationObject(i.authentication)})})},e.cloneFieldSettings=function(e){if(e){for(var t=[],i=0,a=e;i<a.length;i++){var r=a[i];t.push(this.getDefinedObj({name:r.name,caption:r.caption,axis:r.axis,baseField:r.baseField,baseItem:r.baseItem,isCalculatedField:r.isCalculatedField,isNamedSet:r.isNamedSet,showNoDataItems:r.showNoDataItems,showSubTotals:r.showSubTotals,type:r.type,dataType:r.dataType,showFilterIcon:r.showFilterIcon,showSortIcon:r.showSortIcon,showRemoveIcon:r.showRemoveIcon,showValueTypeIcon:r.showValueTypeIcon,showEditIcon:r.showEditIcon,allowDragAndDrop:r.allowDragAndDrop}))}return t}return e},e.cloneFilterSettings=function(e){if(e){for(var t=[],i=0,a=e;i<a.length;i++){var r=a[i];t.push(this.getDefinedObj({name:r.name,type:r.type,condition:r.condition,items:r.items?r.items.slice():r.items,levelCount:r.levelCount,measure:r.measure,selectedField:r.selectedField,showDateFilter:r.showDateFilter,showLabelFilter:r.showLabelFilter,showNumberFilter:r.showNumberFilter,value1:r.value1,value2:r.value2}))}return t}return e},e.cloneSortSettings=function(e){if(e){for(var t=[],i=0,a=e;i<a.length;i++){var r=a[i];t.push(this.getDefinedObj({name:r.name,order:r.order}))}return t}return e},e.cloneDrillMemberSettings=function(e){if(e){for(var t=[],i=0,a=e;i<a.length;i++){var r=a[i];t.push(this.getDefinedObj({name:r.name,delimiter:r.delimiter,items:r.items?r.items.slice():r.items}))}return t}return e},e.cloneFormatSettings=function(e){if(e){for(var t=[],i=0,a=e;i<a.length;i++){var r=a[i];t.push(this.getDefinedObj({name:r.name,calendar:r.calendar,currency:r.currency,format:r.format,maximumFractionDigits:r.maximumFractionDigits,maximumSignificantDigits:r.maximumSignificantDigits,minimumFractionDigits:r.minimumFractionDigits,minimumIntegerDigits:r.minimumIntegerDigits,minimumSignificantDigits:r.minimumSignificantDigits,skeleton:r.skeleton,type:r.type,useGrouping:r.useGrouping}))}return t}return e},e.CloneValueSortObject=function(e){if(e){return{columnIndex:e.columnIndex,headerDelimiter:e.headerDelimiter,headerText:e.headerText,measure:e.measure,sortOrder:e.sortOrder}}return e},e.CloneAuthenticationObject=function(e){if(e){return{userName:e.userName,password:e.password}}return e},e.cloneCalculatedFieldSettings=function(e){if(e){for(var t=[],i=0,a=e;i<a.length;i++){var r=a[i];t.push(this.getDefinedObj({name:r.name,formatString:r.formatString,formula:r.formula,hierarchyUniqueName:r.hierarchyUniqueName}))}return t}return e},e.cloneConditionalFormattingSettings=function(e){if(e){for(var t=[],i=0,a=e;i<a.length;i++){var r=a[i];t.push(this.getDefinedObj({applyGrandTotals:r.applyGrandTotals,conditions:r.conditions,label:r.label,measure:r.measure,style:r.style?{backgroundColor:r.style.backgroundColor,color:r.style.color,fontFamily:r.style.fontFamily,fontSize:r.style.fontSize}:r.style,value1:r.value1,value2:r.value2}))}return t}return e},e.cloneGroupSettings=function(e){if(e){for(var t=[],i=0,a=e;i<a.length;i++){var r=a[i];t.push(this.getDefinedObj({name:r.name,caption:r.caption,customGroups:this.cloneCustomGroups(r.customGroups),endingAt:r.endingAt,startingAt:r.startingAt,groupInterval:r.groupInterval,rangeInterval:r.rangeInterval,type:r.type}))}return t}return e},e.cloneCustomGroups=function(e){if(e){for(var t=[],i=0,a=e;i<a.length;i++){var r=a[i];t.push(this.getDefinedObj({groupName:r.groupName,items:r.items?r.items.slice():r.items}))}return t}return e},e.getFilterItemByName=function(e,t){var a=new i.DataManager({json:t}).executeLocal((new i.Query).where("name","equal",e));if(a&&a.length>0)return a[a.length-1]},e.getFieldByName=function(e,t){return new i.DataManager({json:t}).executeLocal((new i.Query).where("name","equal",e))[0]},e.getFieldInfo=function(e,t,i){if(!i)for(var a=[this.cloneFieldSettings(t.dataSourceSettings.rows),this.cloneFieldSettings(t.dataSourceSettings.columns),this.cloneFieldSettings(t.dataSourceSettings.values),this.cloneFieldSettings(t.dataSourceSettings.filters)],r=0,n=a.length;r<n;r++)for(var o=0,s=a[r]?a[r].length:0;o<s;o++)if(a[r][o]&&a[r][o].name===e)return{fieldName:e,fieldItem:a[r][o],axis:0===r?"rows":1===r?"columns":2===r?"values":"filters",position:o};var l="olap"===t.dataType?t.olapEngineModule.fieldList[e]:t.engineModule.fieldList[e];return{fieldName:e,fieldItem:l?{name:e,caption:l.caption,baseField:l.baseField,baseItem:l.baseItem,isCalculatedField:l.isCalculatedField,isNamedSet:l.isNamedSets,showNoDataItems:l.showNoDataItems,showSubTotals:l.showSubTotals,type:l.aggregateType,showFilterIcon:l.showFilterIcon,showSortIcon:l.showSortIcon,showRemoveIcon:l.showRemoveIcon,showValueTypeIcon:l.showValueTypeIcon,showEditIcon:l.showEditIcon,allowDragAndDrop:l.allowDragAndDrop}:void 0,axis:"fieldlist",position:-1}},e.isButtonIconRefesh=function(e,i,a){var r=!1;try{if("dataSourceSettings"===e&&i.dataSourceSettings&&a.dataSourceSettings){var n=["notAvail","notAvail","notAvail","notAvail"],o=Object.keys(i.dataSourceSettings),s=Object.keys(a.dataSourceSettings);if(o&&s&&s.length>0&&o.length===s.length)for(var l=["rows","columns","values","filters"],d=0;d<s.length;d++){var h=s[d]in i.dataSourceSettings&&!t.isNullOrUndefined(i.dataSourceSettings[s[d]])?Object.keys(i.dataSourceSettings[s[d]]):[],p=s[d]in a.dataSourceSettings&&!t.isNullOrUndefined(a.dataSourceSettings[s[d]])?Object.keys(a.dataSourceSettings[s[d]]):[];if(-1!==l.indexOf(s[d])&&-1!==l.indexOf(o[d])&&h&&p&&p.length>0&&h.length===p.length)for(var u=["showFilterIcon","showSortIcon","showRemoveIcon","showValueTypeIcon","showEditIcon","allowDragAndDrop"],c=0;c<p.length;c++){for(var g=Object.keys(i.dataSourceSettings[s[d]][p[c]]),m=Object.keys(a.dataSourceSettings[s[d]][p[c]]),f=0;f<m.length;f++){if(-1===u.indexOf(m[f])||-1===u.indexOf(g[f])){n[d]="break";break}n[d]="update"}if("break"===n[d])break}else n[d]="break";if("break"===n[d])break}for(var v=0,S=0,y=0,b=0,C=n;b<C.length;b++){var x=C[b];"break"===x&&v++,"notAvail"===x&&S++,"update"===x&&y++}r=!(v>0||4===S)&&(0===v&&S<4&&y>0)}}catch(e){r=!1}return r},e.formatPivotValues=function(e){for(var t=[],i=0;i<e.length;i++)if(e[i]){t[i]=[];for(var a=0;a<e[i].length;a++)e[i][a]&&(t[i][a]={axis:e[i][a].Axis,actualText:e[i][a].ActualText,indexObject:e[i][a].IndexObject,index:e[i][a].Index,rowHeaders:e[i][a].RowHeaders,columnHeaders:e[i][a].ColumnHeaders,formattedText:e[i][a].FormattedText,actualValue:e[i][a].ActualValue,rowIndex:e[i][a].RowIndex,colIndex:e[i][a].ColIndex,colSpan:e[i][a].ColSpan,level:e[i][a].Level,rowSpan:e[i][a].RowSpan,isSum:e[i][a].IsSum,isGrandSum:e[i][a].IsGrandSum,valueSort:e[i][a].ValueSort,ordinal:e[i][a].Ordinal,hasChild:e[i][a].HasChild,isDrilled:e[i][a].IsDrilled,value:e[i][a].Value,type:e[i][a].Type,members:e[i][a].Members})}return t},e.formatFieldList=function(e){for(var t=Object.keys(e),i={},a=0;a<t.length;a++)e[t[a]]&&(i[t[a]]={id:e[t[a]].Id,caption:e[t[a]].Caption,type:e[t[a]].Type,formatString:e[t[a]].FormatString,index:e[t[a]].Index,members:e[t[a]].Members,formattedMembers:e[t[a]].FormattedMembers,dateMember:e[t[a]].DateMember,filter:e[t[a]].Filter,sort:e[t[a]].Sort,aggregateType:e[t[a]].AggregateType,baseField:e[t[a]].BaseField,baseItem:e[t[a]].BaseItem,filterType:e[t[a]].FilterType,format:e[t[a]].Format,formula:e[t[a]].Formula,isSelected:e[t[a]].IsSelected,isExcelFilter:e[t[a]].IsExcelFilter,showNoDataItems:e[t[a]].ShowNoDataItems,isCustomField:e[t[a]].IsCustomField,showFilterIcon:e[t[a]].ShowFilterIcon,showSortIcon:e[t[a]].ShowSortIcon,showRemoveIcon:e[t[a]].ShowRemoveIcon,showEditIcon:e[t[a]].ShowEditIcon,showValueTypeIcon:e[t[a]].ShowValueTypeIcon,allowDragAndDrop:e[t[a]].AllowDragAndDrop,isCalculatedField:e[t[a]].IsCalculatedField,showSubTotals:e[t[a]].ShowSubTotals});return i},e.frameContent=function(e,t,i,a){var r=[],n=a;if(n.dataSourceSettings.values.length>0&&!n.engineModule.isEmptyData&&(n.enableValueSorting||!n.engineModule.isEngineUpdated))for(var o=0,s="value"===t?i:0,l="value"===t?e.length:i,d=s;d<l;d++)if(e[d]){r[o="header"===t?d:o]={};for(var h=0;h<e[d].length;h++)e[d][h]&&(r[o][h]=e[d][h]);o++}return r},e.getLocalizedObject=function(e){var t=new Object;return t.Null=e.localeObj.getConstant("null"),t.Years=e.localeObj.getConstant("Years"),t.Quarters=e.localeObj.getConstant("Quarters"),t.Months=e.localeObj.getConstant("Months"),t.Days=e.localeObj.getConstant("Days"),t.Hours=e.localeObj.getConstant("Hours"),t.Minutes=e.localeObj.getConstant("Minutes"),t.Seconds=e.localeObj.getConstant("Seconds"),t.QuarterYear=e.localeObj.getConstant("QuarterYear"),t.Of=e.localeObj.getConstant("of"),t.Qtr=e.localeObj.getConstant("qtr"),t.Undefined=e.localeObj.getConstant("undefined"),t.GroupOutOfRange=e.localeObj.getConstant("groupOutOfRange"),t.Group=e.localeObj.getConstant("group"),t},e.updateReport=function(e,t){e.setProperties({dataSourceSettings:{rows:[]}},!0),e.setProperties({dataSourceSettings:{columns:[]}},!0),e.setProperties({dataSourceSettings:{formatSettings:[]}},!0);for(var i=0;i<t.Rows.length;i++)e.dataSourceSettings.rows.push({name:t.Rows[i].Name,caption:t.Rows[i].Caption,showNoDataItems:t.Rows[i].ShowNoDataItems,baseField:t.Rows[i].BaseField,baseItem:t.Rows[i].BaseItem,showFilterIcon:t.Rows[i].ShowFilterIcon,showSortIcon:t.Rows[i].ShowSortIcon,showEditIcon:t.Rows[i].ShowEditIcon,showRemoveIcon:t.Rows[i].ShowRemoveIcon,showSubTotals:t.Rows[i].ShowValueTypeIcon,allowDragAndDrop:t.Rows[i].AllowDragAndDrop,axis:t.Rows[i].Axis,dataType:t.Rows[i].DataType,isCalculatedField:t.Rows[i].IsCalculatedField,showValueTypeIcon:t.Rows[i].ShowValueTypeIcon,type:t.Rows[i].Type});for(i=0;i<t.Columns.length;i++)e.dataSourceSettings.columns.push({name:t.Columns[i].Name,caption:t.Columns[i].Caption,showNoDataItems:t.Columns[i].ShowNoDataItems,baseField:t.Columns[i].BaseField,baseItem:t.Columns[i].BaseItem,showFilterIcon:t.Columns[i].ShowFilterIcon,showSortIcon:t.Columns[i].ShowSortIcon,showEditIcon:t.Columns[i].ShowEditIcon,showRemoveIcon:t.Columns[i].ShowRemoveIcon,showSubTotals:t.Columns[i].ShowValueTypeIcon,allowDragAndDrop:t.Columns[i].AllowDragAndDrop,axis:t.Columns[i].Axis,dataType:t.Columns[i].DataType,isCalculatedField:t.Columns[i].IsCalculatedField,showValueTypeIcon:t.Columns[i].ShowValueTypeIcon,type:t.Columns[i].Type});for(i=0;i<t.FormatSettings.length;i++)e.dataSourceSettings.formatSettings.push({name:t.FormatSettings[i].Name,format:t.FormatSettings[i].Format,type:t.FormatSettings[i].Type,currency:t.FormatSettings[i].Currency,maximumFractionDigits:t.FormatSettings[i].MaximumFractionDigits,maximumSignificantDigits:t.FormatSettings[i].MaximumSignificantDigits,minimumFractionDigits:t.FormatSettings[i].MinimumFractionDigits,minimumIntegerDigits:t.FormatSettings[i].MinimumIntegerDigits,minimumSignificantDigits:t.FormatSettings[i].MinimumSignificantDigits,skeleton:t.FormatSettings[i].Skeleton,useGrouping:t.FormatSettings[i].UseGrouping})},e.generateUUID=function(){var e=(new Date).getTime(),t=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var a=16*Math.random();return e>0?(a=(e+a)%16|0,e=Math.floor(e/16)):(a=(t+a)%16|0,t=Math.floor(t/16)),("x"===i?a:3&a|8).toString(16)})},e}(),m=function(){return(m=Object.assign||function(e){for(var t,i=1,a=arguments.length;i<a;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)},f=function(){function e(){this.aggregatedValueMatrix=[],this.valueContent=[],this.formatFields={},this.dateFormatFunction={},this.calculatedFields={},this.calculatedFormulas={},this.valueAxis=0,this.saveDataHeaders={},this.columnCount=0,this.rowCount=0,this.colFirstLvl=0,this.rowFirstLvl=0,this.rowStartPos=0,this.colStartPos=0,this.enableValueSorting=!1,this.headerCollection={rowHeaders:[],columnHeaders:[],rowHeadersCount:0,columnHeadersCount:0},this.rMembers=[],this.cMembers=[],this.groupingFields={},this.isLastHeaderHasMeasures=!0,this.measureIndex=-1,this.valueMatrix=[],this.indexMatrix=[],this.memberCnt=-1,this.pageInLimit=!1,this.endPos=0,this.removeCount=0,this.colHdrBufferCalculated=!1,this.colValuesLength=1,this.rowValuesLength=1,this.slicedHeaders=[],this.fieldFilterMem={},this.filterPosObj={},this.selectedHeaders={selectedHeader:[],values:[]},this.rowGrandTotal=null,this.columnGrandTotal=null,this.removeRowGrandTotal=!1,this.removeColumnGrandTotal=!1,this.isValueHasAdvancedAggregate=!1,this.rawIndexObject={},this.isEditing=!1,this.data=[],this.actualData=[],this.groupRawIndex={},this.fieldKeys={},this.allowDataCompression=!1,this.dataSourceSettings={},this.frameHeaderObjectsCollection=!1,this.headerObjectsCollection={},this.columnKeys={},this.fieldDrillCollection={},this.fieldMapping=[],this.formatRegex=/(^[ncpae]{1})([0-1]?[0-9]|20)?$/i,this.measureNames={}}return e.prototype.renderEngine=function(e,a,r){this.getValueCellInfo=r,this.formatFields={},this.dateFormatFunction={},this.calculatedFields={},this.calculatedFormulas={},this.valueAxis=0,this.saveDataHeaders={},this.columnCount=0,this.rowCount=0,this.colFirstLvl=0,this.rowFirstLvl=0,this.rowStartPos=0,this.colStartPos=0,this.excludeFields=t.isNullOrUndefined(e.excludeFields)?[]:e.excludeFields,this.enableValueSorting=!1,this.headerCollection={rowHeaders:[],columnHeaders:[],rowHeadersCount:0,columnHeadersCount:0},this.valueMatrix=[],this.indexMatrix=[],this.aggregatedValueMatrix=[],this.rMembers=[],this.cMembers=[],this.memberCnt=-1,this.pageInLimit=!1,this.endPos=0,this.removeCount=0,this.colHdrBufferCalculated=!1,this.colValuesLength=1,this.rowValuesLength=1,this.slicedHeaders=[],this.fieldFilterMem={},this.filterPosObj={},this.selectedHeaders={selectedHeader:[],values:[]},this.rowGrandTotal=null,this.columnGrandTotal=null,this.removeRowGrandTotal=!1,this.removeColumnGrandTotal=!1,this.isValueHasAdvancedAggregate=!1,this.rawIndexObject={},this.isLastHeaderHasMeasures=!0,this.isEditing=!1;var n;if(this.globalize=a&&a.globalize?a.globalize:new t.Internationalization,this.currencyCode=a&&a.currenyCode?a.currenyCode:void 0,this.localeObj=a?a.localeObj:void 0,this.fieldsType=a?a.fieldsType:{},this.clonedReport=a?a.clonedReport&&a.clonedReport.properties?a.clonedReport.properties:a.clonedReport:{},this.enableSort=e.enableSorting,this.alwaysShowValueHeader=e.alwaysShowValueHeader,this.showHeaderWhenEmpty=!!t.isNullOrUndefined(e.showHeaderWhenEmpty)||e.showHeaderWhenEmpty,this.showSubTotals=!!t.isNullOrUndefined(e.showSubTotals)||e.showSubTotals,this.showRowSubTotals=!!t.isNullOrUndefined(e.showRowSubTotals)||e.showRowSubTotals,this.showColumnSubTotals=!!t.isNullOrUndefined(e.showColumnSubTotals)||e.showColumnSubTotals,this.showGrandTotals=!!t.isNullOrUndefined(e.showGrandTotals)||e.showGrandTotals,this.grandTotalsPosition=t.isNullOrUndefined(e.grandTotalsPosition)?"Bottom":e.grandTotalsPosition,this.showRowGrandTotals=!!t.isNullOrUndefined(e.showRowGrandTotals)||e.showRowGrandTotals,this.showColumnGrandTotals=!!t.isNullOrUndefined(e.showColumnGrandTotals)||e.showColumnGrandTotals,this.allowValueFilter=e.allowValueFilter,this.isValueFilterEnabled=!1,this.enableValueSorting=!!a&&a.enableValueSorting,this.isDrillThrough=!!a&&(!!a.isDrillThrough&&a.isDrillThrough),this.valueContent=[],this.dataSourceSettings=e,e.dataSource instanceof i.DataManager||(this.data=e.dataSource),this.data&&this.data[0]){if(!this.fieldList){"CSV"===e.type?this.fields=this.data.shift():this.fields=Object.keys(this.data[0]);for(var o=0;o<this.fields.length;o++)this.fieldKeys[this.fields[o]]="CSV"===e.type?o:this.fields[o]}a&&a.pageSettings&&a.pageSettings.allowDataCompression&&(this.actualData=this.data,this.data=this.getGroupedRawData(e)),this.rows=e.rows?e.rows:[],this.columns=e.columns?e.columns:[],this.filters=e.filters?e.filters:[],this.values=e.values?e.values:[],this.formats=e.formatSettings?e.formatSettings:[],this.groups=e.groupSettings?e.groupSettings:[],this.calculatedFieldSettings=e.calculatedFieldSettings?e.calculatedFieldSettings:[],this.enableSort=void 0===e.enableSorting||e.enableSorting,this.fieldMapping=e.fieldMapping?e.fieldMapping:[],n=this.getGroupData(this.data);for(o=0;o<this.fields.length;o++)this.fieldKeys[this.fields[o]]="CSV"===e.type?o:this.fields[o];this.validateFilters(e),this.isExpandAll=!(!this.isValueFiltersAvail||!e.allowValueFilter)||e.expandAll,this.drilledMembers=e.drilledMembers?this.isValueFiltersAvail&&e.allowValueFilter?[]:e.drilledMembers:[],this.isMultiMeasures=this.values.length>1,this.valueAxis="row"===e.valueAxis?1:0,this.measureIndex=t.isNullOrUndefined(e.valueIndex)?-1:e.valueIndex,this.emptyCellTextContent=e.emptyCellsTextContent?e.emptyCellsTextContent:"",this.rowValuesLength=1===this.valueAxis?this.values.length:1,this.colValuesLength=0===this.valueAxis?this.values.length:1,this.valueSortSettings=e.valueSortSettings||{sortOrder:"None",headerDelimiter:".",headerText:"",columnIndex:void 0},this.valueSortData=[],this.pageSettings=a?a.pageSettings?a.pageSettings:this.pageSettings:void 0,this.allowDataCompression=this.pageSettings&&this.pageSettings.allowDataCompression,this.savedFieldList=a?a.savedFieldList:void 0,this.getFieldList(n,this.enableSort,e.allowValueFilter),this.removeIrrelevantFields(e,Object.keys(this.fieldList)),this.fillFieldMembers(this.data,this.indexMatrix),this.updateSortSettings(e.sortSettings,this.enableSort),this.valueMatrix=this.generateValueMatrix(this.data),this.filterMembers=[];var s=this.columns.length-1;for(this.columnKeys={};s>-1;)this.columnKeys[this.columns[s].name]=this.columns[s],s--;this.updateFilterMembers(e),this.generateGridData(e)}},e.prototype.removeIrrelevantFields=function(e,i){var a={};a[0]=this.rows=e.rows,a[1]=this.columns=e.columns,a[2]=this.values=e.values,a[3]=this.filters=e.filters;for(var r=0;r<4;){if(a[r])for(var n=0;n<a[r].length;n++){var o=a[r][n].name;this.excludeFields.indexOf(o)>-1||!t.isNullOrUndefined(i)&&-1===i.indexOf(o)?(a[r].splice(n,1),n--):2==r&&(this.measureNames[o]=a[r][n].caption?a[r][n].caption:o,this.measureNames[a[r][n].caption?a[r][n].caption:o]=o)}r++}this.isMultiMeasures=this.values.length>1,this.measureIndex=-1==this.measureIndex?this.valueAxis?a[0].length:a[1].length:this.measureIndex},e.prototype.updateDataSourceSettings=function(e,i){i&&(this.emptyCellTextContent=e.emptyCellsTextContent?e.emptyCellsTextContent:"",this.valueAxis="row"===e.valueAxis?1:0,this.rowValuesLength=1===this.valueAxis?this.values.length:1,this.colValuesLength=0===this.valueAxis?this.values.length:1,this.measureIndex=t.isNullOrUndefined(e.valueIndex)?-1:e.valueIndex,this.enableSort=e.enableSorting,this.alwaysShowValueHeader=e.alwaysShowValueHeader,this.showHeaderWhenEmpty=!!t.isNullOrUndefined(e.showHeaderWhenEmpty)||e.showHeaderWhenEmpty,this.showSubTotals=!!t.isNullOrUndefined(e.showSubTotals)||e.showSubTotals,this.showRowSubTotals=!!t.isNullOrUndefined(e.showRowSubTotals)||e.showRowSubTotals,this.showColumnSubTotals=!!t.isNullOrUndefined(e.showColumnSubTotals)||e.showColumnSubTotals,this.showGrandTotals=!!t.isNullOrUndefined(e.showGrandTotals)||e.showGrandTotals,this.grandTotalsPosition=t.isNullOrUndefined(e.grandTotalsPosition)?"Bottom":e.grandTotalsPosition,this.showRowGrandTotals=!!t.isNullOrUndefined(e.showRowGrandTotals)||e.showRowGrandTotals,this.showColumnGrandTotals=!!t.isNullOrUndefined(e.showColumnGrandTotals)||e.showColumnGrandTotals,this.allowValueFilter=e.allowValueFilter,this.formats=e.formatSettings?e.formatSettings:[],this.groups=e.groupSettings?e.groupSettings:[],this.calculatedFieldSettings=e.calculatedFieldSettings?e.calculatedFieldSettings:[],this.enableSort=void 0===e.enableSorting||e.enableSorting,this.fieldMapping=e.fieldMapping?e.fieldMapping:[],this.removeIrrelevantFields(e,Object.keys(this.fieldList)))},e.prototype.getGroupedRawData=function(e){this.data=[];for(var i=0,a=this.actualData;i<a.length;i++){var r=a[i];this.data[this.data.length]=this.frameHeaderWithKeys(r)}var n=e.values.filter(function(e){return"Count"===e.type||"DistinctCount"===e.type}).map(function(e){return e.name}),o=n.length>0,s=this.data,l=e.rows.concat(e.columns.concat(e.filters)).map(function(e){return e.name}),d={},h=[];this.groupRawIndex={};for(var p={},u=0,c=0;c<s.length;c++){var g=s[c],m=[];if(o)for(var f=0;f<n.length;f++)g[this.fieldKeys[n[f]]]=t.isNullOrUndefined(g[this.fieldKeys[n[f]]])?g[this.fieldKeys[n[f]]]:1;for(var v=0;v<l.length;v++)m.push(g[this.fieldKeys[l[v]]]);var S=m.join("-");if(d[S]){for(f=0;f<e.values.length;f++){var y=e.values[f].name,b=g[this.fieldKeys[y]],C=d[S],x=e.values[f].type;t.isNullOrUndefined(b)||("number"==typeof b&&"DistinctCount"!==x||(x="Count"),t.isNullOrUndefined(C[y])?C[y]="Product"===x?1:"Min"===x||"Max"===x?void 0:0:"number"!=typeof C[y]&&(C[y]=1),"Count"===x?C[y]+=1:"Min"===x?t.isNullOrUndefined(C[y])||(C[y]=C[y]>b?b:C[y]):"Max"===x?t.isNullOrUndefined(C[y])||(C[y]=C[y]<b?b:C[y]):"Product"===x?C[y]*=b:C[y]+=b)}this.isDrillThrough&&this.groupRawIndex[p[S]].push(c)}else d[S]=g,h.push(g),this.isDrillThrough&&(this.groupRawIndex[u]=[c],p[S]=u,u++)}return h},e.prototype.getGroupData=function(e){for(var i=this,a=e[0],r=function(r){var o=r.name,s=r.caption;if(!(n.fields.indexOf(o)>-1))return{value:a};var l={},d=void 0;if("Date"===r.type&&n.groupingFields[o])return{value:a};if("Number"===r.type){if("number"!==g.getType(a[o])&&n.groupingFields[o])return{value:a};r.rangeInterval&&e.sort(function(e,t){return Number(e[i.fieldKeys[o]])>Number(t[i.fieldKeys[o]])?1:Number(t[i.fieldKeys[o]])>Number(e[i.fieldKeys[o]])?-1:0})}for(var h=e.length;h--;){var p=e[h];if(p[n.fieldKeys[o]]&&"Date"===r.type){var u=new Date(p[n.fieldKeys[o]].toString());if(!t.isNullOrUndefined(u)&&r.groupInterval.length>0)for(var c=0,m=r.groupInterval.length;c<m;c++){var f=r.groupInterval[c],v=n.getRange(r,u.getTime()),S=g.resetTime(new Date);switch(f){case"Years":l[b=c===r.groupInterval.length-1?o:o+"_date_group_years"]=f,n.fieldKeys[b]="CSV"===n.dataSourceSettings.type?n.fieldKeys[b]?n.fieldKeys[b]:n.fields.length:b,-1===n.fields.indexOf(b)&&n.fields.push(b),p[n.fieldKeys[b]]=v?void 0:new Date(S.setFullYear(u.getFullYear())).toString();break;case"Quarters":l[b=c===r.groupInterval.length-1?o:o+"_date_group_quarters"]=f;var y=Math.ceil((u.getMonth()+1)/3);n.fieldKeys[b]="CSV"===n.dataSourceSettings.type?n.fieldKeys[b]?n.fieldKeys[b]:n.fields.length:b,-1===n.fields.indexOf(b)&&n.fields.push(b),p[n.fieldKeys[b]]=v?void 0:(n.localeObj?n.localeObj.getConstant("qtr"):"Qtr")+y.toString();break;case"QuarterYear":l[b=c===r.groupInterval.length-1?o:o+"_date_group_quarterYear"]=f;y=Math.ceil((u.getMonth()+1)/3);n.fieldKeys[b]="CSV"===n.dataSourceSettings.type?n.fieldKeys[b]?n.fieldKeys[b]:n.fields.length:b,-1===n.fields.indexOf(b)&&n.fields.push(b),p[n.fieldKeys[b]]=v?void 0:(n.localeObj?n.localeObj.getConstant("qtr"):"Qtr")+y.toString()+" "+(n.localeObj?n.localeObj.getConstant("of"):"of")+" "+u.getFullYear().toString();break;case"Months":l[b=c===r.groupInterval.length-1?o:o+"_date_group_months"]=f,n.fieldKeys[b]="CSV"===n.dataSourceSettings.type?n.fieldKeys[b]?n.fieldKeys[b]:n.fields.length:b,-1===n.fields.indexOf(b)&&n.fields.push(b),p[n.fieldKeys[b]]=v?void 0:new Date(S.setMonth(u.getMonth(),S.getDate())).toString();break;case"Days":l[b=c===r.groupInterval.length-1?o:o+"_date_group_days"]=f,n.fieldKeys[b]="CSV"===n.dataSourceSettings.type?n.fieldKeys[b]?n.fieldKeys[b]:n.fields.length:b,-1===n.fields.indexOf(b)&&n.fields.push(b),p[n.fieldKeys[b]]=v?void 0:new Date(S.setMonth(u.getMonth(),u.getDate())).toString();break;case"Hours":l[b=c===r.groupInterval.length-1?o:o+"_date_group_hours"]=f,n.fieldKeys[b]="CSV"===n.dataSourceSettings.type?n.fieldKeys[b]?n.fieldKeys[b]:n.fields.length:b,-1===n.fields.indexOf(b)&&n.fields.push(b),p[n.fieldKeys[b]]=v?void 0:new Date(S.setHours(u.getHours())).toString();break;case"Minutes":l[b=c===r.groupInterval.length-1?o:o+"_date_group_minutes"]=f,n.fieldKeys[b]="CSV"===n.dataSourceSettings.type?n.fieldKeys[b]?n.fieldKeys[b]:n.fields.length:b,-1===n.fields.indexOf(b)&&n.fields.push(b),p[n.fieldKeys[b]]=v?void 0:new Date(S.setMinutes(u.getMinutes())).toString();break;case"Seconds":l[b=c===r.groupInterval.length-1?o:o+"_date_group_seconds"]=f,n.fieldKeys[b]="CSV"===n.dataSourceSettings.type?n.fieldKeys[b]?n.fieldKeys[b]:n.fields.length:b,-1===n.fields.indexOf(b)&&n.fields.push(b),p[n.fieldKeys[b]]=v?void 0:new Date(S.setSeconds(u.getSeconds())).toString()}}}else if(p[n.fieldKeys[o]]&&"Number"===r.type){v=n.getRange(r,Number(p[n.fieldKeys[o]]));p[n.fieldKeys[o]]=v?void 0:p[n.fieldKeys[o]]}else if(p[n.fieldKeys[o]]&&"Custom"===r.type&&r.customGroups&&r.customGroups.length>0)for(var b=o+"_custom_group",C=r.customGroups,x=void 0,w=(c=0,C.length);c<w;c++){var T=C[c];if(T.items&&T.items.length>1){d=b,n.fieldKeys[b]="CSV"===n.dataSourceSettings.type?n.fieldKeys[b]?n.fieldKeys[b]:n.fields.length:b,-1===n.fields.indexOf(b)&&n.fields.push(b);var M=-1!==g.inArray(p[n.fieldKeys[o]].toString(),T.items);p[n.fieldKeys[b]]=M?T.groupName&&""!==T.groupName?T.groupName:n.localeObj.getConstant("group")+" "+c:x&&x!==p[n.fieldKeys[o]].toString()?x:p[n.fieldKeys[o]].toString(),x=p[n.fieldKeys[b]]}}for(var D=[],O=0,N=ne=Object.keys(p);O<N.length;O++){var E=N[O];D.push(!!p[E])}a=-1===D.indexOf(!1)&&ne.length===Object.keys(e[0]).length?p:a}if("Date"===r.type){for(var P=!1,F=[n.rows,n.columns,n.values,n.filters],I=Object.keys(l),L=Object.keys(I).length,A=void 0,R=0,j=F;R<j.length;R++){var k=j[R];if(!P&&k){var q=k.length;for(c=0;c<q;){if(k[c].name===o){P=!0;var V=k[c];k.splice(c,1);for(ce=(ce=n.rows).concat(n.columns,n.values,n.filters);L--;){var H=V.caption?V.caption:V.name;if(n.clonedReport){var B=n.clonedReport.rows;B=B.concat(n.clonedReport.columns,n.clonedReport.values,n.clonedReport.filters);var _=g.getFieldByName(I[L],B);_&&(H=_.caption?_.caption:_.name)}if(!g.getFieldByName(I[L],ce)){A=l[I[L]],H=-1!==H.indexOf(" (")&&-1!==H.indexOf(")")?H.slice(H.indexOf("(")+1,H.length-1):H;var U={name:I[L],caption:(n.localeObj?n.localeObj.getConstant(A):A)+" ("+H+")",type:"Count",showNoDataItems:V.showNoDataItems,baseField:V.baseField,baseItem:V.baseItem,showFilterIcon:V.showFilterIcon,showSortIcon:V.showSortIcon,showEditIcon:V.showEditIcon,showRemoveIcon:V.showRemoveIcon,showSubTotals:V.showValueTypeIcon,allowDragAndDrop:V.allowDragAndDrop};k.splice(c,0,U)}}break}c++}if(P)break}}L=Object.keys(I).length;for(var G=(he=n.getMappingField(o,n.clonedReport?n.clonedReport.fieldMapping:n.fieldMapping)).caption?he.caption:o;L--;){A=l[I[L]];c=0;for(var W=n.formats.length;c<W;c++)if(n.formats[c].name===I[L]){n.formats.splice(c,1);break}if("Quarters"!==A&&"QuarterYear"!==A){var z={name:I[L],type:["Years","Months","Days"].indexOf(A)>-1?"date":"time",format:"Years"===A?"yyyy":"Months"===A?"MMM":"Days"===A?"d-MMM":"Hours"===A?"hh a":"Minutes"===A?":mm":"Seconds"===A?":ss":void 0};n.formats.push(z)}if(!P){var Q=n.getMappingField(I[L],n.fieldMapping);if(I[L]!==o&&t.isNullOrUndefined(Q.name)){U={name:I[L],caption:(n.localeObj?n.localeObj.getConstant(A):A)+" ("+G+")"};n.fieldMapping.push(U)}else I[L]!==o&&(Q.caption=(n.localeObj?n.localeObj.getConstant(A):A)+" ("+G+")")}}if(!P){Q=n.getMappingField(o,n.fieldMapping);if(A=l[o],I[L]!==o&&t.isNullOrUndefined(Q.name)){U={name:o,caption:(n.localeObj?n.localeObj.getConstant(A):A)+" ("+G+")"};n.fieldMapping.push(U)}else Q.caption=(n.localeObj?n.localeObj.getConstant(A):A)+" ("+G+")"}}else if("Number"===r.type&&r.rangeInterval){var Y=void 0,K=void 0,X=void 0,J=void 0,Z=[],$=[],ee=e.length;q=0;for(n.groupingFields[o]=o;q<ee;)$.push(Number(e[q][n.fieldKeys[o]])),e[q][n.fieldKeys[o]]&&-1===Z.indexOf(Number(e[q][n.fieldKeys[o]]))&&Z.push(Number(e[q][n.fieldKeys[o]])),q++;for(var te=Math.max.apply(Math,Z),ie=(c=Z[0],te);c<ie;c++)if($.indexOf(c)<0){var ae=n.frameData(e[0]);ae[n.fieldKeys[o]]=c;var re=$.lastIndexOf(c-1);$.splice(re+1,0,c),e.splice(re+1,0,ae)}for(ee=e.length,q=0;q<ee;){if(e[q]&&e[q][n.fieldKeys[o]]){J=(X=Number(e[q][n.fieldKeys[o]]))+(r.rangeInterval-1),Y=Y||X,K=K?K>te?te:K:J>te?te:J,X>=Y&&X<=K?e[q][n.fieldKeys[o]]=Y===K?Y.toString():Y.toString()+"-"+K.toString():X>K&&X===K+1&&(K=(Y=K+1)+(r.rangeInterval-1)>te?te:Y+(r.rangeInterval-1),e[q][n.fieldKeys[o]]=Y===K?Y.toString():Y.toString()+"-"+K.toString());D=[];for(var ne,oe=0,se=ne=Object.keys(e[q]);oe<se.length;oe++){E=se[oe];D.push(!!e[q][E])}a=-1===D.indexOf(!1)&&ne.length===Object.keys(e[0]).length?e[q]:a}q++}for(var le=0,de=F=[n.rows,n.columns,n.values,n.filters];le<de.length;le++){var he,pe=de[le];(he=g.getFieldByName(o,pe))&&((he=he.properties?he.properties:he).type="Count")}c=0;for(var ue=n.formats.length;c<ue;c++)if(n.formats[c].name===o){n.formats.splice(c,1);break}}else if("Custom"===r.type&&d){var ce,ge=d;P=!1,F=[n.rows,n.columns,n.values,n.filters];ce=(ce=n.rows).concat(n.columns,n.values,n.filters);var me=[];s&&""!==s||(me=ge.match(/_custom_group/g));for(var fe=g.getFieldByName(o.replace(/_custom_group/g,""),ce),ve=g.getFieldByName(ge,ce),Se=0,ye=F;Se<ye.length;Se++){k=ye[Se];if(!P&&k){for(q=k.length,c=0;c<q;){if(k[c].name===r.name&&!ve){P=!0;V=k[c],U={name:ge,caption:s&&""!==s?s:(fe.caption?fe.caption:fe.name)+(me.length+1),type:"Count",showNoDataItems:V.showNoDataItems,baseField:V.baseField,baseItem:V.baseItem,showSubTotals:V.showValueTypeIcon,allowDragAndDrop:V.allowDragAndDrop,showFilterIcon:V.showFilterIcon,showSortIcon:V.showSortIcon,showRemoveIcon:V.showRemoveIcon,showEditIcon:V.showEditIcon};k.splice(c,0,U);break}if(k[c].name===ge&&ve){U={name:ve.name,caption:s&&""!==s?s:ve.caption,type:ve.type,showNoDataItems:ve.showNoDataItems,baseField:ve.baseField,baseItem:ve.baseItem,showRemoveIcon:ve.showRemoveIcon,showSubTotals:ve.showValueTypeIcon,allowDragAndDrop:ve.allowDragAndDrop,showFilterIcon:ve.showFilterIcon,showSortIcon:ve.showSortIcon,showEditIcon:ve.showEditIcon};k.splice(c,1,U);break}c++}if(P)break}}var be=g.getFieldByName(o,g.cloneFormatSettings(n.formats));be&&(be.name=ge,n.formats.push(be))}n.groupingFields=t.extend(n.groupingFields,l)},n=this,o=0,s=this.groups;o<s.length;o++){var l=r(s[o]);if("object"==typeof l)return l.value}return a},e.prototype.frameData=function(e){for(var t=Object.keys(e),i=0,a={};i<t.length;)a[t[i]]=void 0,i++;return a},e.prototype.getRange=function(e,t){var i;if("Date"===e.type){var a=new Date(t),r="string"==typeof e.startingAt?new Date(e.startingAt):e.startingAt,n="string"==typeof e.endingAt?new Date(e.endingAt):e.endingAt;i=!!(r&&a.getTime()<r.getTime()||n&&a.getTime()>n.getTime())}else{var o="string"==typeof e.startingAt?parseInt(e.startingAt,10):e.startingAt,s="string"==typeof e.endingAt?parseInt(e.endingAt,10):e.endingAt;i=!!(o&&t<o||s&&t>s)}return i},e.prototype.getPercentFormat=function(e,i){var a=t.isNullOrUndefined(e[i])||t.isNullOrUndefined(this.formatFields[i].format)?void 0:this.formatFields[i].format.toLowerCase().match(/p[0-9]/);return t.isNullOrUndefined(a)?2:Number(this.formatFields[i].format.replace(/[^0-9]/g,""))},e.prototype.getFormattedFields=function(e){for(var t=this.formats.length;t--;)this.formatFields[this.formats[t].name]=this.formats[t],this.formats[t].type&&(this.dateFormatFunction[this.formats[t].name]={exactFormat:this.globalize.getDateFormat(this.formats[t]),fullFormat:this.globalize.getDateFormat({format:"yyyy/MM/dd/HH/mm/ss",type:this.formats[t].type})})},e.prototype.getFieldList=function(e,i,a){for(var r,n=this.excludeFields.length-1;n>-1;){var o=this.fields.indexOf(this.excludeFields[n]);-1!==o&&this.fields.splice(o,1),this.fieldList&&delete this.fieldList[this.excludeFields[n]],n--}var s=this.fields,l=t.extend([],this.rows,null,!0);l=l.concat(this.columns,this.values,this.filters),this.getFormattedFields(l),this.getCalculatedField(s);var d=(s=this.fields).length,h=["string","number","datetime","date","boolean"];if(this.savedFieldList)for(this.fieldList=this.savedFieldList;d--;){var p=s[d],u=this.getMappingField(p,this.fieldMapping);this.fieldList[p]?(this.fieldList[p].isSelected=!1,this.fieldList[p].index=d,this.fieldList[p].filter=[],this.fieldList[p].sort=i?"Ascending":"None",this.fieldList[p].isExcelFilter=!1,this.fieldList[p].filterType="",this.fieldList[p].showFilterIcon=!(u&&"showFilterIcon"in u)||u.showFilterIcon,this.fieldList[p].showRemoveIcon=!(u&&"showRemoveIcon"in u)||u.showRemoveIcon,this.fieldList[p].showSortIcon=!(u&&"showSortIcon"in u)||u.showSortIcon,this.fieldList[p].showEditIcon=!(u&&"showEditIcon"in u)||u.showEditIcon,this.fieldList[p].showValueTypeIcon=!(u&&"showValueTypeIcon"in u)||u.showValueTypeIcon,this.fieldList[p].allowDragAndDrop=!(u&&"allowDragAndDrop"in u)||u.allowDragAndDrop,this.fieldList[p].isCalculatedField=!!(u&&"isCalculatedField"in u)&&u.isCalculatedField,this.fieldList[p].showNoDataItems=!!(u&&"showNoDataItems"in u)&&u.showNoDataItems,this.fieldList[p].showSubTotals=!(u&&"showSubTotals"in u)||u.showSubTotals,this.isValueFiltersAvail&&a&&(this.fieldList[p].dateMember=[],this.fieldList[p].formattedMembers={},this.fieldList[p].members={})):(r=u&&"dataType"in u&&u.dataType&&h.indexOf(u.dataType.toLowerCase())>-1?u.dataType.toLowerCase():r,this.fieldList[p]={caption:u&&"caption"in u&&u.caption?u.caption:p,id:p,type:-1!==p.indexOf("_custom_group")||-1!==p.indexOf("_date_group")?"string":void 0===r||"undefined"===r?"number":r,isSelected:!1,sort:i?"Ascending":"None",filterType:"",index:d,filter:[],isCustomField:-1!==p.indexOf("_custom_group")||-1!==p.indexOf("_date_group"),showRemoveIcon:!(u&&"showRemoveIcon"in u)||u.showRemoveIcon,showFilterIcon:!(u&&"showFilterIcon"in u)||u.showFilterIcon,showSortIcon:!(u&&"showSortIcon"in u)||u.showSortIcon,showNoDataItems:!!(u&&"showNoDataItems"in u)&&u.showNoDataItems,isCalculatedField:!!(u&&"isCalculatedField"in u)&&u.isCalculatedField,showEditIcon:!(u&&"showEditIcon"in u)||u.showEditIcon,showValueTypeIcon:!(u&&"showValueTypeIcon"in u)||u.showValueTypeIcon,allowDragAndDrop:!(u&&"allowDragAndDrop"in u)||u.allowDragAndDrop,showSubTotals:!(u&&"showSubTotals"in u)||u.showSubTotals,aggregateType:u&&"type"in u?u.type:"number"===(-1!==p.indexOf("_custom_group")||-1!==p.indexOf("_date_group")?"string":void 0===r||"undefined"===r?"number":r)?"Sum":"Count",baseField:u&&"baseField"in u?u.baseField:void 0,baseItem:u&&"baseItem"in u?u.baseItem:void 0})}else for(this.fieldList={};d--;){p=s[d];r=(u=this.getMappingField(p,this.fieldMapping))&&"dataType"in u&&u.dataType&&h.indexOf(u.dataType.toLowerCase())>-1?u.dataType.toLowerCase():g.getType(e[this.fieldKeys[p]]),this.fieldList[p]={id:p,caption:u&&"caption"in u&&u.caption?u.caption:p,type:-1!==p.indexOf("_custom_group")||-1!==p.indexOf("_date_group")?"string":void 0===r||"undefined"===r?"number":r,filterType:"",index:d,filter:[],sort:i?"Ascending":"None",isSelected:!1,isCustomField:-1!==p.indexOf("_custom_group")||-1!==p.indexOf("_date_group"),showFilterIcon:!(u&&"showFilterIcon"in u)||u.showFilterIcon,showRemoveIcon:!(u&&"showRemoveIcon"in u)||u.showRemoveIcon,showSortIcon:!(u&&"showSortIcon"in u)||u.showSortIcon,showEditIcon:!(u&&"showEditIcon"in u)||u.showEditIcon,showValueTypeIcon:!(u&&"showValueTypeIcon"in u)||u.showValueTypeIcon,allowDragAndDrop:!(u&&"allowDragAndDrop"in u)||u.allowDragAndDrop,showSubTotals:!(u&&"showSubTotals"in u)||u.showSubTotals,showNoDataItems:!!(u&&"showNoDataItems"in u)&&u.showNoDataItems,isCalculatedField:!!(u&&"isCalculatedField"in u)&&u.isCalculatedField,aggregateType:u&&"type"in u?u.type:"number"===(-1!==p.indexOf("_custom_group")||-1!==p.indexOf("_date_group")?"string":void 0===r||"undefined"===r?"number":r)?"Sum":"Count",baseField:u&&"baseField"in u?u.baseField:void 0,baseItem:u&&"baseItem"in u?u.baseItem:void 0}}this.updateTreeViewData(l)},e.prototype.getMappingField=function(e,t){var i={};if(t.length>0)for(var a=0,r=t.length;a<r;a++)if(t[a].name===e){i=t[a];break}return i},e.prototype.updateFieldList=function(e){for(var t=this.fields,i=t.length;i--;)this.fieldList[t[i]].isExcelFilter=e[t[i]].isExcelFilter},e.prototype.updateTreeViewData=function(e){for(var t=e.length,i=this.calculatedFieldSettings.length;t--;)if(this.fieldList[e[t].name]){var a=this.fieldList[e[t].name];a.type=e[t].dataType?e[t].dataType.toLowerCase():a.type,a.caption=e[t].caption?e[t].caption:e[t].name,a.isSelected=!0,a.showNoDataItems=e[t].showNoDataItems,a.aggregateType=e[t].type,a.baseField=e[t].baseField,a.baseItem=e[t].baseItem,a.allowDragAndDrop=e[t].allowDragAndDrop,a.showFilterIcon=e[t].showFilterIcon,a.showSortIcon=e[t].showSortIcon,a.showRemoveIcon=e[t].showRemoveIcon,a.showValueTypeIcon=e[t].showValueTypeIcon,a.showEditIcon=e[t].showEditIcon,a.showSubTotals=e[t].showSubTotals}for(;i--;)this.fieldList[this.calculatedFieldSettings[i].name]&&(this.fieldList[this.calculatedFieldSettings[i].name].aggregateType="CalculatedField",this.fieldList[this.calculatedFieldSettings[i].name].isCalculatedField=!0,this.fieldList[this.calculatedFieldSettings[i].name].formula=this.calculatedFieldSettings[i].formula)},e.prototype.getCalculatedField=function(e){for(var i=0,a=this.calculatedFieldSettings;i<a.length;i++){var r=a[i];this.calculatedFields[r.name]=t.extend({},r,null,!0),this.calculatedFields[r.name].actualFormula=r.formula}for(var n=Object.keys(this.calculatedFields),o=function(t,i){var a=s.calculatedFields[n[t]],r=a.properties,o=(r?r.formula:a.formula).trim(),l=o.replace(/"/g,"");a.formula=l.indexOf("^")>-1?s.powerFunction(l):l,-1===a.formula.indexOf("Math.min(")&&a.formula.indexOf("min(")>-1&&(a.formula=a.formula.replace(/min\(/g,"Math.min(")),-1===a.formula.indexOf("Math.max(")&&a.formula.indexOf("max(")>-1&&(a.formula=a.formula.replace(/max\(/g,"Math.max(")),-1===a.formula.indexOf("Math.abs(")&&a.formula.indexOf("abs(")>-1&&(a.formula=a.formula.replace(/abs\(/g,"Math.abs(")),a.name=r?r.name:a.name,(e=e.filter(function(e){return e!==a.name})).push(a.name);for(var d=o.split('"'),h=0,p=d.length;h<p;h++){var u=d[h].trim(),c=u.split(/[ .:;?!~,`"&|()<>{}\[\]\r\n/\\]+/),g=u.match(/^([^()]+)\((.*)\)$/),m="DistinctCount"===c[0]?"DistinctCount":"PopulationStDev"===c[0]?"PopulationStDev":"SampleStDev"===c[0]?"SampleStDev":"PopulationVar"===c[0]?"PopulationVar":"SampleVar"===c[0]?"SampleVar":c[0];if(-1!==["Sum","Count","Min","Max","Avg","Product","DistinctCount","PopulationStDev","SampleStDev","PopulationVar","SampleVar","Median"].indexOf(m)){var f=-1===e.indexOf(c[1])&&g[2]?e.indexOf(g[2]):e.indexOf(c[1]);s.calculatedFormulas[a.name]?s.calculatedFormulas[a.name].push({index:f,type:m,formula:u}):s.calculatedFormulas[a.name]=[{index:f,type:m,formula:u}]}}},s=this,l=0,d=n.length;l<d;l++)o(l);this.fields=e},e.prototype.validateFilters=function(e){this.isValueFiltersAvail=!1;var i=e.filterSettings?e.filterSettings:[],a=t.extend([],this.rows,null,!0);a=a.concat(this.columns);for(var r=0,n=i;r<n.length;r++){for(var o=n[r],s=0,l=a;s<l.length;s++){var d=l[s];if(o.name===d.name&&"Value"===o.type){this.isValueFiltersAvail=!0;break}}if(this.isValueFiltersAvail)break}},e.prototype.validateValueFields=function(){this.isValueHasAdvancedAggregate=!1;for(var e=0,t=this.values;e<t.length;e++){var i=t[e];if(-1!==["DifferenceFrom","PercentageOfDifferenceFrom","PercentageOfParentRowTotal","PercentageOfParentColumnTotal","PercentageOfParentTotal","RunningTotals"].indexOf(i.type)){this.isValueHasAdvancedAggregate=!0;break}}},e.prototype.fillFieldMembers=function(e,t){for(var i=this.fields,a=e.length,r=this.fieldList,n=i.length,o=0;o<n;o++){var s=i[o];r[s].members&&!this.allowDataCompression||(r[s].members={}),r[s].formattedMembers&&!this.allowDataCompression||(r[s].formattedMembers={}),r[s].dateMember&&!this.allowDataCompression||(r[s].dateMember=[]);for(var l=r[s].members,d=Object.keys(l).length>0,h=r[s].formattedMembers,p=r[s].dateMember,u=0,c=0,g=0;g<a;g++){var m=e[g][this.fieldKeys[s]];if(!d){var f=m,v=!this.pageSettings||this.formatFields[s]&&["date","dateTime","time"].indexOf(this.formatFields[s].type)>-1?this.getFormattedValue(m,s):{formattedText:null===m?this.localeObj?this.localeObj.getConstant("null"):String(m):void 0===m?this.localeObj?s in this.groupingFields?this.localeObj.getConstant("groupOutOfRange"):this.localeObj.getConstant("undefined"):String(m):m.toString(),actualText:null===m?this.localeObj?this.localeObj.getConstant("null"):String(m):void 0===m?this.localeObj?s in this.groupingFields?this.localeObj.getConstant("groupOutOfRange"):this.localeObj.getConstant("undefined"):String(m):m};v.formattedText&&(f=v.formattedText),l.hasOwnProperty(m)?l[m].index.push(g):(u++,l[m]={index:[g],ordinal:u,isDrilled:!!this.isExpandAll},p.push({formattedText:v.formattedText,actualText:v.dateText?v.dateText:v.actualText})),h.hasOwnProperty(f)?h[f].index.push(g):(c++,h[f]={index:[g],ordinal:c,isDrilled:!!this.isExpandAll})}t[g]?t[g][o]=l[m].ordinal:(t[g]=[],t[g][o]=l[m].ordinal)}}},e.prototype.generateValueMatrix=function(e){for(var i=this.fields,a=e.length,r=[],n=i.length,o=this.fieldList;a--;){var s=n;for(r[a]=[];s--;){var l=i[s];r[a][s]="number"===o[l].type||t.isNullOrUndefined(e[a][this.fieldKeys[l]])?t.isNullOrUndefined(e[a][this.fieldKeys[l]])?e[a][this.fieldKeys[l]]:isNaN(Number(e[a][this.fieldKeys[l]]))?void 0:Number(e[a][this.fieldKeys[l]]):1}}return r},e.prototype.updateSortSettings=function(e,t){for(var i=0,a=e?e.length:0;i<a&&t;i++)this.fieldList[e[i].name]&&(this.fieldList[e[i].name].sort=e[i].order)},e.prototype.updateFilterMembers=function(e){var t=this.filterMembers,i={},a=this.getFilters(e,i),r=this.indexMatrix.length;if(a)for(var n=i.include.index,o=0;o<n.length;o++)void 0!==i.exclude&&void 0!==i.exclude.indexObject[n[o]]||t.push(n[o]);else for(o=0;o<r;o++)void 0!==i.exclude&&void 0!==i.exclude.indexObject[o]||t.push(o)},e.prototype.getFilters=function(e,t){for(var i=e.filterSettings?e.filterSettings:[],a=!1,r=[],n=0,o=i.length;n<o;n++){var s=i[n].properties?i[n].properties:i[n];this.fieldList[s.name]&&this.fieldList[s.name].isSelected&&this.isValidFilterField(s,e.allowMemberFilter,e.allowLabelFilter)&&(this.applyLabelFilter(s),s&&(r=s.items),s.type&&"Include"===s.type?(this.frameFilterList(r,s.name,t,"include",s.showLabelFilter,a),a=!0):this.frameFilterList(r,s.name,t,"exclude",s.showLabelFilter),s.showLabelFilter&&(s.items=[],s.type=s.showDateFilter?"Date":s.showNumberFilter?"Number":"Label"))}return a},e.prototype.isValidFilterField=function(e,i,a){var r=e.name,n=!1,o=t.extend([],this.rows,null,!0);if(o=o.concat(this.columns),this.fieldList[r].isSelected&&i&&["Include","Exclude"].indexOf(e.type)>=0){n=!0;for(var s=0,l=this.values;s<l.length;s++){if(r===l[s].name){n=!1;break}}}else if(a)for(var d=0,h=o;d<h.length;d++){if(r===h[d].name&&["Label","Date","Number"].indexOf(e.type)>=0){n=!0;break}}return n},e.prototype.applyLabelFilter=function(e){if(["Label","Date","Number"].indexOf(e.type)>=0){var t=Object.keys(this.fieldList[e.name].members);if(e.showLabelFilter=!0,"Label"===e.type)e.items=this.getLabelFilterMembers(t,e.condition,e.value1,e.value2);else if("Date"===e.type){e.showDateFilter=!0;var i="string"==typeof e.value1?new Date(e.value1):e.value1,a="string"==typeof e.value2?new Date(e.value2):e.value2;e.items=this.getDateFilterMembers(t,e.name,e.condition,i,a)}else{e.showNumberFilter=!0,e.items=[];for(var r=0,n=t;r<n.length;r++){var o=n[r],s=this.getParsedValue(e.name,e.value1),l=this.getParsedValue(e.name,e.value2),d=this.getParsedValue(e.name,o);this.validateFilterValue(d,e.condition,s,l)&&e.items.push(o)}}e.type=e.condition?["DoesNotBeginWith","DoesNotContains","DoesNotEndsWith","DoesNotEquals","NotBetween"].indexOf(e.condition)>-1&&!e.showNumberFilter?"Exclude":"Include":"Exclude"}else e.showLabelFilter=!1},e.prototype.getLabelFilterMembers=function(e,t,i,a){for(var r=[],n=0,o=e;n<o.length;n++){var s=o[n],l=s.toLowerCase();if(i.toString())switch(t){case"Equals":case"DoesNotEquals":l===i.toLowerCase()&&r.push(s);break;case"BeginWith":case"DoesNotBeginWith":0===l.indexOf(i.toLowerCase())&&r.push(s);break;case"EndsWith":case"DoesNotEndsWith":null!==l.match(i.toLowerCase()+"$")&&r.push(s);break;case"Contains":case"DoesNotContains":l.indexOf(i.toLowerCase())>-1&&r.push(s);break;case"GreaterThan":l>i.toLowerCase()&&r.push(s);break;case"GreaterThanOrEqualTo":l>=i.toLowerCase()&&r.push(s);break;case"LessThan":l<i.toLowerCase()&&r.push(s);break;case"LessThanOrEqualTo":l<=i.toLowerCase()&&r.push(s);break;case"Between":case"NotBetween":l>=i.toLowerCase()&&l<=a.toLowerCase()&&r.push(s);break;default:l===i.toLowerCase()&&r.push(s)}}return r},e.prototype.getDateFilterMembers=function(e,t,i,a,r){for(var n=[],o=0,s=e;o<s.length;o++){var l=s[o],d=new Date(l);if(a)switch(i){case"Equals":case"DoesNotEquals":this.getFormattedValue(d.toString(),t).formattedText===this.getFormattedValue(a.toString(),t).formattedText&&n.push(this.getFormattedValue(l,t).formattedText);break;case"After":d.getTime()>a.getTime()&&n.push(this.getFormattedValue(l,t).formattedText);break;case"AfterOrEqualTo":d.getTime()>=a.getTime()&&n.push(this.getFormattedValue(l,t).formattedText);break;case"Before":d.getTime()<a.getTime()&&n.push(this.getFormattedValue(l,t).formattedText);break;case"BeforeOrEqualTo":d.getTime()<=a.getTime()&&n.push(this.getFormattedValue(l,t).formattedText);break;case"Between":case"NotBetween":d.getTime()>=a.getTime()&&d.getTime()<=r.getTime()&&n.push(this.getFormattedValue(l,t).formattedText);break;default:this.getFormattedValue(d.toString(),t).formattedText===this.getFormattedValue(a.toString(),t).formattedText&&n.push(this.getFormattedValue(l,t).formattedText)}}return n},e.prototype.validateFilterValue=function(e,t,i,a){var r=!1;if("number"==typeof i)switch(t){case"Equals":e===i&&(r=!0);break;case"DoesNotEquals":e!==i&&(r=!0);break;case"GreaterThan":e>i&&(r=!0);break;case"GreaterThanOrEqualTo":e>=i&&(r=!0);break;case"LessThan":e<i&&(r=!0);break;case"LessThanOrEqualTo":e<=i&&(r=!0);break;case"Between":e>=i&&e<=a&&(r=!0);break;case"NotBetween":e>=i&&e<=a||(r=!0);break;default:e!==i&&(r=!0)}return r},e.prototype.frameFilterList=function(e,t,i,a,r,n){i[a]?this.updateFilter(e,t,i,a,r,n):(i[a]={indexObject:{},index:[]},this.updateFilter(e,t,i,a,r,n))},e.prototype.updateFilter=function(e,i,a,r,n,o){var s=0,l=this.fieldList[i];l.filter=e,l.filterType=r,l.isExcelFilter=n;var d=this.formatFields[i]&&["date","dateTime","time"].indexOf(this.formatFields[i].type)>-1||i in this.groupingFields?l.formattedMembers:l.members,h=o,p={},u={};for(p[r]={indexObject:{},index:[]},this.fieldFilterMem[i]={memberObj:{}};!t.isNullOrUndefined(e[s]);){if(d[e[s]]){var c=d[e[s]].index;if("include"===r)for(var g=0,m=c.length;g<m;g++)h&&void 0===a[r].indexObject[c[g]]||(p[r].indexObject[c[g]]=c[g],p[r].index.push(c[g]));else{for(g=0,m=c.length;g<m;g++)void 0===a[r].indexObject[c[g]]&&(a[r].indexObject[c[g]]=c[g],a[r].index.push(c[g]));this.fieldFilterMem[i].memberObj[e[s]]=e[s]}}s++}if("include"===r){a[r]=p[r];for(g=0;g<e.length;g++)d[e[g]]&&(u[e[g]]=e[g]);var f=Object.keys(d);for(g=0,m=f.length;g<m;g++)void 0===u[f[g]]&&(this.fieldFilterMem[i].memberObj[f[g]]=f[g])}},e.prototype.applyValueFiltering=function(e,i,a,r,n,o,s){this.isValueFiltered=!1;var l=t.extend({},"row"===s&&this.rowGrandTotal?this.rowGrandTotal:"column"===s&&this.columnGrandTotal?this.columnGrandTotal:"Top"!==this.grandTotalsPosition?a[a.length-1]:a[0],null,!0);return this.getFilteredData(a,r,n,o,i,e.name,l,s),this.isValueFiltered&&(("row"===s&&null===this.rowGrandTotal||"column"===s&&null===this.columnGrandTotal)&&o.push(l),a=o),a},e.prototype.getFilteredData=function(e,i,a,r,n,o,s,l){for(var d=e.length,h=0;h<d;h++)if(a[o])if(e[h].level===n){this.isValueFiltered=!0,this.fieldList[o].isExcelFilter=!0;var p=0,u=a[o].measure,c=this.fieldList[u].index,g=this.fieldList[u].aggregateType;this.rawIndexObject={},p="row"===l?this.getAggregateValue(e[h].index,i.indexObject,c,g):this.getAggregateValue(i.index,e[h].indexObject,c,g);var m={fieldName:u,row:e[h],column:i,value:p,cellSets:this.getCellSet(this.rawIndexObject),rowCellType:e[h].hasChild&&e[h].isDrilled?"subTotal":"grand sum"===e[h].type?"grandTotal":"value",columnCellType:i.hasChild&&i.isDrilled?"subTotal":"grand sum"===i.type?"grandTotal":"value",aggregateType:g,skipFormatting:!1};this.getValueCellInfo&&this.getValueCellInfo(m),p=m.value,this.rawIndexObject={};var f=this.getParsedValue(u,a[o].value1),v=this.getParsedValue(u,a[o].value2);if(this.validateFilterValue(p,a[o].condition,f,v)||"grand sum"===e[h].type)"grand sum"!==e[h].type&&(r.push(t.extend({},e[h],null,!0)),r[r.length-1].isLevelFiltered=!0);else{var S=this.removefilteredData(e[h],this.valueFilteredData),y=S||e[h];this.validateFilteredParentData(y,this.valueFilteredData,s,0,n,l)}}else e[h].hasChild&&e[h].members.length>0&&"grand sum"!==e[h].type&&(r.push(t.extend({},e[h],null,!0)),r[r.length-1].members=[],r[r.length-1].isLevelFiltered=!0,this.getFilteredData(e[h].members,i,a,r[r.length-1].members,n,o,s,l))},e.prototype.getParsedValue=function(e,i){var a=i?i.toString():"";if(this.formatFields[e]&&i){var r=t.extend({},this.formatFields[e],null,!0);return delete r.name,this.globalize.parseNumber(a,r)}return this.globalize.parseNumber(a,{format:"N"})},e.prototype.removefilteredData=function(e,i){for(var a,r=t.extend([],i,null,!0),n=0;n<r.length;n++){if(e.isLevelFiltered&&e.axis===r[n].axis&&e.valueSort.levelName===r[n].valueSort.levelName&&e.actualText===r[n].actualText&&e.axis===r[n].axis&&e.level===r[n].level&&e.ordinal===r[n].ordinal){a=r[n],i.splice(n,1);break}i[n].hasChild&&i[n].members.length>0&&this.removefilteredData(e,i[n].members)}return a},e.prototype.validateFilteredParentData=function(e,t,i,a,r,n){if(t.length>0)for(var o=0,s=t;o<s.length;o++){var l=s[o];if(l.level===a){if("row"===n)for(var d=0,h=u=e.index;d<h.length;d++){var p=h[d];i.index.indexOf(p)>=0&&i.index.splice(i.index.indexOf(p),1),e.valueSort.levelName.toString().indexOf(l.valueSort.levelName.toString())>=0&&l.level!==r&&l.index.indexOf(p)>=0&&l.index.splice(l.index.indexOf(p),1)}else for(var u=e.indexObject,c=0,g=Object.keys(u);c<g.length;c++){p=g[c];u.hasOwnProperty(p)&&(delete i.indexObject[p],e.valueSort.levelName.toString().indexOf(l.valueSort.levelName.toString())>=0&&l.level!==r&&delete l.indexObject[p])}l&&l.members.length>0&&l.members[0].level===a+1&&l.members[0].level!==r&&this.validateFilteredParentData(e,l.members,i,a+1,r,n)}}else if("row"===n)for(var m=0,f=u=e.index;m<f.length;m++){p=f[m];i.index.indexOf(p)>=0&&i.index.splice(i.index.indexOf(p),1)}else{u=e.indexObject;for(var v=0,S=Object.keys(u);v<S.length;v++){p=S[v];u.hasOwnProperty(p)&&delete i.indexObject[p]}}},e.prototype.updateFramedHeaders=function(e,i,a,r,n){for(var o=0,s=e;o<s.length;o++){var l=s[o];this.isHeaderAvail=!1,(this.validateFilteredHeaders(l,a,n)||"grand sum"===l.type)&&("row"===n?this.rowCount+=this.rowValuesLength:this.columnCount+=this.colValuesLength,r.push(t.extend({},l,null,!0)),r[r.length-1].members=[],l.hasChild&&l.isDrilled&&l.members.length>0&&this.updateFramedHeaders(l.members,i,a,r[r.length-1].members,n))}return this.filterFramedHeaders},e.prototype.validateFilteredHeaders=function(e,t,i){for(var a=0,r=t;a<r.length;a++){var n=r[a];if(!this.isHeaderAvail){if(e.actualText===n.actualText&&e.level===n.level&&e.valueSort.levelName===n.valueSort.levelName)return"row"===i?n.index.length>0?(this.isHeaderAvail=!0,e.index=n.index,!0):(this.isHeaderAvail=!1,e.index=n.index,!1):Object.keys(n.indexObject).length>0?(this.isHeaderAvail=!0,e.indexObject=n.indexObject,!0):(this.isHeaderAvail=!1,e.indexObject=n.indexObject,!1);n.hasChild&&n.members.length>0&&"grand sum"!==n.type&&this.validateFilteredHeaders(e,n.members,i)}}return this.isHeaderAvail},e.prototype.isEmptyDataAvail=function(e,t){this.isEmptyData=!1,e.length>0&&"grand sum"===e[e.length-1].type&&0===e[e.length-1].index.length&&(this.isEmptyData=!0),t.length>0&&"grand sum"===t[t.length-1].type&&0===Object.keys(t[t.length-1].indexObject).length&&(this.isEmptyData=!0),0!==e.length&&0!==t.length||(this.isEmptyData=!0)},e.prototype.updateGridData=function(e){this.updateDataSourceSettings(e,!0),this.data=e.dataSource,this.pageSettings&&this.pageSettings.allowDataCompression&&(this.actualData=this.data,this.data=this.getGroupedRawData(e)),this.indexMatrix=[];for(var t=0,i=this.fields;t<i.length;t++){var a=i[t];this.fieldList[a].members={},this.fieldList[a].formattedMembers={},this.fieldList[a].dateMember=[]}this.fillFieldMembers(this.data,this.indexMatrix),this.valueMatrix=this.generateValueMatrix(this.data),this.filterMembers=[],this.cMembers=[],this.rMembers=[],this.updateFilterMembers(e),this.isEditing=!0,this.isDrillThrough=!0,this.generateGridData(e),this.isEditing=!1},e.prototype.generateGridData=function(e,i,a){void 0===i&&(i=!1),this.updateDataSourceSettings(e,i);var r=e.columns?e.columns:[],n=this.data,o=e.rows?e.rows:[],s=e.filterSettings,l=e.values?e.values:[];this.removeCount=0,this.isExpandAll=e.expandAll,this.drilledMembers=e.drilledMembers?e.drilledMembers:[],this.isEmptyData=!1;var d=[],h=o[0]&&o[0].showNoDataItems||r[0]&&r[0].showNoDataItems,p=t.extend([],this.rows,null,!0);if(p=p.concat(this.columns,this.values,this.filters),h)for(var u=0;u<this.indexMatrix.length;u++)d.push(u);for(u=0;u<this.filterMembers.length;u++)this.filterPosObj[this.filterMembers[u]]=this.filterMembers[u];this.valueSortSettings.columnIndex=void 0,this.validateValueFields(),this.frameDrillObject(),this.isValueFilterEnabled&&!this.isEditing||a||(this.isLastHeaderHasMeasures=!0,this.columnCount=0,this.rowCount=0,this.cMembers=[],this.rMembers=[],0!==o.length&&(this.rMembers=this.getIndexedHeaders(o,n,0,o[0].showNoDataItems?d:this.filterMembers,"row","",this.allowValueFilter)),0!==r.length&&(this.cMembers=this.getIndexedHeaders(r,n,0,r[0].showNoDataItems?d:this.filterMembers,"column","",this.allowValueFilter)),this.insertAllMembersCommon(),this.saveDataHeaders=this.isValueFiltersAvail&&e.allowValueFilter?{rowHeaders:t.extend([],this.rMembers,null,!0),columnHeaders:t.extend([],this.cMembers,null,!0)}:{}),this.pivotValues=[],this.headerContent=[],this.valueContent=[],this.valueFilteredData=[],this.filterFramedHeaders=[];var c=[],g=[],m=[],f=[],v=[],S=this.values.length;if(this.isValueFiltersAvail&&e.allowValueFilter&&!a){this.valueFilteredData=[];var y=this.saveDataHeaders.rowHeaders,b=this.saveDataHeaders.columnHeaders;if(s.length>0){for(var C={},x={},w=0,T=l;w<T.length;w++){var M=T[w];x[M.name]=M}for(var D=0,O=s;D<O.length;D++){var N=O[D];y=m.length>0?m:y,b=f.length>0?f:b,this.valueFilteredData=[];var E=N.properties?N.properties:N;if("Value"===E.type&&this.fieldList[N.name]&&this.fieldList[N.name].isSelected){C[N.name]=N,E.items=[];for(var P=!1,F=o.length,I=r.length,L=0;L<F;L++)if(E.name===o[L].name&&x[E.measure]&&!P){P=!0,m=this.applyValueFiltering(o[L],L,y,this.columnGrandTotal?this.columnGrandTotal:"Top"===this.grandTotalsPosition&&this.showGrandTotals?b[0]:b[b.length-1],C,this.valueFilteredData,"row");break}for(var A=0;A<I;A++)if(E.name===r[A].name&&x[E.measure]&&!P){P=!0,f=this.applyValueFiltering(r[A],A,b,this.rowGrandTotal?this.rowGrandTotal:"Top"===this.grandTotalsPosition&&this.showGrandTotals?y[0]:y[y.length-1],C,this.valueFilteredData,"column");break}}}}m=m.length>0?m:y,f=f.length>0?f:b,this.isEmptyDataAvail(m,f);var R=t.extend({},this.fieldList,null,!0);this.indexMatrix=[];var j=this.data[0];this.getFieldList(j,this.enableSort,e.allowValueFilter),this.fillFieldMembers(this.data,this.indexMatrix),this.updateSortSettings(e.sortSettings,this.enableSort),this.valueMatrix=this.generateValueMatrix(this.data),this.filterMembers=[],this.updateFilterMembers(e),this.isLastHeaderHasMeasures=!0,this.rMembers=0!==o.length?this.getIndexedHeaders(o,n,0,o[0].showNoDataItems?d:this.filterMembers,"row",""):[],this.cMembers=0!==r.length?this.getIndexedHeaders(r,n,0,r[0].showNoDataItems?d:this.filterMembers,"column",""):[],this.insertAllMembersCommon(),this.updateFieldList(R),this.rowCount=0,this.columnCount=0,this.rMembers=this.updateFramedHeaders(this.rMembers,this.rMembers,m,this.filterFramedHeaders,"row"),this.filterFramedHeaders=[],this.cMembers=this.updateFramedHeaders(this.cMembers,this.cMembers,f,this.filterFramedHeaders,"column"),this.isValueFilterEnabled=!0}a||this.applyValueSorting(),this.pageSettings&&(a?(this.rMembers=a.rowHeaders,this.cMembers=a.columnHeaders,this.rowCount=a.rowHeadersCount,this.columnCount=a.columnHeadersCount):(this.headerCollection.rowHeaders=this.rMembers,this.headerCollection.columnHeaders=this.cMembers,this.headerCollection.rowHeadersCount=this.rowCount,this.headerCollection.columnHeadersCount=this.columnCount),this.calculatePagingValues()),!this.valueAxis&&this.isLastHeaderHasMeasures&&this.getAggregatedHeaders(o,r,this.rMembers,this.cMembers,l),this.getHeaderData(o,r,l,v,this.cMembers,g,this.pivotValues,0,this.valueAxis?1:S),this.insertSubTotals(),this.getTableData(v.length>0?v:this.rMembers,c,g,0,this.pivotValues,S,0,this.rowGrandTotal?this.rowGrandTotal:this.rMembers[this.rMembers.length-1],this.columnGrandTotal?this.columnGrandTotal:this.cMembers[this.cMembers.length-1]),this.applyAdvancedAggregate(c,g,this.pivotValues),this.isEngineUpdated=!0,this.isEmptyDataAvail(this.rMembers,this.cMembers)},e.prototype.updateHeaders=function(e,i){e=t.isNullOrUndefined(e)?!(!this.showGrandTotals||!this.showRowGrandTotals)||!(this.rows.length>0):e,(this.pageSettings&&this.removeRowGrandTotal||!e&&!this.rowGrandTotal)&&"grand sum"===this.rMembers[this.rMembers.length-1].type&&(this.rMembers=this.rMembers.slice(0,this.rMembers.length-1)),i=t.isNullOrUndefined(i)?!(!this.showGrandTotals||!this.showColumnGrandTotals)||!(this.columns.length>0):i,(this.pageSettings&&this.removeColumnGrandTotal||!i&&!this.columnGrandTotal)&&"grand sum"===this.cMembers[this.cMembers.length-1].type&&(this.cMembers=this.cMembers.slice(0,this.cMembers.length-1))},e.prototype.updatePivotValues=function(e){var t=!(!this.showGrandTotals||!this.showRowGrandTotals)||!(this.rows.length>0),i=!(!this.showGrandTotals||!this.showColumnGrandTotals)||!(this.columns.length>0);if(e&&this.updateHeaders(t,i),(this.pageSettings&&this.removeRowGrandTotal||!t&&!this.rowGrandTotal)&&this.valueContent.length>0){var a=1;this.valueAxis&&this.values.length>0&&(a=1+this.values.length),this.pivotValues[this.pivotValues.length-a]&&"grand sum"===this.pivotValues[this.pivotValues.length-a][0].type&&(this.pivotValues=this.pivotValues.slice(0,this.pivotValues.length-a),this.valueContent=this.valueContent.slice(0,this.valueContent.length-a))}if((this.pageSettings&&this.removeColumnGrandTotal||!i&&!this.columnGrandTotal)&&this.headerContent.length>0){a=this.values.length;if(this.valueAxis&&this.values.length>0&&(a=1),this.pivotValues[0][this.pivotValues[0].length-a]&&"grand sum"===this.pivotValues[0][this.pivotValues[0].length-a].type)for(var r=0;r<this.pivotValues.length;r++)if(this.pivotValues[r]&&(this.pivotValues[r]=this.pivotValues[r].slice(0,this.pivotValues[r].length-a)),this.headerContent[r])for(var n=this.pivotValues[r].length;n<this.pivotValues[r].length+a;n++)delete this.headerContent[r][n]}this.removeRowGrandTotal=this.removeColumnGrandTotal=!1},e.prototype.onDrill=function(e){this.frameDrillObject(e);var t=this.getHeadersInfo(e.fieldName,e.axis);this.performDrillOperation(t.headers,e,t.fields,t.position,0),this.headerCollection.rowHeadersCount=this.rowCount,this.headerCollection.columnHeadersCount=this.columnCount,"row"===t.axis?this.headerCollection.rowHeaders=t.headers:this.headerCollection.columnHeaders=t.headers,this.updateEngine()},e.prototype.onSort=function(e){var t=this.getHeadersInfo(e.name,"");this.fieldList[e.name].sort=e.order,this.performSortOperation(t.headers,e,t,0),this.updateEngine()},e.prototype.onFilter=function(e,t){this.updateDataSourceSettings(t,!0);var i=this.getHeadersInfo(e.name,"");this.isLastHeaderHasMeasures=!!(this.valueAxis&&"row"===i.axis||!this.valueAxis&&"column"===i.axis)||this.isLastHeaderHasMeasures,"Include"===e.type&&e.items.length===this.fieldList[e.name].dateMember.length?(this.fieldList[e.name].filter=[],this.fieldList[e.name].filterType=""):(this.fieldList[e.name].filter=e.items,this.fieldList[e.name].filterType=e.type);for(var a={},r=0,n=this.filterMembers;r<n.length;r++){var o=n[r];a[o]=o}this.filterMembers=[],this.fieldFilterMem={},this.updateFilterMembers(t);for(var s=this.filterMembers.filter(function(e){return void 0===a[e]}),l=0,d=e.items;l<d.length;l++)d[l];if(this.rows[0]&&this.rows[0].showNoDataItems||this.columns[0]&&this.columns[0].showNoDataItems){var h=[];this.filterPosObj={};for(var p=0;p<s.length;p++)this.filterPosObj[s[p]]=s[p];for(p=0;p<this.indexMatrix.length;p++)h.push(p);s=h}this.performFilterCommonUpdate(e,i,s),this.frameHeaderObjectsCollection=!1,this.headerObjectsCollection={},this.updateEngine()},e.prototype.onAggregation=function(e){this.fieldList[e.name].aggregateType=e.type,this.rMembers=this.headerCollection.rowHeaders,this.cMembers=this.headerCollection.columnHeaders,this.allowDataCompression&&(this.data=this.getGroupedRawData(this.dataSourceSettings),this.valueMatrix=this.generateValueMatrix(this.data)),this.updateEngine()},e.prototype.onCalcOperation=function(e){this.rMembers=this.headerCollection.rowHeaders,this.cMembers=this.headerCollection.columnHeaders,this.getCalculatedField(this.fields),this.fieldList[e.name]?this.fieldList[e.name].formula=e.formula:(this.fieldList[e.name]={id:e.name,caption:e.name,type:"number",aggregateType:"CalculatedField",filterType:"",index:this.fields.length-1,filter:[],sort:this.enableSort?"Ascending":"None",isSelected:!0,isExcelFilter:!1,formula:e.formula},1===this.valueAxis?this.headerCollection.rowHeadersCount=this.rowCount=this.rowCount/(this.values.length-1)*this.values.length:this.headerCollection.columnHeadersCount=this.columnCount=this.columnCount/(this.values.length-1)*this.values.length),this.updateEngine()},e.prototype.performDrillOperation=function(e,t,i,a,r){for(var n=0;n<e.length;){if(a===r){if(t.memberName===e[n].valueSort.levelName.split(this.valueSortSettings.headerDelimiter).join(t.delimiter?t.delimiter:"**")){if("down"===t.action){e[n].isDrilled=!0,e[n].members=this.getIndexedHeaders(i,this.data,a+1,e[n].index,t.axis,t.memberName.split(t.delimiter?t.delimiter:"**").join(this.valueSortSettings.headerDelimiter));var o=void 0;if("row"===t.axis)o=this.applyValueSorting(e[n].members,this.cMembers),e[n].members=o.rMembers;else{var s=this.showSubTotals&&this.showColumnSubTotals&&i[a].showSubTotals;this.columnCount-=s?0:this.colValuesLength,o=this.applyValueSorting(this.rMembers,e[n].members),e[n].members=o.cMembers}}else e[n].isDrilled=!1,this.updateHeadersCount(e[n].members,t.axis,a,i,"minus",!0),e[n].members=[];break}}else e[n].members.length>0&&(e[n].members=this.performDrillOperation(e[n].members,t,i,a,r+1));n++}return e},e.prototype.performSortOperation=function(e,t,i,a){for(var r=0;r<e.length;){if(i.position===a){e=this.getSortedHeaders(e,t.order.toString());break}e[r].members.length>0&&(e[r].members=this.performSortOperation(e[r].members,t,i,a+1)),r++}return e},e.prototype.performFilterDeletion=function(e,t,i,a,r){for(var n=0,o=!0,s=function(){if(i.position===r){var s=l;e=e.filter(function(e){return!s.fieldFilterMem[t.name].memberObj[e.formattedText]||"grand sum"===e.type}),o=!1}else e[n].members.length>0&&(e[n].members=l.performFilterDeletion(e[n].members,t,i,a,r+1));n++},l=this;n<e.length&&o;)s();var d=this;return e.filter(function(e){return e.members.length>0||"grand sum"===e.type||d.matchIndexes(e.indexObject,a)})},e.prototype.matchIndexes=function(e,t){var i=Object.keys(e),a=i.length;if(0===a)return!0;for(;a>-1;){if(void 0!==t[e[i[a]]])return!0;a--}return!1},e.prototype.performFilterAddition=function(e,t,i){for(var a=0,r=function(){var r=e[a].valueSort.levelName;if(n.headerObjectsCollection[r]){for(var o={},s=0,l=e[a].members;s<l.length;s++){var d=l[s];o[d.valueSort.levelName.toString()]=d.valueSort.levelName.toString()}var h=n.headerObjectsCollection[r].filter(function(e){return!o[e.valueSort.levelName.toString()]});e[a].members=e[a].members.concat(h),e[a].members=n.getSortedHeaders(e[a].members,n.fieldList[i.fields[e[a].members[0].level].name].sort),delete n.headerObjectsCollection[r]}e[a].members.length>0&&(e[a].members=n.performFilterAddition(e[a].members,t,i)),a++},n=this;a<e.length;)r();return e},e.prototype.performFilterCommonUpdate=function(e,t,i){for(var a="row"===t.axis?this.rMembers:this.cMembers,r={},n=0,o=this.filterMembers;n<o.length;n++){var s=o[n];r[s]=s}if(this.fieldFilterMem[e.name]&&(a=this.performFilterDeletion(t.headers,e,t,r,0)),i.length>0&&t.fields.length>0){if(this.frameHeaderObjectsCollection=!0,t.fields.filter(function(e){return e.showNoDataItems}).length>0)for(var l=0;l<this.data.length;l++)i.push(l);this.headerObjectsCollection.parent=this.getIndexedHeaders(t.fields,this.data,0,i,t.axis,"");for(var d={},h=0,p=a=this.performFilterAddition(a,t.fields,t);h<p.length;h++){var u=p[h];d[u.valueSort.levelName.toString()]=u.valueSort.levelName.toString()}var c=this.headerObjectsCollection.parent.filter(function(e){return!d[e.valueSort.levelName.toString()]}),g=a.filter(function(e){return"grand sum"===e.type});g.length>0&&a.pop(),a=this.getSortedHeaders(a.concat(c),this.fieldList[t.fields[0].name].sort).concat(g),"row"===t.axis?(this.cMembers=this.getIndexedHeaders(this.columns,this.data,0,this.filterMembers,"column",""),this.insertAllMember(this.cMembers,this.filterMembers,"","column")):(this.rMembers=this.getIndexedHeaders(this.rows,this.data,0,this.filterMembers,"row",""),this.insertAllMember(this.rMembers,this.filterMembers,"","row"))}"row"===t.axis?this.rowCount=0:this.columnCount=0,this.updateHeadersCount(a,t.axis,0,t.fields,"plus",!1),"row"===t.axis?(t.position>0&&this.insertPosition(this.rows,this.data,0,this.filterMembers,"row","",a),this.insertTotalPosition(a),this.rMembers=this.headerCollection.rowHeaders=a,this.headerCollection.rowHeadersCount=this.rowCount):(t.position>0&&this.insertPosition(this.columns,this.data,0,this.filterMembers,"column","",a),this.insertTotalPosition(a),this.cMembers=this.headerCollection.columnHeaders=a,this.headerCollection.columnHeadersCount=this.columnCount),this.applyValueSorting()},e.prototype.getHeadersInfo=function(e,t){this.rMembers=this.headerCollection.rowHeaders,this.cMembers=this.headerCollection.columnHeaders;for(var i="row"===(t=""===t?this.getAxisByFieldName(e):t)?this.rMembers:this.cMembers,a="row"===t?this.rows:this.columns,r=0,n=0,o=a;n<o.length;n++){if(o[n].name===e)break;r++}return{axis:t,fields:a,headers:i,position:r}},e.prototype.updateEngine=function(){this.removeCount=0,this.validateValueFields(),this.calculatePagingValues(),this.pivotValues=[],this.headerContent=[],this.valueContent=[];var e=[],t=[],i=[],a=this.values.length;this.getAggregatedHeaders(this.rows,this.columns,this.rMembers,this.cMembers,this.values),this.getHeaderData(this.rows,this.columns,this.values,i,this.cMembers,t,this.pivotValues,0,this.valueAxis?1:a),this.insertSubTotals(),this.getTableData(i.length>0?i:this.rMembers,e,t,0,this.pivotValues,a,0,this.rowGrandTotal?this.rowGrandTotal:this.rMembers[this.rMembers.length-1],this.columnGrandTotal?this.columnGrandTotal:this.cMembers[this.cMembers.length-1]),this.applyAdvancedAggregate(e,t,this.pivotValues),this.isEngineUpdated=!0,this.isEmptyDataAvail(this.rMembers,this.cMembers)},e.prototype.getAxisByFieldName=function(e){for(var t=0,i="";t<4&&""===i;){switch(t){case 0:i=this.getFieldByName(e,this.rows)?"row":"";break;case 1:i=this.getFieldByName(e,this.columns)?"column":""}t++}return i},e.prototype.getFieldByName=function(e,t){return new i.DataManager({json:t}).executeLocal((new i.Query).where("name","equal",e))[0]},e.prototype.updateHeadersCount=function(e,t,i,a,r,n){var o=0,s=a[i],l=!0;for(l="column"===t?this.showSubTotals&&this.showColumnSubTotals&&s.showSubTotals:!(this.showSubTotals&&this.showRowSubTotals&&s)||s.showSubTotals;o<e.length;)"row"===t?this.rowCount=this.rowCount-("plus"===r?-(1===this.valueAxis?this.values.length:1):1===this.valueAxis?this.values.length:1):this.columnCount=this.columnCount-("plus"===r?-(1===this.valueAxis?1:this.values.length):1===this.valueAxis?1:this.values.length),e[o].members.length>0&&this.updateHeadersCount(e[o].members,t,i+1,a,r,!0),o++;"column"===t&&!l&&n&&(this.columnCount+="plus"===r?-this.colValuesLength:this.colValuesLength)},e.prototype.frameHeaderWithKeys=function(e){for(var t=Object.keys(e),i=0,a={};i<t.length;)a[t[i]]=e[t[i]],i++;return a},e.prototype.getSortedHeaders=function(e,t){var i=!(this.formatFields&&this.formatFields[e[0].valueSort.axis]&&this.formatFields[e[0].valueSort.axis].type),a=this.fieldList[e[0].valueSort.axis];if(i){if(a&&"number"==a.type&&e.length>0&&"string"==typeof e[0].actualText){for(var r=[],n=[],o=[],s=0;s<e.length;s++)isNaN(e[s].actualText.toString().charAt(0))?r.push(e[s]):""===e[s].actualText?o.push(e[s]):n.push(e[s]);return r.length>0&&(r="Ascending"===a.sort?r.sort(function(e,t){return"Grand Total"===e.actualText||"Grand Total"===t.actualText?0:e.actualText>t.actualText?1:t.actualText>e.actualText?-1:0}):"Descending"===a.sort?r.sort(function(e,t){return"Grand Total"===e.actualText||"Grand Total"===t.actualText?0:e.actualText<t.actualText?1:t.actualText<e.actualText?-1:0}):r),n.length>0&&(n="Ascending"===a.sort?n.sort(function(e,t){return Number(e.actualText.toString().match(/\d+/)[0])>Number(t.actualText.toString().match(/\d+/)[0])?1:Number(t.actualText.toString().match(/\d+/)[0])>Number(e.actualText.toString().match(/\d+/)[0])?-1:0}):"Descending"===a.sort?n.sort(function(e,t){return Number(e.actualText.toString().match(/\d+/)[0])<Number(t.actualText.toString().match(/\d+/)[0])?1:Number(t.actualText.toString().match(/\d+/)[0])<Number(e.actualText.toString().match(/\d+/)[0])?-1:0}):n),e=o.concat(n,r)}return"Ascending"===t?e.sort(function(e,t){return"Grand Total"===e.actualText||"Grand Total"===t.actualText?0:e.actualText>t.actualText?1:t.actualText>e.actualText?-1:0}):"Descending"===t?e.sort(function(e,t){return"Grand Total"===e.actualText||"Grand Total"===t.actualText?0:e.actualText<t.actualText?1:t.actualText<e.actualText?-1:0}):e}return"Ascending"===t?e.sort(function(e,t){return e.dateText>t.dateText?1:t.dateText>e.dateText?-1:0}):"Descending"===t?e.sort(function(e,t){return e.dateText<t.dateText?1:t.dateText<e.dateText?-1:0}):e},e.prototype.applyValueSorting=function(e,t){var i=!1;if(void 0===e||void 0===t){if(this.valueSortHeaderText=void 0,this.enableValueSorting&&this.valueSortSettings.headerText&&!this.valueSortHeaderText&&""!==this.valueSortSettings.headerText&&this.values.length>0){this.valueSortHeaderText=this.valueSortSettings.headerText;for(var a=this.valueSortHeaderText.split(this.valueSortSettings.headerDelimiter),r=0,n=this.values;r<n.length;r++){var o=n[r],s=o.caption?o.caption:o.name,l=a.indexOf(s);if(l>-1){a.splice(l,1),a.push(s),this.valueSortHeaderText=a.join(this.valueSortSettings.headerDelimiter);break}}}e=this.rMembers,t=this.cMembers,i=!0}if(this.valueSortHeaderText){a=this.valueSortHeaderText.split(this.valueSortSettings.headerDelimiter);for(var d="",h=void 0,p=void 0,u=void 0,c=0;c<this.values.length;c++){if(this.values[c].caption===a[a.length-1]){u=this.values[c].name;break}u=a[a.length-1]}if((1===this.values.length&&0===this.columns.length||this.values.length>1)&&u&&this.fieldList[u]){for(c=0;c<a.length-1;c++)d=""===d?a[c]:d+this.valueSortSettings.headerDelimiter+a[c];h=this.fieldList[u].index,p=this.fieldList[u].aggregateType}else{if(this.alwaysShowValueHeader&&1!==a.length)for(c=0;c<a.length-1;c++)d=""===d?a[c]:d+this.valueSortSettings.headerDelimiter+a[c];else d=this.valueSortHeaderText;h=this.fieldList[this.values[0].name].index,p=this.fieldList[this.values[0].name].aggregateType}var g=void 0;0===this.valueAxis?(g=this.getMember(t,d))&&(e=this.sortByValueRow(e,g,this.valueSortSettings.sortOrder,h,p)):(g=this.getMember(e,d))&&(t=this.sortByValueRow(t,g,this.valueSortSettings.sortOrder,h,p)),i&&(this.rMembers=e,this.cMembers=t,this.pageSettings&&(this.headerCollection.rowHeaders=this.rMembers,this.headerCollection.columnHeaders=this.cMembers))}return{rMembers:e,cMembers:t}},e.prototype.getMember=function(e,t){for(var i,a=e.length,r=0;r<a;r++){if(e[r].valueSort.levelName===t){i=e[r];break}if(e[r].members.length>0&&(i=this.getMember(e[r].members,t)),i)return i}return i},e.prototype.sortByValueRow=function(e,t,i,a,r){for(var n=[],o=0,s=e;o<s.length;o++){if("grand sum"===(u=s[o]).type)n.push({header:u});else{this.rawIndexObject={};var l=this.getAggregateValue(u.index,t.indexObject,a,r),d={fieldName:this.fields[a],row:u,column:t,value:l,cellSets:this.getCellSet(this.rawIndexObject),rowCellType:u.hasChild&&u.isDrilled?"subTotal":"grand sum"===u.type?"grandTotal":"value",columnCellType:t.hasChild&&t.isDrilled?"subTotal":"grand sum"===t.type?"grandTotal":"value",aggregateType:r,skipFormatting:!1};this.getValueCellInfo&&this.getValueCellInfo(d),l=d.value,this.rawIndexObject={},n.push({header:u,value:l})}}n.sort(function(e,t){return"Descending"===i?(t.value||"grand sum"===t.header.type?t.value:0)-(e.value||"grand sum"===e.header.type?e.value:0):(e.value||"grand sum"===e.header.type?e.value:0)-(t.value||"grand sum"===t.header.type?t.value:0)});for(var h=0,p=e=n.map(function(e){return e.header});h<p.length;h++){var u;(u=p[h]).members.length>0&&(u.members=this.sortByValueRow(u.members,t,i,a,r))}return e},e.prototype.insertAllMembersCommon=function(){this.rowGrandTotal=this.columnGrandTotal=null;var e=!(!this.showGrandTotals||!this.showRowGrandTotals)||!(this.rows.length>0),t=!(!this.showGrandTotals||!this.showColumnGrandTotals)||!(this.columns.length>0);this.isValueHasAdvancedAggregate?(this.insertAllMember(this.rMembers,this.filterMembers,"","row"),e&&(this.rowCount+=this.rowValuesLength),this.insertAllMember(this.cMembers,this.filterMembers,"","column"),t&&(this.columnCount+=this.colValuesLength)):(e?(this.insertAllMember(this.rMembers,this.filterMembers,"","row"),this.rowCount+=this.rowValuesLength):this.rowGrandTotal=this.insertAllMember([],this.filterMembers,"","row")[0],t?(this.insertAllMember(this.cMembers,this.filterMembers,"","column"),this.columnCount+=this.colValuesLength):this.columnGrandTotal=this.insertAllMember([],this.filterMembers,"","column")[0])},e.prototype.insertSubTotals=function(){for(var e=this.pivotValues.length,i=0;i<e;i++){var a=this.pivotValues[i];if(a)for(var r=void 0,n=1,o=void 0,s=a.length-1;s>0;s--){var l=a[s];if(l){r&&(r.colSpan=n,r.colIndex=r.colIndex-(n-1)),o={index:l.index,indexObject:l.indexObject},l.index=[],l.indexObject={},r=t.extend({},l,null,!0),l.index=o.index,l.indexObject=o.indexObject;for(var d=i+1;this.pivotValues[d]&&!this.pivotValues[d][s];){var h=this.pivotValues[i][s];h.isDrilled||!this.valueAxis&&!this.isLastHeaderHasMeasures&&h.members&&h.members.length>0&&d>this.measureIndex||(h.rowSpan=d-i+1,r.rowSpan=d-i+1);var p="sum"===l.type||"grand sum"===l.type?l.type:"sum";this.pivotValues[d][s]=this.headerContent[d][s]={type:p,formattedText:"sum"===l.type||"grand sum"===l.type?l.formattedText:l.formattedText+" Total",axis:"column",level:-1,colIndex:s,rowIndex:d,valueSort:l.valueSort},l.valueSort&&l.valueSort[this.valueSortSettings.headerText]&&(this.valueSortSettings.columnIndex=s);var u=!1;"grand sum"===p?(h.rowSpan=d-i+1,r.rowSpan=d-i+1):"sum"!==h.type&&(h.isDrilled||!this.valueAxis&&!this.isLastHeaderHasMeasures&&h.members&&h.members.length>0)?(this.pivotValues[i+1][s].rowSpan=d-i,u=!0):this.pivotValues[d][s].rowSpan=-1,d>i+1&&("sum"===h.type||u)&&(this.pivotValues[d][s].rowSpan=-1),d++}n=1}else a[s]=this.headerContent[i][s]=t.extend({},r,null,!0),a[s].index=this.headerContent[i][s].index=o.index,a[s].indexObject=this.headerContent[i][s].indexObject=o.indexObject,n++,a[s].colSpan=n,a[s].colIndex=a[s].colIndex-(n-1);1===s&&r&&(r.colSpan=n,r.colIndex=r.colIndex-(n-1))}}},e.prototype.frameDrillObject=function(e){void 0===e&&(e=null),this.fieldDrillCollection={};for(var t=0;t<this.drilledMembers.length;t++){for(var i=this.drilledMembers[t],a=!1,r=1,n=!1,o=0;o<this.rows.length;o++)if(this.rows[o].name==i.name){r=((s=this.valueAxis&&(this.isMultiMeasures||this.alwaysShowValueHeader)&&this.measureIndex>-1&&this.measureIndex<=o)?o+1:o)+1,a=!!s,n=!0;break}if(!n)for(o=0;o<this.columns.length;o++)if(this.columns[o].name==i.name){var s;r=((s=!this.valueAxis&&(this.isMultiMeasures||this.alwaysShowValueHeader)&&this.measureIndex>-1&&this.measureIndex<=o)?o+1:o)+1,a=!!s,n=!0;break}for(var l=0,d=i.items;l<d.length;l++){var h=d[l],p=h.split(i.delimiter);if(r===p.length){var u=i.name+this.valueSortSettings.headerDelimiter+p.join(this.valueSortSettings.headerDelimiter);if(this.fieldDrillCollection[u]=u,a){var c=!1;if(this.isExpandAll)for(var g=0,m=this.values;g<m.length;g++){var f=m[g],v=f.caption?f.caption:f.name;if(p[this.measureIndex]=v,!(i.items.indexOf(p.join(i.delimiter))>-1)){c=!1;break}c=!0}(this.isExpandAll&&c||!this.isExpandAll)&&((p=h.split(i.delimiter)).splice(this.measureIndex,1),e&&e.memberName===h&&(e.memberName=p.join(i.delimiter)),u=i.name+this.valueSortSettings.headerDelimiter+p.join(this.valueSortSettings.headerDelimiter),this.fieldDrillCollection[u]=u)}}}}},e.prototype.getIndexedHeaders=function(e,i,a,r,n,o,s){var l=[];if(e){var d=e.length,h={},p=e[a].name,u=e[a],c=this.fieldList[p];if(t.isNullOrUndefined(this.reportDataType)){this.reportDataType={};for(var g=0;g<this.dataSourceSettings.rows.length;g++)this.reportDataType[this.dataSourceSettings.rows[g].name]=this.dataSourceSettings.rows[g].dataType;for(g=0;g<this.dataSourceSettings.columns.length;g++)this.reportDataType[this.dataSourceSettings.columns[g].name]=this.dataSourceSettings.columns[g].dataType;for(g=0;g<this.dataSourceSettings.values.length;g++)this.reportDataType[this.dataSourceSettings.values[g].name]=this.dataSourceSettings.values[g].dataType}c.type=t.isNullOrUndefined(this.reportDataType[c.id])?c.type:this.reportDataType[c.id];var m=!1,f=this.formatFields[p]&&["date","dateTime","time"].indexOf(this.formatFields[p].type)>-1,v=r.length<1&&a>0||u.showNoDataItems,S={};if(v){for(var y=Object.keys(c.members),b=0,C=y.length;b<C;b++)(this.showHeaderWhenEmpty||this.localeObj&&y[b]!==this.localeObj.getConstant("undefined"))&&(S[y[b]]=y[b]);r.length<1&&(m=!0,r.length=y.length)}for(b=0,C=r.length;b<C;b++){var x={};t.isNullOrUndefined(e[a].showSubTotals)||e[a].showSubTotals||(x.showSubTotals=!1),x.hasChild=a<d-1,x.level=a,x.axis=n,x.colSpan=1;var w=m?c.members[Object.keys(S)[0]].ordinal:this.indexMatrix[r[b]][c.index],T=m?Object.keys(S)[0]:i[r[b]][this.fieldKeys[p]];if(!(t.isNullOrUndefined(T)||this.localeObj&&T===this.localeObj.getConstant("undefined"))||this.showHeaderWhenEmpty){if(delete S[T],!v||!this.fieldFilterMem[p]||this.fieldFilterMem[p].memberObj[T]!==T){var M=f?{actualText:T,formattedText:c.dateMember[w-1].formattedText,dateText:c.dateMember[w-1].actualText}:{formattedText:null===T?this.localeObj?this.localeObj.getConstant("null"):String(T):void 0===T&&this.localeObj?p in this.groupingFields?this.localeObj.getConstant("groupOutOfRange"):this.localeObj.getConstant("undefined"):String(T),actualText:null===T?this.localeObj?this.localeObj.getConstant("null"):String(T):void 0===T?this.localeObj?p in this.groupingFields?this.localeObj.getConstant("groupOutOfRange"):this.localeObj.getConstant("undefined"):String(T):T};x.actualText=M.actualText,x.formattedText=M.formattedText,f&&(x.dateText=M.dateText);var D=!v||void 0!==this.filterPosObj[r[b]]&&!m;if(h&&h[w])D&&(h[w].index.push(r[b]),h[w].indexObject[r[b]]=r[b]);else{h[w]={index:[],indexObject:{}},x.index=h[w].index,x.indexObject=h[w].indexObject,D&&(x.index=h[w].index=[r[b]],h[w].indexObject[r[b]]=r[b],x.indexObject=h[w].indexObject),x.ordinal=w,x.valueSort={},x.valueSort.axis=p,0!==a?(x.valueSort.levelName=o+this.valueSortSettings.headerDelimiter+x.formattedText,x.valueSort[o+this.valueSortSettings.headerDelimiter+x.formattedText]=1,x.valueSort.uniqueName=o+this.valueSortSettings.headerDelimiter+(x.actualText?x.actualText:x.formattedText),x.valueSort[o+this.valueSortSettings.headerDelimiter+(x.actualText?x.actualText:x.formattedText)]=1):(x.valueSort[x.formattedText]=1,x.valueSort.levelName=x.formattedText,x.valueSort[x.actualText?x.actualText:x.formattedText]=1,x.valueSort.uniqueName=x.actualText?x.actualText:x.formattedText);var O=x.valueSort.axis+this.valueSortSettings.headerDelimiter+x.valueSort.levelName;x.isDrilled=!(!s||!this.isValueFiltersAvail)||(x.hasChild&&this.fieldDrillCollection[O]?!this.isExpandAll:c.members[T].isDrilled),x.members=[],l.push(x)}v&&!m&&a>0&&b+1===r.length&&Object.keys(S).length>0&&(m=!0,C=Object.keys(S).length,b=-1)}}else v&&!m&&a>0&&b+1===r.length&&Object.keys(S).length>0&&(C=Object.keys(S).length,m=!0,b=-1)}n==this.dataSourceSettings.valueAxis&&this.measureIndex==a&&(this.values.length>1||this.alwaysShowValueHeader)&&(this.isLastHeaderHasMeasures=!1);for(var N=0,E=l.length;N<E;N++){this.frameHeaderObjectsCollection||("row"===n?this.rowCount+=this.rowValuesLength:this.columnCount+=this.colValuesLength);var P=null;if(l[N].valueSort&&l[N].valueSort.levelName&&(P=l[N].valueSort.levelName),o=P||l[N].formattedText,!this.showHeaderWhenEmpty&&d-1>a&&l[N].index&&l[N].index.length>0)if(v&&e[a+1]&&e[a+1].name&&Object.keys(this.fieldList[e[a+1].name].members).length>0)l[N].hasChild=!0;else{for(var F=l[N].index.length,I=0,L=0;L<F;L++){T=i[l[N].index[L]][this.fieldKeys[e[a+1].name]];(t.isNullOrUndefined(T)||this.localeObj&&T===this.localeObj.getConstant("undefined"))&&I++}l[N].hasChild=I!==F}if(d-1>a&&l[N].isDrilled){this.columnCount-=this.showSubTotals&&this.showColumnSubTotals&&u.showSubTotals||"column"!==n?0:this.colValuesLength;var A=l[N].index;l[N].members=this.getIndexedHeaders(e,i,a+1,void 0===A?[]:A,n,o),this.frameHeaderObjectsCollection&&(this.headerObjectsCollection[o]=l[N].members)}}if(this.enableSort){if(f)return"Ascending"===c.sort?l.sort(function(e,t){return e.dateText>t.dateText?1:t.dateText>e.dateText?-1:0}):"Descending"===c.sort?l.sort(function(e,t){return e.dateText<t.dateText?1:t.dateText<e.dateText?-1:0}):l;if("number"===c.type&&l.length>0&&"string"==typeof l[0].actualText){var R=[],j=[],k=[];for(g=0;g<l.length;g++)isNaN(l[g].actualText.toString().charAt(0))?R.push(l[g]):""===l[g].actualText?k.push(l[g]):j.push(l[g]);return R.length>0&&(R="Ascending"===c.sort?R.sort(function(e,t){return e.actualText>t.actualText?1:t.actualText>e.actualText?-1:0}):"Descending"===c.sort?R.sort(function(e,t){return e.actualText<t.actualText?1:t.actualText<e.actualText?-1:0}):R),j.length>0&&(j="Ascending"===c.sort?j.sort(function(e,t){return Number(e.actualText.toString().match(/\d+/)[0])>Number(t.actualText.toString().match(/\d+/)[0])?1:Number(t.actualText.toString().match(/\d+/)[0])>Number(e.actualText.toString().match(/\d+/)[0])?-1:0}):"Descending"===c.sort?j.sort(function(e,t){return Number(e.actualText.toString().match(/\d+/)[0])<Number(t.actualText.toString().match(/\d+/)[0])?1:Number(t.actualText.toString().match(/\d+/)[0])<Number(e.actualText.toString().match(/\d+/)[0])?-1:0}):j),l=k.concat(j,R)}return"Ascending"===c.sort?l.sort(function(e,t){return e.actualText>t.actualText?1:t.actualText>e.actualText?-1:0}):"Descending"===c.sort?l.sort(function(e,t){return e.actualText<t.actualText?1:t.actualText<e.actualText?-1:0}):l}return l}return l},e.prototype.getOrderedIndex=function(e){for(var t={},i=0;i<e.length;i++)"grand sum"!==e[i].type&&(t[e[i].ordinal]=i);return t},e.prototype.insertPosition=function(e,t,i,a,r,n,o){var s=[],l=this.getOrderedIndex(o);if(e){for(var d={},h=e[i].name,p=this.fieldList[h],u=0,c=a.length;u<c;u++){var g={},m=this.indexMatrix[a[u]][p.index],f=o[l[m]],v=t[a[u]][this.fieldKeys[h]];v=null===v?this.localeObj?this.localeObj.getConstant("null"):String(v):v;var S=this.formatFields[h]&&["date","dateTime","time"].indexOf(this.formatFields[h].type)>-1?this.getFormattedValue(v,h):{formattedText:v.toString(),actualText:v.toString()};f&&f.formattedText===S.formattedText&&(d&&d[m]?(d[m].index.push(a[u]),d[m].indexObject[a[u]]=a[u]):(d[m]={index:[],indexObject:{}},f.index=d[m].index=[a[u]],d[m].indexObject[a[u]]=a[u],f.indexObject=d[m].indexObject,f.valueSort={},f.valueSort.axis=h,0!==i?(f.valueSort.levelName=n+this.valueSortSettings.headerDelimiter+f.formattedText,f.valueSort[n+this.valueSortSettings.headerDelimiter+f.formattedText]=1,f.valueSort.uniqueName=n+this.valueSortSettings.headerDelimiter+(f.actualText?f.actualText:f.formattedText),f.valueSort[n+this.valueSortSettings.headerDelimiter+(f.actualText?f.actualText:f.formattedText)]=1):(f.valueSort[f.formattedText]=1,f.valueSort.levelName=f.formattedText,f.valueSort[f.actualText?f.actualText:f.formattedText]=1,f.valueSort.uniqueName=f.actualText?f.actualText:f.formattedText),g.members=[],s.push(g)))}for(var y=o.length-s.length;y>0;)s.push({members:[]}),y--;for(var b=0,C=s.length;b<C;b++)if(o[b].members.length>0){var x=null;o[b].valueSort&&o[b].valueSort.levelName&&(x=o[b].valueSort.levelName),n=x||o[b].formattedText,s[b].members=this.insertPosition(e,t,i+1,o[b].index,r,n,o[b].members)}return s}return s},e.prototype.insertTotalPosition=function(e){var t=e[e.length-1];if(t&&"grand sum"===t.type){t.index=this.filterMembers,t.indexObject={};for(var i=0,a=this.filterMembers.length;i<a;i++)t.indexObject[this.filterMembers[i]]=this.filterMembers[i]}return e},e.prototype.calculatePagingValues=function(){if(this.pageSettings){1===this.valueAxis?this.rowValuesLength=this.values.length:this.colValuesLength=this.values.length,this.memberCnt=-this.rowValuesLength,this.rowStartPos=(this.pageSettings.rowCurrentPage*this.pageSettings.rowSize-this.pageSettings.rowSize)*this.rowValuesLength;var e=this.rowStartPos+3*this.pageSettings.rowSize*this.rowValuesLength>this.rowCount?this.rowCount-3*this.pageSettings.rowSize*this.rowValuesLength:this.rowStartPos;e<0&&(e=this.rowStartPos=0,this.pageSettings.rowCurrentPage=1),this.rowFirstLvl=(this.rowStartPos-e)%this.pageSettings.rowSize,this.rowStartPos=e,this.endPos=this.rowStartPos+3*this.pageSettings.rowSize*this.rowValuesLength,this.endPos=this.endPos>this.rowCount?this.rowCount:this.endPos,this.rMembers=this.performSlicing(this.rMembers,[],this.rowStartPos,"row"),this.memberCnt=-this.colValuesLength,this.pageInLimit=!1,this.colHdrBufferCalculated=!1,this.colStartPos=(this.pageSettings.columnCurrentPage*this.pageSettings.columnSize-this.pageSettings.columnSize)*this.colValuesLength,(e=this.colStartPos+3*this.pageSettings.columnSize*this.colValuesLength>this.columnCount?this.columnCount-3*this.pageSettings.columnSize*this.colValuesLength:this.colStartPos)<0&&(e=this.colStartPos=0,this.pageSettings.columnCurrentPage=1),this.colFirstLvl=(this.colStartPos-e)%this.pageSettings.columnSize,this.colStartPos=e,this.endPos=this.colStartPos+3*this.pageSettings.columnSize*this.colValuesLength,this.endPos=this.endPos>this.columnCount?this.columnCount:this.endPos,this.cMembers=this.performSlicing(this.cMembers,[],this.colStartPos,"column"),this.memberCnt=-1,this.pageInLimit=!1,this.isValueHasAdvancedAggregate?("grand sum"!==this.rMembers[this.rMembers.length-1].type&&"grand sum"===this.headerCollection.rowHeaders[this.headerCollection.rowHeaders.length-1].type&&(this.rMembers.push(this.headerCollection.rowHeaders[this.headerCollection.rowHeaders.length-1]),this.removeRowGrandTotal=!0),"grand sum"!==this.cMembers[this.cMembers.length-1].type&&"grand sum"===this.headerCollection.columnHeaders[this.headerCollection.columnHeaders.length-1].type&&(this.cMembers.push(this.headerCollection.columnHeaders[this.headerCollection.columnHeaders.length-1]),this.removeColumnGrandTotal=!0)):(this.rowGrandTotal=this.rowGrandTotal?this.rowGrandTotal:this.headerCollection.rowHeaders[this.headerCollection.rowHeaders.length-1],this.columnGrandTotal=this.columnGrandTotal?this.columnGrandTotal:this.headerCollection.columnHeaders[this.headerCollection.columnHeaders.length-1])}},e.prototype.performSlicing=function(e,t,i,a){for(var r=0;e[r];){if(this.memberCnt+="column"===a?this.colValuesLength:this.rowValuesLength,i<=this.memberCnt&&this.endPos>=this.memberCnt&&!this.pageInLimit&&("column"===a?this.colFirstLvl=this.colFirstLvl+e[r].level:this.rowFirstLvl=this.rowFirstLvl+e[r].level,this.pageInLimit=!0),this.pageInLimit&&this.endPos<=this.memberCnt){if("column"!==a)break;if(0===e[r].members.length){if(this.colHdrBufferCalculated)break;this.colHdrBufferCalculated=!0,this.endPos+=e[r].level*this.colValuesLength}else if(this.colHdrBufferCalculated)break}if(t.push(e[r].members.length>0?this.removeChildMembers(e[r]):e[r]),e[r].members.length>0&&("column"===a&&(this.memberCnt-=this.showSubTotals&&this.showColumnSubTotals&&this.columnKeys[e[r].valueSort.axis].showSubTotals?0:this.colValuesLength),t[t.length-1].members=this.performSlicing(e[r].members,[],i,a)),this.pageInLimit||t.pop(),0===e[r].level&&this.pageInLimit&&this.endPos<=this.memberCnt)break;r++}return t},e.prototype.removeChildMembers=function(e){for(var t=Object.keys(e),i=0,a={};i<t.length;)a[t[i]]=e[t[i]],"members"===t[i]&&(a.members=[]),i++;return a},e.prototype.insertAllMember=function(e,t,i,a){var r={hasChild:!1,index:t,level:0,axis:a,isDrilled:!1,indexObject:{},members:[],actualText:"Grand"+(i=" Total"),formattedText:"Grand"+i,ordinal:e.length,type:"grand sum",valueSort:{}};r.valueSort[r.formattedText]=1,r.valueSort.levelName=r.formattedText,r.valueSort[r.actualText]=1,r.valueSort.uniqueName=r.actualText;for(var n=0,o=t.length;n<o;n++)r.indexObject[t[n]]=t[n];return"Top"===this.dataSourceSettings.grandTotalsPosition&&this.dataSourceSettings.showGrandTotals?e.unshift(r):e.push(r),e},e.prototype.getTableData=function(e,i,a,r,n,o,s,l,d){for(var h=e.length,p=0;p<h;p++){var u=!this.valueAxis&&!this.isLastHeaderHasMeasures&&n.length<this.columns.length+1?this.columns.length+1:n.length,c=e[p];i[u]=c;var g=u-Number(Object.keys(i)[0]),m=!i[u].members.length;c.colIndex=0,c.rowIndex=u;var f=!1,v=this.dataSourceSettings.valueSortSettings.headerDelimiter;if(this.valueAxis&&0===this.dataSourceSettings.rows.length&&this.dataSourceSettings.values.length>1&&(this.rowIndex=t.isNullOrUndefined(this.rowIndex)&&!m&&0===this.dataSourceSettings.rows.length?c.index:this.rowIndex,f=this.valueAxis&&0===this.dataSourceSettings.rows.length&&c.valueSort.levelName&&0!==c.valueSort.levelName.toString().indexOf("Grand Total"+v),this.valueAxis&&0===this.dataSourceSettings.rows.length&&0===c.valueSort.levelName.toString().indexOf("Grand Total"+v)&&(c.index=this.rowIndex)),f)m||this.recursiveRowData(e,i,a,u,n,o,m,p,0,s,l,d);else if(n[u]?n[u][0]=this.valueContent[g][0]=this.frameHeaderWithKeys(c):(n[u]=[],this.valueContent[g]={},n[u][0]=this.valueContent[g][0]=this.frameHeaderWithKeys(c)),this.valueAxis&&(this.isMultiMeasures||this.alwaysShowValueHeader)){var S=u,y=g,b=u,C=!1;if(((0!==s||0!==this.measureIndex)&&!m||m)&&"value"===c.type&&!c.valueSort.axis||s>this.measureIndex&&"row"===c.axis&&c.valueSort.axis)for(var x=0,w=!1,T=0,M=1,D=a.length;T<D;++T){if(!w)for(x=0;x<o;x++)if(c.valueSort.uniqueName&&c.valueSort.uniqueName.toString().indexOf(this.values[x].name)>-1){w=!0,C=!0;break}if(s>this.measureIndex&&"row"==c.axis&&c.valueSort.axis)this.updateRowData(e,a,u,n,x,p,T,M,g,l,d);else{if(!i[r]){C=!1;break}this.updateRowData(i,a,u,n,x,r,T,M,g,l,d)}M=n[u].length}if(!C)for(T=0,M=1,D=a.length;T<D;++T)M=n[u].length,n[S][M]=this.valueContent[y][M]={axis:"value",actualText:"",colSpan:1,colIndex:M,formattedText:"",hasChild:!1};this.recursiveRowData(e,i,a,b,n,o,m,p,o,s,l,d)}else{for(T=0,M=1,D=a.length;T<D;++T)for(x=0;x<o;x++)this.valueAxis||this.isLastHeaderHasMeasures?(this.updateRowData(e,a,u,n,x,p,T,M,g,l,d),M=n[u].length):a[T].valueSort.uniqueName&&a[T].valueSort.uniqueName.toString().indexOf(this.values[x].name)>-1&&(this.updateRowData(e,a,u,n,x,p,T,M,g,l,d),M=n[u].length);this.recursiveRowData(e,i,a,u,n,o,m,p,0,s,l,d)}}},e.prototype.getAggregatedHeaders=function(e,t,i,a,r){this.selectedHeaders={selectedHeader:[],values:[]};for(var n=r.length,o=0;o<n;o++)switch(r[o].type){case"DifferenceFrom":case"PercentageOfDifferenceFrom":var s=void 0,l=void 0;this.selectedHeaders.values.push(r[o].name),r[o].baseField&&r[o].baseItem?(s=r[o].baseField,l=r[o].baseItem):this.valueAxis&&(this.isMultiMeasures||this.alwaysShowValueHeader)&&t.length>0?(s=t[0].name,l=Object.keys(this.fieldList[t[0].name].members)[0]):e.length>0&&(s=e[0].name,l=Object.keys(this.fieldList[e[0].name].members)[0]);for(var d=!1,h=0,p=e;h<p.length;h++){if(p[h].name===s){this.getAggregatedHeaderData(i,r[o].name,l,!1,"row",r[o].type,this.selectedHeaders.selectedHeader,o),d=!0;break}}if(!d)for(var u=0,c=t;u<c.length;u++){if(c[u].name===s){this.getAggregatedHeaderData(a,r[o].name,l,!1,"column",r[o].type,this.selectedHeaders.selectedHeader,o);break}}break;case"PercentageOfParentRowTotal":case"PercentageOfParentColumnTotal":this.selectedHeaders.values.push(r[o].name),this.getAggregatedHeaderData("PercentageOfParentRowTotal"===r[o].type?i:a,r[o].name,void 0,!1,"PercentageOfParentRowTotal"===r[o].type?"row":"column",r[o].type,this.selectedHeaders.selectedHeader,o);break;case"RunningTotals":this.selectedHeaders.values.push(r[o].name),this.getAggregatedHeaderData(this.valueAxis&&(this.isMultiMeasures||this.alwaysShowValueHeader)?a:i,r[o].name,void 0,!1,this.valueAxis&&(this.isMultiMeasures||this.alwaysShowValueHeader)?"column":"row",r[o].type,this.selectedHeaders.selectedHeader,o);break;case"PercentageOfParentTotal":s=void 0;this.selectedHeaders.values.push(r[o].name),r[o].baseField?s=r[o].baseField:this.valueAxis&&(this.isMultiMeasures||this.alwaysShowValueHeader)&&t.length>0?s=t[0].name:e.length>0&&(s=e[0].name);d=!1;for(var g=e.length,m=0;m<g;m++)if(e[m].name===s){var f=m>=this.measureIndex?m+1:m;this.getAggregatedHeaderData(i,r[o].name,void 0,!1,"row",r[o].type,this.selectedHeaders.selectedHeader,o,f),d=!0;break}if(!d)for(g=t.length,m=0;m<g;m++)if(t[m].name===s){f=m;this.valueAxis||this.isLastHeaderHasMeasures||(f=m>=this.measureIndex?m+1:m),this.getAggregatedHeaderData(a,r[o].name,void 0,!1,"column",r[o].type,this.selectedHeaders.selectedHeader,o,f);break}}},e.prototype.getAggregatedHeaderData=function(e,i,a,r,n,o,s,l,d){for(var h=0,p=e;h<p.length;h++){var u=p[h];switch(o){case"DifferenceFrom":case"PercentageOfDifferenceFrom":if(-1!==u.valueSort.levelName.toString().split(this.valueSortSettings.headerDelimiter).indexOf(a)){var c=[];if(!r&&"row"===n)for(var g=0,m=e;g<m.length;g++){var f=m[g];f.level>=u.level&&c.push(f)}if(s.push(this.updateSelectedHeaders(a,u.level,n,r,i,o,u.valueSort.levelName,r?[u]:"column"===n?e:c,l+1)),u.members.length>0){var v=!1,S=[];if("row"===n)for(var y=0,b=u.members;y<b.length;y++){if("value"!==(T=b[y]).type||0!==T.members.length){S.push(T),v=!1;break}v=!0}(!v&&S.length>0||"column"===n)&&this.getAggregatedHeaderData("column"===n?u.members:S,i,a,!0,n,o,s[s.length-1].childMembers,l)}}else u.members.length>0&&this.getAggregatedHeaderData(u.members,i,a,!1,n,o,s,l);break;case"RunningTotals":case"PercentageOfParentRowTotal":case"PercentageOfParentColumnTotal":"grand sum"===u.type?s.push(this.updateSelectedHeaders(void 0,u.level,n,!1,i,o,u.valueSort.levelName,e,l+1)):u.members.length>0&&(s.push(this.updateSelectedHeaders(void 0,u.level,n,!1,i,o,u.valueSort.levelName,u.members,l+1)),this.getAggregatedHeaderData(u.members,i,void 0,!1,n,o,s,l));break;case"PercentageOfParentTotal":if("grand sum"!==u.type)if(u.valueSort.levelName.split(this.valueSortSettings.headerDelimiter).length-1===d)if(u.members.length>0){if(r)for(var C=s[s.length-1].aggregateHeaders,x=0,w=u.members;x<w.length;x++){var T=w[x];C.push(t.extend({},T,null,!0))}else{var M=t.extend([],u.members,null,!0);s.push(this.updateSelectedHeaders(void 0,u.level,n,!1,i,o,u.valueSort.levelName,M,l+1));(C=s[s.length-1].aggregateHeaders).push(t.extend({},u,null,!0))}this.getAggregatedHeaderData(u.members,i,void 0,!0,n,o,s,l,d+1)}else r||s.push(this.updateSelectedHeaders(void 0,u.level,n,!1,i,o,u.valueSort.levelName,[u],l+1));else u.members.length>0&&this.getAggregatedHeaderData(u.members,i,void 0,!1,n,o,s,l,d)}}},e.prototype.updateSelectedHeaders=function(e,i,a,r,n,o,s,l,d){return{name:e,level:i,axis:a,isChild:r,value:n,type:o,uniqueName:s,aggregateHeaders:t.extend([],l,null,!0),childMembers:[],valueCount:d}},e.prototype.applyAdvancedAggregate=function(e,t,i){if(this.aggregatedValueMatrix=[],this.selectedHeaders.values.length>0){for(var a={},r=[],n=[],o=!1,s=i.length,l=0;l<s;l++)if(void 0!==i[l]&&void 0!==i[l][0]){if(!o)for(var d=i[l].length,h=0;h<d;h++)"value"===i[l][h].axis&&-1!==this.selectedHeaders.values.indexOf(i[l][h].actualText)&&(r.push(h),o=!0);if(r.length>0&&"value"===i[l][r[0]].axis&&-1!==this.selectedHeaders.values.indexOf(i[l][r[0]].actualText)){n.push(l);for(var p=0,u=r;p<u.length;p++){a[l+","+(m=u[p])]=[l,m]}}}this.updateAggregates(e,t,i,this.selectedHeaders.selectedHeader,r,n,a);for(var c=0,g=Object.keys(a);c<g.length;c++){var m;i[a[m=g[c]][0]][a[m][1]].formattedText=this.selectedHeaders.selectedHeader.length>0?this.emptyCellTextContent:"#N/A",this.aggregatedValueMatrix[a[m][0]]||(this.aggregatedValueMatrix[a[m][0]]=[]),this.aggregatedValueMatrix[a[m][0]][a[m][1]]=0}this.updatePivotValues(!0)}},e.prototype.updateAggregates=function(e,i,a,r,n,o,s){for(var l=0,d=r;l<d.length;l++){var h=d[l],p=h.aggregateHeaders,u=h.value,c=h.type,g=h.uniqueName,m="row"===h.axis,f=void 0,v=[],S=[],y=[],b=[],C=[],x=[];if(-1!==["DifferenceFrom","PercentageOfDifferenceFrom","PercentageOfParentRowTotal","PercentageOfParentColumnTotal","PercentageOfParentTotal","RunningTotals"].indexOf(h.type))if(m){if("RunningTotals"!==h.type)for(var w=0,T=o;w<T.length;w++){if(void 0!==e[Ve=T[w]]&&e[Ve].valueSort[g]){f=e[Ve],C=0===this.valueAxis||this.valueAxis&&a[Ve]&&a[Ve][1]&&a[Ve][1].actualText===u?a[Ve]:[];break}}}else{for(var M=a.length,D=0;D<M&&(void 0!==a[D]&&void 0===a[D][0]);D++)y.push(a[D]);for(var O=y.length;O--;){var N=(R=y[O][n[0]]).actualText;-1===this.selectedHeaders.values.indexOf(N)&&(S=y[O],O=0)}if("RunningTotals"!==h.type){for(var E=S.length,P=0;P<E;P++){var F=!1;if(void 0!==S[P]&&S[P].valueSort[g]){f=S[P];var I=a.length;for(D=0;D<I;D++){void 0!==(R=a[D])&&void 0!==R[0]&&"value"===R[P].axis&&-1!==this.selectedHeaders.values.indexOf(R[P].actualText)&&(F=!0,x[D]=R[P],b.push(D))}if(F)break}}if(0===x.length&&0===b.length)for(E=S.length,P=0;P<E;P++){F=!1;if(void 0!==S[P]&&0===S[P].valueSort.levelName.indexOf(g)){f=S[P];for(var L=a.length,A=0;A<L;A++){var R;void 0!==(R=a[A])&&void 0!==R[0]&&"value"===R[P].axis&&-1!==this.selectedHeaders.values.indexOf(R[P].actualText)&&(F=!0,b.push(A))}if(F)break}}}}switch(h.type){case"DifferenceFrom":case"PercentageOfDifferenceFrom":var j=h.isChild;if(m){if(j)for(var k=g.split(this.valueSortSettings.headerDelimiter),q=0,V=o;q<V.length;q++){if(void 0!==e[je=V[q]]){if(-1!==e[je].valueSort.levelName.split(this.valueSortSettings.headerDelimiter).indexOf(k[k.length-1])&&f&&e[je].level===f.level)for(var H=0,B=n;H<B.length;H++){K=B[H];"value"===(de=a[je][K]).axis&&de.actualText===u&&(v.push([je,K]),s[je+","+K]&&delete s[je+","+K])}}}else for(var _=0,U=p;_<U.length;_++)for(var G=U[_],W=0,z=o;W<z.length;W++){if(void 0!==e[Ve=z[W]]&&e[Ve].valueSort[G.valueSort.levelName]&&e[Ve].level===f.level&&"grand sum"!==e[Ve].type)for(var Q=0,Y=n;Q<Y.length;Q++){var K=Y[Q];"value"===(de=a[Ve][K]).axis&&de.actualText===u&&(v.push([Ve,K]),s[Ve+","+K]&&delete s[Ve+","+K])}}for(var X=0,J=v;X<J.length;X++){var Z=(de=a[(K=J[X])[0]][K[1]]).actualValue-C[K[1]].actualValue;Z=isNaN(Z)?0:0===de.value&&0===C[K[1]].value?0:Z,this.aggregatedValueMatrix[K[0]]||(this.aggregatedValueMatrix[K[0]]=[]),"DifferenceFrom"===c?(this.aggregatedValueMatrix[K[0]][K[1]]=Z,de.formattedText=0===Z?this.emptyCellTextContent:this.getFormattedValue(Z,u).formattedText):(Z=0===C[K[1]].actualValue?0:Z/C[K[1]].actualValue,this.aggregatedValueMatrix[K[0]][K[1]]=Z,de.formattedText=de.showSubTotals?0!==Z?this.globalize.formatNumber(Z,{format:"P",maximumFractionDigits:this.getPercentFormat(this.formatFields,de.actualText)}):this.emptyCellTextContent:de.formattedText)}}else{if(j){k=g.split(this.valueSortSettings.headerDelimiter),E=S.length;for(var $=0;$<E;$++){F=!1;if(void 0!==S[$]){if(-1!==S[$].valueSort.levelName.split(this.valueSortSettings.headerDelimiter).indexOf(k[k.length-1])&&S[$].level===f.level){for(var ee=0,te=b;ee<te.length;ee++){"value"===(de=a[K=te[ee]][$]).axis&&de.actualText===u&&(F=!0,v.push([K,$]),s[K+","+$]&&delete s[K+","+$])}if(F)break}}}}else for(var ie=0,ae=p;ie<ae.length;ie++){G=ae[ie];var E=S.length;for(P=0;P<E;P++){var F=!1;if(void 0!==S[P]&&S[P].valueSort[G.valueSort.levelName]&&f&&S[P].level===f.level&&"grand sum"!==S[P].type){for(var re=0,ne=b;re<ne.length;re++){"value"===(de=a[K=ne[re]][P]).axis&&de.actualText===u&&(F=!0,v.push([K,P]),s[K+","+P]&&delete s[K+","+P])}if(F)break}}}var oe=void 0;0===x.length&&(oe=this.getSelectedColumn(h.uniqueName,i));for(var se=0,le=v;se<le.length;se++){var de=a[(K=le[se])[0]][K[1]],he=0;if(0===x.length){var pe=this.getSelectedRow(de.rowHeaders,e);he=this.getAggregateValue(pe.index,oe.indexObject,this.fieldList[u].index,h.type)}else he=x[K[0]].value;Z=de.value-he;Z=isNaN(Z)?0:Z,this.aggregatedValueMatrix[K[0]]||(this.aggregatedValueMatrix[K[0]]=[]),"DifferenceFrom"===c?(de.formattedText=0===Z?this.emptyCellTextContent:this.getFormattedValue(Z,u).formattedText,this.aggregatedValueMatrix[K[0]][K[1]]=Z):(Z=0===x[K[0]].value?0:Z/x[K[0]].value,de.formattedText=0!==Z?this.globalize.formatNumber(Z,{format:"P",maximumFractionDigits:this.getPercentFormat(this.formatFields,de.actualText)}):this.emptyCellTextContent,this.aggregatedValueMatrix[K[0]][K[1]]=Z)}}h.childMembers.length>0&&this.updateAggregates(e,i,a,h.childMembers,n,o,s);break;case"PercentageOfParentRowTotal":case"PercentageOfParentColumnTotal":case"PercentageOfParentTotal":if(m){for(var ue=0,ce=p;ue<ce.length;ue++){G=ce[ue];for(var ge=0,me=o;ge<me.length;ge++){if(void 0!==e[D=me[ge]]&&e[D].valueSort[G.valueSort.levelName]&&e[D].level===G.level)for(var fe=0,ve=n;fe<ve.length;fe++){K=ve[fe];"value"===(de=a[D][K]).axis&&de.actualText===u&&(v.push([D,K]),s[D+","+K]&&delete s[D+","+K])}}}for(var Se=0,ye=v;Se<ye.length;Se++){de=a[(D=ye[Se])[0]][D[1]];var be=0;be=0===C.length&&f?this.getAggregateValue(f.index,i[D[1]-1].indexObject,this.fieldList[u].index,h.type):C[D[1]]?C[D[1]].actualValue:0;Z=de.value/be;Z=isNaN(Z)?0:Z,de.formattedText=de.showSubTotals?0!==Z?this.globalize.formatNumber(Z,{format:"P",maximumFractionDigits:this.getPercentFormat(this.formatFields,de.actualText)}):this.emptyCellTextContent:de.formattedText,this.aggregatedValueMatrix[D[0]]||(this.aggregatedValueMatrix[D[0]]=[]),this.aggregatedValueMatrix[D[0]][D[1]]=Z}}else{for(var Ce=0,xe=p;Ce<xe.length;Ce++)for(G=xe[Ce],E=S.length,A=0;A<E;A++){F=!1;if(void 0!==S[A]&&S[A].valueSort[G.valueSort.levelName]){for(var we=0,Te=b;we<Te.length;we++){"value"===(de=a[K=Te[we]][A]).axis&&de.actualText===u&&(F=!0,v.push([K,A]),s[K+","+A]&&delete s[K+","+A])}if(F)break}}var Me=void 0;0===x.length&&(Me=this.getSelectedColumn(h.uniqueName,i));for(var De=0,Oe=v;De<Oe.length;De++){de=a[(D=Oe[De])[0]][D[1]];var Ne=0;if(0===x.length){pe=this.getSelectedRow(de.rowHeaders,e);Ne=this.getAggregateValue(pe.index,Me.indexObject,this.fieldList[u].index,h.type)}else Ne=x[D[0]].value;var Ee=de.value/Ne;Ee=isNaN(Ee)?0:Ee,de.formattedText=0!==Ee?this.globalize.formatNumber(Ee,{format:"P",maximumFractionDigits:this.getPercentFormat(this.formatFields,de.actualText)}):this.emptyCellTextContent,this.aggregatedValueMatrix[D[0]]||(this.aggregatedValueMatrix[D[0]]=[]),this.aggregatedValueMatrix[D[0]][D[1]]=Ee}}break;case"RunningTotals":if(m)for(var Pe=0,Fe=n;Pe<Fe.length;Pe++){K=Fe[Pe],Z=0;for(var Ie=0,Le=p;Ie<Le.length;Ie++){G=Le[Ie];for(var Ae=0,Re=o;Ae<Re.length;Ae++){var je;if(void 0!==e[je=Re[Ae]]){de=a[je][K];if(void 0!==e[je]&&e[je].valueSort[G.valueSort.levelName]&&e[je].level===G.level&&"value"===de.axis&&de.actualText===u){"grand sum"!==e[je].type&&(Z+=de.showSubTotals||!t.isNullOrUndefined(de.actualValue)&&isNaN(de.actualValue)?de.value:de.actualValue,de.formattedText=de.showSubTotals?0===Z&&de.actualValue&&0!==de.actualValue?"":this.getFormattedValue(Z,u).formattedText:de.formattedText,this.aggregatedValueMatrix[je]||(this.aggregatedValueMatrix[je]=[]),this.aggregatedValueMatrix[je][K]=Z),s[je+","+K]&&delete s[je+","+K];break}}}}}else for(var ke=0,qe=o;ke<qe.length;ke++){var Ve;if(void 0!==a[Ve=qe[ke]]){Z=0;for(var He=0,Be=p;He<Be.length;He++){G=Be[He];var _e=e[Ve].hasChild&&e[Ve].isDrilled&&(!t.isNullOrUndefined(e[Ve].showSubTotals)&&!e[Ve].showSubTotals||!this.showSubTotals||!this.showRowSubTotals);for(E=S.length,P=0;P<E;P++){de=a[Ve][P];if(void 0!==S[P]&&S[P].valueSort[G.valueSort.levelName]&&"value"===de.axis&&de.actualText===u){"grand sum"!==S[P].type&&(Z+=de.value,de.formattedText=_e?"":this.getFormattedValue(Z,u).formattedText,this.aggregatedValueMatrix[Ve]||(this.aggregatedValueMatrix[Ve]=[]),this.aggregatedValueMatrix[Ve][P]=Z),s[Ve+","+P]&&delete s[Ve+","+P];break}}}}}}}},e.prototype.getSelectedColumn=function(e,t){for(var i={axis:"column",index:[],indexObject:{}},a=0,r=t;a<r.length;a++){var n=r[a];n&&n.valueSort&&0===n.valueSort.levelName.indexOf(e)&&(i.index=i.index.concat(n.index).sort(function(e,t){return e-t}),i.indexObject=m({},i.indexObject,n.indexObject))}return i},e.prototype.getSelectedRow=function(e,t){for(var i=0,a=t;i<a.length;i++){var r=a[i];if(r){if(r.valueSort&&r.valueSort.levelName===e)return r;if(""===e&&"grand sum"===r.type)return r}}return null},e.prototype.recursiveRowData=function(e,t,i,a,r,n,o,s,l,d,h,p){o||this.getTableData(t[a].members,t,i,a,r,n,d+1,h,p),this.pageSettings||(t[a].members=[])},e.prototype.updateRowData=function(e,i,a,r,n,o,s,l,d,h,p){var u=this.fieldList[this.values[n].name].index,c=this.fieldList[this.values[n].name].aggregateType,g=this.values[n].name,m=[],f={},v=0,S=0;switch(c){case"Index":for(var y=["cVal","rTotalVal","cTotalVal","gTotalVal"],b=0,C=0,x=m=[[e[o],i[s]],[e[o],p],[h,i[s]],[h,p]];C<x.length;C++){var w=x[C];f[y[b]]=this.getAggregateValue(w[0].index,w[1].indexObject,u,c),b++}var T=f.cVal*f.gTotalVal/(f.rTotalVal*f.cTotalVal);v=!(e[o].members.length>0&&e[o].hasChild&&e[o].isDrilled)||(t.isNullOrUndefined(e[o].showSubTotals)||e[o].showSubTotals)&&this.showRowSubTotals&&this.showSubTotals?t.isNullOrUndefined(f.cVal)?f.cVal:isNaN(T)?0:T:void 0,S=t.isNullOrUndefined(f.cVal)?f.cVal:isNaN(T)?0:T;break;case"PercentageOfGrandTotal":case"PercentageOfColumnTotal":case"PercentageOfRowTotal":(m=[[e[o],i[s]]]).push("PercentageOfGrandTotal"===c?[h,p]:"PercentageOfColumnTotal"===c?[h,i[s]]:[e[o],p]);y=["cVal","gTotalVal"],b=0;for(var M=0,D=m;M<D.length;M++){w=D[M];f[y[b]]=this.getAggregateValue(w[0].index,w[1].indexObject,u,c),b++}var O=f.cVal/f.gTotalVal;v=!(e[o].members.length>0&&e[o].hasChild&&e[o].isDrilled)||(t.isNullOrUndefined(e[o].showSubTotals)||e[o].showSubTotals)&&this.showSubTotals&&this.showRowSubTotals?t.isNullOrUndefined(f.cVal)?f.cVal:isNaN(O)?0:O:void 0,S=t.isNullOrUndefined(f.cVal)?f.cVal:isNaN(O)?0:O;break;default:var N=this.getAggregateValue(e[o].index,i[s].indexObject,u,c);v=!(e[o].members.length>0&&e[o].hasChild&&e[o].isDrilled)||(t.isNullOrUndefined(e[o].showSubTotals)||e[o].showSubTotals)&&this.showSubTotals&&this.showRowSubTotals?N:void 0,S=N}var E={fieldName:this.values[n].name,row:e[o],column:i[s],value:v,cellSets:this.getCellSet(this.rawIndexObject),rowCellType:e[o].hasChild&&e[o].isDrilled?"subTotal":"grand sum"===e[o].type?"grandTotal":"value",columnCellType:i[s].hasChild&&i[s].isDrilled?"subTotal":"grand sum"===i[s].type?"grandTotal":"value",aggregateType:c,skipFormatting:!1};this.getValueCellInfo&&this.getValueCellInfo(E),v=E.value;var P=e[o].hasChild||i[s].hasChild||"grand sum"===e[o].type||"grand sum"===i[s].type,F="grand sum"===e[o].type||"grand sum"===i[s].type,I=e[o].members.length>0&&e[o].hasChild&&e[o].isDrilled&&(!t.isNullOrUndefined(e[o].showSubTotals)&&!e[o].showSubTotals||!this.showSubTotals||!this.showRowSubTotals),L=I?"":void 0===v?this.emptyCellTextContent:"Count"===c||"DistinctCount"===c?v.toLocaleString():this.getFormattedValue(v,g).formattedText;!isNaN(v)&&!t.isNullOrUndefined(v)&&["PercentageOfGrandTotal","PercentageOfColumnTotal","PercentageOfRowTotal"].indexOf(c)>=0?L=this.globalize.formatNumber(v,{format:"P",maximumFractionDigits:this.getPercentFormat(this.formatFields,E.fieldName)}):I||!isNaN(v)||t.isNullOrUndefined(v)||-1===["PopulationStDev","SampleStDev","PopulationVar","SampleVar"].indexOf(c)||(L="#DIV/0!"),L=E.skipFormatting?t.isNullOrUndefined(v)?this.emptyCellTextContent:v.toString():L,r[a][l]=this.valueContent[d][l]={axis:"value",actualText:g,indexObject:this.isDrillThrough?this.rawIndexObject:{},rowHeaders:"grand sum"===e[o].type?"":e[o].valueSort.levelName,columnHeaders:"grand sum"===i[s].type?"":i[s].valueSort.levelName,formattedText:L,value:t.isNullOrUndefined(v)?0:v,actualValue:t.isNullOrUndefined(S)?0:S,rowIndex:a,colIndex:l,isSum:P,isGrandSum:F,showSubTotals:!I},this.rawIndexObject={}},e.prototype.getCellSet=function(e){for(var t=[],i=0,a=Object.keys(e);i<a.length;i++){var r=a[i];this.data[parseInt(r,10)]&&t.push(this.data[parseInt(r,10)])}return t},e.prototype.updateValueMembers=function(e,i,a,r,n,o,s){var l=a&&!t.isNullOrUndefined(a.levelName)?a.levelName.toString():void 0,d=a&&!t.isNullOrUndefined(a.uniqueName)?a.uniqueName.toString():void 0;if(e)for(var h=0;h<o;h++){var p=this.values[h],u=p.caption?p.caption:p.name,c={axis:this.valueAxis?"row":"column",rowIndex:this.valueAxis?0:i&&s<=i.rowIndex?i.rowIndex+1:s,actualText:p.name,formattedText:u,level:0,valueSort:{},members:[],type:this.valueAxis?"value":i?i.type:null,index:!this.valueAxis&&i?i.index:null,indexObject:!this.valueAxis&&i?i.indexObject:null};n.length>0&&(c.showSubTotals=p.showSubTotals);var g=c.valueSort;g.axis=this.valueAxis?void 0:p.name,g[(l?l+this.valueSortSettings.headerDelimiter:"")+u]=1,g[(d?d+this.valueSortSettings.headerDelimiter:"")+p.name]=1,g.levelName=(l?l+this.valueSortSettings.headerDelimiter:"")+u,g.uniqueName=(d?d+this.valueSortSettings.headerDelimiter:"")+p.name,r.push(c),this.updateValueMembers(!1,i,g,c.members,n,o,s+1)}else for(var m=0,f=n.length;m<f;m++){var v=this.frameHeaderWithKeys(n[m]);v.members=[],v.rowIndex=this.valueAxis?v.rowIndex:s<0?0:s;var S={};S.axis=v.valueSort.axis,S[(l?l+this.valueSortSettings.headerDelimiter:"")+v.formattedText]=1,S[(d?d+this.valueSortSettings.headerDelimiter:"")+v.actualText]=1,S.levelName=(l?l+this.valueSortSettings.headerDelimiter:"")+v.formattedText,S.uniqueName=(d?d+this.valueSortSettings.headerDelimiter:"")+v.actualText,v.valueSort=S;var y=S.axis+this.valueSortSettings.headerDelimiter+S.levelName;v.isDrilled&&(this.isExpandAll&&this.fieldDrillCollection[y]||!this.isExpandAll&&!this.fieldDrillCollection[y])&&(v.isDrilled=!1),r.push(v),v.isDrilled&&n[m].members.length>0?(this.valueAxis&&s<this.measureIndex&&this.measureIndex!==s+1&&(!n[m].hasChild||(t.isNullOrUndefined(n[m].showSubTotals)||n[m].showSubTotals)&&this.showSubTotals&&this.showRowSubTotals)&&this.updateValueMembers(!0,v,S,r[r.length-1].members,[],o,s),this.updateValueMembers(this.measureIndex===s+1,v,S,r[r.length-1].members,n[m].members,o,s+1),!this.valueAxis&&s<this.measureIndex&&this.measureIndex!==s+1&&(!n[m].hasChild||(t.isNullOrUndefined(n[m].showSubTotals)||n[m].showSubTotals)&&this.showSubTotals&&this.showColumnSubTotals)&&this.updateValueMembers(!0,v,S,r[r.length-1].members,[],o,s)):s<this.measureIndex&&this.updateValueMembers(!0,v,S,r[r.length-1].members,[],o,s)}},e.prototype.frameDefinedHeaderData=function(e,i,a,r,n,o){for(var s=0,l=e.length;s<l;s++){e[s].members.length&&this.frameDefinedHeaderData(e[s].members,i,a,r+1,n,o);var d=!0;!(e[s].members.length>0)||(t.isNullOrUndefined(e[s].showSubTotals)||e[s].showSubTotals)&&this.showSubTotals&&this.showColumnSubTotals||(d=!1),i[(n=i.length+(this.measureIndex<r&&d?1:this.measureIndex>r&&e[s].members.length>0||this.measureIndex!==r+1||!e[s].isDrilled?this.measureIndex===r&&0!==this.measureIndex&&d?1:this.measureIndex>r&&d&&e[s].valueSort&&e[s].valueSort.axis&&this.measureNames[e[s].valueSort.axis.toString()]?1:0:0!==this.measureIndex&&d?1:0))-1]||(i[n-1]=this.frameHeaderWithKeys(e[s])),e[s].colIndex=n;var h=this.measureIndex>r&&e[s].valueSort&&e[s].valueSort.axis&&this.measureNames[e[s].valueSort.axis.toString()]?this.measureIndex:r;a[h]?a[h][n]=this.headerContent[h][n]=this.frameHeaderWithKeys(e[s]):(a[h]=[],this.headerContent[h]={},a[h][n]=this.headerContent[h][n]=this.frameHeaderWithKeys(e[s])),this.pageSettings||(i[n-1].members=[])}},e.prototype.getHeaderData=function(e,i,a,r,n,o,s,l,d){if(this.valueAxis||this.isLastHeaderHasMeasures){if(0==r.length&&this.valueAxis&&(this.isMultiMeasures||this.alwaysShowValueHeader)&&this.values.length>0){if(this.showGrandTotals&&this.showRowGrandTotals&&"grand sum"==this.rMembers[this.rMembers.length-1].type)this.updateValueMembers(0==this.measureIndex&&this.rMembers.length>1,null,null,r,this.rMembers.slice(0,this.rMembers.length-1),this.values.length,0),this.updateValueMembers(!1,null,null,r,this.rMembers.slice(this.rMembers.length-1,this.rMembers.length),this.values.length,-1);else if("Top"===this.grandTotalsPosition&&this.showGrandTotals&&0===this.measureIndex)this.updateValueMembers(!1,null,null,r,this.rMembers.slice(0,1),this.values.length,-1),this.updateValueMembers(0==this.measureIndex&&this.rMembers.length>1,null,null,r,this.rMembers.slice(1,this.rMembers.length),this.values.length,0);else{var h=0===e.length&&1===this.rMembers.length&&"grand sum"==this.rMembers[0].type;this.updateValueMembers(!h&&0==this.measureIndex,null,null,r,this.rMembers,this.values.length,h?-1:0)}if(this.getAggregatedHeaders(e,i,r,n,a),this.selectedHeaders.values.length>0)for(N=this.selectedHeaders.selectedHeader.length,E=0;E<N;E++){if("row"===(P=this.selectedHeaders.selectedHeader[E]).axis){var p=P.aggregateHeaders.length;for(I=0;I<p;I++)if(P.aggregateHeaders[I].actualText===P.value)if(-1!==P.aggregateHeaders[I].valueSort.levelName.indexOf(P.uniqueName))P.uniqueName=P.aggregateHeaders[I].valueSort.levelName,P.aggregateHeaders.splice(I,1),I--,p--;else for(var u=P.aggregateHeaders[I].members.length,c=0;c<u;c++){if("value"!=(R=P.aggregateHeaders[I].members[c]).type&&R.level==P.aggregateHeaders[I].level){var g=t.extend([],P.aggregateHeaders[I].members,null,!0);P.aggregateHeaders=[].concat(P.aggregateHeaders,g,P.aggregateHeaders.splice(I)),P.aggregateHeaders.splice(g.length+I,1),I=g.length+I-1,p=P.aggregateHeaders.length}}else if(P.aggregateHeaders[I].actualText!==P.value&&P.aggregateHeaders[I].members.length>0)for(u=P.aggregateHeaders[I].members.length,c=0;c<u;c++){if((R=P.aggregateHeaders[I].members[c]).actualText===P.value){P.uniqueName===P.aggregateHeaders[I].valueSort.levelName&&(P.uniqueName=R.valueSort.levelName),P.aggregateHeaders[I].members.splice(c,1),P.aggregateHeaders[I]=R;break}}}}}for(var m=n.length,f=this.columns.length,v=this.valueSortSettings.headerText,S=0;S<m;S++){n[S].members.length&&this.getHeaderData(e,i,a,r,n[S].members,o,s,l,d);var y=!0;(t.isNullOrUndefined(n[S].showSubTotals)||n[S].showSubTotals)&&this.showSubTotals&&this.showColumnSubTotals?o[l=o.length]=this.frameHeaderWithKeys(n[S]):(n[S].members.length>0?(this.removeCount++,y=!1):o[o.length]=this.frameHeaderWithKeys(n[S]),l=o.length-1);var b=n[S].level;n[S].rowIndex=b,n[S].colIndex=l*d+d,s[b]?s[b][l*d+d]=this.headerContent[b][l*d+d]=this.frameHeaderWithKeys(n[S]):(s[b]=[],this.headerContent[b]={},s[b][l*d+d]=this.headerContent[b][l*d+d]=this.frameHeaderWithKeys(n[S]));var C=0===this.columns.length&&1===this.values.length;if((this.isMultiMeasures||this.alwaysShowValueHeader||C)&&!this.valueAxis&&y)for(var x=0;x<d;x++){var w=this.values[x].caption?this.values[x].caption:this.values[x].name,T={axis:"column",actualText:this.values[x].name,formattedText:w,level:0,valueSort:{},colIndex:l*d+1+x,rowIndex:f};s[f]?s[f][l*d+1+x]=this.headerContent[f][l*d+1+x]=T:(s[f]=[],this.headerContent[f]={},s[f][l*d+1+x]=this.headerContent[f][l*d+1+x]=T);var M=s[f][l*d+1+x].valueSort;M[n[S].valueSort.levelName+this.valueSortSettings.headerDelimiter+w]=1,M.levelName=n[S].valueSort.levelName+this.valueSortSettings.headerDelimiter+w,M[n[S].valueSort.uniqueName+this.valueSortSettings.headerDelimiter+this.values[x].name]=1,M.uniqueName=n[S].valueSort.uniqueName+this.valueSortSettings.headerDelimiter+this.values[x].name,M&&M[v]&&(this.valueSortSettings.columnIndex=l*d+1+x)}else n[S].valueSort&&n[S].valueSort[v]&&(this.valueSortSettings.columnIndex=l*d+1);this.pageSettings||(o[l].members=[])}}else{var D=[];if(this.showGrandTotals&&this.showColumnGrandTotals&&"grand sum"==n[n.length-1].type)this.updateValueMembers(0===this.measureIndex&&n.length>1,null,null,D,n.slice(0,n.length-1),d,0),this.updateValueMembers(!1,null,null,D,n.slice(n.length-1,n.length),d,-1);else if("Top"===this.grandTotalsPosition&&this.showGrandTotals&&0===this.measureIndex)this.updateValueMembers(!1,null,null,D,n.slice(0,1),d,-1),this.updateValueMembers(0===this.measureIndex&&n.length>1,null,null,D,n.slice(1,n.length),d,0);else{var O=0===i.length&&1===n.length&&"grand sum"==n[0].type;this.updateValueMembers(!O&&0===this.measureIndex,null,null,D,n,d,O?-1:0)}if(this.getAggregatedHeaders(e,i,this.rMembers,D,a),this.selectedHeaders.values.length>0)for(var N=this.selectedHeaders.selectedHeader.length,E=0;E<N;E++){var P;if("column"==(P=this.selectedHeaders.selectedHeader[E]).axis)if(P.uniqueName===P.value)this.selectedHeaders.selectedHeader.splice(E,1),E--,N--;else if("Grand Total"===P.uniqueName)for(var F=P.aggregateHeaders.length,I=0;I<F;I++)if(P.aggregateHeaders[I]&&P.aggregateHeaders[I].members.length>0)for(var L=0,A=P.aggregateHeaders[I].members;L<A.length;L++){var R;(R=A[L]).actualText===P.value&&(P.aggregateHeaders[I]=R,"grand sum"===R.type&&(P.uniqueName=R.valueSort.levelName))}}this.frameDefinedHeaderData(D,o,s,0,1,d)}},e.prototype.getAggregateValue=function(e,i,a,r){e.length;var n=0,o=0,s=0,l=!0,d=!1;switch(r.toLowerCase()){case"median":for(var h=[],p=0;void 0!==e[n];)void 0!==i[e[n]]&&(d=!0,this.rawIndexObject[e[n]]=e[n],t.isNullOrUndefined(this.valueMatrix[e[n]][a])||h.push(this.valueMatrix[e[n]][a])),n++;var u=h.length;u>0&&(h.sort(function(e,t){return e-t}),o=u%2==0?(h[p=u/2<=1?0:u/2-1]+h[p+1])/2:h[p=(u+1)/2<=1?0:(u+1)/2-1]);break;case"count":for(;void 0!==e[n];)void 0!==i[e[n]]&&(d=!0,this.rawIndexObject[e[n]]=e[n],o+=t.isNullOrUndefined(this.valueMatrix[e[n]][a])?0:this.allowDataCompression?this.valueMatrix[e[n]][a]:1),n++;break;case"distinctcount":for(var c=[];void 0!==e[n];){if(void 0!==i[e[n]]){this.rawIndexObject[e[n]]=e[n],d=!0;var g=this.data[e[n]][this.fieldKeys[this.fields[a]]],m=void 0;t.isNullOrUndefined(g)||(m=g.toString(),(0===c.length||c.length>0&&-1===c.indexOf(m))&&(o+=this.allowDataCompression&&"number"==typeof g?g:1,c.push(m)))}n++}break;case"product":for(;void 0!==e[n];){if(void 0!==i[e[n]]){this.rawIndexObject[e[n]]=e[n],d=!0;m=this.valueMatrix[e[n]][a];t.isNullOrUndefined(m)?l&&(o=m):(o=l||t.isNullOrUndefined(o)?1:o,o*=m),l=!1}n++}break;case"populationstdev":case"samplestdev":case"populationvar":case"samplevar":for(var f=0,v=0,S=[],y=0,b=0,C=0;void 0!==e[n];){if(void 0!==i[e[n]]){d=!0,this.rawIndexObject[e[n]]=e[n];m=this.valueMatrix[e[n]][a];t.isNullOrUndefined(m)||(v+=m,S.push(m),f++)}n++}if(f>0){y=v/f;for(var x=0,w=S;x<w.length;x++){var T=w[x];C+=Math.pow(T-y,2)}o=0===(b=-1!==["populationstdev","samplestdev"].indexOf(r.toLowerCase())?Math.sqrt(C/("populationstdev"===r.toLowerCase()?f:f-1)):C/("populationvar"===r.toLowerCase()?f:f-1))?NaN:b}else o=v;break;case"min":var M=!0;for(o=void 0;void 0!==e[n];)void 0!==i[e[n]]&&void 0!==this.valueMatrix[e[n]][a]&&(d=!0,this.rawIndexObject[e[n]]=e[n],t.isNullOrUndefined(o)&&t.isNullOrUndefined(this.valueMatrix[e[n]][a])?o=this.valueMatrix[e[n]][a]:M?(o=this.valueMatrix[e[n]][a],M=!1):o=this.valueMatrix[e[n]][a]<o?this.valueMatrix[e[n]][a]:o),n++;break;case"max":for(var D=!0;void 0!==e[n];)void 0!==i[e[n]]&&void 0!==this.valueMatrix[e[n]][a]&&(d=!0,this.rawIndexObject[e[n]]=e[n],D?(o=this.valueMatrix[e[n]][a],D=!1):o=this.valueMatrix[e[n]][a]>o?this.valueMatrix[e[n]][a]:o),n++;break;case"calculatedfield":d=!0;var O=this.calculatedFields[this.fields[a]],N=O.formula,E={};if(this.calculatedFormulas[O.name])for(var P=this.calculatedFormulas[O.name],F=0,I=P.length;F<I;F++){var L=P[F],A=E[L.formula];if(void 0===A){var R=L.type;A=this.getAggregateValue(e,i,L.index,R),E[L.formula]=A}N=N.replace(L.formula,String(A))}o=(o=this.evaluate(N))===1/0||o===-1/0?1/0:void 0===o||isNaN(o)?void 0:JSON.parse(String(o));break;default:for(o=void 0;void 0!==e[n];){if(void 0!==i[e[n]]){d=!0,this.rawIndexObject[e[n]]=e[n];m=this.valueMatrix[e[n]][a];t.isNullOrUndefined(o)&&t.isNullOrUndefined(m)?o=m:(t.isNullOrUndefined(o)&&(o=0),o+=t.isNullOrUndefined(m)?0:m),t.isNullOrUndefined(m)||s++}n++}}return r&&"avg"===r.toLowerCase()&&0!==o&&!t.isNullOrUndefined(o)?o/s:d?o:void 0},e.prototype.evaluate=function(e){return Function('"use strict";return ('+e+")")()},e.prototype.getFormattedValue=function(e,i){var a=null===e?this.localeObj?this.localeObj.getConstant("null"):String(e):void 0===e?this.localeObj?i in this.groupingFields?this.localeObj.getConstant("groupOutOfRange"):this.localeObj.getConstant("undefined"):String(e):e,r={formattedText:a.toString(),actualText:a,dateText:a};if(this.formatFields[i]&&!t.isNullOrUndefined(e))try{var n=this.formatFields[i].properties?this.formatFields[i].properties:this.formatFields[i],o=t.extend({},n,null,!0);if(delete o.name,!o.minimumSignificantDigits&&o.minimumSignificantDigits<1&&delete o.minimumSignificantDigits,!o.maximumSignificantDigits&&o.maximumSignificantDigits<1&&delete o.maximumSignificantDigits,o.type)r.formattedText=this.dateFormatFunction[i].exactFormat(new Date(e)),r.actualText=e;else{if(delete o.type,o.format&&!this.formatRegex.test(o.format)){var s=o.format.match(/^(('[^']+'|''|[^*#@0,.])*)(\*.)?((([0#,]*[0,]*[0#]*)(\.[0#]*)?)|([#,]*@+#*))(E\+?0+)?(('[^']+'|''|[^*#@0,.E])*)$/),l=!0;if(t.isNullOrUndefined(o.minimumFractionDigits)&&delete o.minimumFractionDigits,t.isNullOrUndefined(o.maximumFractionDigits)&&delete o.maximumFractionDigits,t.isNullOrUndefined(o.minimumIntegerDigits)&&delete o.minimumIntegerDigits,t.isNullOrUndefined(s)&&(s=o.format.match(/^(('[^']+'|''|[^*@0])*)(\*.)?((([0#,]*[0,]*[0#]*)(\.[0#]*)?)|([#,]*@+#*))(E\+?0+)?(('[^']+'|''|[^*#@,.E])*)$/),delete o.useGrouping,l=!1),s&&s.length>5){var d=s[6];l&&(o.useGrouping=-1!==d.indexOf(","))}}r.formattedText=this.globalize.formatNumber(isNaN(Number(e))?e:Number(e),o),r.actualText=isNaN(Number(e))?e:Number(e),r.dateText=isNaN(Number(e))?e:Number(e)}"None"!==this.fieldList[i].sort&&o.type&&["date","dateTime","time"].indexOf(this.formatFields[i].type)>-1&&(r.dateText=this.dateFormatFunction[i].fullFormat(new Date(e))),this.fieldList[i].isCustomField&&(r.formattedText="NaN"===r.formattedText?a.toString():r.formattedText,r.dateText="NaN"===r.dateText?a.toString():r.dateText)}catch(e){if(!this.fieldList[i].isCustomField)throw e}finally{this.fieldList[i].isCustomField&&(r.formattedText=t.isNullOrUndefined(r.formattedText)||"NaN"===r.formattedText?a.toString():r.formattedText,r.dateText=t.isNullOrUndefined(r.dateText)||"NaN"===r.dateText?a.toString():r.dateText)}return r},e.prototype.powerFunction=function(e){if(e.indexOf("^")>-1){for(var t=[];e.indexOf("(")>-1;)e=e.replace(/(\([^\(\)]*\))/g,function(e,i){return t.push(i),"~"+(t.length-1)});for(t.push(e),e="~"+(t.length-1);e.indexOf("~")>-1;)e=e.replace(new RegExp("~(\\d+)","g"),function(e,i){return t[i].replace(/(\w*)\^(\w*)/g,"Math.pow($1,$2)")})}return e},e}(),v="enginePopulating",S="enginePopulated",y="fieldDrop",b="beforeExport",C="excelHeaderQueryCellInfo",x="pdfHeaderQueryCellInfo",w="excelQueryCellInfo",T="pdfQueryCellInfo",M="onPdfCellRender",D="dataBound",O="hyperlinkCellClick",N="beforeColumnsRender",E="cellSelecting",P="beginDrillThrough",F="editCompleted",I="multiLevelLabelClick",L="saveReport",A="fetchReport",R="loadReport",j="renameReport",k="chartTooltipRender",q="chartAxisLabelRender",V="chartSeriesCreated",H="aggregateCellInfo",B="contextMenuClick",_="fieldListRefreshed",U="conditionalFormatting",G="beforeExcelExport",W="memberFiltering",z="calculatedFieldCreate",Q="memberEditorOpen",Y="fieldRemove",K="numberFormatting",X="aggregateMenuOpen",J="fieldDragStart",Z="beforeServiceInvoke",$="actionBegin",ee="actionComplete",te="actionFailure",ie="initial-load",ae="ui-update",re="content-ready",ne="data-ready",oe="init-groupingbar",se="tree-view-update",le="pivot-button-update",de="init-calculatedfield",he="init-toolbar",pe="init-formatting",ue="init-grouping",ce="Sort value",ge="Add new report",me="Save current report",fe="Save as current report",ve="Rename current report",Se="Remove current report",ye="Open conditional formatting dialog",be="Open number formatting dialog",Ce="Open field list",xe="Show table view",we="Show chart view",Te="PDF export",Me="PNG export",De="Excel export",Oe="CSV export",Ne="JPEG export",Ee="SVG export",Pe="Hide sub-totals",Fe="Show row sub-totals",Ie="Show column sub-totals",Le="Show sub-totals",Ae="Hide grand totals",Re="Show row grand totals",je="Show column grand totals",ke="Show grand totals",qe="Number Formatting menu",Ve="Conditional Formatting menu",He="Report change",Be="Sort field tree",_e="Edit calculated field",Ue="Sort field",Ge="Filter field",We="Remove field",ze="Open calculated field dialog",Qe="Edit record",Ye="Save edited records",Ke="Add new record",Xe="Remove record",Je="Aggregate field",Ze="Window resize",$e="Calculated field applied",et="Edited records saved",tt="New record added",it="Field list closed",at="Field tree sorted",rt="Report saved",nt="New report added",ot="Conditional formatting applied",st="Number formatting applied",lt="Table view shown",dt="Chart view shown",ht="Sub-totals hidden",pt="Row sub-totals shown",ut="Column sub-totals shown",ct="Sub-totals shown",gt="Grand totals hidden",mt="Row grand totals shown",ft="Column grand totals shown",vt="Grand totals shown",St="Calculatedfield edited",yt="Field sorted",bt="Field filtered",Ct="Field removed",xt="Field aggregated",wt="Drill-through closed",Tt="e-pivotfieldlist",Mt="e-rtl",Dt="e-device",Ot="e-icons",Nt="e-disable",Et="e-hide",Pt="e-dropdown-icon",Ft="e-pivotfieldlist-wrapper",It="e-toggle-field-list",Lt="e-field-list",At="e-field-list-tree",Rt="e-field-list-footer",jt="e-left-axis-fields",kt="e-right-axis-fields",qt="e-all-fields-axis",Vt="e-axis-content",Ht="e-draggable-prompt",Bt="e-pvt-btn-div",_t="e-pivot-button",Ut="e-member-sort",Gt="e-descend",Wt="e-btn-filter",zt="e-pv-filter",Qt="e-pv-filtered",Yt="e-remove",Kt="e-disable-drag",Xt="e-drop-indicator",Jt="e-drop-hover",Zt="e-member-editor-wrapper",$t="e-member-editor-container",ei="e-drillthrough-body-header",ti="e-drillthrough-body-header-common",ii="e-drillthrough-body-header-value",ai="e-ok-btn",ri="e-cancel-btn",ni="e-pivot-error-dialog",oi="e-droppable",si="e-rows",li="e-columns",di="e-values",hi="e-filters",pi="e-grouping-bar",ui="e-group-all-fields",ci="e-group-rows",gi="e-group-columns",mi="e-group-values",fi="e-group-filters",vi="e-drag-restrict",Si="e-list-selected",yi="e-text-content",bi="e-field-list-btn",Ci="e-calculated-field-btn",xi="e-add-icon",wi="e-list-text",Ti="e-selected-node",Mi="e-selected-option-icon",Di="e-selected-level-icon",Oi="e-between-text-div",Ni="e-filter-input-div-2",Ei="e-value-options",Pi="e-filter-operator",Fi="e-sort-ascend-icon",Ii="e-sort-descend-icon",Li="e-active",Ai="e-collapse",Ri="e-expand",ji="e-table",ki="e-columnsheader",qi="e-rowsheader",Vi="e-cellvalue",Hi="e-tooltipheader",Bi="e-tooltipcontent",_i="e-nextspan",Ui="e-lastspan",Gi="e-editor-search-wrapper",Wi="e-select-all",zi="e-pivot-calc-check",Qi="e-pivot-calc-input",Yi="e-custom-format-input",Ki="e-olap-calc-hierarchy-list-div",Xi="e-olap-calc-format-type-div",Ji="e-olap-calc-member-type-div",Zi="e-member-options",$i="e-format",ea="e-pivot-formula",ta="e-pivot-treeview",ia="e-pivot-treeview-outer",aa="e-pivot-ok-button",ra="e-pivot-button-div",na="e-axis",oa="e-axis-filter",sa="e-pivot-all-field-title",la="e-olap-format-title",da="e-disabled",ha="e-menu-hide",pa="e-member-prompt",ua="e-edit",ca="e-edited",ga="e-empty-field",ma="e-pivot-formatting-dialog",fa="e-format-condition-button",va="e-input",Sa="e-format-color-picker",ya="e-virtualtrack",ba="e-movablecontent",Ca="e-movablescrollbar",xa="e-frozencontent",wa="e-movableheader",Ta="e-cellselectionbackground",Ma="e-selectionbackground",Da="e-field-list-back-icon",Oa="e-rowcell",Na="e-active",Ea="e-spanclicked",Pa="e-rowselect",Fa="e-gridheader",Ia="e-pivotview-pdf-export",La="e-pivotview-excel-export",Aa="e-pivotview-csv-export",Ra="e-remove-report",ja="e-pivot-toolbar",ka="e-pivotview-report-input",qa="e-pivotchart",Va="e-group-chart-rows",Ha="e-group-chart-columns",Ba="e-group-chart-values",_a="e-group-chart-values-drodown-div",Ua="e-group-chart-columns-dropdown-div",Ga="e-chart-grouping-bar",Wa="e-pivotview-disable-icon",za="e-pivotview-select-icon",Qa="e-pivot-grouping-bar",Ya="e-mdx-query-content",Ka="e-pivotchart-inner",Xa="e-group-pivot-rows",Ja="e-pivot-toolbar-menu",Za=function(){function e(e){this.menuInfo=[],this.stringAggregateTypes=["Count","DistinctCount"],this.parent=e}return e.prototype.render=function(e,t){this.parentElement=t,this.openContextMenu(e)},e.prototype.openContextMenu=function(e){var t=this,i=e.target.parentElement.id,a=g.getFieldInfo(i,this.parent);this.buttonElement=e.target.parentElement;var r="number"!==this.parent.engineModule.fieldList[i].type?1:0;if(this.summaryTypes=this.getMenuItem(r).slice(),this.parent.actionObj.actionName=Je,this.parent.actionObj.fieldInfo=a.fieldItem,!this.parent.actionBeginMethod()){var n={cancel:!1,fieldName:i,aggregateTypes:this.summaryTypes,displayMenuCount:7},o="pivotfieldlist"===this.parent.getModuleName()&&this.parent.isPopupView?this.parent.pivotGridModule:this.parent;try{o.trigger(X,n,function(i){if(!i.cancel){t.summaryTypes=i.aggregateTypes,t.createContextMenu(r,i.displayMenuCount),t.currentMenu=e.target;var a=t.currentMenu.getBoundingClientRect();t.parent.enableRtl?t.menuInfo[r].open(a.top+(window.scrollY||document.documentElement.scrollTop),a.left-105):t.menuInfo[r].open(a.top+(window.scrollY||document.documentElement.scrollTop),a.left)}})}catch(e){this.parent.actionFailureMethod(e)}}},e.prototype.createContextMenu=function(e,i){var a=this,r=[];r[e]=[],this.menuInfo[e]&&!this.menuInfo[e].isDestroyed&&this.menuInfo[e].destroy();for(var o=[],s=0;s<this.summaryTypes.length;s++){var l=this.summaryTypes[s];e?this.stringAggregateTypes.indexOf(l)>-1&&o.indexOf(l)<0&&(r[e].push({text:this.parent.localeObj.getConstant(l),id:this.parent.element.id+"StringMenu_"+l}),o.push(l)):this.parent.getAllSummaryType().indexOf(l)>-1&&o.indexOf(l)<0&&(r[e].push({text:this.parent.localeObj.getConstant(l),id:this.parent.element.id+"_"+l}),o.push(l))}r[e].length>i&&(r[e].splice(i),r[e].push({text:this.parent.localeObj.getConstant("MoreOption"),id:this.parent.element.id+"_MoreOption"}));var d;d={items:r[e],enableRtl:this.parent.enableRtl,locale:this.parent.locale,beforeOpen:this.beforeMenuOpen.bind(this,e),onClose:function(e){t.select("#"+a.buttonElement.id,a.parentElement).focus()},select:this.selectOptionInContextMenu.bind(this)};var h=document.getElementById(this.parent.element.id+(e?"valueFieldStringContextMenu":"valueFieldContextMenu"));null!==h?h.innerHTML="":h=t.createElement("ul",{id:this.parent.element.id+(e?"valueFieldStringContextMenu":"valueFieldContextMenu")}),this.parent.element.appendChild(h),this.menuInfo[e]=new n.ContextMenu(d),this.menuInfo[e].isStringTemplate=!0,this.menuInfo[e].appendTo(h)},e.prototype.getMenuItem=function(e){for(var t=[],i=0;i<this.parent.aggregateTypes.length;i++){var a=this.parent.aggregateTypes[i];e?this.stringAggregateTypes.indexOf(a)>-1&&-1===t.indexOf(a)&&t.push(a):this.parent.getAllSummaryType().indexOf(a)>-1&&-1===t.indexOf(a)&&t.push(a)}return t},e.prototype.beforeMenuOpen=function(e,t){t.element.style.zIndex=(this.menuInfo[e].element.style.zIndex+3).toString(),t.element.style.display="inline"},e.prototype.createValueSettingsDialog=function(e,i,r){var n=this;this.parentElement=i;var o=t.createElement("div",{id:this.parentElement.id+"_ValueDialog",className:"e-value-field-settings",attrs:{"data-field":e.id}});this.parentElement.appendChild(o),this.valueDialog=new a.Dialog({animationSettings:{effect:"Fade"},allowDragging:!0,header:this.parent.localeObj.getConstant("valueFieldSettings"),content:this.createFieldOptions(e,r),isModal:!0,visible:!0,showCloseIcon:!0,enableRtl:this.parent.enableRtl,locale:this.parent.locale,width:"auto",height:"auto",position:{X:"center",Y:"center"},buttons:[{click:this.updateValueSettings.bind(this),buttonModel:{cssClass:ai,content:this.parent.localeObj.getConstant("ok"),isPrimary:!0}},{click:function(){n.valueDialog.hide()},buttonModel:{cssClass:ri,content:this.parent.localeObj.getConstant("cancel")}}],closeOnEscape:"pivotfieldlist"!==this.parent.getModuleName()||"Popup"!==this.parent.renderMode,target:this.parentElement,overlayClick:function(){n.removeDialog()},close:this.removeDialog.bind(this)}),this.valueDialog.isStringTemplate=!0,this.valueDialog.appendTo(o)},e.prototype.createFieldOptions=function(e,i){var a=e.getAttribute("data-caption"),r=i&&"MoreOption"!==i?i:e.getAttribute("data-type"),n=e.getAttribute("data-basefield"),l=e.getAttribute("data-baseitem");r="undefined"!==r.toString()?r:"Sum";for(var d=[],h=this.summaryTypes,p=[],u=0;u<h.length;u++)this.parent.getAllSummaryType().indexOf(h[u])>-1&&p.indexOf(h[u])<0&&(d.push({value:h[u],text:this.parent.localeObj.getConstant(h[u])}),p.push(h[u]));for(var c=["DifferenceFrom","PercentageOfDifferenceFrom"],g=["DifferenceFrom","PercentageOfDifferenceFrom","PercentageOfParentTotal"],m=t.extend([],this.parent.dataSourceSettings.rows,null,!0),f=[],v=[],S=0,y=m=m.concat(this.parent.dataSourceSettings.columns);S<y.length;S++){var b=y[S],C=b.name,x=b.caption?b.caption:b.name;f.push({value:C,text:x})}0===Object.keys(f).length?(f.push({value:"",text:""}),n="",v=[]):(n=n&&"undefined"!==n.toString()&&"null"!==n.toString()?n:f[0].value,v=Object.keys(this.parent.engineModule.fieldList["undefined"!==n.toString()?n:f[0].value].formattedMembers)),l="undefined"!==l.toString()?l:v[0];var w=t.createElement("div",{className:"e-value-field-div-content",id:this.parentElement.id+"_field_div_content",attrs:{"data-type":r,"data-caption":a,"data-basefield":n,"data-baseitem":l}}),T=t.createElement("div",{className:"e-field-name-text-wrapper"}),M=t.createElement("div",{className:"e-field-option-wrapper"}),D=t.createElement("div",{className:"e-type-option-wrapper"}),O=t.createElement("div",{className:"e-base-field-option-wrapper"}),N=t.createElement("div",{className:"e-base-item-option-wrapper"}),E=t.createElement("div",{className:"e-field-name-title",innerHTML:this.parent.localeObj.getConstant("sourceName")+"&nbsp;"}),P=t.createElement("div",{className:"e-field-name-content",innerHTML:e.id.toString()}),F=t.createElement("div",{className:"e-type-option-text",innerHTML:this.parent.localeObj.getConstant("sourceCaption")}),I=t.createElement("div",{className:"e-base-field-option-text",innerHTML:this.parent.localeObj.getConstant("summarizeValuesBy")}),L=t.createElement("div",{className:"e-base-item-option-text",innerHTML:this.parent.localeObj.getConstant("baseField")}),A=t.createElement("div",{className:"e-type-option-text",innerHTML:this.parent.localeObj.getConstant("baseItem")}),R=t.createElement("div",{className:"e-caption-input-wrapper"}),j=t.createElement("div",{id:this.parentElement.id+"_type_option"}),k=t.createElement("div",{id:this.parentElement.id+"_base_field_option"}),q=t.createElement("div",{id:this.parentElement.id+"_base_item_option"}),V=t.createElement("input",{id:this.parentElement.id+"type_input_option",className:"e-caption-input-text",attrs:{type:"text"}});T.appendChild(E),T.appendChild(P),R.appendChild(F),R.appendChild(V),D.appendChild(I),O.appendChild(L),N.appendChild(A),D.appendChild(j),O.appendChild(k),N.appendChild(q),M.appendChild(T),M.appendChild(R),M.appendChild(D),M.appendChild(O),M.appendChild(N),w.appendChild(M);var H=this,B=new s.DropDownList({dataSource:d,enableRtl:this.parent.enableRtl,locale:this.parent.locale,fields:{value:"value",text:"text"},value:r,cssClass:Ei,width:"100%",change:function(e){_.enabled=-1!==g.indexOf(e.value),U.enabled=-1!==c.indexOf(e.value),U.enabled&&1===U.dataSource.length&&(U.dataSource=v,U.dataBind())}});B.isStringTemplate=!0,B.appendTo(j);var _=new s.DropDownList({dataSource:f,enableRtl:this.parent.enableRtl,locale:this.parent.locale,fields:{value:"value",text:"text"},value:n,enabled:-1!==g.indexOf(r),cssClass:Ei,width:"100%",change:function(e){v=Object.keys(H.parent.engineModule.fieldList[e.value].formattedMembers),U.dataSource=v,U.value=v[0],U.filterBarPlaceholder=H.parent.localeObj.getConstant("example")+" "+v[0],U.itemData=null,U.dataBind()}});_.isStringTemplate=!0,_.appendTo(k);var U=new s.DropDownList({dataSource:v,enableRtl:this.parent.enableRtl,locale:this.parent.locale,value:l,allowFiltering:!0,filterBarPlaceholder:this.parent.localeObj.getConstant("example")+" "+v[0],enabled:-1!==c.indexOf(r),cssClass:Pi,width:"100%"});U.isStringTemplate=!0,U.appendTo(q);var G=new o.MaskedTextBox({placeholder:"Enter field caption",enableRtl:this.parent.enableRtl,locale:this.parent.locale,value:a,width:"100%"});return G.isStringTemplate=!0,G.appendTo(V),w},e.prototype.selectOptionInContextMenu=function(e){if(null!==e.item.text){var i=this.currentMenu.parentElement,a=g.getFieldInfo(i?i.id:"",this.parent);if(this.parent.actionObj.actionName=Je,this.parent.actionObj.fieldInfo=a.fieldItem,this.parent.actionBeginMethod())return;var r=e.item.id.split("_").pop();try{if("MoreOption"===r||"PercentageOfDifferenceFrom"===r||"PercentageOfParentTotal"===r||"DifferenceFrom"===r)this.createValueSettingsDialog(i,this.parentElement,r);else{var n=i.getAttribute("data-uid"),o=this.parent.dataSourceSettings.values,s=i.querySelector(".e-content"),l=e.item.text+" "+this.parent.localeObj.getConstant("of")+" "+this.parent.engineModule.fieldList[n].caption;s.innerHTML=l,s.setAttribute("title",l),i.setAttribute("data-type",r);for(var d=0;d<this.parent.dataSourceSettings.values.length;d++)if(this.parent.dataSourceSettings.values[d].name===n){var h=t.extend({},o[d].properties?o[d].properties:o[d],null,!0);h.type=r,this.parent.engineModule.fieldList[n].aggregateType=r,o.splice(d,1,h),this.parent.lastAggregationInfo=h}this.updateDataSource()}}catch(e){this.parent.actionFailureMethod(e)}}},e.prototype.updateDataSource=function(e){this.parent.allowDeferLayoutUpdate&&"pivotview"!==this.parent.getModuleName()?"pivotfieldlist"===this.parent.getModuleName()&&"Popup"===this.parent.renderMode?(this.parent.pivotGridModule.setProperties({dataSourceSettings:this.parent.dataSourceSettings.properties},!0),this.parent.pivotGridModule.notify(ae,this),this.parent.pivotGridModule.engineModule=this.parent.engineModule):this.parent.triggerPopulateEvent():this.parent.updateDataSource(e)},e.prototype.updateValueSettings=function(){var e,i=this.valueDialog.element,a=t.getInstance(t.select("#"+this.parentElement.id+"type_input_option"),o.MaskedTextBox),r=t.getInstance(t.select("#"+this.parentElement.id+"_type_option"),s.DropDownList),n=t.getInstance(t.select("#"+this.parentElement.id+"_base_field_option"),s.DropDownList),l=t.getInstance(t.select("#"+this.parentElement.id+"_base_item_option"),s.DropDownList),d=i.getAttribute("data-field");if(this.parentElement.querySelector("."+_t)&&(e=this.parentElement.querySelector("."+_t+"."+d.replace(/[^A-Z0-9]/gi,""))),e){var h=e.querySelector(".e-content"),p=this.parent.localeObj.getConstant(r.value)+" "+this.parent.localeObj.getConstant("of")+" "+a.value;h.innerHTML=p,h.setAttribute("title",p),e.setAttribute("data-type",r.value),e.setAttribute("data-caption",a.value),e.setAttribute("data-basefield",n.value),e.setAttribute("data-baseitem",l.value)}var u=g.getFieldByName(d,this.parent.dataSourceSettings.values);(u=u.properties?u.properties:u).caption=a.value,u.type=r.value,u.baseField=n.value,u.baseItem=l.value,this.valueDialog.close(),this.parent.lastAggregationInfo=u,this.updateDataSource(!0)},e.prototype.removeDialog=function(){t.select("#"+this.buttonElement.id,this.parentElement)&&t.select("#"+this.buttonElement.id,this.parentElement).focus(),this.valueDialog&&!this.valueDialog.isDestroyed&&this.valueDialog.destroy(),document.getElementById(this.parentElement.id+"_ValueDialog")&&t.remove(document.getElementById(this.parentElement.id+"_ValueDialog"))},e.prototype.destroy=function(){this.parent.isDestroyed||this.menuInfo&&(void 0===this.menuInfo[1]||this.menuInfo[1].isDestroyed||this.menuInfo[1].destroy(),void 0===this.menuInfo[0]||this.menuInfo[0].isDestroyed||this.menuInfo[0].destroy())},e}(),$a=function(){function e(e){this.indentCollection={},this.colPos=0,this.lastSpan=0,this.lvlCollection={},this.hierarchyCollection={},this.lvlPosCollection={},this.hierarchyPosCollection={},this.position=0,this.measurePos=0,this.maxMeasurePos=0,this.hierarchyCount=0,this.actualText="",this.parent=e,this.resColWidth=this.parent.showGroupingBar&&this.parent.groupingBarModule?this.parent.isAdaptive?180:250:this.parent.isAdaptive?140:200,this.engine="olap"===this.parent.dataType?this.parent.olapEngineModule:this.parent.engineModule,this.gridSettings=this.parent.gridSettings,this.formatList=this.getFormatList(),this.aggMenu=new Za(this.parent)}return e.prototype.render=function(e){if(e&&this.initProperties(),this.resColWidth=this.parent.showGroupingBar&&this.parent.groupingBarModule?this.parent.isAdaptive?180:250:this.parent.isAdaptive?140:200,this.engine="olap"===this.parent.dataType?this.parent.olapEngineModule:this.parent.engineModule,this.gridSettings=this.parent.gridSettings,this.formatList=this.getFormatList(),this.parent.gridHeaderCellInfo=[],this.parent.gridCellCollection={},this.injectGridModules(this.parent),this.rowStartPos=this.getRowStartPos(),this.parent.grid&&this.parent.grid.element&&this.parent.element.querySelector(".e-grid")){if(this.parent.notEmpty=!0,this.engine.isEngineUpdated?(this.parent.enableValueSorting&&(this.engine.valueContent=this.frameDataSource("value")),this.engine.isEngineUpdated=!1):(this.engine.headerContent=this.frameDataSource("header"),this.engine.valueContent=this.frameDataSource("value")),this.parent.grid.setProperties({columns:this.frameStackedHeaders(),dataSource:("olap"===this.parent.dataType||this.parent.dataSourceSettings.values.length>0)&&!this.engine.isEmptyData?this.engine.valueContent:this.frameDataSource("value")},!0),"auto"===this.parent.grid.height){var i=this.parent.element.querySelector("."+ba).offsetHeight,a=this.parent.grid.dataSource.length*this.parent.gridSettings.rowHeight;i>50&&i<a&&this.parent.grid.contentModule.setHeightToContent(a)}this.parent.grid.notify("datasource-modified",{}),this.parent.isScrolling&&(this.parent.resizeInfo={}),this.parent.grid.refreshColumns(),this.parent.showGroupingBar&&this.parent.groupingBarModule&&this.parent.element.querySelector("."+pi)&&this.parent.groupingBarModule.setGridRowWidth();this.parent.element.querySelector(".e-movablecontent").querySelector("colGroup").innerHTML=this.parent.grid.getHeaderContent().querySelector(".e-movableheader").querySelector("colgroup").innerHTML,this.parent.grid.width=this.calculateGridWidth(),!this.gridSettings.allowAutoResizing&&this.parent.showGroupingBar&&this.parent.groupingBarModule&&this.parent.element.querySelector("."+pi)&&this.parent.groupingBarModule.refreshUI(),this.parent.isScrolling||this.calculateGridHeight(!0)}else this.parent.element.innerHTML="",this.bindGrid(this.parent,!!this.engine.isEmptyData),this.parent.element.appendChild(t.createElement("div",{id:this.parent.element.id+"_grid"})),this.parent.grid.isStringTemplate=!0,this.parent.grid.appendTo("#"+this.parent.element.id+"_grid");this.parent.grid.on(r.headerRefreshed,this.refreshHeader,this)},e.prototype.initProperties=function(){this.rowStartPos=void 0,this.maxIndent=void 0,this.resColWidth=void 0,this.isOverflows=void 0,this.indentCollection={},this.formatList=void 0,this.colPos=0,this.colGrandPos=void 0,this.rowGrandPos=void 0,this.lastSpan=0,this.field=void 0,this.fieldCaption=void 0,this.lvlCollection={},this.hierarchyCollection={},this.lvlPosCollection={},this.hierarchyPosCollection={},this.position=0,this.measurePos=0,this.maxMeasurePos=0,this.hierarchyCount=0,this.actualText="",this.timeOutObj=void 0},e.prototype.refreshHeader=function(){if(this.parent.enableVirtualization){var e=this.parent.element.querySelector("."+wa),i=this.parent.element.querySelector("."+ba),a=i.querySelector("."+ya);this.parent.virtualHeaderDiv=e.querySelector("."+ya),e.querySelector("."+ya)?t.remove(e.querySelector("."+ya)):this.parent.virtualHeaderDiv=t.createElement("div",{className:ya}),e.appendChild(this.parent.virtualHeaderDiv),a&&t.setStyleAttribute(this.parent.virtualHeaderDiv,{height:0,width:a.style.width}),t.setStyleAttribute(e.querySelector(".e-table"),{transform:i.querySelector(".e-table").style.transform.split(",")[0]+",0px)"});var r=this.parent.isAdaptive?i:i.parentElement.parentElement.querySelector("."+Ca);e.scrollLeft=r.scrollLeft}},e.prototype.bindGrid=function(e,t){this.injectGridModules(e),this.parent.grid=new r.Grid({frozenColumns:1,frozenRows:0,enableHover:!1,dataSource:t?this.frameEmptyData():this.frameDataSource("value"),columns:t?this.frameEmptyColumns():this.frameStackedHeaders(),height:t?"auto":this.calculateGridHeight(),width:t?this.gridSettings.allowAutoResizing?this.parent.width:400:this.calculateGridWidth(),locale:e.locale,enableRtl:e.enableRtl,allowExcelExport:e.allowExcelExport,allowPdfExport:e.allowPdfExport,allowResizing:this.gridSettings.allowResizing,allowTextWrap:this.gridSettings.allowTextWrap,allowReordering:!this.parent.showGroupingBar&&this.gridSettings.allowReordering,allowSelection:this.gridSettings.allowSelection,contextMenuItems:this.gridSettings.contextMenuItems,selectedRowIndex:this.gridSettings.selectedRowIndex,selectionSettings:this.gridSettings.selectionSettings,textWrapSettings:this.gridSettings.textWrapSettings,printMode:this.gridSettings.printMode,rowHeight:this.gridSettings.rowHeight,gridLines:this.gridSettings.gridLines,contextMenuClick:this.contextMenuClick.bind(this),contextMenuOpen:this.contextMenuOpen.bind(this),beforeCopy:this.gridSettings.beforeCopy?this.gridSettings.beforeCopy.bind(this.parent):void 0,beforePrint:this.gridSettings.beforePrint?this.gridSettings.beforePrint.bind(this.parent):void 0,printComplete:this.gridSettings.printComplete?this.gridSettings.printComplete.bind(this.parent):void 0,rowSelecting:this.gridSettings.rowSelecting?this.gridSettings.rowSelecting.bind(this.parent):void 0,rowSelected:this.rowSelected.bind(this),rowDeselecting:this.gridSettings.rowDeselecting?this.gridSettings.rowDeselecting.bind(this.parent):void 0,rowDeselected:this.rowDeselected.bind(this),cellSelecting:this.gridSettings.cellSelecting?this.gridSettings.cellSelecting.bind(this.parent):void 0,cellSelected:this.cellSelected.bind(this),cellDeselecting:this.gridSettings.cellDeselecting?this.gridSettings.cellDeselecting.bind(this.parent):void 0,cellDeselected:this.cellDeselected.bind(this),resizeStart:this.gridSettings.resizeStart?this.gridSettings.resizeStart.bind(this.parent):void 0,columnDragStart:this.gridSettings.columnDragStart?this.gridSettings.columnDragStart.bind(this):void 0,columnDrag:this.gridSettings.columnDrag?this.gridSettings.columnDrag.bind(this):void 0,columnDrop:this.gridSettings.columnDrop?this.gridSettings.columnDrop.bind(this):void 0,beforeExcelExport:this.beforeExcelExport.bind(this),resizing:this.setGroupWidth.bind(this),resizeStop:this.onResizeStop.bind(this),queryCellInfo:this.queryCellInfo.bind(this),dataBound:this.dataBound.bind(this),headerCellInfo:this.headerCellInfo.bind(this),excelHeaderQueryCellInfo:this.excelHeaderQueryCellInfo.bind(this),pdfHeaderQueryCellInfo:this.pdfHeaderQueryCellInfo.bind(this),excelQueryCellInfo:this.excelQueryCellInfo.bind(this),pdfQueryCellInfo:this.pdfQueryCellInfo.bind(this),beforePdfExport:this.gridSettings.beforePdfExport?this.gridSettings.beforePdfExport.bind(this):void 0,pdfExportComplete:this.pdfExportComplete.bind(this),excelExportComplete:this.excelExportComplete.bind(this)}),this.parent.grid.on("header-refreshed",this.headerRefreshed.bind(this)),this.parent.grid.on("export-DataBound",this.excelDataBound.bind(this))},e.prototype.headerRefreshed=function(e){this.parent.lastGridSettings&&Object.keys(this.parent.lastGridSettings).indexOf("allowResizing")>-1&&(this.parent.lastGridSettings=void 0,this.parent.showGroupingBar&&this.parent.groupingBarModule&&this.parent.element.querySelector("."+pi)&&this.parent.groupingBarModule.setGridRowWidth())},e.prototype.beforeExcelExport=function(e){t.isNullOrUndefined(e.gridObject.columns)||t.isNullOrUndefined(this.parent.pivotColumns)||(e.gridObject.columns[e.gridObject.columns.length-1].width=this.parent.pivotColumns[this.parent.pivotColumns.length-1].width),this.parent.trigger(G,e)},e.prototype.rowSelected=function(e){this.parent.renderModule.selected(),this.parent.trigger("rowSelected",e)},e.prototype.rowDeselected=function(e){this.parent.renderModule.selected(),this.parent.trigger("rowDeselected",e)},e.prototype.cellSelected=function(e){this.parent.rowRangeSelection.enable?(this.parent.grid.selectionModule.selectRowsByRange(this.parent.rowRangeSelection.startIndex,this.parent.rowRangeSelection.endIndex),this.parent.rowRangeSelection.enable=!1):(this.parent.renderModule.selected(),this.parent.trigger("selected",e))},e.prototype.cellSelecting=function(e){this.parent.trigger(E,e)},e.prototype.cellDeselected=function(e){this.parent.renderModule.selected(),this.parent.trigger("cellDeselected",e)},e.prototype.queryCellInfo=function(e){this.parent.renderModule.rowCellBoundEvent(e)},e.prototype.headerCellInfo=function(e){this.parent.renderModule.columnCellBoundEvent(e)},e.prototype.excelHeaderQueryCellInfo=function(e){this.parent.renderModule.excelColumnEvent(e)},e.prototype.pdfQueryCellInfo=function(e){this.parent.renderModule.pdfRowEvent(e)},e.prototype.excelQueryCellInfo=function(e){this.parent.renderModule.excelRowEvent(e)},e.prototype.pdfHeaderQueryCellInfo=function(e){this.parent.renderModule.pdfColumnEvent(e)},e.prototype.pdfExportComplete=function(e){void 0!==this.parent.lastColumn&&"auto"!==this.parent.lastColumn.width&&(this.parent.lastColumn.width="auto",this.parent.lastColumn=void 0)},e.prototype.excelExportComplete=function(e){void 0!==this.parent.lastColumn&&"auto"!==this.parent.lastColumn.width&&(this.parent.lastColumn.width="auto",this.parent.lastColumn=void 0)},e.prototype.dataBound=function(e){if(this.parent.cellTemplate){for(var i=0,a=this.parent.gridHeaderCellInfo;i<a.length;i++){var r=a[i];if(this.parent.cellTemplate){var n=this.parent.getCellTemplate()(r,this.parent,"cellTemplate",this.parent.element.id+"_cellTemplate",null,null,r.targetCell);n&&""!==n&&n.length>0&&(this.parent.enableHtmlSanitizer?this.parent.appendHtml(r.targetCell,t.SanitizeHtmlHelper.sanitize(n[0].outerHTML)):this.parent.appendHtml(r.targetCell,n[0].outerHTML))}}this.parent.gridHeaderCellInfo=[]}this.parent.grid&&this.parent.grid.widthService&&this.parent.grid.widthService.setWidthToTable(),this.parent.notEmpty&&this.calculateGridHeight(!0),this.parent.isScrolling=!1,this.setFocusOnLastCell(),t.isNullOrUndefined(this.parent.renderReactTemplates)||this.parent.renderReactTemplates(),this.parent.isInitial&&(this.parent.isInitial=!1,this.parent.refreshData()),this.parent.notify(re,{})},e.prototype.setFocusOnLastCell=function(){if(this.parent.keyboardModule&&this.parent.keyboardModule.event&&"TD"===this.parent.keyboardModule.event.target.nodeName){var e=this.parent.grid.serviceLocator.getService("focus");e.setFocusedElement(this.parent.keyboardModule.event.target),e.focus(this.parent.keyboardModule.event),t.addClass([this.parent.keyboardModule.event.target],["e-focused","e-focus"]),this.parent.keyboardModule.event.target.setAttribute("tabindex","0"),this.parent.keyboardModule.event=void 0}},e.prototype.contextMenuOpen=function(e){for(var i=this,a=function(a){var n=r.parent.lastCellClicked,o=null,s=void 0,l=void 0;if(n.classList.contains("e-stackedheadercelldiv")||n.classList.contains("e-cellvalue")||n.classList.contains("e-headercelldiv")||n.classList.contains("e-icons")||n.classList.contains("e-rhandler")?o=n.parentElement:n.classList.contains("e-headercell")||n.classList.contains("e-rowcell")||n.classList.contains("e-columnsheader")||n.classList.contains("e-rowsheader")||n.classList.contains("e-valuescontent")||n.classList.contains("e-valuesheader")?o=n:n.classList.contains("e-headertext")&&(o=n.parentElement.parentElement),!o)return e.cancel=!0,{value:void 0};(o.classList.contains("e-valuesheader")||o.classList.contains("e-stot"))&&(s=!0),r.parent.allowGrouping&&r.parent.groupingModule&&!r.validateField(o)&&(l=!0);var d=Number(o.getAttribute("index")),h=Number(o.getAttribute("aria-colindex")),p=r.parent.pivotValues[d][h];switch(a.id){case r.parent.element.id+"_expand":o.querySelectorAll("."+Ri).length>0?(t.selectAll("#"+r.parent.element.id+"_expand",e.element)&&t.select("#"+r.parent.element.id+"_expand",e.element).classList.add(da),t.select("#"+r.parent.element.id+"_expand",e.element).classList.contains(da)&&t.select("#"+r.parent.element.id+"_expand",e.element).classList.remove(da),t.select("#"+r.parent.element.id+"_expand",e.element).classList.contains(ha)&&(t.select("#"+r.parent.element.id+"_expand",e.element).classList.remove(ha),t.select("#"+r.parent.element.id+"_collapse",e.element).classList.remove(ha))):s?t.select("#"+r.parent.element.id+"_expand",e.element).classList.add(ha):t.select("#"+r.parent.element.id+"_expand",e.element).classList.add(da);break;case r.parent.element.id+"_collapse":o.querySelectorAll("."+Ai).length>0?(t.select("#"+r.parent.element.id+"_expand",e.element)&&t.select("#"+r.parent.element.id+"_expand",e.element).classList.add(da),t.select("#"+r.parent.element.id+"_collapse",e.element).classList.contains(da)&&t.select("#"+r.parent.element.id+"_collapse",e.element).classList.remove(da),t.select("#"+r.parent.element.id+"_collapse",e.element).classList.contains(ha)&&(t.select("#"+r.parent.element.id+"_collapse",e.element).classList.remove(ha),t.select("#"+r.parent.element.id+"_expand",e.element).classList.remove(ha))):s?t.select("#"+r.parent.element.id+"_collapse",e.element).classList.add(ha):t.select("#"+r.parent.element.id+"_collapse",e.element).classList.add(da);break;case r.parent.element.id+"_custom_group":l||2!==e.items.length||(e.cancel=!0),t.selectAll("#"+r.parent.element.id+"_custom_group",e.element)&&t.addClass([t.select("#"+r.parent.element.id+"_custom_group",e.element)],ha),l&&t.selectAll("#"+r.parent.element.id+"_custom_group",e.element)&&t.removeClass([t.select("#"+r.parent.element.id+"_custom_group",e.element)],ha);break;case r.parent.element.id+"_custom_ungroup":if(t.selectAll("#"+r.parent.element.id+"_custom_ungroup",e.element)&&t.addClass([t.select("#"+r.parent.element.id+"_custom_ungroup",e.element)],ha),l){var u=!1,c=o.getAttribute("fieldname"),m=g.getFieldByName(c,r.parent.dataSourceSettings.groupSettings);if(m&&"Custom"===m.type||r.parent.engineModule.fieldList[c].isCustomField&&c.indexOf("_custom_group")>-1){if(m=g.getFieldByName(c.replace("_custom_group",""),r.parent.dataSourceSettings.groupSettings)){var f=r.parent.engineModule.pivotValues[Number(o.getAttribute("index"))][Number(o.getAttribute("aria-colindex"))],v=r.parent.groupingModule.getSelectedCells(f.axis,c,f.actualText.toString());v.push({axis:f.axis,fieldName:c,name:f.actualText.toString(),cellInfo:f});for(var S=r.parent.groupingModule.getSelectedOptions(v),y=0,b=m.customGroups;y<b.length;y++){var C=b[y];if(S.indexOf(C.groupName)>-1){u=!0;break}}}}else(m&&("Date"===m.type||"Number"===m.type)||r.parent.engineModule.fieldList[c].isCustomField&&c.indexOf("_date_group")>-1)&&(u=!0);t.selectAll("#"+r.parent.element.id+"_custom_ungroup",e.element)&&u&&t.removeClass([t.select("#"+r.parent.element.id+"_custom_ungroup",e.element)],ha)}break;case r.parent.element.id+"_drillthrough":r.parent.allowDrillThrough?o.classList.contains("e-summary")?t.select("#"+r.parent.element.id+"_drillthrough",e.element).classList.contains(da)&&t.select("#"+r.parent.element.id+"_drillthrough",e.element).classList.remove(da):""===o.innerText&&t.select("#"+r.parent.element.id+"_drillthrough",e.element)&&t.select("#"+r.parent.element.id+"_drillthrough",e.element).classList.add(da):t.select("#"+r.parent.element.id+"_drillthrough",e.element)&&t.select("#"+r.parent.element.id+"_drillthrough",e.element).classList.add(da);break;case r.parent.element.id+"_sortasc":r.parent.enableValueSorting?o.querySelectorAll(".e-icon-descending").length>0?(t.select("#"+r.parent.element.id+"_sortdesc",e.element)?t.select("#"+r.parent.element.id+"_sortdesc",e.element).classList.add(da):t.select("#"+r.parent.element.id+"_sortdesc",e.element).classList.remove(da),t.select("#"+r.parent.element.id+"_sortasc",e.element).classList.contains(da)&&t.select("#"+r.parent.element.id+"_sortasc",e.element).classList.remove(da)):t.select("#"+r.parent.element.id+"_sortdesc",e.element).classList.contains(da)&&t.select("#"+r.parent.element.id+"_sortdesc",e.element).classList.remove(da):t.select("#"+r.parent.element.id+"_sortasc",e.element)&&t.select("#"+r.parent.element.id+"_sortasc",e.element).classList.add(da);break;case r.parent.element.id+"_sortdesc":r.parent.enableValueSorting?o.querySelectorAll(".e-icon-ascending").length>0?(t.select("#"+r.parent.element.id+"_sortasc",e.element)?t.select("#"+r.parent.element.id+"_sortasc",e.element).classList.add(da):t.select("#"+r.parent.element.id+"_sortasc",e.element).classList.remove(da),t.select("#"+r.parent.element.id+"_sortdesc",e.element).classList.contains(da)&&t.select("#"+r.parent.element.id+"_sortdesc",e.element).classList.remove(da)):t.select("#"+r.parent.element.id+"_sortasc",e.element).classList.contains(da)&&t.select("#"+r.parent.element.id+"_sortasc",e.element).classList.remove(da):t.select("#"+r.parent.element.id+"_sortdesc",e.element)&&t.select("#"+r.parent.element.id+"_sortdesc",e.element).classList.add(da);break;case r.parent.element.id+"_CalculatedField":r.parent.allowCalculatedField||t.select("#"+r.parent.element.id+"_CalculatedField",e.element).classList.add(da);break;case r.parent.element.id+"_pdf":r.parent.allowPdfExport||t.select("#"+r.parent.element.id+"_pdf",e.element).classList.add(da);break;case r.parent.element.id+"_excel":r.parent.allowExcelExport||t.select("#"+r.parent.element.id+"_excel",e.element).classList.add(da);break;case r.parent.element.id+"_csv":r.parent.allowExcelExport||t.select("#"+r.parent.element.id+"_csv",e.element).classList.add(da);break;case r.parent.element.id+"_exporting":r.parent.allowExcelExport||r.parent.allowPdfExport||t.select("#"+r.parent.element.id+"_exporting",e.element).classList.add(da);break;case r.parent.element.id+"_aggregate":if(t.select("#"+r.parent.element.id+"_aggregate",e.element)&&!t.select("#"+r.parent.element.id+"_aggregate",e.element).classList.contains(da)&&t.select("#"+r.parent.element.id+"_aggregate",e.element).classList.add(da),(o.classList.contains("e-valuesheader")||o.classList.contains("e-valuescontent")||o.classList.contains("e-stot")&&o.classList.contains("e-rowsheader"))&&"olap"!==r.parent.dataType){var x;""!==o.innerText&&(x=r.parent.engineModule.fieldList[p.actualText.toString()].type);var w={cancel:!1,fieldName:p.actualText.toString(),aggregateTypes:r.getMenuItem(x).slice(),displayMenuCount:7};r.parent.trigger(X,w,function(r){if(!r.cancel&&""!==o.innerText){for(var n=[],s=[],l=0;l<r.aggregateTypes.length;l++){var d=r.aggregateTypes[l];"number"!==x?["Count","DistinctCount"].indexOf(d)>-1&&s.indexOf(d)<0&&(n.push({text:i.parent.localeObj.getConstant(d),id:i.parent.element.id+"_Agg"+d}),s.push(d)):i.parent.getAllSummaryType().indexOf(d)>-1&&s.indexOf(d)<0&&(n.push({text:i.parent.localeObj.getConstant(d),id:i.parent.element.id+"_Agg"+d}),s.push(d))}n.length>r.displayMenuCount&&(n.splice(r.displayMenuCount),n.push({text:i.parent.localeObj.getConstant("MoreOption"),id:i.parent.element.id+"_AggMoreOption"})),n&&n.length>=1&&(a.items=n,t.select("#"+i.parent.element.id+"_aggregate",e.element).classList.remove(da))}})}}},r=this,n=0,o=e.items;n<o.length;n++){var s=a(o[n]);if("object"==typeof s)return s.value}this.parent.trigger("contextMenuOpen",e)},e.prototype.getMenuItem=function(e){for(var t=[],i=0;i<this.parent.aggregateTypes.length;i++){var a=this.parent.aggregateTypes[i];"string"!==e?this.parent.getAllSummaryType().indexOf(a)>-1&&-1===t.indexOf(a)&&t.push(a):["Count","DistinctCount"].indexOf(a)>-1&&-1===t.indexOf(a)&&t.push(a)}return t},e.prototype.contextMenuClick=function(e){var t=this,i=this.parent.lastCellClicked,a=e.item.id,r=new MouseEvent("dblclick",{view:window,bubbles:!0,cancelable:!0}),n={},o=null;i.classList.contains("e-stackedheadercelldiv")||i.classList.contains("e-cellvalue")||i.classList.contains("e-headercelldiv")||i.classList.contains("e-icons")||i.classList.contains("e-rhandler")?o=i.parentElement:i.classList.contains("e-headercell")||i.classList.contains("e-rowcell")?o=i:i.classList.contains("e-headertext")&&(o=i.parentElement.parentElement);var s,l=Number(o.getAttribute("index")),d=Number(o.getAttribute("aria-colindex")),h=this.parent.pivotValues[l][d];switch(e.item.id.indexOf(this.parent.element.id+"_Agg")>-1&&(this.field=this.parent.engineModule.fieldList[h.actualText.toString()].id,this.fieldCaption=this.parent.engineModule.fieldList[h.actualText.toString()].caption,s=e.item.id.split("_Agg")[1]),a){case this.parent.element.id+"_pdf":n={pdfDoc:void 0,isBlob:!1,isMultipleExport:!1,pdfExportProperties:{fileName:"Export.pdf"}},this.parent.trigger(b,n,function(e){t.parent.pdfExport(e.pdfExportProperties,e.isMultipleExport,e.pdfDoc,e.isBlob)});break;case this.parent.element.id+"_excel":n={isBlob:!1,isMultipleExport:!1,workbook:void 0,excelExportProperties:{fileName:"Export.xlsx"}},this.parent.trigger(b,n,function(e){t.parent.excelExport(e.excelExportProperties,e.isMultipleExport,e.workbook,e.isBlob)});break;case this.parent.element.id+"_csv":n={isBlob:!1,workbook:void 0,isMultipleExport:!1,excelExportProperties:{fileName:"Export.csv"}},this.parent.trigger(b,n,function(e){t.parent.csvExport(e.excelExportProperties,e.isMultipleExport,e.workbook,e.isBlob)});break;case this.parent.element.id+"_drillthrough_menu":o.dispatchEvent(r);break;case this.parent.element.id+"_sortasc":this.parent.setProperties({dataSourceSettings:{valueSortSettings:{headerText:h.valueSort.levelName,headerDelimiter:this.parent.dataSourceSettings.valueSortSettings.headerDelimiter}}}),this.parent.dataSourceSettings.valueSortSettings.sortOrder="Ascending";break;case this.parent.element.id+"_sortdesc":this.parent.setProperties({dataSourceSettings:{valueSortSettings:{headerText:h.valueSort.levelName,headerDelimiter:this.parent.dataSourceSettings.valueSortSettings.headerDelimiter}}}),this.parent.dataSourceSettings.valueSortSettings.sortOrder="Descending";break;case this.parent.element.id+"_expand":if(o.querySelectorAll("."+Ri)){var p=o.querySelectorAll("."+Ri)[0];this.parent.onDrill(p)}break;case this.parent.element.id+"_collapse":if(o.querySelectorAll("."+Ai)){var u=o.querySelectorAll("."+Ai)[0];this.parent.onDrill(u)}break;case this.parent.element.id+"_CalculatedField":this.parent.calculatedFieldModule.createCalculatedFieldDialog();break;case this.parent.element.id+"_AggMoreOption":case this.parent.element.id+"_AggDifferenceFrom":case this.parent.element.id+"_AggPercentageOfDifferenceFrom":case this.parent.element.id+"_AggPercentageOfParentTotal":o.setAttribute("id",this.field),o.setAttribute("data-caption",this.fieldCaption),o.setAttribute("data-field",this.field),o.setAttribute("data-type",this.engine.fieldList[h.actualText.toString()].aggregateType),o.setAttribute("data-basefield",this.engine.fieldList[h.actualText.toString()].baseField),o.setAttribute("data-baseItem",this.engine.fieldList[h.actualText.toString()].baseItem),this.aggMenu.createValueSettingsDialog(o,this.parent.element,s);break;case this.parent.element.id+"_Agg"+s:this.updateAggregate(s);break;case this.parent.element.id+"_custom_group":case this.parent.element.id+"_custom_ungroup":if(this.parent.groupingModule){var c={target:o,option:a,parentElement:this.parent.element};this.parent.notify(ue,c),this.parent.grid.contextMenuModule.contextMenu.close()}}this.parent.trigger(B,e)},e.prototype.validateColumnTotalcell=function(e){for(var t=Object.keys(this.engine.headerContent),i=!1,a="",r=t.length-1;r>=0;r--){var n=this.engine.headerContent[t[r]][e];if(!n)return!1;if(i=!(!i||""===a)&&a===n.valueSort.axis,a=n.valueSort.axis?n.valueSort.axis.toString():"","sum"===n.type&&(i=!0),i&&n.members&&n.members.length>0)return!0}return!1},e.prototype.validateField=function(e){var t=!1;if(e.classList.contains("e-stot")||e.classList.contains("e-gtot")||e.classList.contains("e-valuescontent")||e.classList.contains("e-valuesheader"))t=!0;else{var i=e.getAttribute("fieldName");if(!i||""==i){var a=Number(e.getAttribute("index")),r=Number(e.getAttribute("aria-colindex"));i=this.engine.pivotValues[a][r].actualText}for(var n=this.parent.dataSourceSettings.values,o=0;o<n.length;o++)if(this.parent.dataSourceSettings.values[o].name===i){t=!0;break}}return t},e.prototype.updateAggregate=function(e){if(this.parent.getAllSummaryType().indexOf(e)>-1)for(var t=this.parent.dataSourceSettings.values,i=0;i<this.parent.dataSourceSettings.values.length;i++)if(this.parent.dataSourceSettings.values[i].name===this.field){t[i].type=e}},e.prototype.injectGridModules=function(e){r.Grid.Inject(r.Freeze),e.allowExcelExport&&r.Grid.Inject(r.ExcelExport),e.allowPdfExport&&r.Grid.Inject(r.PdfExport),r.Grid.Inject(r.Selection,r.Reorder,r.Resize),this.gridSettings.contextMenuItems&&r.Grid.Inject(r.ContextMenu)},e.prototype.updateGridSettings=function(){if(this.injectGridModules(this.parent),this.parent.grid.allowResizing=this.gridSettings.allowResizing,this.parent.grid.allowTextWrap=this.gridSettings.allowTextWrap,this.parent.grid.allowReordering=!this.parent.showGroupingBar&&this.gridSettings.allowReordering,this.parent.grid.allowSelection=this.gridSettings.allowSelection,this.parent.grid.contextMenuItems=this.gridSettings.contextMenuItems,this.parent.grid.selectedRowIndex=this.gridSettings.selectedRowIndex,this.parent.grid.selectionSettings=this.gridSettings.selectionSettings,this.parent.grid.textWrapSettings=this.gridSettings.textWrapSettings,this.parent.grid.printMode=this.gridSettings.printMode,this.parent.grid.rowHeight=this.gridSettings.rowHeight,this.parent.grid.gridLines=this.gridSettings.gridLines,this.parent.lastGridSettings){var e=Object.keys(this.parent.lastGridSettings);e.indexOf("height")>-1&&(this.parent.grid.height=this.gridSettings.height),e.indexOf("width")>-1&&(this.parent.grid.width=this.gridSettings.width),this.updatePivotColumns(),e.indexOf("allowTextWrap")>-1&&this.parent.layoutRefresh()}this.clearColumnSelection()},e.prototype.updatePivotColumns=function(){for(var e=Object.keys(this.parent.lastGridSettings),i=0;i<this.parent.pivotColumns.length;i++)for(var a=this.parent.pivotColumns[i],r=0;r<e.length;r++){var n=e[r];t.isNullOrUndefined(this.parent.pivotColumns[i][n])||(a[n]=this.parent.lastGridSettings[n])}this.parent.fillGridColumns(this.parent.grid.columns)},e.prototype.clearColumnSelection=function(){t.removeClass(this.parent.element.querySelectorAll("."+Na),[Na,Ma])},e.prototype.appendValueSortIcon=function(e,i,a,r){if(this.parent.enableValueSorting&&"pivot"===this.parent.dataType){var n=this.parent.dataSourceSettings.valueSortSettings,o="grand sum"!==e.type||1!==this.parent.dataSourceSettings.values.length||this.parent.dataSourceSettings.alwaysShowValueHeader?this.parent.dataSourceSettings.values.length>1||this.parent.dataSourceSettings.alwaysShowValueHeader?this.parent.engineModule.headerContent.length-1:0===this.parent.dataSourceSettings.columns.length?0:this.parent.engineModule.headerContent.length-1:0,s=n&&n.headerText?e.valueSort.levelName===n.headerText:r===n.columnIndex;if(void 0!==n&&s&&(a===o||a+1===o&&e.level>-1&&this.parent.engineModule.headerContent[a+1][r]&&-1===this.parent.engineModule.headerContent[a+1][r].level)&&"column"===this.parent.dataSourceSettings.valueAxis&&(i.querySelector(".e-sortfilterdiv")?(i.querySelector(".e-sortfilterdiv").classList.add("Descending"===n.sortOrder?"e-descending":"e-ascending"),i.querySelector(".e-sortfilterdiv").classList.add("Descending"===n.sortOrder?"e-icon-descending":"e-icon-ascending")):i.appendChild(t.createElement("div",{className:"Descending"===n.sortOrder?"e-icon-descending e-icons e-descending e-sortfilterdiv":"e-icon-ascending e-icons e-ascending e-sortfilterdiv"})),!t.isNullOrUndefined(e.hasChild)&&"grand sum"!==e.type&&i.querySelector(".e-expand")&&(i.querySelector(".e-icon-descending")||i.querySelector(".e-icon-ascending")))){var l=i.querySelector(".e-icon-descending")||i.querySelector(".e-icon-ascending");t.setStyleAttribute(l,{"padding-top":"12px"})}}return i},e.prototype.onResizeStop=function(e){var i="0.formattedText"===e.column.field?"0.formattedText":e.column.customAttributes.cell.valueSort.levelName;if(this.parent.resizeInfo[i]=Number(e.column.width.toString().split("px")[0]),this.parent.enableVirtualization&&"0.formattedText"===e.column.field){if(this.parent.dataSourceSettings.values.length>1&&!t.isNullOrUndefined(this.parent.grid.columns[this.parent.grid.columns.length-1].columns)){var a=this.parent.grid.columns[this.parent.grid.columns.length-1].columns;a[a.length-1].minWidth=this.parent.gridSettings.columnWidth}else this.parent.grid.columns[this.parent.grid.columns.length-1].minWidth=this.parent.gridSettings.columnWidth;this.parent.layoutRefresh()}this.setGroupWidth(e),this.calculateGridHeight(!0),this.parent.grid.hideScroll()},e.prototype.setGroupWidth=function(e){if(this.parent.enableVirtualization&&"0.formattedText"===e.column.field&&(this.parent.showGroupingBar&&this.parent.groupingBarModule&&this.parent.element.querySelector("."+pi)&&Number(e.column.width.toString().split("px")[0])<250?e.cancel=!0:this.parent.element.querySelector(".e-frozenscrollbar").style.width=e.column.width.toString().split("px")[0]+"px"),this.parent.showGroupingBar&&this.parent.groupingBarModule&&this.parent.element.querySelector("."+pi)){if(this.parent.groupingBarModule.refreshUI(),this.parent.element.querySelector(".e-group-row").offsetWidth<245&&!this.parent.firstColWidth){e.cancel=!0;var t=this.parent.grid.columns;t&&t.length>0&&(t[0].width=this.resColWidth),this.parent.element.querySelector(".e-frozenheader").querySelector("col").style.width=this.resColWidth+"px",this.parent.element.querySelector(".e-frozencontent").querySelector("col").style.width=this.resColWidth+"px"}this.parent.element.querySelector(".e-group-rows").style.height="auto",this.parent.element.querySelector(".e-group-values").style.width=this.parent.element.querySelector(".e-group-row").offsetWidth+"px";var i=this.parent.element.querySelector(".e-headercontent").offsetHeight;this.parent.element.querySelector(".e-group-rows").style.height=i+"px"}if(e.cancel){var a="0.formattedText"===e.column.field?"0.formattedText":e.column.customAttributes.cell.valueSort.levelName;this.parent.resizeInfo[a]=Number(e.column.width.toString().split("px")[0]),this.parent.enableVirtualization&&this.parent.layoutRefresh()}this.parent.enableVirtualization&&(this.parent.resizedValue=e.cancel||"0.formattedText"!==e.column.field?this.parent.resizedValue:Number(e.column.width.toString().split("px")[0])),this.parent.trigger("touchend"===e.e.type||"mouseup"===e.e.type?"resizeStop":"resizing",e)},e.prototype.selected=function(){clearTimeout(this.timeOutObj),this.timeOutObj=setTimeout(this.onSelect.bind(this),300)},e.prototype.onSelect=function(){for(var e={selectedCellsInfo:[],pivotValues:this.parent.pivotValues,currentCell:null},t=0,i=this.parent.element.querySelectorAll("."+Ta+",."+Ma);t<i.length;t++){var a=i[t],r=Number(a.getAttribute("aria-colindex")),n=Number(a.getAttribute("index")),o=this.engine.pivotValues[n][r];o&&("value"===o.axis?e.selectedCellsInfo.push({currentCell:o,value:o.value,columnHeaders:o.columnHeaders,rowHeaders:o.rowHeaders,measure:o.actualText.toString()}):"column"===o.axis?e.selectedCellsInfo.push({currentCell:o,value:o.formattedText,columnHeaders:o.valueSort.levelName,rowHeaders:"",measure:""}):e.selectedCellsInfo.push({currentCell:o,value:o.formattedText,columnHeaders:"",rowHeaders:o.valueSort.levelName,measure:""}))}this.parent.trigger("cellSelected",e)},e.prototype.rowCellBoundEvent=function(e){var i=e.cell;if(i&&this.parent.notEmpty&&this.engine.headerContent){var a=this.parent.hyperlinkSettings.cssClass,r=e.data[0],n=r.valueSort&&r.valueSort.levelName===(0===this.parent.dataSourceSettings.rows.length&&"row"===this.parent.dataSourceSettings.valueAxis&&this.parent.localeObj.getConstant("grandTotal")+this.parent.dataSourceSettings.valueSortSettings.headerDelimiter+r.formattedText);if(i.setAttribute("index",r.rowIndex?r.rowIndex.toString():"0"),"0"===i.getAttribute("aria-colindex")){if("pivot"===this.parent.dataType){var o=r.type&&"value"===r.type;i.innerText="";var s=r.valueSort?r.valueSort.levelName.toString():"",l=r.actualText?r.actualText.toString().split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter).length:0,d=s.split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter).length-(l?l-1:l),h=d?d-1:0;do{h>0&&i.appendChild(t.createElement("span",{className:0===h?"":_i})),h--}while(h>-1);h=d?d-1:0,this.lastSpan=d?this.lastSpan:0,!r.hasChild&&(o?0:h)>0&&i.appendChild(t.createElement("span",{className:Ui}));var p=void 0;if(this.parent.dataSourceSettings.rows.length>0&&(!r.valueSort||Object.keys(r.valueSort).length>0)){if(o)for(var u=0,c=this.parent.dataSourceSettings.values;u<c.length;u++){var g=c[u],m=g.caption?g.caption:g.name;if(s.indexOf(m)>-1){p=g.name;break}}else p=r.level>-1&&this.parent.dataSourceSettings.rows[r.level]?this.parent.dataSourceSettings.rows[r.level].name:"";i.setAttribute("fieldname",p)}}else i=this.onOlapRowCellBoundEvent(i,r);var f=r.formattedText;if(r.type)if("grand sum"===r.type){this.rowGrandPos=r.rowIndex,i.classList.add("e-gtot");var v=this.parent.dataSourceSettings.values;f=t.isNullOrUndefined(r.valueSort.axis)?0===this.parent.dataSourceSettings.rows.length&&1===v.length&&"row"===this.parent.dataSourceSettings.valueAxis?this.parent.localeObj.getConstant("total")+" "+this.parent.localeObj.getConstant(v[v.length-1].type)+" "+this.parent.localeObj.getConstant("of")+" "+(t.isNullOrUndefined(v[v.length-1].caption)?v[v.length-1].name:v[v.length-1].caption):this.parent.localeObj.getConstant("grandTotal"):r.formattedText}else r.valueSort.levelName===this.parent.localeObj.getConstant("grandTotal")+this.parent.dataSourceSettings.valueSortSettings.headerDelimiter+r.formattedText?(i.classList.add("e-gtot"),f=n?this.parent.localeObj.getConstant("total")+" "+this.parent.localeObj.getConstant(this.parent.engineModule.fieldList[r.actualText].aggregateType)+" "+this.parent.localeObj.getConstant("of")+" "+r.formattedText:f):i.classList.add("e-stot");i.classList.add(qi),!0!==r.hasChild||r.isNamedSet||i.appendChild(t.createElement("div",{className:(!0===r.isDrilled?Ai:Ri)+" "+Ot,attrs:{title:!0===r.isDrilled?this.parent.localeObj.getConstant("collapse"):this.parent.localeObj.getConstant("expand")}})),i.appendChild(t.createElement("span",{className:Vi,innerHTML:this.parent.isRowCellHyperlink||r.enableHyperlink?'<a  data-url="'+f+'" class="e-hyperlinkcell '+a+'">'+f+"</a>":f}));var S=this.parent.pivotView.dataSourceSettings.valueSortSettings;if(this.parent.enableValueSorting&&S&&S.headerText&&"row"===this.parent.dataSourceSettings.valueAxis&&this.parent.pivotValues[Number(i.getAttribute("index"))][0]&&this.parent.pivotValues[Number(i.getAttribute("index"))][0].valueSort.levelName&&this.parent.pivotValues[Number(i.getAttribute("index"))][0].valueSort.levelName===S.headerText){var y=i.querySelector(".e-expand")||i.querySelector(".e-collapse")?"padding-top: 18px":"padding-top: 12px";i.appendChild(t.createElement("div",{className:"Descending"===S.sortOrder?"e-icon-descending e-icons e-descending e-sortfilterdiv":"e-icon-ascending e-icons e-ascending e-sortfilterdiv",styles:y}))}}else{var b=i.innerText;i.innerText="",i.classList.add("e-valuescontent"),r=e.data[Number(i.getAttribute("aria-colindex"))],(r=t.isNullOrUndefined(r)?e.column.customAttributes.cell:r).isGrandSum=!!n||r.isGrandSum,r.isSum&&i.classList.add("e-summary");var C=t.isNullOrUndefined(r.isGrandSum)&&!t.isNullOrUndefined(this.parent.olapEngineModule)&&"column"===this.parent.olapEngineModule.olapValueAxis&&"olap"===this.parent.dataType&&this.colGrandPos-this.parent.dataSourceSettings.values.length<Number(i.getAttribute("aria-colindex"));r.isGrandSum||C||this.colGrandPos===Number(i.getAttribute("aria-colindex"))||this.rowGrandPos===Number(i.getAttribute("index"))?i.classList.add("e-gtot"):("olap"===this.parent.dataType?r.isSum:this.validateColumnTotalcell(t.isNullOrUndefined(r.value)?r.colIndex-1:r.colIndex))&&i.classList.add("e-colstot"),r.cssClass&&i.classList.add(r.cssClass),i.appendChild(t.createElement("span",{className:Vi,innerHTML:-1!==i.className.indexOf("e-summary")&&this.parent.isSummaryCellHyperlink||-1===i.className.indexOf("e-summary")&&this.parent.isValueCellHyperlink||r.enableHyperlink?'<a data-url="'+b+'" class="e-hyperlinkcell '+a+'">'+b+"</a>":b})),this.parent.gridSettings.allowReordering&&!this.parent.showGroupingBar&&i.setAttribute("aria-colindex",e.column.customAttributes.cell.colIndex.toString())}if(this.parent.cellTemplate){i.getAttribute("index"),i.getAttribute("aria-colindex");var x=this.parent.getCellTemplate()({targetCell:i,cellInfo:r},this.parent,"cellTemplate",this.parent.element.id+"_cellTemplate",null,null,i);x&&""!==x&&x.length>0&&(this.parent.enableHtmlSanitizer?this.parent.appendHtml(i,t.SanitizeHtmlHelper.sanitize(x[0].outerHTML)):this.parent.appendHtml(i,x[0].outerHTML))}this.unWireEvents(i),this.wireEvents(i)}e.pivotview=this.parent,this.parent.trigger("queryCellInfo",e)},e.prototype.onOlapRowCellBoundEvent=function(e,i){e.innerText="";var a=this.engine.rowMeasurePos;if(this.parent.enableVirtualization){if(i.ordinal>-1&&this.parent.olapEngineModule.tupRowInfo.length>0){var r=this.parent.olapEngineModule.tupRowInfo[i.ordinal],n=r.uNameCollection.indexOf(i.actualText.toString()),o=(r.uNameCollection.substring(0,n)+(3===i.memberType?"":i.actualText.toString())).split("::[").map(function(e){return"["===e[0]?e:"["+e});3===i.memberType&&a&&o.push(i.actualText.toString());for(var s=-1,l=0,d=!1,h=0;h<o.length;h++){s+=o[h].split("~~").length;var p="2"!==r.typeCollection[h]&&(!!(this.engine.fieldList[r.members[h].getAttribute("Hierarchy")]&&this.engine.fieldList[r.members[h].getAttribute("Hierarchy")].isHierarchy&&h<this.parent.dataSourceSettings.rows.length-1&&!this.parent.dataSourceSettings.rows[h+1].isNamedSet&&this.parent.dataSourceSettings.rows[h+1].name.indexOf("[Measures]")<0&&this.engine.fieldList[this.parent.dataSourceSettings.rows[h+1].name]&&this.engine.fieldList[this.parent.dataSourceSettings.rows[h+1].name].hasAllMember)||Number(r.members[h].querySelector("CHILDREN_CARDINALITY").textContent)>0);l+=h>0&&d&&!p?1:0,d=p}for(var u=0,c=0;c<s;c++)e.appendChild(t.createElement("span",{className:_i})),u++;for(c=0;c<l&&s>0;c++)e.appendChild(t.createElement("span",{className:Ui}));this.indentCollection[i.rowIndex]=u,this.maxIndent=this.maxIndent>u?this.maxIndent:u}}else{var g=i.hierarchy,m=3===i.memberType?this.measurePos+"."+i.levelUniqueName:i.levelUniqueName;p=i.hasChild;if(!this.lvlCollection[m]&&m)this.lvlPosCollection[this.position]=m,this.lvlCollection[m]={position:this.position,hasChild:p},this.position++;else if(m){for(var f=this.lvlCollection[m].position,v=f+1;v<this.position;v++)delete this.lvlCollection[this.lvlPosCollection[v]],delete this.lvlPosCollection[v];this.position=this.position>f+1?f+1:this.position}if(!this.hierarchyCollection[g]&&g)this.hierarchyPosCollection[this.hierarchyCount]=g,this.hierarchyCollection[g]={lvlPosition:this.position-1,hierarchyPOs:this.hierarchyCount},this.hierarchyCount++;else if(g){var S=this.hierarchyCollection[g].hierarchyPOs;for(v=S+1;v<this.hierarchyCount;v++)delete this.hierarchyCollection[this.hierarchyPosCollection[v]],delete this.hierarchyPosCollection[v];this.hierarchyCount=this.hierarchyCount>S+1?S+1:this.hierarchyCount}if(3!==i.memberType&&m&&this.lvlCollection[m]){var y=this.hierarchyCollection[g]?this.hierarchyCollection[g].hierarchyPOs:-1;this.measurePos=a<=y&&this.hierarchyPosCollection[a+1]?this.measurePos:this.lvlCollection[m].position}var b=this.lvlCollection[m]?this.lvlCollection[m].position:-1,C=0;for(u=0;C<=b&&b>0&&i.level>-1;){var x=this.lvlCollection[this.lvlPosCollection[C]].hasChild;(d=C>0&&this.lvlCollection[this.lvlPosCollection[C-1]].hasChild)&&!x&&e.appendChild(t.createElement("span",{className:Ui})),C!==b&&(e.appendChild(t.createElement("span",{className:_i})),u++),C++}"Top"!==this.parent.dataSourceSettings.grandTotalsPosition||t.isNullOrUndefined(this.parent.olapEngineModule)||"row"!==this.parent.olapEngineModule.olapValueAxis||"olap"!==this.parent.dataType||0!==i.valueSort.levelName.toString().indexOf(this.parent.localeObj.getConstant("grandTotal")+this.parent.dataSourceSettings.valueSortSettings.headerDelimiter)||e.appendChild(t.createElement("span",{className:_i})),3===i.memberType&&-1===i.level&&Object.keys(this.lvlCollection).length>1&&(e.appendChild(t.createElement("span",{className:_i})),u++),this.indentCollection[i.rowIndex]=u,this.maxIndent=this.maxIndent>u?this.maxIndent:u}e.setAttribute("fieldname",i.hierarchy);return!!this.parent.olapEngineModule.tupRowInfo[i.ordinal]&&(0===this.parent.olapEngineModule.tupRowInfo[i.ordinal].measurePosition?1===this.parent.olapEngineModule.tupRowInfo[i.ordinal].allStartPos:0===this.parent.olapEngineModule.tupRowInfo[i.ordinal].allStartPos)&&e.classList.add("e-gtot"),e},e.prototype.columnCellBoundEvent=function(e){if(e.cell.column&&e.cell.column.customAttributes){var i=e.cell.column.customAttributes.cell,a=e.node;if(i){for(var r=this.parent.hyperlinkSettings.cssClass,n=!1,o=0,s=this.parent.dataSourceSettings.values;o<s.length;o++){var l=s[o];l.name===i.actualText&&(n=!0,a.setAttribute("fieldname",l.name))}i.rowIndex&&i.rowIndex;-1===i.level&&!i.rowSpan||-1===i.rowSpan?e.node.style.display="none":i.rowSpan>1&&(e.node.setAttribute("rowspan",i.rowSpan.toString()),e.node.setAttribute("aria-rowspan",i.rowSpan.toString()),i.rowIndex+i.rowSpan===this.engine.headerContent.length&&(e.node.style.borderBottomWidth="0px")),e.node.setAttribute("aria-colindex",i.colIndex.toString()),e.node.setAttribute("index",i.rowIndex.toString());var d=void 0;"pivot"===this.parent.dataType?(!n&&!(this.parent.dataSourceSettings.values&&"column"===this.parent.dataSourceSettings.valueAxis&&this.parent.dataSourceSettings.values.length>1&&n&&i.rowIndex===this.engine.headerContent.length-1)&&this.parent.dataSourceSettings.columns&&this.parent.dataSourceSettings.columns.length>0&&(d=i.level>-1&&this.parent.dataSourceSettings.columns[i.level]?this.parent.dataSourceSettings.columns[i.level].name:"",a.setAttribute("fieldname",d)),this.validateColumnTotalcell(i.colIndex)&&a.classList.add("e-colstot")):a=this.onOlapColumnCellBoundEvent(a,i);var h=0===this.parent.dataSourceSettings.columns.length&&"column"===this.parent.dataSourceSettings.valueAxis&&i.valueSort&&i.valueSort.levelName===this.parent.localeObj.getConstant("grandTotal")+this.parent.dataSourceSettings.valueSortSettings.headerDelimiter+i.formattedText;if(i.type||h){a.classList.add("grand sum"===i.type?"e-gtot":"e-stot"),"grand sum"===i.type?this.colGrandPos=i.colIndex:i.type&&a.classList.add("e-colstot");var p="grand sum"===i.type?t.isNullOrUndefined(i.valueSort.axis)?this.parent.localeObj.getConstant("grandTotal"):i.formattedText:i.formattedText.split("Total")[0]+this.parent.localeObj.getConstant("total");p=h?this.parent.localeObj.getConstant("total")+" "+this.parent.localeObj.getConstant(this.parent.engineModule.fieldList[i.actualText].aggregateType)+" "+this.parent.localeObj.getConstant("of")+" "+i.formattedText:p,null!==a.querySelector(".e-headertext")?a.querySelector(".e-headertext").innerText=p:a.querySelector(".e-stackedheadercelldiv").innerText=p}if(a.classList.add(ki),this.parent.isColumnCellHyperlink||i.enableHyperlink)if(a.querySelector(".e-stackedheadercelldiv")){var u=a.querySelector(".e-stackedheadercelldiv").innerText;a.querySelector(".e-stackedheadercelldiv").innerHTML='<a data-url="'+u+'" class="e-hyperlinkcell '+r+'">'+u+"</a>"}else if(a.querySelector(".e-headertext")){u=a.querySelector(".e-headertext").innerText;a.querySelector(".e-headertext").innerHTML='<a data-url="'+u+'" class="e-hyperlinkcell '+r+'">'+u+"</a>"}if(!0===i.hasChild&&!i.isNamedSet){var c=a.querySelector(".e-headercelldiv");c&&(c.style.height="auto",c.style.lineHeight="normal");var g=t.createElement("div",{className:(!0===i.isDrilled?Ai:Ri)+" "+Ot,attrs:{title:!0===i.isDrilled?this.parent.localeObj.getConstant("collapse"):this.parent.localeObj.getConstant("expand")}});a.children[0].classList.add(Vi),window.navigator.userAgent.indexOf("Edge")>-1||window.navigator.userAgent.indexOf("Trident")>-1?a.children[0].style.display="table":a.children[0].style.display="block",a.insertBefore(g,a.children[0])}if(a=this.appendValueSortIcon(i,a,i.rowIndex,i.colIndex),this.parent.cellTemplate){a.getAttribute("index"),a.getAttribute("aria-colindex");this.parent.gridHeaderCellInfo.push({targetCell:a})}for(var m=this.parent.dataSourceSettings.values.length,f=0;f<m;f++)if(this.parent.dataSourceSettings.values[f].name===i.actualText){if("olap"===this.parent.dataType){!!this.parent.olapEngineModule.tupColumnInfo[i.ordinal]&&(0===this.parent.olapEngineModule.tupColumnInfo[i.ordinal].measurePosition?1===this.parent.olapEngineModule.tupColumnInfo[i.ordinal].allStartPos:0===this.parent.olapEngineModule.tupColumnInfo[i.ordinal].allStartPos)&&a.classList.add("e-gtot")}i.valueSort.levelName===this.parent.localeObj.getConstant("grandTotal")+this.parent.dataSourceSettings.valueSortSettings.headerDelimiter+i.formattedText||i.valueSort.levelName==="Grand Total"+this.parent.dataSourceSettings.valueSortSettings.headerDelimiter+i.formattedText?a.classList.add("e-gtot"):a.classList.add("e-valuesheader")}this.unWireEvents(a),this.wireEvents(a)}}this.parent.trigger("headerCellInfo",e)},e.prototype.onOlapColumnCellBoundEvent=function(e,t){e.setAttribute("fieldname",3===t.memberType?t.actualText.toString():t.hierarchy);var i=this.engine.headerContent[t.rowIndex]?this.engine.headerContent[t.rowIndex][t.colIndex-1]:void 0;return i&&i.actualText===t.actualText&&i.type===t.type&&i.colSpan>1?e.style.display="none":(e.setAttribute("colspan",t.colSpan.toString()),e.setAttribute("aria-colspan",t.colSpan.toString())),t.rowIndex===this.engine.headerContent.length-1&&2===t.memberType&&(e.style.display=this.isSpannedCell(this.engine.headerContent.length,t)?"none":e.style.display),e},e.prototype.isSpannedCell=function(e,t){for(var i,a,r=this.engine.headerContent[t.rowIndex-1]?this.engine.headerContent[t.rowIndex-1][t.colIndex]:void 0;r&&(r.memberType===t.memberType||r.type&&t.type);)r.rowSpan>0&&(i=r.rowSpan,a=r.rowIndex),r=this.engine.headerContent[r.rowIndex-1]?this.engine.headerContent[r.rowIndex-1][t.colIndex]:void 0;return a+i>=e},e.prototype.onHyperCellClick=function(e){var i=e.target.parentElement.parentElement,a={currentCell:i=i.className.indexOf("e-headercelldiv")>-1?i.parentElement:i,data:this.engine.pivotValues[Number(i.getAttribute("index"))][Number(i.getAttribute("aria-colindex"))],cancel:!0,nativeEvent:e};this.parent.trigger(O,a,function(e){if(!e.cancel){a.currentCell=t.getElement(a.currentCell);var i=a.currentCell.getAttribute("data-url")?a.currentCell.getAttribute("data-url"):a.currentCell.querySelector("a").getAttribute("data-url");window.open(i)}})},e.prototype.getRowStartPos=function(){for(var e,t=this.parent.pivotValues,i=0;i<(t?t.length:0);i++)if(t[i]&&t[i][0]&&"row"===t[i][0].axis){e=i;break}return e},e.prototype.frameDataSource=function(e){var t=[];if(this.parent.dataSourceSettings.values.length>0&&!this.engine.isEmptyData)if(this.parent.enableValueSorting||!this.engine.isEngineUpdated){for(var i=0,a=this.parent.pivotValues,r="value"===e?this.rowStartPos:0,n="value"===e?a?a.length:0:this.rowStartPos,o=r;o<n;o++)if(a[o]){t[i="header"===e?o:i]={};for(var s=0;s<a[o].length;s++)a[o][s]&&(t[i][s]=a[o][s]);i++}}else t="value"===e?this.engine.valueContent:this.engine.headerContent;else t=this.frameEmptyData();return t},e.prototype.frameEmptyData=function(){return[{0:{formattedText:this.parent.localeObj.getConstant("grandTotal")},1:{formattedText:this.parent.localeObj.getConstant("emptyData")}}]},e.prototype.calculateColWidth=function(e){t.isNullOrUndefined(this.parent.resizedValue)||(this.parent.resizedValue=this.parent.showGroupingBar&&this.parent.resizedValue<250?250:this.parent.resizedValue),this.resColWidth=t.isNullOrUndefined(this.parent.resizedValue)?this.resColWidth:this.parent.resizedValue;var i=this.parent.element.offsetWidth?this.parent.element.offsetWidth:this.parent.element.getBoundingClientRect().width,a=isNaN(this.parent.width)?this.parent.width.toString().indexOf("%")>-1?parseFloat(this.parent.width.toString())/100*i:i:Number(this.parent.width);a=a-(this.gridSettings.columnWidth>this.resColWidth?this.gridSettings.columnWidth:this.resColWidth)-2,e-=1,this.isOverflows=!(e*this.gridSettings.columnWidth<a);var r=e*this.gridSettings.columnWidth<a?a/e:this.gridSettings.columnWidth;return this.isOverflows||this.gridSettings.allowAutoResizing?Math.floor(r):this.gridSettings.columnWidth},e.prototype.resizeColWidth=function(e){t.isNullOrUndefined(this.parent.resizedValue)||(this.parent.resizedValue=this.parent.showGroupingBar&&this.parent.resizedValue<250?250:this.parent.resizedValue),this.resColWidth=t.isNullOrUndefined(this.parent.resizedValue)?this.resColWidth:this.parent.resizedValue;var i=isNaN(this.parent.width)?this.parent.width.toString().indexOf("%")>-1?parseFloat(this.parent.width.toString())/100*this.parent.element.offsetWidth:this.parent.element.offsetWidth:Number(this.parent.width);e-=1,i=i-(this.gridSettings.columnWidth>this.resColWidth?this.gridSettings.columnWidth:this.resColWidth)-2,this.isOverflows=!(e*this.gridSettings.columnWidth<i);var a=e*this.gridSettings.columnWidth<i?i/e:this.gridSettings.columnWidth;return this.isOverflows||this.gridSettings.allowAutoResizing?Math.floor(a):this.gridSettings.columnWidth},e.prototype.calculateGridWidth=function(){var e=this.parent.width,t=this.parent.element.getBoundingClientRect().width?this.parent.element.getBoundingClientRect().width:this.parent.element.offsetWidth;return"auto"===this.gridSettings.width?"auto"===this.parent.width?e=t:this.parent.width.toString().indexOf("%")>-1&&(e=parseFloat(this.parent.width.toString())/100*t):e=this.gridSettings.width,!this.gridSettings.allowAutoResizing&&e>this.parent.totColWidth?this.parent.totColWidth:e},e.prototype.calculateGridHeight=function(e){var t=this.parent.height,i=this.parent.getHeightAsNumber();if(isNaN(i)&&(i=i>this.parent.minHeight?i:this.parent.minHeight),"Chart"!==this.parent.currentView)if("auto"===this.gridSettings.height&&i&&this.parent.element.querySelector("."+Fa)){if(t=i-(this.parent.element.querySelector("."+Fa).offsetHeight+(this.parent.element.querySelector("."+Qa)?this.parent.element.querySelector("."+Qa).offsetHeight:0)+(this.parent.element.querySelector("."+ja)?42:0))-1,t=t<40?40:t,e){var a=this.parent.element.querySelector("."+xa+" ."+ji).offsetHeight,r=this.parent.element.querySelector("."+ba).offsetHeight,n=this.parent.element.querySelector("."+ba+" ."+ji).offsetWidth,o=this.parent.element.querySelector("."+ba).offsetWidth<n;t>=a&&(!o||t>=r)&&!!!(o&&t-a<18)?this.parent.grid.height="auto":(this.parent.grid.height=t,this.parent.grid.dataBind()),this.parent.grid.widthService.refreshFrozenScrollbar()}else t>this.engine.valueContent.length*this.gridSettings.rowHeight&&(t="auto")}else t=this.gridSettings.height;return t<this.parent.gridSettings.rowHeight?this.parent.gridSettings.rowHeight:t},e.prototype.frameStackedHeaders=function(){var e=1!==this.parent.dataSourceSettings.values.length||this.parent.dataSourceSettings.alwaysShowValueHeader?void 0:this.formatList[this.parent.dataSourceSettings.values[0].name],i=[];if(("olap"===this.parent.dataType||this.parent.dataSourceSettings.values.length>0)&&!this.engine.isEmptyData){var a=this.engine.headerContent.length,r=[],n=[],o=this.calculateColWidth(this.engine.pivotValues?this.engine.pivotValues[0].length:0);do{var s=[],l=0;a--;var d=this.engine.headerContent[a];if(d)for(var h=0;h<Object.keys(d).length+(d[0]?0:1);h++){var p=d[h]&&d[h].colSpan?3!==d[h].memberType||0===a?d[h].colSpan:r[h]:1;p="olap"===this.parent.dataType?1:p;var u=d[h]?"grand sum"===d[h].type?t.isNullOrUndefined(d[h].valueSort.axis)?this.parent.localeObj.getConstant("grandTotal"):d[h].formattedText:"sum"===d[h].type?d[h].formattedText.split("Total")[0]+this.parent.localeObj.getConstant("total"):d[h].formattedText:"";if(a===this.engine.headerContent.length-1)p=1,s[l]={field:h+".formattedText",headerText:u,customAttributes:{cell:d[h]},width:d[h]?this.setSavedWidth(d[h].valueSort.levelName,o):this.resColWidth,minWidth:30,format:0===h?"":t.isNullOrUndefined(e)?this.formatList[d[h].actualText]:e,allowReordering:!this.parent.showGroupingBar&&this.parent.gridSettings.allowReordering,allowResizing:this.parent.gridSettings.allowResizing,visible:!0};else if(r[h]){for(var c=p=d[h]&&"grand sum"===d[h].type&&2===d[h].memberType?1:p,g=[],m=h;c>0;){if(s[l]){if(!i[n[m]])break;g.push(i[n[m]])}else s[l]={headerText:u,field:d[h]?d[h].valueSort.levelName:"",customAttributes:{cell:d[h]},width:d[h]?this.setSavedWidth(d[h].valueSort.levelName,o):this.resColWidth,minWidth:30,allowReordering:!this.parent.showGroupingBar&&this.parent.gridSettings.allowReordering,allowResizing:this.parent.gridSettings.allowResizing,visible:!0},g=[i[n[m]]];c-=r[m],m+=r[m]}s[l].columns=g}s[l]&&(s[l].clipMode=this.gridSettings.clipMode),r[h]=p,n[h]=l,l++,h=h+p-1}i=s.length>0?s:i}while(a>0);i[0]={field:"0.formattedText",width:this.resColWidth,minWidth:30,headerText:"",allowReordering:!1,allowResizing:this.parent.gridSettings.allowResizing,visible:!0}}else i=this.frameEmptyColumns();if(i.length>1){var f=i[i.length-1];f.minWidth=f.width,f.width="auto",f.columns&&f.columns.length>0&&this.configLastColumnWidth(f.columns[f.columns.length-1])}return this.parent.triggerColumnRenderEvent(i),i},e.prototype.configLastColumnWidth=function(e){e.minWidth=e.width,e.width="auto",e.columns&&e.columns.length>0&&this.configLastColumnWidth(e.columns[e.columns.length-1])},e.prototype.setSavedWidth=function(e,i){return i="0.formattedText"!==e||t.isNullOrUndefined(this.parent.resizedValue)?this.parent.resizeInfo[e]?this.parent.resizeInfo[e]:i:this.parent.resizedValue},e.prototype.frameEmptyColumns=function(){var e=[],t=this.calculateColWidth(2);return e.push({field:"0.formattedText",headerText:"",minWidth:30,width:this.resColWidth}),e.push({field:"1.formattedText",headerText:this.parent.localeObj.getConstant("grandTotal"),minWidth:30,width:t}),e},e.prototype.getFormatList=function(){for(var e={},t=0;t<this.parent.dataSourceSettings.values.length;t++){var i=this.parent.dataSourceSettings.values[t],a="N";if("olap"===this.parent.dataType){if(this.parent.olapEngineModule.fieldList[i.name]){var r=this.parent.olapEngineModule.fieldList[i.name].formatString;a=r.indexOf("#")>-1?r:r[0]+"2"}}else if(this.parent.dataSourceSettings.formatSettings.length>0)for(var n=0;n<this.parent.dataSourceSettings.formatSettings.length;n++){var o=this.parent.dataSourceSettings.formatSettings[n];if(i.name===o.name){a=o.format;break}}e[i.name]=a}return e},e.prototype.getValidHeader=function(e,i){var a=this.parent.dataSourceSettings.values;if("row"===i){var r=e;if(0===this.parent.dataSourceSettings.rows.length||0===this.parent.dataSourceSettings.columns.length){if(0===this.parent.dataSourceSettings.rows.length&&"row"===this.parent.dataSourceSettings.valueAxis&&this.parent.localeObj.getConstant("grandTotal")+this.parent.dataSourceSettings.valueSortSettings.headerDelimiter+r.value===r.data[0].valueSort.levelName)return this.parent.localeObj.getConstant("total")+" "+this.parent.localeObj.getConstant(this.parent.engineModule.fieldList[r.value.toString()].aggregateType)+" "+this.parent.localeObj.getConstant("of")+" "+r.value.toString();if(1===a.length&&0===this.parent.dataSourceSettings.rows.length)return this.parent.localeObj.getConstant("total")+" "+this.parent.localeObj.getConstant(a[a.length-1].type)+" "+this.parent.localeObj.getConstant("of")+" "+(t.isNullOrUndefined(a[a.length-1].caption)?a[a.length-1].name:a[a.length-1].caption)}return r.value}if("column"===i){r=e;return 0!==this.parent.dataSourceSettings.rows.length&&0!==this.parent.dataSourceSettings.columns.length||t.isNullOrUndefined(e.gridCell.column.customAttributes)||0!==this.parent.dataSourceSettings.columns.length||"column"!==this.parent.dataSourceSettings.valueAxis||this.parent.localeObj.getConstant("grandTotal")+this.parent.dataSourceSettings.valueSortSettings.headerDelimiter+r.gridCell.column.customAttributes.cell.formattedText!==r.gridCell.column.customAttributes.cell.valueSort.levelName?r.cell.value:this.parent.localeObj.getConstant("total")+" "+this.parent.localeObj.getConstant(this.parent.engineModule.fieldList[r.gridCell.column.customAttributes.cell.actualText].aggregateType)+" "+this.parent.localeObj.getConstant("of")+" "+r.gridCell.column.customAttributes.cell.formattedText}},e.prototype.excelColumnEvent=function(e){0===this.parent.dataSourceSettings.columns.length&&"column"===this.parent.dataSourceSettings.valueAxis&&(e.cell.value=this.getValidHeader(e,"column")),void 0!==e.gridCell&&"auto"===e.gridCell.column.width&&(this.parent.lastColumn=e.gridCell.column,e.gridCell.column.width=e.gridCell.column.minWidth),e=this.exportHeaderEvent(e),this.parent.trigger(C,e)},e.prototype.pdfColumnEvent=function(e){0===this.parent.dataSourceSettings.columns.length&&"column"===this.parent.dataSourceSettings.valueAxis&&(e.cell.value=this.getValidHeader(e,"column")),void 0!==e.gridCell&&"auto"===e.gridCell.column.width&&(this.parent.lastColumn=e.gridCell.column,e.gridCell.column.width=e.gridCell.column.minWidth),this.parent.trigger(x,e)},e.prototype.excelRowEvent=function(e){if("0.formattedText"===e.column.field){var i=e.data[0],a=i.type&&"value"===i.type,r=0;if("olap"===this.parent.dataType)r=this.indentCollection[i.rowIndex];else{var n=i.valueSort?i.valueSort.levelName.toString():"",o=i.actualText?i.actualText.toString().split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter).length:0,s=n.split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter).length-(o?o-1:o);r=s?s-1:0}this.colPos=0,e.style={hAlign:"Left",indent:2*r},this.lastSpan=a?this.lastSpan:r}else this.colPos++,t.isNullOrUndefined(e.data[this.colPos].value)||t.isNullOrUndefined(e.data[this.colPos].formattedText)||""===e.data[this.colPos].formattedText?e.value="Excel"===this.parent.exportType?null:"":e.value=t.isNullOrUndefined(e.data[this.colPos].value)?e.data[this.colPos].formattedText:e.data[this.colPos].value;e=this.exportContentEvent(e),0===this.parent.dataSourceSettings.rows.length&&"row"===this.parent.dataSourceSettings.valueAxis&&(e.value="0.formattedText"===e.column.field?this.getValidHeader(e,"row"):e.value),this.parent.trigger(w,e)},e.prototype.pdfRowEvent=function(e){if("0.formattedText"===(e=this.exportContentEvent(e)).column.field){var t=0,i=e.data[0],a=i.type&&"value"===i.type;if("olap"===this.parent.dataType)t=this.indentCollection[i.rowIndex];else{var r=i.valueSort?i.valueSort.levelName.toString():"",n=i.actualText?i.actualText.toString().split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter).length:0,o=r.split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter).length-(n?n-1:n);t=o?o-1:0}e.style={paragraphIndent:10*t},this.lastSpan=a?this.lastSpan:t,0===this.parent.dataSourceSettings.rows.length&&"row"===this.parent.dataSourceSettings.valueAxis&&(e.value=this.getValidHeader(e,"row"))}this.parent.trigger(T,e)},e.prototype.excelDataBound=function(e){for(var t=e.excelRows,i=Object.keys(this.engine.headerContent).length,a=0;a<i;a++){for(var r=t[a].cells,n=[],o=0;o<r.length;o++)-1!==r[o].rowSpan&&n.push(r[o]);t[a].cells=n}},e.prototype.exportHeaderEvent=function(e){var i=1;if(e.gridCell.column.customAttributes){var a=e.gridCell.column.customAttributes.cell;this.actualText!==a.actualText&&a.colSpan>1&&a.level>-1&&(e.gridCell.colSpan=e.cell.colSpan=a.colSpan>-1?a.colSpan:1),i=a.rowSpan>-1?a.rowSpan:1,"excelHeaderQueryCellInfo"===e.name&&(a.rowSpan>-1?i=a.rowSpan:t.isNullOrUndefined(a.type)||0===a.level||(i=-1,e.cell.rowSpan=-1)),this.actualText=a.actualText}else i=Object.keys(this.engine.headerContent).length;return e.cell.rowSpan!==i&&i>-1&&(e.cell.rowSpan=i),e},e.prototype.exportContentEvent=function(e){var i=e.data[Number(e.column.field.split(".formattedText")[0])];return e.value="grand sum"===i.type?t.isNullOrUndefined(i.valueSort.axis)?this.parent.localeObj.getConstant("grandTotal"):i.formattedText:e.value,e},e.prototype.unWireEvents=function(e){e.querySelector(".e-hyperlinkcell")&&t.EventHandler.remove(e.querySelector(".e-hyperlinkcell"),this.parent.isAdaptive?"touchend":"click",this.onHyperCellClick)},e.prototype.wireEvents=function(e){e.querySelector(".e-hyperlinkcell")&&t.EventHandler.add(e.querySelector(".e-hyperlinkcell"),this.parent.isAdaptive?"touchend":"click",this.onHyperCellClick,this)},e}(),er=function(){function e(e){this.keyConfigs={shiftF:"shift+F",shiftS:"shift+S",shiftE:"shift+E",delete:"delete",enter:"enter",escape:"escape",upArrow:"upArrow",downArrow:"downArrow",altJ:"alt+J"},this.parent=e,this.parent.element.tabIndex=-1===this.parent.element.tabIndex?0:this.parent.element.tabIndex,this.keyboardModule=new t.KeyboardEvents(this.parent.element,{keyAction:this.keyActionHandler.bind(this),keyConfigs:this.keyConfigs,eventName:"keydown"})}return e.prototype.keyActionHandler=function(e){switch(e.action){case"shiftF":this.processFilter(e);break;case"shiftS":this.processSort(e);break;case"shiftE":this.processEdit(e);break;case"delete":this.processDelete(e);break;case"enter":this.processEnter(e);break;case"escape":this.processClose(e);break;case"upArrow":case"downArrow":this.processFilterNodeSelection(e);break;case"altJ":this.processComponentFocus(e)}},e.prototype.processComponentFocus=function(e){if(this.parent.element)return this.parent.element.focus(),e.stopPropagation(),void e.preventDefault()},e.prototype.getButtonElement=function(e){for(var t=[].slice.call(this.parent.element.querySelectorAll("."+_t)),i=0,a=t.length;i<a;i++)if(t[i].getAttribute("data-uid")===e.getAttribute("data-uid"))return t[i];return e},e.prototype.processEnter=function(e){var i=e.target;if(i&&t.closest(i,"."+_t))return i.querySelector("."+Pt)&&t.closest(i,"."+di)?i.querySelector("."+Pt).click():i.querySelector(".e-edit")?i.querySelector(".e-edit").click():!i.querySelector(".e-sort")||t.closest(i,"."+di)||t.closest(i,"."+oa)?i.querySelector("."+Wt)&&!t.closest(i,"."+di)&&i.querySelector("."+Wt).click():(i.querySelector(".e-sort").click(),this.getButtonElement(i).focus()),void e.preventDefault()},e.prototype.processSort=function(e){var i=e.target;if(i&&t.closest(i,"."+_t)&&i.querySelector(".e-sort")&&!t.closest(i,"."+di)&&!t.closest(i,"."+oa))return i.querySelector(".e-sort").click(),this.getButtonElement(i).focus(),void e.preventDefault()},e.prototype.processEdit=function(e){var i=e.target;if(i&&t.closest(i,"."+_t)&&i.querySelector(".e-edit"))return i.querySelector(".e-edit").click(),void e.preventDefault()},e.prototype.processFilter=function(e){var i=e.target;if(i&&t.closest(i,"."+_t)&&i.querySelector("."+Wt)&&!t.closest(i,"."+di)){if(i.querySelector("."+Wt).click(),this.parent&&this.parent.control&&"pivotview"===this.parent.moduleName&&this.parent.control.grid&&this.parent.control.showGroupingBar&&this.parent.control.groupingBarModule&&t.closest(i,"."+ci)&&this.parent.filterDialog&&this.parent.filterDialog.dialogPopUp&&!this.parent.filterDialog.dialogPopUp.isDestroyed&&this.parent.filterDialog.dialogPopUp.element){var a=this.parent.filterDialog.dialogPopUp.element,r=this.parent.filterDialog.allowExcelLikeFilter;clearTimeout(this.timeOutObj),this.timeOutObj=setTimeout(function(){a&&a.classList.contains("e-popup-open")&&(r&&a.querySelector(".e-dlg-closeicon-btn")?a.querySelector(".e-dlg-closeicon-btn").focus():a.querySelector("input")&&a.querySelector("input").focus())})}e.preventDefault()}else;},e.prototype.processFilterNodeSelection=function(e){var i=e.target;if(i&&t.closest(i,"."+Wi)&&40===e.keyCode){if((r=t.closest(i,"."+Zt).querySelector("."+$t))&&r.querySelector("li")){var a=r.querySelector("li");return r.querySelector("li#_active")&&(t.removeClass([r.querySelector("li#_active")],["e-hover","e-node-focus"]),r.querySelector("li#_active").removeAttribute("id")),a.setAttribute("id","_active"),t.addClass([a],["e-hover","e-node-focus"]),r.focus(),void e.preventDefault()}}else if(i&&t.closest(i,"."+$t)&&38===e.keyCode){var r;if((r=t.closest(i,"."+$t)).querySelector("li#_active.e-hover.e-node-focus")&&r.querySelector("li")&&r.querySelector("li").classList.contains("e-prev-active-node")&&r.querySelector("li")===r.querySelector("li#_active.e-hover.e-node-focus")){t.removeClass(r.querySelectorAll("li.e-prev-active-node"),"e-prev-active-node");var n=t.closest(i,"."+Zt).querySelector("."+Wi);if(n&&n.querySelector("li")){return(a=n.querySelector("li")).setAttribute("id","_active"),t.addClass([a],["e-hover","e-node-focus"]),n.focus(),void e.preventDefault()}}}else i&&i.id===this.parent.parentID+"_inputbox"&&("upArrow"===e.action?i.parentElement.querySelector(".e-spin-up").click():"downArrow"===e.action&&i.parentElement.querySelector(".e-spin-down").click())},e.prototype.processDelete=function(e){var i=e.target;if(i&&t.closest(i,"."+_t)&&i.querySelector("."+Yt))return i.querySelector("."+Yt).click(),void e.preventDefault()},e.prototype.processClose=function(e){var i=e.target;if(i&&t.closest(i,".e-popup.e-popup-open")){var a=t.closest(i,".e-popup.e-popup-open").ej2_instances[0];if(a&&!a.closeOnEscape){var r=a.element.getAttribute("data-fieldName");if(a.hide(),this.parent.element)for(var n=0,o=[].slice.call(this.parent.element.querySelectorAll(".e-pivot-button"));n<o.length;n++){var s=o[n];if(s.getAttribute("data-uid")===r){s.focus();break}}return void e.preventDefault()}}},e.prototype.destroy=function(){this.keyboardModule&&this.keyboardModule.destroy()},e}(),tr=function(){function e(e){this.parent=e}return e.prototype.updateSorting=function(e){if(!e.target.classList.contains(Wt)&&!e.target.classList.contains(Yt)){this.parent.filterDialog.dialogPopUp&&this.parent.filterDialog.dialogPopUp.close();var i=e.target,a=void 0,r=void 0,n=void 0;i.id?(a=i.id,r=[].slice.call(i.querySelectorAll("."+Gt))):(a=i.parentElement.id,r=[].slice.call(i.parentElement.querySelectorAll("."+Gt))),n=0!==r.length;var o=g.getFieldByName(a,this.parent.dataSourceSettings.sortSettings);if(t.isNullOrUndefined(o)){l={name:a,order:n?"Ascending":"Descending"};this.parent.dataSourceSettings.sortSettings.push(l)}else{for(var s=0;s<this.parent.dataSourceSettings.sortSettings.length;s++)if(this.parent.dataSourceSettings.sortSettings[s].name===a){this.parent.dataSourceSettings.sortSettings.splice(s,1);break}var l={name:a,order:n?"Ascending":"Descending"};this.parent.dataSourceSettings.sortSettings.push(l)}this.parent.control.lastSortInfo=this.parent.dataSourceSettings.sortSettings[this.parent.dataSourceSettings.sortSettings.length-1],n?t.removeClass([i],Gt):t.addClass([i],Gt)}},e.prototype.updateFiltering=function(e){var i=e.target,a=i.parentElement.id,r=i.parentElement.textContent,n=!1,o=[],s=[];if(this.parent.dataSourceSettings.allowMemberFilter)if("olap"===this.parent.dataType)s=this.getOlapData(a,n);else{var l=g.getClonedData(this.parent.engineModule.fieldList[a].dateMember);l="Ascending"===this.parent.engineModule.fieldList[a].sort?l.sort(function(e,t){return e.actualText>t.actualText?1:t.actualText>e.actualText?-1:0}):"Descending"===this.parent.engineModule.fieldList[a].sort?l.sort(function(e,t){return e.actualText<t.actualText?1:t.actualText<e.actualText?-1:0}):l;var d=g.getFilterItemByName(a,this.parent.dataSourceSettings.filterSettings);t.isNullOrUndefined(d)||(n=!(!this.isValidFilterItemsAvail(a,d)||"Include"!==d.type),o=d.items?d.items:[]),s=this.getTreeData(n,l,o,a)}this.parent.filterDialog.dialogPopUp&&this.parent.filterDialog.dialogPopUp.close();var h=this.parent.control.filterTargetID;t.isNullOrUndefined(h)&&(h="pivotfieldlist"!==this.parent.moduleName?this.parent.element:document.getElementById(this.parent.parentID+"_Wrapper")),this.parent.filterDialog.createFilterDialog(s,a,r,h)},e.prototype.isValidFilterItemsAvail=function(e,t){var i=!1;if(t&&["Include","Exclude"].indexOf(t.type)>=0)for(var a=this.parent.engineModule,r=a.fieldList[e],n=a.formatFields[e]&&["date","dateTime","time"].indexOf(a.formatFields[e].type)>-1?r.formattedMembers:r.members,o=0,s=t.items;o<s.length;o++){if(n[s[o]]){i=!0;break}}return i},e.prototype.getOlapData=function(e,i){var a=[],r=[];this.parent.filterDialog.isSearchEnabled=!1;var n=this.parent.engineModule,o=g.getFilterItemByName(e,this.parent.dataSourceSettings.filterSettings);0===n.fieldList[e].filterMembers.length?this.parent.control.loadOnDemandInMemberEditor?o&&o.levelCount>1&&n.fieldList[e].levels.length>1?n.getFilterMembers(this.parent.dataSourceSettings,e,o.levelCount):(n.fieldList[e].levelCount=1,n.getMembers(this.parent.dataSourceSettings,e)):n.getMembers(this.parent.dataSourceSettings,e,!0):(n.fieldList[e].currrentMembers={},n.fieldList[e].searchMembers=[]);var s=n.fieldList[e].isHierarchy;a=n.fieldList[e].filterMembers,t.isNullOrUndefined(o)||(i=!o.type||"Include"===o.type,r=o.items?o.items:[]);for(var l={},d={},h=n.fieldList[e].members,p=0,u=r;p<u.length;p++){var c=u[p];l[c]=c,d[c]=c,h[c]&&(d=this.getParentNode(e,c,d))}return a=this.getFilteredTreeNodes(e,a,d,[],s),a=this.getOlapTreeData(i,g.getClonedData(a),l,e,s),a=this.sortOlapFilterData(a,n.fieldList[e].sort)},e.prototype.sortOlapFilterData=function(e,t){return e.length>0&&(e="Ascending"===t?e.sort(function(e,t){return e.caption>t.caption?1:t.caption>e.caption?-1:0}):"Descending"===t?e.sort(function(e,t){return e.caption<t.caption?1:t.caption<e.caption?-1:0}):e),e},e.prototype.getParentIDs=function(e,t,i){for(var a,r=0,n=e.fields.dataSource;r<n.length;r++){var o=n[r];if(o.id===t){a=o.pid;break}}return a&&(i.push(a),this.getParentIDs(e,a,i)),i},e.prototype.getChildIDs=function(e,t,i){for(var a,r=0,n=e.fields.dataSource;r<n.length;r++){var o=n[r];if(o.pid===t){a=o.id;break}}return a&&(i.push(a),this.getParentIDs(e,a,i)),i},e.prototype.searchTreeNodes=function(e,i,a,r){if(a){for(var n=[],o=[],s=0,l=[].slice.call(i.element.querySelectorAll("li"));s<l.length;s++){var d=l[s];d.querySelector(".e-list-text").textContent.toLowerCase().indexOf(e.value.toLowerCase())>-1?n.push(d):o.push(d)}if(i.enableNodes(n),t.removeClass(n,Nt),i.disableNodes(o),t.addClass(o,Nt),n.length>0&&o.length>0)for(var h=0,p=n;h<p.length;h++){var u=p[h].getAttribute("data-uid"),c=this.getParentIDs(i,u,[]),m=this.getChildIDs(i,u,[]),f=[];if(c.length>0)for(var v=0,S=o;v<S.length;v++){var y=S[v];-1!==g.inArray(y.getAttribute("data-uid"),c)&&f.push(y)}if(m.length>0)for(var b=0,C=o;b<C.length;b++){y=C[b];-1!==g.inArray(y.getAttribute("data-uid"),m)&&f.push(y)}i.enableNodes(f),t.removeClass(f,Nt)}0===[].slice.call(i.element.querySelectorAll("li."+Nt)).length?i.collapseAll():i.expandAll(void 0,void 0,!0)}else if(this.parent.searchTreeItems=[],"olap"!==this.parent.dataType||r){n=[];var x=0;x=1;for(var w=0,T=this.parent.currentTreeItems;w<T.length;w++){var M=T[w];M.name.toLowerCase().indexOf(e.value.toLowerCase())>-1&&(this.parent.searchTreeItems.push(M),x<=this.parent.control.maxNodeLimitInMemberEditor&&n.push(M),x++)}--x>this.parent.control.maxNodeLimitInMemberEditor?(this.parent.editorLabelElement.innerText=x-this.parent.control.maxNodeLimitInMemberEditor+this.parent.control.localeObj.getConstant("editorDataLimitMsg"),this.parent.filterDialog.dialogPopUp.height=this.parent.filterDialog.allowExcelLikeFilter?"440px":"400px",this.parent.isDataOverflow=!0):(this.parent.editorLabelElement.innerText="",this.parent.filterDialog.dialogPopUp.height=this.parent.filterDialog.allowExcelLikeFilter?"400px":"350px",this.parent.isDataOverflow=!1),this.parent.isDataOverflow=x>this.parent.control.maxNodeLimitInMemberEditor,this.parent.editorLabelElement.parentElement.style.display=this.parent.isDataOverflow?"block":"none",i.fields={dataSource:n,id:"id",text:"name",isChecked:"isSelected",parentID:"pid"},i.dataBind()}else this.updateOlapSearchTree(e,i,r)},e.prototype.updateOlapSearchTree=function(e,t,i){var a=[],r=this.parent.filterDialog.dialogPopUp.element.getAttribute("data-fieldname");if(""===e.value.toLowerCase()){this.parent.filterDialog.isSearchEnabled=!1,this.parent.engineModule.fieldList[r].searchMembers=[];for(var n={},o={},s=this.parent.engineModule.fieldList[r].members,l=[],d=0,h=Object.keys(s);d<h.length;d++){s[c=h[d]].isSelected&&(s[c].parent&&s[s[c].parent].isSelected||l.push(c))}for(var p=0,u=l;p<u.length;p++){var c;n[c=u[p]]=c,o[c]=c,s[c]&&(o=this.getParentNode(r,c,o))}var m=this.parent.engineModule.fieldList[r].filterMembers;a=this.getFilteredTreeNodes(r,m,o,[],i),a=this.getOlapTreeData(!0,g.getClonedData(a),n,r,i,!0)}else{this.parent.filterDialog.isSearchEnabled=!0;m=this.parent.engineModule.fieldList[r].searchMembers;a=g.getClonedData(m),a=this.getOlapSearchTreeData(!0,a,r)}t.fields={dataSource:a,id:"id",text:"name",isChecked:"isSelected",parentID:"pid"},t.dataBind()},e.prototype.getTreeData=function(e,t,i,a){this.parent.currentTreeItems=[],this.parent.searchTreeItems=[],this.parent.currentTreeItemsPos={},this.parent.savedTreeFilterPos={};var r=this.parent.engineModule;this.parent.isDateField=r.formatFields[a]&&["date","dateTime","time"].indexOf(r.formatFields[a].type)>-1;for(var n=[],o=1,s={},l=0,d=i;l<d.length;l++){var h=d[l];s[h]=h}for(var p=a.replace(/[^a-zA-Z0-9 ]/g,"_"),u=0,c=t;u<c.length;u++){var g=c[u],m=this.parent.isDateField?g.formattedText:g.actualText.toString(),f={id:p+"_"+o,htmlAttributes:{"data-fieldName":a,"data-memberId":g.actualText.toString()},actualText:g.actualText,name:m,isSelected:!e};void 0!==s[m]&&(f.isSelected=!!e),o<=this.parent.control.maxNodeLimitInMemberEditor&&n.push(f),f.isSelected||(this.parent.savedTreeFilterPos[o-1]=m),this.parent.currentTreeItems.push(f),this.parent.searchTreeItems.push(f),this.parent.currentTreeItemsPos[g.actualText]={index:o-1,isSelected:f.isSelected},o++}return this.parent.isDataOverflow=o-1>this.parent.control.maxNodeLimitInMemberEditor,n},e.prototype.getOlapTreeData=function(e,t,i,a,r,n){var o=this.parent.engineModule.fieldList[a];this.parent.currentTreeItems=[],this.parent.searchTreeItems=[],this.parent.currentTreeItemsPos={};for(var s=[],l=1,d=0,h=t;d<h.length;d++){var p=h[d],u=p,c=p.id.toString();n||(u.isSelected=!e),void 0!==i[c]&&(u.isSelected=!!e),!n&&p.hasChildren&&this.updateChildNodeStates(o.filterMembers,a,p.id,u.isSelected),o.members[c].isSelected=u.isSelected,o.currrentMembers&&o.currrentMembers[c]&&(o.currrentMembers[c].isSelected=u.isSelected),l<=this.parent.control.maxNodeLimitInMemberEditor&&r&&s.push(u),this.parent.currentTreeItems.push(u),this.parent.searchTreeItems.push(u),this.parent.currentTreeItemsPos[c]={index:l-1,isSelected:u.isSelected},l++}return this.parent.isDataOverflow=!!r&&l-1>this.parent.control.maxNodeLimitInMemberEditor,r?s:t},e.prototype.getOlapSearchTreeData=function(e,t,i){for(var a=this.parent.engineModule.fieldList[i].members,r=0,n=t;r<n.length;r++){var o=n[r],s=o.id.toString();a[s]&&(o.isSelected=a[s].isSelected),this.parent.searchTreeItems.push(o)}return t},e.prototype.updateChildNodeStates=function(e,t,i,a){for(var r=this.parent.engineModule.fieldList[t].members,n=this.parent.engineModule.fieldList[t].currrentMembers,o=0,s=e;o<s.length;o++){var l=s[o];l.pid&&l.pid.toString()===i&&(r[l.id].isSelected=a,n&&n[l.id]&&(n[l.id].isSelected=a),l.hasChildren&&this.updateChildNodeStates(e,t,l.id,a))}},e.prototype.getParentNode=function(e,t,i){var a=this.parent.engineModule.fieldList[e].members;if(a[t].parent&&t!==a[t].parent){var r=a[t].parent;i[r]=r,this.getParentNode(e,r,i)}return i},e.prototype.getFilteredTreeNodes=function(e,i,a,r,n){for(var o=[],s=this.parent.engineModule.fieldList[e].members,l=0,d=a?Object.keys(a):[];l<d.length;l++){var h=s[d[l]].parent;void 0!==h&&-1===g.inArray(h,o)&&o.push(h)}for(var p=0,u=i;p<u.length;p++){var c=u[p];t.isNullOrUndefined(c.pid)||-1!==g.inArray(c.pid,o)?(r.push(c),t.isNullOrUndefined(c.pid)&&-1!==g.inArray(c.id,o)?s[c.id].isNodeExpand=!0:t.isNullOrUndefined(c.pid)||-1===g.inArray(c.pid,o)?s[c.id].isNodeExpand=!1:(s[c.id].isNodeExpand=!1,s[c.pid].isNodeExpand=!0)):s[c.id].isNodeExpand=!1}return r},e}(),ir=function(){function e(e){this.parent=e}return e.prototype.onStateModified=function(e,i){var a="",r=t.closest(e.target,"."+oi),n=-1;if(this.parent.dataSourceUpdate.btnElement=e.element?e.element.parentElement:void 0,r&&(a=r.classList[1]===si?"rows":r.classList[1]===li?"columns":r.classList[1]===di?"values":r.classList[1]===hi?"filters":""),"olap"===this.parent.dataType||"pivot"===this.parent.dataType){var o="olap"===this.parent.dataType&&this.parent.engineModule.fieldList[i]&&this.parent.engineModule.fieldList[i].isCalculatedField?this.parent.engineModule.fieldList[i].tag:i;if(e.cancel&&""===a)return!1;if(this.parent.dataSourceUpdate.btnElement&&"true"===this.parent.dataSourceUpdate.btnElement.getAttribute("isValue")&&("filters"===a||"values"===a)||this.parent.dataSourceUpdate.btnElement&&"false"===this.parent.dataSourceUpdate.btnElement.getAttribute("isValue")&&o.toLowerCase().indexOf("[measures].")>-1&&"olap"===this.parent.dataType&&("filters"===a||"rows"===a||"columns"===a)||this.parent.dataSourceUpdate.btnElement&&"false"===this.parent.dataSourceUpdate.btnElement.getAttribute("isValue")&&"olap"===this.parent.dataType&&-1===o.toLowerCase().indexOf("[measures].")&&this.parent.engineModule.fieldList[i]&&this.parent.engineModule.fieldList[i].isNamedSets&&("filters"===a||"values"===a)||this.parent.dataSourceUpdate.btnElement&&"false"===this.parent.dataSourceUpdate.btnElement.getAttribute("isValue")&&"olap"===this.parent.dataType&&-1===o.toLowerCase().indexOf("[measures].")&&"values"===a){var s=this.parent.localeObj.getConstant("warning"),l=this.parent.localeObj.getConstant("fieldDropErrorAction");return this.parent.errorDialog.createErrorDialog(s,l),!1}}else if(e.cancel&&""===a||this.parent.dataSourceUpdate.btnElement&&"true"===this.parent.dataSourceUpdate.btnElement.getAttribute("isValue")&&("filters"===a||"values"===a||a.indexOf(this.parent.dataSourceSettings.valueAxis)>-1))return!1;if(""!==a){if("olap"===this.parent.dataType||"pivot"===this.parent.dataType){if((o="olap"===this.parent.dataType&&this.parent.engineModule.fieldList[i]&&this.parent.engineModule.fieldList[i].isCalculatedField?this.parent.engineModule.fieldList[i].tag:i).toLowerCase().indexOf("[measures].")>-1&&"olap"===this.parent.dataType&&("filters"===a||"rows"===a||"columns"===a)||this.parent.engineModule.fieldList[i]&&this.parent.engineModule.fieldList[i].isNamedSets&&"filters"===a||"olap"===this.parent.dataType&&"values"===a&&-1===o.toLowerCase().indexOf("[measures].")){s=this.parent.localeObj.getConstant("warning"),l=this.parent.localeObj.getConstant("fieldDropErrorAction");return this.parent.errorDialog.createErrorDialog(s,l),!1}}if("pivot"===this.parent.dataType&&this.parent.engineModule.fieldList[i]&&"CalculatedField"===this.parent.engineModule.fieldList[i].aggregateType&&"values"!==a){s=this.parent.localeObj.getConstant("warning"),l=this.parent.localeObj.getConstant("dropAction");return this.parent.errorDialog.createErrorDialog(s,l),!1}n=this.getButtonPosition(e.target,a)}else this.parent.engineModule.fieldList[i]&&(this.parent.engineModule.fieldList[i].isSelected=!1,"olap"===this.parent.dataType&&this.parent.engineModule.updateFieldlistData(i));return this.parent.dataSourceUpdate.updateDataSource(i,a,n)},e.prototype.getButtonPosition=function(e,i){var a=-1,r=t.closest(e,"."+Bt);if(!t.isNullOrUndefined(r)){r=r.querySelector("."+_t);for(var n=this.parent.element.querySelector(".e-"+i),o=[].slice.call(n.querySelectorAll("."+_t)),s=0,l=o.length;s<l;s++)if(o[s].id===r.id){a=s;break}}return a},e}(),ar=function(){function e(e){this.parent=e}return e.prototype.updateDataSource=function(e,i,a){for(var r,n,o=this,s=-1,l=!0,d=[this.parent.dataSourceSettings.rows,this.parent.dataSourceSettings.columns,this.parent.dataSourceSettings.values,this.parent.dataSourceSettings.filters],h=0,p=d.length;h<p;h++)if(d[h])for(var u=0,c=d[h].length;u<c;u++)(d[h][u].name===e||"olap"===this.parent.dataType&&"[measures]"===d[h][u].name.toLowerCase()&&d[h][u].name.toLowerCase()===e)&&(n=0===h?"rows":1===h?"columns":2===h?"values":"filters",s=u),n||(n="fieldList");var m={fieldName:e,dropField:g.getFieldInfo(e,this.control).fieldItem,dataSourceSettings:g.getClonedDataSourceSettings(this.parent.dataSourceSettings),dropAxis:i,dropPosition:a,draggedAxis:n,cancel:!1},f="pivotfieldlist"===this.control.getModuleName()&&this.control.isPopupView?this.control.pivotGridModule:this.control;return f.trigger(y,m,function(d){if(d.cancel)l=!1;else{if(i=d.dropAxis,a=d.dropPosition,e=d.dropField?d.dropField.name:d.fieldName,r=d.dropField,o.control&&o.btnElement&&"true"===o.btnElement.getAttribute("isvalue"))switch(i){case"":o.control.setProperties({dataSourceSettings:{values:[]}},!0);break;case"rows":a=a===o.parent.dataSourceSettings.rows.length?-1:a,o.control.setProperties({dataSourceSettings:{valueAxis:"row",valueIndex:a}},!0);break;case"columns":a=a===o.parent.dataSourceSettings.columns.length?-1:a,o.control.setProperties({dataSourceSettings:{valueAxis:"column",valueIndex:a}},!0)}else{if(o.removeFieldFromReport(e.toString()),"pivot"===o.parent.dataType&&o.control.showValuesButton&&o.parent.dataSourceSettings.values.length>1){var h="row"===o.parent.dataSourceSettings.valueAxis&&"rows"===i?o.parent.dataSourceSettings.rows:"column"===o.parent.dataSourceSettings.valueAxis&&"columns"===i?o.parent.dataSourceSettings.columns:void 0;s<o.parent.dataSourceSettings.valueIndex&&("row"===o.parent.dataSourceSettings.valueAxis&&"rows"===n||"column"===o.parent.dataSourceSettings.valueAxis&&"columns"===n)&&o.control.setProperties({dataSourceSettings:{valueIndex:o.parent.dataSourceSettings.valueIndex-1}},!0),t.isNullOrUndefined(h)||(-1===a&&-1===o.parent.dataSourceSettings.valueIndex?o.control.setProperties({dataSourceSettings:{valueIndex:h.length}},!0):a>-1&&a<=o.parent.dataSourceSettings.valueIndex?o.control.setProperties({dataSourceSettings:{valueIndex:o.parent.dataSourceSettings.valueIndex+1}},!0):o.parent.dataSourceSettings.valueIndex>-1&&a>o.parent.dataSourceSettings.valueIndex&&(a-=1))}"CalculatedField"===(r=o.getNewField(e.toString(),d.dropField)).type&&""!==i&&(i="values")}if("olap"===o.parent.dataType&&(o.removeFieldFromReport(e.toString()),r=o.getNewField(e.toString(),d.dropField),0===o.parent.dataSourceSettings.values.length&&o.removeFieldFromReport("[measures]"),"CalculatedField"===r.type&&""!==i&&(i="values")),o.control){var p={fieldName:e,droppedField:r,dataSourceSettings:g.getClonedDataSourceSettings(o.parent.dataSourceSettings),droppedAxis:i,droppedPosition:a};f.trigger("onFieldDropped",p,function(e){if(r=e.droppedField)switch(a=e.droppedPosition,i=e.droppedAxis){case"filters":-1!==a?o.parent.dataSourceSettings.filters.splice(a,0,r):o.parent.dataSourceSettings.filters.push(r);break;case"rows":-1!==a?o.parent.dataSourceSettings.rows.splice(a,0,r):o.parent.dataSourceSettings.rows.push(r);break;case"columns":-1!==a?o.parent.dataSourceSettings.columns.splice(a,0,r):o.parent.dataSourceSettings.columns.push(r);break;case"values":if(-1!==a?o.parent.dataSourceSettings.values.splice(a,0,r):o.parent.dataSourceSettings.values.push(r),"olap"===o.parent.dataType&&!o.parent.engineModule.isMeasureAvail){("row"===o.parent.dataSourceSettings.valueAxis?o.parent.dataSourceSettings.rows:o.parent.dataSourceSettings.columns).push({name:"[Measures]",caption:"Measures",showRemoveIcon:!0,allowDragAndDrop:!0})}}})}}}),l},e.prototype.removeFieldFromReport=function(e){for(var t,i=!1,a=[this.parent.dataSourceSettings.rows,this.parent.dataSourceSettings.columns,this.parent.dataSourceSettings.values,this.parent.dataSourceSettings.filters],r=this.parent.engineModule.fieldList[e],n=0,o=a.length;n<o;n++)if(!i&&a[n])for(var s=0,l=a[n].length;s<l;s++)if(a[n][s].name===e||"olap"===this.parent.dataType&&"[measures]"===a[n][s].name.toLowerCase()&&a[n][s].name.toLowerCase()===e){if(t=a[n][s].properties?a[n][s].properties:a[n][s],t.type=r&&"number"===r.type?t.type:"Count",a[n].splice(s,1),"olap"===this.parent.dataType){var d=this.parent.engineModule;d&&d.fieldList[e]&&(d.fieldList[e].currrentMembers={},d.fieldList[e].searchMembers=[])}i=!0;break}return t},e.prototype.getNewField=function(e,t){var i;if("olap"===this.parent.dataType){var a=this.parent.engineModule.fieldList[e];i={name:t?t.name:e,caption:t?t.caption:a.caption,isNamedSet:t?t.isNamedSet:a.isNamedSets,isCalculatedField:t?t.isCalculatedField:a.isCalculatedField,type:t?void 0===t.type?"number"===a.type?"Sum":"Count":t.type:void 0===a.aggregateType?"number"===a.type?"Sum":"Count":a.aggregateType,showFilterIcon:t?t.showFilterIcon:a.showFilterIcon,showSortIcon:t?t.showSortIcon:a.showSortIcon,showEditIcon:t?t.showEditIcon:a.showEditIcon,showRemoveIcon:t?t.showRemoveIcon:a.showRemoveIcon,showValueTypeIcon:t?t.showValueTypeIcon:a.showValueTypeIcon,allowDragAndDrop:t?t.allowDragAndDrop:a.allowDragAndDrop,showSubTotals:t?t.showSubTotals:a.showSubTotals}}else{a=this.parent.engineModule.fieldList[e];i={name:t?t.name:e,caption:t?t.caption:a.caption,type:t?void 0===t.type||null===t.type?"number"===a.type?"Sum":"Count":t.type:void 0===a.aggregateType||null===a.aggregateType?"number"===a.type?"Sum":"Count":a.aggregateType,showNoDataItems:t?t.showNoDataItems:a.showNoDataItems,baseField:t?t.baseField:a.baseField,baseItem:t?t.baseItem:a.baseItem,allowDragAndDrop:t?t.allowDragAndDrop:a.allowDragAndDrop,showSubTotals:t?t.showSubTotals:a.showSubTotals,showFilterIcon:t?t.showFilterIcon:a.showFilterIcon,showSortIcon:t?t.showSortIcon:a.showSortIcon,showEditIcon:t?t.showEditIcon:a.showEditIcon,showRemoveIcon:t?t.showRemoveIcon:a.showRemoveIcon,showValueTypeIcon:t?t.showValueTypeIcon:a.showValueTypeIcon}}return i},e}(),rr=function(){function e(e){this.parent=e}return e.prototype.createErrorDialog=function(e,i,r){var n=t.createElement("div",{id:this.parent.parentID+"_ErrorDialog",className:ni});this.parent.element.appendChild(n);var o=r?Number(r.style.zIndex)+1:"pivotfieldlist"===this.parent.moduleName&&"Popup"===this.parent.renderMode&&this.parent.control?this.parent.control.dialogRenderer.fieldListDialog.zIndex+1:"pivotfieldlist"===this.parent.moduleName&&"Fixed"===this.parent.renderMode&&this.parent.control?1000002:"pivotview"===this.parent.moduleName&&this.parent.control?1000002:1000001;this.errorPopUp=new a.Dialog({animationSettings:{effect:"Fade"},allowDragging:!1,header:e,content:i,isModal:!0,visible:!0,showCloseIcon:!0,enableRtl:this.parent.enableRtl,width:"auto",height:"auto",zIndex:o,position:{X:"center",Y:"center"},buttons:[{click:this.closeErrorDialog.bind(this),buttonModel:{cssClass:ai,content:this.parent.localeObj.getConstant("ok"),isPrimary:!0}}],closeOnEscape:!0,target:document.body,close:this.removeErrorDialog.bind(this)}),this.errorPopUp.isStringTemplate=!0,this.errorPopUp.appendTo(n)},e.prototype.closeErrorDialog=function(){this.errorPopUp.close()},e.prototype.removeErrorDialog=function(){this.errorPopUp&&!this.errorPopUp.isDestroyed&&this.errorPopUp.destroy(),document.getElementById(this.parent.parentID+"_ErrorDialog")&&t.remove(document.getElementById(this.parent.parentID+"_ErrorDialog"))},e}(),nr=function(){function e(e){this.parent=e}return e.prototype.createFilterDialog=function(e,i,r,n){var o=this,s=t.createElement("div",{id:this.parent.parentID+"_EditorTreeView",className:"e-member-editor-dialog "+("olap"===this.parent.dataType?"e-olap-editor-dialog":""),attrs:{"data-fieldName":i,"aria-label":r}}),l=this.parent.engineModule.fieldList[i].caption,d=this.parent.localeObj.getConstant("filter")+' "'+r+'" '+this.parent.localeObj.getConstant("by");this.filterObject=this.getFilterObject(i),this.isSearchEnabled=!1,this.allowExcelLikeFilter=this.isExcelFilter(i),this.parent.element.appendChild(s),this.dialogPopUp=new a.Dialog({animationSettings:{effect:this.allowExcelLikeFilter?"None":"Fade"},allowDragging:!1,header:this.allowExcelLikeFilter?d:l,content:"",isModal:!0,visible:!0,showCloseIcon:!!this.allowExcelLikeFilter,enableRtl:this.parent.enableRtl,width:"auto",height:this.parent.isDataOverflow?this.allowExcelLikeFilter?"440px":"400px":this.allowExcelLikeFilter?"400px":"350px",position:{X:"center",Y:"center"},buttons:[{buttonModel:{cssClass:"e-clear-filter-button"+(this.allowExcelLikeFilter?"":" "+Nt),iconCss:"e-icons e-clear-filter-icon",enableRtl:this.parent.enableRtl,content:this.parent.localeObj.getConstant("clearFilter"),disabled:!this.filterObject}},{buttonModel:{cssClass:ai,content:this.parent.localeObj.getConstant("ok"),isPrimary:!0}},{click:this.closeFilterDialog.bind(this),buttonModel:{cssClass:ri,content:this.parent.localeObj.getConstant("cancel")}}],closeOnEscape:"Popup"!==this.parent.renderMode,target:n,close:this.removeFilterDialog.bind(this)}),this.dialogPopUp.isStringTemplate=!0,this.dialogPopUp.appendTo(s);var h={cancel:!1,fieldName:i,fieldMembers:this.parent.dataSourceSettings.allowMemberFilter?e:[],filterSetting:this.filterObject};("pivotfieldlist"===this.parent.moduleName&&this.parent.control.isPopupView?this.parent.control.pivotGridModule:this.parent.control).trigger(Q,h,function(a){a.cancel?(o.dialogPopUp.close(),o.dialogPopUp=void 0):(e=a.fieldMembers,o.allowExcelLikeFilter?(o.createTabMenu(e,r,i),t.addClass([o.dialogPopUp.element],"e-excel-filter"),o.updateCheckedState(r)):(o.dialogPopUp.content=o.createTreeView(e,r,i),o.updateCheckedState(r)),t.setStyleAttribute(o.dialogPopUp.element,{visibility:"visible"}),o.allowExcelLikeFilter&&o.dialogPopUp.element.querySelector(".e-dlg-closeicon-btn").focus(),o.memberTreeView.nodeChecked=o.parent.control.pivotButtonModule.nodeStateModified.bind(o.parent.control.pivotButtonModule),o.allMemberSelect.nodeChecked=o.parent.control.pivotButtonModule.nodeStateModified.bind(o.parent.control.pivotButtonModule))})},e.prototype.createTreeView=function(e,i,a){var r=this,s=t.createElement("div",{id:this.parent.parentID+"EditorDiv",className:Zt+(this.allowExcelLikeFilter?" e-excelfilter":"")}),l=t.createElement("button",{id:this.parent.parentID+"_LevelDiv",className:"e-level-wrapper-class",attrs:{type:"button"}}),d=t.createElement("div",{id:this.parent.parentID+"_SearchDiv",attrs:{tabindex:"-1"},className:Gi}),h=this.parent.engineModule.fieldList[a].caption,p=t.createElement("input",{attrs:{type:"text",className:"e-editor-search-input"}}),u=this.parent.isDataOverflow?this.parent.currentTreeItems.length-this.parent.control.maxNodeLimitInMemberEditor+this.parent.control.localeObj.getConstant("editorDataLimitMsg"):"",c=t.createElement("div",{id:this.parent.parentID+"_LabelDiv",attrs:{tabindex:"-1",title:u},className:"e-editor-label-wrapper"});this.parent.editorLabelElement=t.createElement("label",{className:"e-editor-label"}),this.parent.editorLabelElement.innerText=u,c.style.display=this.parent.isDataOverflow?"block":"none",c.appendChild(this.parent.editorLabelElement),d.appendChild(p),this.createSortOptions(a,d,e);var g=t.createElement("div",{id:this.parent.parentID+"_AllDiv",attrs:{tabindex:"-1"},className:"e-select-all-wrapper"}),m=t.createElement("div",{className:Wi}),f=t.createElement("div",{className:$t+"-outer-div"}),v=t.createElement("div",{className:$t}),S=t.createElement("div",{className:pa+" "+Nt,innerHTML:this.parent.localeObj.getConstant("noMatches")});"olap"!==this.parent.dataType||!this.parent.control.loadOnDemandInMemberEditor||this.parent.engineModule.fieldList[a].isHierarchy||this.parent.engineModule.fieldList[a].isNamedSets||(d.appendChild(l),this.createLevelWrapper(l,a)),g.appendChild(m),s.appendChild(d),s.appendChild(g),s.appendChild(S),this.editorSearch=new o.MaskedTextBox({placeholder:this.parent.localeObj.getConstant("search")+" &#8220"+h+"&#8220",enableRtl:this.parent.enableRtl,cssClass:"e-editor-search",showClearButton:!0,change:function(e){if("olap"===r.parent.dataType)r.searchOlapTreeView(e,S,i);else{r.parent.eventBase.searchTreeNodes(e,r.memberTreeView,!1);var a=r.dialogPopUp.element;0===[].slice.call(r.memberTreeView.element.querySelectorAll("li")).length?(r.allMemberSelect.disableNodes([r.allMemberSelect.element.querySelector("li")]),a.querySelector("."+ai).setAttribute("disabled","disabled"),t.removeClass([S],Nt)):(r.allMemberSelect.enableNodes([r.allMemberSelect.element.querySelector("li")]),a.querySelector("."+ai).removeAttribute("disabled"),t.addClass([S],Nt)),r.updateCheckedState(i)}}}),this.editorSearch.isStringTemplate=!0,this.editorSearch.appendTo(p);var y={"data-fieldName":a,"data-memberId":"all"},b=[{id:"all",name:this.parent.localeObj.getConstant("all"),isSelected:!0,htmlAttributes:y}];if(this.allMemberSelect=new n.TreeView({fields:{dataSource:b,id:"id",text:"name",isChecked:"isSelected"},showCheckBox:!0,expandOn:"None",enableRtl:this.parent.enableRtl,nodeClicked:this.nodeCheck.bind(this,!0),keyPress:this.nodeCheck.bind(this,!0),nodeSelected:function(e){t.removeClass([e.node],"e-active"),e.cancel=!0}}),this.allMemberSelect.isStringTemplate=!0,!t.isNullOrUndefined(this.parent.currentTreeItems))for(var C=0;C<this.parent.currentTreeItems.length;C++)(this.parent.currentTreeItems[C].id.indexOf("\n")||this.parent.currentTreeItems[C].id.startsWith("\n"))&&(this.parent.currentTreeItems[C].id=this.parent.currentTreeItems[C].id.replace("\n"," "));return this.allMemberSelect.appendTo(m),f.appendChild(v),s.appendChild(f),this.memberTreeView=new n.TreeView({fields:{dataSource:e,id:"id",text:"name",isChecked:"isSelected",parentID:"pid"},showCheckBox:!0,enableRtl:this.parent.enableRtl,nodeChecking:this.validateTreeNode.bind(this),nodeClicked:this.nodeCheck.bind(this,!1),keyPress:this.nodeCheck.bind(this,!1),nodeExpanding:this.updateChildNodes.bind(this),nodeSelected:function(e){t.removeClass([e.node],"e-active"),e.cancel=!0},expandOn:"None"}),this.memberTreeView.isStringTemplate=!0,this.memberTreeView.appendTo(v),s.appendChild(c),s},e.prototype.createSortOptions=function(e,i,a){if("pivot"===this.parent.dataType&&a&&a.length>0){var r=this.parent.engineModule.fieldList[e].sort,n=t.createElement("div",{className:"e-filter-sort e-btn-group"+(this.parent.enableRtl?" e-rtl":""),id:this.parent.element.id+"_Member_Sort"});this.parent.element.appendChild(n);var o=t.createElement("button",{className:("Ascending"===r?Li+" ":"")+Ut,id:this.parent.element.id+"_Sort_Ascend",attrs:{type:"button"}}),s=t.createElement("button",{className:("Descending"===r?Li+" ":"")+Ut,id:this.parent.element.id+"_Sort_Descend",attrs:{type:"button"}}),l=new h.Button({iconCss:Ot+" "+Fi,enableRtl:this.parent.enableRtl});l.appendTo(o),(l=new h.Button({iconCss:Ot+" "+Ii,enableRtl:this.parent.enableRtl})).appendTo(s),n.appendChild(o),n.appendChild(s),i.appendChild(n),this.unWireEvent(o,e),this.unWireEvent(s,e),this.wireEvent(o,e),this.wireEvent(s,e)}},e.prototype.createLevelWrapper=function(e,i){for(var a=this,r=this.parent.engineModule,n=r.fieldList[i].levels,o=r.fieldList[i].levelCount,s=[],l=0,h=n.length;l<h;l++)s.push({id:n[l].id,text:n[l].name});this.dropMenu=new d.DropDownButton({cssClass:"e-level-drop e-caret-hide",items:s,iconCss:"e-icons e-dropdown-icon",disabled:o===n.length,enableRtl:this.parent.enableRtl,beforeOpen:function(e){var r=[].slice.call(e.element.querySelectorAll("li")),n=a.parent.engineModule.fieldList[i].levelCount;t.removeClass(r,da);for(var o=0,s=r.length;o<s;o++)o<n&&t.addClass([r[o]],da)},select:function(e){for(var t,i=a.dialogPopUp.element.getAttribute("data-fieldname"),r=a.parent.engineModule,n=0,o=s.length;n<o;n++)s[n].id===e.item.id&&(t=n);r.getFilterMembers(a.parent.dataSourceSettings,i,t+1,!1,!0)},close:function(){var e=a.parent.engineModule,t=e.fieldList[i].levels;e.fieldList[i].levelCount===t.length?(a.dropMenu.disabled=!0,a.dropMenu.dataBind()):a.dropMenu.disabled=!1}}),this.dropMenu.appendTo(e)},e.prototype.searchOlapTreeView=function(e,i,a){var r=this;clearTimeout(this.timeOutObj),this.timeOutObj=setTimeout(function(){var n=r.parent.engineModule,o=r.dialogPopUp.element,s=o.getAttribute("data-fieldname"),l=r.parent.control.maxNodeLimitInMemberEditor?r.parent.control.maxNodeLimitInMemberEditor:5e3;if(n.fieldList[s].isHierarchy)r.parent.eventBase.searchTreeNodes(e,r.memberTreeView,!1,!0);else{if(r.dropMenu&&""!==e.value?r.dropMenu.disabled=!0:r.dropMenu.disabled=!1,r.parent.control.loadOnDemandInMemberEditor){var d=n.fieldList[s].levelCount?n.fieldList[s].levelCount:1;n.getSearchMembers(r.parent.dataSourceSettings,s,e.value.toLowerCase(),l,!1,d)}else n.getSearchMembers(r.parent.dataSourceSettings,s,e.value.toLowerCase(),l,!0);r.parent.eventBase.searchTreeNodes(e,r.memberTreeView,!1,!1)}0===[].slice.call(r.memberTreeView.element.querySelectorAll("li")).length?(r.allMemberSelect.disableNodes([r.allMemberSelect.element.querySelector("li")]),o.querySelector("."+ai).setAttribute("disabled","disabled"),t.removeClass([i],Nt)):(r.allMemberSelect.enableNodes([r.allMemberSelect.element.querySelector("li")]),o.querySelector("."+ai).removeAttribute("disabled"),t.addClass([i],Nt)),r.updateCheckedState(a)},500)},e.prototype.nodeCheck=function(e,i){var a=[i.node];if(i.event.target.classList.contains("e-fullrow")||"Enter"===i.event.key){var r=e?this.allMemberSelect:this.memberTreeView;"true"===r.getNode(i.node).isChecked?r.uncheckAll(a):r.checkAll(a)}else 38!==i.event.keyCode||e||(t.removeClass(this.memberTreeView.element.querySelectorAll("li.e-prev-active-node"),"e-prev-active-node"),t.addClass(a,"e-prev-active-node"))},e.prototype.applySorting=function(e,i){var a=t.closest(i.target,"."+Ut);if(a){var r=[].slice.call(t.closest(a,".e-filter-sort").querySelectorAll("."+Ut));a.querySelector("."+Fi)&&!a.classList.contains(Li)?(this.updateFilterMembers("Ascending",e),t.addClass([a],Li),t.removeClass([r[1]],Li)):a.querySelector("."+Ii)&&!a.classList.contains(Li)?(this.updateFilterMembers("Descending",e),t.addClass([a],Li),t.removeClass([r[0]],Li)):(this.updateFilterMembers("None",e),t.removeClass(r,Li))}},e.prototype.updateFilterMembers=function(e,t){var i="None"===e?g.getClonedData(this.parent.engineModule.fieldList[t].dateMember):this.parent.currentTreeItems.slice();this.parent.currentTreeItems=[],this.parent.searchTreeItems=[];var a=[];i="Ascending"===e?i.sort(function(e,t){return e.actualText>t.actualText?1:t.actualText>e.actualText?-1:0}):"Descending"===e?i.sort(function(e,t){return e.actualText<t.actualText?1:t.actualText<e.actualText?-1:0}):i;for(var r=t.replace(/[^a-zA-Z0-9 ]/g,"_"),n=0,o=i.length;n<o;n++){if("None"===e){var s=(this.parent.isDateField?i[n].formattedText:i[n].actualText).toString(),l={id:r+"_"+(n+1),htmlAttributes:{"data-fieldName":t,"data-memberId":i[n].actualText.toString()},actualText:i[n].actualText,name:s,isSelected:this.parent.currentTreeItemsPos[i[n].actualText].isSelected};this.parent.currentTreeItems.push(l),""!==this.editorSearch.value?l.name.toLowerCase().indexOf(this.editorSearch.value.toLowerCase())>-1&&(this.parent.searchTreeItems.push(l),a.push(l)):(this.parent.searchTreeItems.push(l),a.push(l))}else this.parent.currentTreeItems.push(i[n]),""!==this.editorSearch.value?i[n].name.toLowerCase().indexOf(this.editorSearch.value.toLowerCase())>-1&&(this.parent.searchTreeItems.push(i[n]),a.push(i[n])):(this.parent.searchTreeItems.push(i[n]),a.push(i[n]));this.parent.currentTreeItemsPos[i[n].actualText].index=n}var d=this.memberTreeView.fields.dataSource.length;this.memberTreeView.fields={dataSource:a.slice(0,d),id:"id",text:"name",isChecked:"isSelected",parentID:"pid"},this.memberTreeView.dataBind()},e.prototype.updateChildNodes=function(e){if("olap"===this.parent.dataType){var i=this.parent.engineModule,a=e.node.getAttribute("data-fieldname"),r=i.fieldList[a],n=[];if(r&&r.filterMembers.length>0&&!this.isSearchEnabled&&!r.members[e.nodeData.id].isNodeExpand){for(var o=[],s=0,l=r.filterMembers;s<l.length;s++){var d=l[s];d.pid===e.nodeData.id.toString()&&o.push(d)}0===o.length&&(r.childMembers=[],i.getChildMembers(this.parent.dataSourceSettings,e.nodeData.id.toString(),a),o=r.childMembers,r.childMembers=[]);var h=g.getClonedData(o),p=this.memberTreeView.fields.dataSource,u=!1;t.isNullOrUndefined(this.filterObject)||(u="Include"===this.filterObject.type,n=this.filterObject.items?this.filterObject.items:[]),h=this.updateChildData(u,h,n,a,e.nodeData);for(var c=0,m=h=this.parent.eventBase.sortOlapFilterData(h,i.fieldList[a].sort);c<m.length;c++){var f=m[c];p.push(f)}r.members[e.nodeData.id].isNodeExpand=!0,this.memberTreeView.addNodes(h,e.node)}}},e.prototype.updateChildData=function(e,t,i,a,r){for(var n=Object.keys(this.parent.currentTreeItemsPos).length,o=this.parent.engineModule.fieldList[a],s=[],l=1,d=0,h=t;d<h.length;d++){var p=h[d],u=p,c=p.id.toString();o.members[c].isNodeExpand=!1,p.isSelected="true"===r.isChecked,l<=this.parent.control.maxNodeLimitInMemberEditor&&s.push(u),this.parent.currentTreeItems.push(u),this.parent.searchTreeItems.push(u),this.parent.currentTreeItemsPos[c]={index:n,isSelected:u.isSelected},n++,l++}return this.parent.isDataOverflow=!1,s},e.prototype.createTabMenu=function(e,i,a){var r=t.createElement("div",{className:"e-filter-tab-wrapper"});this.dialogPopUp.content=r,this.dialogPopUp.dataBind();for(var o=["Label","Value","Include","Exclude"],s="((-|\\+)?[0-9]+(\\.[0-9]+)?)+",l=Object.keys(this.parent.engineModule.fieldList[a].members)[0],d=this.parent.engineModule.fieldList[a].type,h=g.getFieldByName(a,this.parent.dataSourceSettings.formatSettings),p=[{header:{text:this.parent.localeObj.getConstant("member"),iconCss:this.filterObject&&o.indexOf(this.filterObject.type)>1?Mi:""},content:this.createTreeView(e,i,a)}],u=0,c=o;u<c.length;u++){var m=c[u];if("Label"===m&&this.parent.dataSourceSettings.allowLabelFilter||"Value"===m&&this.parent.dataSourceSettings.allowValueFilter){var f="Label"===m&&l&&l.match(s)&&l.match(s)[0].length===l.length&&"number"===d?"Number":"Label"===m&&l&&"Invalid Date"!==new Date(l).toString()&&(h&&h.type||this.filterObject&&"Date"===this.filterObject.type)?"Date":m,v={header:{text:"Number"===f?this.parent.localeObj.getConstant("label"):this.parent.localeObj.getConstant(f.toLowerCase()),iconCss:this.filterObject&&this.filterObject.type===f?Mi:""},content:this.createCustomFilter(a,this.filterObject&&this.filterObject.type===f?this.filterObject:void 0,f.toLowerCase())};p.push(v)}}var S=this.filterObject?["Label","Date","Number"].indexOf(this.filterObject.type)>=0?1:"Value"===this.filterObject.type?this.parent.dataSourceSettings.allowLabelFilter&&this.parent.dataSourceSettings.allowValueFilter?2:1:0:0;S=this.parent.dataSourceSettings.allowMemberFilter||0!==S?S:1,this.tabObj=new n.Tab({heightAdjustMode:"Auto",items:p,height:"100%",selectedItem:S,enableRtl:this.parent.enableRtl}),this.tabObj.isStringTemplate=!0,this.tabObj.appendTo(r),this.parent.dataSourceSettings.allowMemberFilter||this.tabObj.hideTab(0),S>0&&t.addClass([this.dialogPopUp.element.querySelector(".e-filter-div-content."+(1===S&&this.parent.dataSourceSettings.allowLabelFilter?"e-label-filter":"e-value-filter"))],"e-selected-tab")},e.prototype.createCustomFilter=function(e,i,a){for(var r=[],n=[],o=[],s=this.parent.dataSourceSettings.values,l="DoesNotEquals",d=0,h=0,p=["Between","NotBetween"],u="label"===a?["Equals","DoesNotEquals","BeginWith","DoesNotBeginWith","EndsWith","DoesNotEndsWith","Contains","DoesNotContains","GreaterThan","GreaterThanOrEqualTo","LessThan","LessThanOrEqualTo","Between","NotBetween"]:"date"===a?["Equals","DoesNotEquals","Before","BeforeOrEqualTo","After","AfterOrEqualTo","Between","NotBetween"]:["Equals","DoesNotEquals","GreaterThan","GreaterThanOrEqualTo","LessThan","LessThanOrEqualTo","Between","NotBetween"],c=0,g=u;c<g.length;c++){var m=g[c];l=i&&m===i.condition?u.indexOf(i.condition)>=0?i.condition:u[0]:l,r.push({value:m,text:this.parent.localeObj.getConstant(m)})}for(var f=s.length;f--;)n.unshift({value:s[f].name,text:s[f].caption?s[f].caption:s[f].name}),d=i&&"Value"===i.type&&i.measure===s[f].name&&i.condition===l?f:d;if("olap"===this.parent.dataType){var v=this.parent.engineModule,S=v.fieldList[e].levels;if(this.parent.engineModule.fieldList[e].isHierarchy){for(var y=void 0,b=0,C=this.parent.engineModule.fieldListData;b<C.length;b++){var x=C[b];if(x&&x.pid===e){y=x;break}}o.push({value:y?y.id:e,text:y?y.caption:v.fieldList[e].name}),h=0,i&&i.name===e&&i.type.toLowerCase()===a&&(o[o.length-1].iconClass=Ot+" "+Di)}else for(var w=0,T=S.length;w<T;w++){h=i&&i.selectedField===S[w].id?w:h,o.push({value:S[w].id,text:S[w].name});for(var M=0,D=this.parent.dataSourceSettings.filterSettings;M<D.length;M++){var O=D[M];if(O.name===e&&O.selectedField===S[w].id&&O.type.toLowerCase()===a){o[o.length-1].iconClass=Ot+" "+Di;break}}}}var N=t.createElement("div",{className:"e-filter-div-content e-"+(["date","number"].indexOf(a)>=0?"label":a)+"-filter",id:this.parent.parentID+"_"+a+"_filter_div_content",attrs:{"data-type":a,"data-fieldName":e,"data-operator":l,"data-selectedField":"olap"===this.parent.dataType&&o.length>0?o[h].value.toString():"","data-measure":this.parent.dataSourceSettings.values.length>0?this.parent.dataSourceSettings.values[d].name:"","data-value1":i&&l===i.condition&&i.value1?i.value1.toString():"","data-value2":i&&l===i.condition&&i.value2?i.value2.toString():""}}),E=t.createElement("div",{className:"e-filter-text-div",innerHTML:this.parent.localeObj.getConstant(a+"TextContent")}),P=t.createElement("div",{className:Oi+" "+(-1===p.indexOf(l)?Nt:""),innerHTML:this.parent.localeObj.getConstant("And")}),F=t.createElement("div",{className:"e-separator-div"}),I=t.createElement("div",{className:"e-filter-option-wrapper-1"}),L=t.createElement("div",{className:"e-level-option-wrapper "+("olap"===this.parent.dataType?"":Nt)}),A=t.createElement("div",{className:"e-measure-option-wrapper "+(["label","date","number"].indexOf(a)>=0?Nt:"")}),R=t.createElement("div",{className:"e-condition-option-wrapper"}),j=t.createElement("div",{className:"e-filter-option-wrapper-2"}),k=t.createElement("div",{id:this.parent.parentID+"_"+a+"_level_option_wrapper"}),q=t.createElement("div",{id:this.parent.parentID+"_"+a+"_measure_option_wrapper"}),V=t.createElement("div",{id:this.parent.parentID+"_"+a+"_contition_option_wrapper"}),H=t.createElement("div",{className:"e-filter-input-div-1"}),B=t.createElement("div",{className:Ni+" "+(-1===p.indexOf(l)?Nt:"")}),_=t.createElement("input",{id:this.parent.parentID+"_"+a+"_input_option_1",attrs:{type:"text"}}),U=t.createElement("input",{id:this.parent.parentID+"_"+a+"_input_option_2",attrs:{type:"text"}});return H.appendChild(_),B.appendChild(U),L.appendChild(k),L.appendChild(F.cloneNode(!0)),A.appendChild(q),A.appendChild(F),R.appendChild(V),I.appendChild(L),I.appendChild(A),I.appendChild(R),j.appendChild(H),j.appendChild(P),j.appendChild(B),this.createElements(i,p,q,V,_,U,n,r,d,l,a,k,o,h),N.appendChild(E),N.appendChild(I),N.appendChild(j),N},e.prototype.createElements=function(e,i,a,n,d,h,p,u,c,g,m,f,v,S){var y=this;if("olap"===this.parent.dataType){var b=new s.DropDownList({dataSource:v,enableRtl:this.parent.enableRtl,fields:{value:"value",text:"text",iconCss:"iconClass"},index:S,cssClass:"e-level-options",width:"100%",change:function(e){var i=y.dialogPopUp.element.querySelector(".e-selected-tab"),a=i.getAttribute("data-fieldName"),n=i.getAttribute("data-type");if(!t.isNullOrUndefined(i)){y.updateInputValues(i,n,d,h),r.setStyleAndAttributes(i,{"data-selectedField":e.value});for(var o,s=0,l=y.parent.dataSourceSettings.filterSettings;s<l.length;s++){var u=l[s];if(u.name===a&&u.selectedField===e.value){o=u;break}}if(o){"value"===n&&o.measure&&""!==o.measure&&(C.value=o.measure?o.measure:p[0].value),o.condition?x.value=o.condition?o.condition:"DoesNotEquals":x.value="DoesNotEquals";var c=void 0,g=void 0;"value"===n?(c=d.ej2_instances[0],g=h.ej2_instances[0],c&&(c.value=o.value1?parseInt(o.value1,10):void 0),g&&(g.value=o.value2?parseInt(o.value2,10):void 0)):(c=d.ej2_instances[0],g=h.ej2_instances[0],c&&(c.value=o.value1?o.value1:""),g&&(g.value=o.value2?o.value2:""))}y.updateInputValues(i,n,d,h)}}});b.isStringTemplate=!0,b.appendTo(f)}var C=new s.DropDownList({dataSource:p,enableRtl:this.parent.enableRtl,fields:{value:"value",text:"text"},index:c,cssClass:Ei,width:"100%",change:function(e){var i=y.dialogPopUp.element.querySelector(".e-selected-tab");t.isNullOrUndefined(i)||(y.updateInputValues(i,m,d,h),r.setStyleAndAttributes(i,{"data-measure":e.value}))}});C.isStringTemplate=!0,C.appendTo(a);var x=new s.DropDownList({dataSource:u,enableRtl:this.parent.enableRtl,fields:{value:"value",text:"text"},value:g,cssClass:Pi,width:"100%",change:function(e){var a=y.dialogPopUp.element.querySelector(".e-selected-tab");if(!t.isNullOrUndefined(a)){y.updateInputValues(a,m,d,h);for(var n=0,o=[Oi,Ni];n<o.length;n++){var s=o[n];i.indexOf(e.value)>=0?t.removeClass([a.querySelector("."+s)],Nt):t.addClass([a.querySelector("."+s)],Nt)}r.setStyleAndAttributes(a,{"data-operator":e.value})}}});if(x.isStringTemplate=!0,x.appendTo(n),"date"===m){var w=new l.DateTimePicker({placeholder:this.parent.localeObj.getConstant("chooseDate"),enableRtl:this.parent.enableRtl,format:"dd/MM/yyyy hh:mm:ss a",showClearButton:!0,value:e&&g===e.condition?"string"==typeof e.value1?new Date(e.value1):e.value1:null,change:function(e){var i=y.dialogPopUp.element.querySelector(".e-selected-tab");t.isNullOrUndefined(i)||r.setStyleAndAttributes(i,{"data-value1":e.value,"data-value2":T.value})},width:"100%"}),T=new l.DateTimePicker({placeholder:this.parent.localeObj.getConstant("chooseDate"),enableRtl:this.parent.enableRtl,format:"dd/MM/yyyy hh:mm:ss a",showClearButton:!0,value:e&&g===e.condition?"string"==typeof e.value2?new Date(e.value2):e.value2:null,change:function(e){var i=y.dialogPopUp.element.querySelector(".e-selected-tab");t.isNullOrUndefined(i)||r.setStyleAndAttributes(i,{"data-value1":w.value,"data-value2":e.value})},width:"100%"});w.isStringTemplate=!0,w.appendTo(d),T.isStringTemplate=!0,T.appendTo(h)}else if("value"===m){var M=new o.NumericTextBox({placeholder:this.parent.localeObj.getConstant("enterValue"),enableRtl:this.parent.enableRtl,showClearButton:!0,format:"###.##",value:e&&g===e.condition?parseInt(e.value1,10):void 0,change:function(e){var i=y.dialogPopUp.element.querySelector(".e-selected-tab");t.isNullOrUndefined(i)||r.setStyleAndAttributes(i,{"data-value1":e.value?e.value.toString():"0","data-value2":D.value?D.value.toString():"0"})},width:"100%"}),D=new o.NumericTextBox({placeholder:this.parent.localeObj.getConstant("enterValue"),enableRtl:this.parent.enableRtl,showClearButton:!0,format:"###.##",value:e&&g===e.condition?parseInt(e.value2,10):void 0,change:function(e){var i=y.dialogPopUp.element.querySelector(".e-selected-tab");t.isNullOrUndefined(i)||r.setStyleAndAttributes(i,{"data-value1":M.value?M.value.toString():"0","data-value2":e.value?e.value.toString():"0"})},width:"100%"});M.isStringTemplate=!0,M.appendTo(d),D.isStringTemplate=!0,D.appendTo(h)}else{var O=new o.MaskedTextBox({placeholder:this.parent.localeObj.getConstant("enterValue"),enableRtl:this.parent.enableRtl,showClearButton:!0,value:e&&g===e.condition?e.value1:"",change:function(e){var i=y.dialogPopUp.element.querySelector(".e-selected-tab");t.isNullOrUndefined(i)||r.setStyleAndAttributes(i,{"data-value1":e.value,"data-value2":N.value})},width:"100%"}),N=new o.MaskedTextBox({placeholder:this.parent.localeObj.getConstant("enterValue"),enableRtl:this.parent.enableRtl,showClearButton:!0,value:e&&g===e.condition?e.value2:"",change:function(e){var i=y.dialogPopUp.element.querySelector(".e-selected-tab");t.isNullOrUndefined(i)||r.setStyleAndAttributes(i,{"data-value1":O.value,"data-value2":e.value})},width:"100%"});O.isStringTemplate=!0,O.appendTo(d),N.isStringTemplate=!0,N.appendTo(h)}},e.prototype.updateInputValues=function(e,i,a,n){var o,s;if("date"===i){var l=a.ej2_instances[0],d=n.ej2_instances[0];o=t.isNullOrUndefined(l.value)?"":l.value.toString(),s=t.isNullOrUndefined(d.value)?"":d.value.toString()}else{l=a.ej2_instances[0],d=n.ej2_instances[0];o=l.value,s=d.value}r.setStyleAndAttributes(e,{"data-value1":o,"data-value2":s})},e.prototype.validateTreeNode=function(e){e.node.classList.contains(Nt)&&(e.cancel=!0)},e.prototype.updateCheckedState=function(e){var i=this.dialogPopUp.element;r.setStyleAndAttributes(i,{role:"menu","aria-haspopup":"true"});var a=[].slice.call(this.memberTreeView.element.querySelectorAll("li")),n=i.getAttribute("data-fieldname"),o=this.getUnCheckedNodes(n),s=this.getCheckedNodes(n),l=this.allMemberSelect.element.querySelector("li").querySelector("span.e-frame");a.length>0?s>0?(o>0?(t.removeClass([l],"e-check"),t.addClass([l],"e-stop")):0===o&&(t.removeClass([l],"e-stop"),t.addClass([l],"e-check")),this.dialogPopUp.buttons[0].buttonModel.disabled=!1,i.querySelector("."+ai).removeAttribute("disabled")):o>0&&0===s&&(t.removeClass([l],["e-check","e-stop"]),this.getCheckedNodes(n)===s&&(this.dialogPopUp.buttons[0].buttonModel.disabled=!0,i.querySelector("."+ai).setAttribute("disabled","disabled"))):(this.dialogPopUp.buttons[0].buttonModel.disabled=!0,i.querySelector("."+ai).setAttribute("disabled","disabled"))},e.prototype.getCheckedNodes=function(e){var t=this.parent.engineModule,i=[];if("olap"===this.parent.dataType&&t&&!t.fieldList[e].isHierarchy)return this.memberTreeView.getAllCheckedNodes().length;for(var a=0,r=this.parent.searchTreeItems;a<r.length;a++){var n=r[a];n.isSelected&&i.push(n)}return i.length},e.prototype.getUnCheckedNodes=function(e){var t=[],i=[],a=this.parent.engineModule;if("olap"===this.parent.dataType&&a&&!a.fieldList[e].isHierarchy)return i=this.memberTreeView.getAllCheckedNodes(),this.memberTreeView.fields.dataSource.length-i.length;for(var r=0,n=this.parent.searchTreeItems;r<n.length;r++){var o=n[r];o.isSelected||t.push(o)}return t.length},e.prototype.isExcelFilter=function(e){for(var t=!1,i=0,a=this.parent.dataSourceSettings.filters;i<a.length;i++){if(a[i].name===e){t=!0;break}}return!(t||!this.parent.dataSourceSettings.allowLabelFilter&&!this.parent.dataSourceSettings.allowValueFilter)},e.prototype.getFilterObject=function(e){var t=g.getFilterItemByName(e,g.cloneFilterSettings(this.parent.dataSourceSettings.filterSettings));if(t&&(["Label","Date","Number"].indexOf(t.type)>=0&&this.parent.dataSourceSettings.allowLabelFilter||"Value"===t.type&&this.parent.dataSourceSettings.allowValueFilter||["Include","Exclude"].indexOf(t.type)>=0&&this.parent.eventBase.isValidFilterItemsAvail(e,t)))return t},e.prototype.wireEvent=function(e,i){t.EventHandler.add(e,"click",this.applySorting.bind(this,i),this)},e.prototype.unWireEvent=function(e,i){t.EventHandler.remove(e,"click",this.applySorting)},e.prototype.closeFilterDialog=function(){this.allowExcelLikeFilter&&this.tabObj&&!this.tabObj.isDestroyed&&this.tabObj.destroy(),this.dropMenu&&!this.dropMenu.isDestroyed&&this.dropMenu.destroy(),this.memberTreeView&&!this.memberTreeView.isDestroyed&&this.memberTreeView.destroy(),this.allMemberSelect&&!this.allMemberSelect.isDestroyed&&this.allMemberSelect.destroy(),this.editorSearch&&!this.editorSearch.isDestroyed&&this.editorSearch.destroy(),document.getElementById(this.parent.parentID+"_LevelDiv-popup")&&t.remove(document.getElementById(this.parent.parentID+"_LevelDiv-popup")),this.dialogPopUp.close()},e.prototype.removeFilterDialog=function(){this.dialogPopUp&&!this.dialogPopUp.isDestroyed&&(this.dialogPopUp.destroy(),setTimeout(this.setFocus.bind(this))),document.getElementById(this.parent.parentID+"_EditorTreeView")&&t.remove(document.getElementById(this.parent.parentID+"_EditorTreeView"))},e.prototype.setFocus=function(){if(this.parent.control.pivotButtonModule.parentElement)for(var e=0,t=[].slice.call(this.parent.control.pivotButtonModule.parentElement.querySelectorAll(".e-pivot-button"));e<t.length;e++){var i=t[e];if(i.getAttribute("data-uid")===this.parent.control.pivotButtonModule.fieldName){i.focus();break}}},e}(),or=function(){function e(e){return this.currentTreeItems=[],this.savedTreeFilterPos={},this.currentTreeItemsPos={},this.searchTreeItems=[],this.isDataOverflow=!1,this.isDateField=!1,this.element=e.element,this.moduleName=e.moduleName,this.dataSourceSettings=e.dataSourceSettings,this.engineModule=e.pivotEngine,this.enableRtl=e.enableRtl,this.isAdaptive=e.isAdaptive,this.renderMode=e.renderMode,this.parentID=e.id,this.localeObj=e.localeObj,this.dataType=e.dataType,this.nodeStateModified=new ir(this),this.dataSourceUpdate=new ar(this),this.eventBase=new tr(this),this.filterDialog=new nr(this),this.errorDialog=new rr(this),this.keyboardModule=new er(this),this}return e.prototype.destroy=function(){this.keyboardModule&&(this.keyboardModule.destroy(),this.keyboardModule=null)},e}(),sr=function(){function e(e){this.parent=e,this.parent.commonModule=this,this.addEventListener()}return e.prototype.getModuleName=function(){return"common"},e.prototype.initiateCommonModule=function(){if(this.parent.pivotCommon)this.parent.pivotCommon.element=this.parent.element,this.parent.pivotCommon.engineModule="olap"===this.parent.dataType?this.parent.olapEngineModule:this.parent.engineModule,this.parent.pivotCommon.parentID=this.parent.element.id,this.parent.pivotCommon.dataSourceSettings=this.parent.dataSourceSettings.properties?this.parent.dataSourceSettings.properties:this.parent.dataSourceSettings,this.parent.pivotCommon.moduleName=this.parent.getModuleName(),this.parent.pivotCommon.enableRtl=this.parent.enableRtl,this.parent.pivotCommon.isAdaptive=t.Browser.isDevice,this.parent.pivotCommon.renderMode="Popup",this.parent.pivotCommon.localeObj=this.parent.localeObj,this.parent.pivotCommon.dataType=this.parent.dataType;else{var e={pivotEngine:"olap"===this.parent.dataType?this.parent.olapEngineModule:this.parent.engineModule,dataSourceSettings:this.parent.dataSourceSettings.properties?this.parent.dataSourceSettings.properties:this.parent.dataSourceSettings,id:this.parent.element.id,element:this.parent.element,moduleName:this.parent.getModuleName(),enableRtl:this.parent.enableRtl,isAdaptive:t.Browser.isDevice,renderMode:"Popup",localeObj:this.parent.localeObj,dataType:this.parent.dataType};this.parent.pivotCommon=new or(e)}this.parent.pivotCommon.control=this.parent},e.prototype.addEventListener=function(){this.handlers={load:this.initiateCommonModule},this.parent.isDestroyed||(this.parent.on(ie,this.handlers.load,this),this.parent.on(ae,this.handlers.load,this))},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ie,this.handlers.load),this.parent.off(ae,this.handlers.load))},e.prototype.destroy=function(){this.removeEventListener(),this.parent.pivotCommon&&(this.parent.pivotCommon.destroy(),this.parent.pivotCommon=null)},e}(),lr=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function a(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),dr=function(e,t,i,a){var r,n=arguments.length,o=n<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},hr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return lr(i,e),dr([t.Property()],i.prototype,"name",void 0),dr([t.Property()],i.prototype,"caption",void 0),dr([t.Property("Sum")],i.prototype,"type",void 0),dr([t.Property()],i.prototype,"axis",void 0),dr([t.Property(!1)],i.prototype,"showNoDataItems",void 0),dr([t.Property()],i.prototype,"baseField",void 0),dr([t.Property()],i.prototype,"baseItem",void 0),dr([t.Property(!0)],i.prototype,"showSubTotals",void 0),dr([t.Property(!1)],i.prototype,"isNamedSet",void 0),dr([t.Property(!1)],i.prototype,"isCalculatedField",void 0),dr([t.Property(!0)],i.prototype,"showFilterIcon",void 0),dr([t.Property(!0)],i.prototype,"showSortIcon",void 0),dr([t.Property(!0)],i.prototype,"showRemoveIcon",void 0),dr([t.Property(!0)],i.prototype,"showValueTypeIcon",void 0),dr([t.Property(!0)],i.prototype,"showEditIcon",void 0),dr([t.Property(!0)],i.prototype,"allowDragAndDrop",void 0),dr([t.Property()],i.prototype,"dataType",void 0),i}(t.ChildProperty),pr=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}lr(t,e)}(hr),function(e){function i(){return null!==e&&e.apply(this,arguments)||this}lr(i,e),dr([t.Property()],i.prototype,"backgroundColor",void 0),dr([t.Property()],i.prototype,"color",void 0),dr([t.Property()],i.prototype,"fontFamily",void 0),dr([t.Property()],i.prototype,"fontSize",void 0)}(t.ChildProperty),function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return lr(i,e),dr([t.Property()],i.prototype,"name",void 0),dr([t.Property("Include")],i.prototype,"type",void 0),dr([t.Property()],i.prototype,"items",void 0),dr([t.Property("DoesNotEquals")],i.prototype,"condition",void 0),dr([t.Property()],i.prototype,"value1",void 0),dr([t.Property()],i.prototype,"value2",void 0),dr([t.Property()],i.prototype,"measure",void 0),dr([t.Property(1)],i.prototype,"levelCount",void 0),dr([t.Property()],i.prototype,"selectedField",void 0),i}(t.ChildProperty)),ur=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return lr(i,e),dr([t.Property()],i.prototype,"measure",void 0),dr([t.Property()],i.prototype,"label",void 0),dr([t.Property()],i.prototype,"conditions",void 0),dr([t.Property()],i.prototype,"value1",void 0),dr([t.Property()],i.prototype,"value2",void 0),dr([t.Property()],i.prototype,"style",void 0),dr([t.Property(!0)],i.prototype,"applyGrandTotals",void 0),i}(t.ChildProperty),cr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return lr(i,e),dr([t.Property()],i.prototype,"name",void 0),dr([t.Property("Ascending")],i.prototype,"order",void 0),i}(t.ChildProperty),gr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return lr(i,e),dr([t.Property()],i.prototype,"name",void 0),dr([t.Property()],i.prototype,"minimumFractionDigits",void 0),dr([t.Property()],i.prototype,"maximumFractionDigits",void 0),dr([t.Property()],i.prototype,"minimumSignificantDigits",void 0),dr([t.Property()],i.prototype,"maximumSignificantDigits",void 0),dr([t.Property(!0)],i.prototype,"useGrouping",void 0),dr([t.Property()],i.prototype,"skeleton",void 0),dr([t.Property()],i.prototype,"type",void 0),dr([t.Property()],i.prototype,"currency",void 0),dr([t.Property()],i.prototype,"minimumIntegerDigits",void 0),dr([t.Property()],i.prototype,"format",void 0),i}(t.ChildProperty),mr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return lr(i,e),dr([t.Property()],i.prototype,"name",void 0),dr([t.Property()],i.prototype,"groupInterval",void 0),dr([t.Property()],i.prototype,"startingAt",void 0),dr([t.Property()],i.prototype,"endingAt",void 0),dr([t.Property("Date")],i.prototype,"type",void 0),dr([t.Property()],i.prototype,"rangeInterval",void 0),dr([t.Property()],i.prototype,"caption",void 0),dr([t.Property()],i.prototype,"customGroups",void 0),i}(t.ChildProperty),fr=(function(e){function i(){return null!==e&&e.apply(this,arguments)||this}lr(i,e),dr([t.Property()],i.prototype,"groupName",void 0),dr([t.Property([])],i.prototype,"items",void 0)}(t.ChildProperty),function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return lr(i,e),dr([t.Property()],i.prototype,"name",void 0),dr([t.Property()],i.prototype,"formula",void 0),dr([t.Property()],i.prototype,"hierarchyUniqueName",void 0),dr([t.Property()],i.prototype,"formatString",void 0),i}(t.ChildProperty)),vr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return lr(i,e),dr([t.Property()],i.prototype,"name",void 0),dr([t.Property()],i.prototype,"items",void 0),dr([t.Property()],i.prototype,"delimiter",void 0),i}(t.ChildProperty),Sr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return lr(i,e),dr([t.Property()],i.prototype,"headerText",void 0),dr([t.Property(".")],i.prototype,"headerDelimiter",void 0),dr([t.Property("None")],i.prototype,"sortOrder",void 0),dr([t.Property()],i.prototype,"measure",void 0),i}(t.ChildProperty),yr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return lr(i,e),dr([t.Property()],i.prototype,"userName",void 0),dr([t.Property()],i.prototype,"password",void 0),i}(t.ChildProperty),br=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return lr(i,e),dr([t.Property("Local")],i.prototype,"mode",void 0),dr([t.Property()],i.prototype,"catalog",void 0),dr([t.Property()],i.prototype,"cube",void 0),dr([t.Property("Relational")],i.prototype,"providerType",void 0),dr([t.Property()],i.prototype,"url",void 0),dr([t.Property(1033)],i.prototype,"localeIdentifier",void 0),dr([t.Property()],i.prototype,"dataSource",void 0),dr([t.Collection([],hr)],i.prototype,"rows",void 0),dr([t.Collection([],hr)],i.prototype,"columns",void 0),dr([t.Collection([],hr)],i.prototype,"values",void 0),dr([t.Collection([],hr)],i.prototype,"filters",void 0),dr([t.Collection([],hr)],i.prototype,"fieldMapping",void 0),dr([t.Property([])],i.prototype,"excludeFields",void 0),dr([t.Property(!1)],i.prototype,"expandAll",void 0),dr([t.Property("column")],i.prototype,"valueAxis",void 0),dr([t.Property(-1)],i.prototype,"valueIndex",void 0),dr([t.Collection([],pr)],i.prototype,"filterSettings",void 0),dr([t.Collection([],cr)],i.prototype,"sortSettings",void 0),dr([t.Property(!0)],i.prototype,"enableSorting",void 0),dr([t.Property("JSON")],i.prototype,"type",void 0),dr([t.Property(!0)],i.prototype,"allowMemberFilter",void 0),dr([t.Property(!1)],i.prototype,"allowLabelFilter",void 0),dr([t.Property(!1)],i.prototype,"allowValueFilter",void 0),dr([t.Property(!0)],i.prototype,"showSubTotals",void 0),dr([t.Property(!0)],i.prototype,"showRowSubTotals",void 0),dr([t.Property(!0)],i.prototype,"showColumnSubTotals",void 0),dr([t.Property(!0)],i.prototype,"showGrandTotals",void 0),dr([t.Property("Bottom")],i.prototype,"grandTotalsPosition",void 0),dr([t.Property(!0)],i.prototype,"showRowGrandTotals",void 0),dr([t.Property(!0)],i.prototype,"showColumnGrandTotals",void 0),dr([t.Property(!1)],i.prototype,"alwaysShowValueHeader",void 0),dr([t.Property(!0)],i.prototype,"showHeaderWhenEmpty",void 0),dr([t.Property(!0)],i.prototype,"showAggregationOnValueField",void 0),dr([t.Collection([],gr)],i.prototype,"formatSettings",void 0),dr([t.Collection([],vr)],i.prototype,"drilledMembers",void 0),dr([t.Complex({},Sr)],i.prototype,"valueSortSettings",void 0),dr([t.Collection([],fr)],i.prototype,"calculatedFieldSettings",void 0),dr([t.Collection([],ur)],i.prototype,"conditionalFormatSettings",void 0),dr([t.Property()],i.prototype,"emptyCellsTextContent",void 0),dr([t.Collection([],mr)],i.prototype,"groupSettings",void 0),dr([t.Complex({},yr)],i.prototype,"authentication",void 0),i}(t.ChildProperty),Cr=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function a(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),xr=function(e,t,i,a){var r,n=arguments.length,o=n<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},wr=(function(e){function i(){return null!==e&&e.apply(this,arguments)||this}Cr(i,e),xr([t.Property("Row")],i.prototype,"mode",void 0),xr([t.Property("Flow")],i.prototype,"cellSelectionMode",void 0),xr([t.Property("Single")],i.prototype,"type",void 0),xr([t.Property(!1)],i.prototype,"checkboxOnly",void 0),xr([t.Property(!1)],i.prototype,"persistSelection",void 0),xr([t.Property("Default")],i.prototype,"checkboxMode",void 0),xr([t.Property(!1)],i.prototype,"enableSimpleMultiRowSelection",void 0)}(t.ChildProperty),function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Cr(i,e),xr([t.Property("auto")],i.prototype,"height",void 0),xr([t.Property("auto")],i.prototype,"width",void 0),xr([t.Property("Both")],i.prototype,"gridLines",void 0),xr([t.Property(!1)],i.prototype,"allowTextWrap",void 0),xr([t.Property(!1)],i.prototype,"allowReordering",void 0),xr([t.Property(!0)],i.prototype,"allowResizing",void 0),xr([t.Property(!0)],i.prototype,"allowAutoResizing",void 0),xr([t.Property(null)],i.prototype,"rowHeight",void 0),xr([t.Property(110)],i.prototype,"columnWidth",void 0),xr([t.Property("Ellipsis")],i.prototype,"clipMode",void 0),xr([t.Property(!1)],i.prototype,"allowSelection",void 0),xr([t.Property(-1)],i.prototype,"selectedRowIndex",void 0),xr([t.Property({mode:"Row",cellSelectionMode:"Flow",type:"Single"})],i.prototype,"selectionSettings",void 0),xr([t.Property({wrapMode:"Both"})],i.prototype,"textWrapSettings",void 0),xr([t.Property("AllPages")],i.prototype,"printMode",void 0),xr([t.Property()],i.prototype,"contextMenuItems",void 0),xr([t.Event()],i.prototype,"beforeCopy",void 0),xr([t.Event()],i.prototype,"printComplete",void 0),xr([t.Event()],i.prototype,"beforePrint",void 0),xr([t.Event()],i.prototype,"beforePdfExport",void 0),xr([t.Event()],i.prototype,"beforeExcelExport",void 0),xr([t.Event()],i.prototype,"contextMenuOpen",void 0),xr([t.Event()],i.prototype,"contextMenuClick",void 0),xr([t.Event()],i.prototype,"queryCellInfo",void 0),xr([t.Event()],i.prototype,"headerCellInfo",void 0),xr([t.Event()],i.prototype,"rowSelecting",void 0),xr([t.Event()],i.prototype,"rowSelected",void 0),xr([t.Event()],i.prototype,"rowDeselecting",void 0),xr([t.Event()],i.prototype,"rowDeselected",void 0),xr([t.Event()],i.prototype,"cellSelecting",void 0),xr([t.Event()],i.prototype,"cellSelected",void 0),xr([t.Event()],i.prototype,"cellDeselecting",void 0),xr([t.Event()],i.prototype,"cellDeselected",void 0),xr([t.Event()],i.prototype,"resizeStart",void 0),xr([t.Event()],i.prototype,"resizing",void 0),xr([t.Event()],i.prototype,"resizeStop",void 0),xr([t.Event()],i.prototype,"pdfHeaderQueryCellInfo",void 0),xr([t.Event()],i.prototype,"pdfQueryCellInfo",void 0),xr([t.Event()],i.prototype,"excelHeaderQueryCellInfo",void 0),xr([t.Event()],i.prototype,"excelQueryCellInfo",void 0),xr([t.Event()],i.prototype,"columnDragStart",void 0),xr([t.Event()],i.prototype,"columnDrag",void 0),xr([t.Event()],i.prototype,"columnDrop",void 0),xr([t.Event()],i.prototype,"columnRender",void 0),i}(t.ChildProperty)),Tr=function(){function e(e){this.keyConfigs={tab:"tab",shiftTab:"shift+tab",enter:"enter",shiftUp:"shift+upArrow",shiftDown:"shift+downArrow",shiftLeft:"shift+leftArrow",shiftRight:"shift+rightArrow",shiftEnter:"shift+enter",ctrlEnter:"ctrl+enter",upArrow:"upArrow",downArrow:"downArrow",leftArrow:"leftArrow",rightArrow:"rightArrow",escape:"escape",ctrlShiftF:"ctrl+shift+f"},this.parent=e,this.event=void 0,this.parent.element.tabIndex=-1===this.parent.element.tabIndex?0:this.parent.element.tabIndex,this.pivotViewKeyboardModule=new t.KeyboardEvents(this.parent.element,{keyAction:this.keyActionHandler.bind(this),keyConfigs:this.keyConfigs,eventName:"keydown"})}return e.prototype.keyActionHandler=function(e){switch(e.action){case"tab":this.processTab(e);break;case"shiftTab":this.processShiftTab(e);break;case"enter":case"shiftEnter":case"ctrlEnter":this.processEnter(e);break;case"shiftUp":case"shiftDown":case"shiftLeft":case"shiftRight":case"upArrow":case"downArrow":case"leftArrow":case"rightArrow":this.processSelection(e);break;case"escape":this.clearSelection();break;case"ctrlShiftF":this.toggleFieldList(e)}},e.prototype.getNextButton=function(e){var i=this.allpivotButtons(e);if(t.removeClass(i,"e-btn-focused"),this.parent.grid.element.querySelector("."+_t))for(var a=i.length,r=0;r<a;r++)if(i[r].getAttribute("data-uid")===e.getAttribute("data-uid"))return i[r+1]?i[r+1]:e;return e},e.prototype.getPrevButton=function(e){var i=this.allpivotButtons(e);if(t.removeClass(i,"e-btn-focused"),this.parent.grid.element.querySelector("."+_t))for(var a=i.length,r=0;r<a;r++)if(i[r].getAttribute("data-uid")===e.getAttribute("data-uid"))return i[r-1]?i[r-1]:e;return e},e.prototype.allpivotButtons=function(e){var i=[];if(e&&this.parent.showGroupingBar){var a=t.closest(e,"."+Qa),r=t.closest(e,"."+Xa),n=t.closest(e,"."+Ga),o=e.classList.contains(qi),s=void 0,l=void 0,d=void 0;if(null!==a?l=a.classList.contains(Qa):null!==r?d=r.classList.contains(Xa):null!==n&&(s=n.classList.contains(Ga)),l||d||o){var h=[].slice.call(this.parent.element.querySelector("."+Qa).querySelectorAll("."+_t)),p=[].slice.call(this.parent.element.querySelector("."+Xa).querySelectorAll("."+_t));i=h.concat(p)}else s&&(i=[].slice.call(this.parent.element.querySelector("."+Ga).querySelectorAll("."+_t)))}return i},e.prototype.processTab=function(e){var i=e.target;if(i&&(t.closest(i,"."+_t)||i.classList.contains("e-group-row"))){if(this.parent.grid){var a=this.parent.grid.serviceLocator.getService("focus");if(i.classList.contains("e-group-row")&&i.querySelector(".e-btn-focused"))i=i.querySelector(".e-btn-focused");else if(i.classList.contains("e-group-row")){a.focus();var r=a.getFocusedElement();return t.addClass([r],["e-focused","e-focus"]),r.setAttribute("tabindex","0"),void e.preventDefault()}var n=this.getNextButton(i);if(n.getAttribute("data-uid")!==i.getAttribute("data-uid"))this.parent.element.querySelector(".e-focused")?(this.parent.element.querySelector(".e-focused").setAttribute("tabindex","-1"),t.removeClass(this.parent.element.querySelectorAll(".e-focus"),"e-focus"),t.removeClass(this.parent.element.querySelectorAll(".e-focused"),"e-focused"),a.setFocusedElement(this.parent.element.querySelector(".e-headercell")),this.parent.element.querySelector(".e-headercell").setAttribute("tabindex","0")):a.currentInfo.skipAction=!0,t.addClass([n],"e-btn-focused"),n.focus();else{a.focus();r=a.getFocusedElement();t.addClass([r],["e-focused","e-focus"]),r.setAttribute("tabindex","0")}return void e.preventDefault()}}else if(!this.parent.showGroupingBar&&this.parent.showFieldList&&i&&t.closest(i,"."+It)){if(this.parent.grid){(a=this.parent.grid.serviceLocator.getService("focus")).focus();r=a.getFocusedElement();return t.addClass([r],["e-focused","e-focus"]),r.setAttribute("tabindex","0"),void e.preventDefault()}}else if(this.parent.showGroupingBar||this.parent.showFieldList||!i||!t.closest(i,".e-pivotview")||t.closest(i,".e-popup.e-popup-open")){if(i&&t.closest(i,"."+ja)&&this.parent.toolbar&&this.parent.toolbarModule)clearTimeout(this.timeOutObj),this.timeOutObj=setTimeout(function(){t.removeClass(t.closest(i,"."+ja).querySelectorAll(".e-menu-item.e-focused"),"e-focused"),document.activeElement&&document.activeElement.classList.contains("e-menu-item")&&t.addClass([document.activeElement],"e-focused")});else if(i.classList.contains("e-numerictextbox")){(a=this.parent.grid.serviceLocator.getService("focus")).focus();r=a.getFocusedElement();t.removeClass([r],["e-focused","e-focus"]),r.setAttribute("tabindex","0"),e.preventDefault()}}else if(this.parent.grid){var o=t.closest(i,".e-pivotview"),a=this.parent.grid.serviceLocator.getService("focus"),s=[].slice.call(o.getElementsByTagName("tr"));if(i.innerHTML!==s[s.length-1].lastChild.innerHTML){a.focus();var r=a.getFocusedElement();return t.addClass([r],["e-focused","e-focus"]),r.setAttribute("tabindex","0"),void e.preventDefault()}a.currentInfo.skipAction=!0}},e.prototype.processShiftTab=function(e){var i=e.target;if(i&&(t.closest(i,"."+_t)||i.classList.contains("e-group-row"))){if(this.parent.grid){var a=this.parent.grid.serviceLocator.getService("focus");if(i.classList.contains("e-group-row")&&i.querySelector(".e-btn-focused"))i=i.querySelector(".e-btn-focused");else if(i.classList.contains("e-group-row")){i=this.parent.element.querySelector(".e-btn-focused")?this.parent.element.querySelector(".e-btn-focused"):this.parent.element.querySelector("."+Qa);var r=this.allpivotButtons(i);if(r.length>0&&r[r.length-1])return a.currentInfo.skipAction=!0,r[r.length-1].focus(),t.removeClass(r,"e-btn-focused"),t.addClass([r[r.length-1]],"e-btn-focused"),void e.preventDefault()}var n=this.getPrevButton(i);if(n.getAttribute("data-uid")!==i.getAttribute("data-uid"))return a.currentInfo.skipAction=!0,n.focus(),void e.preventDefault()}}else if(i&&this.parent.grid&&(i.classList.contains("e-movablefirst")||i.classList.contains("e-rowsheader")&&t.closest(i,"tr").getAttribute("data-uid")===this.parent.grid.element.querySelector(".e-frozencontent tr").getAttribute("data-uid"))){a=this.parent.grid.serviceLocator.getService("focus");if(i.classList.contains("e-movablefirst")){i=this.parent.element.querySelector("."+ci+" .e-btn-focused")?this.parent.element.querySelector("."+ci+" .e-btn-focused"):this.parent.element.querySelector("."+ci);var o=a.getFocusedElement();t.removeClass([o],["e-focused","e-focus"])}var s=this.allpivotButtons(i);if(s.length>0)return a.currentInfo.skipAction=!0,setTimeout(function(){s[s.length-1].focus()}),t.removeClass(s,"e-btn-focused"),t.addClass([s[s.length-1]],"e-btn-focused"),void e.preventDefault()}else if(i&&t.closest(i,"."+ja)&&this.parent.toolbar&&this.parent.toolbarModule)clearTimeout(this.timeOutObj),this.timeOutObj=setTimeout(function(){t.removeClass(t.closest(i,"."+ja).querySelectorAll(".e-menu-item.e-focused"),"e-focused"),document.activeElement&&document.activeElement.classList.contains("e-menu-item")&&t.addClass([document.activeElement],"e-focused")});else if(i.classList.contains("e-numerictextbox")){(a=this.parent.grid.serviceLocator.getService("focus")).focus();o=a.getFocusedElement();t.removeClass([o],["e-focused","e-focus"]),o.setAttribute("tabindex","0"),e.preventDefault()}},e.prototype.processEnter=function(e){var i=e.target;if(i&&t.closest(i,".e-grid")){var a=this.parent.grid.serviceLocator.getService("focus");if(13!==e.keyCode||e.shiftKey||e.ctrlKey)if(13===e.keyCode&&e.shiftKey&&!e.ctrlKey){if(this.parent.enableValueSorting){this.event=e,i.click(),a.focus();r=a.getFocusedElement();t.addClass([r],["e-focused","e-focus"]),r.setAttribute("tabindex","0")}}else 13===e.keyCode&&!e.shiftKey&&e.ctrlKey&&this.parent.hyperlinkSettings&&i.querySelector("a")&&i.querySelector("a").click();else if(i.querySelector("."+Ot)){this.event=e,i.querySelector("."+Ot).click(),a.focus();var r=a.getFocusedElement();t.addClass([r],["e-focused","e-focus"]),r.setAttribute("tabindex","0")}else if(i.classList.contains("e-valuescontent"))i.dispatchEvent(new MouseEvent("dblclick",{view:window,bubbles:!0,cancelable:!0})),i.querySelector(".e-numerictextbox")&&i.click();else if(i.classList.contains("e-numerictextbox")){a.focus();var r=a.getFocusedElement();t.removeClass([r],["e-focused","e-focus"])}e.preventDefault()}else;},e.prototype.clearSelection=function(){var e=this.parent;t.removeClass(e.element.querySelectorAll("."+Ta+",."+Ma),[Ma,Ta,Na]),this.parent.renderModule.selected()},e.prototype.processSelection=function(e){var i=e.target;if(this.parent.grid&&this.parent.gridSettings.allowSelection&&"Row"!==this.parent.gridSettings.selectionSettings.mode&&!i.classList.contains("e-numerictextbox")){var a,r=this.parent,n=Number(e.target.getAttribute("aria-colIndex")),o=Number(e.target.getAttribute("index"));if("TH"!==i.nodeName&&"TD"!==i.nodeName||(a="shiftUp"===e.action||"upArrow"===e.action?0===o||0===n||"TH"!==i.nodeName&&r.renderModule.rowStartPos!==o?null:this.getParentElement(r,a,n,o-1):"shiftDown"===e.action||"downArrow"===e.action?r.element.querySelector('th[aria-colindex="'+n+'"][index="'+(o+1)+'"]'):"shiftLeft"===e.action||"leftArrow"===e.action?e.target.previousSibling:e.target.nextSibling),t.isNullOrUndefined(a))"upArrow"===e.action?(a=r.element.querySelector('[aria-colindex="'+n+'"][index="'+(o-1)+'"]'),o--):"downArrow"===e.action&&(a=r.element.querySelector('[aria-colindex="'+n+'"][index="'+(o+1)+'"]'),o++),t.isNullOrUndefined(a)||r.clearSelection(a,e,n,o);else if("Both"===r.gridSettings.selectionSettings.mode&&a.classList.contains(Oa))r.clearSelection(a,e,n,o);else{n=Number(a.getAttribute("aria-colindex")),o=Number(a.getAttribute("index"));var s=Number(a.getAttribute("aria-colspan"));r.clearSelection(a,e,n,o);var l={cancel:!1,isCellClick:!0,currentCell:a,data:r.pivotValues[o][n]};r.trigger(E,l,function(t){t.cancel||r.applyColumnSelection(e,a,n,n+(s>0?s-1:0),o)})}}else if(i&&(37===e.keyCode||38===e.keyCode)&&this.parent&&this.parent.showGroupingBar&&this.parent.groupingBarModule&&!i.classList.contains("e-numerictextbox")){if(this.parent.grid&&this.parent.element.querySelector(".e-frozenheader")&&this.parent.element.querySelector(".e-frozenheader").querySelectorAll(".e-focus").length>0){t.removeClass(this.parent.element.querySelector(".e-frozenheader").querySelectorAll(".e-focus"),"e-focus"),t.removeClass(this.parent.element.querySelector(".e-frozenheader").querySelectorAll(".e-focused"),"e-focused"),this.parent.element.querySelector(".e-headercell").setAttribute("tabindex","-1");return this.parent.grid.serviceLocator.getService("focus").setFocusedElement(i),t.addClass([i],["e-focused","e-focus"]),i.setAttribute("tabindex","0"),i.focus(),void e.preventDefault()}}else!i.classList.contains("e-numerictextbox")||"rightArrow"!==e.action&&"leftArrow"!==e.action||i.click()},e.prototype.getParentElement=function(e,t,i,a){for(;!t;)t=e.element.querySelector('[aria-colindex="'+i+'"][index="'+a+'"]'),i--;return t},e.prototype.toggleFieldList=function(e){if(this.parent&&!this.parent.isDestroyed&&this.parent.showFieldList&&this.parent.pivotFieldListModule&&!this.parent.pivotFieldListModule.isDestroyed&&this.parent.element.querySelector("."+It)){if(!this.parent.element.querySelector("."+It).classList.contains(Et))return this.parent.element.querySelector("."+It).click(),void e.preventDefault();this.parent.element.querySelector("."+It).classList.contains(Et)&&this.parent.pivotFieldListModule.dialogRenderer&&this.parent.pivotFieldListModule.dialogRenderer.fieldListDialog&&!this.parent.pivotFieldListModule.dialogRenderer.fieldListDialog.isDestroyed&&this.parent.pivotFieldListModule.dialogRenderer.fieldListDialog.hide()}},e.prototype.destroy=function(){this.pivotViewKeyboardModule&&this.pivotViewKeyboardModule.destroy()},e}(),Mr=function(){function e(e){this.parent=e,this.parent.contextMenuModule=this}return e.prototype.render=function(){this.renderContextMenu()},e.prototype.renderContextMenu=function(){var e={cssClass:"e-pivot-context-menu",items:[{text:this.parent.localeObj.getConstant("addToFilter"),id:this.parent.element.id+"_Filters"},{text:this.parent.localeObj.getConstant("addToRow"),id:this.parent.element.id+"_Rows"},{text:this.parent.localeObj.getConstant("addToColumn"),id:this.parent.element.id+"_Columns"},{text:this.parent.localeObj.getConstant("addToValue"),id:this.parent.element.id+"_Values"}],enableRtl:this.parent.enableRtl,locale:this.parent.locale,beforeOpen:this.onBeforeMenuOpen.bind(this),select:this.onSelectContextMenu.bind(this)},i=t.createElement("ul",{id:this.parent.element.id+"_PivotContextMenu"});this.parent.element.appendChild(i),this.menuObj=new n.ContextMenu(e),this.menuObj.isStringTemplate=!0,this.menuObj.appendTo(i)},e.prototype.onBeforeMenuOpen=function(e){var i=[].slice.call(e.element.querySelectorAll("li")),a="olap"===this.parent.dataType?this.fieldElement.getAttribute("data-type"):this.fieldElement.querySelector(".e-content").getAttribute("data-type");if(t.removeClass(i,da),"CalculatedField"===a||"isMeasureFieldsAvail"===a)for(var r=0,n=i;r<n.length;r++){(h=n[r]).textContent!==this.parent.localeObj.getConstant("addToValue")&&t.addClass([h],da)}else if("isMeasureAvail"===a)for(var o=0,s=i;o<s.length;o++){(h=s[o]).textContent!==this.parent.localeObj.getConstant("addToRow")&&h.textContent!==this.parent.localeObj.getConstant("addToColumn")&&t.addClass([h],da)}else if("olap"===this.parent.dataType)for(var l=0,d=i;l<d.length;l++){var h;if((h=d[l]).textContent===this.parent.localeObj.getConstant("addToValue")){t.addClass([h],da);break}}},e.prototype.onSelectContextMenu=function(e){if(null!==e.element.textContent){var t=this.fieldElement.getAttribute("data-uid"),i=e.item.id.replace(this.parent.element.id+"_","").toLowerCase();this.parent.pivotCommon.dataSourceUpdate.control="pivotview"===this.parent.getModuleName()?this.parent:this.parent.pivotGridModule?this.parent.pivotGridModule:this.parent,this.parent.pivotCommon.dataSourceUpdate.btnElement=this.fieldElement,this.parent.pivotCommon.dataSourceUpdate.updateDataSource(t,i,-1),this.parent.updateDataSource(!0),this.fieldElement=void 0}},e.prototype.destroy=function(){this.parent.isDestroyed&&this.menuObj&&!this.menuObj.isDestroyed&&(this.menuObj.destroy(),t.select("#"+this.parent.element.id+"_PivotContextMenu",document)&&t.remove(t.select("#"+this.parent.element.id+"_PivotContextMenu",document)))},e}(),Dr=function(){function e(e){this.previousValues={top:0,left:0},this.frozenPreviousValues={top:0,left:0},this.eventType="",this.isFireFox=t.Browser.userAgent.toLowerCase().indexOf("firefox")>-1,this.parent=e,this.engineModule="pivot"===this.parent.dataType?this.parent.engineModule:this.parent.olapEngineModule,this.addInternalEvents()}return e.prototype.getModuleName=function(){return"virtualscroll"},e.prototype.addInternalEvents=function(){this.parent.on(re,this.wireEvents,this)},e.prototype.wireEvents=function(){if("Chart"!==this.parent.displayOption.view){var e=this.parent.element.querySelector("."+ba),i=this.parent.element.querySelector("."+xa),a=this.parent.element.querySelector("."+wa),r=e.parentElement.parentElement.querySelector("."+Ca);if(t.EventHandler.clearEvents(e),t.EventHandler.clearEvents(i),this.isFireFox&&t.EventHandler.clearEvents(a),this.engineModule){var n=this.parent.isAdaptive?e:e.parentElement.parentElement.querySelector("."+Ca);t.EventHandler.add(n,"scroll touchmove pointermove",this.onHorizondalScroll(a,e,i),this),t.EventHandler.add(e.parentElement,"scroll wheel touchmove pointermove keyup keydown",this.onVerticalScroll(i,e),this),t.EventHandler.add(e,"mouseup touchend scroll",this.common(a,e,i),this),t.EventHandler.add(r,"scroll",this.onCustomScrollbarScroll(e,a),this),t.EventHandler.add(e,"scroll",this.onCustomScrollbarScroll(r,a),this),t.EventHandler.add(a,"scroll",this.onCustomScrollbarScroll(r,e),this),t.EventHandler.add(a,"touchstart pointerdown",this.setPageXY(),this),t.EventHandler.add(a,"touchmove pointermove",this.onTouchScroll(a,e,i),this),t.EventHandler.add(e,"touchstart pointerdown",this.setPageXY(),this),t.EventHandler.add(e,"touchmove pointermove",this.onTouchScroll(a,e,i),this)}this.parent.grid.on("check-scroll-reset",function(e){e.cancel=!0}),this.parent.grid.on("prevent-frozen-scroll-refresh",function(e){e.cancel=!0}),this.parent.grid.isPreventScrollEvent=!0}},e.prototype.onWheelScroll=function(e,t){var i=this,a=e;return function(e){var t=a.parentElement.scrollTop+(1===e.deltaMode?30*e.deltaY:e.deltaY);i.frozenPreviousValues.top!==t&&(e.preventDefault(),i.frozenPreviousValues.top=t,i.eventType=e.type)}},e.prototype.getPointXY=function(e){var t={x:0,y:0};return e.touches&&e.touches.length?(t.x=e.touches[0].pageX,t.y=e.touches[0].pageY):(t.x=e.pageX,t.y=e.pageY),t},e.prototype.onCustomScrollbarScroll=function(e,t){var i=this,a=e,r=t;return function(e){if(null!==i.parent.element.querySelector("."+ba).parentElement.querySelector("tbody")){var t=e.target,n=t.scrollLeft;i.previousValues.left===n||i.isFireFox&&t.classList.contains(wa)||(a.scrollLeft=n,r.scrollLeft=n,i.previousValues.left=n,i.parent.isDestroyed)}}},e.prototype.onTouchScroll=function(e,t,i){var a=this,r=t;return function(i){if("mouse"!==i.pointerType){var n=a.getPointXY(i),o=r.parentElement.scrollTop+(a.pageXY.y-n.y),s=a.parent.isAdaptive?t:r.parentElement.parentElement.querySelector("."+Ca),l=s.scrollLeft+(a.pageXY.x-n.x);a.frozenPreviousValues.left===l||l<0||(e.scrollLeft=l,s.scrollLeft=l,a.pageXY.x=n.x,a.frozenPreviousValues.left=l,a.frozenPreviousValues.top===o||o<0||(a.pageXY.y=n.y,a.frozenPreviousValues.top=o,a.eventType=i.type))}}},e.prototype.update=function(e,t,i,a,r){this.parent.isScrolling=!0;var n="pivot"===this.parent.dataType?this.parent.engineModule:this.parent.olapEngineModule;if(this.parent.pageSettings&&n.pageSettings)if("vertical"===this.direction){var o="pivot"===this.parent.dataType&&"row"===this.parent.dataSourceSettings.valueAxis?this.parent.dataSourceSettings.values.length:1,s=this.parent.pageSettings.rowSize*o*this.parent.gridSettings.rowHeight,l=Math.ceil(i/s);if(this.parent.scrollPosObject.vertical===l||n.pageSettings.rowSize>=n.rowCount)return;this.parent.showWaitingPopup(),this.parent.scrollPosObject.vertical=l,n.pageSettings.rowCurrentPage=l>1?l:1;var d=0;"pivot"===this.parent.dataType?"Server"===this.parent.dataSourceSettings.mode?this.parent.getEngine("onScroll",null,null,null,null,null,null):(this.parent.engineModule.generateGridData(this.parent.dataSourceSettings,!0,this.parent.engineModule.headerCollection),d=this.parent.engineModule.rowStartPos):(this.parent.olapEngineModule.scrollPage("scroll"),d=this.parent.olapEngineModule.pageRowStartPos),this.parent.pivotValues=n.pivotValues;var h=s*Math.ceil(d/(this.parent.pageSettings.rowSize*o))-n.rowFirstLvl*o*this.parent.gridSettings.rowHeight;this.parent.scrollPosObject.verticalSection=h}else{var p="pivot"===this.parent.dataType&&"column"===this.parent.dataSourceSettings.valueAxis?this.parent.dataSourceSettings.values.length:1;s=this.parent.pageSettings.columnSize*p*this.parent.gridSettings.columnWidth,l=Math.ceil(a/s);if(this.parent.scrollPosObject.horizontal===l)return;this.parent.showWaitingPopup();var u=this.parent;u.scrollPosObject.horizontal=l,n.pageSettings.columnCurrentPage=l>1?l:1;var c=0;"pivot"===u.dataType?"Server"===this.parent.dataSourceSettings.mode?this.parent.getEngine("onScroll",null,null,null,null,null,null):(u.engineModule.generateGridData(u.dataSourceSettings,!0,u.engineModule.headerCollection),c=u.engineModule.colStartPos):(u.olapEngineModule.scrollPage("scroll"),c=u.olapEngineModule.pageColStartPos),u.pivotValues=n.pivotValues;h=s*Math.ceil(c/(u.pageSettings.columnSize*p))-n.colFirstLvl*p*u.gridSettings.columnWidth;u.scrollPosObject.horizontalSection=h}},e.prototype.setPageXY=function(){var e=this;return function(t){"mouse"!==t.pointerType&&(e.pageXY=e.getPointXY(t))}},e.prototype.common=function(e,t,i){var a=this;return function(i){var r=a.parent.isAdaptive?t:t.parentElement.parentElement.querySelector("."+Ca);a.update(e,t,t.parentElement.scrollTop*a.parent.verticalScrollScale,r.scrollLeft*a.parent.horizontalScrollScale,i)}},e.prototype.onHorizondalScroll=function(e,i,a){var r,n=this;return function(a){var o=n.parent.isAdaptive?i:i.parentElement.parentElement.querySelector("."+Ca),s=o.scrollLeft*n.parent.horizontalScrollScale;if("wheel"!==a.type&&"touchmove"!==a.type&&"wheel"!==n.eventType&&"touchmove"!==n.eventType||(clearTimeout(r),r=setTimeout(function(){s="touchmove"===a.type?o.scrollLeft:s,n.update(e,i,i.parentElement.scrollTop*n.parent.verticalScrollScale,s,a)},300)),n.previousValues.left!==s){n.parent.scrollDirection=n.direction="horizondal";var l=-(s-n.parent.scrollPosObject.horizontalSection-o.scrollLeft),d=i.querySelector("."+ji).style.transform.split(",").length>1?i.querySelector("."+ji).style.transform.split(",")[1].trim():"0px)";o.scrollLeft<n.parent.scrollerBrowserLimit&&(t.setStyleAttribute(i.querySelector(".e-table"),{transform:"translate("+l+"px,"+d}),t.setStyleAttribute(e.querySelector(".e-table"),{transform:"translate("+l+"px,0px)"}));var h=n.parent.scrollPosObject.horizontalSection>s?-(n.parent.scrollPosObject.horizontalSection-s):s+e.offsetWidth-(n.parent.scrollPosObject.horizontalSection+i.querySelector(".e-table").offsetWidth),p=Math.ceil(n.parent.scrollPosObject.horizontalSection/n.parent.horizontalScrollScale)<n.parent.scrollerBrowserLimit;if(n.parent.scrollPosObject.horizontalSection>s||h>1&&p){s>e.clientWidth?(n.parent.scrollPosObject.left<1&&(n.parent.scrollPosObject.left=e.clientWidth),n.parent.scrollPosObject.left=n.parent.scrollPosObject.left-50,h=n.parent.scrollPosObject.horizontalSection>s?h-n.parent.scrollPosObject.left:h+n.parent.scrollPosObject.left):h=-n.parent.scrollPosObject.horizontalSection,l=-(s-(n.parent.scrollPosObject.horizontalSection+h)-i.parentElement.parentElement.querySelector("."+Ca).scrollLeft);var u=n.parent.gridSettings.columnWidth*n.engineModule.columnCount;u>n.parent.scrollerBrowserLimit&&(n.parent.horizontalScrollScale=u/n.parent.scrollerBrowserLimit,u=n.parent.scrollerBrowserLimit),l>u&&l>s&&(l=s,h=0),t.setStyleAttribute(i.querySelector(".e-table"),{transform:"translate("+l+"px,"+d}),t.setStyleAttribute(e.querySelector(".e-table"),{transform:"translate("+l+"px,0px)"}),n.parent.scrollPosObject.horizontalSection=n.parent.scrollPosObject.horizontalSection+h}var c=o.scrollWidth-(o.scrollLeft+o.offsetWidth);if(c<=0){var g=i.querySelector("."+ya);g.style.display="none";var m=i.scrollWidth-(i.scrollLeft+i.offsetWidth);g.style.display="";var f=i.scrollWidth-(i.scrollLeft+i.offsetWidth);n.parent.scrollPosObject.horizontalSection-=m>c?m:-f,l=o.scrollLeft>n.parent.scrollerBrowserLimit?Number(i.querySelector("."+ji).style.transform.split(",")[0].split("px")[0].trim()):-(o.scrollLeft*n.parent.horizontalScrollScale-n.parent.scrollPosObject.horizontalSection-o.scrollLeft),t.setStyleAttribute(i.querySelector(".e-table"),{transform:"translate("+l+"px,"+d}),t.setStyleAttribute(e.querySelector(".e-table"),{transform:"translate("+l+"px,0px)"})}n.previousValues.left=s,n.frozenPreviousValues.left=s,n.eventType="",e.scrollLeft=o.scrollLeft}}},e.prototype.onVerticalScroll=function(e,i){var a,r=this;return function(n){var o=i.parentElement.scrollTop*r.parent.verticalScrollScale;if("wheel"===n.type||"touchmove"===n.type||"wheel"===r.eventType||"touchmove"===r.eventType||"keyup"===n.type||"keydown"===n.type){var s=r.parent.isAdaptive?i:i.parentElement.parentElement.querySelector("."+Ca);clearTimeout(a),a=setTimeout(function(){r.update(null,i,i.parentElement.scrollTop*r.parent.verticalScrollScale,s.scrollLeft*r.parent.horizontalScrollScale,n)},300)}if(r.previousValues.top!==o){r.parent.scrollDirection=r.direction="vertical";var l=-(o-r.parent.scrollPosObject.verticalSection-i.parentElement.scrollTop),d=i.querySelector("."+ji).style.transform.split(",")[0].trim();l>r.parent.virtualDiv.clientHeight&&(l=r.parent.virtualDiv.clientHeight),i.parentElement.scrollTop<r.parent.scrollerBrowserLimit&&(t.setStyleAttribute(e.querySelector(".e-table"),{transform:"translate(0px,"+l+"px)"}),t.setStyleAttribute(i.querySelector(".e-table"),{transform:d+","+l+"px)"}));var h=r.parent.scrollPosObject.verticalSection>o?-(r.parent.scrollPosObject.verticalSection-o):o+e.parentElement.clientHeight-(r.parent.scrollPosObject.verticalSection+e.querySelector(".e-table").offsetHeight),p=Math.ceil(r.parent.scrollPosObject.verticalSection/r.parent.verticalScrollScale)<r.parent.scrollerBrowserLimit;if(r.parent.scrollPosObject.verticalSection>o||h>1&&p){o>e.parentElement.clientHeight?(r.parent.scrollPosObject.top<1&&(r.parent.scrollPosObject.top=e.parentElement.clientHeight),r.parent.scrollPosObject.top=r.parent.scrollPosObject.top-50,h=r.parent.scrollPosObject.verticalSection>o?h-r.parent.scrollPosObject.top:h+r.parent.scrollPosObject.top):h=-r.parent.scrollPosObject.verticalSection;var u=r.parent.element.querySelector("."+ba).querySelector(".e-table");l=-(o-(r.parent.scrollPosObject.verticalSection+h)-i.parentElement.scrollTop);var c=r.parent.gridSettings.rowHeight*r.engineModule.rowCount+.1-u.clientHeight;c>r.parent.scrollerBrowserLimit&&(r.parent.verticalScrollScale=c/r.parent.scrollerBrowserLimit,c=r.parent.scrollerBrowserLimit),l>c&&l>o&&(l=o,h=0),l>r.parent.virtualDiv.clientHeight&&(l=r.parent.virtualDiv.clientHeight),t.setStyleAttribute(e.querySelector(".e-table"),{transform:"translate(0px,"+l+"px)"}),t.setStyleAttribute(i.querySelector(".e-table"),{transform:d+","+l+"px)"}),r.parent.scrollPosObject.verticalSection=r.parent.scrollPosObject.verticalSection+h}r.previousValues.top=o,r.frozenPreviousValues.top=o,r.eventType=""}}},e.prototype.removeInternalEvents=function(){this.parent.isDestroyed||this.parent.off(re,this.wireEvents)},e.prototype.destroy=function(){this.removeInternalEvents()},e}(),Or=function(){function e(e){this.indexString=[],this.clonedData=[],this.isUpdated=!1,this.gridIndexObjects={},this.gridData=[],this.formatList={},this.drillKeyConfigs={escape:"escape"},this.parent=e,this.engine="olap"===this.parent.dataType?this.parent.olapEngineModule:this.parent.engineModule}return e.prototype.frameHeaderWithKeys=function(e){for(var t=Object.keys(e),i=0,a={};i<t.length;)a[t[i]]=e[t[i]],i++;return a},e.prototype.showDrillThroughDialog=function(e){var i=this;this.gridData=e.rawData;for(var r=0;r<e.rawData.length;r++)this.clonedData.push(this.frameHeaderWithKeys(e.rawData[r]));var n=e.currentCell.actualText.toString();try{if("Table"===this.parent.currentView&&"Count"!==this.engine.fieldList[n].aggregateType&&this.parent.editSettings.allowInlineEditing&&this.parent.editSettings.allowEditing&&1===e.rawData.length&&"DistinctCount"!==this.engine.fieldList[n].aggregateType&&"string"!=typeof e.rawData[0][n]){if(this.parent.actionObj.actionName=Qe,this.parent.actionBeginMethod())return;this.editCell(e)}else{this.removeDrillThroughDialog();var o=t.createElement("div",{id:this.parent.element.id+"_drillthrough",className:"e-drillthrough-dialog"});this.parent.element.appendChild(o),this.dialogPopUp=new a.Dialog({animationSettings:{effect:"Fade"},allowDragging:!1,header:this.parent.localeObj.getConstant("details"),content:this.createDrillThroughGrid(e),beforeOpen:function(){i.drillThroughGrid.setProperties({dataSource:i.parent.editSettings.allowEditing?i.dataWithPrimarykey(e):i.gridData,height:i.parent.editSettings.allowEditing?220:300},!1)},beforeClose:function(){if(i.parent.editSettings.allowEditing&&i.isUpdated){"CSV"===i.parent.dataSourceSettings.type&&i.updateData(i.drillThroughGrid.dataSource);for(var e=[],a=0,r=Object.keys(i.gridIndexObjects);a<r.length;a++){var n=r[a];e.push(i.gridIndexObjects[n])}for(var o=Object.keys(i.gridIndexObjects).length,s=[],l=[],d=0,h=0,p=i.drillThroughGrid.dataSource;h<p.length;h++){var u=p[h];if(t.isNullOrUndefined(u.__index)||""===u.__index){for(var c=0,g=i.engine.fields;c<g.length;c++){var m=g[c];t.isNullOrUndefined(u[m])&&delete u[m]}delete u.__index,s.push(u)}else o>0&&(delete i.gridIndexObjects[u.__index.toString()],l.push(u),o--);"Server"===i.parent.dataSourceSettings.mode&&(u.__index&&delete u.__index,i.gridData[d].__index&&delete i.gridData[d].__index),d++}if(o=0,"Server"===i.parent.dataSourceSettings.mode){for(var f=[],v=Object.keys(i.gridIndexObjects),S=0;S<v.length;S++)delete i.parent.drillThroughValue.indexObject[i.gridIndexObjects[v[S]]],f.push({Key:v[S],Value:i.gridIndexObjects[v[S]]});var y=[];v=Object.keys(i.parent.drillThroughValue.indexObject);for(S=0;S<v.length;S++)y.push({Key:v[S],Value:i.parent.drillThroughValue.indexObject[v[S]]});i.parent.getEngine("updateRawData",null,null,null,null,null,null,null,{addedData:s,removedData:f,updatedData:l,indexObject:y})}else{for(var b=[],C=0,x=i.parent.allowDataCompression&&i.parent.enableVirtualization?i.parent.engineModule.actualData:i.parent.engineModule.data;C<x.length;C++){delete(u=x[C]).__index,void 0===i.gridIndexObjects[o.toString()]&&b.push(u),o++}b=b.concat(s);var w={currentData:i.drillThroughGrid.dataSource,previousData:i.clonedData,previousPosition:e,cancel:!1};i.parent.trigger(F,w),w.cancel||(i.parent.setProperties({dataSourceSettings:{dataSource:b}},!0),i.engine.updateGridData(i.parent.dataSourceSettings),i.parent.pivotValues=i.engine.pivotValues)}i.parent.actionObj.actionName="Records updated";var T={editInfo:{type:i.drillThroughGrid.editSettings.mode,action:"Update",currentData:i.drillThroughGrid.dataSource,previousData:i.clonedData,previousPosition:e}};i.parent.actionObj.actionInfo=T}i.isUpdated=!1,i.gridIndexObjects={}},isModal:!0,visible:!0,showCloseIcon:!0,locale:this.parent.locale,enableRtl:this.parent.enableRtl,width:this.parent.isAdaptive?"100%":"60%",position:{X:"center",Y:"center"},closeOnEscape:!this.parent.editSettings.allowEditing,target:document.body,close:this.removeDrillThroughDialog.bind(this)}),this.dialogPopUp.isStringTemplate=!0,this.dialogPopUp.appendTo(o),t.setStyleAttribute(this.dialogPopUp.element,{visibility:"visible"}),this.parent.editSettings.allowEditing&&(this.drillthroughKeyboardModule=new t.KeyboardEvents(this.dialogPopUp.element,{keyAction:this.drillthroughKeyActionHandler.bind(this),keyConfigs:this.drillKeyConfigs,eventName:"keydown"}))}}catch(e){this.parent.actionFailureMethod(e)}},e.prototype.editCell=function(e){var i=this,a=this.parent.gridSettings.allowResizing,r=e.currentCell.actualText.toString(),n=Number(Object.keys(e.currentCell.indexObject));e.currentTarget.firstElementChild.style.display="none";var s=Number(e.rawData[0][r]),l=this.frameHeaderWithKeys(e.rawData[e.rawData.length-1]),d=e.rawData[e.rawData.length-1];e.currentCell.actualText in l&&(d[e.currentCell.actualText]=e.currentCell.actualValue);var h={editInfo:{type:"Inline editing",action:"update",data:this.gridData}};this.parent.actionObj.actionInfo=h,this.numericTextBox=new o.NumericTextBox({value:s,enableRtl:this.parent.enableRtl,enabled:!0,format:"####.##",locale:this.parent.locale,change:function(){var t=i.numericTextBox.value,a=e.currentCell.indexObject[n];e.rawData[0][r]=t,i.parent.engineModule.data[a]=e.rawData[0]},blur:function(){var e={currentData:d,previousData:l,previousPosition:d.index,cancel:!1};i.parent.trigger(F,e),e.cancel||(i.parent.setProperties({dataSourceSettings:{dataSource:i.parent.engineModule.data}},!0),i.engine.updateGridData(i.parent.dataSourceSettings),i.parent.pivotValues=i.engine.pivotValues,i.parent.gridSettings.allowResizing=a)}});var p=t.createElement("input",{id:this.parent.element.id+"_inputbox"});e.currentTarget.appendChild(p),this.numericTextBox.appendTo(p),e.currentCell.value=this.numericTextBox.value,this.numericTextBox.focusIn(),this.parent.gridSettings.allowResizing=!1},e.prototype.updateData=function(e){for(var i=0,a=this.parent.allowDataCompression&&this.parent.enableVirtualization?this.parent.engineModule.actualData:this.parent.engineModule.data;i<e.length;){for(var r=Object.keys(e[i]),n=0,o=[];n<r.length;)t.isNullOrUndefined(this.parent.engineModule.fieldKeys[r[n]])||(o[this.parent.engineModule.fieldKeys[r[n]]]=e[i][r[n]]),n++;a[e[i].__index]=o,i++}this.parent.allowDataCompression&&this.parent.enableVirtualization?this.parent.engineModule.actualData=a:this.parent.engineModule.data=a},e.prototype.removeDrillThroughDialog=function(){this.dialogPopUp&&!this.dialogPopUp.isDestroyed&&(this.parent.actionObj.actionName=wt,this.parent.actionObj.actionName&&this.parent.actionCompleteMethod(),this.dialogPopUp.destroy());var e=document.getElementById(this.parent.element.id+"_drillthrough");e&&t.remove(e),document.getElementById(this.parent.element.id+"_drillthroughgrid_ccdlg")&&t.remove(document.getElementById(this.parent.element.id+"_drillthroughgrid_ccdlg"))},e.prototype.createDrillThroughGrid=function(e){var i=this,a=t.createElement("div",{id:this.parent.element.id+"_drillthroughbody",className:"e-drillthrough-body"}),n=t.createElement("div",{id:this.parent.element.id+"_drillthroughbodyheader",className:"e-drillthrough-body-header-container"});if(""!==e.rowHeaders&&(n.innerHTML="<span class="+ti+"><span class="+ei+">"+this.parent.localeObj.getConstant("row")+"</span> :<span class="+ii+">"+e.rowHeaders+"</span></span>"),""!==e.columnHeaders&&(n.innerHTML=n.innerHTML+"<span class="+ti+"><span class="+ei+">"+this.parent.localeObj.getConstant("column")+"</span> :<span class="+ii+">"+e.columnHeaders+"</span></span>"),""!==e.value){var o=e.value.split("(")[0],s=e.value.split("(")[1].split(")")[0];"0"!==s&&(n.innerHTML=n.innerHTML+"<span class="+ti+"><span class="+ei+">"+o+"</span> :<span class="+ii+">"+s+"</span></span>")}var l=["ColumnChooser"];this.parent.editSettings.allowEditing&&(l=this.parent.editSettings.allowCommandColumns?["ColumnChooser","Add"]:"Batch"===this.parent.editSettings.mode?["ColumnChooser","Add","Delete","Update","Cancel"]:"Dialog"===this.parent.editSettings.mode?["ColumnChooser","Add","Edit","Delete"]:["ColumnChooser","Add","Edit","Delete","Update","Cancel"]);var d=t.createElement("div",{id:this.parent.element.id+"_drillthroughgrid",className:"e-drillthrough-grid"});r.Grid.Inject(r.Selection,r.Reorder,r.Resize,r.Toolbar,r.ColumnChooser),this.drillThroughGrid=new r.Grid({gridLines:"Default",allowResizing:!0,allowReordering:!0,showColumnChooser:!0,enableHover:!1,toolbar:l,columns:e.gridColumns,locale:this.parent.locale,enableRtl:this.parent.enableRtl,enableVirtualization:!this.parent.editSettings.allowEditing,allowPaging:this.parent.editSettings.allowEditing,pageSettings:{pageSize:20},rowHeight:this.parent.gridSettings.rowHeight}),"olap"===this.parent.dataType&&this.formatData();var h=this;if(this.parent.trigger(P,{cellInfo:e,gridObj:this.drillThroughGrid,type:"editing"}),this.drillThroughGrid.allowExcelExport&&r.Grid.Inject(r.ExcelExport),this.drillThroughGrid.allowPdfExport&&r.Grid.Inject(r.PdfExport),this.parent.editSettings.allowEditing){r.Grid.Inject(r.Edit,r.Page);try{this.drillThroughGrid.editSettings=this.parent.editSettings,this.drillThroughGrid.actionBegin=function(e){var t="save"==e.requestType?Ye:"add"==e.requestType?Ke:"delete"==e.requestType?Xe:"";i.parent.actionObj.actionName=t,!i.parent.actionObj.actionName||i.parent.actionBeginMethod()},this.parent.editSettings.allowCommandColumns?(this.drillThroughGrid.editSettings.mode="Normal",this.drillThroughGrid.editSettings.allowEditOnDblClick=!1,r.Grid.Inject(r.CommandColumn),this.drillThroughGrid.columns.push({headerText:this.parent.localeObj.getConstant("manageRecords"),width:160,showInColumnChooser:!1,commands:[{type:"Edit",buttonOption:{iconCss:" e-icons e-edit",cssClass:"e-flat"}},{type:"Delete",buttonOption:{iconCss:"e-icons e-delete",cssClass:"e-flat"}},{type:"Save",buttonOption:{iconCss:"e-icons e-update",cssClass:"e-flat"}},{type:"Cancel",buttonOption:{iconCss:"e-icons e-cancel-icon",cssClass:"e-flat"}}]})):this.drillThroughGrid.editSettings.allowEditOnDblClick=this.parent.editSettings.allowEditOnDblClick,this.drillThroughGrid.columns.push({field:"__index",visible:!1,isPrimaryKey:!0,type:"string",showInColumnChooser:!1})}catch(e){this.parent.actionFailureMethod(e)}this.drillThroughGrid.actionComplete=function(e){"batchsave"!==e.requestType&&"save"!==e.requestType&&"delete"!==e.requestType||(h.isUpdated=!0),i.parent.actionObj.actionName=i.parent.getActionCompleteName();var t={editInfo:{type:i.drillThroughGrid.editSettings.mode,action:e.requestType,data:i.gridData}};i.parent.actionObj.actionInfo=t,i.parent.actionObj.actionName&&i.parent.actionCompleteMethod(),("Normal"===h.drillThroughGrid.editSettings.mode&&"save"===e.requestType&&h.drillThroughGrid.element.querySelectorAll(".e-tbar-btn:hover").length>0&&!h.parent.editSettings.allowCommandColumns||"batchsave"===e.requestType)&&h.dialogPopUp.hide()},this.drillThroughGrid.beforeBatchSave=function(){h.isUpdated=!0}}else r.Grid.Inject(r.VirtualScroll);return document.body.appendChild(d),this.drillThroughGrid.isStringTemplate=!0,this.drillThroughGrid.appendTo(d),a.appendChild(n),a.appendChild(d),a},e.prototype.frameGridColumns=function(e){var i="olap"===this.parent.dataType?e[0]?Object.keys(e[0]):[]:Object.keys(this.engine.fieldList),a=[];if(this.parent.dataSourceSettings.formatSettings.length>0)for(var r=0;r<this.parent.dataSourceSettings.formatSettings.length;r++)this.formatList[this.parent.dataSourceSettings.formatSettings[r].name]=this.parent.dataSourceSettings.formatSettings[r].format;if("olap"===this.parent.dataType)for(var n=0,o=i;n<o.length;n++){var s=o[n];a.push({field:s.replace(/_x005B_|_x0020_|_x005D_|_x0024_/g,"").replace("].[","").split(".").reverse().join(""),headerText:s.replace(/_x005B_|_x005D_|_x0024_/g,"").replace(/_x0020_/g," ").replace("].[","").split(".").reverse().join("."),width:120,visible:!0,validationRules:{required:!0},format:t.isNullOrUndefined(this.formatList[s])?null:this.formatList[s],type:t.isNullOrUndefined(this.formatList[s])?"string":null})}else for(var l=0,d=i;l<d.length;l++){s=d[l];if("CalculatedField"!==this.engine.fieldList[s].aggregateType){var h="",p=!("date"!==this.engine.fieldList[s].type&&"datetime"!==this.engine.fieldList[s].type||!(this.isDateFieldExist(s)||e[0]&&e[0][s]&&-1===e[0][s].toString().indexOf(" ")));h="number"===this.engine.fieldList[s].type?"numericedit":"date"===this.engine.fieldList[s].type&&p?"datepickeredit":"datetime"===this.engine.fieldList[s].type&&p?"datetimepickeredit":"defaultedit",a.push({field:s,headerText:this.engine.fieldList[s].caption,width:120,visible:this.engine.fieldList[s].isSelected,validationRules:{required:!0},editType:h,format:t.isNullOrUndefined(this.formatList[s])?void 0:this.formatList[s],type:t.isNullOrUndefined(this.formatList[s])?"string":null})}}return a},e.prototype.isDateFieldExist=function(e){for(var t=0;t<this.parent.dataSourceSettings.formatSettings.length;t++)if(this.parent.dataSourceSettings.formatSettings[t].name===e&&this.parent.dataSourceSettings.formatSettings[t].type.indexOf("date")>-1)return!0;for(t=0;t<this.parent.dataSourceSettings.fieldMapping.length;t++)if(this.parent.dataSourceSettings.fieldMapping[t].name===e&&this.parent.dataSourceSettings.fieldMapping[t].dataType.indexOf("date")>-1)return!0;return!1},e.prototype.formatData=function(){for(var e=0;e<this.gridData.length;){for(var t=this.gridData[e],i=Object.keys(this.gridData[e]),a={},r=0;r<i.length;){a[i[r].replace(/_x005B_|_x0020_|_x005D_|_x0024_/g,"").replace("].[","").split(".").reverse().join("")]=t[i[r]],r++}this.gridData[e]=a,e++}},e.prototype.dataWithPrimarykey=function(e){for(var t=this.indexString.length>0?this.indexString:Object.keys(e.currentCell.indexObject),i=this.gridData,a=0,r=0,n=i;r<n.length;r++){n[r].__index=t[a],this.gridIndexObjects[t[a].toString()]=Number(t[a]),a++}return i},e.prototype.drillthroughKeyActionHandler=function(e){switch(e.action){case"escape":this.processClose(e)}},e.prototype.processClose=function(e){var i=e.target;if(i&&t.closest(i,".e-popup.e-popup-open")){var a=t.closest(i,".e-popup.e-popup-open").ej2_instances[0];if(a&&!a.closeOnEscape){var r=a.element.getAttribute("data-fieldName");if(a.hide(),this.parent.element)for(var n=0,o=[].slice.call(this.parent.element.querySelectorAll(".e-pivot-button"));n<o.length;n++){var s=o[n];if(s.getAttribute("data-uid")===r){s.focus();break}}return void e.preventDefault()}}},e.prototype.destroy=function(){this.parent.isDestroyed||this.drillthroughKeyboardModule&&!this.drillthroughKeyboardModule.isDestroyed&&(this.drillthroughKeyboardModule.destroy(),this.drillthroughKeyboardModule=null)},e}(),Nr=function(){function e(e){this.parent=e,this.drillThroughDialog=new Or(this.parent),this.addInternalEvents()}return e.prototype.getModuleName=function(){return"drillThrough"},e.prototype.addInternalEvents=function(){this.parent.on(re,this.wireEvents,this)},e.prototype.wireEvents=function(){this.unWireEvents(),t.EventHandler.add(this.parent.element,"dblclick",this.mouseClickHandler,this)},e.prototype.unWireEvents=function(){this.parent.isDestroyed||t.EventHandler.remove(this.parent.element,"dblclick",this.mouseClickHandler)},e.prototype.mouseClickHandler=function(e){var t=e.target,i=null;if(t.classList.contains("e-stackedheadercelldiv")||t.classList.contains("e-cellvalue")||t.classList.contains("e-headercelldiv")?i=t.parentElement:t.classList.contains("e-headercell")||t.classList.contains("e-rowcell")?i=t:t.classList.contains("e-headertext")&&(i=t.parentElement.parentElement),i&&(this.parent.allowDrillThrough&&i.classList.contains("e-valuescontent")||this.parent.editSettings.allowEditing)){var a=Number(i.getAttribute("aria-colindex")),r=Number(i.getAttribute("index"));this.executeDrillThrough(this.parent.pivotValues[r][a],r,a,i)}},e.prototype.executeDrillThrough=function(e,i,a,r){this.parent.drillThroughElement=r,this.parent.drillThroughValue=e;var n="olap"===this.parent.dataType?this.parent.olapEngineModule:this.parent.engineModule,o="",s="",l=[];if(void 0!==e.rowHeaders&&void 0!==e.columnHeaders&&!t.isNullOrUndefined(e.value)){if("olap"===this.parent.dataType){var d=void 0,h=(d="row"===this.parent.dataSourceSettings.valueAxis?n.tupRowInfo[e.rowOrdinal]:n.tupColumnInfo[e.colOrdinal])?n.getUniqueName(d.measureName):e.actualText;if(n.fieldList[h]&&n.fieldList[h].isCalculatedField)return void this.parent.pivotCommon.errorDialog.createErrorDialog(this.parent.localeObj.getConstant("error"),this.parent.localeObj.getConstant("drillError"));o=n.fieldList[h||e.actualText].caption,s=n.fieldList[h||e.actualText].aggregateType,this.parent.olapEngineModule.getDrillThroughData(e,this.parent.maxRowsInDrillThrough);try{l=JSON.parse(n.gridJSON)}catch(e){return void this.parent.pivotCommon.errorDialog.createErrorDialog(this.parent.localeObj.getConstant("error"),n.gridJSON)}}else if(o=n.fieldList[e.actualText.toString()]?n.fieldList[e.actualText.toString()].caption:e.actualText.toString(),s=n.fieldList[e.actualText]?n.fieldList[e.actualText].aggregateType:"","Server"===this.parent.dataSourceSettings.mode)this.parent.getEngine("fetchRawData",null,null,null,null,null,null,{rowIndex:i,columnIndex:a});else if(this.parent.enableVirtualization&&this.parent.allowDataCompression){var p=Object.keys(e.indexObject);this.drillThroughDialog.indexString=[];for(var u=0,c=p;u<c.length;u++)for(var g=c[u],m=0,f=this.parent.engineModule.groupRawIndex[Number(g)];m<f.length;m++){var v=f[m];l.push(this.parent.engineModule.actualData[v]),this.drillThroughDialog.indexString.push(v.toString())}}else for(var S=0,y=p=Object.keys(e.indexObject);S<y.length;S++){var b=y[S];l.push(this.parent.engineModule.data[Number(b)])}"Server"!==this.parent.dataSourceSettings.mode&&this.triggerDialog(o,s,l,e,r)}},e.prototype.getCalcualtedFieldValue=function(e,i){for(var a=0;a<e.length;a++){var r={};r[e[a]]=e[a];for(var n=0;n<this.parent.dataSourceSettings.calculatedFieldSettings.length;n++){for(var o=void 0,s=this.parent.engineModule.fields.length-1;s>=0;s--)if(this.parent.engineModule.fields[s]===this.parent.dataSourceSettings.calculatedFieldSettings[n].name){o=s;break}if(!t.isNullOrUndefined(i[a])){var l=this.parent.engineModule.getAggregateValue([Number(e[a])],r,o,"calculatedfield");i[a][this.parent.dataSourceSettings.calculatedFieldSettings[n].name]=isNaN(l)&&t.isNullOrUndefined(l)?"#DIV/0!":l}}}return i},e.prototype.frameData=function(e){for(var t=0,i=0,a=[];i<e.rawData.length;){for(var r={};t<e.gridColumns.length;)r[e.gridColumns[t].field]="Server"===this.parent.dataSourceSettings.mode?e.rawData[i][-1!==this.parent.engineModule.fields.indexOf(e.gridColumns[t].field)?this.parent.engineModule.fields.indexOf(e.gridColumns[t].field):0]:e.rawData[i][this.parent.engineModule.fieldKeys[e.gridColumns[t].field]],t++;a.push(r),i++,t=0}return e.rawData=a,e},e.prototype.triggerDialog=function(e,t,i,a,r){var n="CalculatedField"===t?e.toString():""!==t?this.parent.localeObj.getConstant(t)+" "+this.parent.localeObj.getConstant("of")+" "+e:e,o={currentTarget:r,currentCell:a,rawData:i,rowHeaders:"row"===this.parent.dataSourceSettings.valueAxis?this.parent.getRowText(Number(r.getAttribute("index")),0):""===a.rowHeaders?"":a.rowHeaders.toString().split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter).join(" - "),columnHeaders:""===a.columnHeaders?"":a.columnHeaders.toString().split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter).join(" - "),value:n+"("+a.formattedText+")",gridColumns:this.drillThroughDialog.frameGridColumns(i),cancel:!1};"CSV"===this.parent.dataSourceSettings.type&&(o=this.frameData(o));var s=this;o.gridColumns;this.parent.trigger("drillThrough",o,function(e){o.cancel||s.drillThroughDialog.showDrillThroughDialog(e)})},e.prototype.destroy=function(){this.unWireEvents(),this.drillThroughDialog&&(this.drillThroughDialog.destroy(),this.drillThroughDialog=null)},e}(),Er=function(){function e(){this.headerColl={},this.maxLevel=0,this.columnGroupObject={},this.fieldPosition=[],this.measurePos=-1,this.measuresNames={},this.accumulationType=["Pie","Pyramid","Doughnut","Funnel"]}return e.prototype.getModuleName=function(){return"pivotChart"},e.prototype.loadChart=function(e,i){this.parent=e,this.measuresNames={},this.engineModule="olap"===this.parent.dataType?this.parent.olapEngineModule:this.parent.engineModule,this.dataSourceSettings=this.parent.dataSourceSettings,this.chartSettings=i;if("olap"===e.dataType?e.olapEngineModule.tupColumnInfo.length>0&&e.olapEngineModule.tupRowInfo.length>0&&(!t.isNullOrUndefined(e.olapEngineModule.colMeasurePos)||!t.isNullOrUndefined(e.olapEngineModule.rowMeasurePos)):e.dataSourceSettings.values.length>0){this.parent.chart||!this.parent.element.querySelector(".e-chart")&&!this.parent.element.querySelector(".e-accumulationchart")||t.remove(t.select("#"+this.parent.element.id+"_chart",this.parent.element)),this.chartSettings.enableMultipleAxis&&this.accumulationType.indexOf(i.chartSeries.type)<0?this.measureList=this.dataSourceSettings.values.map(function(e){return e.name}):this.measureList=[""===i.value?this.dataSourceSettings.values[0].name:i.value];for(var a=0,r=this.dataSourceSettings.values;a<r.length;a++){var n=(D=r[a]).name.replace(/[^A-Z0-9]+/gi,"_");this.measuresNames[D.name]=n,this.measuresNames[n]=D.name,"Polar"!==this.chartSettings.chartSeries.type&&"Radar"!==this.chartSettings.chartSeries.type||(this.measuresNames[D.caption?D.caption:D.name]=D.name)}this.columnGroupObject={},this.accEmptyPoint=!1;var o=this.engineModule.pivotValues;this.currentMeasure=i.enableMultipleAxis&&this.accumulationType.indexOf(i.chartSeries.type)<0?this.measureList[0]:(""===i.value||0===this.dataSourceSettings.values.filter(function(e){return e.name===i.value}).length)&&this.dataSourceSettings.values.length>0?this.dataSourceSettings.values[0].name:i.value;var s,l,d,h=this.getColumnTotalIndex(o),u=Object.keys(o),c={},g=0,m=-.5;this.headerColl={},this.maxLevel=0;for(var f,v={},S="",y="",b="",C=!1,x={},w=!1,T=0,M=this.dataSourceSettings.values;T<M.length;T++){var D;x[n=(D=M[T]).name]=D.caption?D.caption:n,x[D.caption?D.caption:n]=n}"olap"===this.parent.dataType&&(v=this.groupHierarchyWithLevels(o),S=this.fieldPosition[this.fieldPosition.length-1],b=y=this.measurePos===this.fieldPosition.length-1&&this.fieldPosition.length>1?this.fieldPosition[this.fieldPosition.length-2]:S);for(var O=0,N=u;O<N.length;O++){var E=N[O],P=Number(E);if(!t.isNullOrUndefined(o[P])){var F=o[P][0],I=F&&F.valueSort&&!t.isNullOrUndefined(F.valueSort.levelName)?F.valueSort.levelName.toString().split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter):void 0;if(w=!1,I&&"Grand Total"!==I[0]&&((i.enableMultipleAxis&&this.accumulationType.indexOf(i.chartSeries.type)<0||I.indexOf(x[this.currentMeasure])>-1)&&(w=!0),!w)){for(var L=0,A=I;L<A.length;L++){if(x[U=A[L]]){w=!0;break}}w=!w}if(F&&"row"===F.axis&&(0===this.dataSourceSettings.rows.length||"grand sum"!==F.type&&w)){var R=o[P][0],j="olap"===this.parent.dataType?this.engineModule.tupRowInfo[R.ordinal]:void 0,k=-1,q=R.level;"olap"===this.parent.dataType?(C="[Measures]"===R.hierarchy?C:this.isAttributeDrill(R.hierarchy,j.drillInfo),b=b===y?y:"[Measures]"===R.hierarchy||R.isNamedSet||this.engineModule.fieldList[R.hierarchy]&&!this.engineModule.fieldList[R.hierarchy].hasAllMember?y:b,k=j.drillInfo.length-1,3===R.memberType||j.measureName&&j.measureName!==this.dataSourceSettings.values[0].name||(c=0===(g=(l=void 0===l?R.levelUniqueName:l)===R.levelUniqueName?0:g)?{}:c,g=d&&l!==R.levelUniqueName?d.hierarchy===R.hierarchy?g+(R.level-d.level):t.isNullOrUndefined(c[R.levelUniqueName])?v[R.hierarchy].start:c[R.levelUniqueName]:g,c[R.levelUniqueName]=g,q=g,m+=!d||b!==d.hierarchy||d.isDrilled&&d.hasChild?0:1,b=C?R.hierarchy:y,s=g,d=R)):"value"!==R.type&&(void 0===s||s<q||m++,s=q),this.maxLevel=q>this.maxLevel?q:this.maxLevel;var V="olap"===this.parent.dataType?R.formattedText:R.actualText?R.actualText.toString():R.formattedText.toString(),H=this.engineModule.fieldList[this.currentMeasure],B=0===this.parent.dataSourceSettings.rows.length?this.parent.localeObj.getConstant("total")+" "+this.parent.localeObj.getConstant(H.aggregateType)+" "+this.parent.localeObj.getConstant("of")+" "+(t.isNullOrUndefined(H.caption)?H.name:H.caption):R.formattedText?R.formattedText.toString():V,_=R.hasChild&&!R.isNamedSet?(R.isDrilled?" - ":" + ")+B:B,U=j?j.uNameCollection:R.valueSort.levelName.toString(),G={name:V,text:_,hasChild:R.hasChild,isDrilled:R.isDrilled,levelName:U,level:q,fieldName:R.valueSort.axis?R.valueSort.axis.toString():"",rowIndex:P,colIndex:0,cell:R};("olap"===this.parent.dataType?3!==R.memberType:"value"!==R.type)&&(this.headerColl[m]?this.headerColl[m][q]=G:(this.headerColl[m]={},this.headerColl[m][q]=G));var W=o[P],z=Object.keys(W),Q=void 0;if("olap"===this.parent.dataType)f=3!==R.memberType?R:f;else if(f="value"!==R.type?R:f,"value"!==R.type)f=R;else{var Y=R&&R.valueSort&&R.valueSort.levelName&&R.valueSort.levelName.toString().split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter),K=void 0;if(Y&&Y.length>0&&(Y.splice(Y.length-1,1),K=Y.join(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter)),this.parent.dataSourceSettings.valueIndex<=0||this.engineModule.valueAxis&&this.dataSourceSettings.rows.length===this.engineModule.measureIndex||t.isNullOrUndefined(f.valueSort)||K===f.valueSort.levelName)f=f;else for(var X=P;X>-1;)o[X]&&o[X][0]&&o[X][0].valueSort&&o[X][0].valueSort.levelName===K&&(f=o[X][0],X=0),X--}for(var J=0,Z=z;J<Z.length;J++){var $=Z[J],ee=Number($),te=o[P][ee],ie=!t.isNullOrUndefined(te.rowHeaders)||0===this.dataSourceSettings.rows.length,ae="olap"===this.parent.dataType&&j&&j.measureName?j.measureName:te.actualText;if(("olap"!==this.parent.dataType||!te.isGrandSum)&&!h[te.colIndex]&&"value"===te.axis&&"header"!==R.type&&""!==ae&&(i.enableMultipleAxis&&this.accumulationType.indexOf(i.chartSeries.type)<0||ae===this.currentMeasure)){if(t.isNullOrUndefined(R.members)&&(R.members=[]),"olap"===this.parent.dataType?S!==R.hierarchy&&!C||(3===R.memberType&&Q?k!==this.measurePos||Q.isDrilled&&Q.hasChild:R.isDrilled&&R.hasChild):("value"===R.type&&Q?Q.members.length>0&&Q.isDrilled:R.members.length>0&&R.isDrilled)||!ie)break;var ne="olap"===this.parent.dataType?te.columnHeaders.toString().split(/~~|::/).join(" - "):te.columnHeaders.toString().split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter).join(" - "),oe="olap"===this.parent.dataType?te.rowHeaders.toString().split(/~~|::/).join(" - "):te.rowHeaders.toString().split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter).join(" - "),se=ne+" | "+ae,le="pivot"===this.parent.dataType&&this.engineModule.aggregatedValueMatrix[P]&&!t.isNullOrUndefined(this.engineModule.aggregatedValueMatrix[P][ee])?Number(this.engineModule.aggregatedValueMatrix[P][ee]):Number(te.value);0===(le=le===1/0?null:le)&&(this.accEmptyPoint=!0),this.columnGroupObject[se]?this.columnGroupObject[se].push({x:0===this.dataSourceSettings.rows.length?R.formattedText:oe,y:le,rIndex:P,cIndex:ee}):this.columnGroupObject[se]=[{x:0===this.dataSourceSettings.rows.length?R.formattedText:oe,y:le,rIndex:P,cIndex:ee}]}Q=f}}}}this.refreshChart()}else{if(this.parent.chart)return this.parent.element.querySelector(".e-chart")?(this.parent.chart.series=[],this.parent.chart.rows=[],this.parent.chart.primaryXAxis.title="",this.parent.chart.primaryYAxis.title="",this.parent.chart.primaryXAxis.multiLevelLabels=[],this.parent.chart.primaryYAxis.multiLevelLabels=[],this.parent.chart.axes.length>0&&(this.parent.chart.axes[0].title=""),this.parent.chart.primaryXAxis.zoomFactor=t.isNullOrUndefined(this.parent.chartSettings.primaryXAxis.zoomFactor)?1:this.parent.chartSettings.primaryXAxis.zoomFactor):this.parent.element.querySelector(".e-accumulationchart")&&(this.parent.chart.series[0].dataSource=[{}],this.parent.chart.series[0].dataLabel={}),void this.parent.chart.refresh();if(!t.select("#"+this.parent.element.id+"_chart",this.parent.element)){"Both"===this.parent.displayOption.view&&"Chart"===this.parent.displayOption.primary?this.parent.element.insertBefore(t.createElement("div",{className:qa,id:this.parent.element.id+"_chart"}),this.parent.element.querySelector(".e-grid")):this.parent.element.appendChild(t.createElement("div",{className:qa,id:this.parent.element.id+"_chart"}));var de=this.parent.width.toString();this.parent.showToolbar&&this.parent.grid&&(de=this.parent.getGridWidthAsNumber().toString());var he=this.getChartHeight();(this.chartSettings&&this.chartSettings.chartSeries&&this.accumulationType.indexOf(this.chartSettings.chartSeries.type)>-1?new p.AccumulationChart({width:de,height:he}):new p.Chart({width:de,height:he})).appendTo("#"+this.parent.element.id+"_chart"),this.parent.showToolbar&&("Both"===this.parent.displayOption.view&&"Chart"===this.parent.currentView&&(this.parent.grid.element.style.display="none"),"Chart"!==this.parent.currentView&&(t.select("#"+this.parent.element.id+"_chart",this.parent.element).style.display="none"))}this.parent.notify(re,{})}},e.prototype.refreshChart=function(){this.chartSeries=[];var e=Object.keys(this.columnGroupObject);this.persistSettings=JSON.parse(this.parent.getPersistData()).chartSettings;for(var i=this.parent.chartSettings.columnDelimiter?this.parent.chartSettings.columnDelimiter:"-",a=this.parent.chartSettings.columnHeader&&""!==this.parent.chartSettings.columnHeader?this.parent.chartSettings.columnHeader.split(i).join(" - "):"",r=this.chartSettings.chartSeries?this.chartSettings.chartSeries.type:void 0,n={},o=0;o<this.parent.dataSourceSettings.values.length;o++)n[this.parent.dataSourceSettings.values[o].name]=t.isNullOrUndefined(this.parent.dataSourceSettings.values[o].caption)?void 0:this.parent.dataSourceSettings.values[o].caption;if(this.accumulationType.indexOf(r)>-1&&e.length>0){this.currentColumn=e.indexOf(a+" | "+this.currentMeasure)>-1&&void 0!==a?a+" | "+this.currentMeasure:e[0];var s={};s=this.persistSettings.chartSeries?this.frameChartSeries(this.persistSettings.chartSeries):s,(t.isNullOrUndefined(s.palettes)||0==s.palettes.length)&&!t.isNullOrUndefined(this.persistSettings.palettes)&&this.persistSettings.palettes.length>0&&(s.palettes=this.persistSettings.palettes),s.dataSource=this.columnGroupObject[this.currentColumn],s.xName="x",s.yName="y",this.persistSettings.chartSeries&&this.persistSettings.chartSeries.dataLabel?(s.dataLabel=this.persistSettings.chartSeries.dataLabel,s.dataLabel.name="x"):(s.dataLabel={visible:!0,position:"Outside",name:"x"},this.parent.setProperties({chartSettings:{chartSeries:{dataLabel:{visible:!0,position:"Outside"}}}},!0)),this.accEmptyPoint&&s.emptyPointSettings?s.emptyPointSettings.mode="Zero":this.accEmptyPoint&&(s.emptyPointSettings={mode:"Zero"}),s.name=this.currentColumn,"Doughnut"===r?(s.type="Pie",s.innerRadius=this.chartSettings.chartSeries.innerRadius?this.chartSettings.chartSeries.innerRadius:"40%"):"Pie"===r&&(s.innerRadius=this.chartSettings.chartSeries.innerRadius?this.chartSettings.chartSeries.innerRadius:"0"),this.chartSeries=this.chartSeries.concat(s)}else for(var l=0,d=e;l<d.length;l++){var h=d[l];s={};s=this.persistSettings.chartSeries?this.frameChartSeries(this.persistSettings.chartSeries):s,!t.isNullOrUndefined(s.palettes)&&s.palettes.length>0&&(t.isNullOrUndefined(this.persistSettings.palettes)||0==this.persistSettings.palettes.length)&&(this.chartSettings.palettes=s.palettes);for(o=0;o<this.columnGroupObject[h].length;o++){var p=this.engineModule.fieldList[this.currentMeasure];this.columnGroupObject[h][o].x=0!==this.parent.dataSourceSettings.rows.length||this.chartSettings.showMultiLevelLabels?""===this.columnGroupObject[h][o].x?this.parent.localeObj.getConstant("blank"):this.columnGroupObject[h][o].x:this.parent.localeObj.getConstant("total")+" "+this.parent.localeObj.getConstant(p.aggregateType)+" "+this.parent.localeObj.getConstant("of")+" "+(t.isNullOrUndefined(p.caption)?p.name:p.caption)}s.dataSource=this.columnGroupObject[h],s.xName="x",s.yName="y";var u=void 0;if(this.chartSettings.enableMultipleAxis){var c=h.split(" | ")[1];c=t.isNullOrUndefined(n[c])?c:n[c],u=h.split(" | ")[0]+" | "+c}if(s.name=this.chartSettings.enableMultipleAxis?u:h.split(" | ")[0],["Radar","Polar"].indexOf(r)<0){var g=h.split(" | ")[1];s.yAxisName=this.measuresNames[g]?this.measuresNames[g]:g}this.persistSettings.chartSeries&&this.persistSettings.chartSeries.emptyPointSettings&&(s.emptyPointSettings=this.persistSettings.chartSeries.emptyPointSettings),this.chartSeries=this.chartSeries.concat(s)}var m={series:this.chartSeries,cancel:!1},f=this;this.parent.trigger(V,m,function(e){e.cancel?(f.element&&t.remove(f.element),f.parent.notify(re,{})):f.bindChart()})},e.prototype.frameObjectWithKeys=function(e){for(var t=Object.keys(e),i=0,a={};i<t.length;)a[t[i]]=e[t[i]],i++;return a},e.prototype.frameChartSeries=function(e){for(var t=Object.keys(e),i=0,a={};i<t.length;)this.accumulationType.indexOf(this.parent.chartSettings.chartSeries.type)>-1&&["fill","dashArray","width","segmentAxis","drawType","isClosed","segments","stackingGroup","marker","errorBar","trendlines","minRadius","splineType","maxRadius","cardinalSplineTension","columnWidth","columnSpacing","cornerRadius"].indexOf(t[i])>-1||this.accumulationType.indexOf(this.parent.chartSettings.chartSeries.type)<0&&["endAngle","explode","explodeAll","explodeIndex","explodeOffset","gapRatio","groupMode","groupTo","neckHeight","neckWidth","pyramidMode","startAngle","dataLabel","innerRadius"].indexOf(t[i])>-1?i++:(a[t[i]]=e[t[i]],i++);return a},e.prototype.bindChart=function(){this.parent.showWaitingPopup();var e=this.configXAxis(),i=this.configTooltipSettings(),r=this.configLegendSettings(),n=this.configZoomSettings(),o=this.frameAxesWithRows(),s=this.chartSettings.chartSeries.type;"Both"===this.parent.displayOption.view?this.element="Chart"===this.parent.displayOption.primary?this.parent.element.insertBefore(this.element?this.element:t.createElement("div",{className:qa,id:this.parent.element.id+"_chart"}),this.parent.element.querySelector(".e-grid")):this.parent.element.appendChild(this.element?this.element:t.createElement("div",{className:qa,id:this.parent.element.id+"_chart"})):this.element||(this.element=this.parent.element.appendChild(t.createElement("div",{className:qa,id:this.parent.element.id+"_chart"}))),!this.chartElement&&this.parent.chartSettings.enableScrollOnMultiAxis&&this.parent.chartSettings.enableMultipleAxis&&(this.parent.element.querySelector("."+qa).innerHTML="",this.chartElement=this.parent.element.querySelector("."+qa).appendChild(t.createElement("div",{className:Ka,id:this.parent.element.id+"_chartInner"}))),this.parent.element.querySelector("."+Ka)&&(this.parent.element.querySelector("."+Ka).innerHTML=""),this.parent.showGroupingBar?this.element.style.minWidth="400px !important":this.element.style.minWidth="310px !important";var l=this.parent.width.toString();this.parent.showToolbar&&this.parent.grid&&(l=this.parent.getGridWidthAsNumber().toString());var d=this.getChartHeight();this.parent.chartSettings.enableScrollOnMultiAxis&&this.parent.chartSettings.enableMultipleAxis&&this.accumulationType.indexOf(s)<0&&(this.parent.element.querySelector("."+qa).style.height=("auto"===d?this.getChartAutoHeight():d)+"px",this.parent.element.querySelector("."+qa).style.width=l+"px","Polar"!==this.parent.chartSettings.chartSeries.type&&"Radar"!==this.parent.chartSettings.chartSeries.type&&(this.parent.element.querySelector("."+qa).style.overflow="auto",this.parent.element.querySelector("."+qa).style.overflowX="hidden")),this.parent.chart&&("accumulationchart"===this.parent.chart.getModuleName()&&this.accumulationType.indexOf(s)<0||"chart"===this.parent.chart.getModuleName()&&this.accumulationType.indexOf(s)>-1)&&(this.parent.chart.destroy(),t.select("#"+this.parent.element.id+"_chart",this.parent.element)&&(t.select("#"+this.parent.element.id+"_chart",this.parent.element).innerHTML="",t.select("#"+this.parent.element.id+"_chart",this.parent.element).appendChild(t.createElement("div",{className:Ka,id:this.parent.element.id+"_chartInner"})))),!(this.parent.chart&&this.parent.chart.element&&this.parent.element.querySelector(".e-chart")||this.parent.element.querySelector(".e-accumulationchart"))||this.parent.toolbarModule&&this.parent.toolbarModule.isMultiAxisChange?(this.parent.toolbarModule&&this.parent.toolbarModule.isMultiAxisChange&&this.parent.chart&&(this.parent.chart.isDestroyed||this.parent.chart.destroy(),this.parent.chart=void 0,t.select("#"+this.parent.element.id+"_chart",this.parent.element).innerHTML="",t.select("#"+this.parent.element.id+"_chart",this.parent.element).appendChild(t.createElement("div",{className:Ka,id:this.parent.element.id+"_chartInner"})),this.parent.toolbarModule.isMultiAxisChange=!1),p.Chart.Inject(p.ColumnSeries,p.StackingColumnSeries,p.RangeColumnSeries,p.BarSeries,p.StackingBarSeries,p.ScatterSeries,p.BubbleSeries,p.LineSeries,p.StepLineSeries,p.SplineSeries,p.SplineAreaSeries,p.MultiColoredLineSeries,p.PolarSeries,p.RadarSeries,p.AreaSeries,p.RangeAreaSeries,p.StackingAreaSeries,p.StepAreaSeries,p.MultiColoredAreaSeries,p.ParetoSeries,p.Legend,p.Tooltip,p.Category,p.MultiLevelLabel,p.ScrollBar,p.Zoom,p.Export,p.Crosshair,p.Selection,p.StripLine,p.DataLabel),p.AccumulationChart.Inject(p.PieSeries,p.FunnelSeries,p.PyramidSeries,p.AccumulationDataLabel,p.AccumulationLegend,p.AccumulationTooltip,p.Export),this.accumulationType.indexOf(s)>-1?this.parent.chart=new p.AccumulationChart({series:this.chartSeries.length>0?this.chartSeries:[{}],legendSettings:r,tooltip:i,width:l,height:d.toString(),title:this.chartSettings.title,enableSmartLabels:this.chartSettings.enableSmartLabels,center:this.chartSettings.pieCenter,enableBorderOnMouseMove:this.chartSettings.enableBorderOnMouseMove,highlightMode:this.chartSettings.highlightMode,highlightPattern:this.chartSettings.highlightPattern,titleStyle:this.chartSettings.titleStyle,subTitle:this.chartSettings.subTitle,subTitleStyle:this.chartSettings.subTitleStyle,margin:this.chartSettings.margin,border:this.chartSettings.border,background:this.chartSettings.background,theme:this.chartSettings.theme,selectionMode:this.chartSettings.accumulationSelectionMode,isMultiSelect:this.chartSettings.isMultiSelect,enableExport:this.chartSettings.enableExport,selectedDataIndexes:this.chartSettings.selectedDataIndexes,enableAnimation:this.chartSettings.enableAnimation,useGroupingSeparator:this.chartSettings.useGroupingSeparator,locale:this.parent.locale,enableRtl:this.parent.enableRtl,beforePrint:this.chartSettings.beforePrint?this.chartSettings.beforePrint.bind(this):void 0,animationComplete:this.chartSettings.animationComplete?this.chartSettings.animationComplete.bind(this):void 0,legendRender:this.chartSettings.legendRender?this.chartSettings.legendRender.bind(this):void 0,textRender:this.chartSettings.textRender?this.chartSettings.textRender.bind(this):void 0,pointRender:this.chartSettings.pointRender?this.chartSettings.pointRender.bind(this):void 0,seriesRender:this.chartSettings.seriesRender?this.chartSettings.seriesRender.bind(this):void 0,chartMouseMove:this.chartSettings.chartMouseMove?this.chartSettings.chartMouseMove.bind(this):void 0,chartMouseClick:this.chartSettings.chartMouseClick?this.chartSettings.chartMouseClick.bind(this):void 0,pointMove:this.chartSettings.pointMove?this.chartSettings.pointMove.bind(this):void 0,pointClick:this.pointClick.bind(this),chartMouseLeave:this.chartSettings.chartMouseLeave?this.chartSettings.chartMouseLeave.bind(this):void 0,chartMouseDown:this.chartSettings.chartMouseDown?this.chartSettings.chartMouseDown.bind(this):void 0,chartMouseUp:this.chartSettings.chartMouseUp?this.chartSettings.chartMouseUp.bind(this):void 0,tooltipRender:this.tooltipRender.bind(this),loaded:this.loaded.bind(this),load:this.load.bind(this),resized:this.resized.bind(this)}):this.parent.chart=new p.Chart({series:this.chartSeries.length>0?this.chartSeries:[{}],legendSettings:r,tooltip:i,zoomSettings:n,axes:"Polar"===s||"Radar"===s?[]:o.axes,rows:"Polar"===s||"Radar"===s?[{}]:"Bar"===s||"StackingBar"===s||"StackingBar100"===s&&this.chartSettings.enableMultipleAxis?[{height:"100%"}]:o.rows,columns:"Polar"===s||"Radar"===s?[{}]:"Bar"===s||"StackingBar"===s||"StackingBar100"===s&&this.chartSettings.enableMultipleAxis?o.columns:[{width:"100%"}],primaryYAxis:"Polar"===s||"Radar"===s?o.axes[0]:{visible:!1},primaryXAxis:e,width:l,height:"Polar"!==this.parent.chartSettings.chartSeries.type&&"Radar"!==this.parent.chartSettings.chartSeries.type&&this.parent.chartSettings.enableScrollOnMultiAxis&&this.parent.chartSettings.enableMultipleAxis&&this.parent.dataSourceSettings.values.length>0?Number(d)>235*this.parent.dataSourceSettings.values.length+100?isNaN(Number(d))?d.toString():(Number(d)-5).toString():!isNaN(Number(d))||this.parent.dataSourceSettings.values.length>1?(235*this.parent.dataSourceSettings.values.length+100).toString():d.toString():d.toString(),title:this.chartSettings.title,titleStyle:this.chartSettings.titleStyle,subTitle:this.chartSettings.subTitle,subTitleStyle:this.chartSettings.subTitleStyle,margin:this.chartSettings.margin,border:this.chartSettings.border,background:this.chartSettings.background,chartArea:this.chartSettings.chartArea,palettes:this.chartSettings.palettes,theme:this.chartSettings.theme,crosshair:this.chartSettings.crosshair,selectionMode:this.chartSettings.selectionMode,isMultiSelect:this.chartSettings.isMultiSelect,enableExport:this.chartSettings.enableExport,selectedDataIndexes:this.chartSettings.selectedDataIndexes,isTransposed:this.chartSettings.isTransposed,enableAnimation:this.chartSettings.enableAnimation,enableCanvas:this.chartSettings.enableCanvas,useGroupingSeparator:this.chartSettings.useGroupingSeparator,description:this.chartSettings.description,tabIndex:this.chartSettings.tabIndex,locale:this.parent.locale,enableRtl:this.parent.enableRtl,enableSideBySidePlacement:this.chartSettings.enableSideBySidePlacement,beforePrint:this.chartSettings.beforePrint?this.chartSettings.beforePrint.bind(this):void 0,animationComplete:this.chartSettings.animationComplete?this.chartSettings.animationComplete.bind(this):void 0,legendRender:this.chartSettings.legendRender?this.chartSettings.legendRender.bind(this):void 0,textRender:this.chartSettings.textRender?this.chartSettings.textRender.bind(this):void 0,pointRender:this.chartSettings.pointRender?this.chartSettings.pointRender.bind(this):void 0,seriesRender:this.chartSettings.seriesRender?this.chartSettings.seriesRender.bind(this):void 0,axisMultiLabelRender:this.chartSettings.multiLevelLabelRender?this.chartSettings.multiLevelLabelRender.bind(this):void 0,chartMouseMove:this.chartSettings.chartMouseMove?this.chartSettings.chartMouseMove.bind(this):void 0,chartMouseClick:this.chartSettings.chartMouseClick?this.chartSettings.chartMouseClick.bind(this):void 0,pointMove:this.chartSettings.pointMove?this.chartSettings.pointMove.bind(this):void 0,pointClick:this.pointClick.bind(this),chartMouseLeave:this.chartSettings.chartMouseLeave?this.chartSettings.chartMouseLeave.bind(this):void 0,chartMouseDown:this.chartSettings.chartMouseDown?this.chartSettings.chartMouseDown.bind(this):void 0,chartMouseUp:this.chartSettings.chartMouseUp?this.chartSettings.chartMouseUp.bind(this):void 0,dragComplete:this.chartSettings.dragComplete?this.chartSettings.dragComplete.bind(this):void 0,zoomComplete:this.chartSettings.zoomComplete?this.chartSettings.zoomComplete.bind(this):void 0,scrollStart:this.chartSettings.scrollStart?this.chartSettings.scrollStart.bind(this):void 0,scrollEnd:this.chartSettings.scrollEnd?this.chartSettings.scrollEnd.bind(this):void 0,scrollChanged:this.chartSettings.scrollChanged?this.chartSettings.scrollChanged.bind(this):void 0,tooltipRender:this.tooltipRender.bind(this),loaded:this.loaded.bind(this),load:this.load.bind(this),resized:this.resized.bind(this),axisLabelRender:this.axisLabelRender.bind(this),multiLevelLabelClick:this.multiLevelLabelClick.bind(this)}),this.parent.chart.isStringTemplate=!0):(this.parent.chart.series=this.chartSeries,this.parent.chart.title=this.parent.chartSettings.title,this.parent.chart.subTitle=this.parent.chartSettings.subTitle,this.parent.chart.background=this.parent.chartSettings.background,this.parent.chart.theme=this.parent.chartSettings.theme,this.parent.chart.legendSettings=r,this.parent.chart.selectionMode=this.parent.chartSettings.selectionMode,this.parent.chart.enableExport=this.parent.chartSettings.enableExport,this.parent.chart.isMultiSelect=this.parent.chartSettings.isMultiSelect,this.parent.chart.enableAnimation=this.parent.chartSettings.enableAnimation,this.parent.chart.useGroupingSeparator=this.parent.chartSettings.useGroupingSeparator,this.parent.chart.highlightPattern=this.parent.chartSettings.highlightPattern,this.accumulationType.indexOf(s)>-1?(this.parent.chart.enableBorderOnMouseMove=this.parent.chartSettings.enableBorderOnMouseMove,this.parent.chart.highlightMode=this.parent.chartSettings.highlightMode,this.parent.chart.enableSmartLabels=this.parent.chartSettings.enableSmartLabels):(this.parent.chart.palettes=this.parent.chartSettings.palettes,this.parent.chart.isTransposed=this.parent.chartSettings.isTransposed,this.parent.chart.enableSideBySidePlacement=this.parent.chartSettings.enableSideBySidePlacement,this.parent.chart.tabIndex=this.parent.chartSettings.tabIndex,this.parent.chart.description=this.parent.chartSettings.description,this.parent.chart.enableCanvas=this.parent.chartSettings.enableCanvas),"Polar"===s||"Radar"===s?(this.parent.chart.primaryXAxis=e,this.parent.chart.primaryYAxis.visible=!0,this.parent.chart.primaryYAxis=o.axes[0],this.parent.chart.axes=[],this.parent.chart.rows=[{}]):this.accumulationType.indexOf(s)<0&&"chart"===this.parent.chart.getModuleName()&&(this.parent.chart.primaryYAxis.visible=!1,this.parent.chart.primaryXAxis=e,this.parent.chart.axes=o.axes,"Bar"===s||"StackingBar"===s||"StackingBar100"===s&&this.chartSettings.enableMultipleAxis?(this.parent.chart.rows=[{height:"100%"}],this.parent.chart.columns=o.columns):(this.parent.chart.rows=o.rows,this.parent.chart.columns=[{width:"100%"}])),this.parent.chart.refresh(),this.accumulationType.indexOf(s)>-1&&"accumulationchart"===this.parent.chart.getModuleName()&&(0===this.parent.dataSourceSettings.rows.length||0===this.parent.dataSourceSettings.columns.length)&&(this.parent.hideWaitingPopup(),this.parent.pivotFieldListModule&&a.hideSpinner(this.parent.pivotFieldListModule.fieldListSpinnerElement))),this.parent.chartSettings.enableScrollOnMultiAxis&&this.parent.chartSettings.enableMultipleAxis?this.parent.chart.appendTo("#"+this.parent.element.id+"_chartInner"):this.parent.chart.appendTo("#"+this.parent.element.id+"_chart")},e.prototype.pointClick=function(e){var t=e.series.dataSource?e.series.dataSource:this.parent.chart.series[e.seriesIndex].dataSource;if((["Pie","Funnel","Doughnut","Pyramid","Radar","Polar"].indexOf(this.parent.chartSettings.chartSeries.type)>-1||!this.parent.chartSettings.showMultiLevelLabels)&&this.parent.dataSourceSettings.rows.length>1){this.pivotIndex={rIndex:t?t[e.pointIndex].rIndex:void 0,cIndex:t?t[e.pointIndex].cIndex:void 0},this.creatMenu();var i=this.parent.element.getBoundingClientRect(),a=(this.parent.element.querySelector(".e-pivot-toolbar")?this.parent.element.querySelector(".e-pivot-toolbar").clientHeight:0)+(this.parent.element.querySelector(".e-chart-grouping-bar")?this.parent.element.querySelector(".e-chart-grouping-bar").clientHeight:0)+(window.scrollY||document.documentElement.scrollTop)+i.top;this.accumulationMenu.open(a+e.y,e.x+i.left+(window.scrollX||document.documentElement.scrollLeft))}else if((this.parent.allowDrillThrough||this.parent.editSettings.allowEditing)&&this.parent.drillThroughModule){var r=t[e.pointIndex].rIndex,n=t[e.pointIndex].cIndex;this.parent.drillThroughModule.executeDrillThrough(this.parent.pivotValues[r][n],r,n)}this.parent.trigger("chartPointClick",e)},e.prototype.frameAxesWithRows=function(){var e=[],t=[],i=[],a=this.persistSettings.chartSeries&&("StackingColumn100"===this.persistSettings.chartSeries.type||"StackingBar100"===this.persistSettings.chartSeries.type||"StackingArea100"===this.persistSettings.chartSeries.type),r=["PercentageOfGrandTotal","PercentageOfColumnTotal","PercentageOfRowTotal","PercentageOfDifferenceFrom","PercentageOfParentRowTotal","PercentageOfParentColumnTotal","PercentageOfParentTotal"];if(this.chartSettings.enableMultipleAxis)for(var n=0,o=100/this.dataSourceSettings.values.length+"%",s=0,l=this.dataSourceSettings.values;s<l.length;s++){for(var d=l[s],h=this.engineModule.fieldList[d.name],p=("olap"===this.parent.dataType?"":this.parent.localeObj.getConstant(h.aggregateType)+" "+this.parent.localeObj.getConstant("of")+" ")+h.caption,u=void 0,c=0,m=this.dataSourceSettings.formatSettings;c<m.length;c++){var f=m[c];if(f.name===d.name){u=f;break}}var v=-1!==g.inArray(h.aggregateType,r)?"P2":u?null===u.format.toLowerCase().match(/n|p|c/)?"N":u.format:"olap"===this.parent.dataType?this.getFormat(h.formatString):"N",S="Polar"===this.chartSettings.chartSeries.type||"Radar"===this.chartSettings.chartSeries.type,y={};(y=this.persistSettings.primaryYAxis?this.frameObjectWithKeys(this.persistSettings.primaryYAxis):y).labelFormat=y.labelFormat?y.labelFormat:a?"":S?"N":v,y.title=y.title?y.title:p,y.edgeLabelPlacement=this.chartSettings.primaryYAxis.edgeLabelPlacement?this.chartSettings.primaryYAxis.edgeLabelPlacement:this.persistSettings.primaryYAxis.edgeLabelPlacement,"Bar"===this.chartSettings.chartSeries.type||"StackingBar"===this.chartSettings.chartSeries.type||"StackingBar100"===this.chartSettings.chartSeries.type?y.plotOffsetRight=y.plotOffsetRight?y.plotOffsetRight:30:y.plotOffsetTop=y.plotOffsetTop?y.plotOffsetTop:30,S||(y.name=this.measuresNames[d.name]?this.measuresNames[d.name]:d.name),e=e.concat(y),"Stacked"===this.chartSettings.multipleAxisMode?(y.rowIndex=n,y.columnIndex=n,t.push({height:o}),i.push({width:o})):(y.rowIndex=0,y.columnIndex=0,t=[{height:"100%"}],i=[{width:"100%"}]),n++}else{h=this.engineModule.fieldList[this.currentMeasure],p=("olap"===this.parent.dataType?"":this.parent.localeObj.getConstant(h.aggregateType)+" "+this.parent.localeObj.getConstant("of")+" ")+h.caption,u=void 0;for(var b=0,C=this.dataSourceSettings.formatSettings;b<C.length;b++){if((d=C[b]).name===this.currentMeasure){u=d;break}}var x=void 0;u&&(x=u.format.length);y={},v=-1!==g.inArray(h.aggregateType,r)?"P2":u?null===u.format.toLowerCase().match(/n[0-10]|p[0-10]|c[0-10]/)||x>3?"N":u.format:"olap"===this.parent.dataType?this.getFormat(h.formatString):"N";(y=this.persistSettings.primaryYAxis?this.frameObjectWithKeys(this.persistSettings.primaryYAxis):y).rowIndex=0,y.columnIndex=0,y.edgeLabelPlacement=this.chartSettings.primaryYAxis.edgeLabelPlacement?this.chartSettings.primaryYAxis.edgeLabelPlacement:this.persistSettings.primaryYAxis.edgeLabelPlacement,"Polar"!==this.chartSettings.chartSeries.type&&"Radar"!==this.chartSettings.chartSeries.type&&(y.name=this.measuresNames[this.currentMeasure]?this.measuresNames[this.currentMeasure]:this.currentMeasure),y.labelFormat=y.labelFormat?y.labelFormat:a?"":v,y.title=y.title?y.title:p,e=e.concat(y),t.push({height:"100%"}),i.push({width:"100%"})}return{axes:e,rows:t,columns:i}},e.prototype.getFormat=function(e){return e="Currency"===e?"C":"Percent"===e?"P":"N"},e.prototype.getColumnTotalIndex=function(e){for(var i={},a=0,r=Object.keys(e);a<r.length;a++){var n=r[a],o=e[Number(n)];if(!t.isNullOrUndefined(o))for(var s=0,l=Object.keys(o);s<l.length;s++){var d=l[s],h=o[Number(d)];if(!t.isNullOrUndefined(h)){if("column"!==h.axis)return i;("sum"===h.type||0!==this.dataSourceSettings.columns.length&&"grand sum"===h.type)&&-1!==h.rowSpan&&(i[h.colIndex]=h.colIndex)}}}return i},e.prototype.groupHierarchyWithLevels=function(e){var i,a;this.fieldPosition=[];var r={},n=0,o={};this.measurePos=this.engineModule.tupRowInfo[0].measurePosition;for(var s=0;s<e.length;s++){var l=e[s][0];l&&"row"===l.axis&&"grand sum"!==l.type&&(t.isNullOrUndefined(r[l.hierarchy])?(3===l.memberType?n===this.measurePos?(this.fieldPosition[this.measurePos]=l.hierarchy,r[l.hierarchy]=(i={},i[l.levelUniqueName]=l.levelUniqueName,i)):n--:(this.fieldPosition[n]=l.hierarchy,r[l.hierarchy]=(a={},a[l.levelUniqueName]=l.levelUniqueName,a)),n++):r[l.hierarchy][l.levelUniqueName]=l.levelUniqueName)}for(var d=-1,h=0;h<this.fieldPosition.length;h++)this.measurePos!==h&&(o[this.fieldPosition[h]]={start:d+1,end:d+Object.keys(r[this.fieldPosition[h]]).length},d=o[this.fieldPosition[h]].end);return o},e.prototype.frameMultiLevelLabels=function(){for(var e=Object.keys(this.headerColl),t=this.headerColl[-.5],i=0,a=e;i<a.length;i++){for(var r=a[i],n=Number(r),o=this.headerColl[n],s=0,l=!1;s<=this.maxLevel;)l?o[s]||(o[s]={name:o[s-1].name,text:"",hasChild:o[s-1].hasChild,isDrilled:o[s-1].isDrilled,levelName:o[s-1].levelName,level:o[s-1].level,fieldName:o[s-1].fieldName,rowIndex:o[s-1].rowIndex,colIndex:o[s-1].colIndex,span:-1}):o[s]?l=!0:o[s]=t[s],s++;t=this.headerColl[n]}for(var d={},h=0,p=e;h<p.length;h++){r=p[h],n=Number(r),o=this.headerColl[n];for(var u=0,c=Object.keys(o);u<c.length;u++){var g=c[u],m=Number(g);if(d[m]){var f=d[m].length;o[m].levelName===t[m].levelName?d[m][f-1].end=d[m][f-1].end+1:d[m].push({start:n,end:n+1,text:o[m].text,type:-1===o[m].span?"WithoutTopandBottomBorder":"WithoutTopBorder",customAttributes:o[m]})}else d[m]=[{start:n,end:n+1,text:o[m].text,type:-1===o[m].span?"WithoutTopandBottomBorder":"WithoutTopBorder",customAttributes:o[m]}]}t=o}for(var v=[],S=Object.keys(d).length-1;S>-1;S--)v.push({categories:d[S],border:{width:1},overflow:"Trim"});return v},e.prototype.getZoomFactor=function(){this.calculatedWidth=this.getCalulatedWidth();var e=10*this.chartSeries.length>120?10*this.chartSeries.length:120,t=this.chartSeries.length>0?this.calculatedWidth/(Object.keys(this.chartSeries[0].dataSource).length*e):1;return t=t<1&&t>0?t:1},e.prototype.getCalulatedWidth=function(){return isNaN(Number(this.parent.width))?this.parent.width.indexOf("%")>-1?this.calculatedWidth=this.parent.element.clientWidth*(parseFloat(this.parent.width)/100):this.parent.width.indexOf("px")>-1?this.calculatedWidth=Number(this.parent.width.toString().split("px")[0]):this.calculatedWidth=this.parent.element.clientWidth:this.calculatedWidth=Number(this.parent.width),this.calculatedWidth},e.prototype.configTooltipSettings=function(){var e=this.persistSettings.tooltip?this.persistSettings.tooltip:this.chartSettings.tooltip;return e.enable=void 0===e.enable||e.enable,e.enable&&e.template&&(this.templateFn=this.parent.templateParser(e.template)),this.parent.tooltipTemplate&&(e.template=e.template?e.template:this.parent.tooltipTemplate),e.header=e.header?e.header:"",e.enableMarker=void 0===e.enableMarker||e.enableMarker,e},e.prototype.configLegendSettings=function(){var e={};if(this.chartSettings.legendSettings)for(var t=0,i=Object.keys(this.chartSettings.legendSettings);t<i.length;)e[i[t]]=this.chartSettings.legendSettings[i[t]],t++;return this.accumulationType.indexOf(this.chartSettings.chartSeries.type)>-1&&void 0===e.visible&&(e.visible=!1),e.padding=e.padding?e.padding:25,e.shapePadding=e.shapePadding?e.shapePadding:10,e},e.prototype.configXAxis=function(){var e={};return e=this.persistSettings.primaryXAxis?this.frameObjectWithKeys(this.persistSettings.primaryXAxis):e,e.valueType="Category",e.labelIntersectAction=e.labelIntersectAction?e.labelIntersectAction:"Rotate45",e.title=e.title?e.title:this.dataSourceSettings.rows.map(function(e){return e.caption||e.name}).join(" / "),e.zoomFactor=t.isNullOrUndefined(this.parent.chartSettings.primaryXAxis.zoomFactor)?this.getZoomFactor():this.parent.chartSettings.primaryXAxis.zoomFactor,this.parent.chartSettings.zoomSettings.enableScrollbar||(e.zoomFactor=1),this.chartSettings.showMultiLevelLabels&&"Pareto"!==this.chartSettings.chartSeries.type?(e.multiLevelLabels=this.frameMultiLevelLabels(),e.border={width:1,type:"WithoutTopandBottomBorder"},e.majorTickLines={width:0,height:-10}):(e.multiLevelLabels=[],e.border={width:1,type:"Rectangle"},e.majorTickLines={width:0,height:5}),e},e.prototype.configZoomSettings=function(){var e=this.chartSettings.zoomSettings;return e.enableSelectionZooming=void 0===e.enableSelectionZooming||e.enableSelectionZooming,e.enableScrollbar=void 0===e.enableScrollbar||e.enableScrollbar,e},e.prototype.tooltipRender=function(e){var t=e.series.yAxisName?e.series.yAxisName.split("_CumulativeAxis")[0]:this.chartSettings.enableMultipleAxis&&this.accumulationType.indexOf(this.chartSettings.chartSeries.type)<0?e.series.name?e.series.name.split(" | ")[1]:e.data.seriesName?e.data.seriesName.split(" | ")[1]:this.currentMeasure:this.measuresNames[this.currentMeasure]?this.measuresNames[this.currentMeasure]:this.currentMeasure,i=e.series.dataSource?e.series.dataSource:this.parent.chart.series[e.data.seriesIndex].dataSource,a=i?i[e.data.pointIndex].rIndex:void 0,r=i?i[e.data.pointIndex].cIndex:void 0,n=this.engineModule.fieldList[this.measuresNames[t]?this.measuresNames[t]:t],o="olap"===this.parent.dataType?"":this.parent.localeObj.getConstant(n.aggregateType),s=("olap"===this.parent.dataType?"":o+" "+this.parent.localeObj.getConstant("of")+" ")+n.caption,l=this.accumulationType.indexOf(this.parent.chartSettings.chartSeries.type)<0?e.text.split("<b>")[1].split("</b>")[0]:this.engineModule.pivotValues[a][r].formattedText,d=this.engineModule.formatFields[n.id],h=d&&d.format&&null!==d.format.toLowerCase().match(/n|p|c/)&&this.chartSettings.useGroupingSeparator?"olap"===this.parent.dataType?this.engineModule.getFormattedValue(e.point.y,n.id,l):this.parent.engineModule.getFormattedValue(e.point.y,n.id).formattedText:l,p=e.series.name?e.series.name.split(" | ")[0]:e.data.seriesName.split(" | ")[0],u=e.point.x;if(this.parent.tooltipTemplate&&void 0!==this.parent.getTooltipTemplate()||this.chartSettings.tooltip.template){var c=i?this.parent.getHeaderField(a,r,"row"):"",g=i?this.parent.getHeaderField(a,r,"Column"):"",m={rowHeaders:u,columnHeaders:p,aggregateType:o,value:h,valueField:n.caption,rowFields:c,columnFields:g},f=void 0;f=this.parent.chartSettings&&this.parent.chartSettings.tooltip&&this.parent.chartSettings.tooltip.enable&&this.parent.chartSettings.tooltip.template?this.tooltipTemplateFn()(m,this,"tooltipTemplate",this.element.id+"1tooltipTemplate")[0].outerHTML:this.parent.getTooltipTemplate()(m,this,"tooltipTemplate",this.element.id+"tooltipTemplate")[0].outerHTML,e.template=f}else e.text=s+": "+h+(0===this.dataSourceSettings.columns.length?"":" <br/>"+this.parent.localeObj.getConstant("column")+": "+p)+(0===this.dataSourceSettings.rows.length?"":" <br/>"+this.parent.localeObj.getConstant("row")+": "+u),this.parent.trigger(k,e)},e.prototype.tooltipTemplateFn=function(){return this.templateFn},e.prototype.loaded=function(e){this.parent.isChartLoaded=!0;var i=this.parent.grid?this.parent.getGridWidthAsNumber().toString():this.parent.getWidthAsNumber().toString();if(this.parent.chart&&this.parent.showGroupingBar&&this.parent.groupingBarModule&&this.parent.showFieldList&&"Chart"===this.parent.currentView&&this.parent.groupingBarModule.alignIcon(),this.chartSettings.showMultiLevelLabels){var a=g.inArray(this.chartSettings.chartSeries.type,["Bar","StackingBar","StackingBar100"])>-1?"_chartYAxisMultiLevelLabel0":"_chartXAxisMultiLevelLabel0";t.isNullOrUndefined(t.select("#"+this.parent.element.id+a,this.parent.element))||this.parent.element.querySelector("#"+this.parent.element.id+a).setAttribute("cursor","pointer")}this.parent.chartSettings.enableScrollOnMultiAxis&&this.parent.chartSettings.enableMultipleAxis&&(["Pie","Funnel","Pyramid","Doughnut","Radar","Polar"].indexOf(this.parent.chartSettings.chartSeries.type)>=0?this.parent.element.querySelector("."+qa).style.overflow="visible":(this.parent.element.querySelector("."+qa).style.overflow="auto",this.parent.element.querySelector("."+qa).style.overflowX="hidden"),this.parent.element.querySelector("."+qa).style.width=i+"px"),this.parent.chart.height=["Pie","Funnel","Pyramid","Doughnut","Radar","Polar"].indexOf(this.parent.chartSettings.chartSeries.type)<0&&this.parent.chartSettings.enableScrollOnMultiAxis&&this.parent.chartSettings.enableMultipleAxis&&this.parent.dataSourceSettings.values.length>0?Number(this.parent.chart.height)>235*this.parent.dataSourceSettings.values.length+100?isNaN(Number(this.getChartHeight()))?this.getChartHeight().toString():(Number(this.getChartHeight())-5).toString():!isNaN(Number(this.getChartHeight()))||this.parent.dataSourceSettings.values.length>1?(235*this.parent.dataSourceSettings.values.length+100).toString():this.getChartHeight().toString():this.getChartHeight().toString(),this.updateView(),this.parent.notify(re,{}),this.parent.trigger("chartLoaded",e),("Server"===this.parent.dataSourceSettings.mode&&this.parent.isServerWaitingPopup||"Local"===this.parent.dataSourceSettings.mode)&&this.parent.hideWaitingPopup()},e.prototype.updateView=function(){if(this.parent.grid&&this.parent.chart&&this.parent.showToolbar)if("Table"===this.parent.currentView){if(this.parent.grid.element.style.display="",this.parent.chart.element.style.display="none",this.parent.showGroupingBar&&this.parent.groupingBarModule&&this.parent.element.querySelector(".e-pivot-grouping-bar")&&this.parent.element.querySelector(".e-chart-grouping-bar")){var e=this.parent.element.querySelector(".e-pivot-grouping-bar");e.style.display="",e&&e.querySelector("."+qt)&&null!=this.parent.groupingBarModule.gridPanel&&!this.parent.groupingBarModule.gridPanel.isDestroyed&&this.parent.groupingBarModule.gridPanel.refreshOverflow(),this.parent.element.querySelector(".e-chart-grouping-bar").style.display="none"}this.parent.chartSettings.enableMultipleAxis&&this.parent.chartSettings.enableScrollOnMultiAxis&&(this.parent.element.querySelector(".e-pivotchart").style.display="none")}else{if(this.parent.grid.element.style.display="none",this.parent.chart.element.style.display="",this.parent.showGroupingBar&&this.parent.groupingBarModule&&this.parent.element.querySelector(".e-pivot-grouping-bar")&&this.parent.element.querySelector(".e-chart-grouping-bar")){this.parent.element.querySelector(".e-pivot-grouping-bar").style.display="none";var t=this.parent.element.querySelector(".e-chart-grouping-bar");t.style.display="",t&&t.querySelector("."+qt)&&null!=this.parent.groupingBarModule.chartPanel&&!this.parent.groupingBarModule.chartPanel.isDestroyed&&this.parent.groupingBarModule.chartPanel.refreshOverflow()}this.parent.chartSettings.enableMultipleAxis&&this.parent.chartSettings.enableScrollOnMultiAxis&&(this.parent.element.querySelector(".e-pivotchart").style.display="")}},e.prototype.creatMenu=function(){this.accumulationMenu&&!this.accumulationMenu.isDestroyed&&this.accumulationMenu.destroy();for(var e=(this.parent.allowDrillThrough||this.parent.editSettings.allowEditing)&&this.parent.drillThroughModule?["expand","collapse","drillThrough","exit"]:["expand","collapse","exit"],i=[],a=0;a<e.length;a++)i.push({id:this.parent.element.id+"_DrillMenuChart_"+e[a],text:this.parent.localeObj.getConstant(e[a]),items:[]});var r=this.getMenuItems(),o=[],s=[];for(a=0;a<r.length;a++)"expand"===r[a].type?o.push({id:this.element.id+"drillExpand_"+r[a].key,text:r[a].value}):s.push({id:this.element.id+"drillCollapse_"+r[a].key,text:r[a].value});o.length>0&&(i[0].items=o),s.length>0&&(i[1].items=s);var l={cssClass:this.parent.element.id+"_accumulationChart",items:i,enableRtl:this.parent.enableRtl,beforeOpen:this.drillMenuOpen.bind(this),select:this.drillMenuSelect.bind(this),locale:this.parent.locale};this.accumulationMenu=new n.ContextMenu(l);var d;t.select("#"+this.parent.element.id+"_accumulationChart",this.parent.element)?(d=t.select("#"+this.parent.element.id+"_accumulationChart",this.parent.element)).innerHTML="":(d=t.createElement("ul",{id:this.parent.element.id+"_accumulationChart"}),this.parent.element.appendChild(d)),this.accumulationMenu.isStringTemplate=!0,this.accumulationMenu.appendTo(d)},e.prototype.drillMenuOpen=function(e){e.items[0]&&e.items[0].text===this.parent.localeObj.getConstant("expand")&&e.items[0].items&&0===e.items[0].items.length&&this.accumulationMenu.enableItems([this.parent.localeObj.getConstant("expand")],!1),e.items[1]&&e.items[1].text===this.parent.localeObj.getConstant("collapse")&&e.items[1].items&&0===e.items[1].items.length&&this.accumulationMenu.enableItems([this.parent.localeObj.getConstant("collapse")],!1)},e.prototype.getMenuItems=function(){for(var e=this.pivotIndex.rIndex,t=[],i=this.engineModule.pivotValues,a=[],r=i[e][this.pivotIndex.cIndex],n=!i[e][0].isNamedSet&&i[e][0].hasChild?i[e][0].level:void 0,o="olap"===this.parent.dataType?r.rowHeaders.toString().split(/~~|::/):r.rowHeaders.toString().split(this.engineModule.valueSortSettings.headerDelimiter);i[e][0];){if(r=i[e][0],0!==o.length&&o.indexOf(r.formattedText.toString())===o.length-1){r.hasChild&&!r.isNamedSet&&a.indexOf(r.level)<0&&(n?n>=r.level:0!==n||0===r.level)&&(r.isDrilled&&r.hasChild?t.push({key:e,type:"collapse",value:r.formattedText}):t.push({key:e,type:"expand",value:r.formattedText}),a.push(r.level),n=n?n-1:r.level-1);var s=o.indexOf(r.formattedText.toString());o.splice(s,1)}0===r.level&&r.hasChild&&!r.isNamedSet&&(n=void 0,a=[]),e--}return t},e.prototype.drillMenuSelect=function(e){var t="olap"===this.parent.dataType?this.parent.olapEngineModule.pivotValues:this.parent.engineModule.pivotValues,i=e.element.id.split("_DrillMenuChart_")[1];if(0===e.element.id.indexOf(this.element.id+"drill")){var a=e.element.id.split(this.element.id+"drill")[1].indexOf("Expand")>=0?"drillExpand":"drillCollapse",r=Number(e.element.id.split(this.element.id+a+"_")[1]),n=t[r][0],o="olap"===this.parent.dataType?n.formattedText:n.actualText?n.actualText.toString():n.formattedText.toString(),s=n.formattedText?n.formattedText.toString():o,l=n.hasChild&&!n.isNamedSet?(n.isDrilled?" - ":" + ")+s:s,d="olap"===this.parent.dataType?this.engineModule.tupRowInfo[n.ordinal]:void 0,h=d?d.uNameCollection:n.valueSort.levelName.toString(),p={fieldName:n.valueSort.axis,level:n.level,hasChild:n.hasChild,levelName:h,name:o,text:l,rowIndex:r,colIndex:0,isDrilled:n.isDrilled,cell:n};"olap"===this.parent.dataType?this.parent.onDrill(void 0,p):this.onDrill({customAttributes:p})}else"drillThrough"===i?this.parent.drillThroughModule.executeDrillThrough(t[this.pivotIndex.rIndex][this.pivotIndex.cIndex],this.pivotIndex.rIndex,this.pivotIndex.rIndex):"exit"===i&&this.accumulationMenu.close()},e.prototype.getChartHeight=function(){var e,i;if(t.isNullOrUndefined(this.parent.getHeightAsNumber()))e="auto";else{var a=this.parent.showToolbar?6:5;e=(this.parent.getHeightAsNumber()-a).toString(),i=this.parent.getHeightAsNumber()-a}if(t.isNullOrUndefined(this.parent.getHeightAsNumber()))e="auto";else{var r=!1;null!==this.parent.element.querySelector(".e-chart-grouping-bar")&&"none"===this.parent.element.querySelector(".e-chart-grouping-bar").style.display.toLowerCase()&&(r=!0,this.parent.element.querySelector(".e-chart-grouping-bar").style.display="block"),this.parent.showToolbar&&this.parent.showGroupingBar?e=(i-(this.parent.element.querySelector(".e-pivot-toolbar")?this.parent.element.querySelector(".e-pivot-toolbar").clientHeight:42)-(this.parent.element.querySelector(".e-chart-grouping-bar")?this.parent.element.querySelector(".e-chart-grouping-bar").clientHeight:62)).toString():this.parent.showToolbar?e=(i-(this.parent.element.querySelector(".e-pivot-toolbar")?this.parent.element.querySelector(".e-pivot-toolbar").clientHeight:42)).toString():this.parent.showGroupingBar?e=(i-(this.parent.element.querySelector(".e-chart-grouping-bar")?this.parent.element.querySelector(".e-chart-grouping-bar").clientHeight:62)).toString():(this.parent.chart&&parseInt(this.parent.chart.height,10)<200||i<200)&&(e="200"),r&&(this.parent.element.querySelector(".e-chart-grouping-bar").style.display="none")}return e},e.prototype.getChartAutoHeight=function(){var e=this.parent.element.offsetHeight;return this.parent.showToolbar&&this.parent.showGroupingBar?e=this.parent.element.offsetHeight-(this.parent.element.querySelector(".e-pivot-toolbar")?this.parent.element.querySelector(".e-pivot-toolbar").clientHeight:42)-(this.parent.element.querySelector(".e-chart-grouping-bar")?this.parent.element.querySelector(".e-chart-grouping-bar").clientHeight:62):this.parent.showToolbar?e=this.parent.element.offsetHeight-(this.parent.element.querySelector(".e-pivot-toolbar")?this.parent.element.querySelector(".e-pivot-toolbar").clientHeight:42):this.parent.showGroupingBar&&(e=this.parent.element.offsetHeight-(this.parent.element.querySelector(".e-chart-grouping-bar")?this.parent.element.querySelector(".e-chart-grouping-bar").clientHeight:62)),e},e.prototype.axisLabelRender=function(e){this.chartSettings.showMultiLevelLabels&&"Pareto"!==this.chartSettings.chartSeries.type&&"primaryXAxis"===e.axis.name&&(e.text=""),this.parent.trigger(q,e)},e.prototype.multiLevelLabelClick=function(e){var i={axis:e.axis,text:e.text,cell:t.isNullOrUndefined(e.customAttributes)?void 0:e.customAttributes.cell,cancel:!1};this.parent.trigger(I,i),!i.cancel&&e.customAttributes&&e.customAttributes.hasChild&&!e.customAttributes.cell.isNamedSet&&("olap"===this.parent.dataType?this.parent.onDrill(void 0,e.customAttributes):this.onDrill(e))},e.prototype.onDrill=function(e){var t=e.customAttributes,i=this.dataSourceSettings.drilledMembers[0]&&this.dataSourceSettings.drilledMembers[0].delimiter?this.dataSourceSettings.drilledMembers[0].delimiter:"**",a=t.fieldName,r=this.engineModule.pivotValues[t.rowIndex][t.colIndex],n=r.valueSort.levelName.split(this.engineModule.valueSortSettings.headerDelimiter).join(i),o=!1;if(0===this.dataSourceSettings.drilledMembers.length)this.parent.setProperties({dataSourceSettings:{drilledMembers:[{name:a,items:[n],delimiter:i}]}},!0);else{for(var s=0;s<this.dataSourceSettings.drilledMembers.length;s++){var l=this.dataSourceSettings.drilledMembers[s];if(n=n.split(i).join(l.delimiter?l.delimiter:i),i=l.delimiter=l.delimiter?l.delimiter:i,l.name===a){o=!0;var d=l.items.indexOf(n);d>-1?l.items.splice(d,1):l.items.push(n)}}o||this.dataSourceSettings.drilledMembers.push({name:a,items:[n],delimiter:i})}this.parent.showWaitingPopup();var h={fieldName:a,memberName:n,delimiter:i,axis:"row",action:t.isDrilled?"up":"down",currentCell:r},p={drillInfo:h,pivotview:this.parent};this.parent.trigger("drill",p);var u={dataSourceSettings:g.getClonedDataSourceSettings(this.parent.dataSourceSettings)};this.parent.trigger(v,u),this.parent.setProperties({dataSourceSettings:u.dataSourceSettings},!0),this.parent.enableVirtualization?"Server"===this.parent.dataSourceSettings.mode?this.parent.getEngine("onDrill",h,null,null,null,null,null):(this.engineModule.drilledMembers=this.dataSourceSettings.drilledMembers,this.engineModule.onDrill(h)):"Server"===this.parent.dataSourceSettings.mode?this.parent.getEngine("onDrill",h,null,null,null,null,null):this.engineModule.generateGridData(this.dataSourceSettings,!0),this.parent.allowServerDataBinding=!1,this.parent.setProperties({pivotValues:this.engineModule.pivotValues},!0),delete this.parent.bulkChanges.pivotValues,this.parent.allowServerDataBinding=!0;var c={dataSourceSettings:g.getClonedDataSourceSettings(this.parent.dataSourceSettings),pivotValues:this.parent.pivotValues};this.parent.trigger(S,c),this.engineModule.pivotValues=c.pivotValues,this.parent.renderPivotGrid()},e.prototype.isAttributeDrill=function(e,t){for(var i=!1,a=0;a<this.dataSourceSettings.drilledMembers.length;a++)if(this.dataSourceSettings.drilledMembers[a].name===e)for(var r=0;r<this.dataSourceSettings.drilledMembers[a].items.length;r++){for(var n=this.dataSourceSettings.drilledMembers[a].items[r].split(this.dataSourceSettings.drilledMembers[a].delimiter),o="",s=0;s<n.length;s++)t[s]&&t[s].uName&&(o=o+(""===o?"":this.dataSourceSettings.drilledMembers[a].delimiter)+(t[s].uName.indexOf("[Measures]")>-1?"[Measures]":t[s].uName));if(o===this.dataSourceSettings.drilledMembers[a].items[r]){i=!0;break}}return i},e.prototype.load=function(e){e.chart.zoomModule&&(e.chart.zoomModule.isZoomed=!0),this.parent.trigger("chartLoad",e)},e.prototype.resized=function(e){this.accumulationType.indexOf(this.chartSettings.chartSeries.type)<0&&(e.chart.primaryXAxis.zoomFactor=t.isNullOrUndefined(this.parent.chartSettings.primaryXAxis.zoomFactor)?this.getZoomFactor():this.parent.chartSettings.primaryXAxis.zoomFactor,this.parent.chartSettings.zoomSettings.enableScrollbar||(e.chart.primaryXAxis.zoomFactor=t.isNullOrUndefined(this.parent.chartSettings.primaryXAxis.zoomFactor)?1:this.parent.chartSettings.primaryXAxis.zoomFactor)),this.parent.trigger("chartResized",e)},e.prototype.destroy=function(){this.parent&&this.parent.isDestroyed||(this.engineModule&&!this.parent.destroyEngine&&(this.engineModule.fieldList={},this.engineModule={}),this.chartSeries&&(this.chartSeries=null),this.columnGroupObject&&(this.columnGroupObject=null),this.chartSettings&&(this.chartSettings=null),this.dataSourceSettings&&(this.dataSourceSettings=null),this.accumulationMenu&&!this.accumulationMenu.isDestroyed&&(this.accumulationMenu.destroy(),this.accumulationMenu=null),this.parent&&this.parent.chart&&!this.parent.chart.isDestroyed&&(this.parent.chart.destroy(),this.parent.chart=null))},e}();!function(e){e.axisLabelFont={size:"12px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.axisTitleFont={size:"14px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.chartTitleFont={size:"15px",fontWeight:"500",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.chartSubTitleFont={size:"11px",fontWeight:"500",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.crosshairLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.tooltipLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.legendLabelFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"},e.stripLineLabelFont={size:"12px",fontWeight:"Regular",color:"#353535",fontStyle:"Normal",fontFamily:"Segoe UI"},e.stockEventFont={size:"13px",fontWeight:"Normal",color:null,fontStyle:"Normal",fontFamily:"Segoe UI"}}(e.Theme||(e.Theme={}));var Pr=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function a(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),Fr=function(e,t,i,a){var r,n=arguments.length,o=n<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},Ir=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(!0)],i.prototype,"enable",void 0),Fr([t.Property(1e3)],i.prototype,"duration",void 0),Fr([t.Property(0)],i.prototype,"delay",void 0),i}(t.ChildProperty),Lr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(null)],i.prototype,"value",void 0),Fr([t.Property(null)],i.prototype,"color",void 0),Fr([t.Property("0")],i.prototype,"dashArray",void 0),i}(t.ChildProperty),Ar=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property("Normal")],i.prototype,"fontStyle",void 0),Fr([t.Property("16px")],i.prototype,"size",void 0),Fr([t.Property("Normal")],i.prototype,"fontWeight",void 0),Fr([t.Property("")],i.prototype,"color",void 0),Fr([t.Property("Center")],i.prototype,"textAlignment",void 0),Fr([t.Property("Segoe UI")],i.prototype,"fontFamily",void 0),Fr([t.Property(1)],i.prototype,"opacity",void 0),Fr([t.Property("Trim")],i.prototype,"textOverflow",void 0),i}(t.ChildProperty),Rr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(10)],i.prototype,"left",void 0),Fr([t.Property(10)],i.prototype,"right",void 0),Fr([t.Property(10)],i.prototype,"top",void 0),Fr([t.Property(10)],i.prototype,"bottom",void 0),i}(t.ChildProperty),jr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property("")],i.prototype,"color",void 0),Fr([t.Property(1)],i.prototype,"width",void 0),i}(t.ChildProperty),kr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(0)],i.prototype,"x",void 0),Fr([t.Property(0)],i.prototype,"y",void 0),i}(t.ChildProperty),qr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(0)],i.prototype,"series",void 0),Fr([t.Property(0)],i.prototype,"point",void 0),i}(t.ChildProperty),Vr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Complex({},jr)],i.prototype,"border",void 0),Fr([t.Property("transparent")],i.prototype,"background",void 0),Fr([t.Property(1)],i.prototype,"opacity",void 0),Fr([t.Property(null)],i.prototype,"backgroundImage",void 0),i}(t.ChildProperty),Hr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(!1)],i.prototype,"enable",void 0),Fr([t.Property("")],i.prototype,"dashArray",void 0),Fr([t.Complex({color:null,width:1},jr)],i.prototype,"line",void 0),Fr([t.Property("Both")],i.prototype,"lineType",void 0),i}(t.ChildProperty),Br=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(!1)],i.prototype,"visible",void 0),Fr([t.Property(null)],i.prototype,"name",void 0),Fr([t.Property("transparent")],i.prototype,"fill",void 0),Fr([t.Property(1)],i.prototype,"opacity",void 0),Fr([t.Property(0)],i.prototype,"angle",void 0),Fr([t.Property(!1)],i.prototype,"enableRotation",void 0),Fr([t.Property("Auto")],i.prototype,"position",void 0),Fr([t.Property(5)],i.prototype,"rx",void 0),Fr([t.Property(5)],i.prototype,"ry",void 0),Fr([t.Property("Center")],i.prototype,"alignment",void 0),Fr([t.Complex({width:null,color:null},jr)],i.prototype,"border",void 0),Fr([t.Complex({left:5,right:5,top:5,bottom:5},Rr)],i.prototype,"margin",void 0),Fr([t.Complex({size:"11px",color:"",fontStyle:"Normal",fontWeight:"Normal",fontFamily:"Segoe UI"},Ar)],i.prototype,"font",void 0),Fr([t.Property(null)],i.prototype,"template",void 0),i}(t.ChildProperty),_r=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property("Line")],i.prototype,"type",void 0),Fr([t.Property(null)],i.prototype,"color",void 0),Fr([t.Property(1)],i.prototype,"width",void 0),Fr([t.Property(null)],i.prototype,"length",void 0),Fr([t.Property("")],i.prototype,"dashArray",void 0),i}(t.ChildProperty),Ur=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(!0)],i.prototype,"visible",void 0),Fr([t.Complex({width:null,color:null},jr)],i.prototype,"border",void 0),Fr([t.Complex({size:"11px",color:"",fontStyle:"Normal",fontWeight:"Normal",fontFamily:"Segoe UI"},Ar)],i.prototype,"font",void 0),Fr([t.Property("transparent")],i.prototype,"fill",void 0),Fr([t.Property(0)],i.prototype,"angle",void 0),Fr([t.Property(!1)],i.prototype,"enableRotation",void 0),Fr([t.Property("Outside")],i.prototype,"position",void 0),Fr([t.Property(5)],i.prototype,"rx",void 0),Fr([t.Property(5)],i.prototype,"ry",void 0),Fr([t.Property(null)],i.prototype,"template",void 0),Fr([t.Complex({},_r)],i.prototype,"connectorStyle",void 0),i}(t.ChildProperty),Gr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(!1)],i.prototype,"visible",void 0),Fr([t.Property("Circle")],i.prototype,"shape",void 0),Fr([t.Property("")],i.prototype,"imageUrl",void 0),Fr([t.Property(5)],i.prototype,"width",void 0),Fr([t.Property(5)],i.prototype,"height",void 0),Fr([t.Complex({width:2,color:null},jr)],i.prototype,"border",void 0),Fr([t.Complex({x:0,y:0},kr)],i.prototype,"offset",void 0),Fr([t.Property(null)],i.prototype,"fill",void 0),Fr([t.Property(1)],i.prototype,"opacity",void 0),Fr([t.Complex({},Br)],i.prototype,"dataLabel",void 0),i}(t.ChildProperty),Wr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(1)],i.prototype,"width",void 0),Fr([t.Property(10)],i.prototype,"length",void 0),Fr([t.Property(null)],i.prototype,"color",void 0),Fr([t.Property(1)],i.prototype,"opacity",void 0),i}(t.ChildProperty),zr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(!1)],i.prototype,"visible",void 0),Fr([t.Property("Fixed")],i.prototype,"type",void 0),Fr([t.Property("Both")],i.prototype,"direction",void 0),Fr([t.Property("Vertical")],i.prototype,"mode",void 0),Fr([t.Property(1)],i.prototype,"verticalError",void 0),Fr([t.Property(null)],i.prototype,"color",void 0),Fr([t.Property(1)],i.prototype,"width",void 0),Fr([t.Property(1)],i.prototype,"horizontalError",void 0),Fr([t.Property(3)],i.prototype,"verticalNegativeError",void 0),Fr([t.Property(3)],i.prototype,"verticalPositiveError",void 0),Fr([t.Property(1)],i.prototype,"horizontalNegativeError",void 0),Fr([t.Property(1)],i.prototype,"horizontalPositiveError",void 0),Fr([t.Complex(null,Wr)],i.prototype,"errorBarCap",void 0),i}(t.ChildProperty),Qr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property("")],i.prototype,"name",void 0),Fr([t.Property("0")],i.prototype,"dashArray",void 0),Fr([t.Property(!0)],i.prototype,"visible",void 0),Fr([t.Property(2)],i.prototype,"period",void 0),Fr([t.Property("Linear")],i.prototype,"type",void 0),Fr([t.Property(0)],i.prototype,"backwardForecast",void 0),Fr([t.Property(0)],i.prototype,"forwardForecast",void 0),Fr([t.Property(2)],i.prototype,"polynomialOrder",void 0),Fr([t.Complex({},Gr)],i.prototype,"marker",void 0),Fr([t.Property(!0)],i.prototype,"enableTooltip",void 0),Fr([t.Complex({},Ir)],i.prototype,"animation",void 0),Fr([t.Property("")],i.prototype,"fill",void 0),Fr([t.Property(1)],i.prototype,"width",void 0),Fr([t.Property(null)],i.prototype,"intercept",void 0),Fr([t.Property("SeriesType")],i.prototype,"legendShape",void 0),i}(t.ChildProperty),Yr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(null)],i.prototype,"fill",void 0),Fr([t.Complex({color:"transparent",width:0},jr)],i.prototype,"border",void 0),Fr([t.Property("Gap")],i.prototype,"mode",void 0),i}(t.ChildProperty),Kr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(0)],i.prototype,"topLeft",void 0),Fr([t.Property(0)],i.prototype,"topRight",void 0),Fr([t.Property(0)],i.prototype,"bottomLeft",void 0),Fr([t.Property(0)],i.prototype,"bottomRight",void 0),i}(t.ChildProperty),Xr=function(i){function a(){return null!==i&&i.apply(this,arguments)||this}return Pr(a,i),Fr([t.Property(!1)],a.prototype,"enable",void 0),Fr([t.Property(null)],a.prototype,"fill",void 0),Fr([t.Complex(e.Theme.crosshairLabelFont,Ar)],a.prototype,"textStyle",void 0),a}(t.ChildProperty),Jr=function(i){function a(){return null!==i&&i.apply(this,arguments)||this}return Pr(a,i),Fr([t.Property(!0)],a.prototype,"visible",void 0),Fr([t.Property(!1)],a.prototype,"startFromAxis",void 0),Fr([t.Property(null)],a.prototype,"start",void 0),Fr([t.Property(null)],a.prototype,"end",void 0),Fr([t.Property(null)],a.prototype,"size",void 0),Fr([t.Property("#808080")],a.prototype,"color",void 0),Fr([t.Property(null)],a.prototype,"dashArray",void 0),Fr([t.Property("Auto")],a.prototype,"sizeType",void 0),Fr([t.Property(!1)],a.prototype,"isRepeat",void 0),Fr([t.Property(null)],a.prototype,"repeatEvery",void 0),Fr([t.Property(null)],a.prototype,"repeatUntil",void 0),Fr([t.Property(!1)],a.prototype,"isSegmented",void 0),Fr([t.Property(null)],a.prototype,"segmentStart",void 0),Fr([t.Property(null)],a.prototype,"segmentEnd",void 0),Fr([t.Property(null)],a.prototype,"segmentAxisName",void 0),Fr([t.Complex({color:"transparent",width:1},jr)],a.prototype,"border",void 0),Fr([t.Property("")],a.prototype,"text",void 0),Fr([t.Property(null)],a.prototype,"rotation",void 0),Fr([t.Property("Middle")],a.prototype,"horizontalAlignment",void 0),Fr([t.Property("Middle")],a.prototype,"verticalAlignment",void 0),Fr([t.Complex(e.Theme.stripLineLabelFont,Ar)],a.prototype,"textStyle",void 0),Fr([t.Property("Behind")],a.prototype,"zIndex",void 0),Fr([t.Property(1)],a.prototype,"opacity",void 0),a}(t.ChildProperty),Zr=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property("")],i.prototype,"color",void 0),Fr([t.Property(1)],i.prototype,"width",void 0),Fr([t.Property("Rectangle")],i.prototype,"type",void 0),i}(t.ChildProperty),$r=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(1)],i.prototype,"width",void 0),Fr([t.Property("")],i.prototype,"dashArray",void 0),Fr([t.Property(null)],i.prototype,"color",void 0),i}(t.ChildProperty),en=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(.7)],i.prototype,"width",void 0),Fr([t.Property("")],i.prototype,"dashArray",void 0),Fr([t.Property(null)],i.prototype,"color",void 0),i}(t.ChildProperty),tn=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(1)],i.prototype,"width",void 0),Fr([t.Property("")],i.prototype,"dashArray",void 0),Fr([t.Property(null)],i.prototype,"color",void 0),i}(t.ChildProperty),an=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(1)],i.prototype,"width",void 0),Fr([t.Property(5)],i.prototype,"height",void 0),Fr([t.Property(null)],i.prototype,"color",void 0),i}(t.ChildProperty),rn=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(.7)],i.prototype,"width",void 0),Fr([t.Property(5)],i.prototype,"height",void 0),Fr([t.Property(null)],i.prototype,"color",void 0),i}(t.ChildProperty),nn=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(0)],i.prototype,"x",void 0),Fr([t.Property(0)],i.prototype,"y",void 0),i}(t.ChildProperty),on=(function(){function e(){}Fr([t.Property("")],e.prototype,"color",void 0),Fr([t.Property(1)],e.prototype,"width",void 0)}(),function(){function e(){}Fr([t.Property(!0)],e.prototype,"enable",void 0),Fr([t.Property(1e3)],e.prototype,"duration",void 0),Fr([t.Property(0)],e.prototype,"delay",void 0)}(),function(){function e(){}Fr([t.Property(null)],e.prototype,"value",void 0),Fr([t.Property(null)],e.prototype,"color",void 0),Fr([t.Property("0")],e.prototype,"dashArray",void 0)}(),function(){function e(){}Fr([t.Property(!1)],e.prototype,"visible",void 0),Fr([t.Property("Circle")],e.prototype,"shape",void 0),Fr([t.Property("")],e.prototype,"imageUrl",void 0),Fr([t.Property(5)],e.prototype,"height",void 0),Fr([t.Property(5)],e.prototype,"width",void 0),Fr([t.Complex({width:2,color:null},jr)],e.prototype,"border",void 0),Fr([t.Property(null)],e.prototype,"fill",void 0),Fr([t.Property(1)],e.prototype,"opacity",void 0),Fr([t.Complex({},Br)],e.prototype,"dataLabel",void 0)}(),function(){function e(){}Fr([t.Property(!1)],e.prototype,"visible",void 0),Fr([t.Property("Fixed")],e.prototype,"type",void 0),Fr([t.Property("Both")],e.prototype,"direction",void 0),Fr([t.Property("Vertical")],e.prototype,"mode",void 0),Fr([t.Property(null)],e.prototype,"color",void 0),Fr([t.Property(1)],e.prototype,"verticalError",void 0),Fr([t.Property(1)],e.prototype,"width",void 0),Fr([t.Property(1)],e.prototype,"horizontalError",void 0),Fr([t.Property(3)],e.prototype,"verticalPositiveError",void 0),Fr([t.Property(3)],e.prototype,"verticalNegativeError",void 0),Fr([t.Property(1)],e.prototype,"horizontalPositiveError",void 0),Fr([t.Property(1)],e.prototype,"horizontalNegativeError",void 0),Fr([t.Complex(null,Wr)],e.prototype,"errorBarCap",void 0)}(),function(){function e(){}Fr([t.Property("")],e.prototype,"name",void 0),Fr([t.Property("Linear")],e.prototype,"type",void 0),Fr([t.Property(2)],e.prototype,"period",void 0),Fr([t.Property(2)],e.prototype,"polynomialOrder",void 0),Fr([t.Property(0)],e.prototype,"backwardForecast",void 0),Fr([t.Property(0)],e.prototype,"forwardForecast",void 0),Fr([t.Complex({},Ir)],e.prototype,"animation",void 0),Fr([t.Complex({},Gr)],e.prototype,"marker",void 0),Fr([t.Property(!0)],e.prototype,"enableTooltip",void 0),Fr([t.Property(null)],e.prototype,"intercept",void 0),Fr([t.Property("")],e.prototype,"fill",void 0),Fr([t.Property(1)],e.prototype,"width",void 0),Fr([t.Property("SeriesType")],e.prototype,"legendShape",void 0)}(),function(){function e(){}Fr([t.Property(null)],e.prototype,"fill",void 0),Fr([t.Complex({color:"transparent",width:0},jr)],e.prototype,"border",void 0),Fr([t.Property("Gap")],e.prototype,"mode",void 0)}(),function(){function e(){}Fr([t.Property(0)],e.prototype,"topLeft",void 0),Fr([t.Property(0)],e.prototype,"topRight",void 0),Fr([t.Property(0)],e.prototype,"bottomLeft",void 0),Fr([t.Property(0)],e.prototype,"bottomRight",void 0)}(),function(){function e(){}Fr([t.Property("Normal")],e.prototype,"fontStyle",void 0),Fr([t.Property("16px")],e.prototype,"size",void 0),Fr([t.Property("Normal")],e.prototype,"fontWeight",void 0),Fr([t.Property("")],e.prototype,"color",void 0),Fr([t.Property("Center")],e.prototype,"textAlignment",void 0),Fr([t.Property("Segoe UI")],e.prototype,"fontFamily",void 0),Fr([t.Property(1)],e.prototype,"opacity",void 0),Fr([t.Property("Trim")],e.prototype,"textOverflow",void 0)}(),function(){function i(){}Fr([t.Property(!1)],i.prototype,"enable",void 0),Fr([t.Property(null)],i.prototype,"fill",void 0),Fr([t.Complex(e.Theme.crosshairLabelFont,Ar)],i.prototype,"textStyle",void 0)}(),function(){function e(){}Fr([t.Property(1)],e.prototype,"width",void 0),Fr([t.Property(5)],e.prototype,"height",void 0),Fr([t.Property(null)],e.prototype,"color",void 0)}(),function(){function e(){}Fr([t.Property(1)],e.prototype,"width",void 0),Fr([t.Property("")],e.prototype,"dashArray",void 0),Fr([t.Property(null)],e.prototype,"color",void 0)}(),function(){function e(){}Fr([t.Property(.7)],e.prototype,"width",void 0),Fr([t.Property(5)],e.prototype,"height",void 0),Fr([t.Property(null)],e.prototype,"color",void 0)}(),function(){function e(){}Fr([t.Property(.7)],e.prototype,"width",void 0),Fr([t.Property("")],e.prototype,"dashArray",void 0),Fr([t.Property(null)],e.prototype,"color",void 0)}(),function(){function e(){}Fr([t.Property(1)],e.prototype,"width",void 0),Fr([t.Property("")],e.prototype,"dashArray",void 0),Fr([t.Property(null)],e.prototype,"color",void 0)}(),function(){function i(){}Fr([t.Property(!0)],i.prototype,"visible",void 0),Fr([t.Property(!1)],i.prototype,"startFromAxis",void 0),Fr([t.Property(null)],i.prototype,"start",void 0),Fr([t.Property(null)],i.prototype,"end",void 0),Fr([t.Property(null)],i.prototype,"size",void 0),Fr([t.Property("#808080")],i.prototype,"color",void 0),Fr([t.Property(null)],i.prototype,"dashArray",void 0),Fr([t.Property("Auto")],i.prototype,"sizeType",void 0),Fr([t.Property(!1)],i.prototype,"isRepeat",void 0),Fr([t.Property(null)],i.prototype,"repeatEvery",void 0),Fr([t.Property(null)],i.prototype,"repeatUntil",void 0),Fr([t.Property(!1)],i.prototype,"isSegmented",void 0),Fr([t.Property(null)],i.prototype,"segmentStart",void 0),Fr([t.Property(null)],i.prototype,"segmentEnd",void 0),Fr([t.Property(null)],i.prototype,"segmentAxisName",void 0),Fr([t.Complex({color:"transparent",width:1},jr)],i.prototype,"border",void 0),Fr([t.Property("")],i.prototype,"text",void 0),Fr([t.Property(null)],i.prototype,"rotation",void 0),Fr([t.Property("Middle")],i.prototype,"horizontalAlignment",void 0),Fr([t.Property("Middle")],i.prototype,"verticalAlignment",void 0),Fr([t.Complex(e.Theme.stripLineLabelFont,Ar)],i.prototype,"textStyle",void 0),Fr([t.Property("Behind")],i.prototype,"zIndex",void 0),Fr([t.Property(1)],i.prototype,"opacity",void 0)}(),function(){function e(){}Fr([t.Property("")],e.prototype,"color",void 0),Fr([t.Property(1)],e.prototype,"width",void 0),Fr([t.Property("Rectangle")],e.prototype,"type",void 0)}(),function(){function e(){}Fr([t.Complex({},jr)],e.prototype,"border",void 0),Fr([t.Property("transparent")],e.prototype,"background",void 0),Fr([t.Property(1)],e.prototype,"opacity",void 0)}(),function(){function e(){}Fr([t.Property(!1)],e.prototype,"enable",void 0),Fr([t.Property("")],e.prototype,"dashArray",void 0),Fr([t.Complex({color:null,width:1},jr)],e.prototype,"line",void 0),Fr([t.Property("Both")],e.prototype,"lineType",void 0)}(),function(){function i(){}Fr([t.Property(!0)],i.prototype,"visible",void 0),Fr([t.Property(null)],i.prototype,"height",void 0),Fr([t.Property(null)],i.prototype,"width",void 0),Fr([t.Complex({x:0,y:0},nn)],i.prototype,"location",void 0),Fr([t.Property("Auto")],i.prototype,"position",void 0),Fr([t.Property(8)],i.prototype,"padding",void 0),Fr([t.Property("Center")],i.prototype,"alignment",void 0),Fr([t.Complex(e.Theme.legendLabelFont,Ar)],i.prototype,"textStyle",void 0),Fr([t.Property(10)],i.prototype,"shapeHeight",void 0),Fr([t.Property(10)],i.prototype,"shapeWidth",void 0),Fr([t.Complex({},jr)],i.prototype,"border",void 0),Fr([t.Complex({left:0,right:0,top:0,bottom:0},Rr)],i.prototype,"margin",void 0),Fr([t.Property(5)],i.prototype,"shapePadding",void 0),Fr([t.Property("transparent")],i.prototype,"background",void 0),Fr([t.Property(1)],i.prototype,"opacity",void 0),Fr([t.Property(!0)],i.prototype,"toggleVisibility",void 0),Fr([t.Property(null)],i.prototype,"description",void 0),Fr([t.Property(3)],i.prototype,"tabIndex",void 0)}(),function(){function e(){}Fr([t.Property(0)],e.prototype,"series",void 0),Fr([t.Property(0)],e.prototype,"point",void 0)}(),function(){function e(){}Fr([t.Property(10)],e.prototype,"left",void 0),Fr([t.Property(10)],e.prototype,"right",void 0),Fr([t.Property(10)],e.prototype,"top",void 0),Fr([t.Property(10)],e.prototype,"bottom",void 0)}(),function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(null)],i.prototype,"fill",void 0),Fr([t.Property(null)],i.prototype,"endAngle",void 0),Fr([t.Property(!1)],i.prototype,"explode",void 0),Fr([t.Property(!1)],i.prototype,"explodeAll",void 0),Fr([t.Property(null)],i.prototype,"explodeIndex",void 0),Fr([t.Property(null)],i.prototype,"innerRadius",void 0),Fr([t.Property("30%")],i.prototype,"explodeOffset",void 0),Fr([t.Property(0)],i.prototype,"gapRatio",void 0),Fr([t.Property("Value")],i.prototype,"groupMode",void 0),Fr([t.Property(null)],i.prototype,"groupTo",void 0),Fr([t.Property("20%")],i.prototype,"neckHeight",void 0),Fr([t.Property("20%")],i.prototype,"neckWidth",void 0),Fr([t.Property("Linear")],i.prototype,"pyramidMode",void 0),Fr([t.Property([])],i.prototype,"palettes",void 0),Fr([t.Property(0)],i.prototype,"startAngle",void 0),Fr([t.Complex(null,Ir)],i.prototype,"animation",void 0),Fr([t.Complex(null,Ur)],i.prototype,"dataLabel",void 0),Fr([t.Property("0")],i.prototype,"dashArray",void 0),Fr([t.Property(1)],i.prototype,"width",void 0),Fr([t.Property("X")],i.prototype,"segmentAxis",void 0),Fr([t.Property("Line")],i.prototype,"drawType",void 0),Fr([t.Property(!0)],i.prototype,"isClosed",void 0),Fr([t.Collection([],Lr)],i.prototype,"segments",void 0),Fr([t.Property("")],i.prototype,"stackingGroup",void 0),Fr([t.Complex({color:"transparent",width:0},jr)],i.prototype,"border",void 0),Fr([t.Property(!0)],i.prototype,"visible",void 0),Fr([t.Property(1)],i.prototype,"opacity",void 0),Fr([t.Property("Line")],i.prototype,"type",void 0),Fr([t.Complex(null,Gr)],i.prototype,"marker",void 0),Fr([t.Complex(null,zr)],i.prototype,"errorBar",void 0),Fr([t.Property(!0)],i.prototype,"enableTooltip",void 0),Fr([t.Collection([],Qr)],i.prototype,"trendlines",void 0),Fr([t.Property("")],i.prototype,"tooltipMappingName",void 0),Fr([t.Property("SeriesType")],i.prototype,"legendShape",void 0),Fr([t.Property(1)],i.prototype,"minRadius",void 0),Fr([t.Property(null)],i.prototype,"selectionStyle",void 0),Fr([t.Property("Natural")],i.prototype,"splineType",void 0),Fr([t.Property(3)],i.prototype,"maxRadius",void 0),Fr([t.Property(.5)],i.prototype,"cardinalSplineTension",void 0),Fr([t.Property(null)],i.prototype,"columnWidth",void 0),Fr([t.Complex(null,Yr)],i.prototype,"emptyPointSettings",void 0),Fr([t.Complex(null,Kr)],i.prototype,"cornerRadius",void 0),Fr([t.Property(0)],i.prototype,"columnSpacing",void 0),i}(t.ChildProperty)),sn=function(i){function a(){return null!==i&&i.apply(this,arguments)||this}return Pr(a,i),Fr([t.Property("Rotate45")],a.prototype,"labelIntersectAction",void 0),Fr([t.Complex(e.Theme.axisLabelFont,Ar)],a.prototype,"labelStyle",void 0),Fr([t.Property("")],a.prototype,"title",void 0),Fr([t.Property(1)],a.prototype,"zoomFactor",void 0),Fr([t.Complex({},Xr)],a.prototype,"crosshairTooltip",void 0),Fr([t.Property("")],a.prototype,"labelFormat",void 0),Fr([t.Complex(e.Theme.axisTitleFont,Ar)],a.prototype,"titleStyle",void 0),Fr([t.Property(!1)],a.prototype,"isIndexed",void 0),Fr([t.Property(0)],a.prototype,"plotOffset",void 0),Fr([t.Property("Shift")],a.prototype,"edgeLabelPlacement",void 0),Fr([t.Property("BetweenTicks")],a.prototype,"labelPlacement",void 0),Fr([t.Property("Outside")],a.prototype,"tickPosition",void 0),Fr([t.Property(!1)],a.prototype,"opposedPosition",void 0),Fr([t.Property(!0)],a.prototype,"visible",void 0),Fr([t.Property("Outside")],a.prototype,"labelPosition",void 0),Fr([t.Property(0)],a.prototype,"labelRotation",void 0),Fr([t.Property(0)],a.prototype,"minorTicksPerInterval",void 0),Fr([t.Property(null)],a.prototype,"maximum",void 0),Fr([t.Property(null)],a.prototype,"minimum",void 0),Fr([t.Property(34)],a.prototype,"maximumLabelWidth",void 0),Fr([t.Property(null)],a.prototype,"interval",void 0),Fr([t.Complex({},an)],a.prototype,"majorTickLines",void 0),Fr([t.Property(!1)],a.prototype,"enableTrim",void 0),Fr([t.Complex({},$r)],a.prototype,"majorGridLines",void 0),Fr([t.Complex({},rn)],a.prototype,"minorTickLines",void 0),Fr([t.Complex({},tn)],a.prototype,"lineStyle",void 0),Fr([t.Complex({},en)],a.prototype,"minorGridLines",void 0),Fr([t.Property(!1)],a.prototype,"isInversed",void 0),Fr([t.Property(null)],a.prototype,"description",void 0),Fr([t.Property(0)],a.prototype,"startAngle",void 0),Fr([t.Property(100)],a.prototype,"coefficient",void 0),Fr([t.Collection([],Jr)],a.prototype,"stripLines",void 0),Fr([t.Property(2)],a.prototype,"tabIndex",void 0),Fr([t.Complex({color:null,width:0,type:"Rectangle"},Zr)],a.prototype,"border",void 0),a}(t.ChildProperty),ln=function(i){function a(){return null!==i&&i.apply(this,arguments)||this}return Pr(a,i),Fr([t.Property(!1)],a.prototype,"enableMarker",void 0),Fr([t.Property(!0)],a.prototype,"enable",void 0),Fr([t.Property(null)],a.prototype,"fill",void 0),Fr([t.Property(!1)],a.prototype,"shared",void 0),Fr([t.Property(.75)],a.prototype,"opacity",void 0),Fr([t.Property(null)],a.prototype,"header",void 0),Fr([t.Property(null)],a.prototype,"format",void 0),Fr([t.Complex(e.Theme.tooltipLabelFont,Ar)],a.prototype,"textStyle",void 0),Fr([t.Property(null)],a.prototype,"template",void 0),Fr([t.Complex({color:"#cccccc",width:.5},jr)],a.prototype,"border",void 0),Fr([t.Property(!0)],a.prototype,"enableAnimation",void 0),a}(t.ChildProperty),dn=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property("50%")],i.prototype,"x",void 0),Fr([t.Property("50%")],i.prototype,"y",void 0),i}(t.ChildProperty),hn=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Pr(i,e),Fr([t.Property(!1)],i.prototype,"enablePinchZooming",void 0),Fr([t.Property(!0)],i.prototype,"enableSelectionZooming",void 0),Fr([t.Property(!1)],i.prototype,"enableDeferredZooming",void 0),Fr([t.Property(!1)],i.prototype,"enableMouseWheelZooming",void 0),Fr([t.Property("XY")],i.prototype,"mode",void 0),Fr([t.Property(["Zoom","ZoomIn","ZoomOut","Pan","Reset"])],i.prototype,"toolbarItems",void 0),Fr([t.Property(!0)],i.prototype,"enableScrollbar",void 0),Fr([t.Property(!1)],i.prototype,"enablePan",void 0),i}(t.ChildProperty),pn=function(i){function a(){return null!==i&&i.apply(this,arguments)||this}return Pr(a,i),Fr([t.Complex({},on)],a.prototype,"chartSeries",void 0),Fr([t.Complex({},sn)],a.prototype,"primaryXAxis",void 0),Fr([t.Complex({},sn)],a.prototype,"primaryYAxis",void 0),Fr([t.Property("")],a.prototype,"value",void 0),Fr([t.Property("")],a.prototype,"columnHeader",void 0),Fr([t.Property("-")],a.prototype,"columnDelimiter",void 0),Fr([t.Property(!1)],a.prototype,"enableMultiAxis",void 0),Fr([t.Property(!1)],a.prototype,"enableMultipleAxis",void 0),Fr([t.Property("Stacked")],a.prototype,"multipleAxisMode",void 0),Fr([t.Property(!1)],a.prototype,"enableScrollOnMultiAxis",void 0),Fr([t.Complex(e.Theme.chartTitleFont,Ar)],a.prototype,"titleStyle",void 0),Fr([t.Property("")],a.prototype,"title",void 0),Fr([t.Complex(e.Theme.chartSubTitleFont,Ar)],a.prototype,"subTitleStyle",void 0),Fr([t.Property("")],a.prototype,"subTitle",void 0),Fr([t.Complex({color:"#DDDDDD",width:0},jr)],a.prototype,"border",void 0),Fr([t.Complex({},Rr)],a.prototype,"margin",void 0),Fr([t.Complex({border:{color:null,width:.5},background:"transparent"},Vr)],a.prototype,"chartArea",void 0),Fr([t.Property(null)],a.prototype,"background",void 0),Fr([t.Property("Material")],a.prototype,"theme",void 0),Fr([t.Property([])],a.prototype,"palettes",void 0),Fr([t.Complex({},Hr)],a.prototype,"crosshair",void 0),Fr([t.Complex({},ln)],a.prototype,"tooltip",void 0),Fr([t.Complex(null,dn)],a.prototype,"pieCenter",void 0),Fr([t.Complex({},hn)],a.prototype,"zoomSettings",void 0),Fr([t.Property()],a.prototype,"legendSettings",void 0),Fr([t.Property("None")],a.prototype,"selectionMode",void 0),Fr([t.Property("None")],a.prototype,"accumulationSelectionMode",void 0),Fr([t.Property(!0)],a.prototype,"enableSmartLabels",void 0),Fr([t.Property(!0)],a.prototype,"enableBorderOnMouseMove",void 0),Fr([t.Property("None")],a.prototype,"highlightMode",void 0),Fr([t.Property("None")],a.prototype,"highlightPattern",void 0),Fr([t.Property(!0)],a.prototype,"enableExport",void 0),Fr([t.Property(!1)],a.prototype,"isMultiSelect",void 0),Fr([t.Collection([],qr)],a.prototype,"selectedDataIndexes",void 0),Fr([t.Property(!0)],a.prototype,"enableAnimation",void 0),Fr([t.Property(!1)],a.prototype,"enableCanvas",void 0),Fr([t.Property(!0)],a.prototype,"useGroupingSeparator",void 0),Fr([t.Property(!1)],a.prototype,"isTransposed",void 0),Fr([t.Property(1)],a.prototype,"tabIndex",void 0),Fr([t.Property(null)],a.prototype,"description",void 0),Fr([t.Event()],a.prototype,"resized",void 0),Fr([t.Property(!0)],a.prototype,"enableSideBySidePlacement",void 0),Fr([t.Event()],a.prototype,"loaded",void 0),Fr([t.Event()],a.prototype,"beforePrint",void 0),Fr([t.Event()],a.prototype,"animationComplete",void 0),Fr([t.Event()],a.prototype,"load",void 0),Fr([t.Event()],a.prototype,"textRender",void 0),Fr([t.Event()],a.prototype,"legendRender",void 0),Fr([t.Event()],a.prototype,"seriesRender",void 0),Fr([t.Event()],a.prototype,"multiLevelLabelRender",void 0),Fr([t.Event()],a.prototype,"pointRender",void 0),Fr([t.Event()],a.prototype,"tooltipRender",void 0),Fr([t.Event()],a.prototype,"axisLabelRender",void 0),Fr([t.Event()],a.prototype,"multiLevelLabelClick",void 0),Fr([t.Event()],a.prototype,"chartMouseClick",void 0),Fr([t.Event()],a.prototype,"chartMouseMove",void 0),Fr([t.Event()],a.prototype,"pointMove",void 0),Fr([t.Event()],a.prototype,"pointClick",void 0),Fr([t.Event()],a.prototype,"chartMouseDown",void 0),Fr([t.Event()],a.prototype,"chartMouseLeave",void 0),Fr([t.Event()],a.prototype,"dragComplete",void 0),Fr([t.Event()],a.prototype,"chartMouseUp",void 0),Fr([t.Event()],a.prototype,"scrollStart",void 0),Fr([t.Event()],a.prototype,"zoomComplete",void 0),Fr([t.Event()],a.prototype,"scrollChanged",void 0),Fr([t.Event()],a.prototype,"scrollEnd",void 0),Fr([t.Property(!0)],a.prototype,"showMultiLevelLabels",void 0),a}(t.ChildProperty),un=function(){function e(){}return e.getCellSets=function(e,i,a,r,n){this.engine=i,this.isMondrian=i.isMondrian,this.isMeasureAvail=i.isMeasureAvail,this.isPaging=i.isPaging,this.pageSettings=i.pageSettings,this.rows=i.rows,this.columns=i.columns,this.values=i.values,this.filters=i.filters,this.allowLabelFilter=i.allowLabelFilter,this.allowValueFilter=i.allowValueFilter,this.valueSortSettings=e.valueSortSettings?e.valueSortSettings:void 0,this.drilledMembers=i.updateDrilledItems(e.drilledMembers),this.calculatedFieldSettings=i.calculatedFieldSettings,this.valueAxis="row"===e.valueAxis?"rows":"columns",r&&(r.axis="row"===r.axis?"rows":"columns"),this.filterMembers=t.extend({},i.filterMembers,null,!0),this.fieldDataObj=i.fieldListObj,this.fieldList=i.fieldList,this.cellSetInfo="\nDIMENSION PROPERTIES PARENT_UNIQUE_NAME, HIERARCHY_UNIQUE_NAME, CHILDREN_CARDINALITY, MEMBER_TYPE, MEMBER_VALUE";var o=this.getMeasuresQuery(this.values),s=this.getDimensionsQuery(this.rows,o,"rows",r).replace(/\&/g,"&amp;"),l=this.getDimensionsQuery(this.columns,o,"columns",r).replace(/\&/g,"&amp;");if(this.isPaging&&a&&void 0!==this.pageSettings){s=(d=this.getPagingQuery(s,l)).rowQuery,l=d.columnQuery}else if(this.isPaging&&!a&&void 0!==this.pageSettings){var d;s=(d=this.getPagingCountQuery(s,l)).rowQuery,l=d.columnQuery}s=s.length>0?s+(this.isPaging&&!a?"":this.cellSetInfo+" ON ROWS"):"",l=l.length>0?l+(this.isPaging&&!a?"":this.cellSetInfo+" ON COLUMNS"):"";var h=this.getSlicersQuery(this.filters,"filters").replace(/\&/g,"&amp;"),p=this.getfilterQuery(this.filterMembers,e.cube).replace(/\&/g,"&amp;").replace(/\>/g,"&gt;").replace(/\</g,"&lt;"),u=this.getCalculatedFieldQuery(this.calculatedFieldSettings).replace(/\&/g,"&amp;"),c=this.frameMDXQuery(s,l,h,p,u,a),g={catalog:e.catalog,cube:e.cube,url:e.url,request:c,LCID:e.localeIdentifier.toString()};i.mdxQuery=c.replace(/\&amp;/g,"&").replace(/\&gt;/g,">").replace(/\&lt;/g,"<").replace(/%280/g,'"'),r&&(r.axis="rows"===r.axis?"row":"column"),n||this.getTableCellData(g,this.isPaging&&!a?this.engine.generatePagingData.bind(this.engine):this.engine.generateEngine.bind(this.engine),r?{action:r.action,drillInfo:r}:{dataSourceSettings:e,action:"loadTableElements"})},e.getTableCellData=function(e,t,i){var a=this.engine.getConnectionInfo(e.url,e.LCID),r='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"> <Header></Header> <Body> <Execute xmlns="urn:schemas-microsoft-com:xml-analysis"> <Command> <Statement>'+e.request+"</Statement> </Command> <Properties> <PropertyList> <Catalog>"+e.catalog+"</Catalog> <LocaleIdentifier>"+a.LCID+"</LocaleIdentifier> </PropertyList> </Properties></Execute> </Body> </Envelope>";this.engine.doAjaxPost("POST",a.url,r,t,i)},e.frameMDXQuery=function(e,t,i,a,r,n){var o=this.isPaging&&!n?""!==r?"":"\nWITH":"\nSelect ";return t.length>0&&(o+=t),e.length>0&&(o=o+(t.length>0?this.isPaging&&!n?"":", ":"")+e),o=r+o+(this.isPaging&&!n?"\nMEMBER [Measures].[3d268ce0-664d-4092-b9cb-fece97175006] AS Count([e16a30d0-2174-4874-8dae-a5085a75a3e2]) MEMBER [Measures].[8d7fe8c1-f09f-410e-b9ba-eaab75a1fc3e] AS Count ([d1876d2b-e50e-4547-85fe-5b8ed9d629de])\nSELECT { [Measures].[3d268ce0-664d-4092-b9cb-fece97175006] , [Measures].[8d7fe8c1-f09f-410e-b9ba-eaab75a1fc3e] } ON AXIS(0)":"")+a+i+"\nCELL PROPERTIES VALUE, FORMAT_STRING, FORMATTED_VALUE\n"},e.getPagingQuery=function(e,t){e=e.replace("NON EMPTY ( ","").slice(0,-1),t=t.replace("NON EMPTY ( ","").slice(0,-1);var i=e,a=(this.pageSettings.rowCurrentPage-1)*this.pageSettings.rowSize,r=(this.pageSettings.columnCurrentPage-1)*this.pageSettings.columnSize,n=3*this.pageSettings.rowSize,o=3*this.pageSettings.columnSize;a=this.engine.rowCount<a+n?this.engine.rowCount>n?this.engine.rowCount-n:0:a,this.engine.pageRowStartPos=a,r=this.engine.columnCount<r+o?this.engine.columnCount>o?this.engine.columnCount-o:0:r,this.engine.pageColStartPos=r;return{rowQuery:""!==e?"\nSUBSET ({ "+(this.isMondrian?"":"NONEMPTY")+" ("+e+(this.isMondrian||""===t?"":","+t)+")},"+a+","+n+")":"",columnQuery:""!==t?"\nSUBSET ({ "+(this.isMondrian?"":"NONEMPTY")+" ("+t+(this.isMondrian||""===i?"":","+i)+")},"+r+","+o+")":""}},e.getPagingCountQuery=function(e,t){e=e.replace("NON EMPTY ( ","").slice(0,-1),t=t.replace("NON EMPTY ( ","").slice(0,-1);var i=e;return{rowQuery:""!==e?"SET [d1876d2b-e50e-4547-85fe-5b8ed9d629de] as "+(this.isMondrian?"":"NONEMPTY")+" ("+e+(this.isMondrian||""===t?"":","+t)+")\n":"",columnQuery:""!==t?"\nSET [e16a30d0-2174-4874-8dae-a5085a75a3e2] as "+(this.isMondrian?"":"NONEMPTY")+" ("+t+(this.isMondrian||""===i?"":","+i)+")\n":""}},e.getDimensionsQuery=function(e,t,i,a){var r="";if(e.length>0){r="\nNON EMPTY ( "+(this.drilledMembers.length>0?"HIERARCHIZE ({":"");for(var n=0;n<e.length;){0===n?"[measures]"===e[n].name.toLowerCase()?""!==t&&(r+=t):r+="({"+this.getDimensionQuery(e[n],i)+"})":"[measures]"===e[n].name.toLowerCase()?""!==t&&(r=r+" * "+t):r=r+" * "+("({"+this.getDimensionQuery(e[n],i)+"})"),n++}var o=this.getDrillQuery(e,t,i,a);r=a&&a.axis===i?"\nNON EMPTY ( "+(this.drilledMembers.length>0?"HIERARCHIZE ({":"")+o.query:r+(""!==o.query?",":"")+o.query;var s=this.getAttributeDrillQuery(e,t,i,a);r=(this.valueAxis!==i?this.updateValueSortQuery(r,this.valueSortSettings):r)+(this.isPaging?(""!==s?"-":"")+s:"")+(this.drilledMembers.length>0?"})":"")+(this.isPaging?"":(""!==s?"-":"")+s)+")"}return r},e.getAttributeDrillQuery=function(e,t,i,a){var r="",n=[];n=a&&a.axis===i&&"down"===a.action.toLowerCase()?[{name:a.fieldName,items:[a.memberName],delimiter:"~~"}]:this.drilledMembers;for(var o=i===this.valueAxis?this.getMeasurePos(i):0,s=0,l=n;s<l.length;s++){var d=l[s];if(!!this.engine.fieldList[d.name]&&this.engine.fieldList[d.name].isHierarchy)for(var h=0,p=d.items;h<p.length;h++){for(var u=p[h],c=[],g=u.split(d.delimiter?d.delimiter:"~~"),m=this.getDrillLevel(e,g),f=this.getDimensionPos(i,d.name),v=e.length-(o>f?1:0),S=!!this.isPaging&&this.isAttributeMemberExist(d.name,u.split(d.delimiter?d.delimiter:"~~"),d.delimiter,g,i);m.level>0&&m.isDrill&&f+1!==o&&!S;){for(var y=[],b=0;b<e.length;){if("[measures]"===e[b].name.toLowerCase())""!==t&&y.push("({{"+g[b]+"}})");else if(g[b]&&(-1!==g[b].indexOf(e[b].name)||e[b].isNamedSet&&this.fieldList[e[b].name]&&-1!==g[b].indexOf(this.fieldList[e[b].name].pid.split("Sets_")[1])))y.push(this.getHierarchyQuery(g[b],!1,!1,!1,m.level,!0));else{if(g[b]||!e[b]){y=[];break}y.push(this.getHierarchyQuery(e[b].name,!!(this.isPaging&&2===m.level||!this.isPaging&&v>b),e[b].isNamedSet,e[b].isCalculatedField,m.level,!1))}b++}y.length>0&&c.push("("+y.join("*")+")"),m.level--,v--}c.length>0&&(r=r+(""!==r?"-":"")+c.join(this.isPaging?"+":"-"))}}return r},e.getDimensionPos=function(e,t){for(var i=0,a="rows"===e?this.rows:this.columns,r=0;r<a.length;r++)if(a[r].name===t){i=r;break}return i},e.getMeasurePos=function(e){for(var t=0,i="rows"===e?this.rows:this.columns,a=0;a<i.length;a++)if(0===i[a].name.indexOf("[Measures]")){t=a;break}return t},e.getDrillLevel=function(e,t){for(var i=e.length,a=!1,r=0;r<e.length;)t[r]&&-1!==t[r].indexOf(e[r].name)?(i-=1,e[r+1]&&!(e[r+1].isNamedSet||0===e[r+1].name.indexOf("[Measures]")||this.fieldList[e[r+1].name]&&!this.fieldList[e[r+1].name].hasAllMember)&&(a=!0)):(e[r].isNamedSet||0===e[r].name.indexOf("[Measures]")||this.fieldList[e[r].name]&&!this.fieldList[e[r].name].hasAllMember)&&(i-=1),r++;return{level:this.isPaging?2:i,isDrill:a}},e.getHierarchyQuery=function(e,t,i,a,r,n){return e=a?this.fieldList[e].tag:e,!this.fieldList[e]||this.fieldList[e].hasAllMember||i||a?i||a?"({"+e+"})":this.isPaging?"({"+e+(t?".CHILDREN})":n||1!==r?"})":".[All]})"):"({DrilldownLevel({"+e+(t?".CHILDREN":"")+"},,,INCLUDE_CALC_MEMBERS)})":"(("+e+").levels(0).AllMembers)"},e.isAttributeMemberExist=function(e,t,i,a,r){t.splice(a.length-1,1);var n=!1;if(""!==t.join(i)&&(!this.isPaging||1!==t.length||"[Measures]"!==t.join(i))&&this.engine.fieldList[e]&&this.engine.fieldList[e].hasAllMember)for(var o=this.getDimensionPos(r,e),s=0;s<this.drilledMembers.length;s++)if(e!==this.drilledMembers[s].name){if(!!this.engine.fieldList[this.drilledMembers[s].name]&&this.engine.fieldList[this.drilledMembers[s].name].isHierarchy)for(var l=this.getDimensionPos(r,this.drilledMembers[s].name),d=0;d<this.drilledMembers[s].items.length;d++){var h=this.getDrillLevel("rows"===r?this.rows:this.columns,this.drilledMembers[s].items[d].split(this.drilledMembers[s].delimiter?this.drilledMembers[s].delimiter:"~~"));if((!this.isPaging||l<o&&h.isDrill)&&(0===this.drilledMembers[s].items[d].indexOf(t.join(i))||0===t.join(i).indexOf(this.drilledMembers[s].items[d]))){n=!0;break}}}return n},e.getDrillQuery=function(e,t,i,a){var r="",n=[],o=[],s=!1,l="";a&&a.axis===i&&"down"===a.action.toLowerCase()?(s=!0,o=[{name:a.fieldName,items:[a.memberName],delimiter:"~~"}]):o=this.drilledMembers;for(var d=0,h=o;d<h.length;d++){var p=h[d];if(!(!!this.engine.fieldList[p.name]&&this.engine.fieldList[p.name].isHierarchy))for(var u=0,c=p.items;u<c.length;u++){for(var g=c[u],m=[],f=[],v=0,S=g.split(p.delimiter?p.delimiter:"~~"),y=this.isAttributeMemberExist(p.name,g.split(p.delimiter?p.delimiter:"~~"),p.delimiter?p.delimiter:"~~",S,i);v<e.length&&!y;){if(S[v]&&-1!==S[v].indexOf(e[v].name))-1!==S[S.length-1].indexOf(e[v].name)?s?l=l+(""!==l?" * ":"")+"({"+S[v]+".CHILDREN})":(m.push("("+S[v]+".CHILDREN)"),f.push("("+S[v]+")")):"[measures]"===S[v].toLowerCase()&&""!==t?s?l=l+(""!==l?" * ":"")+"("+t+")":(m.push("("+t+")"),f.push("("+t+")")):-1!==S[v].toLowerCase().indexOf("[measures]")?s?l=l+(""!==l?" * ":"")+"({"+S[v]+"})":(m.push("({"+S[v]+"})"),f.push("({"+S[v]+"})")):s?l=l+(""!==l?" * ":"")+"({"+S[v]+"})":(m.push("("+S[v]+")"),f.push("("+S[v]+")"));else{if(S[v]||!e[v]){m=[];break}"[measures]"===e[v].name.toLowerCase()&&""!==t?s?l=l+(""!==l?" * ":"")+"("+t+")":(m.push("("+t+")"),f.push("("+t+")")):s?l=l+(""!==l?" * ":"")+"({"+this.getDimensionQuery(e[v],i)+"})":(m.push("("+this.getDimensionQuery(e[v],i)+")"),f.push("("+this.getDimensionQuery(e[v],i)+")"))}v++}m.length>0&&m.length<S.length&&(m=[],f=[]),r=r+(""!==r&&m.length>0?",":"")+(m.length>0?"("+m.toString()+")":""),f.length>0&&n.push("("+f.toString()+")")}}return{query:s?l:r,collection:s?[l]:n}},e.updateValueSortQuery=function(e,t){if(t&&t.measure&&""!==t.measure){var i=this.drilledMembers.length>0?"HIERARCHIZE ({":"",a=this.fieldList[t.measure].isCalculatedField?this.fieldList[t.measure].tag:t.measure;switch(t.sortOrder){case"Ascending":e=(e=e.replace("NON EMPTY ( "+i,"NON EMPTY ( "+i+" ORDER ({"))+"},("+a+"), ASC)";break;case"Descending":e=(e=e.replace("NON EMPTY ( "+i,"NON EMPTY ( "+i+" ORDER ({"))+"},("+a+"), DESC)"}}return e},e.getSlicersQuery=function(e,i){var a=this,r="",n=t.extend([],this.rows,null,!0);if(n=n.concat(this.columns),e.length>0){for(var o=0;o<e.length;){n.filter(function(t){var i=a.getDimensionUniqueName(t.name),r=a.getDimensionUniqueName(e[o].name);return i===r&&!(a.isMondrian&&""===r&&""===i)}).length>0||(void 0===e[o].name||this.filterMembers[e[o].name]?this.filterMembers[e[o].name]&&(r=r+(""!==r?" * ":"")+"{"+this.filterMembers[e[o].name].toString()+"}"):r=r+(""!==r?" * ":"")+"{"+this.getDimensionQuery(e[o],i)+"}"),o++}r=""===r?"":"\nWHERE ("+r.replace(/DrilldownLevel/g,"")+")"}return r},e.getDimensionQuery=function(e,t){var i=e.isCalculatedField?this.fieldList[e.name].tag:e.name;return this.fieldList[e.name].hasAllMember||e.isNamedSet||e.isCalculatedField?e.isNamedSet?"{"+i+"}":this.isPaging?i+".CHILDREN":"DrilldownLevel({"+i+"}"+("rows"===t||"columns"===t?",,,INCLUDE_CALC_MEMBERS":"")+")":"(("+i+").levels(0).AllMembers)"},e.getDimensionUniqueName=function(e){var t=this.fieldDataObj.hierarchy,i=[];if(t){for(var a=0,r=t;a<r.length;a++){var n=r[a];n.id.toLowerCase()===e.toLowerCase()&&i.push(n)}return i.length>0?i[0].pid:""}return e.split(".")[0]},e.getMeasuresQuery=function(e){var t="";if(e.length>0){t="{{";for(var i="",a=0,r=e;a<r.length;a++){var n=r[a],o=n.isCalculatedField?this.fieldList[n.name].tag:n.name;i=i.length>0?i+", "+o:o}t=t+i+"}}"}return t},e.getfilterQuery=function(e,t){for(var i="\nFROM ["+t+"]",a="\nFROM( SELECT (",r=[],n=[],o=[],s=[],l=0,d=this.rows;l<d.length;l++){e[(m=d[l]).name]&&e[m.name].length>0&&("string"==typeof e[m.name][0]?o.push(e[m.name]):(e[m.name][1]=e[m.name][0].type,r.push(e[m.name]),delete e[m.name]))}for(var h=0,p=this.columns;h<p.length;h++){if(e[(m=p[h]).name]&&e[m.name].length>0)if("string"==typeof e[m.name][0])s.push(e[m.name]);else{var u=e[m.name];u[1]=u[0].type,r.push(e[m.name]),delete e[m.name]}}for(var c=0,g=this.filters;c<g.length;c++){for(var m=g[c],f=!1,v=0,S=this.columns;v<S.length;v++){var y=S[v];f||this.getDimensionUniqueName(y.name)!==this.getDimensionUniqueName(m.name)||e[m.name]&&(s.push(e[m.name]),f=!0)}if(!f)for(var b=0,C=this.rows;b<C.length;b++){var x=C[b];f||this.getDimensionUniqueName(x.name)!==this.getDimensionUniqueName(m.name)||e[m.name]&&(o.push(e[m.name]),f=!0)}}if((this.allowLabelFilter||this.allowValueFilter)&&r.length>0)for(var w=0,T=["Value","Label"];w<T.length;w++)for(var M=T[w],D=0,O=r;D<O.length;D++){var N=O[D];N&&2===N.length&&"string"==typeof N[1]&&N[1]===M&&n.push(this.getAdvancedFilterQuery(N[0],a,"COLUMNS"))}for(var E=0,P=s.length;E<P;E++)a=0===E?a+"{"+s[E].toString()+"}":a+",{"+s[E].toString()+"}";s.length>0&&(a=o.length>0?a+" ) ON COLUMNS ,(":a+" ) ON COLUMNS");for(E=0,P=o.length;E<P;E++)a=E>0?a+",{"+o[E].toString()+"}":a+"{"+o[E].toString()+"}";a=s.length>0&&o.length>0?a+=") ON ROWS ":0===s.length&&o.length>0?a+") ON COLUMNS ":a;var F="";return n.length>0&&(F=n.join(" ")+" "+(s.length>0||o.length>0?a:"")+" "+i+Array(n.length+1+(s.length>0||o.length>0?1:0)).join(")")),i=0===s.length&&0===o.length?i:a+i+")",F.length>0?F:i},e.getAdvancedFilterQuery=function(e,t,i){return"\nFROM (SELECT Filter("+e.selectedField+".AllMembers, "+this.getAdvancedFilterCondtions(e.name,e.condition,e.value1,e.value2,e.type,e.measure)+")) on "+i},e.getAdvancedFilterCondtions=function(e,t,i,a,r,n){var o="";switch(t){case"Equals":o="("+("Value"!==r?e+'.CurrentMember.member_caption ="'+i+'"':n+" = "+i);break;case"DoesNotEquals":o="("+("Value"!==r?e+'.CurrentMember.member_caption <>"'+i+'"':n+" <>"+i);break;case"Contains":o="( InStr (1,"+e+'.CurrentMember.member_caption,"'+i+'") >0';break;case"DoesNotContains":o="( InStr (1,"+e+'.CurrentMember.member_caption,"'+i+'")=0';break;case"BeginWith":o="( Left ("+e+".CurrentMember.member_caption,"+i.length+')="'+i+'"';break;case"DoesNotBeginWith":o="( Left ("+e+".CurrentMember.member_caption,"+i.length+') <>"'+i+'"';break;case"EndsWith":o="( Right ("+e+".CurrentMember.member_caption,"+i.length+')="'+i+'"';break;case"DoesNotEndsWith":o="( Right ("+e+".CurrentMember.member_caption,"+i.length+') <>"'+i+'"';break;case"GreaterThan":o="("+("Value"!==r?e+'.CurrentMember.member_caption >"'+i+'"':n+" >"+i);break;case"GreaterThanOrEqualTo":o="("+("Value"!==r?e+'.CurrentMember.member_caption >="'+i+'"':n+" >="+i);break;case"LessThan":o="("+("Value"!==r?e+'.CurrentMember.member_caption <"'+i+'"':n+" <"+i);break;case"LessThanOrEqualTo":o="("+("Value"!==r?e+'.CurrentMember.member_caption <="'+i+'"':n+" <="+i);break;case"Between":o="("+("Value"!==r?e+'.CurrentMember.member_caption >="'+i+'"AND '+e+'.CurrentMember.member_caption <="'+a+'"':n+" >="+i+" AND "+n+" <="+a);break;case"NotBetween":o="("+("Value"!==r?e+'.CurrentMember.member_caption >="'+i+'"OR '+e+'.CurrentMember.member_caption <="'+a+'"':n+" >="+i+" OR "+n+" <="+a);break;default:o="( InStr (1,"+e+'.CurrentMember.member_caption,"'+i+'") >0'}return o},e.getCalculatedFieldQuery=function(e){var i="";if(e.length>0){i="\nWITH";for(var a=0,r=e;a<r.length;a++){var n=r[a],o=(n.formula.indexOf("Measure")>-1?"[Measures].":n.hierarchyUniqueName+".")+"["+n.name+"]",s=t.isNullOrUndefined(n.formatString)?null:n.formatString;i+="\nMEMBER "+o+"as ("+n.formula+") "+(t.isNullOrUndefined(s)?"":', FORMAT_STRING ="'+s.trim()+'"')}}return i},e}(),cn=function(){function e(){this.fieldList={},this.columnCount=0,this.rowCount=0,this.colFirstLvl=0,this.rowFirstLvl=0,this.pageColStartPos=0,this.enableSort=!1,this.enableValueSorting=!1,this.dataFields={},this.formatFields={},this.filterMembers={},this.drilledSets={},this.aggregatedValueMatrix=[],this.mappingFields={},this.customRegex=/^(('[^']+'|''|[^*#@0,.])*)(\*.)?((([0#,]*[0,]*[0#]*)(\.[0#]*)?)|([#,]*@+#*))(E\+?0+)?(('[^']+'|''|[^*#@0,.E])*)$/,this.formatRegex=/(^[ncpae]{1})([0-1]?[0-9]|20)?$/i,this.pivotValues=[],this.valueContent=[],this.headerContent=[],this.rowStartPos=0,this.pageRowStartPos=0,this.tupColumnInfo=[],this.tupRowInfo=[],this.gridJSON="",this.namedSetsPosition={},this.colDepth=0,this.totalCollection=[],this.parentObjCollection={},this.curDrillEndPos=-1,this.headerGrouping={},this.lastLevel=[],this.showRowSubTotals=!0,this.showColumnSubTotals=!0,this.hideRowTotalsObject={},this.hideColumnTotalsObject={},this.sortObject={},this.isColDrill=!1}return e.prototype.renderEngine=function(e,i){this.isEmptyData=!1,this.mdxQuery="",this.isMeasureAvail=!1,this.allowMemberFilter=!1,this.allowLabelFilter=!1,this.allowValueFilter=!1,this.isMondrian=!1,this.aggregatedValueMatrix=[],this.measureReportItems=[],this.calcChildMembers=[],this.selectedItems=[],this.savedFieldList=void 0,this.savedFieldListData=void 0,this.formatFields={},this.filterMembers={},this.dataFields={},this.valueAxis="",this.columnCount=0,this.rowCount=0,this.colFirstLvl=0,this.rowFirstLvl=0,this.pageColStartPos=0,this.enableValueSorting=!1,this.sortObject={},this.globalize=new t.Internationalization,this.locale=this.globalize.getCulture(),this.localeObj=i?i.localeObj:void 0,this.enableValueSorting=!!i&&i.enableValueSorting,e.url&&(this.dataSourceSettings=e,this.valueAxis="row"===e.valueAxis?"row":"column",this.getAxisFields(),this.formats=e.formatSettings?e.formatSettings:[],this.enableSort=void 0===e.enableSorting||e.enableSorting,this.valueSortSettings=e.valueSortSettings?e.valueSortSettings:void 0,this.filterSettings=e.filterSettings?e.filterSettings:[],this.sortSettings=e.sortSettings?e.sortSettings:[],this.allowMemberFilter=!!e.allowMemberFilter,this.allowLabelFilter=!!e.allowLabelFilter,this.allowValueFilter=!!e.allowValueFilter,this.drilledMembers=e.drilledMembers?this.updateDrilledItems(e.drilledMembers):[],this.calculatedFieldSettings=e.calculatedFieldSettings?e.calculatedFieldSettings:[],this.emptyCellTextContent=e.emptyCellsTextContent?e.emptyCellsTextContent:"",this.pageSettings=i?i.pageSettings?i.pageSettings:this.pageSettings:void 0,this.isPaging=!!this.pageSettings,this.frameSortObject(),this.getFormattedFields(this.formats),this.savedFieldList=i?i.savedFieldList:void 0,this.savedFieldListData=i?i.savedFieldListData:void 0,this.fieldListData=[],this.fieldListObj={},this.setNamedSetsPosition(),this.savedFieldList&&this.savedFieldListData?this.updateFieldlist(!0):this.getFieldList(e),this.loadCalculatedMemberElements(this.calculatedFieldSettings),this.measureReportItems=[],this.updateFilterItems(this.filterSettings),this.generateGridData(e))},e.prototype.generateGridData=function(e,t){var i=!(!t||"navPaging"!==t||!this.isPaging||void 0===this.pageSettings);this.rows.length>0||this.columns.length>0||this.values.length>0||this.filters.length>0?un.getCellSets(e,this,i):(un.getCellSets(e,this,!0,void 0,!0),this.generateEngine(void 0,void 0,{dataSourceSettings:e,action:"loadTableElements"}))},e.prototype.generatePagingData=function(e,t,i){var a=[].slice.call(e.querySelectorAll("Axes, CellData")),r=a[1]?a[1].querySelectorAll("FmtValue"):null;r&&r.length>0&&(this.columnCount=Number(r[0].textContent),this.rowCount=Number(r[1].textContent));var n=i.dataSourceSettings;un.getCellSets(n,this,!0)},e.prototype.scrollPage=function(e,t,i){un.getCellSets(this.dataSourceSettings,this,!0)},e.prototype.generateEngine=function(e,i,a){"down"!==a.action&&(this.pivotValues=[],this.valueContent=[],this.headerContent=[],this.colDepth=0,this.tupColumnInfo=[],this.tupRowInfo=[],this.colMeasures={},this.colMeasurePos=void 0,this.rowMeasurePos=void 0,this.rowStartPos=-1),this.xmlDoc=e?e.cloneNode(!0):void 0,this.request=i,this.customArgs=a,this.totalCollection=[],this.parentObjCollection={},this.curDrillEndPos=-1,this.onDemandDrillEngine=[],this.getSubTotalsVisibility(),this.xmlaCellSet=e?e.querySelectorAll("Axes, CellData"):void 0;var r=this.xmlaCellSet&&this.xmlaCellSet.length>0?[].slice.call(this.xmlaCellSet[0].querySelectorAll('Axis[name|="Axis0"] Tuple')):[],n=this.xmlaCellSet&&this.xmlaCellSet.length>0?[].slice.call(this.xmlaCellSet[0].querySelectorAll('Axis[name|="Axis1"] Tuple')):[],o=this.xmlaCellSet&&this.xmlaCellSet.length>1?[].slice.call(this.xmlaCellSet[1].querySelectorAll("Cell")):[];if(this.drilledMembers.length>0){var s=this.getMeasureInfo(),l=void 0;r=(l=this.frameMeasureOrder(s,"column",r,o,r.length)).orderedHeaderTuples,o=l.orderedValueTuples,n=(l=this.frameMeasureOrder(s,"row",n,o,r.length)).orderedHeaderTuples,o=l.orderedValueTuples}if("down"===a.action&&this.updateTupCollection("row"===a.drillInfo.axis?n.length:r.length),"down"===a.action&&"column"!==a.drillInfo.axis||(this.olapValueAxis=t.isNullOrUndefined(this.getValueAxis(void 0,void 0))?"column":"row",this.frameColumnHeader(r),this.isPaging||this.performColumnSorting()),"down"===a.action&&"row"!==a.drillInfo.axis||(this.frameRowHeader(n),this.isPaging||this.performRowSorting()),this.frameValues(o,r.length),this.performColumnSpanning(),!this.isPaging&&this.enableSort)for(var d=0;d<this.headerContent.length;d++)this.headerContent[d]=this.pivotValues[d];this.isEngineUpdated=!0,this.isEmptyData=0===r.length},e.prototype.getSubTotalsVisibility=function(){this.showRowSubTotals=this.dataSourceSettings.showRowSubTotals&&this.dataSourceSettings.showSubTotals,this.showColumnSubTotals=this.dataSourceSettings.showColumnSubTotals&&this.dataSourceSettings.showSubTotals,this.hideRowTotalsObject={},this.hideColumnTotalsObject={};var e=1;do{if(1===e){if(this.showColumnSubTotals)for(var t=0;t<this.dataSourceSettings.columns.length;t++)!1===this.dataSourceSettings.columns[t].showSubTotals&&(this.hideColumnTotalsObject[this.dataSourceSettings.columns[t].name]=t)}else if(this.showRowSubTotals)for(var i=0;i<this.dataSourceSettings.rows.length;i++)!1===this.dataSourceSettings.rows[i].showSubTotals&&(this.hideRowTotalsObject[this.dataSourceSettings.rows[i].name]=i);e++}while(e<3)},e.prototype.frameRowHeader=function(e){this.headerGrouping={},this.lastLevel=[];var t=!0,i=this.pivotValues.length,a=[],r=[];"down"!==this.customArgs.action?(a=this.pivotValues,r=this.valueContent):i=this.customArgs.drillInfo.currentCell.rowIndex+1,this.rowStartPos=this.rowStartPos>0?this.rowStartPos:i;for(var n,o,s,l=0,d=[],h={},p=[],u=!1,c=-1,g=-1,m=[],f=[{axis:"row",colIndex:0,formattedText:"Grand Total",hasChild:!1,level:-1,rowIndex:0,index:[],type:"grand sum",ordinal:0,colSpan:1,rowSpan:1,memberType:2,isDrilled:!1,valueSort:{"Grand Total":1,levelName:"Grand Total"}}],v=[],S=this.customArgs.drillInfo&&"row"===this.customArgs.drillInfo.axis?this.customArgs.drillInfo.currentCell.ordinal+1:0;l<e.length;){var y=e[l].querySelectorAll("Member");v=this.frameTupCollection(y,v,l+S,this.tupRowInfo,this.showRowSubTotals,this.hideRowTotalsObject,"row"),l++}l=0;var b,C=e.length;if("down"===this.customArgs.action){var x=this.customArgs.drillInfo.currentCell.ordinal+1;l=x,C+=x,o=this.tupRowInfo[x-1].allCount,n=this.tupRowInfo[x-1].allStartPos,b=this.tupRowInfo[x-1]}for(var w=l,T=0,M=!1;l<C;){y=e["down"===this.customArgs.action?l-(this.customArgs.drillInfo.currentCell.ordinal+1):l].querySelectorAll("Member");var D=0,O=void 0,N=this.tupRowInfo[l].allCount,E=this.tupRowInfo[l].allStartPos,P=this.tupRowInfo[l].measure,F=this.tupRowInfo[l].typeCollection,I=(this.tupRowInfo[l].drillInfo,this.tupRowInfo[l].drillStartPos),L=this.tupRowInfo[l].startDrillUniquename;this.tupRowInfo[l].drillEndPos,this.tupRowInfo[l].levelCollection;if(0===l||l===w){for(var A="down"===this.customArgs.action?this.tupRowInfo[0].members:y;D<A.length;)"1"===A[D].querySelector("MEMBER_TYPE").textContent&&0===Number(A[D].querySelector("LNum").textContent)?m[D]=0:m[D]=Number(A[D].querySelector("LNum").textContent),"1"===A[D].querySelector("MEMBER_TYPE").textContent?(h[D]=0,c=-1===c?D:c,g=D):(h[D]=1,u="3"!==A[D].querySelector("MEMBER_TYPE").textContent||u),D++;s=F.indexOf("3")}if(D=0,0===l&&(y.length>N+(P?1:0)||1===y.length&&P)&&f.pop(),0===l&&this.isPaging?0===f.length:!u||N===o||E!==n||1===y.length&&P){var R=this.checkAttributeDrill(this.tupRowInfo[l].drillInfo,"rows"),j=!(I>-1)||(!(N>0)||(R||E>I));j=b&&j&&I>-1?b.startDrillUniquename!==L||!(g>b.measurePosition||b.measureName===this.tupRowInfo[l].measureName||E!==I+1&&this.tupRowInfo[l].measurePosition!==I+1):j;var k=!(c>-1&&N>0)||(R||E>g);if((M="Top"===this.dataSourceSettings.grandTotalsPosition&&0===this.olapRowValueIndex&&"row"===this.olapValueAxis&&this.dataSourceSettings.showGrandTotals&&this.dataSourceSettings.showRowGrandTotals&&("row"!==this.olapValueAxis||this.dataSourceSettings.rows.length>1))&&1===f.length&&(f=this.frameGrandTotalValues(e,f,F,s)),y.length===N+(P?1:0)&&P&&!M){var q="Grand Total."+y[s].querySelector("Caption").textContent,V="3"===F[s]&&this.dataFields[this.getUniqueName(y[s].querySelector("UName").textContent)]&&this.dataFields[this.getUniqueName(y[s].querySelector("UName").textContent)].caption?this.dataFields[this.getUniqueName(y[s].querySelector("UName").textContent)].caption:y[s].querySelector("Caption").textContent;(f=this.frameGrandTotalAxisSet(f,this.getUniqueName(y[s].querySelector("UName").textContent),V,i,l,Number(F[s]),y[s].querySelector("PARENT_UNIQUE_NAME")?y[s].querySelector("PARENT_UNIQUE_NAME").textContent:void 0,y[s].querySelector("LName").textContent,y[s].getAttribute("Hierarchy"),{levelName:q,axis:y[s].getAttribute("Hierarchy")}))[f.length-1].valueSort["Grand Total."+y[s].querySelector("Caption").textContent]=1}else if(0!==E&&(0!==s||1!==E)&&j&&k){"Top"===this.dataSourceSettings.grandTotalsPosition&&t&&this.dataSourceSettings.showGrandTotals&&("row"!==this.olapValueAxis||this.dataSourceSettings.rows.length>1)&&(this.insertRowGrandTotal(f,r,a,e,i),i=this.pivotValues.length,t=!1),b=this.tupRowInfo[l];var H=i,B=D;O={};for(var _=!1;D<y.length;){var U=y[D];if(U.querySelector("UName").textContent!==d[D]&&"2"!==F[D]&&(!(Object.keys(O).length>0?O.isDrilled&&!this.fieldList[O.hierarchy].isHierarchy:_)||"3"===F[D]&&h[D-1]&&0!==h[D+1])){var G=Number(U.querySelector("LNum").textContent)-(h[D]&&"3"!==F[D]?1:m[D]),W=!!this.namedSetsPosition.row[D],z=this.getUniqueName(U.querySelector("UName").textContent),Q=this.getDepth(this.tupRowInfo[l],z,Number(F[D]));if(!(this.isPaging&&a[T][0]&&this.fieldList[a[T][0].hierarchy]&&this.fieldList[a[T][0].hierarchy].isHierarchy&&a[T][0].hasChild&&!a[T][0].isDrilled&&!this.rows[D].isNamedSet&&(0===this.rows[D].name.indexOf("[Measures]")||this.fieldList[U.getAttribute("Hierarchy")]&&(this.fieldList[U.getAttribute("Hierarchy")].isHierarchy||this.fieldList[U.getAttribute("Hierarchy")].hasAllMember))&&a[T][0].depth<Q)){a[i]=[{axis:"row",actualText:z,colIndex:0,formattedText:"3"===F[D]&&this.dataFields[z]&&this.dataFields[z].caption?this.dataFields[z].caption:U.querySelector("Caption").textContent,hasChild:!!(this.fieldList[U.getAttribute("Hierarchy")]&&this.fieldList[U.getAttribute("Hierarchy")].isHierarchy&&D<this.rows.length-1&&!this.rows[D+1].isNamedSet&&this.rows[D+1].name.indexOf("[Measures]")<0&&this.fieldList[this.rows[D+1].name]&&this.fieldList[this.rows[D+1].name].hasAllMember)||Number(U.querySelector("CHILDREN_CARDINALITY").textContent)>0,level:G,depth:Q,rowIndex:i,index:[],ordinal:l,type:"header",colSpan:1,rowSpan:1,memberType:Number(F[D]),isDrilled:!(!this.fieldList[U.getAttribute("Hierarchy")]||!this.fieldList[U.getAttribute("Hierarchy")].isHierarchy||this.isAttributeDrill(U.getAttribute("Hierarchy"),this.tupRowInfo[l].drillInfo,"rows"))||this.tupRowInfo[l].drillInfo[D].isDrilled,parentUniqueName:U.querySelector("PARENT_UNIQUE_NAME")?U.querySelector("PARENT_UNIQUE_NAME").textContent:void 0,levelUniqueName:U.querySelector("LName").textContent,hierarchy:U.getAttribute("Hierarchy"),isNamedSet:W,valueSort:{levelName:"",axis:U.getAttribute("Hierarchy")}}],(O="3"!==F[D]?a[i][0]:O)||p.push(U.querySelector("Caption").textContent);q=this.getCaptionCollectionWithMeasure(this.tupRowInfo[l]);a[i][0].valueSort.levelName=q,a[i][0].valueSort[q]=1,r[i-this.rowStartPos]={},r[i-this.rowStartPos][0]=a[i][0],P&&s>D&&(d[s]="");for(var Y=D+1;Y<y.length;Y++)d[Y]="";d[D]=U.querySelector("UName").textContent,T=3!==Number(F[D])?i:T,i++,B=D}}else"2"===F[D]?B=D:this.tupRowInfo[l].drillInfo[D].isDrilled&&0===h[D]&&(_=!0);this.tupRowInfo[l].drillInfo[D].isDrilled&&this.tupRowInfo[l].showTotals&&(this.tupRowInfo[l].showTotals=!!this.showRowSubTotals&&void 0===this.hideRowTotalsObject[this.tupRowInfo[l].drillInfo[D].hierarchy]),D++}H<i&&B>=y.length-1&&(a[i-1][0].ordinal=l,"header"===a[i-1][0].type&&delete a[i-1][0].type)}o=N,n=E}l++}("Top"!==this.dataSourceSettings.grandTotalsPosition||"row"===this.olapValueAxis&&1===this.dataSourceSettings.rows.length&&"Top"===this.dataSourceSettings.grandTotalsPosition||0===this.dataSourceSettings.rows.length)&&this.insertRowGrandTotal(f,r,a,e,i)},e.prototype.insertRowGrandTotal=function(e,t,i,a,r){if(e.length>1&&3!==e[0].memberType&&(e[0].ordinal=-1),"down"!==this.customArgs.action){if(this.dataSourceSettings.showGrandTotals&&this.dataSourceSettings.showRowGrandTotals)for(var n=0;n<e.length;n++)e[n].rowIndex=r,i[r]=[e[n]],t[r-this.rowStartPos]={},t[r-this.rowStartPos][0]=i[r][0],r++}else this.updateRowEngine(i,t,a.length),this.onDemandDrillEngine=i;return e},e.prototype.getValueAxis=function(e,t){this.olapValueAxis=e,this.olapRowValueIndex=t;for(var i=0;i<this.dataSourceSettings.rows.length;i++)if("[Measures]"===this.dataSourceSettings.rows[i].name){this.olapValueAxis="row",this.olapRowValueIndex=i;break}return this.olapValueAxis},e.prototype.frameGrandTotalAxisSet=function(e,t,i,a,r,n,o,s,l,d){return e.push({axis:"row",actualText:t,colIndex:0,formattedText:i,hasChild:!1,level:-1,rowIndex:a,index:[],ordinal:r,colSpan:1,rowSpan:1,memberType:n,isDrilled:!1,parentUniqueName:o,levelUniqueName:s,hierarchy:l,valueSort:d}),e},e.prototype.getDepth=function(e,t,i){var a=e.uNameCollection.indexOf(t),r=(e.uNameCollection.substring(0,a)+(3===i?"":t)).split("::[").map(function(e){return"["===e[0]?e:"["+e});3===i&&this.rowMeasurePos===r.length&&r.push(t);for(var n=-1,o=0;o<r.length;o++){n+=r[o].split("~~").length}return n},e.prototype.checkAttributeDrill=function(e,t){for(var i=!1,a=0;a<e.length&&!(i=this.isAttributeDrill(e[a].hierarchy,e,t));a++);return i},e.prototype.frameTupCollection=function(e,i,a,r,n,o,s){for(var l,d,h,p,u,c,g=0,m=0,f=[],v=[],S=[],y="",b="",C=!0,x=-1;g<e.length;){var w=e[g],T=Number(w.querySelector("LNum").textContent),M=w.querySelector("UName").textContent;Number(w.querySelector("MEMBER_TYPE").textContent)>3&&(w.querySelector("MEMBER_TYPE").textContent=0===M.indexOf("[Measures]")?"3":"1");var D=0===M.indexOf("[Measures]")?"3":Number(w.querySelector("MEMBER_TYPE").textContent)>3?"1":w.querySelector("MEMBER_TYPE").textContent,O=w.querySelector("Caption").textContent;this.fieldList[O]&&"CalculatedField"===this.fieldList[O].type&&(O=this.fieldList[O].caption,w.querySelector("Caption").textContent=O);var N=w.getAttribute("Hierarchy"),E=w.querySelector("PARENT_UNIQUE_NAME")?w.querySelector("PARENT_UNIQUE_NAME").textContent:"";if("2"===D?(this.isPaging||m++,h=t.isNullOrUndefined(h)?g:h):"3"===D?(p=w,u=M,c=g,"column"===s?(this.colMeasures[M]=w,this.colMeasurePos=g):this.rowMeasurePos=g):x=o[N],"2"!==D){if(this.headerGrouping[g]){if(T>this.lastLevel[g])this.lastLevel[g]=T;else if(T<this.lastLevel[g]){for(var P=this.lastLevel[g];P>=T;)delete this.headerGrouping[g].UName[P],delete this.headerGrouping[g].Caption[P],P--;this.lastLevel[g]=T}this.headerGrouping[g].UName[T]=M,this.headerGrouping[g].Caption[T]=O}else this.lastLevel[g]=T,this.headerGrouping[g]={UName:(l={},l[T]=M,l),Caption:(d={},d[T]=O,d)};if(this.isPaging)for(var F=E;this.drilledSets[F];){var I=this.drilledSets[F].querySelector("Caption").textContent,L=Number(this.drilledSets[F].querySelector("LNum").textContent);this.headerGrouping[g].UName[L]=F,this.headerGrouping[g].Caption[L]=I,F=null===this.drilledSets[F].querySelector("PARENT_UNIQUE_NAME")?"":this.drilledSets[F].querySelector("PARENT_UNIQUE_NAME").textContent}for(var A="",R=Object.keys(this.headerGrouping[g].UName),j=0;j<R.length;j++){var k=R[j];A=0===j?this.headerGrouping[g].UName[k]:A+"~~"+this.headerGrouping[g].UName[k]}y=""===y?A:y+"::"+A;var q="",V=Object.keys(this.headerGrouping[g].Caption);for(j=0;j<V.length;j++){k=V[j];q=0===j?this.headerGrouping[g].Caption[k]:q+"~~"+this.headerGrouping[g].Caption[k]}g!==c&&(b=""===b?q:b+"::"+q)}if(f.push(D),v.push(T),(t.isNullOrUndefined(i[g])||i[g]<T)&&(i[g]=T),S.push({level:T,uName:M,hierarchy:N,isDrilled:!1}),r[a-1]&&"1"===r[a-1].typeCollection[g]&&S[g].level>r[a-1].drillInfo[g].level){var H=y.split(/~~|::\[/).map(function(e){return"["===e[0]?e:"["+e});H.pop();var B=H.join("~~");this.setDrillInfo(E,B,g,a,r)}g++}return x>-1&&(C="2"!==f[x+1]),r[a]={allCount:m,allStartPos:h,measure:p,measureName:u,measurePosition:c,members:e,typeCollection:f,uNameCollection:y,captionCollection:b,levelCollection:v,drillInfo:S,drillStartPos:-1,drillEndPos:-1,showTotals:!(!n&&m>0&&h>(0===c?1:0))&&C},i},e.prototype.getCaptionCollectionWithMeasure=function(e){var t=e.captionCollection;if(e.measure){var i=e.measure.querySelector("Caption").textContent,a=e.uNameCollection.split(/[~~,::]+/g).indexOf(e.measureName);(r=e.captionCollection.split(/[~~,::]+/g)).splice(a,0,i),t=r.join(".")}else{var r;t=(r=e.captionCollection.split(/[~~,::]+/g)).join(".")}return t},e.prototype.setNamedSetsPosition=function(){this.namedSetsPosition={};var e=0;do{for(var t={},i=e?this.dataSourceSettings.rows:this.dataSourceSettings.columns,a=0;a<i.length;a++)i[a].isNamedSet&&(t[a]=i[a].name);this.namedSetsPosition[e?"row":"column"]=t,e++}while(e<2)},e.prototype.updateRowEngine=function(e,t,i){for(var a=this.pivotValues.length-1,r=Object.keys(e).length;a>this.customArgs.drillInfo.currentCell.rowIndex;)this.pivotValues[a+r]=this.pivotValues[a],this.pivotValues[a+r][0].ordinal+=i,this.pivotValues[a+r][0].rowIndex+=r,this.valueContent[a+r-this.rowStartPos]=this.valueContent[a-this.rowStartPos],a--;for(var n=0;n<e.length;n++)this.pivotValues[n]=e[n],this.valueContent[Number(n)-this.rowStartPos]=t[Number(n)-this.rowStartPos];this.pivotValues[this.customArgs.drillInfo.currentCell.rowIndex][0].isDrilled=!0},e.prototype.updateTupCollection=function(e){for(var t="row"===this.customArgs.drillInfo.axis?this.tupRowInfo:this.tupColumnInfo,i=t.length-1;i>this.customArgs.drillInfo.currentCell.ordinal;)t[i+e]=t[i],i--},e.prototype.frameGrandTotalValues=function(e,t,i,a){for(var r=0,n=!1;r<e.length&&!n;){var o=e["down"===this.customArgs.action?r-(this.customArgs.drillInfo.currentCell.ordinal+1):r].querySelectorAll("Member"),s=this.tupRowInfo[r].allCount,l=this.tupRowInfo[r].allStartPos,d=this.tupRowInfo[r].measure,h=this.tupRowInfo[r].typeCollection,p=this.tupRowInfo[r].drillStartPos;this.tupRowInfo[r].startDrillUniquename;if(0===r&&(o.length>s+(d?1:0)||1===o.length&&d)&&t.pop(),0!==r||!this.isPaging||0===t.length){var u=this.checkAttributeDrill(this.tupRowInfo[r].drillInfo,"rows"),c=!(p>-1)||(!(s>0)||(u||l>p));if(c=c,o.length===s+(d?1:0)&&d){var g="Grand Total."+o[a].querySelector("Caption").textContent,m="3"===h[a]&&this.dataFields[this.getUniqueName(o[a].querySelector("UName").textContent)]&&this.dataFields[this.getUniqueName(o[a].querySelector("UName").textContent)].caption?this.dataFields[this.getUniqueName(o[a].querySelector("UName").textContent)].caption:o[a].querySelector("Caption").textContent;(t=this.frameGrandTotalAxisSet(t,this.getUniqueName(o[a].querySelector("UName").textContent),m,this.pivotValues.length,r,Number(h[a]),o[a].querySelector("PARENT_UNIQUE_NAME")?o[a].querySelector("PARENT_UNIQUE_NAME").textContent:void 0,o[a].querySelector("LName").textContent,o[a].getAttribute("Hierarchy"),{levelName:g,axis:o[a].getAttribute("Hierarchy")}))[t.length-1].valueSort["Grand Total."+o[a].querySelector("Caption").textContent]=1}s,l}n=this.dataSourceSettings.values.length+1===t.length,r++}return t},e.prototype.frameColumnHeader=function(e){var t=this;this.headerGrouping={},this.lastLevel=[];for(var i=0,a=[],r=[],n=[],o=-1,s=-1,l=this.customArgs.drillInfo&&"column"===this.customArgs.drillInfo.axis?this.customArgs.drillInfo.currentCell.ordinal+1:0;i<e.length;){var d=e[i].querySelectorAll("Member");a=this.frameTupCollection(d,a,i+l,this.tupColumnInfo,this.showColumnSubTotals,this.hideColumnTotalsObject,"column"),i++}if(e.length>0){d=e[0].querySelectorAll("Member");for(var h=0;h<d.length;)n[h]="1"===d[h].querySelector("MEMBER_TYPE").textContent&&0===Number(d[h].querySelector("LNum").textContent)?0:Number(d[h].querySelector("LNum").textContent),"1"!==d[h].querySelector("MEMBER_TYPE").textContent||!this.isPaging&&0!==Number(d[h].querySelector("LNum").textContent)?r[h]=1:(r[h]=0,o=-1===o?h:o,s=h),h++}i=0;for(var p,u=1,c={},g=!0,m=!1,f=function(){var l=e[i].querySelectorAll("Member"),d=v.tupColumnInfo[i].allCount,h=v.tupColumnInfo[i].allStartPos,f=v.tupColumnInfo[i].measure,S=v.tupColumnInfo[i].typeCollection,y=v.tupColumnInfo[i].drillInfo,b=v.tupColumnInfo[i].drillStartPos,C=v.tupColumnInfo[i].startDrillUniquename,x=v.tupColumnInfo[i].endDrillUniquename,w=v.tupColumnInfo[i].drillEndPos,T=v.tupColumnInfo[i].levelCollection,M="2"!==S[0]&&("3"!==S[0]||"2"!==S[1]),D=0;a.map(function(e,i){D+=0===r[i]?e+(1-(n[i]>1?1:n[i])):0===e?t.isPaging&&"2"===S[i]?0:1:e}),v.colDepth=v.colDepth>D?v.colDepth:D,0===i&&l.length>d+(f?1:0)&&(m=!0,M=d>0&&M?h>o:M);var O=!1;if("Top"===v.dataSourceSettings.grandTotalsPosition&&v.dataSourceSettings.showGrandTotals&&v.dataSourceSettings.showColumnGrandTotals){for(var N=0,E=0;E<l.length;E++)0===l[E].querySelector("Caption").textContent.indexOf("All")&&N++;O=N===("column"===v.olapValueAxis?v.dataSourceSettings.columns.length-1:v.dataSourceSettings.columns.length)}if((M||O)&&(0===d||O)){var P=[-1,-1,-1];v.tupColumnInfo[i-1]&&0===v.tupColumnInfo[i-1].allCount?P=v.levelCompare(T,v.tupColumnInfo[i-1].levelCollection):m&&p&&(P=v.levelCompare(T,p.levelCollection)),v.tupColumnInfo[i].drillStartPos<0?(!g&&P[0]>-1&&P[2]>-1&&(u=v.mergeTotCollection(u,d,a,n,r,h,y,P)),v.setParentCollection(l),v.frameCommonColumnLoop(l,i,u,a,r,n),v.tupColumnInfo[i].showTotals||u--,!g&&P[0]>-1&&P[2]>-1&&(u=v.mergeTotCollection(u,d,a,n,r,h,y,P)),g=!1,v.isColDrill?v.isColDrill=!1:u++):c.drillStartPos===b&&c.startDrillUniquename===C&&c.allCount!==d||(!g&&P[0]>-1&&P[2]>-1&&(u=v.mergeTotCollection(u,d,a,n,r,h,y,P),g=!0),v.setParentCollection(l),(!m||s<=b)&&(O||(v.totalCollection[v.totalCollection.length]={allCount:d,ordinal:i,members:l,drillInfo:y}),c.allCount=d,c.allStartPos=h,c.drillStartPos=b,c.startDrillUniquename=C,c.endDrillUniquename=x)),p=v.tupColumnInfo[i]}var F=v.checkAttributeDrill(v.tupColumnInfo[i].drillInfo,"columns");if(d>0&&(!m||M&&(F||s<h))&&(d===c.allCount||h!==c.allStartPos)){var I=w===b||c.endDrillUniquename===x,L=h!==c.allStartPos?c.startDrillUniquename!==C:I;b>-1&&!L||(g||(u=v.mergeTotCollection(u,d,a,n,r,h,y),g=!0),v.setParentCollection(l),m&&b>-1&&!(s<=b)||(O||(v.totalCollection[v.totalCollection.length]={allCount:d,ordinal:i,members:l,allStartPos:h,drillInfo:y}),c.allCount=d,c.allStartPos=h,c.drillStartPos=b,c.startDrillUniquename=C,c.endDrillUniquename=x))}i++},v=this;i<e.length;)f();if(this.totalCollection.length>0)if(Object.keys(this.colMeasures).length>1)this.orderTotals(u,a,r,n);else{this.totalCollection=this.totalCollection.reverse();for(var S=0,y=this.totalCollection;S<y.length;S++){var b=y[S];if(!(0===this.tupColumnInfo[b.ordinal].measurePosition?1===this.tupColumnInfo[b.ordinal].allStartPos:0===this.tupColumnInfo[b.ordinal].allStartPos)||this.dataSourceSettings.showGrandTotals&&this.dataSourceSettings.showColumnGrandTotals){this.frameCommonColumnLoop(b.members,b.ordinal,u,a,n,r);var C=this.checkAttributeDrill(this.tupColumnInfo[b.ordinal].drillInfo,"columns");(this.tupColumnInfo[b.ordinal].showTotals||C)&&u++}}}},e.prototype.orderTotals=function(e,t,i,a){for(var r={},n=1,o=0,s=this.totalCollection;o<s.length;o++){var l=s[o];if(!(0===this.tupColumnInfo[l.ordinal].measurePosition?1===this.tupColumnInfo[l.ordinal].allStartPos:0===this.tupColumnInfo[l.ordinal].allStartPos)||this.dataSourceSettings.showGrandTotals&&this.dataSourceSettings.showColumnGrandTotals){var d=this.tupColumnInfo[l.ordinal].measure.querySelector("UName").textContent;r[d]?(r[d].coll.push(l),r[d].count++,n=n<r[d].count?r[d].count:n):r[d]={coll:[l],count:1}}}for(var h=Object.keys(r),p=n-1;p>-1;){for(var u=0,c=h;u<c.length;u++){(l=r[c[u]].coll[p])&&(this.frameCommonColumnLoop(l.members,l.ordinal,e,t,i,a),this.tupColumnInfo[l.ordinal].showTotals&&e++)}p--}},e.prototype.setParentCollection=function(e){for(var t=0;e.length>t;){var i=e[t],a=Number(i.querySelector("MEMBER_TYPE").textContent)>2?"3":i.querySelector("MEMBER_TYPE").textContent,r=Number(i.querySelector("LNum").textContent),n=i.querySelector("UName").textContent,o=i.querySelector("PARENT_UNIQUE_NAME")?i.querySelector("PARENT_UNIQUE_NAME").textContent:"",s=!0,l=!1;if(this.parentObjCollection[t]){var d=Object.keys(this.parentObjCollection[t]),h=this.parentObjCollection[t][r-1];s=h?o===h.querySelector("UName").textContent:0===d.length,l="1"===this.tupColumnInfo[0].typeCollection[t]}"2"===a?delete this.parentObjCollection[t]:(!this.isPaging&&!l||s||delete this.parentObjCollection[t],this.parentObjCollection[t]?this.parentObjCollection[t][r]&&this.parentObjCollection[t][r].querySelector("UName").textContent===n||(this.parentObjCollection[t][r]=i):(this.parentObjCollection[t]={},this.parentObjCollection[t][r]=i)),t++}},e.prototype.setDrillInfo=function(e,t,i,a,r){for(a--;r[a]&&r[a].drillInfo[i].uName===e;){if(r[a].uNameCollection.split(/~~|::\[/).map(function(e){return"["===e[0]?e:"["+e}).join("~~").indexOf(t)<0)break;r[a].drillInfo[i].isDrilled=!0,this.curDrillEndPos<=i&&(r[a].drillEndPos=this.curDrillEndPos=i,r[a].endDrillUniquename=e),(r[a].drillStartPos>i||-1===r[a].drillStartPos)&&(r[a].drillStartPos=i),r[a].startDrillUniquename=e,a--}},e.prototype.levelCompare=function(e,t){for(var i=[-1,0],a=0;a<t.length;a++)if(e[a]!==t[a]){i=[a,e[a],t[a]-e[a]];break}return i},e.prototype.mergeTotCollection=function(e,i,a,r,n,o,s,l){for(var d=t.isNullOrUndefined(o)?l[0]:o-(this.colMeasurePos===o-1?2:1),h=s[d]&&s[d].level,p=this.getLevelsAsString(d-1,s),u={},c=1,g=!1,m=0,f=this.totalCollection;m<f.length;m++){var v=f[m];if(g||v.allCount<=i&&(!(h>-1&&v.drillInfo[d])||v.drillInfo[d].level>=h&&this.getLevelsAsString(d-1,v.drillInfo)===p)){var S=this.tupColumnInfo[v.ordinal].measure?this.tupColumnInfo[v.ordinal].measure.querySelector("UName").textContent:"measure";u[S]?(u[S].coll.push(v),u[S].count++,c=c<u[S].count?u[S].count:c):u[S]={coll:[v],count:1},g=!1}}for(var y=Object.keys(u),b=c-1;b>-1;){for(var C=0,x=y;C<x.length;C++){var w=u[x[C]].coll[b];if(w){(!(0===this.tupColumnInfo[w.ordinal].measurePosition?1===this.tupColumnInfo[w.ordinal].allStartPos:0===this.tupColumnInfo[w.ordinal].allStartPos)||this.dataSourceSettings.showGrandTotals&&this.dataSourceSettings.showColumnGrandTotals)&&(this.frameCommonColumnLoop(w.members,w.ordinal,e,a,n,r),this.tupColumnInfo[w.ordinal].showTotals&&e++),this.totalCollection.pop()}}b--}return e},e.prototype.getLevelsAsString=function(e,t){for(var i=[],a=0;a<e;a++)i[a]=t[a].level;return i.length>0?i.toString():""},e.prototype.frameCommonColumnLoop=function(e,t,i,a,r,n){var o,s=-1;if(this.tupColumnInfo[t].showTotals)for(var l=0,d=0;l<e.length;)d+=n[l]>0&&this.getMeasurePosition(this.tupColumnInfo[t].uNameCollection,this.tupColumnInfo[t].measurePosition)!==l?a[l]:a[l]+(1-r[l]),this.tupColumnInfo[t].drillInfo[l].isDrilled&&this.tupColumnInfo[t].showTotals&&(this.tupColumnInfo[t].showTotals=!!this.showColumnSubTotals&&void 0===this.hideColumnTotalsObject[this.tupColumnInfo[t].drillInfo[l].hierarchy],d-=a[l]-this.tupColumnInfo[t].levelCollection[l],s=this.tupColumnInfo[t].showTotals?-1:d-1),l++;var h=this.checkAttributeDrill(this.tupColumnInfo[t].drillInfo,"columns");if(this.tupColumnInfo[t].showTotals||h)for(var p=0,u=0,c={};p<e.length;){for(var g=e[p],m=Number(g.querySelector("MEMBER_TYPE").textContent)>2?"3":g.querySelector("MEMBER_TYPE").textContent,f=0,v="2"!==m?n[p]?1:r[p]:1;v<=("3"===m?1:a[p]);v++){var S=!1;this.pivotValues[u]||(this.pivotValues[u]=[]),Number(e[p].querySelector("LNum").textContent)>v&&"2"!==m?(this.parentObjCollection[p][v]||this.getDrilledParent(e[p],v,this.parentObjCollection[p]),this.parentObjCollection[p][v]&&(g=this.parentObjCollection[p][v]),S=!0):(g=e[p],f++),"2"!==m&&(c[g.querySelector("UName").textContent]=g.querySelector("Caption").textContent);for(var y="",b=Object.keys(c),C=0;C<b.length;C++){var x=b[C];y=0===C?c[x]:y+"."+c[x]}var w=!!this.namedSetsPosition.column[p],T=this.getUniqueName(g.querySelector("UName").textContent),M=this.getDepth(this.tupColumnInfo[t],T,Number(m));if(this.isPaging&&this.pivotValues[u-1]&&this.pivotValues[u-1][i]&&this.fieldList[this.pivotValues[u-1][i].hierarchy]&&this.fieldList[this.pivotValues[u-1][i].hierarchy].isHierarchy&&this.pivotValues[u-1][i].hasChild&&!this.pivotValues[u-1][i].isDrilled&&!this.columns[p].isNamedSet&&this.fieldList[g.getAttribute("Hierarchy")]&&(this.fieldList[g.getAttribute("Hierarchy")].isHierarchy||this.fieldList[g.getAttribute("Hierarchy")].hasAllMember)&&this.pivotValues[u-1][i].depth<M){this.isColDrill=!0;break}this.pivotValues[u][i]={axis:"column",actualText:T,colIndex:i,formattedText:"3"===m&&this.dataFields[T]&&this.dataFields[T].caption?this.dataFields[T].caption:g.querySelector("Caption").textContent,hasChild:!!(this.fieldList[g.getAttribute("Hierarchy")]&&this.fieldList[g.getAttribute("Hierarchy")].isHierarchy&&p<this.columns.length-1&&!this.columns[p+1].isNamedSet&&this.columns[p+1].name.indexOf("[Measures]")<0&&this.fieldList[this.columns[p+1].name]&&this.fieldList[this.columns[p+1].name].hasAllMember)||Number(g.querySelector("CHILDREN_CARDINALITY").textContent)>0,level:f>1?-1:Number(g.querySelector("LNum").textContent)-(n[p]&&"3"!==m?1:0),rowIndex:u,ordinal:t,memberType:Number(m),depth:M,isDrilled:!(!this.fieldList[g.getAttribute("Hierarchy")]||!this.fieldList[g.getAttribute("Hierarchy")].isHierarchy||this.isAttributeDrill(g.getAttribute("Hierarchy"),this.tupColumnInfo[t].drillInfo,"columns"))||(S||this.tupColumnInfo[t].drillInfo[p].isDrilled),parentUniqueName:g.querySelector("PARENT_UNIQUE_NAME")?g.querySelector("PARENT_UNIQUE_NAME").textContent:void 0,levelUniqueName:g.querySelector("LName").textContent,hierarchy:g.getAttribute("Hierarchy"),isNamedSet:w,valueSort:(o={levelName:y},o[y]=1,o.axis=g.getAttribute("Hierarchy"),o)},this.headerContent[u]||(this.headerContent[u]={}),this.headerContent[u][i]=this.pivotValues[u][i],u++}p++}else if(s>-1)this.pivotValues[s][i-1].ordinal=t;else if(this.tupColumnInfo[t].allCount>0){for(l=0,d=0;l<this.tupColumnInfo[t].allStartPos;)d+=n[l]>0&&this.getMeasurePosition(this.tupColumnInfo[t].uNameCollection,this.tupColumnInfo[t].measurePosition)!==l?a[l]:a[l]+(1-r[l]),l++;this.tupColumnInfo[t].allStartPos===this.tupColumnInfo[t].measurePosition+1?d-=a[this.tupColumnInfo[t].allStartPos-2]-this.tupColumnInfo[t].levelCollection[this.tupColumnInfo[t].allStartPos-2]+1:d-=a[this.tupColumnInfo[t].allStartPos-1]-this.tupColumnInfo[t].levelCollection[this.tupColumnInfo[t].allStartPos-1],this.pivotValues[d-1][i-1].ordinal=t}},e.prototype.isAttributeDrill=function(e,t,i){var a=!1;if(!this.isAdjacentToMeasure(e,i))for(var r=0;r<this.drilledMembers.length;r++)if(this.drilledMembers[r].name===e)for(var n=0;n<this.drilledMembers[r].items.length;n++){for(var o=this.drilledMembers[r].items[n].split(this.drilledMembers[r].delimiter),s="",l=0;l<o.length;l++)t[l]&&t[l].uName&&(s=s+(""===s?"":this.drilledMembers[r].delimiter)+t[l].uName);if(s===this.drilledMembers[r].items[n]){a=!0;break}}return a},e.prototype.isAdjacentToMeasure=function(e,t){for(var i=!1,a="rows"===t?this.rows:this.columns,r=0;r<a.length;r++)if(a[r].name===e&&a[r+1]&&("[Measures]"===a[r+1].name||a[r+1].isNamedSet||this.fieldList[a[r+1].name]&&!this.fieldList[a[r+1].name].hasAllMember)){i=!0;break}return i},e.prototype.getDrilledParent=function(e,t,i){for(var a=e,r=Number(e.querySelector("LNum").textContent)-1;r>=t;r--){var n=this.drilledSets[a.querySelector("PARENT_UNIQUE_NAME").textContent];if(!n)break;i[r]=n,a=n}},e.prototype.performRowSorting=function(){var e;if(this.enableSort&&this.tupRowInfo.length>0){for(var t=this.pivotValues.length,i={},a={},r=[],n=!1,o=this.tupRowInfo[0].typeCollection.lastIndexOf("1"),s=this.colDepth;s<t;s++){var l=this.pivotValues[s][0],d=this.tupRowInfo[l.ordinal],h=d?0===d.measurePosition&&3===l.memberType?d.measureName:d.uNameCollection:"";if(""!==h){o>-1&&(h=this.frameUniqueName(h,l,d));var p=h.split(/~~|::\[/).length;if(3===l.memberType&&this.tupRowInfo[0].measurePosition>0){a[A=this.getParentUname(h,l,!0,!0)]?a[A].push(l):a[A]=[l]}else i[p]?i[p][h]=[l]:i[p]=(e={},e[h]=[l],e)}n&&r.push(l),"grand sum"===l.type&&(n=!0)}for(var u=Object.keys(a).length>0&&this.tupRowInfo[0].measurePosition>0,c=Object.keys(i).map(function(e){return Number(e)}).sort(function(e,t){return e>t?1:t>e?-1:0}),g={},m=c.length-1;m>=0;m--){for(var f={},v=i[c[m]],S=Object.keys(v),y=0;y<S.length;y++){f[A=0===m?"parent":this.getParentUname(S[y],v[S[y]][0],u,!1)]?f[A].push(v[S[y]][0]):f[A]=v[S[y]]}for(var b=Object.keys(f),C=0;C<b.length;C++)f[b[C]]=this.sortRowHeaders(f[b[C]]);if(g[c[m+1]])for(C=0;C<b.length;C++){for(var x=[],w=f[b[C]],T=0;T<w.length;T++){var M=this.tupRowInfo[w[T].ordinal],D=0===M.measurePosition&&3===w[T].memberType?M.measureName:M.uNameCollection;x.push(w[T]),o>-1&&(D=this.frameUniqueName(D,w[T],M));var O=!1;if(u){if(a[A=this.getParentUname(D,w[T],u,!0)]){a[A]=this.sortRowHeaders(a[A]);var N=D.lastIndexOf("::[")===D.indexOf("::[Measures]"),E=D.split("::[").length-1===M.measurePosition,P=!M.drillInfo[M.measurePosition-1].isDrilled,F=M.members.length>M.measurePosition+1;if(N&&E&&P&&F){O=!0;for(var I=0;I<a[A].length;I++){x.push(a[A][I]);var L=D.substring(0,D.indexOf("::[Measures]"))+"::"+a[A][I].actualText;g[c[m+1]][L]&&(x=x.concat(g[c[m+1]][L]))}}else x=x.concat(a[A])}}!O&&g[c[m+1]][D]&&(x=x.concat(g[c[m+1]][D]))}f[b[C]]=x}else if(u)for(C=0;C<b.length;C++){for(w=f[b[C]],x=[],T=0;T<w.length;T++){x.push(w[T]);D=this.tupRowInfo[w[T].ordinal].uNameCollection;o>-1&&(D=this.frameUniqueName(D,w[T],this.tupRowInfo[w[T].ordinal]));var A;a[A=this.getParentUname(D,w[T],!0,!0)]&&(a[A]=this.sortRowHeaders(a[A]),x=x.concat(a[A]))}f[b[C]]=x}g[c[m]]=f}var R=0,j=0,k=0;n=!1,r=this.sortRowHeaders(r);for(s=this.colDepth;s<t;s++){"Top"===this.dataSourceSettings.grandTotalsPosition&&this.dataSourceSettings.showGrandTotals&&this.dataSourceSettings.showRowGrandTotals&&("column"===this.olapValueAxis&&this.colDepth+1===s||"row"===this.olapValueAxis&&this.colDepth+this.dataSourceSettings.values.length+1===s)&&(R=0,n=!1);var q=n?r:g[c[0]].parent,V="Top"===this.dataSourceSettings.grandTotalsPosition&&this.dataSourceSettings.showGrandTotals&&this.dataSourceSettings.showRowGrandTotals&&this.colDepth===s?q.length:n?R-j:R;q[V]&&(this.pivotValues[s]=[q[V]],this.pivotValues[s][0].rowIndex=s,this.valueContent[k][0]=this.pivotValues[s][0]),R++,k++,"grand sum"===this.pivotValues[s][0].type&&(n=!0,j=R)}}},e.prototype.performColumnSorting=function(){if(this.enableSort)for(var e=0;e<this.dataSourceSettings.columns.length;e++){for(var i=[],a=0,r=[],n=0;n<this.pivotValues.length;n++){var o=this.pivotValues[n],s=void 0,l=void 0,d={},h=1;r[a]=[],i[a]=[];var p=1;for(p=p;p<o.length;p++)if(!o[p].isNamedSet){if(2!=o[p].memberType&&"[Measures]"!=o[p].hierarchy&&-1!=o[p].level){if(t.isNullOrUndefined(d[o[p].formattedText])||t.isNullOrUndefined(this.pivotValues[n-1]))d[o[p].formattedText]=d[o[p].formattedText]?d[o[p].formattedText]:[],d[o[p].formattedText][o[p].colIndex]=o[p];else if(d[o[p].formattedText]&&this.pivotValues[n-1]){var u=this.pivotValues[n-1][o[p].colIndex],c=Number(Object.keys(d[o[p].formattedText])[0]),g=d[o[p].formattedText][c].colIndex,m=this.pivotValues[n-1][g];if(u.formattedText!==m.formattedText){var f=Object.keys(d);f=this.sortColumnHeaders(f,this.sortObject[o[p-1].levelUniqueName]||this.sortObject[o[p].hierarchy]),t.isNullOrUndefined(i[a])?i[a]=[]:i[a];for(var v=0;v<f.length;v++)for(var S=Object.keys(d[f[v]]).length,y=0;y<S;y++)h=0===i[a].length?1:0,i[a][i[a].length+h]=d[f[v]][Number(Object.keys(d[f[v]])[y])];(d={})[o[p].formattedText]=[],d[o[p].formattedText][o[p].colIndex]=o[p]}else d[o[p].formattedText][o[p].colIndex]=o[p]}}else if(Object.keys(d).length>0){r[a][r[a].length+h]=o[p],s=Object.keys(d),s=this.sortColumnHeaders(s,this.sortObject[o[p-1].levelUniqueName]||this.sortObject[o[p].hierarchy]),t.isNullOrUndefined(i[a])?i[a]=[]:i[a];for(var b=0;b<s.length;b++)for(var C=Object.keys(d[s[b]]).length,x=0;x<C;x++)h=0===i[a].length?1:0,i[a][i[a].length+h]=d[s[b]][Number(Object.keys(d[s[b]])[x])]}else(-1===o[p].level||0===o[p].level)&&Object.keys(d).length>=0&&"[Measures]"!=o[p].hierarchy&&(r[a][r[a].length+h]=o[p]);if(-1!=o[p].level&&1===Object.keys(d).length&&"[Measures]"!=o[p].hierarchy&&!t.isNullOrUndefined(o[p+1])&&-1===o[p+1].level){var w=Object.keys(d[o[p].formattedText]).length,T=Object.keys(d[o[p].formattedText]);if(w>1)for(var M=0;M<w;M++)h=0===r[a].length?1:0,r[a][r[a].length+h]=d[o[p].formattedText][Number(T[M])];else r[a][r[a].length+h]=o[p]}if(Object.keys(r[a]).length>0){h=0===i[a].length?1:0;var D=r[a].length;if(D>2)for(var O=1;O<D;O++)h=0===i[a].length?1:0,i[a][i[a].length+h]=r[a][O];else i[a][i[a].length+h]=r[a][1]||r[a][0];d={},r[a]=[]}}if(Object.keys(d).length>0){r[a][r[a].length+h]=o[p],l=Object.keys(d);var N=this.sortObject[o[p-1].levelUniqueName]||this.sortObject[o[p-1].hierarchy];s=this.sortColumnHeaders(l,N),t.isNullOrUndefined(i[a])?i[a]=[]:i[a];for(var E=0;E<l.length;E++){var P=Object.keys(d[l[E]]).length;for(x=0;x<P;x++)h=0===i[a].length?1:0,i[a][i[a].length+h]=d[s[E]][Number(Object.keys(d[l[E]])[x])]}}for(var F=1;F<i[a].length;F++)this.pivotValues[a][F]=i[a][F];for(var I=n;I<this.pivotValues.length;I++){var L=t.extend({},this.pivotValues[I+1],null,!0),A=t.extend({},this.pivotValues[I],null,!0);if(Object.keys(L).length===Object.keys(A).length&&Object.keys(L).length>2){for(var R=1;R<this.pivotValues[n].length;R++)Object.keys(L).length>0&&A[R].colIndex!=L[R].colIndex&&(this.pivotValues[I+1][R]=L[A[R].colIndex]);break}}a++,d={}}for(var j=0;j<this.pivotValues.length;j++)for(o=this.pivotValues[j],n=1;n<o.length;n++)o[n].colIndex=n}},e.prototype.frameUniqueName=function(e,t,i){var a=e.indexOf(t.actualText.toString()+"::[Measures]")>-1,r=(e=e.substring(0,e.indexOf(t.actualText.toString()))+t.actualText.toString()).split("::[").length<=this.getMeasurePosition(e,i.measurePosition);return e+=a||r?"::"+i.measureName:""},e.prototype.getMeasurePosition=function(e,t){for(var i=t,a=e.split("::["),r=0;r<a.length;r++)if(a[r]&&a[r].indexOf("Measures")>-1){i=r;break}return i},e.prototype.sortRowHeaders=function(e){if(e.length>0&&3!==e[0].memberType&&!e[0].isNamedSet){var t=this.sortObject[e[0].hierarchy]||this.sortObject[e[0].levelUniqueName];"Ascending"===t||void 0===t?e.sort(function(e,t){return e.formattedText>t.formattedText?1:t.formattedText>e.formattedText?-1:0}):"Descending"===t&&e.sort(function(e,t){return e.formattedText<t.formattedText?1:t.formattedText<e.formattedText?-1:0})}return e},e.prototype.sortColumnHeaders=function(e,t){return"Ascending"===t||void 0===t?e.sort(function(e,t){return e>t?1:t>e?-1:0}):"Descending"===t&&e.sort(function(e,t){return e<t?1:t<e?-1:0}),e},e.prototype.frameSortObject=function(){if(this.enableSort)for(var e=0;e<this.sortSettings.length;e++)this.sortObject[this.sortSettings[e].name]=this.sortSettings[e].order},e.prototype.getParentUname=function(e,t,i,a){var r="";if(i&&!a){for(var n=this.tupRowInfo[t.ordinal],o=[],s={},l=0;l<e.length;l++)"~"!==e[l]&&":"!==e[l]||(o.push(l),s[l]=e[l]+e[l],l++);if(this.getMeasurePosition(e,n.measurePosition)>=e.split("::[").length-1)r=o[o.length-2]>-1?e.substring(0,o[o.length-2])+s[o[o.length-1]]+n.measureName:"parent";else{r=(d=e.lastIndexOf("~~")>e.lastIndexOf("::[")?e.lastIndexOf("~~"):e.lastIndexOf("::["))>-1?e.substring(0,d):"parent"}}else{var d;r=(d=e.lastIndexOf("~~")>e.lastIndexOf("::[")?e.lastIndexOf("~~"):e.lastIndexOf("::["))>-1?e.substring(0,d):"parent"}return r},e.prototype.performColumnSpanning=function(){for(var e={},t=this.rowStartPos-1,i=Object.keys(this.colMeasures).length;t>-1;){e[t]={};for(var a=this.pivotValues[t].length-1;a>0;){e[t][a]=1;var r=this.pivotValues[t][a+1],n=this.pivotValues[t+1]&&this.rowStartPos-t>1?this.pivotValues[t+1][a]:void 0,o=this.pivotValues[t][a],s=!1,l=!1,d=this.tupColumnInfo[o.ordinal],h=d.allStartPos>("3"===d.typeCollection[0]?1:0),p=this.checkAttributeDrill(d.drillInfo,"columns");if(n&&r&&(2===o.memberType||-1===o.level?r.actualText===o.actualText:3===o.memberType&&o.actualText===r.actualText||r.valueSort.levelName===o.valueSort.levelName)&&(2===o.memberType?h&&"sum"!==r.type?o.colSpan=1:o.colSpan=r.colSpan+1>(d.measurePosition>t?i:0)?1:r.colSpan+1:(o.colSpan=r.colSpan+1,o.ordinal=r.ordinal),s=!0),2===o.memberType){if(h)p||(o.type="sum"),o.formattedText="Total",o.valueSort[o.valueSort.levelName.toString()]=1;else{var u="Grand Total";n&&i>0&&(u=3===n.memberType?"Grand Total."+n.formattedText:n.valueSort.levelName),o.type="grand sum",o.formattedText="Grand Total",o.valueSort.levelName=u,o.valueSort[u.toString()]=1}o.hasChild=!1}else-1===o.level&&(o.type="sum",o.formattedText="Total",o.hasChild=!1,o.valueSort[o.valueSort.levelName.toString()]=1);n?2===o.memberType&&2===n.memberType||n.actualText===o.actualText?(e[t][a]=e[t+1]?e[t+1][a]+1:1,0===t||1===o.memberType&&o.level>-1&&1===n.memberType&&-1===n.level?(o.rowSpan=!o.isDrilled||this.fieldList[o.hierarchy]&&this.fieldList[o.hierarchy].isHierarchy&&!o.hasChild?e[t+1][a]+1:1,n.rowSpan=!n.isDrilled||this.fieldList[n.hierarchy]&&this.fieldList[n.hierarchy].isHierarchy&&!n.hasChild||-1!==n.level?n.rowSpan:e[t+1][a]):3===o.memberType?o.rowSpan=1:o.rowSpan=-1,l=!0):!o.isDrilled||this.fieldList[o.hierarchy]&&this.fieldList[o.hierarchy].isHierarchy&&!o.hasChild||-1!==o.level||2!==n.memberType?(o.rowSpan=0===t?e[t][a]:-1,n.rowSpan=n.level>-1&&(!n.isDrilled||this.fieldList[n.hierarchy]&&this.fieldList[n.hierarchy].isHierarchy&&!n.hasChild)||2!==o.memberType&&2===n.memberType?e[t+1][a]:1):(e[t][a]=e[t+1]?e[t+1][a]+1:1,o.rowSpan=-1,l=!0):o.rowSpan=o.level>-1||1===this.rowStartPos?e[t][a]:-1,s||(o.colSpan=1),l||(e[t][a]=1),a--}t--}},e.prototype.frameValues=function(e,i){var a=this.colDepth,r=this.pivotValues.length,n=0;if("down"===this.customArgs.action){var o=Object.keys(this.onDemandDrillEngine);a=Number(o[0]),r=Number(o[o.length-1])+1,n=this.onDemandDrillEngine[a][0].ordinal}for(var s={},l=0;l<e.length;l++)s[Number(e[l].getAttribute("CellOrdinal"))]=e[l];for(var d=a;d<r;d++){var h=this.pivotValues[d],p=h[0].ordinal;for(l=1;l<this.pivotValues[0].length;l++)if(this.pivotValues[this.colDepth-1][l]){var u=this.pivotValues[this.colDepth-1][l].ordinal,c=this.pivotValues[this.colDepth-1][l],g=3===h[0].memberType?h[0].actualText.toString():this.tupColumnInfo[c.ordinal]&&this.tupColumnInfo[c.ordinal].measure?this.tupColumnInfo[c.ordinal].measure.querySelector("UName").textContent:h[0].actualText;if("header"===h[0].type)h[l]={axis:"value",actualText:this.getUniqueName(g),formattedText:"",value:0,colIndex:l,rowIndex:d};else{var m=void 0,f=void 0,v="0",S=this.getUniqueName(g),y=!0,b=this.fieldList[h[0].hierarchy]&&this.fieldList[h[0].hierarchy].isHierarchy&&h[0].isDrilled;y=this.tupRowInfo[p]?this.tupRowInfo[p].showTotals:this.dataSourceSettings.showGrandTotals&&this.dataSourceSettings.showRowGrandTotals,m=s[(p-n)*i+u],f=!y&&b?"":t.isNullOrUndefined(m)||t.isNullOrUndefined(m.querySelector("FmtValue"))?this.emptyCellTextContent:m.querySelector("FmtValue").textContent,v=!y&&b?"0":t.isNullOrUndefined(m)||t.isNullOrUndefined(m.querySelector("Value"))?null:m.querySelector("Value").textContent,f=y&&!t.isNullOrUndefined(v)?this.getFormattedValue(Number(v),S,""!==f?f:v):f;var C=!this.tupColumnInfo[u]||(this.tupColumnInfo[u].allCount>0||this.tupColumnInfo[u].drillStartPos>-1)||!this.tupRowInfo[p]||this.tupRowInfo[p].allCount>0||this.tupRowInfo[p].drillStartPos>-1,x=!!this.tupRowInfo[p]&&(0===this.tupRowInfo[p].measurePosition?1===this.tupRowInfo[p].allStartPos:0===this.tupRowInfo[p].allStartPos)||!!this.tupColumnInfo[u]&&(0===this.tupColumnInfo[u].measurePosition?1===this.tupColumnInfo[u].allStartPos:0===this.tupColumnInfo[u].allStartPos);h[l]={axis:"value",actualText:S,formattedText:f,colOrdinal:u,rowOrdinal:p,columnHeaders:this.tupColumnInfo[u]?this.tupColumnInfo[u].captionCollection:"",rowHeaders:this.tupRowInfo[p]?this.tupRowInfo[p].captionCollection:"",value:t.isNullOrUndefined(v)?null:Number(v),colIndex:l,rowIndex:d,isSum:C,isGrandSum:x}}this.valueContent[d-this.rowStartPos][l]=h[l]}}},e.prototype.getFormattedValue=function(e,i,a){var r=a;if(this.formatFields[i]&&!t.isNullOrUndefined(e)){var n=this.formatFields[i].properties?this.formatFields[i].properties:this.formatFields[i],o=t.extend({},n,null,!0);if(delete o.name,!o.minimumSignificantDigits&&o.minimumSignificantDigits<1&&delete o.minimumSignificantDigits,!o.maximumSignificantDigits&&o.maximumSignificantDigits<1&&delete o.maximumSignificantDigits,o.type)r=this.globalize.formatDate(new Date(e.toString()),o);else{if(delete o.type,o.format&&!this.formatRegex.test(o.format)){var s=o.format.match(this.customRegex)[6];o.useGrouping=-1!==s.indexOf(",")}r=this.globalize.formatNumber(e,o)}}return r},e.prototype.getMeasureInfo=function(){for(var e,t="column",i=[],a=0,r=this.values;a<r.length;a++){var n=r[a];i[i.length]=n.isCalculatedField?this.fieldList[n.name].tag:n.name}if(i.length>1){if(this.isMeasureAvail){for(var o=!1,s=0,l=this.rows.length;s<l;s++)if("[measures]"===this.rows[s].name.toLowerCase()){t="row",e=s,o=!0;break}if(!o)for(s=0,l=this.columns.length;s<l;s++)if("[measures]"===this.columns[s].name.toLowerCase()){t="column",e=s,o=!0;break}}else e="row"===(t=this.valueAxis)?this.rows.length-1:this.columns.length-1;return{measureAxis:t,measureIndex:e,valueInfo:i}}return{measureAxis:t,measureIndex:-1,valueInfo:[]}},e.prototype.frameMeasureOrder=function(e,t,i,a,r){var n=[],o=[],s=[],l={},d=[],h=e.measureAxis,p=e.measureIndex,u=e.valueInfo;if(h===t&&u.length>0){for(var c={},g=[],m=0,f=i.length;m<f;m++){for(var v=i[m],S=[].slice.call(v.querySelectorAll("Member")),y="",b="",C=0;C<S.length;)y=y+(""!==y?"~~":"")+S[C].querySelector("UName").textContent,C===p&&0===p?b=y:C===p-1&&(b=y),C++;c[b]?c[b][c[b].length]=y:(c[b]=[y],g[g.length]=b),l[y]={index:m,node:v},d[d.length]=y}if(d.length>0&&g.length>0)if(0===p)for(var x=0,w=u;x<w.length;x++)for(var T=w[x],M=0,D=g;M<D.length;M++){if((F=D[M])===T)for(var O=0,N=c[F];O<N.length;O++){y=N[O];s[s.length]=l[y].index,n[n.length]=l[y].node}}else for(var E=0,P=g;E<P.length;E++)for(var F=P[E],I=0,L=u;I<L.length;I++)for(var A=L[I],R=0,j=c[F];R<j.length;R++){(y=j[R]).split("~~")[p]===A&&(s[s.length]=l[y].index,n[n.length]=l[y].node)}if(a.length>0){for(var k=[],q=[],V=0,H=0,B=(m=0,a.length);m<B;m++)V>r-1?(V=0,k[++H]||(k[H]=[]),k[H][V]=m,V++):(k[H]||(k[H]=[]),k[H][V]=m,V++),q[q.length]=Number(a[m].getAttribute("CellOrdinal"));if("column"===h){if(k.length>0&&k[0].length===s.length)for(C=0,B=s.length;C<B;C++)for(m=0;m<k.length;){var _=q[U=m*r+C].toString();(G=a[Number(k[m][s[C]])]).setAttribute("CellOrdinal",_.toString()),o[U]=G,m++}}else if(k.length===s.length)for(C=0,B=s.length;C<B;C++)for(m=0;m<k[s[C]].length;){var U,G;_=q[U=C*r+m].toString();(G=a[Number(k[s[C]][m])]).setAttribute("CellOrdinal",_.toString()),o[o.length]=G,m++}}return{orderedHeaderTuples:n,orderedValueTuples:o}}return{orderedHeaderTuples:i,orderedValueTuples:a}},e.prototype.getDrilledSets=function(e,i,a,r){for(var n=[],o=i.actualText.toString(),s="row"===r?this.tupRowInfo:this.tupColumnInfo,l=s[i.ordinal],d=0===s[0].typeCollection.indexOf("3")?1:0,h=0,p="1"===s[0].typeCollection[a];h<s.length;)(t.isNullOrUndefined(s[h].allStartPos)||s[h].allStartPos>d)&&(n[n.length]=s[h].uNameCollection),h++;for(var u=e.split("::[").map(function(e){return"["===e[0]?e:"["+e}),c=[],g=0;g<=a;g++)if(u[g])if((p||this.isPaging)&&g===a){for(var m=u[g].split("~~"),f=m.indexOf(o),v=[],S=0;S<=f;S++)v.push(m[S]);c[c.length]=v.length>0?v.join("~~"):u[g]}else c[c.length]=u[g];e=c.join("::");for(var y=[],b={},C=0,x=n;C<x.length;C++){var w=x[C];if(0===w.indexOf(e)&&(y.push(w),this.isPaging))for(var T=w.split("::[")[a],M=(N=(T="["===T[0]?T:"["+T).split("~~")).indexOf(o);M<N.length;M++)b[N[M]]=N[M]}if(this.isPaging){var D=l.uNameCollection.split("::[").map(function(e){return"["===e[0]?e:"["+e}),O=[];for(M=0;M<D.length;M++)M!==a&&(O[M]=D[M]);var N=Object.keys(b);for(M=0;M<N.length;M++)O[a]=N[M],y.push(O.join("::"))}for(var E={},P=0,F=y;P<F.length;P++){for(var I=F[P].split("::[").map(function(e){return"["===e[0]?e:"["+e}),L="",A=0;A<=a;A++){var R=I[A];if(R){var j=R.split("~~");L=L+(""!==L?"~~":"")+j[j.length-1]}}E[L]=L}return E},e.prototype.updateDrilledInfo=function(e){this.dataSourceSettings=e,this.drilledMembers=e.drilledMembers?this.updateDrilledItems(e.drilledMembers):[],this.generateGridData(e)},e.prototype.updateCalcFields=function(e,t){this.dataSourceSettings=e,this.calculatedFieldSettings=e.calculatedFieldSettings?e.calculatedFieldSettings:[],this.getAxisFields(),this.updateFieldlist(),this.loadCalculatedMemberElements(this.calculatedFieldSettings),this.dataFields[t.name]?this.generateGridData(e):un.getCellSets(e,this,!0,void 0,!0)},e.prototype.onSort=function(e){this.dataSourceSettings=e,this.sortSettings=e.sortSettings?e.sortSettings:[],this.getAxisFields(),this.frameSortObject(),this.updateFieldlist(),this.xmlaCellSet.length>0&&this.xmlDoc?this.generateEngine(this.xmlDoc,this.request,this.customArgs):this.generateGridData(e)},e.prototype.updateFieldlist=function(e){for(var t=0;t<this.savedFieldListData.length;){var i=this.savedFieldListData[t].id,a=this.savedFieldListData[t].pid;if(this.savedFieldList[i]){var r=this.enableSort?this.sortObject[i]?this.sortObject[i]:"Ascending":"None";this.savedFieldList[i].isSelected=!1,this.savedFieldList[i].isExcelFilter=!1,this.savedFieldList[i].sort=r,this.savedFieldList[i].allowDragAndDrop=!0,this.savedFieldList[i].showFilterIcon=!0,this.savedFieldList[i].showSortIcon=!0,this.savedFieldList[i].showEditIcon=!0,this.savedFieldList[i].showRemoveIcon=!0,this.savedFieldList[i].showValueTypeIcon=!0,this.savedFieldList[i].showSubTotals=!0,this.savedFieldListData[t].sort=r,this.savedFieldListData[t].allowDragAndDrop=!0,this.savedFieldListData[t].showFilterIcon=!0,this.savedFieldListData[t].showSortIcon=!0,this.savedFieldListData[t].showEditIcon=!0,this.savedFieldListData[t].showRemoveIcon=!0,this.savedFieldListData[t].showValueTypeIcon=!0,this.savedFieldListData[t].showSubTotals=!0,e&&(this.savedFieldList[i].filter=[],this.savedFieldList[i].actualFilter=[])}if(this.dataFields[i]&&this.savedFieldList[i]&&this.selectedItems.indexOf(i)>-1?(this.savedFieldList[i].isSelected=!0,this.savedFieldList[i].allowDragAndDrop=!this.dataFields[i]||this.dataFields[i].allowDragAndDrop,this.savedFieldList[i].showFilterIcon=!this.dataFields[i]||this.dataFields[i].showFilterIcon,this.savedFieldList[i].showSortIcon=!this.dataFields[i]||this.dataFields[i].showSortIcon,this.savedFieldList[i].showEditIcon=!this.dataFields[i]||this.dataFields[i].showEditIcon,this.savedFieldList[i].showRemoveIcon=!this.dataFields[i]||this.dataFields[i].showRemoveIcon,this.savedFieldList[i].showValueTypeIcon=!this.dataFields[i]||this.dataFields[i].showValueTypeIcon,this.savedFieldList[i].showSubTotals=!this.dataFields[i]||this.dataFields[i].showSubTotals,this.savedFieldListData[t].isSelected=!0,this.savedFieldListData[t].allowDragAndDrop=!this.dataFields[i]||this.dataFields[i].allowDragAndDrop,this.savedFieldListData[t].showFilterIcon=!this.dataFields[i]||this.dataFields[i].showFilterIcon,this.savedFieldListData[t].showSortIcon=!this.dataFields[i]||this.dataFields[i].showSortIcon,this.savedFieldListData[t].showEditIcon=!this.dataFields[i]||this.dataFields[i].showEditIcon,this.savedFieldListData[t].showRemoveIcon=!this.dataFields[i]||this.dataFields[i].showRemoveIcon,this.savedFieldListData[t].showValueTypeIcon=!this.dataFields[i]||this.dataFields[i].showValueTypeIcon,this.savedFieldListData[t].showSubTotals=!this.dataFields[i]||this.dataFields[i].showSubTotals):this.dataFields[a]&&this.savedFieldList[a]&&this.selectedItems.indexOf(a)>-1?this.savedFieldListData[t].isSelected=!0:this.savedFieldListData[t].isSelected=!1,this.savedFieldList[i]&&this.savedFieldList[i].isCalculatedField||"[calculated members].[_0]"===i.toLowerCase()){for(var n=!1,o=0,s=this.calculatedFieldSettings;o<s.length;o++){var l=s[o];if(i===l.name){var d=l.formula,h=l.formatString;this.savedFieldListData[t].formula=d,this.savedFieldListData[t].formatString=h,this.savedFieldListData[t].parentHierarchy=d.toLowerCase().indexOf("measure")>-1?void 0:l.hierarchyUniqueName,this.savedFieldList[i].formula=d,this.savedFieldList[i].formatString=h,this.savedFieldList[i].parentHierarchy=this.savedFieldListData[t].parentHierarchy,n=!0}}(!n||"[calculated members].[_0]"===i.toLowerCase()&&0===this.calculatedFieldSettings.length)&&(this.savedFieldListData.splice(t,1),t--,this.savedFieldList[i]&&delete this.savedFieldList[i])}t++}this.fieldList=this.savedFieldList,this.fieldListData=this.savedFieldListData},e.prototype.updateFieldlistData=function(e,t){for(var i=0,a=this.fieldListData;i<a.length;i++){var r=a[i];if(r.id===e){r.isSelected=!!t;break}}},e.prototype.getFormattedFields=function(e){this.formatFields={};for(var t=e.length;t--;)this.formatFields[e[t].name]=e[t]},e.prototype.getFieldList=function(e){var t={catalog:e.catalog,cube:e.cube,url:e.url,LCID:e.localeIdentifier.toString(),request:"MDSCHEMA_HIERARCHIES"};this.getTreeData(t,this.getFieldListItems.bind(this),{dataSourceSettings:e,action:"loadFieldElements"})},e.prototype.getTreeData=function(e,t,i){var a=this.getConnectionInfo(e.url,e.LCID),r='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>'+e.request+"</RequestType><Restrictions><RestrictionList><CATALOG_NAME>"+e.catalog+"</CATALOG_NAME><CUBE_NAME>"+e.cube+"</CUBE_NAME></RestrictionList></Restrictions><Properties><PropertyList><Catalog>"+e.catalog+"</Catalog> <LocaleIdentifier>"+a.LCID+"</LocaleIdentifier></PropertyList></Properties></Discover></Body></Envelope>";this.doAjaxPost("POST",a.url,r,t,i)},e.prototype.getAxisFields=function(){this.rows=this.dataSourceSettings.rows?this.dataSourceSettings.rows:[],this.columns=this.dataSourceSettings.columns?this.dataSourceSettings.columns:[],this.filters=this.dataSourceSettings.filters?this.dataSourceSettings.filters:[],this.values=this.dataSourceSettings.values?this.dataSourceSettings.values:[];for(var e=t.extend([],this.rows,null,!0),i=(e=e.concat(this.columns,this.values,this.filters)).length;i--;)this.dataFields[e[i].name]=e[i],"[measures]"===e[i].name.toLowerCase()?this.isMeasureAvail=!0:this.selectedItems.push(e[i].name);if(this.mappingFields={},this.dataSourceSettings.fieldMapping)for(var a=0,r=this.dataSourceSettings.fieldMapping;a<r.length;a++){var n=r[a];this.mappingFields[n.name]=n}if(!this.isMeasureAvail&&this.values.length>0){var o={name:"[Measures]",caption:"Measures",showRemoveIcon:!0,allowDragAndDrop:!0};"row"===this.valueAxis?this.rows.push(o):this.columns.push(o),this.isMeasureAvail=!0}},e.prototype.getAggregateType=function(e,t){var i;switch(t){case"1":i="Sum";break;case"2":i="Count";break;case"3":i="Min";break;case"4":i="Max";break;case"5":i="Avg";break;case"8":i="DistinctCount";break;case"127":i="CalculatedField";break;default:i=void 0}return i||void 0},e.prototype.getUniqueName=function(e){for(var t=e,i=0,a=this.calculatedFieldSettings;i<a.length;i++){var r=a[i];if(e===(r.formula.toLowerCase().indexOf("measure")>-1?"[Measures].":r.hierarchyUniqueName+".")+"["+r.name+"]"){t=r.name;break}}return t},e.prototype.updateFilterItems=function(e){var i=t.extend([],this.rows,null,!0);i=i.concat(this.columns);for(var a=0,r=e;a<r.length;a++){var n=r[a];if("Include"===n.type&&this.allowMemberFilter){var o=this.fieldList[n.name].members,s=o&&Object.keys(o).length>0;this.fieldList[n.name].actualFilter=n.items.slice();var l=t.extend([],n.items,null,!0);if(s)for(var d=0;d<l.length;){for(var h=[],p=0,u=h=this.getParentNode(l[d],o,h);p<u.length;p++){var c=u[p],m=g.inArray(c,n.items);-1!==m&&n.items.splice(m,1)}d++}for(var f=[],v=0,S=n.items;v<S.length;v++){var y=S[v];f.push(y),s?this.fieldList[n.name].filter.push(o[y].caption):this.fieldList[n.name].filter.push(y)}this.filterMembers[n.name]=f,this.fieldList[n.name].isExcelFilter=!1}else if((this.allowValueFilter||this.allowLabelFilter)&&-1!==["Date","Label","Number","Value"].indexOf(n.type))for(var b=0,C=i;b<C.length;b++){if(C[b].name===n.name){var x=this.filterMembers[n.name];x&&"object"==typeof x[0]&&x[0].type===n.type?x[x.length]=n:this.filterMembers[n.name]=[n],this.fieldList[n.name].isExcelFilter=!0;break}}}},e.prototype.getParentNode=function(e,t,i){if(t[e].parent&&e!==t[e].parent){var a=t[e].parent;i.push(a),this.getParentNode(a,t,i)}return i},e.prototype.updateDrilledItems=function(e){var i=[],a=t.extend([],this.rows,null,!0);a=a.concat(this.columns);for(var r=0,n=e;r<n.length;r++)for(var o=n[r],s=0,l=a;s<l.length;s++){var d=l[s];if(o.name===d.name){i.push(o);break}}return i},e.prototype.getDrillThroughData=function(e,t){for(var i,a=this.tupColumnInfo[e.colOrdinal]&&this.tupColumnInfo[e.colOrdinal].uNameCollection&&""!==this.tupColumnInfo[e.colOrdinal].uNameCollection?this.tupColumnInfo[e.colOrdinal].uNameCollection.split("::[").map(function(e){return"["===e[0]?e:"["+e}):[],r=this.tupRowInfo[e.rowOrdinal]&&this.tupRowInfo[e.rowOrdinal].uNameCollection&&""!==this.tupRowInfo[e.rowOrdinal].uNameCollection?this.tupRowInfo[e.rowOrdinal].uNameCollection.split("::[").map(function(e){return"["===e[0]?e:"["+e}):[],n=[],o="",s=0;s<this.filters.length;s++)if(i=this.filterMembers[this.filters[s].name]){for(var l=0;l<i.length;l++)o+=i[l],o=l<i.length-1?o+",":o+"";n[s]=o,o=""}for(s=0;s<n.length;s++)o=""===o?"{"+n[s]+"}":o+",{"+n[s]+"}";var d="",h="";for(s=0;s<a.length;s++)d=(d.length>0?d+",":"")+(a[s].split("~~").length>1?a[s].split("~~")[a[s].split("~~").length-1]:a[s]);for(s=0;s<r.length;s++)h=(h.length>0?h+",":"")+(r[s].split("~~").length>1?r[s].split("~~")[r[s].split("~~").length-1]:r[s]);var p="DRILLTHROUGH MAXROWS "+t+" Select("+(d.length>0?d:"")+(d.length>0&&h.length>0?",":"")+(h.length>0?h:"")+") on 0 from "+(""===o?"["+this.dataSourceSettings.cube+"]":"(SELECT ("+o+") ON COLUMNS FROM ["+this.dataSourceSettings.cube+"])");p=p.replace(/&/g,"&amp;");var u=this.getSoapMsg(this.dataSourceSettings,p),c=this.getConnectionInfo(this.dataSourceSettings.url,this.dataSourceSettings.localeIdentifier);this.doAjaxPost("POST",c.url,u,this.drillThroughSuccess.bind(this),{dataSourceSettings:this.dataSourceSettings,action:"drillThrough"})},e.prototype.drillThroughSuccess=function(e){var t=[].slice.call(e.querySelectorAll("row")),i="";if(t.length>0){for(var a=[],r=0;r<t.length;){for(var n=[].slice.call(t[r].children),o=0;o<n.length;)a.push('"'+n[o].tagName+'":"'+n[o].textContent+'"'),o++;r++}for(var s=a[0],l=0;l<a.length;)Object.keys(JSON.parse("[{"+a[l]+"}]")[0])[0]!==Object.keys(JSON.parse("[{"+s+"}]")[0])[0]?(i+=","+a[l],l++):(i+=""===i?"[{"+a[l]:"}, {"+a[l],l++);i+="}]"}else{var d=[].slice.call(e.querySelectorAll("faultstring"));for(r=0;r<d.length;)i+=d[r].textContent,r++}this.gridJSON=i},e.prototype.getFilterMembers=function(e,t,i,a,r){var n,o=this.fieldList[t].levels,s=this.fieldList[t].levelCount;return n=r?"Descendants({"+o[s].id+"}, "+o[i-1].id+", "+(i-s==1?"SELF)":"SELF_AND_BEFORE)"):t+", Descendants({"+o[0].id+"}, "+o[i-1].id+", SELF_AND_BEFORE)",this.fieldList[t].levelCount=i,a||this.getMembers(e,t,!1,n,r),n},e.prototype.getMembers=function(e,t,i,a,r){var n,o="DIMENSION PROPERTIES PARENT_UNIQUE_NAME, HIERARCHY_UNIQUE_NAME, CHILDREN_CARDINALITY, MEMBER_TYPE, MEMBER_VALUE",s=this.fieldList[t].hasAllMember,l=(s?t:t+".LEVELS(0)").replace(/\&/g,"&amp;");n=i?"SELECT ({"+l+".ALLMEMBERS})"+o+" ON 0 FROM ["+e.cube+"]":"SELECT ({"+(a||(s?l+", "+l+".CHILDREN":l+".ALLMEMBERS"))+"})"+o+" ON 0 FROM ["+e.cube+"]";var d=this.getSoapMsg(e,n),h=this.getConnectionInfo(e.url,e.localeIdentifier);r||(this.fieldList[t].filterMembers=[],this.fieldList[t].childMembers=[],this.fieldList[t].searchMembers=[],this.fieldList[t].members={},this.fieldList[t].currrentMembers={}),this.doAjaxPost("POST",h.url,d,this.generateMembers.bind(this),{dataSourceSettings:e,fieldName:t,loadLevelMembers:r,action:"fetchMembers"})},e.prototype.getChildMembers=function(e,t,i){var a="SELECT ({"+t.replace(/\&/g,"&amp;")+".CHILDREN})DIMENSION PROPERTIES PARENT_UNIQUE_NAME, HIERARCHY_UNIQUE_NAME, CHILDREN_CARDINALITY, MEMBER_TYPE, MEMBER_VALUE ON 0 FROM ["+e.cube+"]",r=this.getSoapMsg(e,a),n=this.getConnectionInfo(e.url,e.localeIdentifier);this.doAjaxPost("POST",n.url,r,this.generateMembers.bind(this),{dataSourceSettings:e,fieldName:i,action:"fetchChildMembers"})},e.prototype.getCalcChildMembers=function(e,t){this.calcChildMembers=[];var i="SELECT ({"+t.replace(/\&/g,"&amp;")+".MEMBERS})DIMENSION PROPERTIES PARENT_UNIQUE_NAME, HIERARCHY_UNIQUE_NAME, CHILDREN_CARDINALITY, MEMBER_TYPE, MEMBER_VALUE ON 0 FROM ["+e.cube+"]",a=this.getConnectionInfo(e.url,e.localeIdentifier),r=this.getSoapMsg(e,i);this.doAjaxPost("POST",a.url,r,this.generateMembers.bind(this),{dataSourceSettings:e,action:"fetchCalcChildMembers"})},e.prototype.getSearchMembers=function(e,t,i,a,r,n){if(this.fieldList[t].searchMembers=[],this.fieldList[t].currrentMembers={},""!==i){var o=t.replace(/\&/g,"&amp;"),s="WITH SET [SearchMembersSet] AS &#39;FILTER("+(r?o+".ALLMEMBERS, ":"{"+(n>1?this.getFilterMembers(e,t,n,!0):o+", "+o+".CHILDREN")+"},")+"(INSTR(1, "+o+'.CurrentMember.member_caption, "'+i+'") > 0))&#39;SET [SearchParentsSet] AS &#39;GENERATE([SearchMembersSet], ASCENDANTS([SearchMembersSet].Current))&#39;SET [SearchSet] AS &#39;HIERARCHIZE(DISTINCT({[SearchMembersSet], [SearchParentsSet]}))&#39;SELECT SUBSET([SearchSet], 0, '+a+")DIMENSION PROPERTIES PARENT_UNIQUE_NAME, HIERARCHY_UNIQUE_NAME, CHILDREN_CARDINALITY, MEMBER_TYPE, MEMBER_VALUE ON 0 FROM ["+e.cube+"]",l=this.getSoapMsg(e,s),d=this.getConnectionInfo(e.url,e.localeIdentifier);this.doAjaxPost("POST",d.url,l,this.generateMembers.bind(this),{dataSourceSettings:e,fieldName:t,action:"fetchSearchMembers"})}},e.prototype.generateMembers=function(e,t,i){for(var a,r=[].slice.call(e.querySelectorAll('Axis[name="Axis0"] Tuple')),n=i.fieldName,o={},s=0,l=r;s<l.length;s++){var d=l[s],h=d.querySelector("Member"),p=h.querySelector("MEMBER_TYPE").textContent,u=h.querySelector("UName").textContent,c=h.querySelector("Caption").textContent,g=h.querySelector("PARENT_UNIQUE_NAME")?h.querySelector("PARENT_UNIQUE_NAME").textContent:"",m={"data-fieldName":n,"data-memberId":u};if(""===g&&"1"===p)o={hasChildren:!!d.querySelector("CHILDREN_CARDINALITY")&&"0"!==d.querySelector("CHILDREN_CARDINALITY").textContent,isSelected:!1,id:u,tag:u,name:c,caption:c,htmlAttributes:m},"fetchMembers"===i.action||"fetchChildMembers"===i.action?(this.fieldList[n].members[u]={name:u,caption:c,parent:void 0,isNodeExpand:!1,isSelected:!1},this.fieldList[n].filterMembers.push(o),this.fieldList[n].childMembers.push(o)):"fetchSearchMembers"===i.action?(this.fieldList[n].currrentMembers[u]={name:u,caption:c,parent:void 0,isNodeExpand:!1,isSelected:!1},this.fieldList[n].searchMembers.push(o),o.expanded=!0):this.calcChildMembers.push(o);else if(""!==g&&"1"===p)if(g===a&&"1"===p)o={hasChildren:!!d.querySelector("CHILDREN_CARDINALITY")&&"0"!==d.querySelector("CHILDREN_CARDINALITY").textContent,id:u,name:c,isSelected:!1,caption:c,htmlAttributes:m,tag:u},"fetchMembers"===i.action||"fetchChildMembers"===i.action?(this.fieldList[n].filterMembers.push(o),this.fieldList[n].childMembers.push(o),this.fieldList[n].members[u]={name:u,caption:c,parent:void 0,isNodeExpand:!1,isSelected:!1}):"fetchSearchMembers"===i.action?(o.expanded=!0,this.fieldList[n].searchMembers.push(o),this.fieldList[n].currrentMembers[u]={name:u,caption:c,parent:void 0,isNodeExpand:!1,isSelected:!1}):this.calcChildMembers.push(o);else{if("fetchMembers"===i.action&&this.fieldList[n].members[u])continue;var f=!!i.loadLevelMembers&&this.fieldList[n].members[g].isSelected;o={hasChildren:!!d.querySelector("CHILDREN_CARDINALITY")&&"0"!==d.querySelector("CHILDREN_CARDINALITY").textContent,htmlAttributes:m,isSelected:!1,id:u,pid:g,name:c,caption:c,tag:u},"fetchMembers"===i.action||"fetchChildMembers"===i.action?(this.fieldList[n].isHierarchy=!1,this.fieldList[n].filterMembers.push(o),this.fieldList[n].childMembers.push(o),this.fieldList[n].members[u]={name:u,caption:c,parent:g,isNodeExpand:!1,isSelected:f}):"fetchSearchMembers"===i.action?(this.fieldList[n].searchMembers.push(o),o.expanded=!0,this.fieldList[n].currrentMembers[u]={name:u,caption:c,parent:g,isNodeExpand:!1,isSelected:!1}):this.calcChildMembers.push(o)}else"2"===p&&(a=u)}},e.prototype.getFieldListItems=function(e,t,i){for(var a={},r=[],n=0,o=[].slice.call(e.querySelectorAll("row"));n<o.length;n++){var s=o[n],l=[].slice.call(s.querySelectorAll("ALL_MEMBER")).length>0,d=s.querySelector("DIMENSION_UNIQUE_NAME").textContent,h=s.querySelector("HIERARCHY_UNIQUE_NAME").textContent,p=d===h&&"[measures]"!==d.toLowerCase()&&"[measures]"!==h.toLowerCase();r.push({pid:this.isMondrian||p?d+"~#^Dim":d,id:h,name:s.querySelector("HIERARCHY_CAPTION").textContent,caption:s.querySelector("HIERARCHY_CAPTION").textContent,tag:h,hasAllMember:l,allMember:l?s.querySelectorAll("ALL_MEMBER")[0].textContent:void 0,type:"string"})}a={hierarchy:r,hierarchySuccess:e,measures:[]},this.fieldListObj=a;var u={catalog:i.dataSourceSettings.catalog,cube:i.dataSourceSettings.cube,url:i.dataSourceSettings.url,LCID:i.dataSourceSettings.localeIdentifier.toString(),request:"MDSCHEMA_DIMENSIONS"};this.getTreeData(u,this.loadDimensionElements.bind(this),i)},e.prototype.loadCalculatedMemberElements=function(e){if(e.length>0){var t=this.fieldListData,i={hasChildren:!0,isSelected:!1,id:"[Calculated Members].[_0]",name:"[Calculated Members].[_0]",caption:"Calculated Members",spriteCssClass:"e-calcMemberGroupCDB "+Ot,tag:"[Calculated Members].[_0]",type:"string"};t.length>0&&"[measures]"===t[0].id.toLowerCase()&&t.splice(0,0,i);for(var a=0,r=e;a<r.length;a++){var n=r[a];if(!this.fieldList[n.name]){var o=n.formula,s=(o.toLowerCase().indexOf("measure")>-1?"[Measures].":n.hierarchyUniqueName+".")+"["+n.name+"]",l=this.dataFields[n.name]&&this.dataFields[n.name].caption?this.dataFields[n.name].caption:this.mappingFields[n.name]&&this.mappingFields[n.name].caption?this.mappingFields[n.name].caption:n.name,d=n.formatString,h={hasChildren:!1,isSelected:!1,id:n.name,pid:"[Calculated Members].[_0]",name:n.name,caption:l,spriteCssClass:"e-calc-member "+(o.toLowerCase().indexOf("measure")>-1?"e-calc-measure-icon":"e-calc-dimension-icon")+" "+Ot,tag:s,formula:o,formatString:d,aggregateType:void 0,type:"CalculatedField",filter:[],dateMember:[],sort:"Ascending",actualFilter:[],filterMembers:[],childMembers:[],searchMembers:[],members:{},currrentMembers:{},isHierarchy:!0,isExcelFilter:!1,isCalculatedField:!0,allowDragAndDrop:this.dataFields[n.name]?this.dataFields[n.name].allowDragAndDrop:!this.mappingFields[n.name]||this.mappingFields[n.name].allowDragAndDrop,showFilterIcon:this.dataFields[n.name]?this.dataFields[n.name].showFilterIcon:!this.mappingFields[n.name]||this.mappingFields[n.name].showFilterIcon,showSortIcon:this.dataFields[n.name]?this.dataFields[n.name].showSortIcon:!this.mappingFields[n.name]||this.mappingFields[n.name].showSortIcon,showEditIcon:this.dataFields[n.name]?this.dataFields[n.name].showEditIcon:!this.mappingFields[n.name]||this.mappingFields[n.name].showEditIcon,showRemoveIcon:this.dataFields[n.name]?this.dataFields[n.name].showRemoveIcon:!this.mappingFields[n.name]||this.mappingFields[n.name].showRemoveIcon,showValueTypeIcon:this.dataFields[n.name]?this.dataFields[n.name].showValueTypeIcon:!this.mappingFields[n.name]||this.mappingFields[n.name].showValueTypeIcon,showSubTotals:this.dataFields[n.name]?this.dataFields[n.name].showSubTotals:!this.mappingFields[n.name]||this.mappingFields[n.name].showSubTotals,fieldType:o.toLowerCase().indexOf("measure")>-1?"Measure":"Dimension",parentHierarchy:o.toLowerCase().indexOf("measure")>-1?void 0:n.hierarchyUniqueName};t.push(h),this.fieldList[h.id]=h}}}},e.prototype.loadDimensionElements=function(e,i,a){for(var r=[],n=[].slice.call(e.querySelectorAll("row")),o={},s=0,l=n;s<l.length;s++){var d=l[s],h=d.querySelector("DIMENSION_UNIQUE_NAME").textContent,p=d.querySelector("DEFAULT_HIERARCHY").textContent,u=d.querySelector("DIMENSION_CAPTION").textContent,c=h===p;h.toLowerCase().indexOf("[measure")>=0?o={hasChildren:!0,isSelected:!1,id:h,name:h,caption:u,spriteCssClass:"[measures]"===h.toLowerCase()?"e-measureGroupCDB-icon "+Ot:"e-dimensionCDB-icon "+Ot,tag:h,type:"string"}:t.isNullOrUndefined(n[0].querySelector("HIERARCHY_CAPTION"))&&r.push({hasChildren:!0,isSelected:!1,id:this.isMondrian||c?h+"~#^Dim":h,name:h,caption:u,spriteCssClass:"e-dimensionCDB-icon "+Ot,tag:h,defaultHierarchy:d.querySelector("DEFAULT_HIERARCHY").textContent,type:"string"})}r.splice(0,0,o),this.fieldListData=r;var g={catalog:a.dataSourceSettings.catalog,cube:a.dataSourceSettings.cube,url:a.dataSourceSettings.url,LCID:a.dataSourceSettings.localeIdentifier.toString(),request:"MDSCHEMA_SETS"};this.getTreeData(g,this.loadNamedSetElements.bind(this),a)},e.prototype.loadNamedSetElements=function(e,i,a){var r=t.extend([],this.rows,null,!0);r=r.concat(this.columns,this.filters);for(var n=this.fieldListData,o=[],s=0,l=r;s<l.length;s++){var d=l[s];o.push(d.name)}for(var h=[],p=0,u=[].slice.call(e.querySelectorAll("row"));p<u.length;p++){d=u[p];h.indexOf(d.querySelector("DIMENSIONS").textContent.split(".")[0])>=0||(n.push({hasChildren:!0,isSelected:!1,pid:d.querySelector("DIMENSIONS").textContent.split(".")[0],id:d.querySelector("SET_DISPLAY_FOLDER").textContent+"_"+d.querySelector("DIMENSIONS").textContent.split(".")[0],name:d.querySelector("SET_DISPLAY_FOLDER").textContent,spriteCssClass:"e-folderCDB-icon e-icons namedSets",caption:d.querySelector("SET_DISPLAY_FOLDER").textContent,type:"string"}),h.push(d.querySelector("DIMENSIONS").textContent.split(".")[0]));var c="["+d.querySelector("SET_NAME").textContent.trim()+"]",g={hasChildren:!0,isNamedSets:!0,isSelected:o.indexOf("["+d.querySelector("SET_NAME").textContent+"]")>=0,pid:d.querySelector("SET_DISPLAY_FOLDER").textContent+"_"+d.querySelector("DIMENSIONS").textContent.split(".")[0],id:c,name:d.querySelector("SET_CAPTION").textContent,caption:this.dataFields[c]&&this.dataFields[c].caption?this.dataFields[c].caption:this.mappingFields[c]&&this.mappingFields[c].caption?this.mappingFields[c].caption:d.querySelector("SET_CAPTION").textContent,spriteCssClass:"e-namedSetCDB-icon "+Ot,tag:d.querySelector("EXPRESSION").textContent,type:"string",filter:[],dateMember:[],actualFilter:[],filterMembers:[],childMembers:[],searchMembers:[],members:{},currrentMembers:{},isHierarchy:!0,isExcelFilter:!1,allowDragAndDrop:this.dataFields[c]?this.dataFields[c].allowDragAndDrop:!this.mappingFields[c]||this.mappingFields[c].allowDragAndDrop,showFilterIcon:this.dataFields[c]?this.dataFields[c].showFilterIcon:!this.mappingFields[c]||this.mappingFields[c].showFilterIcon,showSortIcon:this.dataFields[c]?this.dataFields[c].showSortIcon:!this.mappingFields[c]||this.mappingFields[c].showSortIcon,showEditIcon:this.dataFields[c]?this.dataFields[c].showEditIcon:!this.mappingFields[c]||this.mappingFields[c].showEditIcon,showRemoveIcon:this.dataFields[c]?this.dataFields[c].showRemoveIcon:!this.mappingFields[c]||this.mappingFields[c].showRemoveIcon,showValueTypeIcon:this.dataFields[c]?this.dataFields[c].showValueTypeIcon:!this.mappingFields[c]||this.mappingFields[c].showValueTypeIcon,showSubTotals:this.dataFields[c]?this.dataFields[c].showSubTotals:!this.mappingFields[c]||this.mappingFields[c].showSubTotals};n.push(g),this.fieldList[c]=g}a.hierarchy=this.fieldListData,a.hierarchySuccess=this.fieldListObj.hierarchySuccess,this.loadHierarchyElements(a)},e.prototype.loadHierarchyElements=function(e){for(var i=e.hierarchySuccess,a=e.hierarchy,r=t.extend([],this.rows,null,!0),n=[],o=0,s=r=r.concat(this.columns,this.filters);o<s.length;o++){var l=s[o];n.push(l.name)}for(var d=0,h=[].slice.call(i.querySelectorAll("row"));d<h.length;d++){var p=(l=h[d]).querySelector("DIMENSION_UNIQUE_NAME").textContent,u=l.querySelector("HIERARCHY_UNIQUE_NAME").textContent,c=[].slice.call(l.querySelectorAll("ALL_MEMBER")).length>0,g=void 0;if(c){var m=l.querySelectorAll("ALL_MEMBER")[0].textContent.replace(/[\[\]\&']+/g,"").split(".");g=m[m.length-1].trim()}else g=void 0;for(var f=l.querySelector("HIERARCHY_DISPLAY_FOLDER")?l.querySelector("HIERARCHY_DISPLAY_FOLDER").textContent:"",v=[],S=0,y=a;S<y.length;S++){(D=y[S]).tag===p&&v.push(D)}if(v.length>0){var b=p===u&&"[measures]"!==p.toLowerCase()&&"[measures]"!==u.toLowerCase();if("[measures]"!==p.toLowerCase()&&"[measures]"!==u.toLowerCase()){var C=p+(this.isMondrian||b?"~#^Dim":"");if(""!==f){for(var x=p+(this.isMondrian||b?"~#^Dim":"")+"_"+f,w=[],T=0,M=a;T<M.length;T++){var D;(D=M[T]).tag===x&&D.pid===C&&w.push(D)}if(0===w.length){var O={hasChildren:!0,isSelected:!1,pid:p+(this.isMondrian||b?"~#^Dim":""),id:x,name:f,spriteCssClass:"e-folderCDB-icon "+Ot,tag:x,caption:f,type:"string"};a.push(O)}C=x}var N={hasChildren:!l.querySelector("HIERARCHY_ORIGIN")||"2"!==l.querySelector("HIERARCHY_ORIGIN").textContent&&"6"!==l.querySelector("HIERARCHY_ORIGIN").textContent,isSelected:n.indexOf(u)>=0,pid:C,id:u,name:l.querySelector("HIERARCHY_CAPTION").textContent,spriteCssClass:(l.querySelector("HIERARCHY_ORIGIN")?"2"!==l.querySelector("HIERARCHY_ORIGIN").textContent&&"6"!==l.querySelector("HIERARCHY_ORIGIN").textContent?"e-hierarchyCDB-icon":"e-attributeCDB-icon":"e-hierarchyCDB-icon")+" "+Ot,hasAllMember:c,allMember:g,tag:u,caption:this.dataFields[u]&&this.dataFields[u].caption?this.dataFields[u].caption:this.mappingFields[u]&&this.mappingFields[u].caption?this.mappingFields[u].caption:l.querySelector("HIERARCHY_CAPTION").textContent,type:"string",filter:[],dateMember:[],sort:this.enableSort?this.sortObject[u]?this.sortObject[u]:"Ascending":"None",actualFilter:[],filterMembers:[],childMembers:[],searchMembers:[],members:{},currrentMembers:{},levels:[],levelCount:1,isHierarchy:!!l.querySelector("HIERARCHY_ORIGIN")&&("2"===l.querySelector("HIERARCHY_ORIGIN").textContent||"6"===l.querySelector("HIERARCHY_ORIGIN").textContent),isExcelFilter:!1,allowDragAndDrop:this.dataFields[u]?this.dataFields[u].allowDragAndDrop:!this.mappingFields[u]||this.mappingFields[u].allowDragAndDrop,showFilterIcon:this.dataFields[u]?this.dataFields[u].showFilterIcon:!this.mappingFields[u]||this.mappingFields[u].showFilterIcon,showSortIcon:this.dataFields[u]?this.dataFields[u].showSortIcon:!this.mappingFields[u]||this.mappingFields[u].showSortIcon,showEditIcon:this.dataFields[u]?this.dataFields[u].showEditIcon:!this.mappingFields[u]||this.mappingFields[u].showEditIcon,showRemoveIcon:this.dataFields[u]?this.dataFields[u].showRemoveIcon:!this.mappingFields[u]||this.mappingFields[u].showRemoveIcon,showValueTypeIcon:this.dataFields[u]?this.dataFields[u].showValueTypeIcon:!this.mappingFields[u]||this.mappingFields[u].showValueTypeIcon,showSubTotals:this.dataFields[u]?this.dataFields[u].showSubTotals:!this.mappingFields[u]||this.mappingFields[u].showSubTotals};a.push(N),this.fieldList[u]=N}}}var E={catalog:e.dataSourceSettings.catalog,cube:e.dataSourceSettings.cube,url:e.dataSourceSettings.url,LCID:e.dataSourceSettings.localeIdentifier.toString(),request:"MDSCHEMA_LEVELS"};this.getTreeData(E,this.loadLevelElements.bind(this),e)},e.prototype.loadLevelElements=function(e,t,i){var a=[],r=this.fieldListData;a=[];for(var n=0,o=[].slice.call(e.querySelectorAll("row"));n<o.length;n++){var s=o[n];if(1!==parseInt(s.querySelector("LEVEL_TYPE").textContent,10)&&"[measures]"!==s.querySelector("HIERARCHY_UNIQUE_NAME").textContent.toLowerCase()){var l=s.querySelector("HIERARCHY_UNIQUE_NAME").textContent,d=s.querySelector("LEVEL_UNIQUE_NAME").textContent,h=s.querySelector("LEVEL_CAPTION").textContent,p={hasChildren:!1,isChecked:!1,isSelected:this.fieldList[l].isSelected,pid:l,id:d,name:h,tag:d,spriteCssClass:"e-level-members e-hierarchy-level-"+parseInt(s.querySelector("LEVEL_NUMBER").textContent,10)+"-icon "+Ot,caption:h,type:"string"};a.push(p),this.fieldList[l]&&this.fieldList[l].spriteCssClass&&-1===this.fieldList[l].spriteCssClass.indexOf("e-attributeCDB-icon")?(this.fieldList[l].levels.push(p),this.fieldList[l].isHierarchy=!1):this.fieldList[l].isHierarchy=!0}}this.fieldListData=r=r.concat(a);var u={catalog:i.dataSourceSettings.catalog,cube:i.dataSourceSettings.cube,url:i.dataSourceSettings.url,LCID:i.dataSourceSettings.localeIdentifier.toString(),request:"MDSCHEMA_MEASURES"};this.getTreeData(u,this.loadMeasureElements.bind(this),i)},e.prototype.loadMeasureElements=function(e,i,a){for(var r,n=this.fieldListData,o=[],s=[],l=0,d=t.extend([],this.values,null,!0);l<d.length;l++){var h=d[l];s.push(h.name)}if("en-US"!==this.locale){var p={catalog:a.dataSourceSettings.catalog,cube:a.dataSourceSettings.cube,url:a.dataSourceSettings.url,LCID:a.dataSourceSettings.localeIdentifier.toString(),request:"MDSCHEMA_MEASUREGROUPS"};this.getTreeData(p,this.loadMeasureGroups.bind(this),a)}for(var u=0,c=[].slice.call(e.querySelectorAll("row"));u<c.length;u++){h=c[u];var g=t.isNullOrUndefined(h.querySelector("MEASUREGROUP_NAME"))?"":h.querySelector("MEASUREGROUP_NAME").textContent,m=h.querySelector("MEASURE_UNIQUE_NAME").textContent,f=h.querySelector("DEFAULT_FORMAT_STRING")?h.querySelector("DEFAULT_FORMAT_STRING").textContent:"#,#",v=h.querySelector("MEASURE_AGGREGATOR")?h.querySelector("MEASURE_AGGREGATOR").textContent:"1";if(!(o.indexOf(g)>=0)){if("en-US"!==this.locale){for(var S=[],y=0,b=this.fieldListObj.measuresGroups;y<b.length;y++){var C=b[y];C.querySelector("MEASUREGROUP_NAME").textContent===g&&S.push(C)}r=S.length>0?S[0].querySelector("MEASUREGROUP_CAPTION").textContent:g}else r=g;""!==g&&(n.push({hasChildren:!0,isChecked:!1,isSelected:!1,pid:"[Measures]",id:g,name:r,spriteCssClass:"e-measureCDB e-folderCDB-icon "+Ot,tag:g,caption:r,aggregateType:this.getAggregateType(g,v),type:"string"}),o.push(g))}var x={hasChildren:!1,isSelected:s.indexOf(m)>=0,pid:""===g?"[Measures]":g,id:m,name:h.querySelector("MEASURE_CAPTION").textContent,spriteCssClass:"e-measure-icon "+Ot,tag:m,caption:this.dataFields[m]&&this.dataFields[m].caption?this.dataFields[m].caption:this.mappingFields[m]&&this.mappingFields[m].caption?this.mappingFields[m].caption:h.querySelector("MEASURE_CAPTION").textContent,aggregateType:this.getAggregateType(m,v),type:"number",filter:[],actualFilter:[],filterMembers:[],childMembers:[],searchMembers:[],members:{},currrentMembers:{},formatString:f,allowDragAndDrop:this.dataFields[m]?this.dataFields[m].allowDragAndDrop:!this.mappingFields[m]||this.mappingFields[m].allowDragAndDrop,showFilterIcon:this.dataFields[m]?this.dataFields[m].showFilterIcon:!this.mappingFields[m]||this.mappingFields[m].showFilterIcon,showSortIcon:this.dataFields[m]?this.dataFields[m].showSortIcon:!this.mappingFields[m]||this.mappingFields[m].showSortIcon,showEditIcon:this.dataFields[m]?this.dataFields[m].showEditIcon:!this.mappingFields[m]||this.mappingFields[m].showEditIcon,showRemoveIcon:this.dataFields[m]?this.dataFields[m].showRemoveIcon:!this.mappingFields[m]||this.mappingFields[m].showRemoveIcon,showValueTypeIcon:this.dataFields[m]?this.dataFields[m].showValueTypeIcon:!this.mappingFields[m]||this.mappingFields[m].showValueTypeIcon,showSubTotals:this.dataFields[m]?this.dataFields[m].showSubTotals:!this.mappingFields[m]||this.mappingFields[m].showSubTotals};n.push(x),this.fieldList[m]=x,s.indexOf(m)>=0&&s.splice(s.indexOf(m),1)}this.measureReportItems=s},e.prototype.loadMeasureGroups=function(e,i,a){t.isNullOrUndefined(this.fieldListObj)&&(this.fieldListObj={}),this.fieldListObj.measuresGroups=[].slice.call(e.querySelectorAll("row"))},e.prototype.doAjaxPost=function(e,i,a,r,n){new t.Ajax({mode:!1,contentType:"text/xml",url:i,data:a,dataType:"xml",type:e,beforeSend:this.beforeSend.bind(this),onSuccess:function(e,t){var i=(new DOMParser).parseFromString(e,"text/xml");r(i,t,n)},onFailure:function(e){return e}}).send()},e.prototype.beforeSend=function(e){this.dataSourceSettings.authentication.userName&&this.dataSourceSettings.authentication.password&&e.httpRequest.setRequestHeader("Authorization","Basic "+btoa(this.dataSourceSettings.authentication.userName+":"+this.dataSourceSettings.authentication.password))},e.prototype.getSoapMsg=function(e,t){var i=this.getConnectionInfo(e.url,e.localeIdentifier);return this.isMondrian?'<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"><SOAP-ENV:Body><Execute xmlns="urn:schemas-microsoft-com:xml-analysis"><Command><Statement><![CDATA['+t+"]]></Statement></Command><Properties><PropertyList><DataSourceInfo>"+""+"</DataSourceInfo><Catalog>"+e.catalog+"</Catalog><AxisFormat>TupleFormat</AxisFormat><Content>Data</Content><Format>Multidimensional</Format></PropertyList></Properties></Execute></SOAP-ENV:Body></SOAP-ENV:Envelope>":'<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"> <Header></Header> <Body> <Execute xmlns="urn:schemas-microsoft-com:xml-analysis"> <Command> <Statement> '+t+" </Statement> </Command> <Properties> <PropertyList> <Catalog>"+e.catalog+"</Catalog> <LocaleIdentifier>"+i.LCID+"</LocaleIdentifier></PropertyList> </Properties> </Execute> </Body> </Envelope>"},e.prototype.getConnectionInfo=function(e,i){var a={url:"",LCID:t.isNullOrUndefined(i)?"1033":i.toString()};if(""!==e)for(var r=0,n=e.split(";");r<n.length;r++){var o=n[r];o.toLowerCase().indexOf("locale")<0&&0===a.url.length?a.url=o:o.toLowerCase().indexOf("locale")>=0&&(a.LCID=o.replace(/ /g,"").split("=")[1])}return a},e.prototype.getMDXQuery=function(e){return un.getCellSets(e,this,!0,void 0,!0),this.mdxQuery},e}(),gn=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function a(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),mn=function(e,t,i,a){var r,n=arguments.length,o=n<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},fn=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return gn(i,e),mn([t.Property(!0)],i.prototype,"showFilterIcon",void 0),mn([t.Property(!0)],i.prototype,"showSortIcon",void 0),mn([t.Property(!0)],i.prototype,"showRemoveIcon",void 0),mn([t.Property(!0)],i.prototype,"showValueTypeIcon",void 0),mn([t.Property("Both")],i.prototype,"displayMode",void 0),mn([t.Property(!0)],i.prototype,"allowDragAndDrop",void 0),mn([t.Property(!1)],i.prototype,"showFieldsPanel",void 0),i}(t.ChildProperty),vn=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return gn(i,e),mn([t.Property(!1)],i.prototype,"allowAdding",void 0),mn([t.Property(!1)],i.prototype,"allowEditing",void 0),mn([t.Property(!1)],i.prototype,"allowDeleting",void 0),mn([t.Property(!1)],i.prototype,"allowCommandColumns",void 0),mn([t.Property(!1)],i.prototype,"allowInlineEditing",void 0),mn([t.Property("Normal")],i.prototype,"mode",void 0),mn([t.Property(!0)],i.prototype,"allowEditOnDblClick",void 0),mn([t.Property(!0)],i.prototype,"showConfirmDialog",void 0),mn([t.Property(!1)],i.prototype,"showDeleteConfirmDialog",void 0),i}(t.ChildProperty),Sn=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return gn(i,e),mn([t.Property()],i.prototype,"measure",void 0),mn([t.Property()],i.prototype,"label",void 0),mn([t.Property("NotEquals")],i.prototype,"conditions",void 0),mn([t.Property()],i.prototype,"value1",void 0),mn([t.Property()],i.prototype,"value2",void 0),i}(t.ChildProperty),yn=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return gn(i,e),mn([t.Property(!1)],i.prototype,"showHyperlink",void 0),mn([t.Property(!1)],i.prototype,"showRowHeaderHyperlink",void 0),mn([t.Property(!1)],i.prototype,"showColumnHeaderHyperlink",void 0),mn([t.Property(!1)],i.prototype,"showValueCellHyperlink",void 0),mn([t.Property(!1)],i.prototype,"showSummaryCellHyperlink",void 0),mn([t.Collection([],Sn)],i.prototype,"conditionalSettings",void 0),mn([t.Property()],i.prototype,"headerText",void 0),mn([t.Property("")],i.prototype,"cssClass",void 0),i}(t.ChildProperty),bn=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return gn(i,e),mn([t.Property("Table")],i.prototype,"view",void 0),mn([t.Property("Table")],i.prototype,"primary",void 0),i}(t.ChildProperty),Cn=function(e){function n(i,a){var r=e.call(this,i,a)||this;return r.verticalScrollScale=1,r.horizontalScrollScale=1,r.scrollerBrowserLimit=8e6,r.lastSortInfo={},r.lastFilterInfo={},r.lastAggregationInfo={},r.lastCalcFieldInfo={},r.isScrolling=!1,r.isInitial=!0,r.shiftLockedPos=[],r.savedSelectedCellsPos=[],r.cellSelectionPos=[],r.isPopupClicked=!1,r.isMouseDown=!1,r.isMouseUp=!1,r.fieldsType={},r.remoteData=[],r.defaultItems={},r.isCellBoxMultiSelection=!1,r.gridHeaderCellInfo=[],r.gridCellCollection={},r.rowRangeSelection={enable:!1,startIndex:0,endIndex:0},r.isStaticRefresh=!1,r.resizeInfo={},r.scrollPosObject={vertical:0,horizontal:0,verticalSection:0,horizontalSection:0,top:0,left:0,scrollDirection:{direction:"",position:0}},r.pivotColumns=[],r.totColWidth=0,r.posCount=0,r.isModified=!1,r.isInitialRendering=!1,r.needsID=!0,r.pivotRefresh=t.Component.prototype.refresh,r.request=new XMLHttpRequest,r.isServerWaitingPopup=!1,r.actionObj={},r.destroyEngine=!1,r.pivotView=r,t.setValue("mergePersistData",r.mergePersistPivotData,r),r}return gn(n,e),n.prototype.requiredModules=function(){var e=[];return this.showGroupingBar&&e.push({args:[this],member:"groupingBar"}),this.allowConditionalFormatting&&e.push({args:[this],member:"conditionalFormatting"}),this.allowNumberFormatting&&e.push({args:[this],member:"numberFormatting"}),this.allowCalculatedField&&e.push({args:[this],member:"calculatedField"}),this.showToolbar&&(this.toolbar.length>0||this.toolbarTemplate)&&e.push({args:[this],member:"toolbar"}),this.showFieldList&&e.push({args:[this],member:"fieldList"}),this.allowExcelExport&&e.push({args:[this],member:"excelExport"}),this.allowPdfExport&&e.push({args:[this],member:"pdfExport"}),this.enableVirtualization&&e.push({args:[this],member:"virtualscroll"}),this.allowGrouping&&e.push({args:[this],member:"grouping"}),(this.allowDrillThrough||this.editSettings&&this.editSettings.allowEditing)&&e.push({args:[this],member:"drillThrough"}),"Table"!==this.displayOption.view&&e.push({args:[this],member:"pivotChart"}),e},n.prototype.preRender=function(){this.dataSourceSettings&&"SSAS"===this.dataSourceSettings.providerType?(this.dataType="olap",this.olapEngineModule=new cn):(this.dataType="pivot",this.engineModule=new f),this.isAdaptive=t.Browser.isDevice,t.Browser.isIE||"edge"===t.Browser.info.name?this.scrollerBrowserLimit=15e5:"chrome"===t.Browser.info.name&&(this.scrollerBrowserLimit=15e6),this.isTouchMode=!!t.closest(this.element,"e-bigger"),this.initProperties(),this.renderToolTip(),this.keyboardModule=new Tr(this),this.contextMenuModule=new Mr(this),this.globalize=new t.Internationalization(this.locale),(this.showFieldList||this.showGroupingBar||this.allowNumberFormatting||this.allowCalculatedField||this.toolbar||this.allowGrouping||this.gridSettings.contextMenuItems)&&(this.commonModule=new sr(this)),this.defaultLocale={grandTotal:"Grand Total",total:"Total",value:"Value",noValue:"No value",row:"Row",column:"Column",collapse:"Collapse",expand:"Expand",rowAxisPrompt:"Drop row here",columnAxisPrompt:"Drop column here",valueAxisPrompt:"Drop value here",filterAxisPrompt:"Drop filter here",filter:"Filter",filtered:"Filtered",sort:"Sort",filters:"Filters",rows:"Rows",columns:"Columns",values:"Values",close:"Close",cancel:"Cancel",delete:"Delete",CalculatedField:"Calculated Field",createCalculatedField:"Create Calculated Field",fieldName:"Enter the field name",error:"Error",invalidFormula:"Invalid formula.",dropText:'Example: ("Sum(Order_Count)" + "Sum(In_Stock)") * 250',dropTextMobile:"Add fields and edit formula here.",dropAction:"Calculated field cannot be place in any other region except value axis.",alert:"Alert",warning:"Warning",ok:"OK",search:"Search",drag:"Drag",remove:"Remove",allFields:"All Fields",formula:"Formula",addToRow:"Add to Row",addToColumn:"Add to Column",addToValue:"Add to Value",addToFilter:"Add to Filter",emptyData:"No records to display",fieldExist:"A field already exists in this name. Please enter a different name.",confirmText:"A calculation field already exists in this name. Do you want to replace it?",noMatches:"No matches",format:"Summaries values by",edit:"Edit",clear:"Clear",sortAscending:"Sort ascending order",sortDescending:"Sort descending order",sortNone:"Sort data order",clearCalculatedField:"Clear edited field info",editCalculatedField:"Edit calculated field",formulaField:"Drag and drop fields to formula",dragField:"Drag field to formula",clearFilter:"Clear",by:"by",all:"All",multipleItems:"Multiple items",member:"Member",label:"Label",date:"Date",enterValue:"Enter value",chooseDate:"Enter date",Before:"Before",BeforeOrEqualTo:"Before Or Equal To",After:"After",AfterOrEqualTo:"After Or Equal To",labelTextContent:"Show the items for which the label",dateTextContent:"Show the items for which the date",valueTextContent:"Show the items for which",Equals:"Equals",DoesNotEquals:"Does Not Equal",BeginWith:"Begins With",DoesNotBeginWith:"Does Not Begin With",EndsWith:"Ends With",DoesNotEndsWith:"Does Not End With",Contains:"Contains",DoesNotContains:"Does Not Contain",GreaterThan:"Greater Than",GreaterThanOrEqualTo:"Greater Than Or Equal To",LessThan:"Less Than",LessThanOrEqualTo:"Less Than Or Equal To",Between:"Between",NotBetween:"Not Between",And:"and",Sum:"Sum",Count:"Count",DistinctCount:"Distinct Count",Product:"Product",Avg:"Avg",Median:"Median",Min:"Min",SampleVar:"Sample Var",PopulationVar:"Population Var",RunningTotals:"Running Totals",Max:"Max",Index:"Index",SampleStDev:"Sample StDev",PopulationStDev:"Population StDev",PercentageOfRowTotal:"% of Row Total",PercentageOfParentTotal:"% of Parent Total",PercentageOfParentColumnTotal:"% of Parent Column Total",PercentageOfParentRowTotal:"% of Parent Row Total",DifferenceFrom:"Difference From",PercentageOfDifferenceFrom:"% of Difference From",PercentageOfGrandTotal:"% of Grand Total",PercentageOfColumnTotal:"% of Column Total",MoreOption:"More...",NotEquals:"Not Equals",AllValues:"All Values",conditionalFormating:"Conditional Formatting",apply:"Apply",condition:"Add Condition",formatLabel:"Format",valueFieldSettings:"Value field settings",baseField:"Base field",baseItem:"Base item",summarizeValuesBy:"Summarize values by",sourceName:"Field name :",sourceCaption:"Field caption",example:"e.g:",editorDataLimitMsg:" more items. Search to refine further.",details:"Details",manageRecords:"Manage Records",Years:"Years",Quarters:"Quarters",Months:"Months",Days:"Days",Hours:"Hours",Minutes:"Minutes",Seconds:"Seconds",save:"Save a report",new:"Create a new report",load:"Load",saveAs:"Save as current report",rename:"Rename a current report",deleteReport:"Delete a current report",export:"Export",subTotals:"Sub totals",grandTotals:"Grand totals",reportName:"Report Name :",pdf:"PDF",excel:"Excel",csv:"CSV",png:"PNG",jpeg:"JPEG",svg:"SVG",mdxQuery:"MDX Query",showSubTotals:"Show sub totals",doNotShowSubTotals:"Do not show sub totals",showSubTotalsRowsOnly:"Show sub totals rows only",showSubTotalsColumnsOnly:"Show sub totals columns only",showGrandTotals:"Show grand totals",doNotShowGrandTotals:"Do not show grand totals",showGrandTotalsRowsOnly:"Show grand totals rows only",showGrandTotalsColumnsOnly:"Show grand totals columns only",fieldList:"Show fieldlist",grid:"Show table",toolbarFormatting:"Conditional formatting",chart:"Chart",reportMsg:"Please enter vaild report name!!!",reportList:"Report list",removeConfirm:"Are you sure you want to delete this report?",emptyReport:"No reports found!!",bar:"Bar",pie:"Pie",funnel:"Funnel",doughnut:"Doughnut",pyramid:"Pyramid",stackingcolumn:"Stacked Column",stackingarea:"Stacked Area",stackingbar:"Stacked Bar",stepline:"Step Line",steparea:"Step Area",splinearea:"Spline Area",spline:"Spline",stackingcolumn100:"100% Stacked Column",stackingbar100:"100% Stacked Bar",stackingarea100:"100% Stacked Area",bubble:"Bubble",pareto:"Pareto",radar:"Radar",line:"Line",area:"Area",scatter:"Scatter",polar:"Polar",of:"of",emptyFormat:"No format found!!!",emptyInput:"Enter a value",newReportConfirm:"Do you want to save the changes to this report?",emptyReportName:"Enter a report name",qtr:"Qtr",null:"null",undefined:"undefined",groupOutOfRange:"Out of Range",fieldDropErrorAction:"The field you are moving cannot be placed in that area of the report",aggregate:"Aggregate",drillThrough:"Drill Through",ascending:"Ascending",descending:"Descending",number:"Number",currency:"Currency",percentage:"Percentage",formatType:"Format Type",customText:"Currency Symbol",symbolPosition:"Symbol Position",left:"Left",right:"Right",grouping:"Grouping",true:"True",false:"False",decimalPlaces:"Decimal Places",numberFormat:"Number Formatting",memberType:"Field Type",formatString:"Format",expressionField:"Expression",customFormat:"Enter custom format string",numberFormatString:"Example: C, P, 0000 %, ###0.##0#, etc.",selectedHierarchy:"Parent Hierarchy",olapDropText:"Example: [Measures].[Order Quantity] + ([Measures].[Order Quantity] * 0.10)",Percent:"Percent",Currency:"Currency",Custom:"Custom",Measure:"Measure",Dimension:"Dimension",Standard:"Standard",blank:"(Blank)",fieldTooltip:'Drag and drop fields to create an expression. And, if you want to edit the existing calculated fields! You can achieve it by simply selecting the field under "Calculated Members".',fieldTitle:"Field Name",QuarterYear:"Quarter Year",drillError:"Cannot show the raw items of calculated fields.",caption:"Field Caption",copy:"Copy",defaultReport:"Sample Report",customFormatString:"Custom Format",invalidFormat:"Invalid Format.",group:"Group",unGroup:"Ungroup",invalidSelection:"Cannot group that selection.",groupName:"Enter the caption to display in header",captionName:"Enter the caption for group field",selectedItems:"Selected items",groupFieldCaption:"Field caption",groupTitle:"Group name",startAt:"Starting at",endAt:"Ending at",groupBy:"Interval by",selectGroup:"Select groups",multipleAxes:"Multiple Axis",showLegend:"Show Legend",exit:"Exit",chartTypeSettings:"Chart Type Settings",ChartType:"Chart Type",yes:"Yes",no:"No",numberFormatMenu:"Number Formatting...",conditionalFormatingMenu:"Conditional Formatting...",removeCalculatedField:"Are you sure you want to delete this calculated field?",replaceConfirmBefore:"A report named ",replaceConfirmAfter:" already exists. Do you want to replace it?",invalidJSON:"Invalid JSON data",invalidCSV:"Invalid CSV data",stacked:"Stacked",single:"Single",multipleAxisMode:"Multiple Axis Mode"},this.localeObj=new t.L10n(this.getModuleName(),this.defaultLocale,this.locale),this.renderContextMenu(),this.isDragging=!1,this.addInternalEvents()},n.prototype.onBeforeTooltipOpen=function(e){e.element.classList.add("e-pivottooltipwrap")},n.prototype.renderToolTip=function(){this.showTooltip?(this.tooltipTemplate?this.tooltip=new a.Tooltip({target:"td.e-valuescontent",cssClass:"e-pivottooltiptemplate",showTipPointer:!1,position:"BottomRight",mouseTrail:!0,enableRtl:this.enableRtl,locale:this.locale,beforeRender:this.setToolTip.bind(this),beforeOpen:this.onBeforeTooltipOpen}):this.tooltip=new a.Tooltip({target:"td.e-valuescontent",showTipPointer:!1,position:"BottomRight",mouseTrail:!0,enableRtl:this.enableRtl,locale:this.locale,beforeRender:this.setToolTip.bind(this),beforeOpen:this.onBeforeTooltipOpen}),this.tooltip.isStringTemplate=!0,this.tooltip.appendTo(this.element)):this.tooltip&&this.tooltip.destroy()},n.prototype.renderContextMenu=function(){if(this.gridSettings.contextMenuItems||this.allowGrouping&&"pivot"===this.dataType){var e=[],t=[],i=[],a=[],r=[],n=[],o=[];if(this.gridSettings.contextMenuItems)for(var s=0,l=this.gridSettings.contextMenuItems;s<l.length;s++){var d=l[s];if("string"==typeof d&&-1!==this.getDefaultItems().indexOf(d))if(-1!==d.toString().toLowerCase().indexOf("aggregate")&&"pivot"===this.dataType){o=[{text:this.localeObj.getConstant("Sum")}];var h=this.buildDefaultItems("Aggregate");h.items=o,r.push(h)}else-1!==d.toString().toLowerCase().indexOf("export")?a.push(this.buildDefaultItems(d)):e.push(this.buildDefaultItems(d));else"string"!=typeof d&&i.push(d)}if(this.allowGrouping&&"pivot"===this.dataType&&(this.getFieldByID(this.element.id+"_custom_group",this.gridSettings.contextMenuItems)||t.push(this.buildDefaultItems("Group")),this.getFieldByID(this.element.id+"_custom_ungroup",this.gridSettings.contextMenuItems)||t.push(this.buildDefaultItems("Ungroup"))),a.length>0){var p=this.buildDefaultItems("export");p.items=a,n.push(p)}this.gridSettings.contextMenuItems=[],Array.prototype.push.apply(this.gridSettings.contextMenuItems,r),Array.prototype.push.apply(this.gridSettings.contextMenuItems,e),Array.prototype.push.apply(this.gridSettings.contextMenuItems,t),Array.prototype.push.apply(this.gridSettings.contextMenuItems,n),Array.prototype.push.apply(this.gridSettings.contextMenuItems,i)}},n.prototype.getFieldByID=function(e,t){return new i.DataManager({json:t}).executeLocal((new i.Query).where("id","equal",e))[0]},n.prototype.getAllSummaryType=function(){return["Sum","Count","DistinctCount","Product","Min","Max","Avg","Median","Index","PopulationVar","SampleVar","PopulationStDev","SampleStDev","RunningTotals","PercentageOfGrandTotal","PercentageOfColumnTotal","PercentageOfRowTotal","PercentageOfParentColumnTotal","PercentageOfParentRowTotal","DifferenceFrom","PercentageOfDifferenceFrom","PercentageOfParentTotal"]},n.prototype.getDefaultItems=function(){return["Drillthrough","Expand","Collapse","Pdf Export","Excel Export","Csv Export","Sort Ascending","Sort Descending","Aggregate","CalculatedField"]},n.prototype.buildDefaultItems=function(e){var t;switch(e){case"Aggregate":t={text:this.localeObj.getConstant("aggregate"),target:"th.e-valuesheader,td.e-valuescontent,.e-stot.e-rowsheader",id:this.element.id+"_aggregate"};break;case"CalculatedField":t={text:this.localeObj.getConstant("CalculatedField"),target:"td.e-valuescontent",id:this.element.id+"_CalculatedField"};break;case"Drillthrough":t={text:this.localeObj.getConstant("drillThrough"),target:"td.e-valuescontent",id:this.element.id+"_drillthrough_menu",iconCss:"e-pivotview-grid "+Ot};break;case"export":t={text:this.localeObj.getConstant("export"),target:"td.e-valuescontent",id:this.element.id+"_exporting",iconCss:"e-pivotview-export "+Ot};break;case"Pdf Export":t={text:this.localeObj.getConstant("pdf"),id:this.element.id+"_pdf",iconCss:Ia+" "+Ot};break;case"Excel Export":t={text:this.localeObj.getConstant("excel"),id:this.element.id+"_excel",iconCss:La+" "+Ot};break;case"Csv Export":t={text:this.localeObj.getConstant("csv"),id:this.element.id+"_csv",iconCss:Aa+" "+Ot};break;case"Expand":t={text:this.localeObj.getConstant("expand"),target:"td.e-rowsheader,.e-columnsheader",id:this.element.id+"_expand",iconCss:"e-pivotview-expand "+Ot};break;case"Collapse":t={text:this.localeObj.getConstant("collapse"),target:"td.e-rowsheader,.e-columnsheader",id:this.element.id+"_collapse",iconCss:"e-pivotview-collapse "+Ot};break;case"Sort Ascending":t={text:this.localeObj.getConstant("ascending"),target:"th.e-valuesheader,.e-stot",id:this.element.id+"_sortasc",iconCss:"e-icon-ascending "+Ot};break;case"Sort Descending":t={text:this.localeObj.getConstant("descending"),target:"th.e-valuesheader,.e-stot",id:this.element.id+"_sortdesc",iconCss:"e-icon-descending "+Ot};break;case"Group":t={text:this.localeObj.getConstant("group"),target:"td.e-rowsheader,.e-columnsheader",id:this.element.id+"_custom_group",iconCss:"e-pivotview-group "+Ot};break;case"Ungroup":t={text:this.localeObj.getConstant("unGroup"),target:"td.e-rowsheader,.e-columnsheader",id:this.element.id+"_custom_ungroup",iconCss:"e-pivotview-ungroup "+Ot}}return this.defaultItems[e]={text:t.text,id:t.id,target:t.target,iconCss:t.iconCss},this.defaultItems[e]},n.prototype.initProperties=function(){this.pivotRefresh=t.Component.prototype.refresh,this.minHeight=t.isNullOrUndefined(this.minHeight)?300:this.minHeight<10?10:this.minHeight,this.isScrolling=!1,this.allowServerDataBinding=!1,this.isStaticRefresh=!1,this.setProperties({pivotValues:[]},!0),delete this.bulkChanges.pivotValues,this.allowServerDataBinding=!0,this.scrollPosObject={vertical:0,horizontal:0,verticalSection:0,horizontalSection:0,top:0,left:0,scrollDirection:{direction:"",position:0}},this.queryCellInfo=this.gridSettings.queryCellInfo?this.gridSettings.queryCellInfo.bind(this):void 0,this.headerCellInfo=this.gridSettings.headerCellInfo?this.gridSettings.headerCellInfo.bind(this):void 0,this.resizing=this.gridSettings.resizing?this.gridSettings.resizing.bind(this):void 0,this.resizeStop=this.gridSettings.resizeStop?this.gridSettings.resizeStop.bind(this):void 0,this.pdfHeaderQueryCellInfo=this.gridSettings.pdfHeaderQueryCellInfo?this.gridSettings.pdfHeaderQueryCellInfo.bind(this):void 0,this.pdfQueryCellInfo=this.gridSettings.pdfQueryCellInfo?this.gridSettings.pdfQueryCellInfo.bind(this):void 0,this.excelHeaderQueryCellInfo=this.gridSettings.excelHeaderQueryCellInfo?this.gridSettings.excelHeaderQueryCellInfo.bind(this):void 0,this.excelQueryCellInfo=this.gridSettings.excelQueryCellInfo?this.gridSettings.excelQueryCellInfo.bind(this):void 0,this.columnDragStart=this.gridSettings.columnDragStart?this.gridSettings.columnDragStart.bind(this):void 0,this.columnDrag=this.gridSettings.columnDrag?this.gridSettings.columnDrag.bind(this):void 0,this.columnDrop=this.gridSettings.columnDrop?this.gridSettings.columnDrop.bind(this):void 0,this.beforeColumnsRender=this.gridSettings.columnRender?this.gridSettings.columnRender:void 0,this.selected=this.gridSettings.cellSelected?this.gridSettings.cellSelected:void 0,this.cellDeselected=this.gridSettings.cellDeselected?this.gridSettings.cellDeselected:void 0,this.rowSelected=this.gridSettings.rowSelected?this.gridSettings.rowSelected:void 0,this.rowDeselected=this.gridSettings.rowDeselected?this.gridSettings.rowDeselected:void 0,this.chartTooltipRender=this.chartSettings.tooltipRender?this.chartSettings.tooltipRender:void 0,this.chartLoaded=this.chartSettings.loaded?this.chartSettings.loaded:void 0,this.chartLoad=this.chartSettings.load?this.chartSettings.load:void 0,this.chartResized=this.chartSettings.resized?this.chartSettings.resized:void 0,this.chartAxisLabelRender=this.chartSettings.axisLabelRender?this.chartSettings.axisLabelRender:void 0,this.multiLevelLabelClick=this.chartSettings.multiLevelLabelClick?this.chartSettings.multiLevelLabelClick:void 0,this.chartPointClick=this.chartSettings.pointClick?this.chartSettings.pointClick:void 0,this.contextMenuClick=this.gridSettings.contextMenuClick?this.gridSettings.contextMenuClick:void 0,this.contextMenuOpen=this.gridSettings.contextMenuOpen?this.gridSettings.contextMenuOpen:void 0,this.beforePdfExport=this.gridSettings.beforePdfExport?this.gridSettings.beforePdfExport.bind(this):void 0,this.beforeExcelExport=this.gridSettings.beforeExcelExport?this.gridSettings.beforeExcelExport.bind(this):void 0,null===this.gridSettings.rowHeight&&(this.isTouchMode?this.setProperties({gridSettings:{rowHeight:36}},!0):this.setProperties({gridSettings:{rowHeight:this.isAdaptive?36:30}},!0)),this.chartSettings&&this.chartSettings.enableMultiAxis&&!this.chartSettings.enableMultipleAxis&&this.setProperties({chartSettings:{enableMultipleAxis:!0}},!0),this.element.style.height="100%",this.enableVirtualization&&this.updatePageSettings(!0),this.isCellBoxMultiSelection=this.gridSettings.allowSelection&&"Box"===this.gridSettings.selectionSettings.cellSelectionMode&&"Cell"===this.gridSettings.selectionSettings.mode&&"Multiple"===this.gridSettings.selectionSettings.type,this.allowGrouping&&!this.isCellBoxMultiSelection&&(this.isCellBoxMultiSelection=!0,this.setProperties({gridSettings:{allowSelection:!0,selectionSettings:{cellSelectionMode:"Box",mode:"Cell",type:"Multiple"}}},!0)),"Table"!==this.displayOption.view&&(this.pivotChartModule=new Er),this.currentView=this.currentView?this.currentView:"Both"===this.displayOption.view?this.displayOption.primary:this.displayOption.view},n.prototype.updatePageSettings=function(e){if(this.enableVirtualization){var t=1,i=1;this.dataSourceSettings.values.length>1&&"pivot"===this.dataType&&("row"===this.dataSourceSettings.valueAxis?i=this.dataSourceSettings.values.length:t=this.dataSourceSettings.values.length);var a=this.getHeightAsNumber();isNaN(a)&&(a=this.element.offsetHeight),this.pageSettings={columnCurrentPage:e?1:this.pageSettings.columnCurrentPage,rowCurrentPage:e?1:this.pageSettings.rowCurrentPage,columnSize:Math.ceil((Math.floor(this.getWidthAsNumber()/this.gridSettings.columnWidth)-1)/t),rowSize:Math.ceil(Math.floor(a/this.gridSettings.rowHeight)/i),allowDataCompression:this.allowDataCompression}}},n.prototype.render=function(){this.loadData()},n.prototype.loadData=function(){if(this.dataSourceSettings.formatSettings.length>0)for(var e=this.dataSourceSettings.formatSettings,i=0;i<e.length;i++)t.isNullOrUndefined(e[i].maximumFractionDigits)&&t.isNullOrUndefined(e[i].minimumFractionDigits)||null!==e[i].format.match(/^(P|N|C|P[0-9]|C[0-9]|N[0-9])$/g)||(e[i].maximumFractionDigits=void 0,e[i].minimumIntegerDigits=void 0);"pivot"===this.dataType&&this.dataSourceSettings.url&&""!==this.dataSourceSettings.url?"Server"===this.dataSourceSettings.mode?(this.guid=g.generateUUID(),this.initialLoad(),"Chart"!==this.displayOption.view&&this.renderEmptyGrid(),this.showWaitingPopup()):(this.request.open("GET",this.dataSourceSettings.url,!0),this.request.withCredentials=!1,this.request.onreadystatechange=this.onReadyStateChange.bind(this),this.request.setRequestHeader("Content-type","text/plain"),this.request.send(null)):this.initialLoad()},n.prototype.onSuccess=function(){if(this.request.readyState===XMLHttpRequest.DONE){this.isServerWaitingPopup=!0;try{var e=JSON.parse(this.request.responseText);if("fetchFieldMembers"===this.currentAction){for(var t=JSON.parse(e.members),i=[],a={},r={},n=0;n<t.length;n++)i.push({formattedText:t[n].FormattedText,actualText:t[n].ActualText}),a[t[n].FormattedText]={},r[t[n].ActualText]={};this.engineModule.fieldList[e.memberName].dateMember=i,this.engineModule.fieldList[e.memberName].formattedMembers=a,this.engineModule.fieldList[e.memberName].members=r,this.showGroupingBar?this.pivotButtonModule.updateFilterEvents():this.pivotFieldListModule.pivotButtonModule.updateFilterEvents()}else if("fetchRawData"===this.currentAction){for(var o=this.engineModule.fieldList[this.drillThroughValue.actualText.toString()]?this.engineModule.fieldList[this.drillThroughValue.actualText.toString()].caption:this.drillThroughValue.actualText.toString(),s=this.engineModule.fieldList[this.drillThroughValue.actualText]?this.engineModule.fieldList[this.drillThroughValue.actualText].aggregateType:"",l=JSON.parse(e.rawData),d=JSON.parse(e.indexObject),h={},p=0;p<d.length;p++)h[d[p].Key]=d[p].Value;this.drillThroughValue.indexObject=h,this.drillThroughModule.triggerDialog(o,s,l,this.drillThroughValue,this.drillThroughElement)}else{var u=g.formatFieldList(JSON.parse(e.fieldList));if(this.engineModule.fieldList){var c=Object.keys(this.engineModule.fieldList);for(n=0;n<c.length;n++)this.engineModule.fieldList[c[n]]&&u[c[n]]&&(u[c[n]].dateMember=this.engineModule.fieldList[c[n]].dateMember,u[c[n]].formattedMembers=this.engineModule.fieldList[c[n]].formattedMembers,u[c[n]].members=this.engineModule.fieldList[c[n]].members)}this.engineModule.fieldList=u,this.engineModule.fields=JSON.parse(e.fields),this.engineModule.rowCount=JSON.parse(e.pivotCount).RowCount,this.engineModule.columnCount=JSON.parse(e.pivotCount).ColumnCount,this.engineModule.rowStartPos=JSON.parse(e.pivotCount).RowStartPosition,this.engineModule.colStartPos=JSON.parse(e.pivotCount).ColumnStartPosition,this.engineModule.rowFirstLvl=JSON.parse(e.pivotCount).RowFirstLevel,this.engineModule.colFirstLvl=JSON.parse(e.pivotCount).ColumnFirstLevel;for(var m=void 0,f=g.formatPivotValues(JSON.parse(e.pivotValue)),v=0;v<f.length;v++)if(f[v]&&f[v][0]&&"row"===f[v][0].axis){m=v;break}this.engineModule.headerContent=g.frameContent(f,"header",m,this),this.engineModule.pageSettings=this.pageSettings,this.dataSourceSettings.groupSettings.length>0&&g.updateReport(this,JSON.parse(e.dataSourceSettings));var S=JSON.parse(e.dataSourceSettings).ValueSortSettings;this.engineModule.valueSortSettings={headerText:S.HeaderText,headerDelimiter:S.HeaderDelimiter,sortOrder:S.SortOrder,columnIndex:S.ColumnIndex},this.engineModule.pivotValues=f}}catch(e){this.engineModule.pivotValues=[]}if("onScroll"===this.currentAction)if("vertical"===this.scrollDirection){var y="row"===this.dataSourceSettings.valueAxis?this.dataSourceSettings.values.length:1,b=this.pageSettings.rowSize*y*this.gridSettings.rowHeight*Math.ceil(this.engineModule.rowStartPos/(this.pageSettings.rowSize*y))-this.engineModule.rowFirstLvl*y*this.gridSettings.rowHeight;this.scrollPosObject.verticalSection=b}else if("horizondal"===this.scrollDirection){var C="column"===this.dataSourceSettings.valueAxis?this.dataSourceSettings.values.length:1;b=this.pageSettings.columnSize*C*this.gridSettings.columnWidth*Math.ceil(this.engineModule.colStartPos/(this.pageSettings.columnSize*C))-this.engineModule.colFirstLvl*C*this.gridSettings.columnWidth;this.scrollPosObject.horizontalSection=b}"fetchFieldMembers"!==this.currentAction&&"fetchRawData"!==this.currentAction&&(this.initEngine(),this.calculatedFieldModule&&this.calculatedFieldModule.isRequireUpdate&&(this.calculatedFieldModule.endDialog(),this.calculatedFieldModule.isRequireUpdate=!1),this.pivotFieldListModule&&this.pivotFieldListModule.calculatedFieldModule&&this.pivotFieldListModule.calculatedFieldModule.isRequireUpdate&&(this.pivotFieldListModule.calculatedFieldModule.endDialog(),this.pivotFieldListModule.calculatedFieldModule.isRequireUpdate=!1))}},n.prototype.getEngine=function(e,t,i,a,r,n,o,s,l){var d=this;this.currentAction=e,this.isServerWaitingPopup=!1;var h={pageSettings:this.pageSettings,enableValueSorting:this.enableValueSorting,enableDrillThrough:this.allowDrillThrough||this.editSettings.allowEditing,locale:JSON.stringify(g.getLocalizedObject(this))};this.request.open("POST",this.dataSourceSettings.url,!0);var p={request:this.request,dataSourceSettings:JSON.parse(this.getPersistData()).dataSourceSettings,action:e,customProperties:{},internalProperties:h,drillItem:t,sortItem:i,aggregatedItem:a,calculatedItem:r,filterItem:n,memberName:o,fetchRawDataArgs:s,editArgs:l,hash:this.guid};this.trigger(Z,p,function(e){d.request=e.request,p.internalProperties=e.internalProperties,p.customProperties=e.customProperties,p.dataSourceSettings=e.dataSourceSettings,p.calculatedItem=e.calculatedItem,p.drillItem=e.drillItem,p.editArgs=e.editArgs,p.fetchRawDataArgs=e.fetchRawDataArgs,p.filterItem=e.filterItem,p.hash=e.hash,p.memberName=e.memberName,p.sortItem=e.sortItem}),this.request.withCredentials=!1,this.request.onreadystatechange=this.onSuccess.bind(this),this.request.setRequestHeader("Content-type","application/json"),this.request.send(JSON.stringify(p))},n.prototype.onReadyStateChange=function(){if(this.request.readyState===XMLHttpRequest.DONE){var e=[];if("CSV"===this.dataSourceSettings.type)for(var i=this.request.responseText.split(/\r?\n|\r/),a=0;a<i.length;a++)t.isNullOrUndefined(i[a])||""===i[a]||e.push(i[a].split(","));else try{e=JSON.parse(this.request.responseText)}catch(t){e=[]}e&&e.length>0&&this.setProperties({dataSourceSettings:{dataSource:e}},!0),this.initialLoad()}},n.prototype.initialLoad=function(){var e=this;try{this.cellTemplateFn=this.templateParser(this.cellTemplate),this.tooltipTemplateFn=this.templateParser(this.tooltipTemplate),this.spinnerTemplate?a.createSpinner({target:this.element,template:this.spinnerTemplate},this.createElement):a.createSpinner({target:this.element},this.createElement);var t={dataSourceSettings:this.dataSourceSettings,pivotview:this,fieldsType:{}};this.trigger("load",t,function(t){e.dataSourceSettings=t.dataSourceSettings,e.fieldsType=t.fieldsType,e.updateClass(),e.notify(oe,{}),"Server"!==e.dataSourceSettings.mode&&e.notify(ie,{}),e.isAdaptive&&e.contextMenuModule.render(),e.notify(he,{})})}catch(e){this.actionFailureMethod(e)}},n.prototype.addInternalEvents=function(){this.on(ie,this.generateData,this),this.on(ne,this.renderPivotGrid,this),this.on(re,this.onContentReady,this)},n.prototype.removeInternalEvents=function(){this.off(ie,this.generateData),this.off(ne,this.renderPivotGrid),this.off(re,this.onContentReady)},n.prototype.getPersistData=function(){var e=this.gridSettings.columnRender,t=this.chartSettings.load,i=this.chartSettings.loaded,a=this.chartSettings.textRender,r=this.chartSettings.pointRender,n=this.chartSettings.seriesRender,o=this.chartSettings.legendRender,s=this.chartSettings.pointClick,l=this.chartSettings.tooltipRender;this.gridSettings.columnRender=void 0,this.chartSettings.tooltipRender=void 0,this.chartSettings.load=void 0,this.chartSettings.loaded=void 0,this.chartSettings.textRender=void 0,this.chartSettings.pointRender=void 0,this.chartSettings.seriesRender=void 0,this.chartSettings.legendRender=void 0,this.chartSettings.pointClick=void 0;var d=this.addOnPersist(["dataSourceSettings","pivotValues","gridSettings","chartSettings","displayOption"]);return this.gridSettings.columnRender=e,this.chartSettings.load=t,this.chartSettings.loaded=i,this.chartSettings.textRender=a,this.chartSettings.pointRender=r,this.chartSettings.seriesRender=n,this.chartSettings.legendRender=o,this.chartSettings.pointClick=s,this.chartSettings.tooltipRender=l,d},n.prototype.loadPersistData=function(e){var t=JSON.parse(e);this.allowServerDataBinding=!1,this.setProperties({gridSettings:t.gridSettings,pivotValues:t.pivotValues,chartSettings:t.chartSettings,displayOption:t.displayOption},!0),delete this.bulkChanges.pivotValues,this.allowServerDataBinding=!0,this.dataSourceSettings=t.dataSourceSettings},n.prototype.mergePersistPivotData=function(){var e=window.localStorage.getItem(this.getModuleName()+this.element.id);t.isNullOrUndefined(e)||""===e||this.setProperties(JSON.parse(e),!0)},n.prototype.showConditionalFormattingDialog=function(){this.conditionalFormattingModule&&this.conditionalFormattingModule.showConditionalFormattingDialog()},n.prototype.createCalculatedFieldDialog=function(){this.calculatedFieldModule&&this.calculatedFieldModule.createCalculatedFieldDialog()},n.prototype.getModuleName=function(){return"pivotview"},n.prototype.copy=function(e){this.grid.copy(e)},n.prototype.onPropertyChanged=function(i,a){for(var r=0,n=Object.keys(i);r<n.length;r++){var o=n[r];switch(o){case"dataSourceSettings":case"hyperlinkSettings":case"allowDrillThrough":case"editSettings":case"allowDataCompression":if(i.dataSourceSettings&&1===Object.keys(i.dataSourceSettings).length&&i.dataSourceSettings.groupSettings&&"pivot"===this.dataType&&this.updateGroupingReport(i.dataSourceSettings.groupSettings,"Date"),i.dataSourceSettings&&1===Object.keys(i.dataSourceSettings).length&&"dataSource"===Object.keys(i.dataSourceSettings)[0])!t.isNullOrUndefined(this.savedDataSourceSettings)&&this.dataSourceSettings.dataSource.length>0&&(g.updateDataSourceSettings(this,this.savedDataSourceSettings),this.savedDataSourceSettings=void 0),0===(i.dataSourceSettings.dataSource&&i.dataSourceSettings.dataSource).length&&(this.savedDataSourceSettings=g.getClonedDataSourceSettings(this.dataSourceSettings),this.setProperties({dataSourceSettings:{rows:[]}},!0),this.setProperties({dataSourceSettings:{columns:[]}},!0),this.setProperties({dataSourceSettings:{values:[]}},!0),this.setProperties({dataSourceSettings:{filters:[]}},!0)),this.isStaticRefresh||(this.pivotValues=[],this.engineModule.fieldList=null),this.dataSourceSettings.groupSettings.length>0&&(this.clonedDataSet=i.dataSourceSettings.dataSource,this.updateGroupingReport(this.dataSourceSettings.groupSettings,"Date")),this.showWaitingPopup(),clearTimeout(this.timeOutObj),this.timeOutObj=setTimeout(this.refreshData.bind(this),100);else if(g.isButtonIconRefesh(o,a,i)){if(this.showGroupingBar&&this.groupingBarModule&&this.axisFieldModule.render(),this.showFieldList&&this.pivotFieldListModule){var s=g.cloneFieldSettings(this.dataSourceSettings.rows),l=g.cloneFieldSettings(this.dataSourceSettings.columns),d=g.cloneFieldSettings(this.dataSourceSettings.values),h=g.cloneFieldSettings(this.dataSourceSettings.filters);this.pivotFieldListModule.setProperties({dataSourceSettings:{rows:s,columns:l,values:d,filters:h}},!0),this.pivotFieldListModule.axisFieldModule.render(),this.pivotFieldListModule.treeViewModule.fieldTable&&!this.isAdaptive&&this.pivotFieldListModule.notify(se,{})}}else this.remoteData=[],"pivot"===this.dataType&&this.dataSourceSettings.url&&""!==this.dataSourceSettings.url&&("type"in i.dataSourceSettings||"url"in i.dataSourceSettings)?(this.engineModule.fieldList=null,this.loadData()):(i.dataSourceSettings&&"dataSource"in i.dataSourceSettings&&(i.dataSourceSettings.dataSource&&0===i.dataSourceSettings.dataSource.length&&(this.savedDataSourceSettings=g.getClonedDataSourceSettings(this.dataSourceSettings),this.setProperties({dataSourceSettings:{rows:[]}},!0),this.setProperties({dataSourceSettings:{columns:[]}},!0),this.setProperties({dataSourceSettings:{values:[]}},!0),this.setProperties({dataSourceSettings:{filters:[]}},!0)),this.isStaticRefresh||(this.engineModule.fieldList=null,this.pivotValues=[])),this.notify(ie,{}));break;case"height":case"width":this.layoutRefresh();break;case"pivotValues":case"displayOption":!this.showToolbar&&i.displayOption&&1===Object.keys(i.displayOption).length&&i.displayOption.view?(this.currentView="Both"===i.displayOption.view?this.displayOption.primary:i.displayOption.view,(this.showGroupingBar||this.showFieldList)&&(this.showFieldList&&this.pivotFieldListModule&&(this.pivotFieldListModule.destroyEngine=!0,this.pivotFieldListModule.destroy(),this.pivotFieldListModule.destroyEngine=!1),this.notify(oe,this)),this.grid||"Chart"===i.displayOption.view?this.pivotChartModule||"Table"===this.displayOption.view||(this.grid&&(this.grid.destroy(),this.grid=void 0),this.pivotChartModule=new Er):(this.renderEmptyGrid(),"Table"===i.displayOption.view&&this.pivotChartModule&&(this.destroyEngine=!0,this.pivotChartModule.destroy(),this.destroyEngine=!1,this.chart=void 0,this.pivotChartModule=void 0))):this.showToolbar&&!t.isNullOrUndefined(i.displayOption)&&i.displayOption.view&&(this.currentView="Both"===i.displayOption.view?this.displayOption.primary:i.displayOption.view);var p="pivot"===this.dataType?this.engineModule:this.olapEngineModule;t.isNullOrUndefined(p.fieldList)&&t.isNullOrUndefined(p.pivotValues)||this.notify(ne,{});break;case"gridSettings":this.lastGridSettings=i.gridSettings,this.isCellBoxMultiSelection=this.gridSettings.allowSelection&&"Box"===this.gridSettings.selectionSettings.cellSelectionMode&&"Cell"===this.gridSettings.selectionSettings.mode&&"Multiple"===this.gridSettings.selectionSettings.type,this.allowGrouping&&this.groupingModule&&!this.isCellBoxMultiSelection&&(this.setProperties({gridSettings:{allowSelection:!0,selectionSettings:{cellSelectionMode:"Box",mode:"Cell",type:"Multiple"}}},!0),this.isCellBoxMultiSelection=!0),this.renderModule.updateGridSettings();break;case"chartSettings":this.showGroupingBar&&this.groupingBarModule&&(-1!==Object.keys(i.chartSettings).indexOf("enableMultipleAxis")||i.chartSettings.chartSeries&&-1!==Object.keys(i.chartSettings.chartSeries).indexOf("type"))&&this.groupingBarModule.renderLayout(),t.isNullOrUndefined(this.pivotChartModule)&&"Table"!==this.displayOption.view&&(this.pivotChartModule=new Er);var u="pivot"===this.dataType?this.engineModule:this.olapEngineModule;t.isNullOrUndefined(this.pivotChartModule)||t.isNullOrUndefined(u.pivotValues)||this.pivotChartModule.loadChart(this,this.chartSettings),t.isNullOrUndefined(u.pivotValues)||t.isNullOrUndefined(u.fieldList)||this.notify(ae,this);break;case"locale":case"currencyCode":case"enableRtl":if(this.tooltip&&this.tooltip.destroy(),this.dataSourceSettings.groupSettings&&this.dataSourceSettings.groupSettings.length>0&&this.clonedDataSet){var c=g.getClonedData(this.clonedDataSet);this.setProperties({dataSourceSettings:{dataSource:c}},!0)}e.prototype.refresh.call(this),this.updateClass();break;case"enableValueSorting":this.enableValueSorting=i.enableValueSorting,this.updateDataSource();break;case"showGroupingBar":this.element.querySelector(".e-grouping-bar")?this.element.querySelector(".e-grouping-bar").remove():this.groupingBarModule&&this.groupingBarModule.renderLayout(),t.isNullOrUndefined(i.showFieldList)&&this.renderPivotGrid();break;case"showFieldList":this.initialLoad();break;case"groupingBarSettings":this.showGroupingBar&&this.groupingBarModule&&(i.groupingBarSettings&&Object.keys(i.groupingBarSettings).indexOf("showFieldsPanel")>-1?(this.groupingBarModule.RefreshFieldsPanel(),this.layoutRefresh()):this.axisFieldModule.render());break;case"showValuesButton":this.showGroupingBar&&this.groupingBarModule&&this.axisFieldModule&&this.axisFieldModule.render(),this.showFieldList&&this.pivotFieldListModule&&this.pivotFieldListModule.axisFieldModule&&(this.pivotFieldListModule.setProperties({showValuesButton:i.showValuesButton},!0),this.pivotFieldListModule.axisFieldModule.render());break;case"showTooltip":this.renderToolTip();break;case"toolbar":this.toolbarModule&&this.toolbarModule.refreshToolbar();break;case"chartTypes":this.toolbarModule&&this.toolbarModule.createChartMenu();break;case"aggregateTypes":this.showGroupingBar&&this.groupingBarModule&&this.axisFieldModule&&this.axisFieldModule.render(),this.showFieldList&&this.pivotFieldListModule&&this.pivotFieldListModule.axisFieldModule&&(this.pivotFieldListModule.setProperties({aggregateTypes:i.aggregateTypes},!0),this.pivotFieldListModule.axisFieldModule.render())}}},n.prototype.templateParser=function(e){if(e)try{if(document.querySelectorAll(e).length)return t.compile(document.querySelector(e).innerHTML.trim())}catch(i){return t.compile(e)}},n.prototype.getCellTemplate=function(){return this.cellTemplateFn},n.prototype.appendHtml=function(e,i){var a=document.createElement("div");return a.innerHTML=i,t.isNullOrUndefined(a.firstChild)||e.appendChild(a.firstChild),e},n.prototype.renderPivotGrid=function(){this.clearTemplate(),this.pivotChartModule&&(this.pivotChartModule.engineModule=this.engineModule,this.pivotChartModule.loadChart(this,this.chartSettings),this.enableRtl&&this.chart&&"rtl"!==document.body.getAttribute("dir")&&t.addClass([this.chart.element],"e-ltr")),(this.showFieldList||this.showGroupingBar||this.allowNumberFormatting||this.allowCalculatedField||this.toolbar||this.allowGrouping||this.gridSettings.contextMenuItems)&&(this.notify(ae,this),this.pivotFieldListModule&&this.allowDeferLayoutUpdate&&(this.pivotFieldListModule.clonedDataSource=t.extend({},this.dataSourceSettings,null,!0))),this.enableVirtualization&&(this.virtualscrollModule=new Dr(this)),(this.allowDrillThrough||this.editSettings.allowEditing)&&(this.drillThroughModule=new Nr(this)),"Chart"!==this.displayOption.view?(this.hyperlinkSettings&&(this.isRowCellHyperlink=!!this.hyperlinkSettings.showRowHeaderHyperlink||!!this.hyperlinkSettings.showHyperlink,this.isColumnCellHyperlink=!!this.hyperlinkSettings.showColumnHeaderHyperlink||!!this.hyperlinkSettings.showHyperlink,this.isValueCellHyperlink=!!this.hyperlinkSettings.showValueCellHyperlink||!!this.hyperlinkSettings.showHyperlink,this.isSummaryCellHyperlink=!!this.hyperlinkSettings.showSummaryCellHyperlink||!!this.hyperlinkSettings.showHyperlink,this.applyHyperlinkSettings()),this.renderModule=this.renderModule?this.renderModule:new $a(this),this.renderModule.render(!0)):this.grid&&t.remove(this.grid.element),this.allowConditionalFormatting&&this.applyFormatting(this.pivotValues),this.showToolbar&&"Both"===this.displayOption.view&&this.chart&&this.grid&&(this.showGroupingBar&&this.groupingBarModule&&this.element.querySelector("."+pi)&&this.groupingBarModule.refreshUI(),this.toolbarModule&&this.toolbarModule.toolbar&&(this.toolbarModule.toolbar.width=this.getGridWidthAsNumber()-2),this.chartSettings.enableScrollOnMultiAxis&&this.chartSettings.enableMultipleAxis&&(this.element.querySelector("."+qa).style.width=t.formatUnit(this.getGridWidthAsNumber())),this.chart.width=t.formatUnit(this.getGridWidthAsNumber()),"Table"===this.currentView?(this.grid.element.style.display="",this.chart.element.style.display="none",this.chartSettings.enableMultipleAxis&&this.chartSettings.enableScrollOnMultiAxis&&(this.element.querySelector(".e-pivotchart").style.display="none")):(this.grid.element.style.display="none",this.chart.element.style.display="",this.chartSettings.enableMultipleAxis&&this.chartSettings.enableScrollOnMultiAxis&&(this.element.querySelector(".e-pivotchart").style.display=""))),this.toolbarModule&&(this.showFieldList&&t.select("#"+this.element.id+"_PivotFieldList",this.element)&&(this.toolbar&&-1!==this.toolbar.indexOf("FieldList")?t.select("#"+this.element.id+"_PivotFieldList",this.element).style.display="none":(t.select("#"+this.element.id+"_PivotFieldList",this.element).style.top=this.element.querySelector("."+ja).offsetHeight.toString()+"px",t.select("#"+this.element.id+"_PivotFieldList",this.element).style.position="relative")),this.toolbar&&-1!==this.toolbar.indexOf("FieldList")&&this.showToolbar&&this.element.querySelector(".e-toggle-field-list")&&(this.element.querySelector(".e-toggle-field-list").style.display="none"),this.toolbarModule&&"New"!==this.toolbarModule.action&&"Load"!==this.toolbarModule.action&&"Remove"!==this.toolbarModule.action&&(this.isModified=!0),this.isInitialRendering||(this.isModified=!1,this.isInitialRendering=!this.isInitialRendering),this.toolbarModule.action="")},n.prototype.showWaitingPopup=function(){this.grid&&this.grid.element&&!this.spinnerTemplate&&"Table"===this.currentView?a.showSpinner(this.grid.element):a.showSpinner(this.element)},n.prototype.hideWaitingPopup=function(){this.grid&&this.grid.element&&!this.spinnerTemplate&&"Table"===this.currentView?a.hideSpinner(this.grid.element):a.hideSpinner(this.element)},n.prototype.updateDataSource=function(e){var t=this;this.showWaitingPopup();var i=this,a=Object.keys(i.lastSortInfo).length>0,r=Object.keys(i.lastFilterInfo).length>0,n=Object.keys(i.lastAggregationInfo).length>0,o=Object.keys(i.lastCalcFieldInfo).length>0,s={dataSourceSettings:g.getClonedDataSourceSettings(i.dataSourceSettings)};i.trigger(v,s,function(e){if(i.enableVirtualization&&(a||r||n||o)||g.updateDataSourceSettings(i,e.dataSourceSettings),i.updatePageSettings(!1),"pivot"===i.dataType&&i.enableVirtualization&&(a||r||n||o))a&&(i.setProperties({dataSourceSettings:{valueSortSettings:{headerText:""}}},!0),"Server"===t.dataSourceSettings.mode?i.getEngine("onSort",null,i.lastSortInfo,null,null,null,null):i.engineModule.onSort(i.lastSortInfo),i.lastSortInfo={}),n&&("Server"===t.dataSourceSettings.mode?i.getEngine("onAggregation",null,null,i.lastAggregationInfo,null,null,null):i.engineModule.onAggregation(i.lastAggregationInfo),i.lastAggregationInfo={}),o&&("Server"===t.dataSourceSettings.mode?i.getEngine("onCalcOperation",null,null,null,i.lastCalcFieldInfo,null,null):i.engineModule.onCalcOperation(i.lastCalcFieldInfo),i.lastCalcFieldInfo={}),r&&("Server"===t.dataSourceSettings.mode?i.getEngine("onFilter",null,null,null,null,i.lastFilterInfo,null):i.engineModule.onFilter(i.lastFilterInfo,i.dataSourceSettings),i.lastFilterInfo={}),i.allowServerDataBinding=!1,i.setProperties({pivotValues:i.engineModule.pivotValues},!0),delete i.bulkChanges.pivotValues,i.allowServerDataBinding=!0,"Server"!==i.dataSourceSettings.mode&&i.enginePopulatedEventMethod("updateDataSource");else if("olap"===i.dataType){var s={mode:"",savedFieldList:i.olapEngineModule.fieldList,savedFieldListData:i.olapEngineModule.fieldListData,pageSettings:i.pageSettings,enableValueSorting:i.enableValueSorting,isDrillThrough:i.allowDrillThrough||i.editSettings.allowEditing,localeObj:i.localeObj};o||a?(i.olapEngineModule.savedFieldList=i.olapEngineModule.fieldList,i.olapEngineModule.savedFieldListData=i.olapEngineModule.fieldListData,o?(i.olapEngineModule.updateCalcFields(i.dataSourceSettings,i.lastCalcFieldInfo),i.lastCalcFieldInfo={}):(i.olapEngineModule.onSort(i.dataSourceSettings),i.lastSortInfo={})):i.olapEngineModule.renderEngine(i.dataSourceSettings,s),i.allowServerDataBinding=!1,i.setProperties({pivotValues:i.olapEngineModule.pivotValues},!0),delete i.bulkChanges.pivotValues,i.allowServerDataBinding=!0,i.enginePopulatedEventMethod("updateDataSource")}else{s={mode:"",savedFieldList:i.engineModule.fieldList,pageSettings:i.pageSettings,enableValueSorting:i.enableValueSorting,isDrillThrough:i.allowDrillThrough||i.editSettings.allowEditing,localeObj:i.localeObj,fieldsType:i.fieldsType,clonedReport:i.clonedReport,globalize:i.globalize,currenyCode:i.currencyCode};"Server"===i.dataSourceSettings.mode?(a?i.getEngine("onSort",null,i.lastSortInfo,null,null,null,null):n?i.getEngine("onAggregation",null,null,i.lastAggregationInfo,null,null,null):o?i.getEngine("onCalcOperation",null,null,null,i.lastCalcFieldInfo,null,null):r?i.getEngine("onFilter",null,null,null,null,i.lastFilterInfo,null):i.getEngine("onDrop",null,null,null,null,null,null),i.lastSortInfo={},i.lastAggregationInfo={},i.lastCalcFieldInfo={},i.lastFilterInfo={}):(i.engineModule.renderEngine(i.dataSourceSettings,s,i.getValueCellInfo.bind(i)),i.allowServerDataBinding=!1,i.setProperties({pivotValues:i.engineModule.pivotValues},!0),delete i.bulkChanges.pivotValues,i.allowServerDataBinding=!0,i.enginePopulatedEventMethod("updateDataSource"))}})},n.prototype.excelExport=function(e,t,i,a){this.enableVirtualization&&"Server"!==this.dataSourceSettings.mode?this.excelExportModule.exportToExcel("Excel",e):(this.exportType="Excel",this.grid.excelExport(e,t,i,a)),this.actionObj.actionName=this.getActionCompleteName();var r={exportInfo:{type:this.exportType,info:e}};this.actionObj.actionInfo=r,this.actionObj.actionName&&this.actionCompleteMethod()},n.prototype.csvExport=function(e,t,i,a){this.enableVirtualization&&"Server"!==this.dataSourceSettings.mode?this.excelExportModule.exportToExcel("CSV",e):(this.exportType="CSV",this.grid.csvExport(e,t,i,a)),this.actionObj.actionName=this.getActionCompleteName();var r={exportInfo:{type:this.exportType,info:e}};this.actionObj.actionInfo=r,this.actionObj.actionName&&this.actionCompleteMethod()},n.prototype.pdfExport=function(e,t,i,a){this.enableVirtualization&&"Server"!==this.dataSourceSettings.mode?this.pdfExportModule.exportToPDF(e):this.grid.pdfExport(e,t,i,a),this.actionObj.actionName=this.getActionCompleteName();var r={exportInfo:{type:"PDF",info:e}};this.actionObj.actionInfo=r,this.actionObj.actionName&&this.actionCompleteMethod()},n.prototype.chartExport=function(e,t,i,a,r){this.chart&&this.chart.enableExport&&this.chart.exportModule.export(e,t,i,null,a,r),this.actionObj.actionName=this.getActionCompleteName();var n={exportInfo:{type:e,info:t}};this.actionObj.actionInfo=n,this.actionObj.actionName&&this.actionCompleteMethod()},n.prototype.printChart=function(){this.chart&&this.chart.print()},n.prototype.onDrill=function(e,t){var i=this,a=this.dataSourceSettings.drilledMembers[0]&&this.dataSourceSettings.drilledMembers[0].delimiter?this.dataSourceSettings.drilledMembers[0].delimiter:"**",r="",n="",o="";if(t?(r=t.fieldName,n=t.cell.axis,o=t.isDrilled?"up":"down"):(r=e.parentElement.getAttribute("fieldname"),n=e.parentElement.classList.contains(qi)?"row":"column",o=e.classList.contains(Ai)?"up":"down"),"pivot"===this.dataType){var s=g.cloneDrillMemberSettings(this.dataSourceSettings.drilledMembers),l=t?t.cell:this.engineModule.pivotValues[Number(e.parentElement.getAttribute("index"))][Number(e.parentElement.getAttribute("aria-colindex"))],d=l.valueSort.levelName.split(this.engineModule.valueSortSettings.headerDelimiter).join(a),h=!1;if(0===this.dataSourceSettings.drilledMembers.length)this.setProperties({dataSourceSettings:{drilledMembers:[{name:r,items:[d],delimiter:a}]}},!0);else{for(var p=g.cloneDrillMemberSettings(this.dataSourceSettings.drilledMembers),u=0;u<p.length;u++){var c=p[u];if(d=d.split(a).join(c.delimiter?c.delimiter:a),a=c.delimiter=c.delimiter?c.delimiter:a,c.name===r){h=!0;var m=c.items.indexOf(d);m>-1?c.items.splice(m,1):c.items.push(d)}}this.setProperties({dataSourceSettings:{drilledMembers:p}},!0),h||this.dataSourceSettings.drilledMembers.push({name:r,items:[d],delimiter:a})}this.showWaitingPopup();var f=this,y={fieldName:r,memberName:d,delimiter:a,axis:n,action:o,currentCell:l},b={drillInfo:y,pivotview:f,cancel:!1};f.trigger("drill",b,function(e){if(e.cancel)i.hideWaitingPopup(),i.setProperties({dataSourceSettings:{drilledMembers:s}},!0);else{var t={dataSourceSettings:g.getClonedDataSourceSettings(i.dataSourceSettings)};f.trigger(v,t),f.setProperties({dataSourceSettings:t.dataSourceSettings},!0),f.enableVirtualization?"Server"===i.dataSourceSettings.mode?i.getEngine("onDrill",y,null,null,null,null,null):(f.engineModule.drilledMembers=f.dataSourceSettings.drilledMembers,f.engineModule.onDrill(y)):"Server"===i.dataSourceSettings.mode?i.getEngine("onDrill",y,null,null,null,null,null):f.engineModule.generateGridData(f.dataSourceSettings,!0),f.allowServerDataBinding=!1,f.setProperties({pivotValues:f.engineModule.pivotValues},!0),delete f.bulkChanges.pivotValues,f.allowServerDataBinding=!0;var a={dataSourceSettings:g.getClonedDataSourceSettings(t.dataSourceSettings),pivotValues:i.pivotValues};i.trigger(S,a),f.engineModule.pivotValues=a.pivotValues;var r={drillInfo:y};i.actionObj.actionInfo=r,f.renderPivotGrid()}})}else this.onOlapDrill(r,n,o,a,e,t)},n.prototype.onOlapDrill=function(e,t,i,a,r,n){var o=this,s=this,l=g.cloneDrillMemberSettings(this.dataSourceSettings.drilledMembers),d=n?n.cell:this.olapEngineModule.pivotValues[Number(r.parentElement.getAttribute("index"))][Number(r.parentElement.getAttribute("aria-colindex"))],h="row"===t?this.olapEngineModule.tupRowInfo[d.ordinal]:this.olapEngineModule.tupColumnInfo[d.ordinal],p={axis:t,action:i,fieldName:e,delimiter:"~~",memberName:h.uNameCollection,currentCell:d};this.showWaitingPopup();var u={drillInfo:p,pivotview:s,cancel:!1},c=this.olapEngineModule.fieldList[p.fieldName]&&this.olapEngineModule.fieldList[p.fieldName].isHierarchy,m=h.drillInfo.map(function(e){return e.hierarchy}).indexOf(d.hierarchy.toString()),f=g.cloneDrillMemberSettings(this.dataSourceSettings.drilledMembers);if(p&&"down"===p.action){for(var y=h.drillInfo.map(function(e){return e.uName}),b="",C=0;C<=m;C++){var x=(q=y[C]).split("~~");b=b+(""!==b?"~~":"")+x[x.length-1]}for(var w=this.olapEngineModule.getDrilledSets(p.memberName,d,this.olapEngineModule.fieldList[d.hierarchy]&&!this.olapEngineModule.fieldList[d.hierarchy].hasAllMember?d.valueSort.levelName.split(this.dataSourceSettings.valueSortSettings.headerDelimiter).length-1:m,t),T=0,M=k=Object.keys(w);T<M.length;T++)for(var D=w[M[T]],O=0,N=f.length;O<N;O++){var E=f[O],P=D;E.delimiter&&(P=P.replace(/~~/g,E.delimiter));for(var F=[],I=0;I<E.items.length;I++)0!==E.items[I].indexOf(P)&&(F[F.length]=E.items[I]);E.items=F}this.olapEngineModule.drilledSets[d.actualText]=h.members[m],p.memberName=b;for(var L=[],A=0,R=f;A<R.length;A++){(q=R[A]).name===p.fieldName&&L.push(q)}if(L.length>0){L[0].delimiter&&(b=b.replace(/~~/g,L[0].delimiter));if(-1===g.inArray(b,L[0].items)&&L[0].items.push(b),c)for(O=0;O<L[0].items.length;)L[0].items[O]===b?L[0].items.splice(O,1):++O}else if(!c){var j={name:p.fieldName,items:[b],delimiter:"~~"};f?f.push(j):f=[j]}u.drillInfo.memberName=b,this.setProperties({dataSourceSettings:{drilledMembers:f}},!0),s.trigger("drill",u,function(e){if(e.cancel)o.hideWaitingPopup(),o.setProperties({dataSourceSettings:{drilledMembers:l}},!0);else{var t={dataSourceSettings:g.getClonedDataSourceSettings(o.dataSourceSettings)};o.trigger(v,t),o.setProperties({dataSourceSettings:t.dataSourceSettings},!0),o.olapEngineModule.updateDrilledInfo(o.dataSourceSettings),o.allowServerDataBinding=!1,o.setProperties({pivotValues:o.olapEngineModule.pivotValues},!0),delete o.bulkChanges.pivotValues,o.allowServerDataBinding=!0;var i={dataSourceSettings:g.getClonedDataSourceSettings(t.dataSourceSettings),pivotValues:s.olapEngineModule.pivotValues};o.trigger(S,i),o.olapEngineModule.pivotValues=i.pivotValues,o.renderPivotGrid()}})}else{delete this.olapEngineModule.drilledSets[d.actualText];w=this.olapEngineModule.getDrilledSets(p.memberName,d,m,t);var k=Object.keys(w);for(y=h.drillInfo.map(function(e){return e.uName}),b="",C=0;C<=m;C++){var q;x=(q=y[C]).split("~~");b=b+(""!==b?"~~":"")+x[x.length-1]}for(var V=0,H=k;V<H.length;V++){D=w[H[V]];var B=[];for(O=0,N=f.length;O<N;O++){var _=D;if((L=f[O]).name===p.fieldName&&B.push(L),L.delimiter&&(_=D.replace(/~~/g,L.delimiter)),!c){for(F=[],I=0;I<L.items.length;I++)0!==L.items[I].indexOf(_)&&(F[F.length]=L.items[I]);L.items=F}}if(c)if(B.length>0){B[0].delimiter&&(b=b.replace(/~~/g,B[0].delimiter));-1===g.inArray(b,B[0].items)&&B[0].items.push(b)}else{j={name:p.fieldName,items:[b],delimiter:"~~"};f?f.push(j):f=[j]}}for(var U=[],G=0,W=f;G<W.length;G++){var z=W[G];z.items.length>0&&U.push(z)}this.setProperties({dataSourceSettings:{drilledMembers:f}},!0),s.trigger("drill",u,function(e){if(e.cancel)o.hideWaitingPopup(),o.setProperties({dataSourceSettings:{drilledMembers:l}},!0);else{var t={dataSourceSettings:g.getClonedDataSourceSettings(o.dataSourceSettings)};o.trigger(v,t),o.setProperties({dataSourceSettings:t.dataSourceSettings},!0),o.setProperties({dataSourceSettings:{drilledMembers:U}},!0),o.olapEngineModule.updateDrilledInfo(o.dataSourceSettings),o.allowServerDataBinding=!1,o.setProperties({pivotValues:o.olapEngineModule.pivotValues},!0),delete o.bulkChanges.pivotValues,o.allowServerDataBinding=!0;var i={dataSourceSettings:g.getClonedDataSourceSettings(t.dataSourceSettings),pivotValues:s.olapEngineModule.pivotValues};o.trigger(S,i),o.olapEngineModule.pivotValues=i.pivotValues,o.renderPivotGrid()}})}},n.prototype.onContentReady=function(){if(this.isPopupClicked=!1,this.showFieldList&&this.pivotFieldListModule?a.hideSpinner(this.pivotFieldListModule.fieldListSpinnerElement):this.fieldListSpinnerElement&&a.hideSpinner(this.fieldListSpinnerElement),this.isEmptyGrid?(this.isEmptyGrid=!1,this.notEmpty=!0):(("Server"===this.dataSourceSettings.mode&&this.isServerWaitingPopup||"Local"===this.dataSourceSettings.mode)&&this.hideWaitingPopup(),this.trigger(D)),this.grid){var e="pivot"===this.dataType?this.engineModule:this.olapEngineModule;if(this.enableVirtualization&&e){this.element.querySelector("."+ba)&&!this.element.querySelector("."+ba).querySelector("."+ya)&&(this.virtualDiv=t.createElement("div",{className:ya}),this.element.querySelector("."+ba).appendChild(this.virtualDiv)),this.element.querySelector("."+wa)&&!this.element.querySelector("."+wa).querySelector("."+ya)?(this.virtualHeaderDiv=t.createElement("div",{className:ya}),this.element.querySelector("."+wa).appendChild(this.virtualHeaderDiv)):this.virtualHeaderDiv=this.element.querySelector("."+wa).querySelector("."+ya);var i=this.element.querySelector("."+ba).querySelector(".e-table"),r=this.gridSettings.rowHeight*e.rowCount+.1-i.clientHeight;r>this.scrollerBrowserLimit&&(this.verticalScrollScale=r/this.scrollerBrowserLimit,r=this.scrollerBrowserLimit);var n=this.gridSettings.columnWidth*e.columnCount;n>this.scrollerBrowserLimit&&(this.horizontalScrollScale=n/this.scrollerBrowserLimit,n=this.scrollerBrowserLimit),t.setStyleAttribute(this.virtualDiv,{height:(r>.1?r:.1)+"px",width:(n>.1?n:.1)+"px"}),t.setStyleAttribute(this.virtualHeaderDiv,{height:0,width:(n>.1?n:.1)+"px"});var o=this.element.querySelector("."+ba),s=this.element.querySelector("."+xa),l=this.element.querySelector("."+wa);this.isAdaptive&&(o.parentElement.parentElement.querySelector("."+Ca).children[0].style.minHeight="1px",o.parentElement.parentElement.querySelector("."+Ca).style.minHeight="1px");var d=this.isAdaptive?o:o.parentElement.parentElement.querySelector("."+Ca),h=o.parentElement.scrollTop>this.scrollerBrowserLimit?o.querySelector("."+ji).style.transform.split(",")[1].trim():-(o.parentElement.scrollTop*this.verticalScrollScale-this.scrollPosObject.verticalSection-o.parentElement.scrollTop)+"px)",p=d.scrollLeft>this.scrollerBrowserLimit?o.querySelector("."+ji).style.transform.split(",")[0].trim()+",":"translate("+-(d.scrollLeft*this.horizontalScrollScale-this.scrollPosObject.horizontalSection-d.scrollLeft)+"px,";t.setStyleAttribute(s.querySelector(".e-table"),{transform:"translate(0px,"+h}),t.setStyleAttribute(o.querySelector(".e-table"),{transform:p+h}),t.setStyleAttribute(l.querySelector(".e-table"),{transform:p+0+"px)"}),t.isNullOrUndefined(this.resizedValue)||(this.element.querySelector(".e-frozenscrollbar").style.width=this.resizedValue+"px"),this.grid.element.querySelector(".e-movablechild").style.width=n+(o.parentElement.offsetWidth-o.parentElement.clientWidth)+"px";var u="pivot"===this.dataType&&"column"===this.dataSourceSettings.valueAxis?this.dataSourceSettings.values.length:1,c=this.pageSettings.columnSize*u*this.gridSettings.columnWidth,g=d.scrollWidth-(d.scrollLeft+d.offsetWidth);if(this.virtualscrollModule&&c>0&&g<=c&&d.scrollLeft>0){this.virtualDiv.style.display="none";var m=o.scrollWidth-(o.scrollLeft+o.offsetWidth);this.virtualDiv.style.display="";var f=o.scrollWidth-(o.scrollLeft+o.offsetWidth);this.scrollPosObject.horizontalSection-=g<=0?m>g?m:-f:f===m?m-g:m<f&&(g===f||g>m)?-(f-m):0,p=d.scrollLeft>this.scrollerBrowserLimit?o.querySelector("."+ji).style.transform.split(",")[0].trim()+",":"translate("+-(d.scrollLeft*this.horizontalScrollScale-this.scrollPosObject.horizontalSection-d.scrollLeft)+"px,",t.setStyleAttribute(o.querySelector(".e-table"),{transform:p+h}),t.setStyleAttribute(l.querySelector(".e-table"),{transform:p+0+"px)"})}"auto"!==this.grid.height?this.grid.contentModule.setHeightToContent(this.virtualDiv.offsetHeight+i.clientHeight):this.grid.contentModule.setHeightToContent(this.element.querySelector("."+xa+" ."+ji).offsetHeight)}"Chart"!==this.currentView&&this.grid.hideScroll(),this.showGroupingBar?(this.element.style.minWidth="400px",this.grid.element.style.minWidth="400px"):(this.element.style.minWidth="310px",this.grid.element.style.minWidth="310px")}this.unwireEvents(),this.wireEvents(),this.isChartLoaded=!1,this.actionObj.actionName=this.getActionCompleteName(),this.actionObj.actionName&&this.actionObj.actionName!==Ze&&this.actionCompleteMethod()},n.prototype.setToolTip=function(e){var i=Number(e.target.getAttribute("aria-colindex")),a=Number(e.target.getAttribute("index")),r=this.dataSourceSettings.values.length>0&&this.pivotValues&&this.pivotValues[a]&&this.pivotValues[a][i]?this.pivotValues[a][i]:void 0;this.tooltip.content="";var n,o,s=!1;if(r&&"olap"===this.dataType){var l=r.actualText;if(!t.isNullOrUndefined(l)&&this.olapEngineModule.fieldList&&!this.olapEngineModule.fieldList[l]){var d=this.olapEngineModule.tupRowInfo;l=r.rowOrdinal>-1&&d.length>0&&d[r.rowOrdinal]&&!t.isNullOrUndefined(d[r.rowOrdinal].measureName)?d[r.rowOrdinal].measureName:l}if(this.olapEngineModule.fieldList&&this.olapEngineModule.fieldList[l]){n=(h=this.olapEngineModule.fieldList[l]).isCalculatedField?h.type:h.aggregateType,o=this.olapEngineModule.dataFields[l]&&this.olapEngineModule.dataFields[l].caption?this.olapEngineModule.dataFields[l].caption:h.caption,s=!0}}else if(r&&this.engineModule.fieldList&&this.engineModule.fieldList[r.actualText]){var h;n="DistinctCount"===(n=(h=this.engineModule.fieldList[r.actualText]).aggregateType)||"number"===h.type&&"include"!==h.type&&"exclude"!==h.type?void 0===n?"Sum":h.aggregateType:"Count",o=h.caption,s=!0}if(r&&s){var p=this.getRowText(a,0),u=this.getColText(0,i,a),c="0"===r.formattedText||""===r.formattedText?this.localeObj.getConstant("noValue"):r.formattedText;if(this.tooltipTemplate&&void 0!==this.getTooltipTemplate()){var g={rowHeaders:p,columnHeaders:u,aggregateType:n,valueField:o,value:c,rowFields:this.getHeaderField(a,i,"row"),columnFields:this.getHeaderField(a,i,"column")};this.tooltip.content=this.getTooltipTemplate()(g,this,"tooltipTemplate",this.element.id+"tooltipTemplate")[0].outerHTML}else this.tooltip.content="<div class=e-pivottooltip><p class="+Hi+">"+this.localeObj.getConstant("row")+":</p><p class="+Bi+">"+p+"</p></br><p class="+Hi+">"+this.localeObj.getConstant("column")+":</p><p class="+Bi+">"+u+"</p></br>"+(""!==r.actualText?"<p class="+Hi+">"+("olap"===this.dataType?"":this.localeObj.getConstant(n)+" "+this.localeObj.getConstant("of")+" ")+o+":</p><p class="+Bi+">"+c+"</p></div>":"")}else e.cancel=!0},n.prototype.getTooltipTemplate=function(){return this.tooltipTemplateFn},n.prototype.getHeaderField=function(e,t,i){var a,r="",n="olap"===this.dataType?this.olapEngineModule:this.engineModule,o=n.valueSortSettings.headerDelimiter;if("row"===i){a=this.pivotValues[e][0].valueSort.levelName.toString().split(o).length;for(var s=0;s<a&&n.rows.length>0&&n.rows[s];s++)r+=(s?" - ":"")+(n.rows[s].caption?n.rows[s].caption:n.rows[s].name)}else{if(n.columns.length>0){var l=0===n.values.length?0:Number(Object.keys(n.headerContent)[Object.keys(n.headerContent).length-1]);a=this.pivotValues[l][t].valueSort.levelName.toString().split(o).length,a=n.values.length>1?a-1:a}for(var d=0;d<a&&n.columns.length>0&&n.columns[d];d++)r+=(d?" - ":"")+(n.columns[d].caption?n.columns[d].caption:n.columns[d].name)}return r},n.prototype.getLevel=function(e){var t=e.valueSort?e.valueSort.levelName.toString():"",i=e.actualText?e.actualText.toString().split(this.dataSourceSettings.valueSortSettings.headerDelimiter).length:0,a=t.split(this.dataSourceSettings.valueSortSettings.headerDelimiter).length-(i?i-1:i);return a?a-1:0},n.prototype.getRowText=function(e,i){var a=this.pivotValues[e][i],r=this.getLevel(a),n="grand sum"===a.type?this.localeObj.getConstant("grandTotal"):a.formattedText;if("row"===this.dataSourceSettings.valueAxis)return(n=0===this.dataSourceSettings.rows.length&&this.dataSourceSettings.values.length>1?this.pivotValues[e][0].valueSort.levelName.toString().slice((this.localeObj.getConstant("grandTotal")+this.dataSourceSettings.valueSortSettings.headerDelimiter).length).toString():1===this.dataSourceSettings.values.length?t.isNullOrUndefined(this.dataSourceSettings.values[0].caption)?this.dataSourceSettings.values[0].name:this.dataSourceSettings.values[0].caption:this.pivotValues[e][0].valueSort.levelName.toString()).split(this.dataSourceSettings.valueSortSettings.headerDelimiter).join(" - ");for(;r>0||void 0===a.index;)e--,void 0!==(a=this.pivotValues[e][i]).index&&r>a.level&&(n=n+" - "+a.formattedText,r-=1);return n.split(" - ").reverse().join(" - ")},n.prototype.getColText=function(e,t,i){for(var a=this.pivotValues[0][t],r=a.axis,n="grand sum"===a.type?this.localeObj.getConstant("grandTotal"):a.formattedText;"value"!==r&&i>e;)e++,this.pivotValues[e]&&(r=(a=this.pivotValues[e][t]).axis,"sum"!==a.type&&"grand sum"!==a.type&&"value"!==r&&(n=n+" - "+a.formattedText));return n},n.prototype.updateClass=function(){this.enableRtl?t.addClass([this.element],Mt):t.removeClass([this.element],Mt),this.isAdaptive?t.addClass([this.element],Dt):t.removeClass([this.element],Dt)},n.prototype.mouseRclickHandler=function(e){3===e.which?this.lastCellClicked=e.target:0===e.which&&(this.lastCellClicked=e.target),this.lastCellClicked=e.target},n.prototype.mouseDownHandler=function(e){if(3===e.which&&(this.lastCellClicked=e.target),this.isCellBoxMultiSelection){this.isMouseDown=!0,this.isMouseUp=!1;var t=this.parentAt(e.target,"TH");this.clearSelection(t,e,Number(t.getAttribute("aria-colindex")),Number(t.getAttribute("index"))),this.lastSelectedElement=void 0}},n.prototype.mouseMoveHandler=function(e){if(this.isCellBoxMultiSelection&&(e.preventDefault(),this.isMouseDown&&e.target)){var t=e.target,i=this.parentAt(t,"TH");this.lastSelectedElement&&this.lastSelectedElement!==i&&i.classList.contains(Ma)?(this.lastSelectedElement.classList.remove(Na),this.lastSelectedElement.classList.remove(Ma),this.lastSelectedElement=i):(this.lastSelectedElement=i,i.classList.add(Na),i.classList.add(Ma)),this.renderModule.selected()}},n.prototype.mouseUpHandler=function(e){this.isCellBoxMultiSelection&&(this.isMouseDown=!1,this.isMouseUp=!0)},n.prototype.parentAt=function(e,t){for(;e.tagName!==t&&e.parentElement;)e=e.parentElement;return e},n.prototype.mouseClickHandler=function(e){3===e.which?this.lastCellClicked=e.target:0===e.which&&(this.lastCellClicked=e.target);var t=e.target;if((t.classList.contains("e-headercell")||t.classList.contains("e-headercelldiv")||t.classList.contains("e-rowsheader")||t.classList.contains("e-rowcell")||t.classList.contains("e-stackedheadercelldiv")||t.classList.contains("e-headertext")||t.classList.contains("e-ascending")||t.classList.contains("e-descending"))&&this.enableValueSorting&&"pivot"===this.dataType){var i=null;t.classList.contains("e-headercell")||t.classList.contains("e-rowsheader")||t.classList.contains("e-rowcell")?i=t:t.classList.contains("e-stackedheadercelldiv")||t.classList.contains("e-headercelldiv")||t.classList.contains("e-ascending")||t.classList.contains("e-descending")?i=t.parentElement:t.classList.contains("e-headertext")&&(i=t.parentElement.parentElement),this.CellClicked(t,e);try{if(i.parentElement.parentElement.parentElement.parentElement.classList.contains("e-movableheader")&&"column"===this.dataSourceSettings.valueAxis||i.parentElement.classList.contains("e-row")&&"row"===this.dataSourceSettings.valueAxis&&(i.classList.contains("e-rowsheader")||i.classList.contains("e-stot"))){var a=t.parentElement.getAttribute("fieldname"),r=g.getFieldInfo(a,this);if(this.actionObj.actionName=ce,this.actionObj.fieldInfo=r.fieldItem,this.actionBeginMethod())return;var n=Number(i.getAttribute("aria-colindex")),o=Number(i.getAttribute("index"));if("row"===this.dataSourceSettings.valueAxis&&(this.dataSourceSettings.values.length>1||this.dataSourceSettings.alwaysShowValueHeader)){var s=this.pivotValues[o][n];if(-1===this.dataSourceSettings.valueIndex)o="value"===s.type?o:o+1;else{o=this.getLevel(s)<=this.engineModule.measureIndex&&s.members&&s.members.length>0?s.members[0].rowIndex:o}}else"column"===this.dataSourceSettings.valueAxis&&(this.dataSourceSettings.values.length>1||this.dataSourceSettings.alwaysShowValueHeader)&&(n=Number(i.getAttribute("aria-colindex"))+Number(i.getAttribute("aria-colspan"))-1,o=this.engineModule.headerContent.length-1);this.setProperties({dataSourceSettings:{valueSortSettings:{columnIndex:Number(i.getAttribute("aria-colindex"))+Number(i.getAttribute("aria-colspan"))-1,sortOrder:"Descending"===this.dataSourceSettings.valueSortSettings.sortOrder?"Ascending":"Descending",headerText:this.pivotValues[o][n].valueSort.levelName,headerDelimiter:this.dataSourceSettings.valueSortSettings.headerDelimiter?this.dataSourceSettings.valueSortSettings.headerDelimiter:"."}}},!0),this.showWaitingPopup();if(this.engineModule.enableValueSorting=!0,this.enableVirtualization){if(this.dataSourceSettings.enableSorting){for(var l=0,d=Object.keys(this.engineModule.fieldList);l<d.length;l++){var h=d[l];this.engineModule.fieldList[h].sort="Ascending"}this.setProperties({dataSourceSettings:{sortSettings:[]}},!0)}"Server"===this.dataSourceSettings.mode?this.getEngine("onValueSort",null,null,null,null,null,null):(this.engineModule.rMembers=this.engineModule.headerCollection.rowHeaders,this.engineModule.cMembers=this.engineModule.headerCollection.columnHeaders,this.engineModule.applyValueSorting(),this.engineModule.updateEngine())}else"Server"===this.dataSourceSettings.mode?this.getEngine("onValueSort",null,null,null,null,null,null):this.engineModule.generateGridData(this.dataSourceSettings,!0);this.allowServerDataBinding=!1,this.setProperties({pivotValues:this.engineModule.pivotValues},!0),delete this.bulkChanges.pivotValues,this.allowServerDataBinding=!0;var p={valueSortInfo:this.engineModule.valueSortSettings};this.actionObj.actionInfo=p,this.renderPivotGrid()}}catch(e){this.actionFailureMethod(e)}}else{if(!t.classList.contains(Ai)&&!t.classList.contains(Ri))return void this.CellClicked(t,e);var u=t.parentElement.getAttribute("fieldname"),c=(r=g.getFieldInfo(u,this),t.classList.contains(Ai)?this.actionObj.actionName="Drill up":t.classList.contains(Ri)?this.actionObj.actionName="Drill down":"");if(this.actionObj.actionName=c,this.actionObj.fieldInfo=r.fieldItem,this.actionBeginMethod())return;try{this.onDrill(t)}catch(e){this.actionFailureMethod(e)}}},n.prototype.updateTotColWidth=function(){this.totColWidth=0;for(var e=0,t=this.pivotColumns;e<t.length;e++){var i=t[e];this.totColWidth=this.totColWidth+i.width}},n.prototype.framePivotColumns=function(e){for(var t=0,i=e;t<i.length;t++){var a=i[t];if(a.columns&&a.columns.length>0)this.framePivotColumns(a.columns);else{var r="0.formattedText"===a.field?"":a.customAttributes?a.customAttributes.cell.valueSort.levelName:"",n=this.renderModule.setSavedWidth("0.formattedText"===a.field?a.field:r,Number("auto"===a.width?a.minWidth:a.width));this.pivotColumns.push({allowReordering:a.allowReordering,allowResizing:a.allowResizing,headerText:r,width:n,autoFit:a.autoFit}),this.totColWidth=this.totColWidth+Number(n)}}},n.prototype.setGridColumns=function(e){if(!t.isNullOrUndefined(this.totColWidth)&&this.totColWidth>0){for(var i=0,a=e;i<a.length;i++){var n=a[i];if(n.columns&&n.columns.length>0)this.setGridColumns(n.columns);else{var o="0.formattedText"===n.field?"":n.customAttributes?n.customAttributes.cell.valueSort.levelName:"";n.allowReordering=this.pivotColumns[this.posCount].allowReordering,n.allowResizing=this.pivotColumns[this.posCount].allowResizing,n.autoFit=this.pivotColumns[this.posCount].autoFit;var s=this.renderModule.setSavedWidth("0.formattedText"===n.field?n.field:o,Number(this.pivotColumns[this.posCount].width));"auto"!==n.width?n.width=s:n.minWidth=s,this.posCount++,n.allowReordering&&(this.gridSettings.allowReordering=!0),n.allowResizing&&(this.gridSettings.allowResizing=!0)}}this.gridSettings.allowReordering&&r.Grid.Inject(r.Reorder),this.gridSettings.allowResizing&&r.Grid.Inject(r.Resize)}},n.prototype.fillGridColumns=function(e){for(var t=0,i=e;t<i.length;t++){var a=i[t];a.allowReordering=this.gridSettings.allowReordering,a.allowResizing=this.gridSettings.allowResizing,this.posCount++,a.columns&&a.columns.length>0&&this.fillGridColumns(a.columns)}},n.prototype.triggerColumnRenderEvent=function(e){this.pivotColumns=[],this.totColWidth=0,this.framePivotColumns(e);var t=this.pivotColumns[0].width,i={columns:this.pivotColumns,dataSourceSettings:this.dataSourceSettings,stackedColumns:this.getStackedColumns(e,[])};this.trigger(N,i),this.enableVirtualization&&i.columns.length>0&&i.columns[0].width!==e[0].width&&(this.element.querySelector(".e-frozenscrollbar").style.width=Number(i.columns[0].width.toString().split("px")[0])+"px"),this.updateTotColWidth(),t!==this.pivotColumns[0].width&&(this.firstColWidth=this.pivotColumns[0].width,this.renderModule.resColWidth=parseInt(this.firstColWidth.toString())),this.posCount=0,this.setGridColumns(e)},n.prototype.setCommonColumnsWidth=function(e,t){for(var i=0,a=e;i<a.length;i++){var r=a[i];"0.formattedText"!==r.field?r.columns?this.setCommonColumnsWidth(r.columns,t):"auto"!==r.width?r.width=t:r.minWidth=t:r.width=this.firstColWidth?this.firstColWidth:r.width}},n.prototype.getHeightAsNumber=function(){var e;return isNaN(this.height)?this.height.toString().indexOf("%")>-1?e=parseFloat(this.height.toString())/100*this.element.offsetHeight:this.height.toString().indexOf("px")>-1&&(e=Number(this.height.toString().split("px")[0])):e=Number(this.height),e<this.minHeight&&(e=this.minHeight),e},n.prototype.getWidthAsNumber=function(){var e;return isNaN(this.width)?(this.width.toString().indexOf("%")>-1?e=parseFloat(this.width.toString())/100*this.element.offsetWidth:this.width.toString().indexOf("px")>-1&&(e=Number(this.width.toString().split("px")[0])),isNaN(e)&&(e=this.element.offsetWidth)):e=Number(this.width),e<400&&(e=400),e},n.prototype.getGridWidthAsNumber=function(){var e,t=this.element.offsetWidth?this.element.offsetWidth:this.element.getBoundingClientRect().width;return isNaN(this.grid.width)?(this.grid.width.toString().indexOf("%")>-1?e=parseFloat(this.grid.width.toString())/100*t:this.grid.width.toString().indexOf("px")>-1&&(e=Number(this.grid.width.toString().split("px")[0])),isNaN(e)&&(e=t)):e=Number(this.grid.width),e},n.prototype.onWindowResize=function(){this.actionObj.actionName=Ze,this.actionBeginMethod()||(clearTimeout(this.timeOutObj),this.timeOutObj=setTimeout(this.layoutRefresh.bind(this),500),this.actionObj.actionName=this.getActionCompleteName(),this.actionObj.actionName&&this.actionCompleteMethod())},n.prototype.refresh=function(){this.pivotRefresh()},n.prototype.layoutRefresh=function(){if(this.element&&this.element.classList.contains("e-pivotview")&&("olap"===this.dataType?this.olapEngineModule&&this.olapEngineModule.pivotValues:this.engineModule&&this.engineModule.pivotValues)){if(this.grid){var e="olap"===this.dataType&&this.olapEngineModule.pivotValues.length>0?this.olapEngineModule.pivotValues[0].length:this.dataSourceSettings.values.length>0&&this.engineModule.pivotValues.length>0?this.engineModule.pivotValues[0].length:2,t=this.renderModule.resizeColWidth(e);this.grid.width=this.renderModule.calculateGridWidth(),this.renderModule.calculateGridHeight(!0),this.gridSettings.allowAutoResizing&&this.setCommonColumnsWidth(this.grid.columns,t),this.pivotColumns=[],this.totColWidth=0,this.framePivotColumns(this.grid.columns),this.posCount=0,this.showGroupingBar||this.setGridColumns(this.grid.columns),this.grid.refreshColumns(),this.showGroupingBar&&this.groupingBarModule&&this.element.querySelector("."+pi)&&this.groupingBarModule.setGridRowWidth()}this.showToolbar&&this.toolbarModule&&this.toolbarModule.toolbar&&(this.toolbarModule.toolbar.width=this.grid?this.getGridWidthAsNumber()-2:this.getWidthAsNumber()-2),this.chart&&(this.showToolbar&&"Chart"===this.currentView||!this.showToolbar)&&(this.chart.width=this.showToolbar&&this.grid?this.getGridWidthAsNumber().toString():"Both"===this.displayOption.view&&this.grid?this.getGridWidthAsNumber().toString():this.getWidthAsNumber().toString(),"Chart"===this.displayOption.view&&this.showGroupingBar&&this.groupingBarModule&&this.element.querySelector("."+Ga)&&this.groupingBarModule.refreshUI())}},n.prototype.CellClicked=function(e,i){var a=this,r=null;if(e.classList.contains("e-headercell")||e.classList.contains("e-rowcell")?r=e:e.classList.contains("e-stackedheadercelldiv")||e.classList.contains("e-cellvalue")||e.classList.contains("e-headercelldiv")||e.classList.contains("e-sortfilterdiv")?r=e.parentElement:e.classList.contains("e-headertext")?r=e.parentElement.parentElement:e.classList.contains(Pa)&&(e.classList.contains(Ea)?this.isPopupClicked=!1:this.isPopupClicked=!0),r&&!t.isNullOrUndefined(this.pivotValues)&&this.pivotValues.length>0){var n=Number(r.getAttribute("aria-colindex")),o=Number(r.getAttribute("index")),s=Number(r.getAttribute("aria-colspan")),l={cancel:!1,isCellClick:!0,currentCell:r,data:this.pivotValues[o][n]};this.trigger(E,l,function(e){a.gridSettings.allowSelection&&(("Both"===a.gridSettings.selectionSettings.mode?r.classList.contains(Oa):"Row"===a.gridSettings.selectionSettings.mode)?a.clearSelection(r,i,n,o):(a.clearSelection(r,i,n,o),e.cancel||a.applyColumnSelection(i,r,n,n+(s>0?s-1:0),o)),"Column"===a.gridSettings.selectionSettings.mode||r.classList.contains(ki)||a.rowDeselect(r,i,o,a.gridSettings.selectionSettings.mode,e),"Column"===a.gridSettings.selectionSettings.mode||e.cancel||(("Multiple"===a.gridSettings.selectionSettings.type?i.ctrlKey||i.shiftKey:a.selectedRowIndex===o)?a.selectedRowIndex=void 0:(a.selectedRowIndex=o,a.grid.selectionModule.selectRow(o-a.renderModule.rowStartPos)))),a.cellClick&&e.isCellClick&&a.trigger("cellClick",{currentCell:r,data:a.pivotValues[o][n],nativeEvent:i}),a.getSelectedCellsPos()})}},n.prototype.rowDeselect=function(e,i,a,r,n){if(!i.shiftKey&&!i.ctrlKey&&"Both"!==this.gridSettings.selectionSettings.mode||"Single"===this.gridSettings.selectionSettings.type)if(e.classList.contains(Ta)||e.classList.contains(Ma)||e.classList.contains(Na)){if(t.removeClass(this.element.querySelectorAll("."+Ta),Ta),t.removeClass(this.element.querySelectorAll("."+Ma),Ma),t.removeClass(this.element.querySelectorAll("."+Na),Na),n.cancel)this.setSavedSelectedCells();else if("Cell"===r)t.addClass([e],[Ta]);else if("Row"===r||"Single"===this.gridSettings.selectionSettings.type){var o='[index="'+a+'"]';t.addClass(this.element.querySelectorAll(o),[Ma,Na]),"Row"!==r&&e.classList.add(Ta)}}else n.cancel?this.setSavedSelectedCells():(t.removeClass(this.element.querySelectorAll("."+Ta),Ta),t.removeClass(this.element.querySelectorAll("."+Ma),Ma),t.removeClass(this.element.querySelectorAll("."+Na),Na));else(i.shiftKey||i.ctrlKey||"Both"==this.gridSettings.selectionSettings.mode)&&n.cancel&&(t.removeClass(this.element.querySelectorAll("."+Ta),Ta),t.removeClass(this.element.querySelectorAll("."+Ma),Ma),t.removeClass(this.element.querySelectorAll("."+Na),Na),this.setSavedSelectedCells())},n.prototype.clearSelection=function(e,i,a,r){if(!i.shiftKey&&!i.ctrlKey||"Single"===this.gridSettings.selectionSettings.type)if("Cell"===this.gridSettings.selectionSettings.mode)e.classList.contains(ki)?t.removeClass(this.element.querySelectorAll(".e-rowcell."+Ta),Ta):t.removeClass(this.element.querySelectorAll("."+ki+"."+Na),[Na,Ma]);else if("Both"===this.gridSettings.selectionSettings.mode)if(e.classList.contains(Oa))for(var n=0,o=[].slice.call(this.element.querySelectorAll("."+Ma+", ."+Ta));n<o.length;n++){var s=o[n];t.removeClass([s],[Na,Ma,Ta])}else t.removeClass(this.element.querySelectorAll("."+Ta),Ta)},n.prototype.applyRowSelection=function(e,t,i){var a=this.engineModule.pivotValues[t][e];if(i.ctrlKey||i.shiftKey||!a||this.selectedRowIndex===t)this.selectedRowIndex=void 0;else{this.selectedRowIndex=t;var r=a.level,n=t;do{n++,a=this.engineModule.pivotValues[n][e]}while(a&&r<a.level);this.isAdaptive?this.rowRangeSelection={enable:!0,startIndex:t-this.renderModule.rowStartPos,endIndex:n-(1+this.renderModule.rowStartPos)}:this.grid.selectionModule.selectRowsByRange(t-this.renderModule.rowStartPos,n-(1+this.renderModule.rowStartPos))}},n.prototype.applyColumnSelection=function(e,i,a,r,n){if(!i.classList.contains(qi)&&("Cell"!==this.gridSettings.selectionSettings.mode||i.classList.contains(ki))){var o=e.ctrlKey;this.isAdaptive&&"Multiple"===this.gridSettings.selectionSettings.type&&(this.grid.selectionModule.showPopup(e),this.isPopupClicked?(this.element.querySelector("."+Pa).classList.add(Ea),o=!0):(this.element.querySelector("."+Pa).classList.remove(Ea),o=!1));for(var s=[],l=this.gridSettings.selectionSettings.type,d=i.classList.contains(Na),h=[],p={},u=a;u<=r;u++)h.push(u.toString());if(o&&"Single"!==l)d=!1;else{for(var c=0,g=[].slice.call(this.element.querySelectorAll("."+Na));c<g.length;c++){var m=g[c];t.removeClass([m],[Na,Ma]),-1===h.indexOf(m.getAttribute("aria-colindex"))&&(d=!1);var f=Number(m.getAttribute("aria-colindex"));p[f]=f}h=Object.keys(p).length>0?Object.keys(p).sort(function(e,t){return e-t}):h}"Multiple"===l&&e.shiftKey?(this.shiftLockedPos=0===this.shiftLockedPos.length?h:this.shiftLockedPos,Number(this.shiftLockedPos[0])<=a?a=Number(this.shiftLockedPos[0]):r=r<Number(this.shiftLockedPos[this.shiftLockedPos.length-1])?Number(this.shiftLockedPos[this.shiftLockedPos.length-1]):r):this.shiftLockedPos=[];var v=[];if(e.ctrlKey&&"Both"===this.gridSettings.selectionSettings.mode&&"Multiple"===l&&!i.classList.contains(qi))for(var S=0,y=[].slice.call(this.element.querySelectorAll("."+qi+"."+Ta));S<y.length;S++){m=y[S];v.push(m.getAttribute("index"))}for(var b=a;b<=r;)s.push('[aria-colindex="'+b+'"]'+("Cell"===this.gridSettings.selectionSettings.mode?'[index="'+n+'"]':"")),b++;if(!d){n=i.classList.contains("e-headercell")?n:this.renderModule.rowStartPos-1;for(var C=i.classList.contains(Na),x=0,w=[].slice.call(this.element.querySelectorAll(s.toString()));x<w.length;x++){m=w[x];Number(m.getAttribute("index"))>=n&&(C&&o&&-1===v.indexOf(m.getAttribute("index"))?t.removeClass([m],[Na,Ma]):t.addClass([m],[Na,Ma]))}}this.renderModule.selected()}},n.prototype.getSelectedCellsPos=function(){this.savedSelectedCellsPos=[],this.cellSelectionPos=[];for(var e=0,t=[].slice.call(this.element.querySelectorAll("."+Ma));e<t.length;e++){var i=t[e];this.savedSelectedCellsPos.push({rowIndex:i.getAttribute("index"),colIndex:i.getAttribute("aria-colindex")})}for(var a=0,r=[].slice.call(this.element.querySelectorAll("."+Ta));a<r.length;a++){i=r[a];this.cellSelectionPos.push({rowIndex:i.getAttribute("index"),colIndex:i.getAttribute("aria-colindex")})}},n.prototype.setSavedSelectedCells=function(){for(var e=0,i=[].slice.call(this.savedSelectedCellsPos);e<i.length;e++){var a='[aria-colindex="'+(o=i[e]).colIndex+'"][index="'+o.rowIndex+'"]';t.addClass([this.element.querySelector(a)],[Na,Ma])}for(var r=0,n=[].slice.call(this.cellSelectionPos);r<n.length;r++){var o;a='[aria-colindex="'+(o=n[r]).colIndex+'"][index="'+o.rowIndex+'"]';t.addClass([this.element.querySelector(a)],[Ta])}},n.prototype.renderEmptyGrid=function(){var e=this;if(this.isEmptyGrid=!0,this.notEmpty=!1,this.isInitial=!0,this.renderModule=this.renderModule?this.renderModule:new $a(this),this.grid&&this.grid.element&&this.element.querySelector(".e-grid"))this.notEmpty=!0,this.grid.setProperties({columns:this.renderModule.frameEmptyColumns(),dataSource:this.renderModule.frameEmptyData()},!0),this.grid.notify("datasource-modified",{}),this.grid.refreshColumns();else{this.element.querySelector(".e-grid")&&t.remove(this.element.querySelector(".e-grid")),this.renderModule.bindGrid(this,!0),this.grid.showSpinner=function(){},this.grid.hideSpinner=function(){};var i=t.createElement("div",{id:this.element.id+"_grid"});this.element.appendChild(i),this.grid.isStringTemplate=!0,this.grid.appendTo(i),this.grid.on("refresh-frozen-height",function(){e.enableVirtualization||e.grid.contentModule.setHeightToContent(e.grid.contentModule.getTable().offsetHeight)}),this.grid.off("data-ready",this.grid.dataReady),this.grid.on("data-ready",function(){e.grid.scrollModule.setWidth(),e.grid.scrollModule.setHeight()})}},n.prototype.initEngine=function(){var e=this;if("pivot"===this.dataType){var i=t.isNullOrUndefined(this.dataSourceSettings.dataSource)?t.isNullOrUndefined(this.engineModule.data)?void 0:this.engineModule.data[0]:this.dataSourceSettings.dataSource[0];if(i&&this.pivotCommon){var a="[object Array]"==Object.prototype.toString.call(i);if(a&&"JSON"===this.dataSourceSettings.type)return void this.pivotCommon.errorDialog.createErrorDialog(this.localeObj.getConstant("error"),this.localeObj.getConstant("invalidJSON"));if(!a&&"CSV"===this.dataSourceSettings.type)return void this.pivotCommon.errorDialog.createErrorDialog(this.localeObj.getConstant("error"),this.localeObj.getConstant("invalidCSV"))}}var r={dataSourceSettings:g.getClonedDataSourceSettings(this.dataSourceSettings)};this.trigger(v,r,function(t){g.updateDataSourceSettings(e,t.dataSourceSettings),e.updatePageSettings(!1);var i={mode:"",savedFieldList:void 0,pageSettings:e.pageSettings,enableValueSorting:e.enableValueSorting,isDrillThrough:e.allowDrillThrough||e.editSettings.allowEditing,localeObj:e.localeObj,fieldsType:e.fieldsType,clonedReport:e.clonedReport,globalize:e.globalize,currenyCode:e.currencyCode};if("pivot"===e.dataType){if(e.dataSourceSettings.groupSettings&&e.dataSourceSettings.groupSettings.length>0){var a=e.engineModule.data;e.clonedDataSet=e.clonedDataSet?e.clonedDataSet:g.getClonedData(a);var r=JSON.parse(e.getPersistData()).dataSourceSettings;r.dataSource=[],e.clonedReport=e.clonedReport?e.clonedReport:r}"Server"!==e.dataSourceSettings.mode&&e.engineModule.renderEngine(e.dataSourceSettings,i,e.getValueCellInfo.bind(e)),e.allowServerDataBinding=!1,e.setProperties({pivotValues:e.engineModule.pivotValues},!0),delete e.bulkChanges.pivotValues,e.allowServerDataBinding=!0,e.enginePopulatedEventMethod("initEngine")}else"SSAS"===e.dataSourceSettings.providerType&&"olap"===e.dataType&&(i.savedFieldList=e.olapEngineModule.fieldList,i.savedFieldListData=e.olapEngineModule.fieldListData,e.olapEngineModule.renderEngine(e.dataSourceSettings,i),e.allowServerDataBinding=!1,e.setProperties({pivotValues:e.olapEngineModule.pivotValues},!0),delete e.bulkChanges.pivotValues,e.allowServerDataBinding=!0,e.enginePopulatedEventMethod("initEngine"))})},n.prototype.enginePopulatedEventMethod=function(e,t){if("initEngine"===e){var i=t||this;this.trigger(S,{pivotValues:this.pivotValues},function(e){"olap"===i.dataType?(i.olapEngineModule.pivotValues=e.pivotValues,i.pivotValues=i.olapEngineModule.pivotValues):(i.engineModule.pivotValues=e.pivotValues,i.pivotValues=i.engineModule.pivotValues),i.notify(ne,{}),i.notEmpty=!0})}else{var a=t||this,r={dataSourceSettings:a.dataSourceSettings,pivotValues:a.pivotValues};a.trigger(S,r,function(e){a.dataSourceSettings.dataSource;a.dataSourceSettings=e.dataSourceSettings,"olap"===a.dataType?(a.olapEngineModule.pivotValues=e.pivotValues,a.allowServerDataBinding=!1,a.setProperties({pivotValues:a.olapEngineModule.pivotValues},!0),delete a.bulkChanges.pivotValues,a.allowServerDataBinding=!0):(a.engineModule.pivotValues=e.pivotValues,a.allowServerDataBinding=!1,a.setProperties({pivotValues:a.engineModule.pivotValues},!0),delete a.bulkChanges.pivotValues,a.allowServerDataBinding=!0),a.pivotCommon.engineModule="olap"===a.dataType?a.olapEngineModule:a.engineModule,a.pivotCommon.dataSourceSettings=a.dataSourceSettings,a.renderPivotGrid()})}},n.prototype.generateData=function(){this.isStaticRefresh||("Chart"!==this.displayOption.view?(this.renderEmptyGrid(),this.showWaitingPopup()):"Chart"===this.displayOption.view&&(this.showWaitingPopup(),clearTimeout(this.timeOutObj),this.timeOutObj=setTimeout(this.refreshData.bind(this),100)))},n.prototype.refreshData=function(){this.isStaticRefresh?(this.isStaticRefresh=!1,this.hideWaitingPopup()):this.dataSourceSettings&&(this.dataSourceSettings.dataSource||this.dataSourceSettings.url)?this.dataSourceSettings.dataSource instanceof i.DataManager?"pivot"===this.dataType&&this.remoteData.length>0?(this.element.querySelector(".e-spinner-pane")||this.showWaitingPopup(),this.engineModule.data=this.remoteData,this.initEngine()):setTimeout(this.getData.bind(this),100):""!==this.dataSourceSettings.url&&"olap"===this.dataType||this.dataSourceSettings.dataSource&&this.dataSourceSettings.dataSource.length>0||this.engineModule.data.length>0?("pivot"===this.dataType&&(this.hideWaitingPopup(),this.engineModule.data=this.dataSourceSettings.dataSource),this.initEngine()):"Server"===this.dataSourceSettings.mode?this.getEngine("onRefresh"):this.hideWaitingPopup():this.hideWaitingPopup()},n.prototype.getValueCellInfo=function(e){var t=e;return this.trigger(H,t),t},n.prototype.bindTriggerEvents=function(e){this.trigger(r.getObject("name",e),e)},n.prototype.getData=function(){this.dataSourceSettings.dataSource.defaultQuery?this.dataSourceSettings.dataSource.executeQuery(this.dataSourceSettings.dataSource.defaultQuery).then(this.executeQuery.bind(this)):this.dataSourceSettings.dataSource.executeQuery(new i.Query).then(this.executeQuery.bind(this))},n.prototype.executeQuery=function(e){this.element.querySelector(".e-spinner-pane")||this.showWaitingPopup();this.engineModule.data=e.result,!t.isNullOrUndefined(this.engineModule.data)&&this.engineModule.data.length>0?this.initEngine():this.hideWaitingPopup()},n.prototype.applyFormatting=function(e){if(e){for(var i=[],a=e.length,r=0;r<a;r++)void 0!==e[r]&&void 0===e[r][0]&&i.push(r);for(r=0;r<e.length;r++)for(var n=1;e[r]&&n<e[r].length;n++)if("value"===e[r][n].axis&&""!==e[r][n].formattedText){e[r][n].style=void 0,e[r][n].cssClass=void 0;for(var o=this.dataSourceSettings.conditionalFormatSettings,s=0;s<o.length;s++)(!0===o[s].applyGrandTotals||t.isNullOrUndefined(o[s].applyGrandTotals)||""!==e[r][n].rowHeaders&&""!==e[r][n].columnHeaders)&&this.checkCondition(e[r][n].value,o[s].conditions,o[s].value1,o[s].value2)&&(o[s].measure&&e[r][n].actualText!==o[s].measure||void 0!==o[s].measure&&""===o[s].measure||void 0!==o[s].label&&""===o[s].label||!(!o[s].label||e[r][0].valueSort.levelName.indexOf(o[s].label)>-1||e[r][n].rowHeaders.indexOf(o[s].label)>-1||e[r][n].columnHeaders.indexOf(o[s].label)>-1)||(o[s].style&&o[s].style.backgroundColor&&(o[s].style.backgroundColor=this.conditionalFormattingModule.isHex(o[s].style.backgroundColor.substr(1))?o[s].style.backgroundColor:this.conditionalFormattingModule.colourNameToHex(o[s].style.backgroundColor)),o[s].style&&o[s].style.color&&(o[s].style.color=this.conditionalFormattingModule.isHex(o[s].style.color.substr(1))?o[s].style.color:this.conditionalFormattingModule.colourNameToHex(o[s].style.color)),e[r][n].style=o[s].style,e[r][n].cssClass="format"+this.element.id+s))}var l=this.dataSourceSettings.conditionalFormatSettings;for(s=0;s<l.length;s++){var d=this.createStyleSheet.bind(this)(),h="color: "+l[s].style.color+"!important;background-color: "+l[s].style.backgroundColor+"!important;font-size: "+l[s].style.fontSize+"!important;font-family: "+l[s].style.fontFamily+" !important;",p=".format"+this.element.id+s;d.insertRule(p+", "+p+" .e-cellvalue{"+h+"}",0)}}},n.prototype.createStyleSheet=function(){var e=document.createElement("style");return e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet},n.prototype.applyHyperlinkSettings=function(){if(this.pivotValues){for(var e=this.pivotValues,i=[],a=e.length,r=0;r<a;r++)t.isNullOrUndefined(e[r])||void 0!==e[r][0]||i.push(r);if(this.hyperlinkSettings.conditionalSettings.length>0)for(r=0;r<e.length;r++)for(var n=1;e[r]&&n<e[r].length;n++)if("value"===e[r][n].axis){e[r][n].enableHyperlink=!1;for(var o=this.hyperlinkSettings.conditionalSettings,s=0;s<o.length;s++)if(this.checkCondition(e[r][n].value,o[s].conditions,o[s].value1,o[s].value2)){var l="row"===this.dataSourceSettings.valueAxis?r:"pivot"===this.dataType?this.engineModule.headerContent.length-1:this.olapEngineModule.headerContent.length-1,d="row"===this.dataSourceSettings.valueAxis?0:n;(!o[s].measure||1===this.dataSourceSettings.values.length||e[l][d].valueSort&&e[l][d].actualText===o[s].measure)&&(!o[s].label||e[i[o[s].label.split(".").length-1]]&&e[i[o[s].label.split(".").length-1]][n]&&e[i[o[s].label.split(".").length-1]][n].valueSort&&e[i[o[s].label.split(".").length-1]][n].valueSort[o[s].label]||e[r][0].valueSort.levelName.indexOf(o[s].label)>-1)&&(e[r][n].enableHyperlink=!0)}}if(t.isNullOrUndefined(this.hyperlinkSettings.headerText))return;var h=this.dataSourceSettings.valueSortSettings.headerDelimiter?this.dataSourceSettings.valueSortSettings.headerDelimiter:".";for(r=0;r<e.length;r++)for(n=1;e[r]&&n<e[r].length;n++)if("value"===e[r][n].axis){var p=this.hyperlinkSettings.headerText;if(e[r][0].valueSort.levelName.indexOf(p)>-1)e[r][0].enableHyperlink=!0,e[r][n].enableHyperlink=!0;else{var u=!1;for(s=0;s<i.length;s++)p=h+this.hyperlinkSettings.headerText,(h+e[i[s]][n].valueSort.levelName).indexOf(p)>-1&&(e[i[s]][n].enableHyperlink=!0,u=!0);e[r][n].enableHyperlink=u}}}},n.prototype.checkCondition=function(e,t,i,a){switch(t){case"LessThan":return e<i;case"LessThanOrEqualTo":return e<=i;case"GreaterThan":return e>i;case"GreaterThanOrEqualTo":return e>=i;case"Equals":return e===i;case"NotEquals":return e!==i;case"Between":return i<a&&e>=i&&e<=a||i>a&&e<=i&&e>=a;case"NotBetween":return!(i<a&&e>=i&&e<=a||i>a&&e<=i&&e>=a);default:return!1}},n.prototype.updateGroupingReport=function(e,i){if(!this.clonedDataSet&&!this.clonedReport){var a=this.engineModule.data;this.clonedDataSet=g.getClonedData(a);var r=JSON.parse(this.getPersistData()).dataSourceSettings;r.dataSource=[],this.clonedReport=this.clonedReport?this.clonedReport:r}var n=/_date_group_years|_date_group_quarters|_date_group_quarterYear|_date_group_months|_date_group_days|_date_group_hours|_date_group_minutes|_date_group_seconds/g,o=g.getClonedData(this.clonedDataSet),s=this.dataSourceSettings,l=this.clonedReport.properties?this.clonedReport.properties:this.clonedReport,d=[s.rows,s.columns,s.values,s.filters],h=[s.filterSettings,s.sortSettings,s.formatSettings,s.drilledMembers],p=l.rows;if(p=p.concat(l.columns,l.values,l.filters),0===e.length||e.length>0){this.engineModule.groupingFields={},this.setProperties({dataSourceSettings:{dataSource:o,groupSettings:e.length>0?s.groupSettings:[]}},!0);for(var u="Date"===i,c=[],m=0,f=d.length;m<f;m++)for(var v=0,S=d[m].length;v<S;v++){var y=d[m][v].name;-1===c.indexOf(y)&&c.push(y);var b=c.indexOf(y);g.getFieldByName(y,s.groupSettings);if(!t.isNullOrUndefined(y.match(n))&&u||-1!==y.indexOf("_custom_group")&&!g.getFieldByName(y.replace("_custom_group",""),s.groupSettings))d[m].splice(v,1),c.splice(b,1),v--,S--;else{var C=g.getFieldByName(y,p);C&&d[m].splice(v,1,C)}}for(var x=0,w=c;x<w.length;x++){y=w[x];var T=g.getFilterItemByName(y,l.filterSettings),M=g.getFieldByName(y,l.sortSettings),D=g.getFieldByName(y,l.formatSettings),O=g.getFieldByName(y,l.drilledMembers),N=[T,M,D,O];for(m=0,f=h.length;m<f;m++){var E=!1;for(v=0,S=h[m].length;v<S;v++){var P=h[m][v].name;if(!t.isNullOrUndefined(P.match(n))&&u||-1!==P.indexOf("_custom_group")&&!g.getFieldByName(P.replace("_custom_group",""),s.groupSettings))h[m].splice(v,1),v--,S--;else if(y===h[m][v].name){E=!0,N[m]?h[m].splice(v,1,N[m]):(h[m].splice(v,1),v--,S--);break}}!E&&0===m&&T&&h[m].push(T),!E&&1===m&&M&&h[m].push(M),!E&&2===m&&D&&h[m].push(D),!E&&3===m&&O&&h[m].push(O)}}}},n.prototype.removeButtonFocus=function(e){document.querySelectorAll(".e-btn-focused")&&t.removeClass(document.querySelectorAll(".e-btn-focused"),"e-btn-focused")},n.prototype.wireEvents=function(){"Chart"!==this.displayOption.view&&(t.EventHandler.add(this.element,this.isAdaptive?"touchend":"click",this.mouseClickHandler,this),t.EventHandler.add(this.element,"mousedown",this.mouseDownHandler,this),t.EventHandler.add(this.element.querySelector("."+Fa),"mousemove",this.mouseMoveHandler,this),t.EventHandler.add(this.element,"mouseup",this.mouseUpHandler,this),t.EventHandler.add(this.element,this.isAdaptive?"touchend":"contextmenu",this.mouseRclickHandler,this)),t.EventHandler.add(document,this.isAdaptive?"touchend":"click",this.removeButtonFocus,this),window.addEventListener("resize",this.onWindowResize.bind(this),!0)},n.prototype.unwireEvents=function(){"Chart"!==this.displayOption.view&&(t.EventHandler.remove(this.element,this.isAdaptive?"touchend":"click",this.mouseClickHandler),t.EventHandler.remove(this.element,"mousedown",this.mouseDownHandler),this.element.querySelector("."+Fa)&&t.EventHandler.remove(this.element.querySelector("."+Fa),"mousemove",this.mouseMoveHandler),t.EventHandler.remove(this.element,"mouseup",this.mouseUpHandler),t.EventHandler.remove(this.element,this.isAdaptive?"touchend":"contextmenu",this.mouseRclickHandler)),t.EventHandler.remove(document,this.isAdaptive?"touchend":"click",this.removeButtonFocus),window.removeEventListener("resize",this.onWindowResize.bind(this),!0)},n.prototype.actionBeginMethod=function(){var e={dataSourceSettings:g.getClonedDataSourceSettings(this.dataSourceSettings),actionName:this.actionObj.actionName,fieldInfo:this.actionObj.fieldInfo,cancel:!1};return this.trigger($,e),e.cancel},n.prototype.actionCompleteMethod=function(){var e={dataSourceSettings:g.getClonedDataSourceSettings(this.dataSourceSettings),actionName:this.actionObj.actionName,fieldInfo:this.actionObj.fieldInfo,actionInfo:this.actionObj.actionInfo};this.trigger(ee,e),this.actionObj.actionName="",this.actionObj.actionInfo=void 0,this.actionObj.fieldInfo=void 0},n.prototype.actionFailureMethod=function(e){var t={actionName:this.actionObj.actionName,errorInfo:e};this.trigger(te,t)},n.prototype.getActionCompleteName=function(){return this.actionObj.actionName==ye?ot:this.actionObj.actionName==be?st:this.actionObj.actionName==xe?lt:this.actionObj.actionName==we?dt:this.actionObj.actionName==Pe?ht:this.actionObj.actionName==Fe?pt:this.actionObj.actionName==Ie?ut:this.actionObj.actionName==Le?ct:this.actionObj.actionName==Ae?gt:this.actionObj.actionName==Re?mt:this.actionObj.actionName==je?ft:this.actionObj.actionName==ke?vt:this.actionObj.actionName==ce?"Value sorted":this.actionObj.actionName==ze?$e:this.actionObj.actionName==_e?St:this.actionObj.actionName==Ue?yt:this.actionObj.actionName==Ge?bt:this.actionObj.actionName==We?Ct:this.actionObj.actionName==Je?xt:this.actionObj.actionName==Qe?"Record edited":this.actionObj.actionName==He?"Report changed":this.actionObj.actionName==Ye?et:this.actionObj.actionName==Ke?tt:this.actionObj.actionName==Xe?"Record removed":this.actionObj.actionName==Me?"PNG exported":this.actionObj.actionName==Ne?"JPEG exported":this.actionObj.actionName==Ee?"SVG exported":this.actionObj.actionName==Te?"PDF exported":this.actionObj.actionName==Oe?"CSV exported":this.actionObj.actionName==De?"Excel exported":this.actionObj.actionName==Ze?"Window resized":this.actionObj.actionName==me?rt:this.actionObj.actionName==ge?nt:this.actionObj.actionName==fe?"Report re-saved":this.actionObj.actionName==ve?"Reportrenamed":this.actionObj.actionName},n.prototype.getStackedColumns=function(e,t){for(var i=0,a=e;i<a.length;i++){var r=a[i];t.push(r),r.columns&&r.columns.length>0&&this.getStackedColumns(r.columns,t)}return t},n.prototype.destroy=function(){this.removeInternalEvents(),this.engineModule&&(this.engineModule.fieldList={},this.engineModule.rMembers=null,this.engineModule.cMembers=null,this.engineModule.valueMatrix=null,this.engineModule.indexMatrix=null,this.engineModule={}),this.olapEngineModule&&(this.olapEngineModule.fieldList={},this.olapEngineModule={}),this.showGroupingBar&&this.groupingBarModule&&this.groupingBarModule.destroy(),this.allowGrouping&&this.groupingModule&&this.groupingModule.destroy(),this.showToolbar&&this.toolbarModule&&this.toolbarModule.destroy(),this.enableVirtualization&&this.virtualscrollModule&&this.virtualscrollModule.destroy(),this.allowConditionalFormatting&&this.conditionalFormattingModule&&this.conditionalFormattingModule.destroy(),this.allowNumberFormatting&&this.numberFormattingModule&&this.numberFormattingModule.destroy(),this.contextMenuModule&&this.contextMenuModule.destroy(),this.keyboardModule&&this.keyboardModule.destroy(),this.tooltip&&!this.tooltip.isDestroyed&&this.tooltip.destroy(),this.calculatedFieldModule&&this.calculatedFieldModule.destroy(),this.chart&&!this.chart.isDestroyed&&(this.chart.destroy(),this.chart.isDestroyed&&t.select("#"+this.element.id+"_chart",this.element)&&t.remove(t.select("#"+this.element.id+"_chart",this.element))),this.grid&&!this.grid.isDestroyed&&(this.grid.destroy(),this.grid.isDestroyed&&t.select("#"+this.element.id+"_grid",this.element)&&t.remove(t.select("#"+this.element.id+"_grid",this.element))),this.commonModule&&this.commonModule.destroy(),this.pivotChartModule&&this.pivotChartModule.destroy(),this.pivotButtonModule&&!this.pivotButtonModule.isDestroyed&&this.pivotButtonModule.destroy(),this.pivotFieldListModule&&!this.pivotFieldListModule.isDestroyed&&this.pivotFieldListModule.destroy(),(this.allowDrillThrough||this.editSettings&&this.editSettings.allowEditing)&&this.drillThroughModule&&this.drillThroughModule.destroy(),this.unwireEvents(),e.prototype.destroy.call(this),this.groupingBarModule&&(this.groupingBarModule=null),this.groupingModule&&(this.groupingModule=null),this.pivotFieldListModule&&(this.pivotFieldListModule=null),this.calculatedFieldModule&&(this.calculatedFieldModule=null),this.conditionalFormattingModule&&(this.conditionalFormattingModule=null),this.numberFormattingModule&&(this.numberFormattingModule=null),this.toolbarModule&&(this.toolbarModule=null),this.virtualscrollModule&&(this.virtualscrollModule=null),this.contextMenuModule&&(this.contextMenuModule=null),this.keyboardModule&&(this.keyboardModule=null),this.tooltip&&(this.tooltip=null),this.chart&&(this.chart=null),this.grid&&(this.grid=null),this.commonModule&&(this.commonModule=null),this.pivotChartModule&&(this.pivotChartModule=null),this.pivotButtonModule&&(this.pivotButtonModule=null),this.renderModule&&(this.renderModule=null),this.axisFieldModule&&(this.axisFieldModule=null),this.pdfExportModule&&(this.pdfExportModule=null),this.excelExportModule&&(this.excelExportModule=null),this.drillThroughModule&&(this.drillThroughModule=null),this.clonedDataSet&&(this.clonedDataSet=null),this.clonedReport&&(this.clonedReport=null),this.element.innerHTML="",t.removeClass([this.element],Tt),t.removeClass([this.element],Mt),t.removeClass([this.element],Dt)},n.prototype.showNumberFormattingDialog=function(){this.allowNumberFormatting&&this.numberFormattingModule.showNumberFormattingDialog()},n.prototype.getValuesHeader=function(e,i){var a=this.dataSourceSettings.values;return"value"===i&&!t.isNullOrUndefined(e.valueSort)&&this.localeObj.getConstant("grandTotal")+this.dataSourceSettings.valueSortSettings.headerDelimiter+e.formattedText===e.valueSort.levelName&&("column"===e.axis&&0===this.dataSourceSettings.columns.length&&"column"===this.dataSourceSettings.valueAxis||"row"===e.axis&&0===this.dataSourceSettings.rows.length&&"row"===this.dataSourceSettings.valueAxis)?this.localeObj.getConstant("total")+" "+this.localeObj.getConstant(this.engineModule.fieldList[e.actualText].aggregateType)+" "+this.localeObj.getConstant("of")+" "+e.formattedText:"grandTotal"===i&&1===a.length&&"row"===this.dataSourceSettings.valueAxis&&e.formattedText===this.localeObj.getConstant("grandTotal")?this.localeObj.getConstant("total")+" "+this.localeObj.getConstant(a[a.length-1].type)+" "+this.localeObj.getConstant("of")+" "+(t.isNullOrUndefined(a[a.length-1].caption)?a[a.length-1].name:a[a.length-1].caption):e.formattedText},mn([t.Property("USD")],n.prototype,"currencyCode",void 0),mn([t.Property(!1)],n.prototype,"showFieldList",void 0),mn([t.Complex({},wr)],n.prototype,"gridSettings",void 0),mn([t.Complex({},pn)],n.prototype,"chartSettings",void 0),mn([t.Complex({},fn)],n.prototype,"groupingBarSettings",void 0),mn([t.Complex({},yn)],n.prototype,"hyperlinkSettings",void 0),mn([t.Complex({},br)],n.prototype,"dataSourceSettings",void 0),mn([t.Complex({},vn)],n.prototype,"editSettings",void 0),mn([t.Complex({},bn)],n.prototype,"displayOption",void 0),mn([t.Property()],n.prototype,"pivotValues",void 0),mn([t.Property(!1)],n.prototype,"showGroupingBar",void 0),mn([t.Property(!0)],n.prototype,"showTooltip",void 0),mn([t.Property(!1)],n.prototype,"showToolbar",void 0),mn([t.Property([])],n.prototype,"toolbar",void 0),mn([t.Property(!1)],n.prototype,"showValuesButton",void 0),mn([t.Property(!1)],n.prototype,"allowCalculatedField",void 0),mn([t.Property(!1)],n.prototype,"enableValueSorting",void 0),mn([t.Property(!1)],n.prototype,"allowConditionalFormatting",void 0),mn([t.Property(!1)],n.prototype,"allowNumberFormatting",void 0),mn([t.Property("auto")],n.prototype,"height",void 0),mn([t.Property("auto")],n.prototype,"width",void 0),mn([t.Property(!1)],n.prototype,"allowExcelExport",void 0),mn([t.Property(!1)],n.prototype,"enableVirtualization",void 0),mn([t.Property(!1)],n.prototype,"allowDrillThrough",void 0),mn([t.Property(!1)],n.prototype,"allowPdfExport",void 0),mn([t.Property(!1)],n.prototype,"allowDeferLayoutUpdate",void 0),mn([t.Property(!1)],n.prototype,"allowDataCompression",void 0),mn([t.Property(1e3)],n.prototype,"maxNodeLimitInMemberEditor",void 0),mn([t.Property(1e4)],n.prototype,"maxRowsInDrillThrough",void 0),mn([t.Property(!0)],n.prototype,"loadOnDemandInMemberEditor",void 0),mn([t.Property(!0)],n.prototype,"enableHtmlSanitizer",void 0),mn([t.Property()],n.prototype,"cellTemplate",void 0),mn([t.Property()],n.prototype,"toolbarTemplate",void 0),mn([t.Property()],n.prototype,"tooltipTemplate",void 0),mn([t.Property()],n.prototype,"spinnerTemplate",void 0),mn([t.Property(!1)],n.prototype,"allowGrouping",void 0),mn([t.Property(!0)],n.prototype,"exportAllPages",void 0),mn([t.Property(["Sum","Count","DistinctCount","Product","Min","Max","Avg","Median","Index","PopulationVar","SampleVar","PopulationStDev","SampleStDev","RunningTotals","PercentageOfGrandTotal","PercentageOfColumnTotal","PercentageOfRowTotal","PercentageOfParentColumnTotal","PercentageOfParentRowTotal","DifferenceFrom","PercentageOfDifferenceFrom","PercentageOfParentTotal"])],n.prototype,"aggregateTypes",void 0),mn([t.Property(["Column","Bar","Line","Area","Scatter","Polar","StackingColumn","StackingArea","StackingBar","StepLine","StepArea","SplineArea","Spline","StackingColumn100","StackingBar100","StackingArea100","Bubble","Pareto","Radar","Pie","Doughnut","Funnel","Pyramid"])],n.prototype,"chartTypes",void 0),mn([t.Event()],n.prototype,"queryCellInfo",void 0),mn([t.Event()],n.prototype,"headerCellInfo",void 0),mn([t.Event()],n.prototype,"resizing",void 0),mn([t.Event()],n.prototype,"resizeStop",void 0),mn([t.Event()],n.prototype,"pdfHeaderQueryCellInfo",void 0),mn([t.Event()],n.prototype,"pdfQueryCellInfo",void 0),mn([t.Event()],n.prototype,"excelHeaderQueryCellInfo",void 0),mn([t.Event()],n.prototype,"excelQueryCellInfo",void 0),mn([t.Event()],n.prototype,"columnDragStart",void 0),mn([t.Event()],n.prototype,"columnDrag",void 0),mn([t.Event()],n.prototype,"columnDrop",void 0),mn([t.Event()],n.prototype,"beforePdfExport",void 0),mn([t.Event()],n.prototype,"beforeExcelExport",void 0),mn([t.Event()],n.prototype,"beforeColumnsRender",void 0),mn([t.Event()],n.prototype,"selected",void 0),mn([t.Event()],n.prototype,"cellDeselected",void 0),mn([t.Event()],n.prototype,"rowSelected",void 0),mn([t.Event()],n.prototype,"rowDeselected",void 0),mn([t.Event()],n.prototype,"chartTooltipRender",void 0),mn([t.Event()],n.prototype,"chartLoaded",void 0),mn([t.Event()],n.prototype,"chartLoad",void 0),mn([t.Event()],n.prototype,"chartResized",void 0),mn([t.Event()],n.prototype,"chartAxisLabelRender",void 0),mn([t.Event()],n.prototype,"multiLevelLabelClick",void 0),mn([t.Event()],n.prototype,"chartPointClick",void 0),mn([t.Event()],n.prototype,"contextMenuClick",void 0),mn([t.Event()],n.prototype,"contextMenuOpen",void 0),mn([t.Event()],n.prototype,"onPdfCellRender",void 0),mn([t.Event()],n.prototype,"saveReport",void 0),mn([t.Event()],n.prototype,"fetchReport",void 0),mn([t.Event()],n.prototype,"loadReport",void 0),mn([t.Event()],n.prototype,"renameReport",void 0),mn([t.Event()],n.prototype,"removeReport",void 0),mn([t.Event()],n.prototype,"newReport",void 0),mn([t.Event()],n.prototype,"toolbarRender",void 0),mn([t.Event()],n.prototype,"toolbarClick",void 0),mn([t.Event()],n.prototype,"load",void 0),mn([t.Event()],n.prototype,"enginePopulating",void 0),mn([t.Event()],n.prototype,"enginePopulated",void 0),mn([t.Event()],n.prototype,"onFieldDropped",void 0),mn([t.Event()],n.prototype,"fieldDrop",void 0),mn([t.Event()],n.prototype,"fieldDragStart",void 0),mn([t.Event()],n.prototype,"dataBound",void 0),mn([t.Event()],n.prototype,"created",void 0),mn([t.Event()],n.prototype,"destroyed",void 0),mn([t.Event()],n.prototype,"beforeExport",void 0),mn([t.Event()],n.prototype,"conditionalFormatting",void 0),mn([t.Event()],n.prototype,"memberFiltering",void 0),mn([t.Event()],n.prototype,"cellClick",void 0),mn([t.Event()],n.prototype,"drillThrough",void 0),mn([t.Event()],n.prototype,"editCompleted",void 0),mn([t.Event()],n.prototype,"beginDrillThrough",void 0),mn([t.Event()],n.prototype,"hyperlinkCellClick",void 0),mn([t.Event()],n.prototype,"cellSelecting",void 0),mn([t.Event()],n.prototype,"drill",void 0),mn([t.Event()],n.prototype,"cellSelected",void 0),mn([t.Event()],n.prototype,"chartSeriesCreated",void 0),mn([t.Event()],n.prototype,"aggregateCellInfo",void 0),mn([t.Event()],n.prototype,"fieldListRefreshed",void 0),mn([t.Event()],n.prototype,"memberEditorOpen",void 0),mn([t.Event()],n.prototype,"calculatedFieldCreate",void 0),mn([t.Event()],n.prototype,"numberFormatting",void 0),mn([t.Event()],n.prototype,"aggregateMenuOpen",void 0),mn([t.Event()],n.prototype,"fieldRemove",void 0),mn([t.Event()],n.prototype,"beforeServiceInvoke",void 0),mn([t.Event()],n.prototype,"actionBegin",void 0),mn([t.Event()],n.prototype,"actionComplete",void 0),mn([t.Event()],n.prototype,"actionFailure",void 0),n=mn([t.NotifyPropertyChanges],n)}(t.Component),xn=function(){function e(){}return e.getDefinedObj=function(e){var t=0,i={};if(null!==e&&void 0!==e)for(var a=Object.keys(e);t<a.length;)null!==e[a[t]]&&void 0!==e[a[t]]&&(i[a[t]]=e[a[t]]),t++;else i=e;return i},e.getClonedPivotValues=function(e){for(var t=[],i=0;i<e.length;i++)if(e[i]){t[i]=[];for(var a=0;a<e[i].length;a++)e[i][a]&&(t[i][a]=this.getClonedPivotValueObj(e[i][a]))}return t},e.getClonedPivotValueObj=function(e){var t=0,i={};if(null!==e&&void 0!==e)for(var a=Object.keys(e);t<a.length;)i[a[t]]=e[a[t]],t++;else i=e;return i},e.isContainCommonElements=function(e,t){for(var i=0,a=e.length;i<a;i++)for(var r=0,n=t.length;r<n;r++)if(t[r]===e[i])return!0;return!1},e.formatPdfHeaderFooter=function(e){var i=[];if(!t.isNullOrUndefined(e))for(var a=0;a<e.length;a++){var r=e[a],n={type:r.Type,pageNumberType:r.PageNumberType,style:r.Style?{penColor:r.Style.PenColor,penSize:r.Style.PenSize,dashStyle:r.Style.DashStyle,textBrushColor:r.Style.TextBrushColor,textPenColor:r.Style.TextPenColor,fontSize:r.Style.FontSize,hAlign:r.Style.HAlign,vAlign:r.Style.VAlign}:r.Style,points:null!==r.Points?{x1:r.Points.X1,y1:r.Points.Y1,x2:r.Points.X2,y2:r.Points.Y2}:null,format:r.Format,position:null!==r.Position?{x:r.Position.X,y:r.Position.Y}:null,size:null!==r.Size?{height:r.Size.Height,width:r.Size.Width}:null,src:r.Src,value:r.Value,font:r.Font};i.push(n)}return i},e.formatPdfExportProperties=function(e){return this.getDefinedObj({pageOrientation:"string"==typeof e.PageOrientation?e.PageOrientation:null,pageSize:"string"==typeof e.PageSize?e.PageSize:null,header:t.isNullOrUndefined(e.Header)?null:{fromTop:e.Header.FromTop,height:e.Header.Height,contents:this.formatPdfHeaderFooter(e.Header.Contents)},columns:e.Columns,footer:t.isNullOrUndefined(e.Footer)?null:{fromTop:e.Footer.FromBottom,height:e.Footer.Height,contents:this.formatPdfHeaderFooter(e.Footer.Contents)},includeHiddenColumn:e.IncludeHiddenColumn,dataSource:e.DataSource,exportType:"string"==typeof e.ExportType?e.ExportType:null,theme:t.isNullOrUndefined(e.Theme)?null:{header:e.Theme.Header,record:e.Theme.Record,caption:e.Theme.Caption},fileName:e.FileName,hierarchyExportMode:"string"==typeof e.HierarchyExportMode?e.HierarchyExportMode:null,allowHorizontalOverflow:e.AllowHorizontalOverflow})},e.formatExcelStyle=function(e){var i;return t.isNullOrUndefined(e)||(i=this.getDefinedObj({fontColor:e.FontColor,fontName:e.FontName,fontSize:e.FontSize,hAlign:e.HAlign===String?e.HAlign:null,vAlign:e.VAlign===String?e.VAlign:null,bold:e.Bold,indent:e.Indent,italic:e.Italic,underline:e.Underline,backColor:e.BackColor,wrapText:e.WrapText,borders:e.Borders,numberFormat:e.NumberFormat,type:e.Type})),i},e.formatExcelCell=function(e){if(!t.isNullOrUndefined(e))for(var i=0;i<e.length;i++)this.getDefinedObj({index:t.isNullOrUndefined(e[i].Index)?null:e[i].Index,colSpan:t.isNullOrUndefined(e[i].ColSpan)?null:e[i].ColSpan,value:t.isNullOrUndefined(e[i].Value)?null:e[i].Value,hyperlink:{target:t.isNullOrUndefined(e[i].Hyperlink)?null:e[i].Hyperlink.Target,displayText:t.isNullOrUndefined(e[i].Hyperlink)?null:e[i].Hyperlink.DisplayText},styles:this.formatExcelStyle(e[i].Style),rowSpan:t.isNullOrUndefined(e[i].RowSpan)?null:e[i].RowSpan});return[]},e.formatExcelHeaderFooter=function(e){var i=[];if(!t.isNullOrUndefined(e))for(var a=0;a<e.Rows.length;a++){var r=e.Rows[a],n=this.getDefinedObj({index:t.isNullOrUndefined(r.Index)?null:r.Index,cells:this.formatExcelCell(r.Cells),grouping:t.isNullOrUndefined(r.Grouping)?null:r.Grouping});i.push(n)}return i},e.formatExcelExportProperties=function(e){return this.getDefinedObj({dataSource:e.DataSource,query:e.Query,multipleExport:this.getDefinedObj({type:t.isNullOrUndefined(e.MultipleExport)?null:e.MultipleExport.Type,blankRows:t.isNullOrUndefined(e.MultipleExport)?null:e.MultipleExport.BlankRows}),header:this.getDefinedObj({headerRows:t.isNullOrUndefined(e.Header)?null:e.Header.HeaderRows,rows:this.formatExcelHeaderFooter(e.Header)}),footer:this.getDefinedObj({footerRows:t.isNullOrUndefined(e.Footer)?null:e.Footer.FooterRows,rows:this.formatExcelHeaderFooter(e.Footer)}),columns:e.Columns,exportType:"string"==typeof e.ExportType?e.ExportType:void 0,includeHiddenColumn:e.IncludeHiddenColumn,theme:t.isNullOrUndefined(e.Theme)?void 0:{header:this.formatExcelStyle(e.Theme.Header),record:this.formatExcelStyle(e.Theme.Record),caption:this.formatExcelStyle(e.Theme.Caption)},fileName:e.FileName,hierarchyExportMode:"string"==typeof e.HierarchyExportMode?e.HierarchyExportMode:void 0})},e}(),wn=function(){function e(e){this.actualrCnt=0,this.parent=e}return e.prototype.getModuleName=function(){return"excelExport"},e.prototype.addHeaderAndFooter=function(e,i,a,r){var n=[];if(t.isNullOrUndefined(e.rows))""!==i&&("footer"===a&&this.actualrCnt++,n.push({index:1,value:i}),this.rows.push({index:this.actualrCnt+1,cells:n}),this.actualrCnt="header"===a?this.actualrCnt+2:this.actualrCnt);else{this.actualrCnt="footer"===a?this.actualrCnt+r-e.rows[0].cells.length:this.actualrCnt;for(var o=e.rows,s=0;s<o.length;s++)for(var l=0;l<o[s].cells.length;l++)(n=[]).push({index:s+1,value:o[s].cells[l].value,colSpan:o[s].cells[l].colSpan,rowSpan:o[s].cells[l].rowSpan,style:o[s].cells[l].style}),this.actualrCnt++,this.rows.push({index:this.actualrCnt,cells:n});this.actualrCnt="header"===a?r:this.actualrCnt}},e.prototype.exportToExcel=function(e,i){this.rows=[],this.actualrCnt=0;var a=!t.isNullOrUndefined(i)&&!t.isNullOrUndefined(i.header),r=!t.isNullOrUndefined(i)&&!t.isNullOrUndefined(i.footer),n=!t.isNullOrUndefined(i)&&!t.isNullOrUndefined(i.fileName);this.engine="olap"===this.parent.dataType?this.parent.olapEngineModule:this.parent.engineModule;var o,s=xn.getClonedPivotValues(this.engine.pivotValues),l=n?i.fileName:"default.xlsx";if(this.parent.exportAllPages&&this.parent.enableVirtualization&&"olap"!==this.parent.dataType){var d=this.engine.pageSettings;this.engine.pageSettings=null,this.engine.generateGridData(this.parent.dataSourceSettings,!0),this.parent.applyFormatting(this.engine.pivotValues),o=xn.getClonedPivotValues(this.engine.pivotValues),this.engine.pivotValues=s,this.engine.pageSettings=d}else o=s;var h,p,c,g,m={fileName:l,header:"",footer:"",dataCollections:[o],excelExportProperties:i};this.parent.trigger(b,m,function(e){h=e.fileName,p=e.header,c=e.footer,g=e.dataCollections}),!a&&t.isNullOrUndefined(m.excelExportProperties)&&""!==p?this.addHeaderAndFooter({},p,"header",void 0):t.isNullOrUndefined(m.excelExportProperties)||t.isNullOrUndefined(m.excelExportProperties.header)||this.addHeaderAndFooter(m.excelExportProperties.header,"","header",m.excelExportProperties.header.headerRows);for(var f=[],v=0;v<g.length;v++){for(var S=g[v],y=0,x=S.length,T=this.parent.renderModule.getFormatList(),M=0,D=0;D<x;D++)if(S[D]){this.actualrCnt++,y=S[D].length;for(var O=[],N=0;N<y;N++)if(S[D][N]){var E=S[D][N],P="row"===this.parent.dataSourceSettings.valueAxis&&"olap"===this.parent.dataType&&E.rowOrdinal&&this.engine.tupRowInfo[E.rowOrdinal]?this.engine.tupRowInfo[E.rowOrdinal].measureName:E.actualText,F="row"==E.axis?{hAlign:"Left",bold:!0,wrapText:!0}:{numberFormat:T[P],bold:!1,wrapText:!0},I=s[D][N],L={bold:!0,vAlign:"Center",wrapText:!0,indent:0===N?10*E.level:0};if(-1!==E.level||E.rowSpan){var A="value"===E.axis?E.value:E.formattedText,R=0===this.parent.dataSourceSettings.rows.length&&"row"===this.parent.dataSourceSettings.valueAxis||0===this.parent.dataSourceSettings.columns.length&&"column"===this.parent.dataSourceSettings.valueAxis;if(A="grand sum"!==E.type||1===this.parent.dataSourceSettings.values.length&&"row"===this.parent.dataSourceSettings.valueAxis&&"column"===E.axis?"sum"===E.type?A.toString().replace("Total",this.parent.localeObj.getConstant("total")):!t.isNullOrUndefined(E.valueSort)&&this.parent.localeObj.getConstant("grandTotal")+this.parent.dataSourceSettings.valueSortSettings.headerDelimiter+E.formattedText===E.valueSort.levelName&&R?this.parent.getValuesHeader(E,"value"):A:R?this.parent.getValuesHeader(E,"grandTotal"):this.parent.localeObj.getConstant("grandTotal"),-1!==E.level||E.rowSpan){O.push({index:N+1,value:A,colSpan:E.colSpan,rowSpan:-1===E.rowSpan?1:E.rowSpan});var j=O[O.length-1];if("value"===E.axis)(isNaN(E.value)||""===E.formattedText||void 0===E.formattedText||t.isNullOrUndefined(E.value))&&(j.value="Excel"===e?null:""),j.style=t.isNullOrUndefined(j.value)?{bold:!1,wrapText:!0}:F;else if(j.style=L,"row"===E.axis&&0===N)if(j.style=F,"olap"===this.parent.dataType){var k=this.parent.renderModule.indentCollection[D];j.style.indent=2*k,M=M>k?M:k}else{var q=E.valueSort?E.valueSort.levelName.toString():"",V=E.actualText?E.actualText.toString().split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter).length:0,H=q.split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter).length-(V?V-1:V),B=H?H-1:0;j.style.indent=2*B,M=B>M?B:M}(E.style||j.style.backgroundColor||j.style.fontColor||j.style.fontName||j.style.fontSize)&&(j.style.backgroundColor=j.style.backgroundColor?j.style.backgroundColor:E.style.backgroundColor,j.style.fontColor=j.style.fontColor?j.style.fontColor:E.style.color,j.style.fontName=j.style.fontName?j.style.fontName:E.style.fontFamily,j.style.fontSize=j.style.fontSize?Number(j.style.fontSize):Number(E.style.fontSize.split("px")[0])),j.style.borders={color:"#000000",lineStyle:"Thin"};var _=void 0,U=void 0;"column"===E.axis?(_={style:L,cell:I},this.parent.trigger(C,_)):(U={style:F,cell:I,column:void 0,data:S,value:A},this.parent.trigger(w,U)),j.value="column"==E.axis?_.cell.formattedText:U.value,j.style="column"==E.axis?_.style:U.style}}N+=E.colSpan?E.colSpan-1:0}else{_=void 0;(E={formattedText:""})&&(_={style:void 0,cell:E},this.parent.trigger(C,_)),O.push({index:N+1,colSpan:1,rowSpan:1,value:E.formattedText,style:_.style})}this.rows.push({index:this.actualrCnt,cells:O})}r?this.addHeaderAndFooter(i.footer,"","footer",i.footer.footerRows):!r&&""!==c&&t.isNullOrUndefined(m.excelExportProperties)?this.addHeaderAndFooter({},c,"footer",void 0):t.isNullOrUndefined(m.excelExportProperties)||t.isNullOrUndefined(m.excelExportProperties.footer)||this.addHeaderAndFooter(m.excelExportProperties.footer,"","footer",m.excelExportProperties.footer.footerRows);var G=[];for(N=0;N<y;N++)G.push({index:N+1,width:100});M>0&&(G[0].width=100+20*M),f.push({columns:G,rows:this.rows})}var W=new u.Workbook({worksheets:f},"Excel"===e?"xlsx":"csv",void 0,this.parent.currencyCode);".xlsx"===h.substring(h.length-5,h.length)||".csv"===h.substring(h.length-4,h.length)?W.save(h):W.save(h+("Excel"===e?".xlsx":".csv"))},e.prototype.destroy=function(){},e}(),Tn=function(){function e(e){this.parent=e}return e.prototype.getModuleName=function(){return"pdfExport"},e.prototype.addPage=function(e){var i=e.document.pages.add(),a=e.args.pdfExportProperties,r=t.isNullOrUndefined(a)||t.isNullOrUndefined(a.header)||t.isNullOrUndefined(a.header.contents)||t.isNullOrUndefined(a.header.contents[0].value)?e.args.header:a.header.contents[0].value,n=t.isNullOrUndefined(a)||t.isNullOrUndefined(a.footer)||t.isNullOrUndefined(a.footer.contents)||t.isNullOrUndefined(a.footer.contents[0].value)?e.args.footer:a.footer.contents[0].value,o=new c.PdfStandardFont(c.PdfFontFamily.TimesRoman,15,c.PdfFontStyle.Regular),s=!(t.isNullOrUndefined(a)||t.isNullOrUndefined(a.header)||t.isNullOrUndefined(a.header.contents)||t.isNullOrUndefined(a.header.contents[0].style)),l=!(t.isNullOrUndefined(a)||t.isNullOrUndefined(a.footer)||t.isNullOrUndefined(a.footer.contents)||t.isNullOrUndefined(a.footer.contents[0].style)),d=s?this.hexDecToRgb(a.header.contents[0].style.textBrushColor):new c.PdfColor(0,0,0),h=s?new c.PdfSolidBrush(new c.PdfColor(d.r,d.g,d.b)):new c.PdfSolidBrush(new c.PdfColor(0,0,0)),p=l?this.hexDecToRgb(a.footer.contents[0].style.textBrushColor):new c.PdfColor(0,0,0),u=l?new c.PdfSolidBrush(new c.PdfColor(p.r,p.g,p.b)):new c.PdfSolidBrush(new c.PdfColor(0,0,0)),g=new c.PdfPen(new c.PdfColor(0,0,0),.5),m=new c.PdfPageTemplateElement(new c.RectangleF(0,0,i.graphics.clientSize.width,20));m.graphics.drawString(r,o,g,h,0,0,new c.PdfStringFormat(c.PdfTextAlignment.Center)),e.document.template.top=m;var f=new c.PdfPageTemplateElement(new c.RectangleF(0,0,i.graphics.clientSize.width,20));return f.graphics.drawString(n,o,g,u,0,0,new c.PdfStringFormat(c.PdfTextAlignment.Center)),e.document.template.bottom=f,i},e.prototype.hexDecToRgb=function(e){if(null===e||""===e||7!==e.length)throw new Error("please set valid hex value for color..");e=e.substring(1);var t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:255&t}},e.prototype.getFontStyle=function(e){var i=c.PdfFontStyle.Regular;return!t.isNullOrUndefined(e)&&e.bold&&(i|=c.PdfFontStyle.Bold),!t.isNullOrUndefined(e)&&e.italic&&(i|=c.PdfFontStyle.Italic),!t.isNullOrUndefined(e)&&e.underline&&(i|=c.PdfFontStyle.Underline),!t.isNullOrUndefined(e)&&e.strikeout&&(i|=c.PdfFontStyle.Strikeout),i},e.prototype.getBorderStyle=function(e){var i=new c.PdfBorders;if(t.isNullOrUndefined(e)){var a=new c.PdfColor(234,234,234);i.all=new c.PdfPen(a)}else{var r=e.width,n=t.isNullOrUndefined(r)||"number"!=typeof r?void 0:.75*r,o=new c.PdfColor(196,196,196);if(!t.isNullOrUndefined(e.color)){var s=this.hexDecToRgb(e.color);o=new c.PdfColor(s.r,s.g,s.b)}var l=new c.PdfPen(o,n);t.isNullOrUndefined(e.dashStyle)||(l.dashStyle=this.getDashStyle(e.dashStyle)),i.all=l}return i},e.prototype.getDashStyle=function(e){switch(e){case"Dash":return 1;case"Dot":return 2;case"DashDot":return 3;case"DashDotDot":return 4;default:return 0}},e.prototype.getStyle=function(){var e=new c.PdfBorders;if(t.isNullOrUndefined(this.gridStyle))return{brush:new c.PdfSolidBrush(new c.PdfColor),border:e,font:void 0};var i=t.isNullOrUndefined(this.gridStyle.header.fontName)?c.PdfFontFamily.Helvetica:this.getFontFamily(this.gridStyle.header.fontName),a=this.getFontStyle(this.gridStyle.header),r=t.isNullOrUndefined(this.gridStyle.header.fontSize)?10.5:this.gridStyle.header.fontSize,n=new c.PdfColor;if(!t.isNullOrUndefined(this.gridStyle.header.fontColor)){var o=this.hexDecToRgb(this.gridStyle.header.fontColor);n=new c.PdfColor(o.r,o.g,o.b)}var s=new c.PdfStandardFont(i,r,a);return t.isNullOrUndefined(this.gridStyle.header.font)||(s=this.gridStyle.header.font),{border:this.getBorderStyle(this.gridStyle.header.border),font:s,brush:new c.PdfSolidBrush(n)}},e.prototype.setRecordThemeStyle=function(e,i){if(!t.isNullOrUndefined(this.gridStyle)&&!t.isNullOrUndefined(this.gridStyle.record)){var a=t.isNullOrUndefined(this.gridStyle.record.fontName)?c.PdfFontFamily.Helvetica:this.getFontFamily(this.gridStyle.record.fontName),r=t.isNullOrUndefined(this.gridStyle.record.fontSize)?9.75:this.gridStyle.record.fontSize,n=this.getFontStyle(this.gridStyle.record),o=new c.PdfStandardFont(a,r,n);t.isNullOrUndefined(this.gridStyle.record.font)||(o=this.gridStyle.record.font),e.style.setFont(o);var s=new c.PdfColor;if(!t.isNullOrUndefined(this.gridStyle.record.fontColor)){var l=this.hexDecToRgb(this.gridStyle.record.fontColor);s=new c.PdfColor(l.r,l.g,l.b)}e.style.setTextBrush(new c.PdfSolidBrush(s))}var d=this.gridStyle&&this.gridStyle.record&&this.gridStyle.record.border?this.getBorderStyle(this.gridStyle.record.border):i;return e.style.setBorder(d),e},e.prototype.exportToPDF=function(e){this.engine="olap"===this.parent.dataType?this.parent.olapEngineModule:this.parent.engineModule;for(var i=this.applyEvent(),a=this.getStyle(),r=100+20*(this.parent.renderModule.maxIndent?this.parent.renderModule.maxIndent:5),n=Math.floor((540-r)/90)+1,o=0,s=i.args.dataCollections[o],l=0;i.args.allowRepeatHeader&&n>1&&l<s.length;l++)for(var d=n;s[l]&&d<s[l].length;d+=n)s[l].splice(d,0,s[l][0]);var h=s&&s.length>0?s[0].length:0,p=0;do{t.isNullOrUndefined(e)||(i.args.header=t.isNullOrUndefined(e.header)||t.isNullOrUndefined(e.header.contents)||t.isNullOrUndefined(e.header.contents[0].value)?i.args.header:e.header.contents[0].value,i.args.footer=t.isNullOrUndefined(e.footer)||t.isNullOrUndefined(e.footer.contents)||t.isNullOrUndefined(e.footer.contents[0].value)?i.args.footer:e.footer.contents[0].value);var u=this.addPage(i),g=new c.PdfGrid,m=n>1?n:5;if(s&&s.length>0){g.columns.add(s[0].length-p>=m?m:s[0].length-p);for(var f=s.length,v=0,S=0,y=0;y<f;y++)if(s[y]){var b=!(s[y][0]&&"row"===s[y][0].axis),C=s[y].length>p+m?p+m:s[y].length;b&&g.headers.add(1);var w=b?g.headers.getHeader(v):g.rows.addRow();b?(w.style.setBorder(a.border),a.font&&w.style.setFont(a.font),w.style.setTextBrush(a.brush)):this.setRecordThemeStyle(w,a.border);for(var D=0,O=!0,N=p;N<C;N++){var E=!1;if(s[y][N]){var P=(I=s[y][N]).formattedText;P=0===this.parent.dataSourceSettings.rows.length||0===this.parent.dataSourceSettings.columns.length?this.parent.getValuesHeader(I,"value"):P,P="grand sum"===I.type?0===this.parent.dataSourceSettings.rows.length||0===this.parent.dataSourceSettings.columns.length?this.parent.getValuesHeader(I,"grandTotal"):this.parent.localeObj.getConstant("grandTotal"):"sum"===I.type?P.toString().replace("Total",this.parent.localeObj.getConstant("total")):P,(-1!==I.level||I.rowSpan)&&((-1!==I.level||I.rowSpan)&&(w.cells.getCell(D).columnSpan=I.colSpan?m-D<I.colSpan?m-D:I.colSpan:1,b&&I.rowSpan&&I.rowSpan>1&&(w.cells.getCell(D).rowSpan=I.rowSpan?I.rowSpan:1),w.cells.getCell(D).value=P?P.toString():""),""!==P&&(O=!1)),S=I.level>S?I.level:S,E="value"===I.axis,N+=w.cells.getCell(D).columnSpan?w.cells.getCell(D).columnSpan-1:0,D+=w.cells.getCell(D).columnSpan?w.cells.getCell(D).columnSpan-1:0,I.style&&(w=this.applyStyle(w,I,D));var F={style:"column"==I.axis?{bold:!1}:I&&I.isSum||"row"==I.axis?{bold:!0}:void 0,pivotCell:I,cell:w.cells.getCell(D)};this.parent.trigger(M,F),"column"==I.axis?(F={style:F.style,cell:F.cell,gridCell:F.pivotCell},this.parent.trigger(x,F),w.cells.getCell(D).value=F.gridCell.formattedText?F.gridCell.formattedText:P):(F={style:F.style,cell:F.cell,column:void 0,data:F.pivotCell,value:P},this.parent.trigger(T,F),w.cells.getCell(D).value=F.value?F.value:P),F.style&&this.processCellStyle(w.cells.getCell(D),F)}else{F={style:void 0,pivotCell:void 0,cell:w.cells.getCell(D)};this.parent.trigger(M,F);var I;"column"==(I={formattedText:""}).axis&&(F={style:F.style,cell:F.cell,gridCell:F.pivotCell},this.parent.trigger(x,F)),F.style&&this.processCellStyle(w.cells.getCell(D),F),w.cells.getCell(D).value="",0===N&&b&&this.parent.dataSourceSettings.columns&&this.parent.dataSourceSettings.columns.length>0?g.headers.getHeader(0).cells.getCell(0).rowSpan++:0!==N&&b&&this.parent.dataSourceSettings.columns&&this.parent.dataSourceSettings.columns.length>0&&g.headers.getHeader(0).cells.getCell(0).rowSpan<Object.keys(this.engine.headerContent).length&&g.headers.getHeader(0).cells.getCell(0).rowSpan++}var L=new c.PdfStringFormat;if("olap"===this.parent.dataType){var A=!b&&0===D&&s[y][N]?this.parent.renderModule.indentCollection[s[y][N].rowIndex]:0;L.paragraphIndent=15*A,S=S>A?S:A}else if(L.paragraphIndent=0,!b&&0===D&&s[y][N]&&-1!==s[y][N].level){var R=s[y][N],j=R.valueSort?R.valueSort.levelName.toString():"",k=R.actualText?R.actualText.toString().split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter).length:0,q=j.split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter).length-(k?k-1:k),V=q?q-1:0;L.paragraphIndent=10*V}L.alignment=E?c.PdfTextAlignment.Right:c.PdfTextAlignment.Left,L.lineAlignment=c.PdfVerticalAlignment.Middle,w.cells.getCell(D).style.stringFormat=L,D++}O&&(w.height=16),v++}g.columns.getColumn(0).width=100+20*S}0===p&&this.parent.dataSourceSettings.columns&&this.parent.dataSourceSettings.columns.length>0&&g.headers.getHeader(0).cells.getCell(0).rowSpan--,g.draw(u,new c.PointF(10,20)),(p+=m)>=h&&i.args.dataCollections.length>o+1&&(o++,h=(s=i.args.dataCollections[o])&&s.length>0?s[0].length:0,p=0)}while(p<h);i.document.save(i.args.fileName+".pdf"),i.document.destroy()},e.prototype.applyStyle=function(e,t,i){var a=this.parent.conditionalFormattingModule.hexToRgb(t.style.backgroundColor),r=new c.PdfSolidBrush(new c.PdfColor(a.r,a.g,a.b));e.cells.getCell(i).style.backgroundBrush=r;var n=Number(t.style.fontSize.split("px")[0]),o=new c.PdfStandardFont(c.PdfFontFamily.TimesRoman,n,c.PdfFontStyle.Regular);return e.cells.getCell(i).style.font=o,a=this.parent.conditionalFormattingModule.hexToRgb(t.style.color),r=new c.PdfSolidBrush(new c.PdfColor(a.r,a.g,a.b)),e.cells.getCell(i).style.textBrush=r,e},e.prototype.getFontFamily=function(e){switch(e){case"TimesRoman":return 2;case"Courier":return 1;case"Symbol":return 3;case"ZapfDingbats":return 4;default:return 0}},e.prototype.getFont=function(e){if(e.style.font)return e.style.font;var i=e.cell.cellStyle.font&&e.cell.cellStyle.font.fontSize?e.cell.cellStyle.font.fontSize:t.isNullOrUndefined(e.style.fontSize)?9.75:.75*e.style.fontSize,a=t.isNullOrUndefined(e.style.fontFamily)?c.PdfFontFamily.TimesRoman:this.getFontFamily(e.style.fontFamily),r=c.PdfFontStyle.Regular;return!t.isNullOrUndefined(e.style.bold)&&e.style.bold&&(r|=c.PdfFontStyle.Bold),!t.isNullOrUndefined(e.style.italic)&&e.style.italic&&(r|=c.PdfFontStyle.Italic),!t.isNullOrUndefined(e.style.underline)&&e.style.underline&&(r|=c.PdfFontStyle.Underline),!t.isNullOrUndefined(e.style.strikeout)&&e.style.strikeout&&(r|=c.PdfFontStyle.Strikeout),new c.PdfStandardFont(a,i,r)},e.prototype.processCellStyle=function(e,i){if(!t.isNullOrUndefined(i.style.backgroundColor)){var a=this.hexDecToRgb(i.style.backgroundColor);e.style.backgroundBrush=new c.PdfSolidBrush(new c.PdfColor(a.r,a.g,a.b))}if(!t.isNullOrUndefined(i.style.textBrushColor)){var r=this.hexDecToRgb(i.style.textBrushColor);e.style.textBrush=new c.PdfSolidBrush(new c.PdfColor(r.r,r.g,r.b))}if(!t.isNullOrUndefined(i.style.textPenColor)){var n=this.hexDecToRgb(i.style.textPenColor);e.style.textPen=new c.PdfPen(new c.PdfColor(n.r,n.g,n.b))}if(t.isNullOrUndefined(i.style.fontFamily)&&t.isNullOrUndefined(i.style.fontSize)&&t.isNullOrUndefined(i.style.bold)&&t.isNullOrUndefined(i.style.italic)&&t.isNullOrUndefined(i.style.underline)&&t.isNullOrUndefined(i.style.strikeout)||(e.style.font=this.getFont(i)),!t.isNullOrUndefined(i.style.border)){var o=new c.PdfBorders,s=i.style.border.width,l=t.isNullOrUndefined(s)||"number"!=typeof s?void 0:.75*s,d=new c.PdfColor(196,196,196);if(!t.isNullOrUndefined(i.style.border.color)){var h=this.hexDecToRgb(i.style.border.color);d=new c.PdfColor(h.r,h.g,h.b)}var p=new c.PdfPen(d,l);t.isNullOrUndefined(i.style.border.dashStyle)||(p.dashStyle=this.getDashStyle(i.style.border.dashStyle)),o.all=p,e.style.borders=o}},e.prototype.applyEvent=function(){var e,t=this,i=xn.getClonedPivotValues(this.engine.pivotValues);if(this.parent.exportAllPages&&this.parent.enableVirtualization&&"olap"!==this.parent.dataType){var a=this.engine.pageSettings;this.engine.pageSettings=null,this.engine.generateGridData(this.parent.dataSourceSettings,!0),this.parent.applyFormatting(this.engine.pivotValues),e=xn.getClonedPivotValues(this.engine.pivotValues),this.engine.pivotValues=i,this.engine.pageSettings=a}else e=i;var r,n={fileName:"default",header:"",footer:"",dataCollections:[e],allowRepeatHeader:!0,style:void 0};this.parent.trigger(b,n,function(e){t.gridStyle=e.style,r=e});return{document:new c.PdfDocument,args:r}},e.prototype.destroy=function(){},e}(),Mn=function(){function e(e){this.parent=e}return e.prototype.render=function(){var e=t.createElement("div",{id:this.parent.element.id+"_Wrapper",className:Ft+" "+("olap"===this.parent.dataType?"e-olapfieldlist-wrapper":""),styles:"width:"+this.parent.element.style.width});this.parent.isAdaptive?t.addClass([e],Dt):t.removeClass([e],Dt),this.parent.enableRtl?t.addClass([e],Mt):t.removeClass([e],Mt),this.parent.cssClass&&t.addClass([e],this.parent.cssClass),this.parentElement=t.createElement("div",{className:"e-field-list-container"}),this.parent.element.appendChild(e),this.parent.isAdaptive&&(e.removeAttribute("style"),this.parentElement=t.createElement("div",{className:"e-adaptive-container"}),this.renderAdaptiveLayout(e)),"Popup"===this.parent.renderMode?(this.renderFieldListDialog(e),this.unWireDialogEvent(this.parent.element.querySelector("."+It)),this.wireDialogEvent(this.parent.element.querySelector("."+It))):this.renderStaticLayout(e)},e.prototype.renderStaticLayout=function(e){if(!this.parent.isAdaptive){var i=t.createElement("div",{className:"e-field-list-title"}),a=t.createElement("div",{className:"e-title-content",innerHTML:this.parent.localeObj.getConstant("staticFieldList")});i.appendChild(a),i.appendChild(this.createCalculatedButton()),t.addClass([e],"e-static"),e.appendChild(i),e.appendChild(this.parentElement),t.addClass([e],"e-static"),this.parent.allowDeferLayoutUpdate&&(e.appendChild(this.createDeferUpdateButtons()),this.renderDeferUpdateButtons())}},e.prototype.renderDeferUpdateButtons=function(){this.parent.allowDeferLayoutUpdate&&(this.deferUpdateCheckBox=new h.CheckBox({label:this.parent.localeObj.getConstant("deferLayoutUpdate"),checked:!0,enableRtl:this.parent.enableRtl,locale:this.parent.locale,change:this.onCheckChange.bind(this)}),this.deferUpdateCheckBox.isStringTemplate=!0,this.deferUpdateCheckBox.appendTo("#"+this.parent.element.id+"DeferUpdateCheckBox"),this.deferUpdateApplyButton=new h.Button({cssClass:"e-defer-apply-button e-defer-update-btn"+("Popup"===this.parent.renderMode?" e-flat":""),content:this.parent.localeObj.getConstant("apply"),enableRtl:this.parent.enableRtl,locale:this.parent.locale,isPrimary:!0}),this.deferUpdateApplyButton.isStringTemplate=!0,this.deferUpdateApplyButton.appendTo("#"+this.parent.element.id+"_DeferUpdateButton1"),this.deferUpdateApplyButton.element.onclick="Fixed"===this.parent.renderMode?this.applyButtonClick.bind(this):this.onDeferUpdateClick.bind(this)),this.deferUpdateCancelButton=new h.Button({cssClass:"e-defer-cancel-button "+ri+("Popup"===this.parent.renderMode?" e-flat":""),content:this.parent.allowDeferLayoutUpdate?this.parent.localeObj.getConstant("cancel"):this.parent.localeObj.getConstant("close"),enableRtl:this.parent.enableRtl,isPrimary:!this.parent.allowDeferLayoutUpdate,locale:this.parent.locale}),this.deferUpdateCancelButton.isStringTemplate=!0,this.deferUpdateCancelButton.appendTo("#"+this.parent.element.id+"_DeferUpdateButton2"),this.deferUpdateCancelButton.element.onclick="Fixed"===this.parent.renderMode?this.cancelButtonClick.bind(this):this.onCloseFieldList.bind(this)},e.prototype.createDeferUpdateButtons=function(){var e=t.createElement("div",{className:"e-layout-footer"});if(this.parent.allowDeferLayoutUpdate){var i=t.createElement("div",{className:"e-checkbox-layout",attrs:{title:this.parent.localeObj.getConstant("deferLayoutUpdate")}}),a=t.createElement("input",{id:this.parent.element.id+"DeferUpdateCheckBox"});i.appendChild(a),e.appendChild(i)}var r=t.createElement("div",{className:"e-button-layout"});if(this.parent.allowDeferLayoutUpdate){var n=t.createElement("button",{id:this.parent.element.id+"_DeferUpdateButton1",attrs:{type:"button",title:this.parent.localeObj.getConstant("apply")}});r.appendChild(n)}var o=t.createElement("button",{id:this.parent.element.id+"_DeferUpdateButton2",attrs:{type:"button",title:this.parent.localeObj.getConstant("cancel")}});return r.appendChild(o),e.appendChild(r),e},e.prototype.onCheckChange=function(e){e.checked&&(this.parent.clonedDataSource=t.extend({},this.parent.dataSourceSettings,null,!0),this.parent.clonedFieldList=t.extend({},this.parent.pivotFieldList,null,!0)),this.parent.allowDeferLayoutUpdate=!this.parent.allowDeferLayoutUpdate,"Fixed"===this.parent.renderMode?(this.deferUpdateApplyButton.setProperties({disabled:!this.parent.allowDeferLayoutUpdate}),this.deferUpdateCancelButton.setProperties({disabled:!this.parent.allowDeferLayoutUpdate})):this.parent.allowDeferLayoutUpdate?(this.deferUpdateApplyButton.element.style.display="",this.deferUpdateCancelButton.setProperties({content:this.parent.localeObj.getConstant("cancel")}),this.deferUpdateCancelButton.isPrimary=!1):(this.deferUpdateApplyButton.element.style.display="none",this.deferUpdateCancelButton.setProperties({content:this.parent.localeObj.getConstant("close")}),this.deferUpdateCancelButton.isPrimary=!0),this.cancelButtonClick()},e.prototype.applyButtonClick=function(){"pivotfieldlist"===this.parent.getModuleName()&&this.parent.allowDeferLayoutUpdate&&(this.parent.pivotChange=!1),this.parent.updateDataSource(!1);var e=this.parent;e.axisFieldModule.render(),e.clonedDataSource=t.extend({},e.dataSourceSettings,null,!0),e.clonedFieldList=t.extend({},e.pivotFieldList,null,!0)},e.prototype.cancelButtonClick=function(){if(this.parent.setProperties({dataSourceSettings:this.parent.clonedDataSource.properties},!0),"olap"===this.parent.dataType){this.parent.olapEngineModule.fieldList=t.extend({},this.parent.clonedFieldList,null,!0);for(var e=0,i=Object.keys(this.parent.clonedFieldList);e<i.length;e++){var a=i[e],r=this.parent.clonedFieldList[a];this.parent.olapEngineModule.updateFieldlistData(r.id,r.isSelected)}}else this.parent.engineModule.fieldList=t.extend({},this.parent.clonedFieldList,null,!0);this.parent.updateDataSource(!1,!0)},e.prototype.renderFieldListDialog=function(e){var i=t.createElement("div",{className:It+" "+Ot+" e-select-table",attrs:{tabindex:"0",title:this.parent.localeObj.getConstant("fieldList"),"aria-disabled":"false","aria-label":this.parent.localeObj.getConstant("fieldList")}});if(this.parent.element.appendChild(i),this.parent.isAdaptive){var r='<div class=e-title-mobile-header><span class="e-icons '+Da+'"></span><div class=e-title-mobile-content>'+this.parent.localeObj.getConstant("fieldList")+"</div></div>",n=[{click:this.showFieldListDialog.bind(this),buttonModel:{cssClass:bi+" e-small e-round",iconCss:Ot+" "+xi,isPrimary:!0}},{click:this.showCalculatedField.bind(this),buttonModel:{cssClass:Ci+" e-small e-round "+Nt,iconCss:Ot+" "+xi,enableRtl:this.parent.enableRtl,isPrimary:!0}}];this.fieldListDialog=new a.Dialog({animationSettings:{effect:this.parent.enableRtl?"SlideRight":"SlideLeft"},header:r,content:this.parentElement,isModal:!0,showCloseIcon:!1,visible:!1,allowDragging:!1,closeOnEscape:!1,enableRtl:this.parent.enableRtl,locale:this.parent.locale,width:"100%",height:"100%",position:{X:"center",Y:"center"},buttons:n,target:document.body,close:this.removeFieldListIcon.bind(this),open:this.dialogOpen.bind(this)}),this.fieldListDialog.isStringTemplate=!0,this.fieldListDialog.appendTo(e),t.setStyleAttribute(t.select("#"+e.id+"_dialog-content",e),{padding:"0"});var o=e.querySelector(".e-footer-content");t.addClass([o],Rt),t.removeClass([o.querySelector("."+Ci)],"e-flat"),t.removeClass([o.querySelector("."+bi)],"e-flat"),this.fieldListDialog.element.querySelector("."+Da).onclick=this.parent.allowDeferLayoutUpdate?this.onDeferUpdateClick.bind(this):this.onCloseFieldList.bind(this)}else{var s=this.createDeferUpdateButtons().outerHTML;r="<div class=e-title-header><div class=e-title-content>"+this.parent.localeObj.getConstant("fieldList")+"</div></div>";this.fieldListDialog=new a.Dialog({animationSettings:{effect:"Zoom"},header:r,content:this.parentElement,isModal:!1,showCloseIcon:!1,visible:!1,allowDragging:!0,enableRtl:this.parent.enableRtl,locale:this.parent.locale,width:this.parent.element.style.width,position:{X:"center",Y:this.parent.element.offsetTop},footerTemplate:s,closeOnEscape:!1,target:t.isNullOrUndefined(this.parent.target)?document.body:"string"==typeof this.parent.target?document.querySelector(this.parent.target):this.parent.target,close:this.removeFieldListIcon.bind(this)}),this.fieldListDialog.isStringTemplate=!0,this.fieldListDialog.appendTo(e),this.renderDeferUpdateButtons(),t.setStyleAttribute(t.select("#"+e.id+"_title",e),{width:"100%"}),e.querySelector(".e-title-header").appendChild(this.createCalculatedButton())}},e.prototype.dialogOpen=function(){this.adaptiveElement.refresh()},e.prototype.updateDataSource=function(e){for(var t=["filters","columns","rows","values"],i=0,a=e;i<a.length;i++){var r=a[i],n=t[this.adaptiveElement.selectedItem];this.parent.pivotCommon.dataSourceUpdate.control="pivotview"===this.parent.getModuleName()?this.parent:this.parent.pivotGridModule?this.parent.pivotGridModule:this.parent,this.parent.pivotCommon.dataSourceUpdate.updateDataSource(r,n,-1)}this.parent.axisFieldModule.render(),this.parent.allowDeferLayoutUpdate?this.parent.triggerPopulateEvent():this.parent.updateDataSource(!0)},e.prototype.onDeferUpdateClick=function(){this.parent.updateDataSource(),this.parent.dialogRenderer.fieldListDialog.hide()},e.prototype.renderAdaptiveLayout=function(e){var i=t.createElement("div",{className:Rt});e.appendChild(this.parentElement);var a=[{header:{text:this.parent.localeObj.getConstant("filters")},content:this.createAxisTable("filters")},{header:{text:this.parent.localeObj.getConstant("columns")},content:this.createAxisTable("columns")},{header:{text:this.parent.localeObj.getConstant("rows")},content:this.createAxisTable("rows")},{header:{text:this.parent.localeObj.getConstant("values")},content:this.createAxisTable("values")},{header:{text:this.parent.localeObj.getConstant("createCalculatedField")},content:"Calculated Field Related UI"}];this.parent.allowCalculatedField||a.pop(),this.adaptiveElement=new n.Tab({heightAdjustMode:"Auto",items:a,height:"100%",enableRtl:this.parent.enableRtl,locale:this.parent.locale,selected:this.tabSelect.bind(this)}),"Fixed"===this.parent.renderMode?(i.appendChild(this.createAddButton()),t.addClass([e],"e-static"),this.adaptiveElement.isStringTemplate=!0,this.adaptiveElement.appendTo(this.parentElement),this.parentElement.appendChild(i)):(this.adaptiveElement.isStringTemplate=!0,this.adaptiveElement.appendTo(this.parentElement))},e.prototype.tabSelect=function(e){var i=t.closest(this.parentElement,"."+Ft);i&&i.querySelector("."+bi)&&(4!==e.selectedIndex?(t.addClass([i.querySelector("."+Ci)],Nt),t.removeClass([i.querySelector("."+bi)],Nt)):(t.removeClass([i.querySelector("."+Ci)],Nt),t.addClass([i.querySelector("."+bi)],Nt))),4===e.selectedIndex?(this.adaptiveElement.items[4].content="",this.adaptiveElement.dataBind(),this.parent.notify(de,{})):this.parent.axisFieldModule.render()},e.prototype.createCalculatedButton=function(){var e=t.createElement("button",{id:this.parent.element.id+"_CalculatedField",attrs:{type:"button",tabindex:"0","aria-disabled":"false","aria-label":this.parent.localeObj.getConstant("CalculatedField")}}),i=new h.Button({cssClass:"e-calculated-field "+Nt,content:this.parent.localeObj.getConstant("CalculatedField"),enableRtl:this.parent.enableRtl,locale:this.parent.locale});return i.isStringTemplate=!0,i.appendTo(e),this.parent.calculatedFieldModule&&t.removeClass([e],Nt),i.element.onclick=this.showCalculatedField.bind(this),e},e.prototype.createAddButton=function(){var e=t.createElement("div",{className:Rt+"-content"}),i=t.createElement("div",{}),a=t.createElement("div",{}),r=new h.Button({cssClass:Ci+" e-small e-round "+Nt,iconCss:Ot+" "+xi,enableRtl:this.parent.enableRtl,locale:this.parent.locale}),n=new h.Button({cssClass:bi+" e-small e-round",iconCss:Ot+" "+xi,enableRtl:this.parent.enableRtl,locale:this.parent.locale});return n.isStringTemplate=!0,n.appendTo(i),r.isStringTemplate=!0,r.appendTo(a),e.appendChild(i),e.appendChild(a),r.element.onclick=this.showCalculatedField.bind(this),n.element.onclick=this.showFieldListDialog.bind(this),e},e.prototype.createAxisTable=function(e){var i=t.createElement("div",{className:Lt+"-"+e}),a=t.createElement("div",{className:Vt+" e-"+e}),r=t.createElement("span",{className:Ht,innerHTML:this.parent.localeObj.getConstant("addPrompt")});return i.appendChild(a),i.appendChild(r),i},e.prototype.showCalculatedField=function(e){try{if(!this.parent.isAdaptive){if(this.parent.actionObj.actionName=ze,this.parent.actionBeginMethod())return;this.parent.dialogRenderer.fieldListDialog&&(this.parent.dialogRenderer.fieldListDialog.hide(),t.addClass([this.parent.element.querySelector("."+It)],Et))}this.parent.notify(de,{})}catch(e){this.parent.actionFailureMethod(e)}},e.prototype.showFieldListDialog=function(e){var t=this.adaptiveElement.selectedItem;this.parent.treeViewModule.render(t)},e.prototype.onShowFieldList=function(){if(this.parent.actionObj.actionName=Ce,!this.parent.actionBeginMethod()){this.parent.actionObj.actionName="";try{this.parent.allowDeferLayoutUpdate&&(this.parent.isAdaptive&&this.parent.axisFieldModule.render(),this.parent.clonedDataSource=t.extend({},this.parent.dataSourceSettings,null,!0),this.parent.clonedFieldList=t.extend({},this.parent.pivotFieldList,null,!0)),t.addClass([this.parent.element.querySelector("."+It)],Et),this.parent.dialogRenderer.fieldListDialog.show(),this.parent.dialogRenderer.fieldListDialog.element.style.top=parseInt(this.parent.dialogRenderer.fieldListDialog.element.style.top,10)<0?"0px":this.parent.dialogRenderer.fieldListDialog.element.style.top}catch(e){this.parent.actionFailureMethod(e)}}},e.prototype.onCloseFieldList=function(){this.parent.allowDeferLayoutUpdate&&(this.parent.dataSourceSettings=t.extend({},this.parent.clonedDataSource.properties,null,!0),this.parent.isPopupView&&this.parent.pivotGridModule&&(this.parent.pivotGridModule.engineModule=this.parent.engineModule,this.parent.pivotGridModule.olapEngineModule=this.parent.olapEngineModule,this.parent.pivotGridModule.setProperties({dataSourceSettings:this.parent.clonedDataSource.properties},!0)),Object.keys(this.parent.clonedFieldList).length>0&&("olap"===this.parent.dataType?this.parent.olapEngineModule.fieldList=t.extend({},this.parent.clonedFieldList,null,!0):this.parent.engineModule.fieldList=t.extend({},this.parent.clonedFieldList,null,!0)),this.parent.isPopupView&&this.parent.pivotGridModule?(this.parent.pivotGridModule.notify(ae,this),this.parent.pivotGridModule.notify(re,this)):this.cancelButtonClick()),this.parent.dialogRenderer.fieldListDialog.hide(),this.parent.actionObj.actionName=it,this.parent.actionObj.actionName&&this.parent.actionCompleteMethod()},e.prototype.removeFieldListIcon=function(){this.parent.isAdaptive&&this.parent.allowCalculatedField&&this.parent.calculatedFieldModule&&this.adaptiveElement&&4===this.adaptiveElement.selectedItem&&(t.select("#"+this.parent.element.id+"droppable",this.adaptiveElement.element)?this.parent.calculatedFieldModule.updateAdaptiveCalculatedField(!1):this.parent.notify(de,{edit:!1})),document.getElementById(this.parent.element.id+"calculateddialog")||t.removeClass([this.parent.element.querySelector("."+It)],Et)},e.prototype.keyPress=function(e){if(13===e.keyCode&&e.target)return e.target.click(),void e.preventDefault()},e.prototype.wireDialogEvent=function(e){t.EventHandler.add(e,"keydown",this.keyPress,this),t.EventHandler.add(e,"click",this.onShowFieldList,this)},e.prototype.unWireDialogEvent=function(e){t.EventHandler.remove(e,"keydown",this.keyPress),t.EventHandler.remove(e,"click",this.onShowFieldList)},e.prototype.destroy=function(){"Popup"===this.parent.renderMode&&this.unWireDialogEvent(this.parent.element.querySelector("."+It)),this.deferUpdateCheckBox&&!this.deferUpdateCheckBox.isDestroyed&&(this.deferUpdateCheckBox.destroy(),this.deferUpdateCheckBox=null),this.deferUpdateApplyButton&&!this.deferUpdateApplyButton.isDestroyed&&(this.deferUpdateApplyButton.destroy(),this.deferUpdateApplyButton=null),this.deferUpdateCancelButton&&!this.deferUpdateCancelButton.isDestroyed&&(this.deferUpdateCancelButton.destroy(),this.deferUpdateCancelButton=null),"Popup"===this.parent.renderMode&&(this.fieldListDialog&&!this.fieldListDialog.isDestroyed&&(this.fieldListDialog.destroy(),this.fieldListDialog=null),document.getElementById(this.parent.element.id+"_Wrapper")&&t.remove(document.getElementById(this.parent.element.id+"_Wrapper")))},e}(),Dn=function(){function e(e){this.selectedNodes=[],this.parent=e,this.addEventListener()}return e.prototype.render=function(e){if(this.parentElement=this.parent.dialogRenderer.parentElement,this.fieldListSort="None",this.parent.isAdaptive)this.renderTreeDialog(e);else{var i=t.createElement("div",{className:"e-field-table "+("olap"===this.parent.dataType?"e-olap-field-table":"")}),a=t.createElement("div",{className:"e-field-header",innerHTML:this.parent.localeObj.getConstant("allFields")}),r=t.createElement("div",{className:At+"-outer-div"});this.treeViewElement=t.createElement("div",{id:this.parent.element.id+"_TreeView",className:Lt+" "+("olap"===this.parent.dataType?"e-olap-field-list-tree":"")});var n=t.createElement("div",{className:"e-field-header-wrapper"});if(n.appendChild(a),i.appendChild(n),this.updateSortElements(n),r.appendChild(this.treeViewElement),i.appendChild(r),this.parentElement.appendChild(i),"Fixed"===this.parent.renderMode){var o=t.createElement("div",{className:"e-center-div"}),s=t.createElement("div",{className:"e-center-title",innerHTML:this.parent.localeObj.getConstant("centerHeader")});this.parentElement.appendChild(o),this.parentElement.appendChild(s)}this.renderTreeView()}},e.prototype.updateSortElements=function(e){for(var i={None:"sortNone",Ascend:"sortAscending",Descend:"sortDescending"},a=0,r=Object.keys(i);a<r.length;a++){var n=r[a],o=t.createElement("span",{attrs:{tabindex:"0","aria-disabled":"false","aria-label":"Sort "+n,"data-sort":n,title:this.parent.localeObj.getConstant(i[n])},className:Ot+" e-sort-"+n.toLowerCase()+" "+(this.fieldListSort===n?"e-selected":"")});e.appendChild(o),this.unWireFieldListEvent(o),this.wireFieldListEvent(o)}},e.prototype.renderTreeView=function(){this.fieldTable=new n.TreeView({fields:{dataSource:this.getTreeData(),id:"id",text:"caption",isChecked:"isSelected",parentID:"pid",iconCss:"spriteCssClass"},nodeChecked:this.nodeStateChange.bind(this),cssClass:At,showCheckBox:!0,allowDragAndDrop:!0,sortOrder:"None",autoCheck:!1,loadOnDemand:"olap"!==this.parent.dataType,enableRtl:this.parent.enableRtl,locale:this.parent.locale,nodeDragStart:this.dragStart.bind(this),nodeDragStop:this.dragStop.bind(this),drawNode:this.updateTreeNode.bind(this),nodeExpanding:this.updateNodeIcon.bind(this),nodeCollapsed:this.updateNodeIcon.bind(this),nodeSelected:function(e){t.removeClass([e.node],"e-active"),e.cancel=!0}}),this.treeViewElement.innerHTML="",this.fieldTable.isStringTemplate=!0,this.fieldTable.appendTo(this.treeViewElement);var e="Fixed"===this.parent.renderMode?this.parent.element:this.parentElement;t.isNullOrUndefined(e.querySelector("."+Lt))||(e.querySelector("."+Lt).ej2_instances[0].dragObj.enableAutoScroll=!1)},e.prototype.updateNodeIcon=function(e){if("olap"===this.parent.dataType)if(e.node&&e.node.querySelector(".e-list-icon")&&e.node.querySelector(".e-list-icon").className.indexOf("e-folderCDB-icon")>-1){var i=e.node.querySelector(".e-list-icon");t.removeClass([i],"e-folderCDB-icon"),t.addClass([i],"e-folderCDB-open-icon")}else if(e.node&&e.node.querySelector(".e-list-icon")&&e.node.querySelector(".e-list-icon").className.indexOf("e-folderCDB-open-icon")>-1){i=e.node.querySelector(".e-list-icon");t.removeClass([i],"e-folderCDB-open-icon"),t.addClass([i],"e-folderCDB-icon")}},e.prototype.updateTreeNode=function(e){var i=!1;i="olap"!==this.parent.dataType||this.updateOlapTreeNode(e);var a=e.node.querySelector("."+yi);if(e.node.querySelector(".e-list-icon")&&a){var r=e.node.querySelector(".e-list-icon");a.insertBefore(r,e.node.querySelector(".e-list-text"))}if(i&&!this.parent.isAdaptive){var n=g.getFieldInfo(e.nodeData.id,this.parent);i=!1;var o=t.createElement("span",{attrs:{tabindex:"-1",title:n.fieldItem?n.fieldItem.allowDragAndDrop?this.parent.localeObj.getConstant("drag"):"":this.parent.localeObj.getConstant("drag"),"aria-disabled":"false"},className:Ot+" e-drag "+(n.fieldItem?n.fieldItem.allowDragAndDrop?"":Kt:"")});e.node.querySelector(".e-checkbox-wrapper")&&!e.node.querySelector(".cls.DRAG_CLASS")&&a&&a.insertBefore(o,e.node.querySelector(".e-checkbox-wrapper"))}e.node.querySelector(".e-check")&&t.addClass([e.node.querySelector("."+wi)],Ti)},e.prototype.updateOlapTreeNode=function(e){var t=!1;return"olap"===this.parent.dataType?(e.node&&e.node.querySelector(".e-calcMemberGroupCDB,.e-measureGroupCDB-icon,.e-folderCDB-icon,.e-folderCDB-open-icon,.e-dimensionCDB-icon,.e-kpiCDB-icon")&&(e.node.querySelector(".e-checkbox-wrapper").style.display="none"),e.node&&e.node.querySelector(".e-list-icon")&&e.node.querySelector(".e-list-icon").className.indexOf("e-level-members")>-1&&(this.parent.isAdaptive?e.node.querySelector(".e-checkbox-wrapper").style.display="none":e.node.querySelector(".e-checkbox-wrapper").style.visibility="hidden"),e.node&&(e.node.querySelector(".e-hierarchyCDB-icon,.e-attributeCDB-icon,.e-namedSetCDB-icon")||e.node.querySelector(".e-measure-icon,.e-kpiGoal-icon,.e-kpiStatus-icon,.e-kpiTrend-icon,.e-kpiValue-icon")||e.node.querySelector(".e-calc-measure-icon,.e-calc-dimension-icon"))&&(e.node.querySelector(".e-measure-icon")?(e.node.querySelector(".e-list-icon").style.display="none",t=!0):t=!0)):t=!0,t},e.prototype.renderTreeDialog=function(e){var i=t.createElement("div",{id:this.parent.element.id+"_FieldListTreeView",className:"e-adaptive-field-list-dialog "+("olap"===this.parent.dataType?"e-olap-editor-dialog":"")});this.parentElement.appendChild(i),this.fieldDialog=new a.Dialog({animationSettings:{effect:"Fade"},allowDragging:!1,header:this.parent.localeObj.getConstant("adaptiveFieldHeader"),content:this.createTreeView(this.getTreeData(e)),isModal:!0,visible:!0,showCloseIcon:!1,enableRtl:this.parent.enableRtl,locale:this.parent.locale,width:"auto",height:"350px",position:{X:"center",Y:"center"},buttons:[{click:this.closeTreeDialog.bind(this),buttonModel:{cssClass:ri,content:this.parent.localeObj.getConstant("cancel")}},{click:this.onFieldAdd.bind(this),buttonModel:{cssClass:ai,content:this.parent.localeObj.getConstant("add"),isPrimary:!0}}],closeOnEscape:!1,target:this.parentElement.parentElement,close:this.dialogClose.bind(this)}),this.fieldDialog.isStringTemplate=!0,this.fieldDialog.appendTo(i)},e.prototype.dialogClose=function(){document.getElementById(this.parent.element.id+"_FieldListTreeView")&&t.remove(document.getElementById(this.parent.element.id+"_FieldListTreeView"))},e.prototype.createTreeView=function(e){var i=t.createElement("div",{id:this.parent.element.id+"EditorDiv",className:Zt}),a=t.createElement("div",{id:this.parent.element.id+"_SearchDiv",attrs:{tabindex:"-1"},className:Gi}),r=t.createElement("input",{attrs:{type:"text"}});a.appendChild(r);var s=t.createElement("div",{className:$t+"-outer-div"}),l=t.createElement("div",{className:$t+" "+("olap"===this.parent.dataType?"e-olap-field-list-tree":"")});i.appendChild(a),this.editorSearch=new o.MaskedTextBox({showClearButton:!0,placeholder:this.parent.localeObj.getConstant("search"),enableRtl:this.parent.enableRtl,locale:this.parent.locale,cssClass:"e-editor-search",change:this.textChange.bind(this)}),this.editorSearch.isStringTemplate=!0,this.editorSearch.appendTo(r);var d=t.createElement("div",{className:pa+" "+Nt,innerHTML:this.parent.localeObj.getConstant("noMatches")});return i.appendChild(d),s.appendChild(l),i.appendChild(s),this.fieldTable=new n.TreeView({fields:{dataSource:e,id:"id",text:"caption",isChecked:"isSelected",parentID:"pid",iconCss:"spriteCssClass"},showCheckBox:!0,autoCheck:!1,loadOnDemand:"olap"!==this.parent.dataType,sortOrder:"olap"===this.parent.dataType?"None":"Ascending",enableRtl:this.parent.enableRtl,locale:this.parent.locale,nodeChecked:this.addNode.bind(this),drawNode:this.updateTreeNode.bind(this),nodeExpanding:this.updateNodeIcon.bind(this),nodeCollapsed:this.updateNodeIcon.bind(this),nodeSelected:function(e){t.removeClass([e.node],"e-active"),e.cancel=!0}}),this.fieldTable.isStringTemplate=!0,this.fieldTable.appendTo(l),i},e.prototype.textChange=function(e){this.parent.pivotCommon.eventBase.searchTreeNodes(e,this.fieldTable,!0);var i=this.fieldDialog.element.querySelector("."+pa),a=[].slice.call(this.fieldTable.element.querySelectorAll("li")),r=[].slice.call(this.fieldTable.element.querySelectorAll("li."+Nt));a.length===r.length?t.removeClass([i],Nt):t.addClass([i],Nt)},e.prototype.dragStart=function(e){var i=this;if(e.event.target.classList.contains("e-drag")&&!e.event.target.classList.contains(Kt)){var a=g.getFieldInfo(e.draggedNode.getAttribute("data-uid"),this.parent),r={fieldName:a.fieldName,fieldItem:a.fieldItem,axis:a.axis,dataSourceSettings:this.parent.dataSourceSettings,cancel:!1};(this.parent.isPopupView?this.parent.pivotGridModule:this.parent).trigger(J,r,function(a){if(a.cancel)i.parent.isDragging=!1,e.cancel=!0;else{i.parent.isDragging=!0,t.addClass([e.draggedNode.querySelector("."+wi)],Si);var r=void 0;r="olap"===i.parent.dataType?i.parent.olapEngineModule.fieldList[e.draggedNode.getAttribute("data-uid")]:i.parent.engineModule.fieldList[e.draggedNode.getAttribute("data-uid")];var n=[si,li,hi];if(r&&"CalculatedField"===r.aggregateType)for(var o=0,s=n;o<s.length;o++){var l=s[o];t.addClass([i.parentElement.querySelector("."+l)],vi)}var d=e.clonedNode;d&&"Popup"===("pivotfieldlist"===i.parent.getModuleName()&&i.parent.renderMode)&&(d.style.zIndex=(i.parent.dialogRenderer.fieldListDialog.zIndex+1).toString())}})}else this.parent.isDragging=!1,e.cancel=!0},e.prototype.dragStop=function(e){e.cancel=!0,this.parent.isDragging=!1;for(var i=0,a=[si,li,hi];i<a.length;i++){var r=a[i];t.removeClass([this.parentElement.querySelector("."+r)],vi)}t.removeClass([e.draggedNode.querySelector("."+wi)],Si),this.parent.pivotCommon.filterDialog.dialogPopUp&&this.parent.pivotCommon.filterDialog.dialogPopUp.close();var n=e.draggedNodeData.id.toString();if(this.isNodeDropped(e,n)){var o=this.parent.pivotFieldList[n];if(this.parent.pivotCommon.dataSourceUpdate.control="pivotview"===this.parent.getModuleName()?this.parent:this.parent.pivotGridModule?this.parent.pivotGridModule:this.parent,this.parent.pivotCommon.nodeStateModified.onStateModified(e,n)){this.parent.allowDeferLayoutUpdate?(o.isSelected=!0,this.updateDataSource()):this.parent.updateDataSource();this.parent.axisFieldModule.render()}}},e.prototype.isNodeDropped=function(e,i){var a=!0;if("true"===e.draggedNodeData.isChecked){var r=this.getButton(i),n=t.closest(r,"."+oi),o=t.closest(e.target,"."+oi);if(r&&n===o){for(var s=[].slice.call(n.querySelectorAll("."+_t)),l=t.closest(e.target,"."+Bt),d=void 0,h=-1,p=0,u=s.length;p<u;p++)if(s[p].id===r.id&&(d=p),l){var c=l.querySelector("."+_t);s[p].id===c.id&&(h=p)}if(d===h||d===s.length-1&&-1===h){var g=document.getElementById(this.parent.element.id+"_Wrapper");t.removeClass([].slice.call(g.querySelectorAll("."+Xt)),Jt),a=!1}}}return a},e.prototype.getButton=function(e){for(var t,i=document.getElementById(this.parent.element.id+"_Wrapper"),a=[].slice.call(i.querySelectorAll("."+_t)),r=0,n=a.length;r<n;r++)if(a[r].id===e){t=a[r];break}return t},e.prototype.nodeStateChange=function(e){var i=this;if(e.isInteracted){var a=t.closest(e.node,"."+yi);if(!t.isNullOrUndefined(a)){var r=t.closest(a,"li"),n=r.getAttribute("data-uid");this.parent.pivotCommon.filterDialog.dialogPopUp&&this.parent.pivotCommon.filterDialog.dialogPopUp.close();var o=this.parent.pivotFieldList[n],s=g.getFieldInfo(n,this.parent),l=this.parent.isPopupView?this.parent.pivotGridModule:this.parent;if("check"===e.action){var d={fieldName:n,dropField:s.fieldItem,dataSourceSettings:g.getClonedDataSourceSettings(this.parent.dataSourceSettings),dropAxis:"number"===o.type||"CalculatedField"===o.type&&o.formula&&o.formula.indexOf("Measure")>-1&&"olap"===this.parent.dataType?"values":"rows",dropPosition:s.position,draggedAxis:"fieldlist",cancel:!1};l.trigger(y,d,function(l){if(l.cancel)i.updateCheckState(o,e.action);else{t.addClass([a.querySelector("."+wi)],Ti),i.updateSelectedNodes(r,e.action);var d=i.parent.pivotCommon.dataSourceUpdate.getNewField(n,s.fieldItem);i.updateReportSettings(d,l),i.updateNodeStateChange(n,e,o)}})}else{var h={cancel:!1,fieldName:n,dataSourceSettings:g.getClonedDataSourceSettings(this.parent.dataSourceSettings),fieldItem:s.fieldItem,axis:s.axis};l.trigger(Y,h,function(d){d.cancel?i.updateCheckState(o,e.action):(t.removeClass([a.querySelector("."+wi)],Ti),i.updateSelectedNodes(r,e.action),i.parent.pivotCommon.dataSourceUpdate.removeFieldFromReport(n),"pivot"===i.parent.dataType&&i.parent.showValuesButton&&i.parent.dataSourceSettings.values.length>1&&s&&s.position<i.parent.dataSourceSettings.valueIndex&&("row"===i.parent.dataSourceSettings.valueAxis&&"rows"===s.axis||"column"===i.parent.dataSourceSettings.valueAxis&&"columns"===s.axis)&&l.setProperties({dataSourceSettings:{valueIndex:i.parent.dataSourceSettings.valueIndex-1}},!0),"olap"===i.parent.dataType&&0===i.parent.dataSourceSettings.values.length&&i.parent.pivotCommon.dataSourceUpdate.removeFieldFromReport("[Measures]"),i.updateNodeStateChange(n,e,o))})}}}},e.prototype.updateReportSettings=function(e,i){var a=i.dropPosition,r=i.dropAxis;if("pivot"===this.parent.dataType&&this.parent.showValuesButton&&this.parent.dataSourceSettings.values.length>1){var n="row"===this.parent.dataSourceSettings.valueAxis&&"rows"===r?this.parent.dataSourceSettings.rows:"column"===this.parent.dataSourceSettings.valueAxis&&"columns"===r?this.parent.dataSourceSettings.columns:void 0;t.isNullOrUndefined(n)||(-1===a&&-1===this.parent.dataSourceSettings.valueIndex?this.parent.setProperties({dataSourceSettings:{valueIndex:n.length}},!0):a>-1&&a<=this.parent.dataSourceSettings.valueIndex?this.parent.setProperties({dataSourceSettings:{valueIndex:this.parent.dataSourceSettings.valueIndex+1}},!0):this.parent.dataSourceSettings.valueIndex>-1&&a>this.parent.dataSourceSettings.valueIndex&&(a-=1))}switch(r){case"filters":-1!==a?this.parent.dataSourceSettings.filters.splice(a,0,e):this.parent.dataSourceSettings.filters.push(e);break;case"rows":-1!==a?this.parent.dataSourceSettings.rows.splice(a,0,e):this.parent.dataSourceSettings.rows.push(e);break;case"columns":-1!==a?this.parent.dataSourceSettings.columns.splice(a,0,e):this.parent.dataSourceSettings.columns.push(e);break;case"values":if(-1!==a?this.parent.dataSourceSettings.values.splice(a,0,e):this.parent.dataSourceSettings.values.push(e),"olap"===this.parent.dataType&&this.parent.olapEngineModule&&!this.parent.olapEngineModule.isMeasureAvail){var o={name:"[Measures]",caption:"Measures",baseField:void 0,baseItem:void 0};("row"===this.parent.dataSourceSettings.valueAxis?this.parent.dataSourceSettings.rows:this.parent.dataSourceSettings.columns).push(o)}}},e.prototype.updateCheckState=function(e,t){for(var i=this.fieldTable.element.querySelectorAll(".e-checkbox-wrapper"),a=this.fieldTable.element.querySelectorAll(".e-list-text"),r=(this.fieldTable.element.querySelectorAll(".e-frame"),0);r<i.length;r++)e.caption===a[r].textContent&&("check"===t?this.fieldTable.uncheckAll([e.id]):this.fieldTable.checkAll([e.id]))},e.prototype.updateNodeStateChange=function(e,t,i){this.parent.allowDeferLayoutUpdate?(i.isSelected="check"===t.action,"olap"===this.parent.dataType&&this.parent.olapEngineModule.updateFieldlistData(e,"check"===t.action),this.updateDataSource()):this.parent.updateDataSource(!0);var a=this.parent;setTimeout(function(){a.axisFieldModule.render()})},e.prototype.updateSelectedNodes=function(e,i){if(e&&e.querySelector("ul"))for(var a=0,r=[].slice.call(e.querySelectorAll("li"));a<r.length;a++){var n=r[a];"check"===i?t.addClass([n.querySelector("."+wi)],Ti):t.removeClass([n.querySelector("."+wi)],Ti)}},e.prototype.updateDataSource=function(){this.parent.isPopupView?("olap"===this.parent.dataType?this.parent.pivotGridModule.olapEngineModule=this.parent.olapEngineModule:this.parent.pivotGridModule.engineModule=this.parent.engineModule,this.parent.pivotGridModule.setProperties({dataSourceSettings:this.parent.dataSourceSettings.properties},!0),this.parent.pivotGridModule.notify(ae,this)):this.parent.triggerPopulateEvent()},e.prototype.addNode=function(e){var t=this;if(e.isInteracted){var i=this.parent.pivotFieldList[e.data[0].id.toString()],a=g.getFieldInfo(i.id.toString(),this.parent),r=this.parent.isPopupView?this.parent.pivotGridModule:this.parent;if("check"===e.action){var n={fieldName:a.fieldName,dropField:a.fieldItem,dataSourceSettings:g.getClonedDataSourceSettings(this.parent.dataSourceSettings),dropAxis:["filters","columns","rows","values"][this.parent.dialogRenderer.adaptiveElement.selectedItem],draggedAxis:"fieldlist",cancel:!1};r.trigger(y,n,function(a){a.cancel?t.updateCheckState(i,e.action):t.selectedNodes.push(i.id.toString())})}else{var o={cancel:!1,fieldName:a.fieldName,dataSourceSettings:g.getClonedDataSourceSettings(this.parent.dataSourceSettings),fieldItem:a.fieldItem,axis:a.axis};r.trigger(Y,o,function(a){if(a.cancel)t.updateCheckState(i,e.action);else for(var r=t.selectedNodes.length;r--;)if(t.selectedNodes[r]===i.id.toString()){t.selectedNodes.splice(r,1);break}})}}},e.prototype.refreshTreeView=function(){if(this.fieldTable){var e=this.getUpdatedData();this.fieldTable.fields={dataSource:e,id:"id",text:"caption",isChecked:"isSelected",parentID:"pid",iconCss:"spriteCssClass"},this.fieldTable.dataBind()}},e.prototype.getUpdatedData=function(){var e=this.getTreeData(),t=this.fieldTable.expandedNodes;return this.updateExpandedNodes(e,t),this.applySorting(e,this.fieldListSort)},e.prototype.getTreeData=function(e){var t=[];if("olap"===this.parent.dataType)t=this.getOlapTreeData(e);else{for(var i=this.parent.pivotFieldList?Object.keys(this.parent.pivotFieldList):[],a={},r=0,n=i;r<n.length;r++){var o=n[r],s=this.parent.pivotFieldList[o];a[o]={id:s.id,caption:s.caption,isSelected:s.isSelected}}if(this.parent.isAdaptive){for(var l=[this.parent.dataSourceSettings.filters,this.parent.dataSourceSettings.columns,this.parent.dataSourceSettings.rows,this.parent.dataSourceSettings.values][e],d=i.length;d--;)a[i[d]].isSelected=!1;for(var h=0,p=l;h<p.length;h++){a[p[h].name].isSelected=!0}}for(var u=a,c=0,g=i;c<g.length;c++){var m=u[s=g[c]];t.push(m)}}return t},e.prototype.getOlapTreeData=function(e){var t=[],i=this.parent.olapEngineModule.fieldListData?this.parent.olapEngineModule.fieldListData:[];if(this.parent.isAdaptive)for(var a=[this.parent.dataSourceSettings.filters,this.parent.dataSourceSettings.columns,this.parent.dataSourceSettings.rows,this.parent.dataSourceSettings.values][e],r=0;r<i.length;){var n=i[r],o=void 0;if(3===e){if("[measures]"!==n.id.toLowerCase()&&(0===n.id.toLowerCase().indexOf("[measures]")||n.spriteCssClass&&-1!==n.spriteCssClass.indexOf("e-measureCDB"))||"[calculated members].[_0]"===n.id.toLowerCase()||n.spriteCssClass&&-1!==n.spriteCssClass.indexOf("e-calc-measure-icon")){(o={id:n.id,caption:n.caption,hasChildren:n.hasChildren,type:n.type,aggregateType:n.aggregateType,isSelected:n.isSelected,pid:n.pid,spriteCssClass:n.spriteCssClass}).isSelected=!1,o.spriteCssClass&&-1!==o.spriteCssClass.indexOf("e-measureCDB")&&(o.spriteCssClass=o.spriteCssClass.replace("e-folderCDB-icon","e-measureGroupCDB-icon"),o.pid=void 0);for(var s=0,l=a;s<l.length;s++){var d=l[s];if(o.id===d.name){o.isSelected=!0;break}}t.push(o)}}else if(!(0===n.id.toLowerCase().indexOf("[measures]")||n.spriteCssClass&&-1!==n.spriteCssClass.indexOf("e-measureCDB")||n.spriteCssClass&&-1!==n.spriteCssClass.indexOf("e-calc-measure-icon"))){(o={id:n.id,caption:n.caption,hasChildren:n.hasChildren,type:n.type,aggregateType:n.aggregateType,isSelected:n.isSelected,pid:n.pid,spriteCssClass:n.spriteCssClass}).isSelected=!1;for(var h=0,p=a;h<p.length;h++){var u=p[h];if(o.id===u.name){o.isSelected=!0;break}}t.push(o)}r++}else t=g.getClonedData(this.parent.olapEngineModule.fieldListData);return t},e.prototype.updateExpandedNodes=function(e,t){if(t.length>0)for(var i=0,a=0,r=e;a<r.length;a++){var n=r[a];if(t.indexOf(n.id)>-1&&(i++,n.expanded=!0,n.spriteCssClass=n.spriteCssClass&&n.spriteCssClass.toString().indexOf("e-folderCDB-icon")>-1?n.spriteCssClass.toString().replace("e-folderCDB-icon","e-folderCDB-open-icon"):n.spriteCssClass,i===t.length))break}},e.prototype.updateSorting=function(e){var i=e.target,a=i.getAttribute("data-sort");if(this.parent.actionObj.actionName=Be,!this.parent.actionBeginMethod()){try{if(-1===i.className.indexOf("e-selected")){switch(a){case"None":this.fieldListSort="None",t.addClass([i],"e-selected"),t.removeClass([this.parentElement.querySelector(".e-sort-ascend")],"e-selected"),t.removeClass([this.parentElement.querySelector(".e-sort-descend")],"e-selected");break;case"Ascend":this.fieldListSort="Ascend",t.addClass([i],"e-selected"),t.removeClass([this.parentElement.querySelector(".e-sort-none")],"e-selected"),t.removeClass([this.parentElement.querySelector(".e-sort-descend")],"e-selected");break;case"Descend":this.fieldListSort="Descend",t.addClass([i],"e-selected"),t.removeClass([this.parentElement.querySelector(".e-sort-ascend")],"e-selected"),t.removeClass([this.parentElement.querySelector(".e-sort-none")],"e-selected")}this.refreshTreeView()}}catch(e){this.parent.actionFailureMethod(e)}this.parent.actionObj.actionName=this.parent.getActionCompleteName(),this.parent.actionObj.actionName&&this.parent.actionCompleteMethod()}},e.prototype.applySorting=function(e,t){if("olap"===this.parent.dataType){var i=void 0,a=void 0;this.parent.dataSourceSettings.calculatedFieldSettings.length>0&&"[calculated members].[_0]"===e[0].id.toLowerCase()?(a=e[0],i=e[1],e.splice(0,2)):(i=e[0],e.splice(0,1)),e="Ascend"===t?e.sort(function(e,t){return e.caption>t.caption?1:t.caption>e.caption?-1:0}):"Descend"===t?e.sort(function(e,t){return e.caption<t.caption?1:t.caption<e.caption?-1:0}):e,a?e.splice(0,0,a,i):e.splice(0,0,i)}else this.fieldTable.sortOrder="Ascend"===t?"Ascending":"Descend"===t?"Descending":"None";return e},e.prototype.onFieldAdd=function(e){this.parent.dialogRenderer.updateDataSource(this.selectedNodes),this.closeTreeDialog()},e.prototype.closeTreeDialog=function(){this.selectedNodes=[],this.fieldDialog.hide()},e.prototype.keyPress=function(e){if(13===e.keyCode&&e.target)return e.target.click(),void e.preventDefault()},e.prototype.wireFieldListEvent=function(e){t.EventHandler.add(e,"keydown",this.keyPress,this),t.EventHandler.add(e,"click",this.updateSorting,this)},e.prototype.unWireFieldListEvent=function(e){t.EventHandler.remove(e,"keydown",this.keyPress),t.EventHandler.remove(e,"click",this.updateSorting)},e.prototype.addEventListener=function(){this.parent.on(se,this.refreshTreeView,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(se,this.refreshTreeView)},e.prototype.destroy=function(){this.removeEventListener(),this.fieldTable&&!this.fieldTable.isDestroyed&&(this.fieldTable.destroy(),this.fieldTable=null),this.fieldDialog&&!this.fieldDialog.isDestroyed&&(this.fieldDialog.destroy(),this.fieldDialog=null),this.editorSearch&&!this.editorSearch.isDestroyed&&(this.editorSearch.destroy(),this.editorSearch=null)},e}(),On=function(){function e(e){this.parent=e}return e.prototype.render=function(){if(!this.parent.isAdaptive){var e=t.createElement("div",{className:"e-axis-table "+("olap"===this.parent.dataType?"e-olap-axis-table":"")});this.leftAxisPanel=t.createElement("div",{className:jt}),this.rightAxisPanel=t.createElement("div",{className:kt}),this.parent.dialogRenderer.parentElement.appendChild(e),e.appendChild(this.leftAxisPanel),e.appendChild(this.rightAxisPanel),this.axisTable=e,this.renderAxisTable()}this.parent.axisFieldModule.render()},e.prototype.renderAxisTable=function(){for(var e=["filters","rows","columns","values"],i=0,a=e.length;i<a;i++){var r=t.createElement("div",{className:Lt+"-"+e[i]}),n=t.createElement("div",{className:"e-axis-wrapper"}),o=t.createElement("div",{className:"e-axis-header",attrs:{title:this.parent.localeObj.getConstant(e[i])},innerHTML:this.parent.localeObj.getConstant(e[i])});n.appendChild(this.getIconupdate(e[i])),n.appendChild(o);var s=t.createElement("div",{className:Vt+" e-"+e[i]}),l=void 0;l="rows"===e[i]?this.parent.localeObj.getConstant("dropRowPrompt"):"columns"===e[i]?this.parent.localeObj.getConstant("dropColPrompt"):"values"===e[i]?this.parent.localeObj.getConstant("dropValPrompt"):this.parent.localeObj.getConstant("dropFilterPrompt");var d=t.createElement("span",{className:Ht,innerHTML:l});new t.Droppable(s,{});r.appendChild(n),r.appendChild(s),r.appendChild(d),i<=1?this.leftAxisPanel.appendChild(r):this.rightAxisPanel.appendChild(r),this.unWireEvent(s),this.wireEvent(s)}},e.prototype.getIconupdate=function(e){var i=t.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false"},className:"e-axis-icon-wrapper"}),a=t.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false"},className:"e-icons e-axis-"+e});return i.appendChild(a),i},e.prototype.wireEvent=function(e){t.EventHandler.add(e,"mouseover",this.updateDropIndicator,this),t.EventHandler.add(e,"mouseleave",this.updateDropIndicator,this)},e.prototype.unWireEvent=function(e){t.EventHandler.remove(e,"mouseover",this.updateDropIndicator),t.EventHandler.remove(e,"mouseleave",this.updateDropIndicator)},e.prototype.updateDropIndicator=function(e){var i=this.parent.dialogRenderer.parentElement;if(this.parent.isDragging&&e.target.classList.contains(Vt)&&"mouseover"===e.type){t.removeClass([].slice.call(i.querySelectorAll("."+Xt)),Jt),t.removeClass([].slice.call(i.querySelectorAll("."+Xt+"-last")),Jt);var a=[].slice.call(e.target.querySelectorAll("."+Bt));a.length>0&&t.addClass([a[a.length-1].querySelector("."+Xt+"-last")],Jt)}else this.parent.isDragging&&(e.target.classList.contains(oi)||"mouseleave"!==e.type)||(t.removeClass([].slice.call(i.querySelectorAll("."+Xt)),Jt),t.removeClass([].slice.call(i.querySelectorAll("."+Xt+"-last")),Jt))},e}(),Nn=function(){function e(e){this.parent=e,this.menuOption=new Za(this.parent),this.parent.pivotButtonModule=this,this.addEventListener(),this.parent instanceof Ln&&(this.axisField=new En(this.parent)),this.isDestroyed=!1}return e.prototype.renderPivotButton=function(e){var i,a,r=this,n=t.extend([],e.field,null,!0),o=e.axis,l=-1,d="pivot"===this.parent.dataType&&("pivotfieldlist"===this.parent.getModuleName()&&this.parent.pivotGridModule?this.parent.pivotGridModule.showValuesButton:this.parent.showValuesButton);if(("row"===this.parent.dataSourceSettings.valueAxis&&"rows"===e.axis||"column"===this.parent.dataSourceSettings.valueAxis&&"columns"===e.axis)&&d&&this.parent.dataSourceSettings.values.length>1&&t.isNullOrUndefined(g.getFieldByName("[Measures]",n))){var p=g.getFieldByName("[Measures]",this.parent.dataSourceSettings.fieldMapping),u={name:"[Measures]",caption:this.parent.localeObj.getConstant("values"),axis:e.axis,showRemoveIcon:!(p&&"showRemoveIcon"in p)||p.showRemoveIcon,allowDragAndDrop:!(p&&"allowDragAndDrop"in p)||p.allowDragAndDrop};-1===this.parent.dataSourceSettings.valueIndex||this.parent.dataSourceSettings.valueIndex>n.length?(l=n.length,n.push(u),this.parent.setProperties({dataSourceSettings:{valueIndex:-1}},!0)):(l=this.parent.dataSourceSettings.valueIndex,n.splice(l,0,u))}if(this.parentElement="pivotview"===this.parent.getModuleName()?this.parent.element:document.getElementById(this.parent.element.id+"_Wrapper"),"pivotfieldlist"===this.parent.getModuleName()){if(this.parentElement=document.getElementById(this.parent.element.id+"_Wrapper"),!this.parentElement.querySelector("."+Lt+"-"+o))return;var c=this.parentElement.querySelector("."+Lt+"-"+o).querySelector("."+Ht);0===n.length?t.removeClass([c],Nt):t.addClass([c],Nt),a=this.parentElement.querySelector("."+Lt+"-"+o).querySelector("."+Vt)}else this.parentElement=this.parent.element,a=this.parentElement.querySelector(".e-group-"+o);if(a)if("pivotview"===this.parent.getModuleName()&&0===n.length)for(var m=0,f=this.parentElement.querySelectorAll(".e-group-"+o);m<f.length;m++){if(!(V=f[m]).classList.contains(Ba)&&!V.classList.contains(Ha)){c=t.createElement("span",{className:Ht,innerHTML:this.parent.groupingBarSettings.allowDragAndDrop?"rows"===o?this.parent.localeObj.getConstant("rowAxisPrompt"):"columns"===o?this.parent.localeObj.getConstant("columnAxisPrompt"):"values"===o?this.parent.localeObj.getConstant("valueAxisPrompt"):"filters"===o?this.parent.localeObj.getConstant("filterAxisPrompt"):this.parent.localeObj.getConstant("allFields"):""});V.appendChild(c)}}else{for(var v=0,S=n.length;v<S;v++)for(var y=0,b="pivotfieldlist"===this.parent.getModuleName()?[a]:this.parentElement.querySelectorAll(".e-group-"+o);y<b.length;y++){V=V=b[y];var C="olap"===this.parent.dataType&&("[measures]"===n[v].name.toLowerCase()||"values"===o),x="olap"===this.parent.dataType&&"values"===o;if(!V.classList.contains(Ba)&&!V.classList.contains(Ha)){var w=t.createElement("div",{className:Bt+(0===v&&"all-fields"!==o?" e-first-btn":""),attrs:{"data-tag":o+":"+n[v].name}}),T=t.createElement("div",{id:n[v].name,className:_t+" "+n[v].name.replace(/[^A-Z0-9]/gi,""),attrs:{"data-uid":n[v].name,tabindex:"pivotview"===this.parent.getModuleName()&&this.parent.grid&&"rows"===o&&!V.classList.contains(Va)?"-1":"0",isvalue:v===l||C&&!x?"true":"false","aria-disabled":"false","aria-label":n[v].caption?n[v].caption:n[v].name,"data-type":"olap"===this.parent.dataType?x?"isMeasureFieldsAvail":C?"isMeasureAvail":n[v].type:n[v].type,"data-caption":n[v].caption?n[v].caption:n[v].name,"data-basefield":n[v].baseField,"data-baseitem":n[v].baseItem}}),M=t.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false"},className:Xt}),D=t.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false"},className:Xt+"-last"}),O=this.createButtonDragIcon(n[v],T),N=this.createButtonText(n,v,o,l);if(T.appendChild(N),"all-fields"!==o){if(C||n[v].isNamedSet||n[v].isCalculatedField||(-1!==["filters","values"].indexOf(o)||l===v||"olap"===this.parent.dataType&&("pivotview"===this.parent.getModuleName()&&this.parent.enableVirtualization||"pivotfieldlist"===this.parent.getModuleName()&&void 0!==this.parent.pivotGridModule&&this.parent.pivotGridModule.enableVirtualization)||this.createSortOption(T,n[v].name,n[v]),"values"!==o&&l!==v&&this.createFilterOption(T,n[v].name,o,n[v]),"values"===o&&this.getTypeStatus(n,v,T)),n[v].isCalculatedField||"CalculatedField"===n[v].type){var E=t.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false",title:this.parent.localeObj.getConstant("editCalculatedField")},className:Ot+" "+ua});this.parent.allowCalculatedField&&this.parent.calculatedFieldModule&&(n[v].showEditIcon||void 0===n[v].showEditIcon)?t.removeClass([E],Nt):t.addClass([E],Nt),T.appendChild(E)}var P=t.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false",title:this.parent.localeObj.getConstant("remove")},className:Ot+" "+Yt});"pivotview"===this.parent.getModuleName()?this.parent.groupingBarSettings.showRemoveIcon&&(n[v].showRemoveIcon||void 0===n[v].showRemoveIcon)?t.removeClass([P],Nt):t.addClass([P],Nt):n[v].showRemoveIcon||void 0===n[v].showRemoveIcon?t.removeClass([P],Nt):t.addClass([P],Nt),T.appendChild(P),w.appendChild(M),w.appendChild(T),w.appendChild(D)}else w.appendChild(M),w.appendChild(T);V.appendChild(w);var F=new h.Button({enableRtl:this.parent.enableRtl,locale:this.parent.locale});F.isStringTemplate=!0,F.appendTo(T),this.unWireEvent(w,v===l&&"all-fields"!==o?"values":o,C),this.wireEvent(w,v===l&&"all-fields"!==o?"values":o,C),("pivotview"===this.parent.getModuleName()&&!this.parent.isAdaptive||"pivotfieldlist"===this.parent.getModuleName())&&(this.createDraggable(n[v],"pivotview"===this.parent.getModuleName()?N:O),T.querySelector(".e-draggable").ej2_instances[0].enableAutoScroll=!1)}}if("values"===o)for(var I=function(e){if(e.classList.contains(Ba)&&L.parent.pivotChartModule){var i=n.map(function(e){return{text:e.caption?e.caption:e.name,value:e.name}}),a=L.parent;if(L.valueFiedDropDownList&&e.querySelector("."+_a))L.valueFiedDropDownList.dataSource=i,L.valueFiedDropDownList.value=a.chartSettings.enableMultipleAxis?i[0].value:a.pivotChartModule.currentMeasure;else{var r=t.createElement("div",{className:_a});e.appendChild(r),L.valueFiedDropDownList=new s.DropDownList({dataSource:i,enableRtl:L.parent.enableRtl,locale:L.parent.locale,value:a.chartSettings.enableMultipleAxis?i[0].value:a.pivotChartModule.currentMeasure,width:200,fields:{value:"value",text:"text"},cssClass:"e-group-chart-values-drodown",change:function(e){e.e&&null!==e.e&&(a.chartSettings.value=e.value)}}),L.valueFiedDropDownList.isStringTemplate=!0,L.valueFiedDropDownList.appendTo(r)}}},L=this,A=0,R=this.parentElement.querySelectorAll(".e-group-"+o);A<R.length;A++){I(V=R[A])}else if("columns"===o)for(var j=void 0,k=0,q=this.parentElement.querySelectorAll(".e-group-"+o);k<q.length;k++){var V;if((V=q[k]).classList.contains(Ha)&&this.parent.pivotChartModule){for(var H=this.parent.pivotChartModule.currentMeasure,B=this.parent.chartSettings.columnDelimiter?this.parent.chartSettings.columnDelimiter:"-",_=this.parent.chartSettings.columnHeader&&""!==this.parent.chartSettings.columnHeader?this.parent.chartSettings.columnHeader.split(B).join(" - "):"",U="olap"===this.parent.dataType?this.parent.olapEngineModule:this.parent.engineModule,G=U.pivotValues,W=this.parent.pivotChartModule.getColumnTotalIndex(G),z=[],Q=!1,Y=0,K=Object.keys(G);Y<K.length;Y++){var X=K[Y];if(Q)break;var J=Number(X);if(G[J][0]&&"row"===G[J][0].axis&&(0===this.parent.dataSourceSettings.rows.length||"grand sum"!==G[J][0].type))for(var Z=G[J][0],$="olap"===this.parent.dataType?U.tupRowInfo[Z.ordinal]:void 0,ee=G[J],te=0,ie=Object.keys(ee);te<ie.length;te++){var ae=ie[te],re=Number(ae),ne=G[J][re],oe="olap"===this.parent.dataType&&$&&$.measureName?$.measureName:ne.actualText;if(!W[ne.colIndex]&&"value"===ne.axis&&"header"!==Z.type&&""!==oe&&oe===H){Q=!0;var se="olap"===this.parent.dataType?ne.columnHeaders.toString().split(/~~|::/).join(" - "):ne.columnHeaders.toString().split(this.parent.dataSourceSettings.valueSortSettings.headerDelimiter).join(" - ");z.push({value:se,text:se,title:(i={},i.title=se,i)}),se===_&&(j=z.length)}}}if(this.columnFieldDropDownList&&V.querySelector("."+Ua))this.columnFieldDropDownList.dataSource=z,this.columnFieldDropDownList.value=void 0!==j?z[j-1].value:z[0].value;else{var le=t.createElement("div",{className:Ua});V.appendChild(le),this.columnFieldDropDownList=new s.DropDownList({dataSource:z,enableRtl:this.parent.enableRtl,locale:this.parent.locale,value:j?z[j-1].value:z[0]?z[0].value:"",width:"200",fields:{value:"value",text:"text",htmlAttributes:"title"},cssClass:"e-group-chart-columns-dropdown",change:function(e){if(e.e&&null!==e.e){var t=r.parent.chartSettings.columnDelimiter?r.parent.chartSettings.columnDelimiter:"-";r.parent.chartSettings.columnHeader=e.value.split(" - ").join(t)}}}),this.columnFieldDropDownList.isStringTemplate=!0,this.columnFieldDropDownList.appendTo(le)}}}}},e.prototype.createButtonText=function(e,i,a,r){var n,o;"filters"===a&&(o=this.updateButtontext(e[i].name));var s;void 0!==(s="olap"===this.parent.dataType?this.parent.olapEngineModule:this.parent.engineModule).fieldList[e[i].name]&&(n="DistinctCount"===(n=s.fieldList[e[i].name].aggregateType)||"number"===s.fieldList[e[i].name].type&&"include"!==s.fieldList[e[i].name].type&&"exclude"!==s.fieldList[e[i].name].type?void 0===n?"Sum":s.fieldList[e[i].name].aggregateType:"Count");var l=e[i].caption?e[i].caption:e[i].name;return t.createElement("span",{attrs:{title:"filters"===a?"olap"===this.parent.dataType&&"CalculatedField"===s.fieldList[e[i].name].type?l:l+" ("+o+")":"olap"===this.parent.dataType?l:this.parent.dataSourceSettings.showAggregationOnValueField&&"values"===a&&"CalculatedField"!==n?this.parent.localeObj.getConstant(n)+" "+this.parent.localeObj.getConstant("of")+" "+l:l,tabindex:"-1","aria-disabled":"false",oncontextmenu:"return false;","data-type":r===i?"":n},className:"e-content "+("pivotview"===this.parent.getModuleName()?this.parent.groupingBarSettings.allowDragAndDrop&&(e[i].allowDragAndDrop||void 0===e[i].allowDragAndDrop)?"":Kt:""),innerHTML:"filters"===a?"olap"===this.parent.dataType&&"CalculatedField"===s.fieldList[e[i].name].type?l:l+" ("+o+")":"olap"===this.parent.dataType?l:this.parent.dataSourceSettings.showAggregationOnValueField&&"values"===a&&"CalculatedField"!==n?this.parent.localeObj.getConstant(n)+" "+this.parent.localeObj.getConstant("of")+" "+l:l})},e.prototype.getTypeStatus=function(e,t,i){var a=("olap"===this.parent.dataType?this.parent.olapEngineModule:this.parent.engineModule).fieldList[e[t].name];"CalculatedField"!==a.aggregateType&&this.validateDropdown(a.type)&&this.createSummaryType(i,e[t].name,e[t])},e.prototype.validateDropdown=function(e){var t=this.parent.aggregateTypes;if("number"!==e)return t.indexOf("Count")>-1||t.indexOf("DistinctCount")>-1;for(var i=0;i<t.length;i++)if(this.parent.getAllSummaryType().indexOf(t[i])>-1)return!0;return!1},e.prototype.createSummaryType=function(e,i,a){var r=t.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false",title:this.parent.localeObj.getConstant("format")},className:Ot+" "+Pt});return"pivotview"===this.parent.getModuleName()?this.parent.groupingBarSettings.showValueTypeIcon&&a.showValueTypeIcon?t.removeClass([r],Nt):t.addClass([r],Nt):a.showValueTypeIcon?t.removeClass([r],Nt):t.addClass([r],Nt),e.appendChild(r),r},e.prototype.createMenuOption=function(e){this.menuOption.render(e,this.parentElement),this.parent.pivotButtonModule=this},e.prototype.openCalculatedFieldDialog=function(e){var i=e.target.parentElement.id,a=g.getFieldInfo(i,this.parent);if(this.parent.actionObj.actionName=_e,this.parent.actionObj.fieldInfo=a,!this.parent.actionBeginMethod())try{"pivotview"===this.parent.getModuleName()?this.parent.isAdaptive&&this.parent.showFieldList&&this.parent.pivotFieldListModule&&!this.parent.pivotFieldListModule.isDestroyed?(this.parent.pivotFieldListModule.element.querySelector("."+It).click(),this.parent.pivotFieldListModule.dialogRenderer.adaptiveElement.select(4),this.parent.pivotFieldListModule.calculatedFieldModule.updateAdaptiveCalculatedField(!0,i)):(this.parent.isAdaptive||(this.parent.calculatedFieldModule.buttonCall=!0),this.parent.notify(de,{edit:!0,fieldName:i})):"pivotfieldlist"===this.parent.getModuleName()&&(this.parent.isAdaptive?(this.parent.dialogRenderer.adaptiveElement.select(4),this.parent.calculatedFieldModule.updateAdaptiveCalculatedField(!0,i),this.parent.calculatedFieldModule.buttonCall=!0):(this.parent.dialogRenderer.fieldListDialog&&(this.parent.dialogRenderer.fieldListDialog.hide(),t.addClass([this.parent.element.querySelector("."+It)],Et)),this.parent.notify(de,{edit:!0,fieldName:i}),this.parent.calculatedFieldModule&&(this.parent.calculatedFieldModule.buttonCall=!0)))}catch(e){this.parent.actionFailureMethod(e)}},e.prototype.createDraggable=function(e,i){this.draggable=new t.Draggable(i,{clone:!0,enableTailMode:!0,enableAutoScroll:!0,helper:this.createDragClone.bind(this),dragStart:this.onDragStart.bind(this),drag:this.onDragging.bind(this),dragStop:this.onDragStop.bind(this),abort:"pivotview"===this.parent.getModuleName()?this.parent.groupingBarSettings.allowDragAndDrop&&e.allowDragAndDrop?"":"."+_t:e.allowDragAndDrop?"":"."+_t})},e.prototype.createButtonDragIcon=function(e,i){var a=t.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false"}}),r=t.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false",title:this.parent.localeObj.getConstant("drag")},className:Ot+" e-drag "+(e.allowDragAndDrop||void 0===e.allowDragAndDrop?"":Kt)});return a.appendChild(r),"pivotfieldlist"===this.parent.getModuleName()&&i.appendChild(a),a},e.prototype.createSortOption=function(e,i,a){var r,n,o;if(o="olap"===this.parent.dataType?this.parent.olapEngineModule:this.parent.engineModule,this.parent.allowDeferLayoutUpdate){r="";for(var s=0;s<this.parent.dataSourceSettings.sortSettings.length;s++)this.parent.dataSourceSettings.sortSettings[s].name===i&&(r="Descending"===this.parent.dataSourceSettings.sortSettings[s].order?Gt:"")}else r="Descending"===o.fieldList[i].sort?Gt:"";return n="None"===o.fieldList[i].sort?t.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false",title:this.parent.localeObj.getConstant("sort")},className:Ot}):t.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false",title:this.parent.localeObj.getConstant("sort")},className:Ot+" e-sort "+r}),this.parent.dataSourceSettings.enableSorting?"pivotview"===this.parent.getModuleName()?a.showSortIcon&&this.parent.groupingBarSettings.showSortIcon?t.removeClass([n],Nt):t.addClass([n],Nt):a.showSortIcon?t.removeClass([n],Nt):t.addClass([n],Nt):t.addClass([n],Nt),e.appendChild(n),n},e.prototype.createFilterOption=function(e,i,a,r){var n,o;if(o="olap"===this.parent.dataType?this.parent.olapEngineModule:this.parent.engineModule,this.parent.allowDeferLayoutUpdate){n=zt;for(var s=0;s<this.parent.dataSourceSettings.filterSettings.length;s++)this.parent.dataSourceSettings.filterSettings[s].name===i&&(n=Qt)}else o.fieldList[i].filter=null===o.fieldList[i].filter?[]:o.fieldList[i].filter,n=0===o.fieldList[i].filter.length?o.fieldList[i].isExcelFilter?Qt:zt:Qt;var l=t.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false",title:this.parent.localeObj.getConstant("filter")},className:Wt+" "+Ot+" "+n});return(this.parent.dataSourceSettings.allowLabelFilter||this.parent.dataSourceSettings.allowValueFilter)&&"filters"!==a||this.parent.dataSourceSettings.allowMemberFilter?t.removeClass([l],Nt):t.addClass([l],Nt),"pivotview"===this.parent.getModuleName()?((this.parent.dataSourceSettings.allowLabelFilter||this.parent.dataSourceSettings.allowValueFilter)&&"filters"!==a||this.parent.dataSourceSettings.allowMemberFilter)&&this.parent.groupingBarSettings.showFilterIcon&&r.showFilterIcon?t.removeClass([l],Nt):t.addClass([l],Nt):r.showFilterIcon&&((this.parent.dataSourceSettings.allowLabelFilter||this.parent.dataSourceSettings.allowValueFilter)&&"filters"!==a||this.parent.dataSourceSettings.allowMemberFilter)?t.removeClass([l],Nt):t.addClass([l],Nt),e.appendChild(l),l},e.prototype.updateButtontext=function(e){var t,i,a=(t="olap"===this.parent.dataType?this.parent.olapEngineModule:this.parent.engineModule).fieldList[e].filter.length,r=t.fieldList[e].filterType,n=t.fieldList[e].dateMember.length,o=t.fieldList[e].filter[0];if("olap"===this.parent.dataType)i=this.updateOlapButtonText(t,e,o,a);else if("include"===r)1===a?i=o:a>1&&(i=a===n?this.parent.localeObj.getConstant("all"):this.parent.localeObj.getConstant("multipleItems"));else if("exclude"===r){if(1===a)i=2===n?o!==t.fieldList[e].dateMember[0].actualText?o:t.fieldList[e].dateMember[0].actualText:this.parent.localeObj.getConstant("multipleItems");else if(a>1){var s=void 0,l=Object.keys(t.fieldList[e].members),d=t.fieldList[e].filter;if(a===l.length-1)e:for(s=0;s<l.length;s++){var h=l[s];if(-1===d.indexOf(h)){i=l[s];break e}}else i=this.parent.localeObj.getConstant("multipleItems")}}else i=this.parent.localeObj.getConstant("all");return i},e.prototype.updateOlapButtonText=function(e,t,i,a){var r,n=e.fieldList[t].actualFilter;if(n.length>0){var o=e.fieldList[t].members,s=[];if(e.fieldList[t].filterMembers.length>0){for(var l={},d=0,h=n;d<h.length;d++){l[c=h[d]]=c,o[c]&&(l=this.parent.pivotCommon.eventBase.getParentNode(t,c,l))}for(var p=0,u=l?Object.keys(l):[];p<u.length;p++){var c;o[c=u[p]].isSelected&&(o[c].parent&&o[o[c].parent].isSelected||s.push(c))}i=1===s.length?o[s[0]].caption:i}a=0===s.length?a:s.length}return 0===a?r=e.fieldList[t].allMember?e.fieldList[t].allMember:this.parent.localeObj.getConstant("all"):1===a?r=i:a>1&&(r=this.parent.localeObj.getConstant("multipleItems")),r},e.prototype.createDragClone=function(e){var i=t.closest(e.element,"."+_t),a=t.createElement("div",{id:this.parent.element.id+"_DragClone",className:"e-button-drag-clone"}),r=t.createElement("span",{className:yi,innerHTML:i.textContent});return a.appendChild(r),document.body.appendChild(a),a},e.prototype.onDragStart=function(e){var i=this,a=t.closest(e.element,"."+_t),r=document.getElementById(this.parent.element.id+"_DragClone"),n=g.getFieldInfo(a.getAttribute("data-uid"),this.parent),o={fieldName:n.fieldName,fieldItem:n.fieldItem,axis:n.axis,dataSourceSettings:g.getClonedDataSourceSettings(this.parent.dataSourceSettings),cancel:!1};("pivotfieldlist"===this.parent.getModuleName()&&this.parent.isPopupView?this.parent.pivotGridModule:this.parent).trigger(J,o,function(n){if(n.cancel)i.parent.isDragging=!1,i.draggable.intDestroy(e.event),t.detach(r);else{i.parent.isDragging=!0;var o=("olap"===i.parent.dataType?i.parent.olapEngineModule:i.parent.engineModule).fieldList[a.getAttribute("data-uid")],s=[si,li,hi];if(t.addClass([a],Si),r&&"Popup"===("pivotfieldlist"===i.parent.getModuleName()&&i.parent.renderMode)){var l=i.parent;r.style.zIndex=(l.dialogRenderer.fieldListDialog.zIndex+1).toString()}if(o&&"CalculatedField"===o.aggregateType)for(var d=0,h=s;d<h.length;d++){var p=h[d];t.addClass([i.parentElement.querySelector("."+p)],vi)}}})},e.prototype.onDragging=function(e){this.draggable.setProperties({cursorAt:{top:!t.isNullOrUndefined(e.event.targetTouches)||t.Browser.isDevice?60:-20}})},e.prototype.onDragStop=function(e){this.parent.isDragging=!1,e.target&&e.element&&t.closest(e.element,"."+ui)&&!t.closest(e.target,"."+oi)&&(e.cancel=!0);var i=t.closest(e.element,"."+_t);t.removeClass([].slice.call(this.parentElement.querySelectorAll("."+_t)),Si),t.removeClass([].slice.call(this.parentElement.querySelectorAll("."+Xt)),Jt);for(var a=0,r=[si,li,hi];a<r.length;a++){var n=r[a];t.removeClass([this.parentElement.querySelector("."+n)],vi)}if(this.parent.pivotCommon.filterDialog.dialogPopUp&&this.parent.pivotCommon.filterDialog.dialogPopUp.close(),document.getElementById(this.parent.element.id+"_DragClone")&&t.remove(document.getElementById(this.parent.element.id+"_DragClone")),document.body.style.cursor="auto",this.isButtonDropped(e.target,i)&&!e.cancel&&(this.parent.pivotCommon.dataSourceUpdate.control="pivotview"===this.parent.getModuleName()?this.parent:this.parent.pivotGridModule?this.parent.pivotGridModule:this.parent,this.parent.pivotCommon.nodeStateModified.onStateModified(e,i.id))){this.updateDataSource();this.parent.axisFieldModule.render()}},e.prototype.isButtonDropped=function(e,i){var a=t.closest(i,"."+oi),r=t.closest(e,"."+oi),n=!0;if(a&&a===r){for(var o=[].slice.call(a.querySelectorAll("."+_t)),s=t.closest(e,"."+Bt),l=void 0,d=-1,h=0,p=o.length;h<p;h++)if(o[h].id===i.id&&(l=h),s){var u=s.querySelector("."+_t);o[h].id===u.id&&(d=h)}(l===d||l===o.length-1&&-1===d)&&(t.removeClass([].slice.call(this.parentElement.querySelectorAll("."+Xt)),Jt),n=!1)}return n},e.prototype.updateSorting=function(e){var i=t.closest(e.target,"."+_t),a=g.getFieldInfo(i?i.id:"",this.parent);if(!e.target.classList.contains(Wt)&&!e.target.classList.contains(Yt)&&!e.target.classList.contains("e-drag")&&i&&a.fieldItem&&(a.fieldItem.showSortIcon||t.isNullOrUndefined(a.fieldItem.showSortIcon))){if(this.parent.actionObj.actionName=Ue,this.parent.actionObj.fieldInfo=a,this.parent.actionBeginMethod())return;try{if((this.parent instanceof Ln||this.parent.groupingBarSettings.showSortIcon)&&this.parent.dataSourceSettings.enableSorting&&("olap"!==this.parent.dataType||!("pivotfieldlist"===this.parent.getModuleName()&&void 0!==this.parent.pivotGridModule&&this.parent.pivotGridModule.enableVirtualization||"pivotview"===this.parent.getModuleName()&&this.parent.enableVirtualization))){if(("pivotview"===this.parent.getModuleName()&&this.parent.enableValueSorting||"pivotfieldlist"===this.parent.getModuleName()&&void 0!==this.parent.pivotGridModule&&this.parent.pivotGridModule.enableValueSorting)&&(this.parent.enableValueSorting||this.parent.pivotGridModule.enableValueSorting)&&(e.target.classList.contains("e-pivot-button")?"rows"===e.target.parentElement.getAttribute("data-tag").split(":")[0]&&this.parent.setProperties({dataSourceSettings:{valueSortSettings:{headerText:void 0}}},!0):"rows"===e.target.parentElement.parentElement.getAttribute("data-tag").split(":")[0]&&this.parent.setProperties({dataSourceSettings:{valueSortSettings:{headerText:void 0}}},!0)),this.parent.pivotCommon.eventBase.updateSorting(e),!this.parent.allowDeferLayoutUpdate||"pivotfieldlist"!==this.parent.getModuleName()){var r={sortInfo:this.parent.lastSortInfo};this.parent.actionObj.actionInfo=r,this.updateDataSource(!0)}this.parent instanceof Ln&&this.axisField.render()}}catch(e){this.parent.actionFailureMethod(e)}}},e.prototype.updateDataSource=function(e){this.parent.allowDeferLayoutUpdate&&"pivotview"!==this.parent.getModuleName()?"pivotfieldlist"===this.parent.getModuleName()&&this.parent.isPopupView&&this.parent.pivotGridModule?("olap"===this.parent.dataType?this.parent.pivotGridModule.olapEngineModule=this.parent.olapEngineModule:this.parent.pivotGridModule.engineModule=this.parent.engineModule,this.parent.pivotGridModule.notify(ae,this),this.parent.pivotGridModule.setProperties({dataSourceSettings:this.parent.dataSourceSettings.properties},!0)):this.parent.triggerPopulateEvent():this.parent.updateDataSource(e)},e.prototype.updateFiltering=function(e){var t=this.parent.pivotGridModule?this.parent.pivotGridModule:this.parent,i=e.target.parentElement.id,r=g.getFieldInfo(i,this.parent);if(this.parent.actionObj.actionName=Ge,this.parent.actionObj.fieldInfo=r,!this.parent.actionBeginMethod())try{"pivotfieldlist"===t.getModuleName()?a.showSpinner(t.fieldListSpinnerElement):t.showWaitingPopup(),t.mouseEventArgs=e,t.filterTargetID="pivotfieldlist"!==this.parent.pivotCommon.moduleName?this.parent.element:document.getElementById(this.parent.pivotCommon.parentID+"_Wrapper"),"Server"===t.dataSourceSettings.mode?this.parent.engineModule.fieldList[i].members&&Object.keys(this.parent.engineModule.fieldList[i].members).length>0?this.updateFilterEvents():t.getEngine("fetchFieldMembers",null,null,null,null,null,i):this.updateFilterEvents()}catch(e){this.parent.actionFailureMethod(e)}},e.prototype.updateFilterEvents=function(){var e=this.parent.pivotGridModule?this.parent.pivotGridModule:this.parent;this.parent.pivotCommon.eventBase.updateFiltering(e.mouseEventArgs);var t=e.mouseEventArgs.target;this.fieldName=t.parentElement.id,this.parent.pivotCommon.filterDialog.dialogPopUp&&this.bindDialogEvents(),"pivotfieldlist"===e.getModuleName()?a.hideSpinner(e.fieldListSpinnerElement):e.hideWaitingPopup()},e.prototype.bindDialogEvents=function(){this.parent.pivotCommon.filterDialog.allowExcelLikeFilter&&this.parent.pivotCommon.filterDialog.tabObj?(this.index=this.parent.pivotCommon.filterDialog.tabObj.selectedItem,this.updateDialogButtonEvents(),this.parent.pivotCommon.filterDialog.dialogPopUp.buttons=this.buttonModel(),this.parent.pivotCommon.filterDialog.dialogPopUp.dataBind(),this.parent.pivotCommon.filterDialog.tabObj.selected=this.tabSelect.bind(this)):this.parent.dataSourceSettings.allowMemberFilter&&(this.index=0,this.updateDialogButtonEvents())},e.prototype.buttonModel=function(){return[{buttonModel:{cssClass:"e-clear-filter-button"+(this.parent.pivotCommon.filterDialog.allowExcelLikeFilter?"":" "+Nt),iconCss:"e-icons e-clear-filter-icon",enableRtl:this.parent.enableRtl,content:this.parent.localeObj.getConstant("clearFilter"),disabled:!this.parent.pivotCommon.filterDialog.filterObject},click:this.ClearFilter.bind(this)},{buttonModel:{cssClass:ai,content:this.parent.localeObj.getConstant("ok"),isPrimary:!0},click:0===this.index?this.updateFilterState.bind(this,this.fieldName):this.updateCustomFilter.bind(this)},{click:this.parent.pivotCommon.filterDialog.closeFilterDialog.bind(this.parent.pivotCommon.filterDialog),buttonModel:{cssClass:ri,content:this.parent.localeObj.getConstant("cancel")}}]},e.prototype.tabSelect=function(e){this.index=e.selectedIndex,this.updateDialogButtonEvents(),t.removeClass([].slice.call(this.parent.pivotCommon.filterDialog.dialogPopUp.element.querySelectorAll(".e-selected-tab")),"e-selected-tab"),e.selectedIndex>0&&t.addClass([this.parent.pivotCommon.filterDialog.dialogPopUp.element.querySelector(".e-filter-div-content."+(1===e.selectedIndex&&this.parent.dataSourceSettings.allowLabelFilter?"e-label-filter":"e-value-filter"))],"e-selected-tab"),0===e.selectedIndex?this.parent.pivotCommon.filterDialog.updateCheckedState():(this.parent.pivotCommon.filterDialog.dialogPopUp.buttons[0].buttonModel.disabled=!1,this.parent.pivotCommon.filterDialog.dialogPopUp.element.querySelector("."+ai).removeAttribute("disabled"))},e.prototype.updateDialogButtonEvents=function(){this.parent.pivotCommon.filterDialog.dialogPopUp.buttons=this.buttonModel(),this.parent.pivotCommon.filterDialog.dialogPopUp.dataBind()},e.prototype.updateCustomFilter=function(e){var i,a=this,r=this.parent.pivotCommon.filterDialog.dialogPopUp.element.querySelector(".e-selected-tab"),n=r.getAttribute("data-fieldname"),o=r.getAttribute("data-selectedField"),s=r.getAttribute("data-type"),l=r.getAttribute("data-measure"),d=r.getAttribute("data-operator"),h=r.getAttribute("data-value1"),p=r.getAttribute("data-value2"),u="value"===s?"Value":"date"===s?"Date":"number"===s?"Number":"Label",c={name:n,type:u,measure:l,condition:d,value1:"date"===s?new Date(h):h,value2:"date"===s?new Date(p):p};if("olap"===this.parent.dataType){c.selectedField=o,this.removeDataSourceSettings(n,o,u);for(var m=0,f=this.parent.dataSourceSettings.filterSettings;m<f.length;m++){var v=f[m];v.name===n&&v.selectedField===o&&(i=v)}}else i=g.getFilterItemByName(n,this.parent.dataSourceSettings.filterSettings);if(t.isNullOrUndefined(h)||""===h||["Between","NotBetween"].indexOf(d)>-1&&(t.isNullOrUndefined(p)||""===p)){var S=u.toLowerCase()+(t.isNullOrUndefined(h)||""===h?"_input_option_1":"_input_option_2"),y=t.select("#"+this.parent.element.id+"_"+S,r);return t.addClass([y],ga),void y.focus()}var b={cancel:!1,filterSettings:c,dataSourceSettings:g.getClonedDataSourceSettings(this.parent.dataSourceSettings)};("pivotfieldlist"===this.parent.getModuleName()&&this.parent.isPopupView?this.parent.pivotGridModule:this.parent).trigger(W,b,function(e){e.cancel||(c=e.filterSettings,i?((i=i.properties?i.properties:i).type=c.type,i.measure=c.measure,i.condition=c.condition,i.value1=c.value1,i.value2=c.value2,"olap"===a.parent.dataType&&(i.selectedField=c.selectedField)):a.parent.dataSourceSettings.filterSettings.push(c)),"Value"!==u&&(a.parent.lastFilterInfo=g.getFilterItemByName(n,a.parent.dataSourceSettings.filterSettings)),a.parent.pivotCommon.filterDialog.dialogPopUp.close(),e.cancel||(a.refreshPivotButtonState(n,!0),a.updateDataSource(!0))})},e.prototype.ClearFilter=function(e){var t=this.parent.pivotCommon.filterDialog.dialogPopUp.element,i=t.getAttribute("data-fieldname"),a=t.querySelector(".e-selected-tab");if(this.parent.pivotCommon.filterDialog.dialogPopUp.close(),"olap"===this.parent.dataType&&a){var r=a.getAttribute("data-selectedField");this.removeDataSourceSettings(i,r)}else this.removeDataSourceSettings(i);var n=g.getFilterItemByName(i,this.parent.dataSourceSettings.filterSettings);this.refreshPivotButtonState(i,!!n),this.updateDataSource(!0)},e.prototype.removeButton=function(e){var t=this,i=e.target,a=i.parentElement.id,r=g.getFieldInfo(a,this.parent);if(this.parent.actionObj.actionName=We,this.parent.actionObj.fieldInfo=r,!this.parent.actionBeginMethod()){var n={cancel:!1,fieldName:a,dataSourceSettings:g.getClonedDataSourceSettings(this.parent.dataSourceSettings),fieldItem:r.fieldItem,axis:r.axis};try{("pivotfieldlist"===this.parent.getModuleName()&&this.parent.isPopupView?this.parent.pivotGridModule:this.parent).trigger(Y,n,function(e){e.cancel||("true"===i.parentElement.getAttribute("isvalue")?(t.parent.setProperties({dataSourceSettings:{values:[]}},!0),"olap"===t.parent.dataType&&t.parent.pivotCommon.dataSourceUpdate.removeFieldFromReport("[Measures]")):(t.parent.pivotCommon.dataSourceUpdate.removeFieldFromReport(a),"pivot"===t.parent.dataType&&t.parent.showValuesButton&&t.parent.dataSourceSettings.values.length>1&&r.position<t.parent.dataSourceSettings.valueIndex&&("row"===t.parent.dataSourceSettings.valueAxis&&"rows"===e.axis||"column"===t.parent.dataSourceSettings.valueAxis&&"columns"===e.axis)&&t.parent.setProperties({dataSourceSettings:{valueIndex:t.parent.dataSourceSettings.valueIndex-1}},!0),"olap"===t.parent.dataType&&0===t.parent.dataSourceSettings.values.length&&t.parent.pivotCommon.dataSourceUpdate.removeFieldFromReport("[Measures]")),"pivotfieldlist"===t.parent.getModuleName()&&t.parent.axisFieldModule.render(),t.updateDataSource())})}catch(e){this.parent.actionFailureMethod(e)}}},e.prototype.nodeStateModified=function(e){var i=t.closest(e.node,"li"),a=i.getAttribute("data-fieldname");if("all"===i.getAttribute("data-memberId"))this.parent.pivotCommon.filterDialog.memberTreeView.nodeChecked=null,"check"===e.action?this.parent.pivotCommon.filterDialog.memberTreeView.checkAll():this.parent.pivotCommon.filterDialog.memberTreeView.uncheckAll(),"olap"===this.parent.dataType&&this.parent.olapEngineModule&&!this.parent.olapEngineModule.fieldList[a].isHierarchy&&this.updateNodeStates(this.parent.pivotCommon.filterDialog.memberTreeView.getAllCheckedNodes(),a,e.action),this.checkedStateAll(e.action),this.parent.pivotCommon.filterDialog.memberTreeView.nodeChecked=this.nodeStateModified.bind(this);else{if("olap"===this.parent.dataType&&this.parent.olapEngineModule&&!this.parent.olapEngineModule.fieldList[a].isHierarchy){var r=this.parent.pivotCommon.filterDialog.memberTreeView.getAllCheckedNodes();this.updateNodeStates(r,a,e.action)}var n=this.parent.pivotCommon.currentTreeItemsPos[i.getAttribute("data-memberId")].index;this.parent.pivotCommon.currentTreeItems[n]&&(this.parent.pivotCommon.currentTreeItems[n].isSelected="check"===e.action,this.parent.pivotCommon.currentTreeItemsPos[i.getAttribute("data-memberId")].isSelected="check"===e.action)}this.parent.pivotCommon.filterDialog.updateCheckedState()},e.prototype.checkedStateAll=function(e){for(var t={},i=0,a=this.parent.pivotCommon.searchTreeItems;i<a.length;i++){(o=a[i]).isSelected="check"===e,t[o.htmlAttributes["data-memberId"]]=o.htmlAttributes["data-memberId"]}for(var r=0,n=this.parent.pivotCommon.currentTreeItems;r<n.length;r++){var o;void 0!==t[(o=n[r]).htmlAttributes["data-memberId"]]&&(o.isSelected="check"===e,this.parent.pivotCommon.currentTreeItemsPos[o.htmlAttributes["data-memberId"]].isSelected="check"===e)}},e.prototype.updateNodeStates=function(e,t,i){var a=this.parent.pivotCommon.engineModule.fieldList[t],r=a.members,n=a.currrentMembers;if(a.searchMembers.length>0){for(var o=0,s=Object.keys(n);o<s.length;o++){if(n[c=s[o]]&&(n[c].isSelected=!1),r[c]&&(r[c].isSelected=!1,this.parent.pivotCommon.filterDialog.memberTreeView.element.querySelector('li[data-memberId="'+c+'"]'))){(h=this.parent.pivotCommon.filterDialog.memberTreeView.element.querySelector('li[data-memberId="'+c+'"]'))&&!h.querySelector("ul")&&this.parent.pivotCommon.eventBase.updateChildNodeStates(a.filterMembers,t,c,!1)}}for(var l=0,d=e;l<d.length;l++){if(r[f=d[l]]&&this.parent.pivotCommon.filterDialog.memberTreeView.element.querySelector('li[data-memberId="'+f+'"]')){var h;(h=this.parent.pivotCommon.filterDialog.memberTreeView.element.querySelector('li[data-memberId="'+f+'"]'))&&!h.querySelector("ul")&&(r[f].isSelected=!0,this.parent.pivotCommon.eventBase.updateChildNodeStates(a.filterMembers,t,f,!0))}n[f]&&(n[f].isSelected=!0)}}else{for(var p=0,u=Object.keys(r);p<u.length;p++){var c;r[c=u[p]].isSelected&&(r[c].isSelected=!1)}for(var g=0,m=e;g<m.length;g++){var f;r[f=m[g]]&&(r[f].isSelected=!0,this.parent.pivotCommon.eventBase.updateChildNodeStates(a.filterMembers,t,f,!0))}}},e.prototype.updateFilterState=function(e,t){var i=this,a=!1,r={items:[],name:e,type:"Include"},n=this.parent.olapEngineModule;if("olap"===this.parent.dataType&&n&&!n.fieldList[e].isHierarchy){var o=n.fieldList[e].members,s=n.fieldList[e].currrentMembers;if(r.items=this.parent.pivotCommon.filterDialog.memberTreeView.getAllCheckedNodes(),r.levelCount=n.fieldList[e].levelCount,a=r.items.length!==this.parent.pivotCommon.filterDialog.memberTreeView.fields.dataSource.length,n.fieldList[e].searchMembers.length>0&&!a){var l=Object.keys(o).length,d=Object.keys(s).length;a=l!==d||l!==r.items.length}for(var h=0,p=r.items;h<p.length;h++){var u=p[h];n.fieldList[e].searchMembers.length>0&&s[u]?s[u].isSelected=!0:o[u]&&(o[u].isSelected=!0)}}else{for(var c=0,m=this.parent.pivotCommon.searchTreeItems;c<m.length;c++){var f=m[c];f.isSelected&&(this.parent.pivotCommon.isDateField?r.items.push(f.name):r.items.push(f.htmlAttributes["data-memberId"]))}a=r.items.length!==this.parent.pivotCommon.currentTreeItems.length}if("olap"===this.parent.dataType&&this.removeDataSourceSettings(e),this.parent.allowDeferLayoutUpdate){this.parent.engineModule.fieldList[r.name].filterType=r.type.toLowerCase(),this.parent.engineModule.fieldList[r.name].filter=[];for(var v=0;v<r.items.length;v++)this.parent.engineModule.fieldList[r.name].filter.push(r.items[v])}var S={filterSettings:r,dataSourceSettings:g.getClonedDataSourceSettings(this.parent.dataSourceSettings),cancel:!1};("pivotfieldlist"===this.parent.getModuleName()&&this.parent.isPopupView?this.parent.pivotGridModule:this.parent).trigger(W,S,function(t){if(r=t.filterSettings,!t.cancel){if(g.getFilterItemByName(e,i.parent.dataSourceSettings.filterSettings))for(var n=0;n<i.parent.dataSourceSettings.filterSettings.length;n++)if(i.parent.dataSourceSettings.filterSettings[n].name===e){i.parent.dataSourceSettings.filterSettings.splice(n,1);break}i.parent.dataSourceSettings.filterSettings.push(r)}if(i.parent.pivotCommon.filterDialog.dialogPopUp.close(),!t.cancel){i.refreshPivotButtonState(e,a),a||(i.removeDataSourceSettings(e),r={}),i.parent.lastFilterInfo=r;var o={filterInfo:i.parent.lastFilterInfo};i.parent.actionObj.actionInfo=o,i.updateDataSource(!0);var s=i;s.parent instanceof Ln&&s.axisField.render()}for(var l=0,d=[].slice.call(i.parentElement.querySelectorAll(".e-pivot-button"));l<d.length;l++){var h=d[l];if(h.getAttribute("data-uid")===e){h.focus();break}}})},e.prototype.refreshPivotButtonState=function(e,i){for(var a,r=0,n=[].slice.call(this.parentElement.querySelectorAll(".e-pivot-button"));r<n.length;r++){var o=n[r];if(o.getAttribute("data-uid")===e){a=o.querySelector("."+Wt);break}}i?(t.removeClass([a],zt),t.addClass([a],Qt)):(t.removeClass([a],Qt),t.addClass([a],zt))},e.prototype.removeDataSourceSettings=function(e,t,i){for(var a=this.parent.dataSourceSettings.filterSettings,r=0,n=a.length;r<n;r++)if("olap"===this.parent.dataType&&t){if(!i&&a[r].name===e&&a[r].selectedField===t){a.splice(r,1);break}i&&a[r].type!==i&&a[r].name===e&&(a.splice(r,1),n--,r--)}else if(a[r].name===e){if(a.splice(r,1),"olap"!==this.parent.dataType)break;n--,r--}},e.prototype.updateDropIndicator=function(e){if(this.parent.isDragging&&(t.removeClass([].slice.call(this.parentElement.querySelectorAll("."+Xt+"-last")),Jt),t.removeClass([].slice.call(this.parentElement.querySelectorAll("."+Xt)),Jt),t.closest(e.target,"."+oi))){var i=t.closest(e.target,"."+Bt);t.addClass([i.querySelector("."+Xt)],Jt)}},e.prototype.wireEvent=function(e,i,a){t.EventHandler.add(e,"mouseover",this.updateDropIndicator,this),a||(-1===["filters","values"].indexOf(i)&&null!==e.querySelector("."+_t)&&t.EventHandler.add(e.querySelector("."+_t),"click",this.updateSorting,this),"values"!==i&&null!==e.querySelector("."+Wt)&&t.EventHandler.add(e.querySelector("."+Wt),"click",this.updateFiltering,this),"values"===i&&null!==e.querySelector("."+Pt)&&t.EventHandler.add(e.querySelector("."+Pt),"click",this.createMenuOption,this)),null!==e.querySelector(".e-edit")&&t.EventHandler.add(e.querySelector(".e-edit"),"click",this.openCalculatedFieldDialog,this),null!==e.querySelector("."+Yt)&&t.EventHandler.add(e.querySelector("."+Yt),"click",this.removeButton,this)},e.prototype.unWireEvent=function(e,i,a){t.EventHandler.remove(e,"mouseover",this.updateDropIndicator),a||(-1===["filters","values"].indexOf(i)&&null!==e.querySelector("."+_t)&&t.EventHandler.remove(e.querySelector("."+_t),"click",this.updateSorting),"values"!==i&&null!==e.querySelector("."+Wt)&&t.EventHandler.remove(e.querySelector("."+Wt),"click",this.updateFiltering),"values"===i&&null!==e.querySelector("."+Pt)&&t.EventHandler.remove(e.querySelector("."+Pt),"click",this.createMenuOption)),null!==e.querySelector(".e-edit")&&t.EventHandler.remove(e.querySelector(".e-edit"),"click",this.openCalculatedFieldDialog),null!==e.querySelector("."+Yt)&&t.EventHandler.remove(e.querySelector("."+Yt),"click",this.removeButton)},e.prototype.addEventListener=function(){this.handlers={load:this.renderPivotButton},this.parent.isDestroyed||this.parent.on(le,this.handlers.load,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(le,this.handlers.load)},e.prototype.destroy=function(){this.menuOption&&this.menuOption.destroy(),this.valueFiedDropDownList&&!this.valueFiedDropDownList.isDestroyed&&(this.valueFiedDropDownList.destroy(),this.valueFiedDropDownList=null),this.columnFieldDropDownList&&!this.columnFieldDropDownList.isDestroyed&&(this.columnFieldDropDownList.destroy(),this.columnFieldDropDownList=null),this.draggable&&!this.draggable.isDestroyed&&(this.draggable.destroy(),this.draggable=null),this.axisField&&(this.axisField=null),this.removeEventListener(),this.isDestroyed=!0},e}(),En=function(){function e(e){this.parent=e}return e.prototype.render=function(){!this.parent.pivotButtonModule||this.parent.pivotButtonModule&&this.parent.pivotButtonModule.isDestroyed?new Nn(this.parent):this.parent.pivotButtonModule;this.createPivotButtons()},e.prototype.createPivotButtons=function(){t.isNullOrUndefined(this.parent.dataSourceSettings.dataSource)&&t.isNullOrUndefined(this.parent.dataSourceSettings.url)&&this.parent.setProperties({dataSourceSettings:{columns:[],rows:[],values:[],filters:[]}},!0);var e=[this.parent.dataSourceSettings.rows,this.parent.dataSourceSettings.columns,this.parent.dataSourceSettings.values,this.parent.dataSourceSettings.filters],i=this.parent.dialogRenderer.parentElement;i.querySelector("."+Lt+"-filters")&&(i.querySelector("."+Lt+"-filters").querySelector("."+Vt).innerHTML=""),i.querySelector("."+Lt+"-rows")&&(i.querySelector("."+Lt+"-rows").querySelector("."+Vt).innerHTML=""),i.querySelector("."+Lt+"-columns")&&(i.querySelector("."+Lt+"-columns").querySelector("."+Vt).innerHTML=""),i.querySelector("."+Lt+"-values")&&(i.querySelector("."+Lt+"-values").querySelector("."+Vt).innerHTML="");for(var a=["rows","columns","values","filters"],r=0,n=e.length;r<n;r++)if(e[r]){var o={field:e[r],axis:a[r].toString()};this.parent.notify(le,o)}},e}(),Pn=function(){function e(e){this.parent=e,this.parent.dialogRenderer=new Mn(this.parent),this.parent.treeViewModule=new Dn(this.parent),this.parent.axisTableModule=new On(this.parent),this.parent.axisFieldModule=new En(this.parent)}return e.prototype.render=function(){this.parent.dialogRenderer.render(),this.parent.isAdaptive||this.parent.treeViewModule.render(),this.parent.axisTableModule.render()},e}(),Fn=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function a(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),In=function(e,t,i,a){var r,n=arguments.length,o=n<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},Ln=function(e){function r(t,i){var a=e.call(this,t,i)||this;return a.pivotChange=!1,a.isRequiredUpdate=!0,a.lastSortInfo={},a.lastFilterInfo={},a.lastAggregationInfo={},a.lastCalcFieldInfo={},a.isPopupView=!1,a.enableValueSorting=!1,a.request=new XMLHttpRequest,a.remoteData=[],a.actionObj={},a.destroyEngine=!1,a}return Fn(r,e),r.prototype.requiredModules=function(){var e=[];return this.allowCalculatedField&&e.push({args:[this],member:"calculatedField"}),e},r.prototype.getAllSummaryType=function(){return["Sum","Count","DistinctCount","Product","Min","Max","Avg","Median","Index","PopulationVar","SampleVar","PopulationStDev","SampleStDev","RunningTotals","PercentageOfGrandTotal","PercentageOfColumnTotal","PercentageOfRowTotal","PercentageOfParentColumnTotal","PercentageOfParentRowTotal","DifferenceFrom","PercentageOfDifferenceFrom","PercentageOfParentTotal"]},r.prototype.preRender=function(){this.dataSourceSettings&&"SSAS"===this.dataSourceSettings.providerType?(this.olapEngineModule=new cn,this.dataType="olap"):(this.engineModule=new f,this.dataType="pivot"),this.isAdaptive=t.Browser.isDevice,this.globalize=new t.Internationalization(this.locale),this.renderModule=new Pn(this),this.defaultLocale={staticFieldList:"Pivot Field List",fieldList:"Field List",dropFilterPrompt:"Drop filter here",dropColPrompt:"Drop column here",dropRowPrompt:"Drop row here",dropValPrompt:"Drop value here",addPrompt:"Add field here",adaptiveFieldHeader:"Choose field",centerHeader:"Drag fields between axes below:",add:"add",drag:"Drag",filter:"Filter",filtered:"Filtered",sort:"Sort",remove:"Remove",filters:"Filters",rows:"Rows",columns:"Columns",values:"Values",CalculatedField:"Calculated Field",createCalculatedField:"Create Calculated Field",fieldName:"Enter the field name",error:"Error",invalidFormula:"Invalid formula.",dropText:'Example: ("Sum(Order_Count)" + "Sum(In_Stock)") * 250',dropTextMobile:"Add fields and edit formula here.",dropAction:"Calculated field cannot be place in any other region except value axis.",search:"Search",close:"Close",cancel:"Cancel",delete:"Delete",alert:"Alert",warning:"Warning",ok:"OK",allFields:"All Fields",formula:"Formula",fieldExist:"A field already exists in this name. Please enter a different name.",confirmText:"A calculation field already exists in this name. Do you want to replace it?",noMatches:"No matches",format:"Summaries values by",edit:"Edit",clear:"Clear",clearCalculatedField:"Clear edited field info",editCalculatedField:"Edit calculated field",sortAscending:"Sort ascending order",sortDescending:"Sort descending order",sortNone:"Sort data order",formulaField:"Drag and drop fields to formula",dragField:"Drag field to formula",clearFilter:"Clear",by:"by",enterValue:"Enter value",chooseDate:"Enter date",all:"All",multipleItems:"Multiple items",Equals:"Equals",DoesNotEquals:"Does Not Equal",BeginWith:"Begins With",DoesNotBeginWith:"Does Not Begin With",EndsWith:"Ends With",DoesNotEndsWith:"Does Not End With",Contains:"Contains",DoesNotContains:"Does Not Contain",GreaterThan:"Greater Than",GreaterThanOrEqualTo:"Greater Than Or Equal To",LessThan:"Less Than",LessThanOrEqualTo:"Less Than Or Equal To",Between:"Between",NotBetween:"Not Between",Before:"Before",BeforeOrEqualTo:"Before Or Equal To",After:"After",AfterOrEqualTo:"After Or Equal To",member:"Member",label:"Label",date:"Date",value:"Value",labelTextContent:"Show the items for which the label",dateTextContent:"Show the items for which the date",valueTextContent:"Show the items for which",And:"and",Sum:"Sum",Count:"Count",DistinctCount:"Distinct Count",Product:"Product",Avg:"Avg",Median:"Median",Min:"Min",Max:"Max",Index:"Index",SampleStDev:"Sample StDev",PopulationStDev:"Population StDev",SampleVar:"Sample Var",PopulationVar:"Population Var",RunningTotals:"Running Totals",DifferenceFrom:"Difference From",PercentageOfDifferenceFrom:"% of Difference From",PercentageOfGrandTotal:"% of Grand Total",PercentageOfColumnTotal:"% of Column Total",PercentageOfRowTotal:"% of Row Total",PercentageOfParentTotal:"% of Parent Total",PercentageOfParentColumnTotal:"% of Parent Column Total",PercentageOfParentRowTotal:"% of Parent Row Total",MoreOption:"More...",Years:"Years",Quarters:"Quarters",Months:"Months",Days:"Days",Hours:"Hours",Minutes:"Minutes",Seconds:"Seconds",apply:"Apply",valueFieldSettings:"Value field settings",sourceName:"Field name :",sourceCaption:"Field caption",summarizeValuesBy:"Summarize values by",baseField:"Base field",baseItem:"Base item",example:"e.g:",editorDataLimitMsg:" more items. Search to refine further.",deferLayoutUpdate:"Defer Layout Update",null:"null",undefined:"undefined",groupOutOfRange:"Out of Range",fieldDropErrorAction:"The field you are moving cannot be placed in that area of the report",memberType:"Field Type",selectedHierarchy:"Parent Hierarchy",formatString:"Format",expressionField:"Expression",olapDropText:"Example: [Measures].[Order Quantity] + ([Measures].[Order Quantity] * 0.10)",customFormat:"Enter custom format string",numberFormatString:"Example: C, P, 0000 %, ###0.##0#, etc.",Measure:"Measure",Dimension:"Dimension",Standard:"Standard",Currency:"Currency",Percent:"Percent",Custom:"Custom",blank:"(Blank)",fieldTooltip:'Drag and drop fields to create an expression. And, if you want to edit the existing calculated fields! You can achieve it by simply selecting the field under "Calculated Members".',fieldTitle:"Field Name",QuarterYear:"Quarter Year",caption:"Field Caption",copy:"Copy",of:"of",group:"Group",removeCalculatedField:"Are you sure you want to delete this calculated field?",yes:"Yes",no:"No"},this.localeObj=new t.L10n(this.getModuleName(),this.defaultLocale,this.locale),this.isDragging=!1,this.captionData=[],this.wireEvent()},r.prototype.frameCustomProperties=function(e,t){this.pivotGridModule&&this.pivotGridModule.updatePageSettings(!1);var i=this.pivotGridModule?this.pivotGridModule.pageSettings:this.pageSettings,a=this.pivotGridModule?this.pivotGridModule.localeObj:this.staticPivotGridModule?this.staticPivotGridModule.localeObj:this.localeObj,r=!this.pivotGridModule||(this.pivotGridModule.allowDrillThrough||this.pivotGridModule.editSettings.allowEditing),n=this.pivotGridModule?this.pivotGridModule.enableValueSorting:void 0;return"olap"===this.dataType?{mode:"",savedFieldList:t||void 0,savedFieldListData:e||void 0,pageSettings:i,enableValueSorting:n,isDrillThrough:r,localeObj:a}:{mode:"",savedFieldList:void 0,pageSettings:i,enableValueSorting:n,isDrillThrough:r,localeObj:a,clonedReport:this.clonedReport,globalize:this.globalize,currenyCode:this.currencyCode}},r.prototype.render=function(){"pivot"===this.dataType&&this.dataSourceSettings.url&&""!==this.dataSourceSettings.url?"Server"===this.dataSourceSettings.mode?(this.guid=g.generateUUID(),this.getEngine("initialRender",null,null,null,null,null,null)):(this.request.open("GET",this.dataSourceSettings.url,!0),this.request.withCredentials=!1,this.request.onreadystatechange=this.onReadyStateChange.bind(this),this.request.setRequestHeader("Content-type","text/plain"),this.request.send(null)):this.initialLoad()},r.prototype.getEngine=function(e,t,i,a,r,n,o,s,l){var d=this;this.currentAction=e,this.pivotGridModule&&this.pivotGridModule.updatePageSettings(!1);var h={pageSettings:this.pivotGridModule?this.pivotGridModule.pageSettings:void 0,enableValueSorting:this.pivotGridModule?this.pivotGridModule.enableValueSorting:void 0,enableDrillThrough:!this.pivotGridModule||(this.pivotGridModule.allowDrillThrough||this.pivotGridModule.editSettings.allowEditing),locale:JSON.stringify(g.getLocalizedObject(this))};this.request.open("POST",this.dataSourceSettings.url,!0);var p={request:this.request,dataSourceSettings:JSON.parse(this.getPersistData()).dataSourceSettings,action:e,customProperties:{},internalProperties:h,drillItem:t,sortItem:i,aggregatedItem:a,calculatedItem:r,filterItem:n,memberName:o,fetchRawDataArgs:s,editArgs:l,hash:this.guid};this.trigger(Z,p,function(e){d.request=e.request,p.internalProperties=e.internalProperties,p.customProperties=e.customProperties,p.dataSourceSettings=e.dataSourceSettings,p.calculatedItem=e.calculatedItem,p.drillItem=e.drillItem,p.editArgs=e.editArgs,p.fetchRawDataArgs=e.fetchRawDataArgs,p.filterItem=e.filterItem,p.hash=e.hash,p.memberName=e.memberName,p.sortItem=e.sortItem}),this.request.withCredentials=!1,this.request.onreadystatechange=this.onSuccess.bind(this),this.request.setRequestHeader("Content-type","application/json"),this.request.send(JSON.stringify(p))},r.prototype.onSuccess=function(){if(this.request.readyState===XMLHttpRequest.DONE){try{var e=JSON.parse(this.request.responseText);if("fetchFieldMembers"===this.currentAction){for(var t=JSON.parse(e.members),i=[],a={},r={},n=0;n<t.length;n++)i.push({formattedText:t[n].FormattedText,actualText:t[n].ActualText}),a[t[n].FormattedText]={},r[t[n].ActualText]={};this.engineModule.fieldList[e.memberName].dateMember=i,this.engineModule.fieldList[e.memberName].formattedMembers=a,this.engineModule.fieldList[e.memberName].members=r,this.pivotButtonModule.updateFilterEvents()}else{var o=g.formatFieldList(JSON.parse(e.fieldList));if(this.engineModule.fieldList){var s=Object.keys(this.engineModule.fieldList);for(n=0;n<s.length;n++)this.engineModule.fieldList[s[n]]&&o[s[n]]&&(o[s[n]].dateMember=this.engineModule.fieldList[s[n]].dateMember,o[s[n]].formattedMembers=this.engineModule.fieldList[s[n]].formattedMembers,o[s[n]].members=this.engineModule.fieldList[s[n]].members)}this.engineModule.fieldList=o,this.engineModule.fields=JSON.parse(e.fields),this.engineModule.rowCount=JSON.parse(e.pivotCount).RowCount,this.engineModule.columnCount=JSON.parse(e.pivotCount).ColumnCount,this.engineModule.rowStartPos=JSON.parse(e.pivotCount).RowStartPosition,this.engineModule.colStartPos=JSON.parse(e.pivotCount).ColumnStartPosition,this.engineModule.rowFirstLvl=JSON.parse(e.pivotCount).RowFirstLevel,this.engineModule.colFirstLvl=JSON.parse(e.pivotCount).ColumnFirstLevel;for(var l=void 0,d=g.formatPivotValues(JSON.parse(e.pivotValue)),h=0;h<d.length;h++)if(d[h]&&d[h][0]&&"row"===d[h][0].axis){l=h;break}this.engineModule.headerContent=g.frameContent(d,"header",l,this),this.engineModule.pageSettings=this.pivotGridModule?this.pivotGridModule.pageSettings:void 0;var p=JSON.parse(e.dataSourceSettings).ValueSortSettings;this.engineModule.valueSortSettings={headerText:p.HeaderText,headerDelimiter:p.HeaderDelimiter,sortOrder:p.SortOrder,columnIndex:p.ColumnIndex},this.engineModule.pivotValues=d}}catch(e){this.engineModule.pivotValues=[]}"fetchFieldMembers"!==this.currentAction&&(this.initEngine(),this.calculatedFieldModule&&this.calculatedFieldModule.isRequireUpdate&&(this.calculatedFieldModule.endDialog(),this.calculatedFieldModule.isRequireUpdate=!1),this.pivotGridModule&&this.pivotGridModule.calculatedFieldModule&&this.pivotGridModule.calculatedFieldModule.isRequireUpdate&&(this.pivotGridModule.calculatedFieldModule.endDialog(),this.pivotGridModule.calculatedFieldModule.isRequireUpdate=!1))}},r.prototype.onReadyStateChange=function(){if(this.request.readyState===XMLHttpRequest.DONE){var e=[];if("CSV"===this.dataSourceSettings.type)for(var i=this.request.responseText.split(/\r?\n|\r/),a=0;a<i.length;a++)t.isNullOrUndefined(i[a])||""===i[a]||e.push(i[a].split(","));else try{e=JSON.parse(this.request.responseText)}catch(t){e=[]}e&&e.length>0&&this.setProperties({dataSourceSettings:{dataSource:e}},!0),this.initialLoad()}},r.prototype.initialLoad=function(){var e=this;this.trigger("load",{dataSourceSettings:this.dataSourceSettings},function(i){e.dataSourceSettings=i.dataSourceSettings,t.addClass([e.element],Tt),e.enableRtl?t.addClass([e.element],Mt):t.removeClass([e.element],Mt),e.isAdaptive?t.addClass([e.element],Dt):t.removeClass([e.element],Dt),e.cssClass&&t.addClass([e.element],e.cssClass),e.notify(ie,{})})},r.prototype.wireEvent=function(){this.on(ie,this.generateData,this),this.on(ne,this.fieldListRender,this)},r.prototype.unWireEvent=function(){this.pivotGridModule&&this.pivotGridModule.isDestroyed||(this.off(ie,this.generateData),this.off(ne,this.fieldListRender))},r.prototype.getPersistData=function(){return this.addOnPersist(["dataSourceSettings"])},r.prototype.getModuleName=function(){return"pivotfieldlist"},r.prototype.onPropertyChanged=function(i,a){for(var r=!1,n=0,o=Object.keys(i);n<o.length;n++){var s=o[n];switch(s){case"locale":e.prototype.refresh.call(this);break;case"dataSourceSettings":if(t.isNullOrUndefined(i.dataSourceSettings.dataSource)||(t.isNullOrUndefined(this.savedDataSourceSettings)||(g.updateDataSourceSettings(this.staticPivotGridModule,this.savedDataSourceSettings),this.savedDataSourceSettings=void 0),i.dataSourceSettings.dataSource&&0===i.dataSourceSettings.dataSource.length&&!t.isNullOrUndefined(this.staticPivotGridModule)&&(this.savedDataSourceSettings=g.getClonedDataSourceSettings(this.staticPivotGridModule.dataSourceSettings),this.staticPivotGridModule.setProperties({dataSourceSettings:{rows:[]}},!0),this.staticPivotGridModule.setProperties({dataSourceSettings:{columns:[]}},!0),this.staticPivotGridModule.setProperties({dataSourceSettings:{values:[]}},!0),this.staticPivotGridModule.setProperties({dataSourceSettings:{filters:[]}},!0)),this.engineModule.fieldList=null,t.isNullOrUndefined(this.staticPivotGridModule)||(this.staticPivotGridModule.pivotValues=[]),this.initEngine()),g.isButtonIconRefesh(s,a,i)){if(this.isPopupView&&this.pivotGridModule&&this.pivotGridModule.showGroupingBar&&this.pivotGridModule.groupingBarModule){var l=g.cloneFieldSettings(this.dataSourceSettings.filters),d=g.cloneFieldSettings(this.dataSourceSettings.values),h=g.cloneFieldSettings(this.dataSourceSettings.rows),p=g.cloneFieldSettings(this.dataSourceSettings.columns);this.pivotGridModule.setProperties({dataSourceSettings:{rows:h,columns:p,values:d,filters:l}},!0),this.pivotGridModule.axisFieldModule.render()}else if(!this.isPopupView&&this.staticPivotGridModule&&!this.staticPivotGridModule.isDestroyed){var u=this.staticPivotGridModule;if(u.showGroupingBar&&u.groupingBarModule&&u.axisFieldModule.render(),u.showFieldList&&u.pivotFieldListModule){h=g.cloneFieldSettings(u.dataSourceSettings.rows),p=g.cloneFieldSettings(u.dataSourceSettings.columns),d=g.cloneFieldSettings(u.dataSourceSettings.values),l=g.cloneFieldSettings(u.dataSourceSettings.filters);u.pivotFieldListModule.setProperties({dataSourceSettings:{rows:h,columns:p,values:d,filters:l}},!0),u.pivotFieldListModule.axisFieldModule.render(),u.pivotFieldListModule.treeViewModule.fieldTable&&!u.isAdaptive&&u.pivotFieldListModule.notify(se,{})}}this.axisFieldModule.render(),this.treeViewModule.fieldTable&&!this.isAdaptive&&this.notify(se,{})}break;case"aggregateTypes":this.axisFieldModule&&this.axisFieldModule.render(),this.pivotGridModule&&this.pivotGridModule.axisFieldModule&&(this.pivotGridModule.setProperties({aggregateTypes:i.aggregateTypes},!0),this.pivotGridModule.axisFieldModule.render());break;case"showValuesButton":this.axisFieldModule&&this.axisFieldModule.render(),this.pivotGridModule&&this.pivotGridModule.showGroupingBar&&this.pivotGridModule.groupingBarModule&&this.pivotGridModule.axisFieldModule&&(this.pivotGridModule.setProperties({showValuesButton:i.showValuesButton},!0),this.pivotGridModule.axisFieldModule.render());break;case"enableRtl":this.enableRtl?t.addClass([this.element],Mt):t.removeClass([this.element],Mt),r=!0}r&&this.fieldListRender()}},r.prototype.initEngine=function(){var e=this;if("pivot"===this.dataType){var i=t.isNullOrUndefined(this.dataSourceSettings.dataSource)?t.isNullOrUndefined(this.engineModule.data)?void 0:this.engineModule.data[0]:this.dataSourceSettings.dataSource[0];if(i&&this.pivotCommon){var a="[object Array]"==Object.prototype.toString.call(i);if(a&&"JSON"===this.dataSourceSettings.type)return void this.pivotCommon.errorDialog.createErrorDialog(this.localeObj.getConstant("error"),this.localeObj.getConstant("invalidJSON"));if(!a&&"CSV"===this.dataSourceSettings.type)return void this.pivotCommon.errorDialog.createErrorDialog(this.localeObj.getConstant("error"),this.localeObj.getConstant("invalidCSV"))}}var r={dataSourceSettings:g.getClonedDataSourceSettings(this.dataSourceSettings)},n=this.isPopupView?this.pivotGridModule:this;n.trigger(v,r,function(t){if(g.updateDataSourceSettings(e,t.dataSourceSettings),"pivot"===e.dataType){if(e.dataSourceSettings.groupSettings&&e.dataSourceSettings.groupSettings.length>0){var i=void 0;i=e.dataSourceSettings.dataSource,e.clonedDataSet=e.clonedDataSet?e.clonedDataSet:g.getClonedData(i);var a=JSON.parse(e.getPersistData()).dataSourceSettings;a.dataSource=[],e.clonedReport=e.clonedReport?e.clonedReport:a}var r=e.frameCustomProperties();r.enableValueSorting=e.staticPivotGridModule?e.staticPivotGridModule.enableValueSorting:e.enableValueSorting,"Server"!==e.dataSourceSettings.mode&&e.engineModule.renderEngine(e.dataSourceSettings,r,e.getValueCellInfo.bind(e)),e.pivotFieldList=e.engineModule.fieldList;var o={pivotFieldList:e.pivotFieldList,pivotValues:e.engineModule.pivotValues},s=e;n.trigger(S,o,function(e){s.pivotFieldList=e.pivotFieldList,s.engineModule.pivotValues=e.pivotValues,s.notify(ne,{}),s.trigger(D)})}else if("olap"===e.dataType){e.olapEngineModule.renderEngine(e.dataSourceSettings,e.frameCustomProperties(e.olapEngineModule.fieldListData,e.olapEngineModule.fieldList)),e.pivotFieldList=e.olapEngineModule.fieldList;o={pivotFieldList:e.pivotFieldList,pivotValues:e.olapEngineModule.pivotValues};var l=e;n.trigger(S,o,function(e){l.pivotFieldList=e.pivotFieldList,l.olapEngineModule.pivotValues=e.pivotValues,l.notify(ne,{}),l.trigger(D)})}})},r.prototype.generateData=function(){this.pivotFieldList={},this.dataSourceSettings&&(this.dataSourceSettings.dataSource||this.dataSourceSettings.url)?""!==this.dataSourceSettings.url&&"olap"===this.dataType||this.dataSourceSettings.dataSource.length>0?("pivot"===this.dataType&&(this.engineModule.data=this.dataSourceSettings.dataSource),this.initEngine()):this.dataSourceSettings.dataSource instanceof i.DataManager&&("pivot"===this.dataType&&this.remoteData.length>0?(this.engineModule.data=this.remoteData,this.initEngine()):setTimeout(this.getData.bind(this),100)):(this.notify(ne,{}),this.trigger(D))},r.prototype.getValueCellInfo=function(e){var t=e;return this.trigger(H,t),t},r.prototype.getData=function(){this.dataSourceSettings.dataSource.executeQuery(new i.Query).then(this.executeQuery.bind(this))},r.prototype.executeQuery=function(e){this.engineModule.data=e.result,this.initEngine()},r.prototype.fieldListRender=function(){this.element.innerHTML="";var e;"Popup"===this.renderMode&&this.dialogRenderer.fieldListDialog&&!this.dialogRenderer.fieldListDialog.isDestroyed&&(e=this.dialogRenderer.fieldListDialog.visible,this.dialogRenderer.fieldListDialog.destroy(),t.remove(document.getElementById(this.element.id+"_Wrapper"))),this.renderModule.render(),"Popup"===this.renderMode?(this.fieldListSpinnerElement=this.dialogRenderer.fieldListDialog.element,e&&this.dialogRenderer.fieldListDialog.show()):this.fieldListSpinnerElement=this.element.querySelector(".e-pivotfieldlist-wrapper"),this.spinnerTemplate?a.createSpinner({target:this.fieldListSpinnerElement,template:this.spinnerTemplate},this.createElement):a.createSpinner({target:this.fieldListSpinnerElement},this.createElement);var i;i={pivotEngine:"olap"===this.dataType?this.olapEngineModule:this.engineModule,dataSourceSettings:this.dataSourceSettings,id:this.element.id,element:document.getElementById(this.element.id+"_Wrapper"),moduleName:this.getModuleName(),enableRtl:this.enableRtl,isAdaptive:this.isAdaptive,renderMode:this.renderMode,localeObj:this.localeObj,dataType:this.dataType},this.pivotCommon=new or(i),this.pivotCommon.control=this,this.allowDeferLayoutUpdate&&(this.clonedDataSource=t.extend({},this.dataSourceSettings,null,!0),this.clonedFieldList=t.extend({},this.pivotFieldList,null,!0))},r.prototype.getFieldCaption=function(e){if(this.getFields(e),this.captionData.length>0)for(var t=this.captionData.length,i="olap"===this.dataType?this.olapEngineModule:this.engineModule;t--;)if(this.captionData[t])for(var a=0,r=this.captionData[t];a<r.length;a++){var n=r[a];n&&i.fieldList[n.name]&&(n.caption?i.fieldList[n.name].caption=n.caption:i.fieldList[n.name].caption=n.name)}},r.prototype.getFields=function(e){this.captionData=[e.rows,e.columns,e.values,e.filters]},r.prototype.updateDataSource=function(e,i){this.pivotGridModule&&this.pivotGridModule.showWaitingPopup(),a.showSpinner(this.fieldListSpinnerElement);var r=this,n=r.isPopupView?r.pivotGridModule:r,o=!1,s=r.pivotGridModule&&r.pivotGridModule.enableVirtualization?r.pivotGridModule.pageSettings:void 0,l=Object.keys(r.lastCalcFieldInfo).length>0,d=Object.keys(r.lastSortInfo).length>0,h=Object.keys(r.lastAggregationInfo).length>0,p=Object.keys(r.lastFilterInfo).length>0,u={dataSourceSettings:g.getClonedDataSourceSettings(r.dataSourceSettings)};n.trigger(v,u,function(a){if(s&&(d||p||h||l)||(g.updateDataSourceSettings(r,a.dataSourceSettings),g.updateDataSourceSettings(r.pivotGridModule,a.dataSourceSettings)),t.isNullOrUndefined(i)){if("pivot"===r.dataType){var u=r.frameCustomProperties();d?(r.pivotGridModule&&r.pivotGridModule.setProperties({dataSourceSettings:{valueSortSettings:{headerText:""}}},!0),r.setProperties({dataSourceSettings:{valueSortSettings:{headerText:""}}},!0),u.enableValueSorting=!1):u.enableValueSorting=r.staticPivotGridModule?r.staticPivotGridModule.enableValueSorting:r.enableValueSorting,u.savedFieldList=r.pivotFieldList,s&&(d||p||h||l)?(d&&(r.pivotGridModule.setProperties({dataSourceSettings:{valueSortSettings:{headerText:""}}},!0),"Server"===n.dataSourceSettings.mode?n.getEngine("onSort",null,r.lastSortInfo,null,null,null,null):r.engineModule.onSort(r.lastSortInfo),r.lastSortInfo={}),p&&("Server"===n.dataSourceSettings.mode?n.getEngine("onFilter",null,null,null,null,r.lastFilterInfo,null):r.engineModule.onFilter(r.lastFilterInfo,r.dataSourceSettings),r.lastFilterInfo={}),h&&("Server"===n.dataSourceSettings.mode?n.getEngine("onAggregation",null,null,r.lastAggregationInfo,null,null,null):r.engineModule.onAggregation(r.lastAggregationInfo),r.lastAggregationInfo={}),l&&("Server"===n.dataSourceSettings.mode?n.getEngine("onCalcOperation",null,null,null,r.lastCalcFieldInfo,null,null):r.engineModule.onCalcOperation(r.lastCalcFieldInfo),r.lastCalcFieldInfo={})):"Server"===r.dataSourceSettings.mode?(d?n.getEngine("onSort",null,r.lastSortInfo,null,null,null,null):h?n.getEngine("onAggregation",null,null,r.lastAggregationInfo,null,null,null):l?n.getEngine("onCalcOperation",null,null,null,r.lastCalcFieldInfo,null,null):p?n.getEngine("onFilter",null,null,null,null,r.lastFilterInfo,null):n.getEngine("onDrop",null,null,null,null,null,null),r.lastSortInfo={},r.lastAggregationInfo={},r.lastCalcFieldInfo={},r.lastFilterInfo={}):r.engineModule.renderEngine(r.dataSourceSettings,u,r.getValueCellInfo.bind(r))}else o=r.updateOlapDataSource(r,d,l,o);r.getFieldCaption(r.dataSourceSettings)}else r.axisFieldModule.render(),r.isRequiredUpdate=!1;r.enginePopulatedEventMethod(r,e,o)})},r.prototype.enginePopulatedEventMethod=function(e,i,r){var n=this,o=e.isPopupView?e.pivotGridModule:e,s={dataSourceSettings:e.dataSourceSettings,pivotFieldList:"pivot"===e.dataType?e.engineModule.fieldList:e.olapEngineModule.fieldList,pivotValues:"pivot"===e.dataType?e.engineModule.pivotValues:e.olapEngineModule.pivotValues};o.trigger(S,s,function(o){e.dataSourceSettings.dataSource;e.dataSourceSettings=o.dataSourceSettings,e.pivotCommon.dataSourceSettings=e.dataSourceSettings,e.pivotFieldList=o.pivotFieldList,"olap"===e.dataType?(e.olapEngineModule.pivotValues=o.pivotValues,e.pivotCommon.engineModule=e.olapEngineModule):(e.engineModule.pivotValues=o.pivotValues,e.pivotCommon.engineModule=e.engineModule),i||!e.treeViewModule.fieldTable||e.isAdaptive||e.notify(se,{}),e.isRequiredUpdate?(e.allowDeferLayoutUpdate&&(e.clonedDataSource=t.extend({},e.dataSourceSettings,null,!0),e.clonedFieldList=t.extend({},e.pivotFieldList,null,!0)),e.updateView(e.pivotGridModule)):n.isPopupView&&e.allowDeferLayoutUpdate&&(e.pivotGridModule.engineModule=e.engineModule,e.pivotGridModule.setProperties({dataSourceSettings:e.dataSourceSettings.properties},!0),e.pivotGridModule.notify(ae,e),a.hideSpinner(e.fieldListSpinnerElement)),n.isPopupView&&e.pivotGridModule&&e.pivotGridModule.allowDeferLayoutUpdate&&!e.isRequiredUpdate&&(a.hideSpinner(e.fieldListSpinnerElement),e.pivotGridModule.hideWaitingPopup()),e.isRequiredUpdate=!0,!e.pivotGridModule||r?a.hideSpinner(e.fieldListSpinnerElement):e.pivotGridModule.fieldListSpinnerElement=e.fieldListSpinnerElement});var l=this.getActionCompleteName();this.actionObj.actionName=l,this.actionObj.actionName&&this.actionCompleteMethod()},r.prototype.updateOlapDataSource=function(e,t,i,a){var r=e.frameCustomProperties(e.olapEngineModule.fieldListData,e.olapEngineModule.fieldList);return r.savedFieldList=e.pivotFieldList,i||t?(e.olapEngineModule.savedFieldList=e.pivotFieldList,e.olapEngineModule.savedFieldListData=e.olapEngineModule.fieldListData,i?(e.olapEngineModule.updateCalcFields(e.dataSourceSettings,e.lastCalcFieldInfo),e.lastCalcFieldInfo={},a=!e.olapEngineModule.dataFields[e.lastCalcFieldInfo.name],e.pivotGridModule&&e.pivotGridModule.hideWaitingPopup()):e.olapEngineModule.onSort(e.dataSourceSettings)):e.olapEngineModule.renderEngine(e.dataSourceSettings,r),a},r.prototype.update=function(e){e&&(this.clonedDataSet=e.clonedDataSet,this.clonedReport=e.clonedReport,this.setProperties({dataSourceSettings:e.dataSourceSettings,showValuesButton:e.showValuesButton},!0),this.engineModule=e.engineModule,this.olapEngineModule=e.olapEngineModule,this.dataType=e.dataType,this.pivotFieldList="olap"===this.dataType?e.olapEngineModule.fieldList:e.engineModule.fieldList,this.isPopupView?this.pivotGridModule=e:this.staticPivotGridModule=e,this.getFieldCaption(e.dataSourceSettings),this.pivotCommon.engineModule="olap"===this.dataType?this.olapEngineModule:this.engineModule,this.pivotCommon.dataSourceSettings=this.dataSourceSettings,this.pivotCommon.control=this,this.treeViewModule.fieldTable&&!this.isAdaptive&&this.notify(se,{}),this.axisFieldModule.render(),!this.isPopupView&&this.allowDeferLayoutUpdate&&(this.clonedDataSource=t.extend({},this.dataSourceSettings,null,!0),this.clonedFieldList=t.extend({},this.pivotFieldList,null,!0)))},r.prototype.updateView=function(e){if(e){e.clonedDataSet=this.clonedDataSet,e.clonedReport=this.clonedReport,e.setProperties({dataSourceSettings:this.dataSourceSettings,showValuesButton:this.showValuesButton},!0),e.engineModule=this.engineModule,e.olapEngineModule=this.olapEngineModule,e.dataType=this.dataType,this.pivotChange||(e.pivotValues="olap"===this.dataType?this.olapEngineModule.pivotValues:this.engineModule.pivotValues);var t={dataSourceSettings:g.getClonedDataSourceSettings(e.dataSourceSettings),pivotValues:e.pivotValues};e.trigger(_,t),this.isPopupView||(this.staticPivotGridModule=e,e.isStaticRefresh=!0),e.dataBind()}},r.prototype.triggerPopulateEvent=function(){var e=this,t=this.isPopupView?this.pivotGridModule:this,i={dataSourceSettings:this.dataSourceSettings,pivotFieldList:"olap"===this.dataType?this.olapEngineModule.fieldList:this.engineModule.fieldList,pivotValues:"olap"===this.dataType?this.olapEngineModule.pivotValues:this.engineModule.pivotValues};t.trigger(S,i,function(t){e.dataSourceSettings=t.dataSourceSettings,e.pivotFieldList=t.pivotFieldList,"olap"===e.dataType?e.olapEngineModule.pivotValues=t.pivotValues:e.engineModule.pivotValues=t.pivotValues})},r.prototype.actionBeginMethod=function(){var e={dataSourceSettings:g.getClonedDataSourceSettings(this.dataSourceSettings),actionName:this.actionObj.actionName,fieldInfo:this.actionObj.fieldInfo,cancel:!1};return(this.isPopupView?this.pivotGridModule:this).trigger($,e),e.cancel},r.prototype.actionCompleteMethod=function(){var e={dataSourceSettings:g.getClonedDataSourceSettings(this.dataSourceSettings),actionName:this.actionObj.actionName,fieldInfo:this.actionObj.fieldInfo,actionInfo:this.actionObj.actionInfo};(this.isPopupView?this.pivotGridModule:this).trigger(ee,e),this.actionObj.actionName="",this.actionObj.actionInfo=void 0,this.actionObj.fieldInfo=void 0},r.prototype.actionFailureMethod=function(e){var t={actionName:this.actionObj.actionName,errorInfo:e};(this.isPopupView?this.pivotGridModule:this).trigger(te,t)},r.prototype.getActionCompleteName=function(){return this.actionObj.actionName==ze?$e:this.actionObj.actionName==_e?St:this.actionObj.actionName==Ue?yt:this.actionObj.actionName==Ge?bt:this.actionObj.actionName==We?Ct:this.actionObj.actionName==Je?xt:this.actionObj.actionName==Be?at:this.actionObj.actionName},r.prototype.destroy=function(){this.unWireEvent(),this.engineModule&&!this.destroyEngine&&(this.engineModule.fieldList={},this.engineModule.rMembers=null,this.engineModule.cMembers=null,this.engineModule.valueMatrix=null,this.engineModule.indexMatrix=null,this.engineModule={}),this.olapEngineModule&&!this.destroyEngine&&(this.olapEngineModule.fieldList={},this.olapEngineModule={}),this.pivotFieldList&&(this.pivotFieldList={}),this.captionData&&(this.captionData=null),this.contextMenuModule&&this.contextMenuModule.destroy(),this.treeViewModule&&this.treeViewModule.destroy(),this.pivotButtonModule&&this.pivotButtonModule.destroy(),this.pivotCommon&&this.pivotCommon.destroy(),this.dialogRenderer&&this.dialogRenderer.destroy(),this.calculatedFieldModule&&this.calculatedFieldModule.destroy(),e.prototype.destroy.call(this),this.contextMenuModule&&(this.contextMenuModule=null),this.treeViewModule&&(this.treeViewModule=null),this.pivotButtonModule&&(this.pivotButtonModule=null),this.pivotCommon&&(this.pivotCommon=null),this.dialogRenderer&&(this.dialogRenderer=null),this.calculatedFieldModule&&(this.calculatedFieldModule=null),this.axisFieldModule&&(this.axisFieldModule=null),this.axisTableModule&&(this.axisTableModule=null),this.renderModule&&(this.renderModule=null),this.clonedDataSet&&(this.clonedDataSet=null),this.clonedReport&&(this.clonedReport=null),this.clonedFieldList&&(this.clonedFieldList=null),this.localeObj&&(this.localeObj=null),this.defaultLocale&&(this.defaultLocale=null),this.element.innerHTML="",t.removeClass([this.element],Tt),t.removeClass([this.element],Mt),t.removeClass([this.element],Dt)},In([t.Complex({},br)],r.prototype,"dataSourceSettings",void 0),In([t.Property("Popup")],r.prototype,"renderMode",void 0),In([t.Property()],r.prototype,"target",void 0),In([t.Property("")],r.prototype,"cssClass",void 0),In([t.Property(!1)],r.prototype,"allowCalculatedField",void 0),In([t.Property(!1)],r.prototype,"showValuesButton",void 0),In([t.Property(!1)],r.prototype,"allowDeferLayoutUpdate",void 0),In([t.Property(1e3)],r.prototype,"maxNodeLimitInMemberEditor",void 0),In([t.Property(!0)],r.prototype,"loadOnDemandInMemberEditor",void 0),In([t.Property()],r.prototype,"spinnerTemplate",void 0),In([t.Property(["Sum","Count","DistinctCount","Product","Min","Max","Avg","Median","Index","PopulationVar","SampleVar","PopulationStDev","SampleStDev","RunningTotals","PercentageOfGrandTotal","PercentageOfColumnTotal","PercentageOfRowTotal","PercentageOfParentColumnTotal","PercentageOfParentRowTotal","DifferenceFrom","PercentageOfDifferenceFrom","PercentageOfParentTotal"])],r.prototype,"aggregateTypes",void 0),In([t.Property("USD")],r.prototype,"currencyCode",void 0),In([t.Event()],r.prototype,"load",void 0),In([t.Event()],r.prototype,"enginePopulating",void 0),In([t.Event()],r.prototype,"memberFiltering",void 0),In([t.Event()],r.prototype,"enginePopulated",void 0),In([t.Event()],r.prototype,"onFieldDropped",void 0),In([t.Event()],r.prototype,"fieldDrop",void 0),In([t.Event()],r.prototype,"fieldDragStart",void 0),In([t.Event()],r.prototype,"aggregateCellInfo",void 0),In([t.Event()],r.prototype,"memberEditorOpen",void 0),In([t.Event()],r.prototype,"calculatedFieldCreate",void 0),In([t.Event()],r.prototype,"aggregateMenuOpen",void 0),In([t.Event()],r.prototype,"fieldRemove",void 0),In([t.Event()],r.prototype,"dataBound",void 0),In([t.Event()],r.prototype,"created",void 0),In([t.Event()],r.prototype,"destroyed",void 0),In([t.Event()],r.prototype,"beforeServiceInvoke",void 0),In([t.Event()],r.prototype,"actionBegin",void 0),In([t.Event()],r.prototype,"actionComplete",void 0),In([t.Event()],r.prototype,"actionFailure",void 0),r=In([t.NotifyPropertyChanges],r)}(t.Component),An="DistinctCount",Rn="CalculatedField",jn=function(){function e(e){this.isFormula=!1,this.isRequireUpdate=!1,this.parent=e,this.existingReport=null,this.parent.calculatedFieldModule=this,this.removeEventListener(),this.addEventListener(),this.parentID=this.parent.element.id,this.dialog=null,this.inputObj=null,this.treeObj=null,this.droppable=null,this.menuObj=null,this.newFields=null,this.isFieldExist=!0,this.formulaText=null,this.fieldText=null,this.formatText=null,this.formatType=null,this.fieldType=null,this.parentHierarchy=null,this.isEdit=!1,this.currentFieldName=null,this.confirmPopUp=null}return e.prototype.getModuleName=function(){return"calculatedField"},e.prototype.keyActionHandler=function(e){var i=e.currentTarget.querySelector(".e-hover.e-node-focus");if(i)switch(e.action){case"moveRight":case"shiftE":"pivot"===this.parent.dataType&&this.displayMenu(i);break;case"delete":"LI"===i.tagName&&!i.querySelector(".e-list-icon.e-format")&&!i.querySelector(".e-list-icon").classList.contains(".e-icons")&&i.querySelector("."+Ra)&&i.querySelector("."+Ra).classList.contains("e-list-icon")&&this.createConfirmDialog(this.parent.localeObj.getConstant("alert"),this.parent.localeObj.getConstant("removeCalculatedField"),{},!0,i);break;case"enter":var a=i.getAttribute("data-field"),r=i.getAttribute("data-type"),n=t.select("#"+this.parentID+"droppable",this.dialog.element);"pivot"===this.parent.dataType?""===n.value?n.value=r===Rn?i.getAttribute("data-uid"):'"'+r+"("+a+')"':""!==n.value&&(n.value=r===Rn?n.value+i.getAttribute("data-uid"):n.value+'"'+r+"("+a+')"'):(this.parent.olapEngineModule&&this.parent.olapEngineModule.fieldList[a]&&this.parent.olapEngineModule.fieldList[a].isCalculatedField&&(a=this.parent.olapEngineModule.fieldList[a].tag),""===n.value?n.value=a:""!==n.value&&(n.value=n.value+a))}},e.prototype.fieldClickHandler=function(e){var i=t.closest(e.event.target,"li");(e.event.target.classList.contains($i)||e.event.target.classList.contains(ua)||e.event.target.classList.contains(ca)||e.event.target.classList.contains(Ra))&&(this.parent.isAdaptive?"olap"===this.parent.dataType&&this.parent.isAdaptive&&("LI"===i.tagName&&i.querySelector(".e-list-edit-icon").classList.contains(ua)&&e.event.target.classList.contains(ua)?(this.isEdit=!0,this.currentFieldName=i.getAttribute("data-field"),this.fieldText=i.getAttribute("data-caption"),this.formulaText=i.getAttribute("data-formula"),this.formatType=i.getAttribute("data-formatString"),this.formatText="Custom"===this.formatType?i.getAttribute("data-customString"):null,this.fieldType=i.getAttribute("data-membertype"),this.parentHierarchy="Dimension"===this.fieldType?i.getAttribute("data-hierarchy"):null,t.addClass([i.querySelector(".e-list-edit-icon")],ca),t.removeClass([i.querySelector(".e-list-edit-icon")],ua),this.renderMobileLayout(this.parent.dialogRenderer.adaptiveElement)):"LI"===i.tagName&&i.querySelector(".e-list-edit-icon").classList.contains(ca)&&e.event.target.classList.contains(ca)?(this.isEdit=!1,this.fieldText=this.formatText=this.formulaText=this.currentFieldName=null,this.parentHierarchy=this.fieldType=this.formatType=null,t.addClass([i.querySelector(".e-list-edit-icon")],ua),t.removeClass([i.querySelector(".e-list-edit-icon")],ca)):"LI"===i.tagName&&i.querySelector("."+Ra).classList.contains("e-icons")&&e.event.target.classList.contains(Ra)&&this.createConfirmDialog(this.parent.localeObj.getConstant("alert"),this.parent.localeObj.getConstant("removeCalculatedField"),{},!0,e.node)):this.displayMenu(i,e.node,e.event.target))},e.prototype.accordionClickHandler=function(e){if(e.item&&-1!==e.item.iconCss.indexOf("e-list-icon")&&t.closest(e.originalEvent.target,".e-acrdn-header-icon")){var i=t.closest(e.originalEvent.target,".e-acrdn-header").querySelector("."+zi),a=i.getAttribute("data-field"),r=g.getFieldByName(a,this.parent.dataSourceSettings.formatSettings),n=t.closest(e.originalEvent.target,".e-acrdn-header-icon");n.querySelector(".e-edit")&&e.originalEvent.target.classList.contains(ua)?(this.isEdit=!0,this.currentFieldName=this.fieldText=a,this.formulaText=this.parent.engineModule.fieldList[a].formula,this.formatText=r?r.format:"",t.addClass([n.querySelector(".e-list-icon")],ca),t.removeClass([n.querySelector(".e-list-icon")],ua),this.renderMobileLayout(this.parent.dialogRenderer.adaptiveElement)):n.querySelector("."+ca)&&e.originalEvent.target.classList.contains(ca)?(this.isEdit=!1,this.fieldText=this.formatText=this.formulaText=this.currentFieldName=null,t.addClass([n.querySelector(".e-list-icon")],ua),t.removeClass([n.querySelector(".e-list-icon")],ca)):n.querySelector("."+Ra)&&e.originalEvent.target.classList.contains(Ra)&&this.createConfirmDialog(this.parent.localeObj.getConstant("alert"),this.parent.localeObj.getConstant("removeCalculatedField"),{},!0,i)}},e.prototype.accordionCreated=function(){for(var e=this.accordion.element.querySelectorAll(".e-acrdn-item"),i=0;i<e.length;i++)if(e[i].querySelector(".e-edit")||e[i].querySelector("."+ca)){var a=t.createElement("span",{className:"e-list-icon "+Ra+" e-icons"});t.append([a],e[i].querySelector(".e-acrdn-header-icon"))}},e.prototype.clearFormula=function(){this.treeObj&&this.treeObj.element.querySelector("li")&&(t.removeClass(this.treeObj.element.querySelectorAll("li"),"e-active"),this.displayMenu(this.treeObj.element.querySelector("li")))},e.prototype.displayMenu=function(e,i,a){var r=!a||a.classList.contains(ua),n=!a||a.classList.contains(ca);try{if("pivot"!==this.parent.dataType||!e.querySelector(".e-list-icon.e-format")||!e.querySelector(".e-list-icon.e-format").classList.contains(Ot)||e.querySelector(".e-list-icon").classList.contains(ca)||e.querySelector(".e-list-icon").classList.contains(Ra)||e.querySelector(".e-list-icon").classList.contains(ua)||"LI"!==e.tagName){if("LI"===e.tagName&&(e.querySelector(".e-edit")&&e.querySelector(".e-edit").classList.contains("e-list-icon")&&r||"olap"===this.parent.dataType&&e.getAttribute("data-type")===Rn&&e.classList.contains("e-active")&&(a&&!a.classList.contains(Ra)||!a))){this.isEdit=!0;var l=e.getAttribute("data-field"),d=e.getAttribute("data-caption");this.currentFieldName=l,this.inputObj.value=d,this.inputObj.dataBind();var h=e.getAttribute("data-formatString"),p=this.dialog.element,u=t.getInstance(t.select("#"+this.parentID+"Custom_Format_Element",p),o.MaskedTextBox);if("olap"===this.parent.dataType){var c=e.getAttribute("data-membertype"),g=e.getAttribute("data-hierarchy"),m=e.getAttribute("data-formula"),f=e.getAttribute("data-customString"),v=t.select("#"+this.parentID+"_FieldNameTitle",p),S=t.getInstance(t.select("#"+this.parentID+"Member_Type_Div",p),s.DropDownList),y=t.getInstance(t.select("#"+this.parentID+"Hierarchy_List_Div",p),s.DropDownList),b=t.getInstance(t.select("#"+this.parentID+"Format_Div",p),s.DropDownList);v.innerHTML=this.parent.localeObj.getConstant("caption"),t.select("#"+this.parentID+"droppable",document).value=m,S.readonly=!0,S.value=c,S.dataBind(),"Dimension"===c&&(y.value=g),""!==h&&(b.value=h,b.dataBind()),u.value=f}else u.value=h,t.addClass(this.treeObj.element.querySelectorAll("."+ca),ua),t.removeClass(this.treeObj.element.querySelectorAll("."+ca),ca),t.addClass([e.querySelector(".e-list-icon")],ca),t.removeClass([e.querySelector(".e-list-icon")],ua),e.querySelector("."+ca).setAttribute("title",this.parent.localeObj.getConstant("clearCalculatedField")),t.select("#"+this.parentID+"droppable",document).value=e.getAttribute("data-uid");u.dataBind()}else if("LI"===e.tagName&&(e.querySelector("."+ca)&&e.querySelector("."+ca).classList.contains("e-list-icon")&&n||"olap"===this.parent.dataType&&!e.classList.contains("e-active"))){this.isEdit=!1,this.inputObj.value="",this.inputObj.dataBind();p=this.dialog.element;if((u=t.getInstance(t.select("#"+this.parentID+"Custom_Format_Element",p),o.MaskedTextBox)).value="",u.dataBind(),"olap"===this.parent.dataType){y=t.getInstance(t.select("#"+this.parentID+"Hierarchy_List_Div",p),s.DropDownList),b=t.getInstance(t.select("#"+this.parentID+"Format_Div",p),s.DropDownList),S=t.getInstance(t.select("#"+this.parentID+"Member_Type_Div",p),s.DropDownList);(v=t.select("#"+this.parentID+"_FieldNameTitle",p)).innerHTML=this.parent.localeObj.getConstant("fieldTitle"),y.index=0,y.dataBind(),b.index=0,b.dataBind(),S.index=0,S.readonly=!1,S.dataBind()}else t.addClass(this.treeObj.element.querySelectorAll("."+ca),ua),t.removeClass(this.treeObj.element.querySelectorAll("."+ca),ca),e.querySelector(".e-edit").setAttribute("title",this.parent.localeObj.getConstant("edit"));t.select("#"+this.parentID+"droppable",document).value=""}else if("LI"===e.tagName&&e.querySelector("."+Ra)&&e.querySelector("."+Ra).classList.contains("e-list-icon")&&!r&&!n){if(this.parent.actionObj.actionName=We,this.parent.actionBeginMethod())return;var C=t.select("#"+this.parentID+"droppable",document),x={name:this.isEdit?this.currentFieldName:this.inputObj.value,caption:this.inputObj.value,formula:C.value};this.createConfirmDialog(this.parent.localeObj.getConstant("alert"),this.parent.localeObj.getConstant("removeCalculatedField"),x,!0,i)}}else this.menuObj&&!this.menuObj.isDestroyed&&this.menuObj.destroy(),this.curMenu=e.querySelector("."+wi),this.openContextMenu(e)}catch(e){this.parent.actionFailureMethod(e)}},e.prototype.removeCalcField=function(e){var t,i=this.parent.dataSourceSettings,a=e.getAttribute("data-field"),r=i.calculatedFieldSettings;if("pivot"===this.parent.dataType)if(this.parent.isAdaptive){"number"==typeof(h=parseInt(e.getAttribute("id").split(this.parentID+"_")[1],10))&&this.accordion.removeItem(h)}else this.treeObj.removeNodes([e]);for(var n=0;n<r.length;n++)if(r[n]&&r[n].name===a){r.splice(n,1);break}if("olap"===this.parent.dataType){for(var o=(t=this.parent.olapEngineModule).fieldListData?t.fieldListData:[],s=0,l=Object.keys(o);s<l.length;s++){var d=l[s];if(o[d].name===a){var h;if("number"==typeof(h=parseInt(d,10))){o.splice(h,1);break}}}var p=this.treeObj.getNode(e).parentID;this.treeObj.removeNodes([e]),r.length<=0&&this.treeObj.removeNodes([p])}else t=this.parent.engineModule;if(t.fields)for(n=0;n<t.fields.length;n++)if(t.fields[n]===a){t.fields.splice(n,1);break}t.savedFieldList&&t.savedFieldList[a]&&delete t.savedFieldList[a],t.fieldList&&t.fieldList[a]&&delete t.fieldList[a];var u=i.formatSettings;for(n=0;n<u.length;n++)if(u[n]&&u[n].name===a){u.splice(n,1);break}for(var c=[i.values,i.rows,i.columns,i.filters],g=(n=0,c.length);n<g;n++)for(var m=0,f=c[n].length;m<f;m++)if(c[n][m].name===a){c[n].splice(m,1);break}this.isEdit&&this.currentFieldName===a&&(this.isEdit=!1,this.inputObj.value="",this.currentFieldName=this.formatText=this.fieldText=this.formatType=null,this.formulaText=this.fieldType=this.parentHierarchy=null),this.parent.allowDeferLayoutUpdate&&"pivotfieldlist"===this.parent.getModuleName()||this.parent.updateDataSource(),this.removeErrorDialog()},e.prototype.openContextMenu=function(e){var t=this,i=e.getAttribute("data-field"),a="number"!==this.parent.engineModule.fieldList[i].type?"string":"number",r="string"===a?this.getValidSummaryType().slice(0,2):this.getValidSummaryType(),n={cancel:!1,fieldName:i,aggregateTypes:this.getMenuItems(a).slice()};("pivotfieldlist"===this.parent.getModuleName()&&this.parent.isPopupView?this.parent.pivotGridModule:this.parent).trigger(X,n,function(i){if(!i.cancel){for(var a=[],n=[],o=0,s=i.aggregateTypes;o<s.length;o++){var l=s[o];r.indexOf(l)>-1&&-1===a.indexOf(l)&&(a.push(l),n.push({id:t.parent.element.id+"Calc_"+l,text:t.parent.localeObj.getConstant(l)}))}t.createMenu(n,e);var d=e.getBoundingClientRect(),h=window.scrollY||document.documentElement.scrollTop;t.parent.enableRtl?t.menuObj.open(d.top+h,d.left-100):t.menuObj.open(d.top+h,d.left+150)}})},e.prototype.selectContextMenu=function(e){if(null!==e.element.textContent){var i=t.closest(this.curMenu,".e-list-item").getAttribute("data-caption");t.closest(this.curMenu,".e-list-item").setAttribute("data-type",e.element.id.split("_").pop()),this.curMenu.textContent=i+" ("+e.element.textContent+")",t.addClass([this.curMenu.parentElement.parentElement],["e-node-focus","e-hover"]),this.curMenu.parentElement.parentElement.setAttribute("tabindex","-1"),this.curMenu.parentElement.parentElement.focus()}},e.prototype.createMenu=function(e,i){var a,r=this,o={cssClass:this.parentID+"calculatedmenu",items:e,enableRtl:this.parent.enableRtl,locale:this.parent.locale,select:this.selectContextMenu.bind(this),onClose:function(){r.treeObj.element.focus(),t.addClass([i],["e-hover","e-node-focus"])}};a=t.select("#"+this.parentID+"CalcContextmenu",document)?t.select("#"+this.parentID+"CalcContextmenu",document):t.createElement("ul",{id:this.parentID+"CalcContextmenu"}),this.dialog.element.appendChild(a),this.menuObj=new n.ContextMenu(o),this.menuObj.isStringTemplate=!0,this.menuObj.appendTo(a)},e.prototype.applyFormula=function(){var e=this,i=this,a=!1;t.removeClass([document.getElementById(this.parentID+"ddlelement")],ga),this.newFields=t.extend([],this.parent.dataSourceSettings.calculatedFieldSettings,null,!0);var r={fieldName:this.isEdit?this.currentFieldName:this.inputObj.value,calculatedField:this.getCalculatedFieldInfo(),calculatedFieldSettings:g.cloneCalculatedFieldSettings(this.parent.dataSourceSettings.calculatedFieldSettings),cancel:!1};("pivotfieldlist"===this.parent.getModuleName()&&this.parent.isPopupView?this.parent.pivotGridModule:this.parent).trigger(z,r,function(r){if(r.cancel)e.endDialog(),e.parent.lastCalcFieldInfo={},e.isFormula=!1;else{var n=r.calculatedField;if(!e.isEdit)if("olap"===i.parent.dataType){var o=n.name;i.parent.olapEngineModule.fieldList[o]&&"CalculatedField"!==i.parent.olapEngineModule.fieldList[o].type&&(a=!0)}else for(var s=0,l=Object.keys(i.parent.engineModule.fieldList);s<l.length;s++){var d=l[s];n.name&&n.name===d&&"CalculatedField"!==i.parent.engineModule.fieldList[d].aggregateType&&(a=!0)}if(a)return void i.parent.pivotCommon.errorDialog.createErrorDialog(i.parent.localeObj.getConstant("error"),i.parent.localeObj.getConstant("fieldExist"));e.existingReport=t.extend({},e.parent.dataSourceSettings,null,!0);var h=e.parent.dataSourceSettings;if(t.isNullOrUndefined(n.name)||""===n.name||t.isNullOrUndefined(n.caption)||""===n.caption||!n.formula||""===n.formula)t.isNullOrUndefined(n.name)||""===n.name||t.isNullOrUndefined(n.caption)||""===n.caption?(e.inputObj.value="",t.addClass([document.getElementById(e.parentID+"ddlelement")],ga),document.getElementById(e.parentID+"ddlelement").focus()):e.parent.pivotCommon.errorDialog.createErrorDialog(e.parent.localeObj.getConstant("error"),e.parent.localeObj.getConstant("invalidFormula"));else{o=void 0;if("olap"===e.parent.dataType){if(o={name:n.name,formula:n.formula,formatString:n.formatString},t.isNullOrUndefined(n.hierarchyUniqueName)||(o.hierarchyUniqueName=n.hierarchyUniqueName),e.isFieldExist=!1,e.isEdit){for(v=0;v<h.calculatedFieldSettings.length;v++)if(h.calculatedFieldSettings[v].name===o.name&&e.isEdit){h.calculatedFieldSettings[v].hierarchyUniqueName=n.hierarchyUniqueName,e.parent.olapEngineModule.fieldList[o.name].caption=n.caption,h.calculatedFieldSettings[v].formatString=o.formatString,h.calculatedFieldSettings[v].formula=o.formula,o=h.calculatedFieldSettings[v],e.isFieldExist=!0;break}for(var p=!1,u=0,c=[h.rows,h.columns,h.values,h.filters];u<c.length;u++){for(var g=0,m=c[u];g<m.length;g++){var f=m[g];if(f.isCalculatedField&&null!==o.name&&f.name===o.name&&e.isEdit){f.caption=n.caption,e.isFieldExist=!0,p=!0;break}}if(p)break}}else for(var v=0;v<h.calculatedFieldSettings.length;v++)if(h.calculatedFieldSettings[v].name===o.name)return void e.createConfirmDialog(i.parent.localeObj.getConstant("alert"),i.parent.localeObj.getConstant("confirmText"),n);e.isFieldExist||h.calculatedFieldSettings.push(o),e.parent.lastCalcFieldInfo=o}else{o={name:n.name,caption:n.caption,type:"CalculatedField"};var S={name:n.name,formula:n.formula};if(t.isNullOrUndefined(n.formatString)||(S.formatString=n.formatString),e.isFieldExist=!0,e.isEdit){for(v=0;v<h.values.length;v++)if(h.values[v].type===Rn&&null!==o.name&&h.values[v].name===o.name&&e.isEdit)for(y=0;y<h.calculatedFieldSettings.length;y++)h.calculatedFieldSettings[y].name===o.name&&(h.values[v].caption=n.caption,e.currentFormula=h.calculatedFieldSettings[y].formula,h.calculatedFieldSettings[y].formula=n.formula,e.parent.engineModule.fieldList[o.name].caption=n.caption,e.updateFormatSettings(h,o.name,n.formatString),e.isFieldExist=!1)}else for(var v=0;v<h.values.length;v++)if(h.values[v].type===Rn&&h.values[v].name===o.name){for(var y=0;y<h.calculatedFieldSettings.length;y++)if(h.calculatedFieldSettings[y].name===o.name)return void e.createConfirmDialog(i.parent.localeObj.getConstant("alert"),i.parent.localeObj.getConstant("confirmText"),n);e.isFieldExist=!1}e.isFieldExist&&(h.values.push(o),h.calculatedFieldSettings.push(S),e.updateFormatSettings(h,o.name,n.formatString)),e.parent.lastCalcFieldInfo=S}e.addFormula(h,o.name)}}})},e.prototype.getCalculatedFieldInfo=function(){var e,i=t.select("#"+this.parentID+"droppable",document),a=this.parent.isAdaptive?this.parent.dialogRenderer.adaptiveElement.element:this.dialog.element,r=t.getInstance(t.select("#"+this.parentID+"Custom_Format_Element",a),o.MaskedTextBox);if(e={name:this.isEdit?this.currentFieldName:this.inputObj.value,caption:this.inputObj.value,formula:i.value},"olap"===this.parent.dataType){var n=t.getInstance(t.select("#"+this.parentID+"Format_Div",a),s.DropDownList),l=t.getInstance(t.select("#"+this.parentID+"Member_Type_Div",a),s.DropDownList),d=t.getInstance(t.select("#"+this.parentID+"Hierarchy_List_Div",a),s.DropDownList);e.formatString="Custom"===n.value?r.value:n.value,"Dimension"===l.value&&(e.hierarchyUniqueName=d.value)}else e.formatString=r.value;return e},e.prototype.updateFormatSettings=function(e,t,i){for(var a={name:t,format:i,useGrouping:!0},r=!1,n=0;n<e.formatSettings.length;n++)if(e.formatSettings[n].name===t){if("undefined"===i||void 0===i||""===i){e.formatSettings.splice(n,1),r=!0;break}var o=e.formatSettings[n].properties?e.formatSettings[n].properties:e.formatSettings[n];o.format=i,e.formatSettings.splice(n,1,o),r=!0;break}r||""===i||e.formatSettings.push(a)},e.prototype.addFormula=function(e,t){this.isFormula=!0,this.field=t,"Server"===this.parent.dataSourceSettings.mode?g.updateDataSourceSettings(this.parent,g.getClonedDataSourceSettings(e)):this.parent.setProperties({dataSourceSettings:e},!0),"pivotfieldlist"===this.parent.getModuleName()&&this.parent.allowDeferLayoutUpdate&&(this.parent.isRequiredUpdate=!1);try{var i={calculatedFieldInfo:this.parent.lastCalcFieldInfo};this.parent.actionObj.actionInfo=i;var a=this.parent.actionObj.actionName==_e?St:$e;this.parent.actionObj.actionName=a,this.parent.updateDataSource(!1);var r="pivotfieldlist"===this.parent.getModuleName()&&this.parent.pivotGridModule?this.parent.pivotGridModule:this.parent;r&&"Server"!==r.dataSourceSettings.mode?this.endDialog():this.isRequireUpdate=!0,"pivotfieldlist"===this.parent.getModuleName()&&"Fixed"===this.parent.renderMode&&this.parent.allowDeferLayoutUpdate&&(this.parent.pivotChange=!0)}catch(e){this.showError()}},e.prototype.endDialog=function(){if(this.isEdit=!1,this.dialog)this.dialog.close();else{this.inputObj.value="",this.currentFieldName=this.formatText=this.fieldText=this.formatType=null,this.formulaText=this.fieldType=this.parentHierarchy=null;var e=this.parent.isAdaptive?this.parent.dialogRenderer.parentElement:this.dialog.element;if(this.parent.dialogRenderer.parentElement.querySelector("."+Qi).value="",t.select("#"+this.parentID+"droppable",this.parent.dialogRenderer.parentElement).value="",t.select("#"+this.parentID+"Custom_Format_Element",this.parent.dialogRenderer.parentElement).value="","olap"===this.parent.dataType){var i=t.getInstance(t.select("#"+this.parentID+"Custom_Format_Element",e),o.MaskedTextBox),a=t.getInstance(t.select("#"+this.parentID+"Format_Div",e),s.DropDownList),r=t.getInstance(t.select("#"+this.parentID+"Member_Type_Div",e),s.DropDownList),n=t.getInstance(t.select("#"+this.parentID+"Hierarchy_List_Div",e),s.DropDownList);a.index=0,a.dataBind(),r.index=0,r.readonly=!1,r.dataBind(),n.index=0,n.enabled=!1,n.dataBind(),i.enabled=!1,i.dataBind()}}},e.prototype.showError=function(){if(this.parent.engineModule.fieldList[this.field]&&delete this.parent.engineModule.fieldList[this.field],this.parent.pivotCommon.errorDialog.createErrorDialog(this.parent.localeObj.getConstant("error"),this.parent.localeObj.getConstant("invalidFormula")),this.parent.setProperties({dataSourceSettings:this.existingReport},!0),this.isEdit){for(var e=this.parent.dataSourceSettings.calculatedFieldSettings,t=0;e&&t<e.length;t++)if(e[t].name===this.field){e[t].formula=this.currentFormula;break}}else if(this.parent.engineModule.fields)for(t=0;t<this.parent.engineModule.fields.length;t++)if(this.parent.engineModule.fields[t]===this.field){this.parent.engineModule.fields.splice(t,1);break}this.parent.lastCalcFieldInfo={},this.parent.updateDataSource(!1),this.isFormula=!1},e.prototype.getFieldListData=function(e){var t=[];if("olap"===this.parent.dataType)for(var i=0,a=t=g.getClonedData(e.olapEngineModule.fieldListData?e.olapEngineModule.fieldListData:[]);i<a.length;i++){var r=a[i];r.spriteCssClass&&(r.spriteCssClass.indexOf("e-attributeCDB-icon")>-1||r.spriteCssClass.indexOf("e-level-members")>-1)?r.hasChildren=!0:r.spriteCssClass&&r.spriteCssClass.indexOf("e-namedSetCDB-icon")>-1?r.hasChildren=!1:r.spriteCssClass&&r.spriteCssClass.indexOf("e-calcMemberGroupCDB")>-1&&(r.expanded=this.isEdit)}else for(var n=0,o=e.engineModule.fieldList?Object.keys(e.engineModule.fieldList):[];n<o.length;n++){var s=o[n],l=null,d=null;d="number"===e.engineModule.fieldList[s].type&&"include"!==e.engineModule.fieldList[s].type&&"exclude"!==e.engineModule.fieldList[s].type||"DistinctCount"===e.engineModule.fieldList[s].aggregateType?void 0!==e.engineModule.fieldList[s].aggregateType?e.engineModule.fieldList[s].aggregateType:"Sum":"Count",l=this.parent.localeObj.getConstant(d),t.push({index:e.engineModule.fieldList[s].index,name:e.engineModule.fieldList[s].caption+" ("+l+")",type:d,icon:$i+" "+Ot,formula:e.engineModule.fieldList[s].formula,field:s,caption:e.engineModule.fieldList[s].caption?e.engineModule.fieldList[s].caption:s})}return t},e.prototype.fieldDropped=function(e){e.cancel=!0;var i=t.select("#"+this.parentID+"droppable",this.dialog.element);t.removeClass([i],"e-copy-drop"),t.removeClass([e.draggedNode.querySelector("."+wi)],Si);var a=e.draggedNode.getAttribute("data-field");if("olap"===this.parent.dataType)if(this.parent.olapEngineModule.fieldList[a]&&this.parent.olapEngineModule.fieldList[a].isCalculatedField&&(a=this.parent.olapEngineModule.fieldList[a].tag),e.target.id===this.parentID+"droppable"&&""===i.value)i.value=a,i.focus();else if(e.target.id===this.parentID+"droppable"&&""!==i.value){var r=void 0,n=i.value,o=i.selectionStart,s=n.substring(o,n.length);r=(d=n.substring(0,o))+a,i.value=d+a+s,i.focus(),i.setSelectionRange(r.length,r.length)}else e.cancel=!0;else{var l=e.draggedNode.getAttribute("data-type");if(e.target.id===this.parentID+"droppable"&&""===i.value)i.value=l===Rn?e.draggedNodeData.id.toString():'"'+l+"("+a+')"',i.focus();else if(e.target.id===this.parentID+"droppable"&&""!==i.value){r=void 0,o=i.selectionStart;var d=(n=i.value).substring(0,o);s=n.substring(o,n.length);l===Rn?(r=d+e.draggedNodeData.id.toString(),i.value=d+e.draggedNodeData.id.toString()+s):(r=d+'"'+l+"("+a+')"',i.value=d+'"'+l+"("+a+')"'+s),i.focus(),i.setSelectionRange(r.length,r.length)}else e.cancel=!0}},e.prototype.createDialog=function(){var e=this;if(null!==t.select("#"+this.parentID+"calculateddialog",document))for(t.remove(t.select("#"+this.parentID+"calculateddialog",document));!t.isNullOrUndefined(document.querySelector("."+this.parentID+"calculatedmenu"));)t.remove(document.querySelector("."+this.parentID+"calculatedmenu"));this.parent.element.appendChild(t.createElement("div",{id:this.parentID+"calculateddialog",className:"e-pivot-calc-dialog-div "+("olap"===this.parent.dataType?"e-olap-calc-dialog-div":"")}));var i=[{click:this.applyFormula.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("ok"),isPrimary:!0}},{click:this.cancelClick.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("cancel")}}];if("olap"===this.parent.dataType){var r={click:this.clearFormula.bind(this),buttonModel:{cssClass:"e-calc-clear-btn",content:this.parent.localeObj.getConstant("clear")}};i.splice(0,0,r)}this.dialog=new a.Dialog({allowDragging:!0,position:{X:"center",Y:"center"},buttons:i,close:this.closeDialog.bind(this),beforeOpen:this.beforeOpen.bind(this),open:function(){t.select("#"+e.parentID+"ddlelement",e.dialog.element)&&t.select("#"+e.parentID+"ddlelement",e.dialog.element).focus()},animationSettings:{effect:"Zoom"},width:"25%",isModal:!1,closeOnEscape:!0,enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,header:this.parent.localeObj.getConstant("createCalculatedField"),target:document.body}),this.dialog.isStringTemplate=!0,this.dialog.appendTo("#"+this.parentID+"calculateddialog")},e.prototype.cancelClick=function(){this.dialog.close(),this.isEdit=!1},e.prototype.beforeOpen=function(e){this.dialog.element.querySelector(".e-dlg-header").setAttribute("title",this.parent.localeObj.getConstant("createCalculatedField"))},e.prototype.closeDialog=function(e){"pivotfieldlist"===this.parent.getModuleName()&&(this.parent.axisFieldModule.render(),"Fixed"!==this.parent.renderMode&&(t.addClass([this.parent.element.querySelector("."+It)],Et),this.parent.dialogRenderer.fieldListDialog.show())),this.treeObj.destroy(),this.dialog.destroy(),this.newFields=null,this.menuObj&&!this.menuObj.isDestroyed&&this.menuObj.destroy(),t.remove(document.getElementById(this.parentID+"calculateddialog")),t.isNullOrUndefined(document.querySelector("."+this.parentID+"calculatedmenu"))||t.remove(document.querySelector("."+this.parentID+"calculatedmenu"));var i="pivotview"===this.parent.getModuleName()||"pivotfieldlist"===this.parent.getModuleName()&&"Fixed"===this.parent.renderMode?0:500;this.buttonCall&&(this.buttonCall=!1,setTimeout(this.setFocus.bind(this),i))},e.prototype.setFocus=function(){var e;if("pivotview"===this.parent.getModuleName()&&this.parent.element?e=this.parent.element:document.getElementById(this.parent.element.id+"_Wrapper")&&(e=document.getElementById(this.parent.element.id+"_Wrapper")),e)for(var t=0,i=[].slice.call(e.querySelectorAll(".e-pivot-button"));t<i.length;t++){var a=i[t];if(a.getAttribute("data-uid")===this.currentFieldName){a.focus();break}}},e.prototype.renderDialogElements=function(){var e=t.createElement("div",{id:this.parentID+"outerDiv",className:("olap"===this.parent.dataType?"e-olap-calc-outer-div ":"")+"e-pivot-calc-outer-div"}),i=t.createElement("div",{id:this.parentID+"Olap_Tree_Div",className:"e-olap-field-tree-div"}),r=t.createElement("div",{id:this.parentID+"Olap_Calc_Div",className:"e-olap-calculated-div"});if("pivotfieldlist"===this.parent.getModuleName()&&null!==this.parent.dialogRenderer.parentElement.querySelector("."+ea)&&this.parent.isAdaptive){var n=t.createElement("div",{id:this.parentID+"accordDiv",className:"e-pivot-accord"});e.appendChild(n);var o=t.createElement("div",{id:this.parentID+"buttonDiv",className:ra}),s=t.createElement("button",{id:this.parentID+"addBtn",innerHTML:this.parent.localeObj.getConstant("add"),className:"e-pivot-add-button",attrs:{type:"button"}}),l=t.createElement("button",{id:this.parentID+"cancelBtn",innerHTML:this.parent.localeObj.getConstant("cancel"),className:"e-pivot-cancel-button",attrs:{type:"button"}});o.appendChild(l),o.appendChild(s),e.appendChild(o)}else{if(!this.parent.isAdaptive&&"olap"===this.parent.dataType){var d=t.createElement("div",{className:"e-pivot-field-name-title",id:this.parentID+"_FieldNameTitle",innerHTML:this.parent.localeObj.getConstant("fieldTitle")});r.appendChild(d)}var h=t.createElement("div",{id:this.parentID+"outerDiv",className:"e-pivot-calc-input-div"}),p=t.createElement("input",{id:this.parentID+"ddlelement",attrs:{type:"text"},className:Qi});h.appendChild(p),"olap"!==this.parent.dataType||this.parent.isAdaptive?e.appendChild(h):r.appendChild(h);var u=t.createElement("div",{id:this.parentID+"control_wrapper",className:ia});if(!this.parent.isAdaptive){var c=t.createElement("div",{className:sa,innerHTML:"olap"===this.parent.dataType?this.parent.localeObj.getConstant("allFields"):this.parent.localeObj.getConstant("formulaField")});if("olap"===this.parent.dataType){var g=t.createElement("div",{className:sa+"-wrapper"});g.appendChild(c);var m=t.createElement("span",{attrs:{tabindex:"0","aria-disabled":"false","aria-label":this.parent.localeObj.getConstant("fieldTooltip")},className:Ot+" e-info"});g.appendChild(m);new a.Tooltip({content:this.parent.localeObj.getConstant("fieldTooltip"),position:this.parent.enableRtl?"RightCenter":"LeftCenter",target:".e-info",offsetY:(this.parent.enableRtl,-10),locale:this.parent.locale,enableRtl:this.parent.enableRtl,width:220}).appendTo(g),u.appendChild(g)}else e.appendChild(c)}var f=t.createElement("div",{className:ta+"-outer-div"});if(u.appendChild(f),f.appendChild(t.createElement("div",{id:this.parentID+"tree",className:ta})),"olap"!==this.parent.dataType||this.parent.isAdaptive?e.appendChild(u):i.appendChild(u),!this.parent.isAdaptive){d=t.createElement("div",{className:"e-pivot-formula-title",innerHTML:"olap"===this.parent.dataType?this.parent.localeObj.getConstant("expressionField"):this.parent.localeObj.getConstant("formula")});"olap"===this.parent.dataType?r.appendChild(d):e.appendChild(d)}var v=t.createElement("textarea",{id:this.parentID+"droppable",className:ea+" e-control e-textbox e-input",attrs:{placeholder:this.parent.isAdaptive?this.parent.localeObj.getConstant("dropTextMobile"):"olap"===this.parent.dataType?this.parent.localeObj.getConstant("olapDropText"):this.parent.localeObj.getConstant("dropText")}});if("olap"!==this.parent.dataType||this.parent.isAdaptive?e.appendChild(v):r.appendChild(v),this.parent.isAdaptive){o=t.createElement("div",{id:this.parentID+"buttonDiv",className:ra});var S=t.createElement("button",{id:this.parentID+"okBtn",innerHTML:this.parent.localeObj.getConstant("apply"),className:aa,attrs:{type:"button"}});o.appendChild(S),e.appendChild(o)}if("olap"===this.parent.dataType){if(!this.parent.isAdaptive){var y=t.createElement("div",{className:"e-olap-member-title",innerHTML:this.parent.localeObj.getConstant("memberType")});r.appendChild(y)}var b=t.createElement("div",{id:this.parentID+"Member_Type_Div",className:Ji});if(this.parent.isAdaptive?e.appendChild(b):r.appendChild(b),!this.parent.isAdaptive){var C=t.createElement("div",{className:"e-olap-hierarchy-title",innerHTML:this.parent.localeObj.getConstant("selectedHierarchy")});r.appendChild(C)}var x=t.createElement("div",{id:this.parentID+"Hierarchy_List_Div",className:Ki});if(this.parent.isAdaptive?e.appendChild(x):r.appendChild(x),!this.parent.isAdaptive){var w=t.createElement("div",{className:la,innerHTML:this.parent.localeObj.getConstant("formatString")});r.appendChild(w)}var T=t.createElement("div",{id:this.parentID+"Format_Div",className:Xi});this.parent.isAdaptive?e.appendChild(T):r.appendChild(T);var M=t.createElement("div",{id:this.parentID+"custom_Format_Div",className:"e-olap-calc-custom-format-div"}),D=t.createElement("input",{id:this.parentID+"Custom_Format_Element",attrs:{type:"text"},className:Yi});if(M.appendChild(D),r.appendChild(M),this.parent.isAdaptive?e.appendChild(M):r.appendChild(M),"pivotfieldlist"===this.parent.getModuleName()&&null===this.parent.dialogRenderer.parentElement.querySelector("."+ea)&&this.parent.isAdaptive){S=e.querySelector("."+aa);e.appendChild(S)}else e.appendChild(i),e.appendChild(r)}else{M=t.createElement("div",{id:this.parentID+"custom_Format_Div",className:"e-pivot-calc-custom-format-div"});if(!this.parent.isAdaptive){w=t.createElement("div",{className:la,innerHTML:this.parent.localeObj.getConstant("formatString")});M.appendChild(w)}D=t.createElement("input",{id:this.parentID+"Custom_Format_Element",attrs:{type:"text"},className:Yi});M.appendChild(D),this.parent.isAdaptive?e.insertBefore(M,t.select("#"+this.parentID+"buttonDiv",e)):e.appendChild(M)}}return e},e.prototype.renderAdaptiveLayout=function(e){var i=this.parent.dialogRenderer.adaptiveElement;if(e){if(t.select("#"+this.parentID+"droppable",i.element)&&(this.formulaText=t.select("#"+this.parentID+"droppable",document).value,this.fieldText=this.inputObj.value),i.element.querySelector("."+Ji)){var a=t.getInstance(t.select("#"+this.parentID+"Member_Type_Div",i.element),s.DropDownList);this.fieldType=a.value}if(i.element.querySelector("."+Ki)){var r=t.getInstance(t.select("#"+this.parentID+"Hierarchy_List_Div",i.element),s.DropDownList);this.parentHierarchy="Dimension"===this.fieldType?r.value:null}if(i.element.querySelector("."+Xi)){var n=t.getInstance(t.select("#"+this.parentID+"Format_Div",i.element),s.DropDownList);this.formatType=n.value}if(i.element.querySelector("."+Yi)){var l=t.getInstance(t.select("#"+this.parentID+"Custom_Format_Element",i.element),o.MaskedTextBox);this.formatText="olap"===this.parent.dataType?"Custom"===this.formatType?l.value:null:l.value}}else this.currentFieldName=this.formulaText=this.fieldText=this.formatText=null,this.fieldType=this.formatType=this.parentHierarchy=null;this.renderMobileLayout(i)},e.prototype.updateAdaptiveCalculatedField=function(e,i){var a=this.parent.dialogRenderer.adaptiveElement.element;this.isEdit=e;var r=e?"pivot"===this.parent.dataType?this.parent.engineModule.fieldList[i]:this.parent.olapEngineModule.fieldList[i]:{id:null,caption:null,formula:null,fieldType:"Measure",formatString:"pivot"===this.parent.dataType?null:"Standard",parentHierarchy:null};if(this.currentFieldName=r.id,t.select("#"+this.parentID+"droppable",document)&&(this.formulaText=t.select("#"+this.parentID+"droppable",document).value=r.formula,this.fieldText=this.inputObj.value=r.caption,this.inputObj.dataBind()),a.querySelector("."+Ji)){var n=t.getInstance(t.select("#"+this.parentID+"Member_Type_Div",a),s.DropDownList);this.fieldType=n.value=r.fieldType,n.readonly=!!e,n.dataBind()}if(a.querySelector("."+Ki)){var l=t.getInstance(t.select("#"+this.parentID+"Hierarchy_List_Div",a),s.DropDownList);"Dimension"===this.fieldType?this.parentHierarchy=l.value=r.parentHierarchy:(this.parentHierarchy=null,l.index=0),l.dataBind()}if(a.querySelector("."+Xi)){var d=t.getInstance(t.select("#"+this.parentID+"Format_Div",a),s.DropDownList);this.formatType=d.value=["Standard","Currency","Percent"].indexOf(r.formatString)>-1?r.formatString:"Custom"}if(a.querySelector("."+Yi)){var h=t.getInstance(t.select("#"+this.parentID+"Custom_Format_Element",a),o.MaskedTextBox),p=g.getFieldByName(i,this.parent.dataSourceSettings.formatSettings);"pivot"===this.parent.dataType?this.formatText=h.value=p?p.format:null:this.formatText=h.value="Custom"===this.formatType?r.formatString:null,h.dataBind()}},e.prototype.createOlapDropElements=function(){for(var e=this,i=this.parent.isAdaptive?this.parent.dialogRenderer.parentElement:this.dialog.element,a=[],r=[],n=[],l=0,d=["Measure","Dimension"];l<d.length;l++){var h=d[l];a.push({value:h,text:this.parent.localeObj.getConstant(h)})}for(var p=0,u=["Standard","Currency","Percent","Custom"];p<u.length;p++){var c=u[p];r.push({value:c,text:this.parent.localeObj.getConstant(c)})}for(var m=0,f=g.getClonedData(this.parent.olapEngineModule.fieldListData);m<f.length;m++){var v=f[m];v.spriteCssClass&&(v.spriteCssClass.indexOf("e-attributeCDB-icon")>-1||v.spriteCssClass.indexOf("e-hierarchyCDB-icon")>-1)&&n.push({value:v.id,text:v.caption})}var S=new s.DropDownList({dataSource:a,enableRtl:this.parent.enableRtl,locale:this.parent.locale,fields:{value:"value",text:"text"},value:null!==this.fieldType?this.fieldType:a[0].value,readonly:this.isEdit,cssClass:Zi,width:"100%",change:function(i){y.enabled="Dimension"===i.value,e.fieldType=i.value,e.formulaText=t.select("#"+e.parentID+"droppable",document).value,y.dataBind()}});S.isStringTemplate=!0,S.appendTo(t.select("#"+this.parentID+"Member_Type_Div",i));var y=new s.DropDownList({dataSource:n,enableRtl:this.parent.enableRtl,locale:this.parent.locale,allowFiltering:!0,enabled:"Dimension"===S.value,filterBarPlaceholder:this.parent.localeObj.getConstant("example")+" "+n[0].text.toString(),fields:{value:"value",text:"text"},value:null!==this.parentHierarchy&&"Dimension"===S.value?this.parentHierarchy:n[0].value,cssClass:Zi,width:"100%",change:function(i){e.parentHierarchy=i.value,e.formulaText=t.select("#"+e.parentID+"droppable",document).value}});y.isStringTemplate=!0,y.appendTo(t.select("#"+this.parentID+"Hierarchy_List_Div",i));var b=new s.DropDownList({dataSource:r,enableRtl:this.parent.enableRtl,locale:this.parent.locale,fields:{value:"value",text:"text"},value:null!==this.formatType?this.formatType:r[0].value,cssClass:Zi,width:"100%",change:function(i){C.enabled="Custom"===i.value,e.formatType=i.value,e.formulaText=t.select("#"+e.parentID+"droppable",document).value,C.dataBind()}});b.isStringTemplate=!0,b.appendTo(t.select("#"+this.parentID+"Format_Div",i));var C=new o.MaskedTextBox({placeholder:this.parent.localeObj.getConstant("customFormat"),locale:this.parent.locale,enableRtl:this.parent.enableRtl,value:null!==this.formatText&&"Custom"===b.value?this.formatText:null,enabled:"Custom"===b.value,change:function(i){e.formatText=i.value,e.formulaText=t.select("#"+e.parentID+"droppable",document).value}});C.isStringTemplate=!0,C.appendTo("#"+this.parentID+"Custom_Format_Element")},e.prototype.createTreeView=function(){var e=this;"olap"===this.parent.dataType?this.treeObj=new n.TreeView({fields:{dataSource:this.getFieldListData(this.parent),id:"id",text:"caption",parentID:"pid",iconCss:"spriteCssClass"},allowDragAndDrop:!0,enableRtl:this.parent.enableRtl,locale:this.parent.locale,nodeDragStart:this.dragStart.bind(this),nodeDragging:function(e){e.event.target&&e.event.target.classList.contains(ea)?(t.removeClass([e.clonedNode],vi),t.addClass([e.event.target],"e-copy-drop")):(t.addClass([e.clonedNode],vi),t.removeClass([e.event.target],"e-copy-drop"),e.dropIndicator="e-no-drop",t.addClass([e.clonedNode.querySelector("."+Ot)],"e-icon-expandable"),t.removeClass([e.clonedNode.querySelector("."+Ot)],"e-list-icon"))},nodeClicked:this.fieldClickHandler.bind(this),nodeSelected:function(i){i.node.getAttribute("data-type")===Rn?e.displayMenu(i.node):(t.removeClass([i.node],"e-active"),i.cancel=!0)},nodeDragStop:this.fieldDropped.bind(this),drawNode:this.drawTreeNode.bind(this),nodeExpanding:this.updateNodeIcon.bind(this),nodeCollapsed:this.updateNodeIcon.bind(this),sortOrder:"None"}):this.treeObj=new n.TreeView({fields:{dataSource:this.getFieldListData(this.parent),id:"formula",text:"name",iconCss:"icon"},allowDragAndDrop:!0,enableRtl:this.parent.enableRtl,locale:this.parent.locale,nodeCollapsing:this.nodeCollapsing.bind(this),nodeDragStart:this.dragStart.bind(this),nodeClicked:this.fieldClickHandler.bind(this),nodeDragStop:this.fieldDropped.bind(this),drawNode:this.drawTreeNode.bind(this),keyPress:function(e){39===e.event.keyCode&&(e.cancel=!0)},sortOrder:"Ascending"}),this.treeObj.isStringTemplate=!0,this.treeObj.appendTo("#"+this.parentID+"tree")},e.prototype.updateNodeIcon=function(e){if(e.node&&e.node.querySelector(".e-list-icon")&&e.node.querySelector(".e-icon-expandable.e-process")&&e.node.querySelector(".e-list-icon").className.indexOf("e-folderCDB-icon")>-1){var i=e.node.querySelector(".e-list-icon");t.removeClass([i],"e-folderCDB-icon"),t.addClass([i],"e-folderCDB-open-icon")}else if(e.node&&e.node.querySelector(".e-list-icon")&&e.node.querySelector(".e-icon-expandable")&&e.node.querySelector(".e-list-icon").className.indexOf("e-folderCDB-open-icon")>-1){i=e.node.querySelector(".e-list-icon");t.removeClass([i],"e-folderCDB-open-icon"),t.addClass([i],"e-folderCDB-icon")}else{for(var a=this.treeObj.fields.dataSource,r=[],n=0,o=a;n<o.length;n++){var s=o[n];s.pid===e.nodeData.id.toString()&&r.push(s)}if(0!==r.length)return;this.parent.olapEngineModule.calcChildMembers=[],this.parent.olapEngineModule.getCalcChildMembers(this.parent.dataSourceSettings,e.nodeData.id.toString()),r=this.parent.olapEngineModule.calcChildMembers,this.parent.olapEngineModule.calcChildMembers=[];for(var l=0,d=r;l<d.length;l++){(i=d[l]).pid=e.nodeData.id.toString(),i.hasChildren=!1,i.spriteCssClass="e-level-members",i.caption=""===i.caption?this.parent.localeObj.getConstant("blank"):i.caption,a.push(i)}this.treeObj.addNodes(r,e.node)}},e.prototype.nodeCollapsing=function(e){e.cancel=!0},e.prototype.dragStart=function(e){var i=!1,a=e.clonedNode;a&&("olap"===this.parent.dataType&&(a.querySelector(".e-calc-dimension-icon,.e-calc-measure-icon,.e-measure-icon")||a.querySelector(".e-dimensionCDB-icon,.e-attributeCDB-icon,.e-hierarchyCDB-icon")||a.querySelector(".e-level-members,.e-namedSetCDB-icon"))||"pivot"===this.parent.dataType&&e.event.target.classList.contains("e-drag"))&&(i=!0),i?(t.addClass([e.draggedNode.querySelector("."+wi)],Si),t.addClass([a],"e-pivot-calc"),a.style.zIndex=(this.dialog.zIndex+1).toString(),a.style.display="inline"):e.cancel=!0},e.prototype.drawTreeNode=function(e){if("olap"===this.parent.dataType){e.node.querySelector(".e-measure-icon")&&(e.node.querySelector(".e-list-icon").style.display="none");var i=e.nodeData;e.node.setAttribute("data-field",i.id),e.node.setAttribute("data-caption",i.caption);var a=e.node.querySelector("."+yi);if(e.nodeData&&e.nodeData.type===Rn&&a&&e.node.querySelector(".e-list-icon.e-calc-member")){e.node.setAttribute("data-type",i.type),e.node.setAttribute("data-membertype",i.fieldType),e.node.setAttribute("data-hierarchy",i.parentHierarchy?i.parentHierarchy:""),e.node.setAttribute("data-formula",i.formula);var r=void 0;r=i.formatString?["Standard","Currency","Percent"].indexOf(i.formatString)>-1?i.formatString:"Custom":"",e.node.setAttribute("data-formatString",r),e.node.setAttribute("data-customString","Custom"===r?i.formatString:"");var n=t.createElement("span",{className:Ra+" e-icons e-list-icon"});if(a.classList.add("e-calcfieldmember"),this.parent.isAdaptive){var o=t.createElement("span",{className:"e-list-edit-icon"+(this.isEdit&&this.currentFieldName===i.id?" e-edited ":" e-edit ")+Ot}),s=t.createElement("div",{className:"e-list-header-icon"});s.appendChild(o),s.appendChild(n),a.appendChild(s)}else a.appendChild(n)}if(this.parent.isAdaptive){var l=e.node.querySelector("."+yi);if(e.node&&e.node.querySelector(".e-list-icon")&&l){var d=e.node.querySelector(".e-list-icon");l.insertBefore(d,e.node.querySelector(".e-list-text"))}e.node&&e.node.querySelector(".e-calcMemberGroupCDB,.e-measureGroupCDB-icon,.e-folderCDB-icon")&&(e.node.querySelector(".e-checkbox-wrapper").style.display="none"),e.node&&e.node.querySelector(".e-level-members")&&(e.node.querySelector(".e-list-icon").style.display="none")}}else{i=e.nodeData.field;e.node.setAttribute("data-field",i),e.node.setAttribute("data-caption",e.nodeData.caption),e.node.setAttribute("data-type",e.nodeData.type);var h=g.getFieldByName(i,this.parent.dataSourceSettings.formatSettings);e.node.setAttribute("data-formatString",h?h.format:"");var p=t.createElement("span",{attrs:{tabindex:"-1","aria-disabled":"false",title:this.parent.localeObj.getConstant("dragField")},className:Ot+" e-drag"}),u=t.createElement("div",{className:" e-iconspace"});t.prepend([p],e.node.querySelector("."+yi)),t.append([u,e.node.querySelector("."+$i)],e.node.querySelector("."+yi)),this.getMenuItems(this.parent.engineModule.fieldList[i].type).length<=0?t.removeClass([e.node.querySelector("."+$i)],Ot):e.node.querySelector("."+$i).setAttribute("title",this.parent.localeObj.getConstant("format")),this.parent.engineModule.fieldList[i].aggregateType===Rn&&(e.node.querySelector("."+$i).setAttribute("title",this.parent.localeObj.getConstant("remove")),t.addClass([e.node.querySelector("."+$i)],Ra),t.addClass([e.node.querySelector(".e-iconspace")],[ua,Ot,"e-list-icon"]),e.node.querySelector(".e-edit").setAttribute("title",this.parent.localeObj.getConstant("edit")),e.node.querySelector(".e-edit").setAttribute("aria-disabled","false"),e.node.querySelector(".e-edit").setAttribute("tabindex","-1"),t.removeClass([e.node.querySelector("."+$i)],$i),t.removeClass([e.node.querySelector(".e-iconspace")],"e-iconspace"))}},e.prototype.createTypeContainer=function(e){for(var i=t.createElement("div",{id:this.parentID+"control_wrapper",className:ia}),a=this.getMenuItems(this.parent.engineModule.fieldList[e].type),r=0;r<a.length;r++){var n=t.createElement("input",{id:this.parentID+"radio"+e+a[r],attrs:{type:"radio","data-ftxt":e,"data-value":a[r]},className:"e-pivot-calc-radio"});i.appendChild(n)}return i},e.prototype.getMenuItems=function(e,i){for(var a=t.isNullOrUndefined(i)?this.parent.aggregateTypes:i,r=[],n=this.getValidSummaryType(),o=0;o<a.length;o++)n.indexOf(a[o])>-1&&r.indexOf(a[o])<0&&(("Count"!==a[o]&&a[o]!==An||"number"===e)&&"number"!==e||r.push(a[o]));return r},e.prototype.getValidSummaryType=function(){return["Count",An,"Sum","Avg","Median","Min","Max","Product","SampleStDev","PopulationStDev","SampleVar","PopulationVar"]},e.prototype.getAccordionData=function(e){for(var t=[],i=Object.keys(e.engineModule.fieldList),a=0,r=i.length;a<r;a++){var n=i[a];t.push({header:"<input id="+this.parentID+"_"+a+" class="+zi+' type="checkbox" data-field='+n+" data-caption="+this.parent.engineModule.fieldList[n].caption+" data-type="+this.parent.engineModule.fieldList[n].type+"/>",content:this.parent.engineModule.fieldList[n].aggregateType===Rn||this.getMenuItems(this.parent.engineModule.fieldList[n].type).length<1?"":this.createTypeContainer(n).outerHTML,iconCss:this.parent.engineModule.fieldList[n].aggregateType===Rn?"e-list-icon "+(this.isEdit&&this.currentFieldName===n?"e-edited":"e-edit"):""})}return t},e.prototype.renderMobileLayout=function(e){var i=this;e.items[4].content=this.renderDialogElements().outerHTML,e.dataBind(),"olap"===this.parent.dataType&&this.parent.isAdaptive&&null!==this.parent.dialogRenderer.parentElement.querySelector("."+ea)&&this.createOlapDropElements();var a=new h.Button({cssClass:"e-flat",isPrimary:!0,locale:this.parent.locale,enableRtl:this.parent.enableRtl});if(a.isStringTemplate=!0,a.appendTo("#"+this.parentID+"cancelBtn"),a.element&&(a.element.onclick=this.cancelBtnClick.bind(this)),null!==this.parent.dialogRenderer.parentElement.querySelector("."+ea)&&this.parent.isAdaptive){var r=new h.Button({cssClass:"e-flat e-outline",isPrimary:!0,locale:this.parent.locale,enableRtl:this.parent.enableRtl});if(r.isStringTemplate=!0,r.appendTo("#"+this.parentID+"okBtn"),this.inputObj=new o.MaskedTextBox({placeholder:this.parent.localeObj.getConstant("fieldName"),locale:this.parent.locale,enableRtl:this.parent.enableRtl,change:function(e){i.fieldText=e.value,i.formulaText=t.select("#"+i.parentID+"droppable",document).value}}),this.inputObj.isStringTemplate=!0,this.inputObj.appendTo("#"+this.parentID+"ddlelement"),"pivot"===this.parent.dataType){var s=new o.MaskedTextBox({locale:this.parent.locale,enableRtl:this.parent.enableRtl,placeholder:this.parent.localeObj.getConstant("numberFormatString"),change:function(e){i.formatText=e.value,i.formulaText=t.select("#"+i.parentID+"droppable",document).value}});s.isStringTemplate=!0,s.appendTo("#"+this.parentID+"Custom_Format_Element"),null!==this.formatText&&null!==this.parent.dialogRenderer.parentElement.querySelector("."+Yi)&&(this.parent.dialogRenderer.parentElement.querySelector("."+Yi).value=this.formatText,s.value=this.formatText)}if(null!==this.formulaText&&null!==t.select("#"+this.parentID+"droppable",this.parent.dialogRenderer.parentElement)){t.select("#"+this.parentID+"droppable",this.parent.dialogRenderer.parentElement).value=this.formulaText}null!==this.fieldText&&null!==this.parent.dialogRenderer.parentElement.querySelector("."+Qi)&&(this.parent.dialogRenderer.parentElement.querySelector("."+Qi).value=this.fieldText,this.inputObj.value=this.fieldText),r.element&&(r.element.onclick=this.applyFormula.bind(this))}else if(this.parent.isAdaptive){var l=new h.Button({cssClass:"e-flat",isPrimary:!0,locale:this.parent.locale,enableRtl:this.parent.enableRtl});l.isStringTemplate=!0,l.appendTo("#"+this.parentID+"addBtn"),"olap"===this.parent.dataType?(this.treeObj=new n.TreeView({fields:{dataSource:this.getFieldListData(this.parent),id:"id",text:"caption",parentID:"pid",iconCss:"spriteCssClass"},showCheckBox:!0,autoCheck:!1,sortOrder:"None",enableRtl:this.parent.enableRtl,locale:this.parent.locale,nodeClicked:this.fieldClickHandler.bind(this),drawNode:this.drawTreeNode.bind(this),nodeExpanding:this.updateNodeIcon.bind(this),nodeCollapsed:this.updateNodeIcon.bind(this),nodeSelected:function(e){t.removeClass([e.node],"e-active"),e.cancel=!0}}),this.treeObj.isStringTemplate=!0,this.treeObj.appendTo("#"+this.parentID+"accordDiv")):(this.accordion=new n.Accordion({items:this.getAccordionData(this.parent),enableRtl:this.parent.enableRtl,locale:this.parent.locale,expanding:this.accordionExpand.bind(this),clicked:this.accordionClickHandler.bind(this),created:this.accordionCreated.bind(this)}),this.accordion.isStringTemplate=!0,this.accordion.appendTo("#"+this.parentID+"accordDiv"),this.updateType()),l.element&&(l.element.onclick=this.addBtnClick.bind(this))}},e.prototype.accordionExpand=function(e){if(0===e.element.querySelectorAll(".e-radio-wrapper").length)for(var t=Object.keys(this.parent.engineModule.fieldList),i=0,a=t.length;i<a;i++){var r=t[i],n="number"!==this.parent.engineModule.fieldList[r].type?["Count",An]:["Sum","Count","Avg","Median","Min","Max",An,"Product","SampleStDev","PopulationStDev","SampleVar","PopulationVar"],o=void 0;if(r===e.element.querySelector("[data-field").getAttribute("data-field"))for(var s=0;s<n.length;s++)(o=new h.RadioButton({label:this.parent.localeObj.getConstant(n[s]),name:"AggregateType"+r,checked:e.element.querySelector("[data-type").getAttribute("data-type")===n[s],change:this.onChange.bind(this),locale:this.parent.locale,enableRtl:this.parent.enableRtl})).isStringTemplate=!0,o.appendTo("#"+this.parentID+"radio"+r+n[s])}},e.prototype.onChange=function(e){var t=e.event.target.parentElement.querySelector(".e-label").innerText,i=e.event.target.closest(".e-acrdn-item").querySelector("[data-field").getAttribute("data-caption");e.event.target.closest(".e-acrdn-item").querySelector(".e-label").innerText=i+" ("+t+")",e.event.target.closest(".e-acrdn-item").querySelector("[data-type").setAttribute("data-type",e.event.target.getAttribute("data-value"))},e.prototype.updateType=function(){for(var e=Object.keys(this.parent.engineModule.fieldList),i=0,a=e.length;i<a;i++){var r=e[i],n=null;n="number"===this.parent.engineModule.fieldList[r].type&&"include"!==this.parent.engineModule.fieldList[r].type&&"exclude"!==this.parent.engineModule.fieldList[r].type||"DistinctCount"===this.parent.engineModule.fieldList[r].aggregateType?void 0!==this.parent.engineModule.fieldList[r].aggregateType?this.parent.engineModule.fieldList[r].aggregateType:"Sum":"Count";var o=new h.CheckBox({label:this.parent.engineModule.fieldList[r].caption+" ("+this.parent.localeObj.getConstant(n)+")",locale:this.parent.locale,enableRtl:this.parent.enableRtl});o.isStringTemplate=!0,o.appendTo("#"+this.parentID+"_"+i),t.select("#"+this.parentID+"_"+i,document).setAttribute("data-field",r),t.select("#"+this.parentID+"_"+i,document).setAttribute("data-type",n)}},e.prototype.cancelBtnClick=function(){this.renderMobileLayout(this.parent.dialogRenderer.adaptiveElement)},e.prototype.addBtnClick=function(){var e="",t=null,i=null;if("pivot"===this.parent.dataType){for(var a=document.querySelectorAll(".e-accordion .e-check"),r=0;r<a.length;r++)if(t=a[r].parentElement.querySelector("[data-field]").getAttribute("data-field"),-1===(i=a[r].parentElement.querySelector("[data-field]").getAttribute("data-type")).indexOf(Rn))e=e+'"'+i+"("+t+')"';else for(var n=0;n<this.parent.dataSourceSettings.calculatedFieldSettings.length;n++)if(this.parent.dataSourceSettings.calculatedFieldSettings[n].name===t){e+=this.parent.dataSourceSettings.calculatedFieldSettings[n].formula;break}}else for(var o=this.treeObj.getAllCheckedNodes(),s=this.parent.olapEngineModule,l=0,d=o;l<d.length;l++){var h=d[l];e+=s.fieldList[h]&&s.fieldList[h].type===Rn?s.fieldList[h].tag:h}this.formulaText=null!==this.formulaText?this.formulaText+e:e,this.renderMobileLayout(this.parent.dialogRenderer.adaptiveElement)},e.prototype.createCalculatedFieldDialog=function(e){if(this.parent.isAdaptive&&"pivotfieldlist"===this.parent.getModuleName())this.renderAdaptiveLayout(!e||void 0===e.edit||e.edit),this.isEdit=e&&void 0!==e.edit?e.edit:this.isEdit;else if(!this.parent.isAdaptive){if(this.isEdit=!(!e||void 0===e.edit)&&e.edit,this.renderDialogLayout(),e&&e.edit){var i=this.treeObj.element.querySelector('li[data-field="'+e.fieldName+'"]');if(i)if(t.addClass([i],["e-active","e-node-focus"]),i.setAttribute("aria-selected","true"),i.id=this.treeObj.element.id+"_active","pivot"===this.parent.dataType){var a={event:{target:i.querySelector(".e-list-icon.e-edit.e-icons")}};this.fieldClickHandler(a)}else this.displayMenu(i)}this.dialog.element.style.top=parseInt(this.dialog.element.style.top,10)<0?"0px":this.dialog.element.style.top}},e.prototype.renderDialogLayout=function(){if(this.newFields=t.extend([],this.parent.dataSourceSettings.calculatedFieldSettings,null,!0),this.createDialog(),this.dialog.content=this.renderDialogElements(),this.dialog.refresh(),this.inputObj=new o.MaskedTextBox({placeholder:this.parent.localeObj.getConstant("fieldName"),locale:this.parent.locale,enableRtl:this.parent.enableRtl}),this.inputObj.isStringTemplate=!0,this.inputObj.appendTo("#"+this.parentID+"ddlelement"),"pivot"===this.parent.dataType){var e=new o.MaskedTextBox({placeholder:this.parent.localeObj.getConstant("numberFormatString"),locale:this.parent.locale,enableRtl:this.parent.enableRtl});e.isStringTemplate=!0,e.appendTo("#"+this.parentID+"Custom_Format_Element")}"olap"!==this.parent.dataType||this.parent.isAdaptive||this.createOlapDropElements(),this.createTreeView(),this.droppable=new t.Droppable(t.select("#"+this.parentID+"droppable")),this.keyboardEvents=new t.KeyboardEvents(this.parent.calculatedFieldModule.dialog.element,{keyAction:this.keyActionHandler.bind(this),keyConfigs:{moveRight:"rightarrow",enter:"enter",shiftE:"shift+E",delete:"delete"},eventName:"keydown"})},e.prototype.createConfirmDialog=function(e,i,r,n,o){var s=t.createElement("div",{id:this.parentID+"_ErrorDialog",className:ni});this.parent.element.appendChild(s),this.confirmPopUp=new a.Dialog({animationSettings:{effect:"Fade"},allowDragging:!1,showCloseIcon:!0,enableRtl:this.parent.enableRtl,locale:this.parent.locale,width:"auto",height:"auto",position:{X:"center",Y:"center"},buttons:[{click:n?this.removeCalcField.bind(this,o):this.replaceFormula.bind(this,r),buttonModel:{cssClass:ai+" e-flat e-primary",content:n?this.parent.localeObj.getConstant("yes"):this.parent.localeObj.getConstant("ok"),isPrimary:!0}},{click:this.removeErrorDialog.bind(this),buttonModel:{cssClass:ri,content:n?this.parent.localeObj.getConstant("no"):this.parent.localeObj.getConstant("cancel"),isPrimary:!0}}],header:e,content:i,isModal:!0,visible:!0,closeOnEscape:!0,target:document.body,close:this.removeErrorDialog.bind(this)}),this.confirmPopUp.isStringTemplate=!0,this.confirmPopUp.appendTo(s)},e.prototype.replaceFormula=function(e){var i=this.parent.dataSourceSettings;if("olap"===this.parent.dataType){for(var a=0;a<i.calculatedFieldSettings.length;a++)if(i.calculatedFieldSettings[a].name===e.name){t.isNullOrUndefined(e.hierarchyUniqueName)||(i.calculatedFieldSettings[a].hierarchyUniqueName=e.hierarchyUniqueName),i.calculatedFieldSettings[a].formatString=e.formatString,i.calculatedFieldSettings[a].formula=e.formula,this.parent.lastCalcFieldInfo=i.calculatedFieldSettings[a];break}}else for(var r=0;r<i.values.length;r++)if(i.values[r].type===Rn&&i.values[r].name===e.name)for(a=0;a<i.calculatedFieldSettings.length;a++)i.calculatedFieldSettings[a].name===e.name&&(i.calculatedFieldSettings[a].formula=e.formula,this.parent.lastCalcFieldInfo=i.calculatedFieldSettings[a],this.updateFormatSettings(i,e.name,e.formatString));this.addFormula(i,e.name),this.removeErrorDialog()},e.prototype.removeErrorDialog=function(){document.getElementById(this.parentID+"_ErrorDialog")&&t.remove(document.getElementById(this.parentID+"_ErrorDialog").parentElement)},e.prototype.addEventListener=function(){this.parent.isDestroyed||this.parent.on(de,this.createCalculatedFieldDialog,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(de,this.createCalculatedFieldDialog)},e.prototype.destroy=function(){this.removeEventListener()},e}();Ln.Inject(jn);var kn=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.getModuleName=function(){return"fieldList"},e.prototype.initiateModule=function(){if(this.element=t.createElement("div",{id:this.parent.element.id+"_PivotFieldList",styles:"position:"+(this.parent.enableRtl?"static":"absolute")+";height:0;width:"+this.parent.element.style.width+";display:none"}),null===t.select("#"+this.parent.element.id+"containerwrapper",document)){var e=t.createElement("div",{id:this.parent.element.id+"containerwrapper",styles:"height:"+this.parent.height});this.parent.element.parentElement.appendChild(e),e.appendChild(this.element),e.appendChild(this.parent.element)}else t.select("#"+this.parent.element.id+"containerwrapper",document).appendChild(this.element);this.parent.pivotFieldListModule=new Ln({dataSourceSettings:{providerType:this.parent.dataSourceSettings.providerType,rows:[],columns:[],values:[],filters:[]},spinnerTemplate:this.parent.spinnerTemplate,allowDeferLayoutUpdate:this.parent.allowDeferLayoutUpdate,renderMode:"Popup",allowCalculatedField:this.parent.allowCalculatedField,showValuesButton:this.parent.showValuesButton,enableRtl:this.parent.enableRtl,locale:this.parent.locale,target:this.parent.element.parentElement,aggregateTypes:this.parent.aggregateTypes,maxNodeLimitInMemberEditor:this.parent.maxNodeLimitInMemberEditor,aggregateCellInfo:this.parent.bindTriggerEvents.bind(this.parent)}),this.parent.pivotFieldListModule.isPopupView=!0,this.parent.pivotFieldListModule.pivotGridModule=this.parent,this.parent.pivotFieldListModule.appendTo("#"+this.element.id)},e.prototype.updateControl=function(){this.element&&(this.element.style.display="block",t.prepend([this.element],this.parent.element),this.parent.showGroupingBar&&this.parent.groupingBarModule?(clearTimeout(this.timeOutObj),this.timeOutObj=setTimeout(this.update.bind(this))):t.isNullOrUndefined(this.element.querySelector("."+It))||(t.setStyleAttribute(this.element.querySelector("."+It),{left:"auto"}),this.parent.enableRtl?t.removeClass([this.element.querySelector("."+It)],"e-fieldlist-left"):t.addClass([this.element.querySelector("."+It)],"e-fieldlist-left")),t.setStyleAttribute(this.element,{width:t.formatUnit(this.parent.element.offsetWidth)})),this.parent.pivotFieldListModule.update(this.parent)},e.prototype.update=function(){var e;if((e="Table"!==this.parent.currentView?this.parent.chart?this.parent.pivotChartModule.getCalulatedWidth():e:this.parent.grid?this.parent.grid.element.offsetWidth:e)&&!t.isNullOrUndefined(this.element.querySelector("."+It))){var i=e<400?400:e;t.setStyleAttribute(this.element.querySelector("."+It),{left:t.formatUnit(this.parent.enableRtl?-Math.abs(i-this.element.querySelector("."+It).offsetWidth):i-this.element.querySelector("."+It).offsetWidth),top:this.parent.element.querySelector(".e-hscroll")?this.parent.element.querySelector("."+It).offsetHeight.toString()+"px":""}),this.parent.enableRtl?t.addClass([this.element.querySelector("."+It)],"e-fieldlist-left"):t.removeClass([this.element.querySelector("."+It)],"e-fieldlist-left")}},e.prototype.addEventListener=function(){this.handlers={load:this.initiateModule,update:this.updateControl},this.parent.isDestroyed||(this.parent.on(oe,this.handlers.load,this),this.parent.on(ae,this.handlers.update,this))},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(oe,this.handlers.load),this.parent.off(ae,this.handlers.update))},e.prototype.destroy=function(){this.removeEventListener(),this.parent.pivotFieldListModule&&!this.parent.pivotFieldListModule.isDestroyed&&(this.parent.pivotFieldListModule.destroy(),this.parent.pivotFieldListModule=null,t.isNullOrUndefined(t.select("#"+this.parent.element.id+"_PivotFieldList",document))||t.remove(t.select("#"+this.parent.element.id+"_PivotFieldList",document)))},e}(),qn=function(){function e(e){this.parent=e}return e.prototype.render=function(){!this.parent.pivotButtonModule||this.parent.pivotButtonModule&&this.parent.pivotButtonModule.isDestroyed?new Nn(this.parent):this.parent.pivotButtonModule;this.createPivotButtons();for(var e=[],i=0,a=this.parent.element.querySelectorAll("."+ci);i<a.length;i++){var r=a[i];r.classList.contains(Va)||(e=e.concat([].slice.call(r.querySelectorAll("."+Bt))))}for(var n=e.length,o=0;o<n;o++){var s=t.createElement("span",{className:"e-indent-div",styles:"width:"+24*o+"px"});t.prepend([s],e[o])}},e.prototype.createPivotButtons=function(){for(var e=[this.parent.dataSourceSettings.rows,this.parent.dataSourceSettings.columns,this.parent.dataSourceSettings.values,this.parent.dataSourceSettings.filters],t=0,i=this.parent.element.querySelectorAll("."+ui+",."+ci+",."+gi+",."+mi+",."+fi);t<i.length;t++){var a=i[t];this.parent.dataSourceSettings.values.length>0&&a.classList.contains(Ba)&&this.parent.dataSourceSettings.columns.length>0&&a.classList.contains(Ha)||(a.innerHTML="")}var r=["rows","columns","values","filters"];if("pivot"===this.parent.dataType&&this.parent.groupingBarSettings.showFieldsPanel){r.push("all-fields"),e.push([]);for(var n=0,o=this.parent.engineModule&&this.parent.engineModule.fieldList?Object.keys(this.parent.engineModule.fieldList):[];n<o.length;n++){var s=o[n];this.parent.engineModule.fieldList[s]&&!this.parent.engineModule.fieldList[s].isSelected&&e[e.length-1].push(g.getFieldInfo(s,this.parent,!0).fieldItem)}}for(var l=0,d=e.length;l<d;l++)if(e[l]){var h={field:e[l],axis:r[l].toString()};this.parent.notify(le,h)}},e}(),Vn=function(){function e(e){this.parent=e,this.parent.groupingBarModule=this,this.resColWidth=this.parent.isAdaptive?180:249,this.addEventListener(),this.parent.axisFieldModule=new qn(this.parent),this.touchObj=new t.Touch(this.parent.element,{tapHold:this.tapHoldHandler.bind(this)})}return e.prototype.getModuleName=function(){return"groupingBar"},e.prototype.renderLayout=function(){this.groupingTable=t.createElement("div",{className:pi}),this.leftAxisPanel=t.createElement("div",{className:jt}),this.rightAxisPanel=t.createElement("div",{className:kt});var e=t.createElement("div",{className:"e-axis-row e-axiswrapper"}),i=t.createElement("div",{className:"e-axis-column e-axiswrapper"}),a=t.createElement("div",{className:"e-axis-value e-axiswrapper"}),r=t.createElement("div",{className:oa+" "+na+"wrapper"});this.rowPanel=t.createElement("div",{className:ci+" "+si}),this.columnPanel=t.createElement("div",{className:gi+" "+li}),this.valuePanel=t.createElement("div",{className:mi+" "+di}),this.filterPanel=t.createElement("div",{className:fi+" "+hi}),e.appendChild(this.rowPanel),i.appendChild(this.columnPanel),a.appendChild(this.valuePanel),r.appendChild(this.filterPanel),this.rowAxisPanel=e,this.columnAxisPanel=i,this.valueAxisPanel=a,this.filterAxisPanel=r,this.leftAxisPanel.appendChild(a),this.leftAxisPanel.appendChild(e),this.rightAxisPanel.appendChild(r),this.rightAxisPanel.appendChild(i),this.groupingTable.appendChild(t.createElement("div",{styles:"display:flex;"})),this.groupingTable.firstElementChild.appendChild(this.leftAxisPanel),this.groupingTable.firstElementChild.appendChild(this.rightAxisPanel),"pivot"===this.parent.dataType&&null!=this.parent.groupingBarSettings&&this.parent.groupingBarSettings.showFieldsPanel&&(this.gridPanel=this.createToolbarUI(this.groupingTable)),this.groupingTable.classList.add(Qa),this.groupingTable.querySelector("."+ci).classList.add(Xa);for(var n=0,o=[this.rowPanel,this.columnPanel,this.valuePanel,this.filterPanel];n<o.length;n++){var s=o[n];this.parent.groupingBarSettings.allowDragAndDrop&&new t.Droppable(s,{}),this.unWireEvent(s),this.wireEvent(s)}"Table"!==this.parent.displayOption.view&&"Table"!==this.parent.groupingBarSettings.displayMode?(this.groupingChartTable=this.groupingTable.cloneNode(!0),t.select("#"+this.parent.element.id+"_AllFields",this.groupingChartTable)&&(t.select("#"+this.parent.element.id+"_AllFields",this.groupingChartTable).remove(),this.chartPanel=this.createToolbarUI(this.groupingChartTable)),this.groupingChartTable.classList.add(Ga),this.groupingChartTable.classList.remove(Qa),this.groupingChartTable.querySelector("."+ci).classList.add(Va),this.groupingChartTable.querySelector("."+ci).classList.remove(Xa),this.parent.chartSettings.enableMultipleAxis&&this.parent.chartSettings.chartSeries&&["Pie","Pyramid","Doughnut","Funnel"].indexOf(this.parent.chartSettings.chartSeries.type)<0?this.groupingChartTable.querySelector("."+mi).classList.add("e-group-chart-multi-values"):this.groupingChartTable.querySelector("."+mi).classList.add(Ba),this.parent.chartSettings.chartSeries&&["Pie","Pyramid","Doughnut","Funnel"].indexOf(this.parent.chartSettings.chartSeries.type)>-1?this.groupingChartTable.querySelector("."+gi).classList.add(Ha):this.groupingChartTable.querySelector("."+gi).classList.add("e-group-chart-accumulation-column"),this.groupingChartTable.querySelector("."+fi).classList.add("e-group-chart-filters")):this.groupingChartTable=void 0,"Chart"!==this.parent.displayOption.view&&"Chart"!==this.parent.groupingBarSettings.displayMode||(this.groupingTable=void 0)},e.prototype.appendToElement=function(){if((this.parent.element.querySelector(".e-grid")||this.parent.element.querySelector("."+qa))&&this.parent.showGroupingBar){if(this.parent.element.querySelector("."+pi))for(var e=0,i=this.parent.element.querySelectorAll("."+pi);e<i.length;e++){var a=i[e];t.remove(a)}if(this.groupingChartTable)if(t.select("#"+this.parent.element.id+"_chart",this.parent.element)){if(t.setStyleAttribute(this.groupingChartTable,{width:t.formatUnit(this.parent.grid?this.parent.getGridWidthAsNumber():this.parent.getWidthAsNumber())}),this.parent.element.insertBefore(this.groupingChartTable,t.select("#"+this.parent.element.id+"_chart",this.parent.element)),this.groupingChartTable.querySelector("."+qt)&&null!=this.chartPanel&&!this.chartPanel.isDestroyed){var r=this.parent.grid?this.parent.getGridWidthAsNumber()-2:this.parent.getWidthAsNumber()-2;this.chartPanel.width=r<400?"398px":r,this.chartPanel.refreshOverflow(),this.parent.showFieldList&&this.parent.pivotFieldListModule&&this.parent.pivotFieldListModule.element&&(clearTimeout(this.timeOutObj),this.timeOutObj=setTimeout(this.alignIcon.bind(this)))}}else this.groupingChartTable=void 0;if("Chart"!==this.parent.displayOption.view&&this.groupingTable){this.parent.isAdaptive&&(this.leftAxisPanel.style.minWidth="180px",this.valuePanel.style.minWidth="180px"),this.parent.firstColWidth&&(this.leftAxisPanel.style.minWidth="auto",this.valuePanel.style.minWidth="auto"),this.filterPanel.removeAttribute("style"),this.columnPanel.removeAttribute("style"),this.rowPanel.removeAttribute("style"),this.filterPanel.removeAttribute("style");var n=void 0;if(n="olap"===this.parent.dataType?this.parent.olapEngineModule.headerContent?Object.keys(this.parent.olapEngineModule.headerContent).length:0:this.parent.engineModule.headerContent?Object.keys(this.parent.engineModule.headerContent).length:0,!t.isNullOrUndefined(n)){var o=this.parent.element.querySelector(".e-frozenheader").querySelector(".e-columnheader");o.removeAttribute("style"),t.addClass([o.querySelector(".e-headercell")],"e-group-row"),o.querySelector(".e-group-row").appendChild(this.rowAxisPanel),o.querySelector(".e-group-row").querySelector(".e-headercelldiv").style.display="none",o.querySelector(".e-group-row").querySelector(".e-sortfilterdiv").style.display="none"}if(this.parent.element.insertBefore(this.groupingTable,this.parent.element.querySelector(".e-grid")),t.setStyleAttribute(this.groupingTable,{width:t.formatUnit(this.parent.grid?this.parent.getGridWidthAsNumber():this.parent.getWidthAsNumber())}),this.groupingTable&&this.groupingTable.querySelector("."+qt)&&null!=this.gridPanel&&!this.gridPanel.isDestroyed){var s=this.parent.grid?this.parent.getGridWidthAsNumber()-2:this.parent.getWidthAsNumber()-2;this.gridPanel.width=s<400?"398px":s,this.gridPanel.refreshOverflow()}this.groupingTable.style.minWidth="400px",this.parent.axisFieldModule.render(),this.setGridRowWidth();var l=this.parent.element.querySelector(".e-frozenheader").querySelector("colgroup").children[0],d=t.formatUnit(this.groupingTable.offsetWidth-parseInt(l.style.width,10));t.setStyleAttribute(this.valuePanel,{width:l.style.width}),t.setStyleAttribute(this.rightAxisPanel,{width:d});var h=this.valuePanel.offsetHeight/2;h>this.columnPanel.offsetHeight&&(t.setStyleAttribute(this.filterPanel,{height:t.formatUnit(h)}),t.setStyleAttribute(this.columnPanel,{height:t.formatUnit(h+2)}));var p=this.parent.element.querySelector(".e-headercontent").offsetHeight;t.setStyleAttribute(this.rowPanel,{height:p+"px"}),this.parent.element.querySelector(".e-frozenheader").querySelector(".e-rhandler")&&(this.parent.element.querySelector(".e-frozenheader").querySelector(".e-rhandler").style.height=p+"px");for(var u=[].slice.call(this.parent.element.querySelector(".e-movableheader").querySelector("thead").querySelectorAll("tr")).filter(function(e){return e.childNodes.length>0}),c=p/u.length,g=0,m=u;g<m.length;g++){a=m[g];t.setStyleAttribute(a,{height:c+"px"});for(var f=0,v=[].slice.call(a.querySelectorAll(".e-rhandler"));f<v.length;f++){var S=v[f];t.setStyleAttribute(S,{height:c+"px"})}}}else this.parent.axisFieldModule.render(),this.updateChartAxisHeight();this.parent.showToolbar&&"Both"===this.parent.displayOption.view&&("Table"===this.parent.currentView?this.parent.element.querySelector(".e-chart-grouping-bar").style.display="none":this.parent.element.querySelector(".e-pivot-grouping-bar").style.display="none")}},e.prototype.updateChartAxisHeight=function(){if(this.groupingChartTable&&t.select("#"+this.parent.element.id+"_chart",this.parent.element)){var e=this.groupingChartTable.querySelector("."+ci),i=this.groupingChartTable.querySelector("."+mi),a=this.groupingChartTable.querySelector("."+fi),r=this.groupingChartTable.querySelector("."+gi);if(e&&r&&(e.style.height="auto",r.style.height="auto",e.offsetHeight>0&&r.offsetHeight>0)){var n=e.offsetHeight>r.offsetHeight?e.offsetHeight:r.offsetHeight;t.setStyleAttribute(e,{height:t.formatUnit(n)}),t.setStyleAttribute(r,{height:t.formatUnit(n)})}if(i&&a&&(i.style.height="auto",a.style.height="auto",i.offsetHeight>0&&a.offsetHeight>0)){n=i.offsetHeight>a.offsetHeight?i.offsetHeight:a.offsetHeight;t.setStyleAttribute(i,{height:t.formatUnit(n)}),t.setStyleAttribute(a,{height:t.formatUnit(n)})}}},e.prototype.refreshUI=function(){if(this.groupingChartTable){if(t.setStyleAttribute(this.groupingChartTable,{width:t.formatUnit(this.parent.grid?this.parent.getGridWidthAsNumber():this.parent.getWidthAsNumber())}),this.groupingChartTable.querySelector("."+qt)&&null!=this.chartPanel&&!this.chartPanel.isDestroyed){var e=this.parent.grid?this.parent.getGridWidthAsNumber()-2:this.parent.getWidthAsNumber()-2;this.chartPanel.width=e<400?"398px":e,this.chartPanel.refreshOverflow()}this.updateChartAxisHeight(),this.parent.showFieldList&&this.parent.pivotFieldListModule&&this.parent.pivotFieldListModule.element&&(clearTimeout(this.timeOutObj),this.timeOutObj=setTimeout(this.alignIcon.bind(this)))}if(this.groupingTable){if(t.setStyleAttribute(this.groupingTable,{width:t.formatUnit(this.parent.grid?this.parent.getGridWidthAsNumber():this.parent.getWidthAsNumber())}),this.groupingTable&&this.groupingTable.querySelector("."+qt)&&null!=this.gridPanel&&!this.gridPanel.isDestroyed){var i=this.parent.grid?this.parent.getGridWidthAsNumber()-2:this.parent.getWidthAsNumber()-2;this.gridPanel.width=i<400?"398px":i,this.gridPanel.refreshOverflow()}this.groupingTable.style.minWidth="400px";var a=this.parent.element.querySelector(".e-frozenheader").querySelector("colgroup").children[0],r=t.formatUnit(this.groupingTable.offsetWidth-parseInt(a.style.width,10));if(t.setStyleAttribute(this.valuePanel,{width:a.style.width}),t.setStyleAttribute(this.rightAxisPanel,{width:r}),this.parent.showFieldList&&this.parent.pivotFieldListModule&&this.parent.pivotFieldListModule.element&&(clearTimeout(this.timeOutObj),this.timeOutObj=setTimeout(this.alignIcon.bind(this))),!this.parent.grid.element.querySelector(".e-group-row")){var n=this.parent.element.querySelector(".e-frozenheader").querySelector(".e-columnheader");t.addClass([n.querySelector(".e-headercell")],"e-group-row"),t.setStyleAttribute(this.rowPanel,{height:this.parent.element.querySelector(".e-headercontent").offsetHeight+"px"}),n.querySelector(".e-group-row").appendChild(this.rowAxisPanel),t.setStyleAttribute(n.querySelector(".e-group-row").querySelector(".e-headercelldiv"),{display:"none"}),t.setStyleAttribute(n.querySelector(".e-group-row").querySelector(".e-sortfilterdiv"),{display:"none"});var o=this.parent.element.querySelector(".e-headercontent").offsetHeight;t.setStyleAttribute(this.rowPanel,{height:o+"px"}),this.parent.element.querySelector(".e-frozenheader").querySelector(".e-rhandler")&&(this.parent.element.querySelector(".e-frozenheader").querySelector(".e-rhandler").style.height=o+"px");for(var s=[].slice.call(this.parent.element.querySelector(".e-movableheader").querySelector("thead").querySelectorAll("tr")).filter(function(e){return e.childNodes.length>0}),l=o/s.length,d=0,h=s;d<h.length;d++){var p=h[d];t.setStyleAttribute(p,{height:l+"px"});for(var u=0,c=[].slice.call(p.querySelectorAll(".e-rhandler"));u<c.length;u++){var g=c[u];t.setStyleAttribute(g,{height:l+"px"})}}}}},e.prototype.alignIcon=function(){var e,i=this.parent.pivotFieldListModule.element;if(e="Table"===this.parent.currentView?this.parent.grid?this.parent.grid.element.offsetWidth:e:this.parent.chart?this.parent.pivotChartModule.getCalulatedWidth():e){var a=e<400?400:e;t.setStyleAttribute(i.querySelector("."+It),{left:t.formatUnit(this.parent.enableRtl?-Math.abs(a-i.querySelector("."+It).offsetWidth):a-i.querySelector("."+It).offsetWidth),top:this.parent.element.querySelector(".e-hscroll")?this.parent.element.querySelector("."+It).offsetHeight.toString()+"px":""})}},e.prototype.setGridRowWidth=function(){var e=this.parent.element.querySelector(".e-frozenheader").querySelector("colgroup").children[0];if(this.rowPanel.querySelector("."+_t))if(this.parent.isAdaptive){if(!this.parent.firstColWidth){(i=this.parent.grid.columns)&&i.length>0&&(i[0].width=this.resColWidth),this.parent.posCount=0,this.parent.grid.headerModule.refreshUI()}}else{var i,a=[].slice.call(this.rowPanel.querySelectorAll("."+Bt)),r=a[a.length-1],n=r.querySelector("."+_t).offsetWidth+r.querySelector(".e-indent-div").offsetWidth+20,o=t.formatUnit(n<this.resColWidth?this.resColWidth:n),s=this.parent.element.querySelector(".e-frozenheader").querySelector("table"),l=this.parent.element.querySelector(".e-frozencontent").querySelector("table"),d=this.parent.element.querySelector(".e-frozencontent").querySelector("colgroup").children[0],h=parseInt(o,10);(i=this.parent.grid.columns)&&i.length>0&&(i[0].width=(i[0].width,this.resColWidth,h>this.resColWidth?h:this.resColWidth));var p=void 0;p="olap"===this.parent.dataType?this.parent.renderModule.calculateColWidth(this.parent.olapEngineModule.pivotValues.length>0?this.parent.olapEngineModule.pivotValues[0].length:2):this.parent.renderModule.calculateColWidth(this.parent.dataSourceSettings.values.length>0&&this.parent.engineModule.pivotValues.length>0?this.parent.engineModule.pivotValues[0].length:2);for(var u=0;u<i.length;u++)if(0!==u)if(i[u].columns)this.setColWidth(i[u].columns,p);else if("auto"!==i[u].width){var c=i[u].customAttributes?i[u].customAttributes.cell.valueSort.levelName:"";i[u].width=this.parent.renderModule.setSavedWidth(c,p)}else i[u].minWidth=p;this.parent.posCount=0,this.parent.setGridColumns(this.parent.grid.columns),this.parent.grid.headerModule.refreshUI(),this.parent.firstColWidth||(e.style.width=o,d.style.width=o,s.style.width=o,l.style.width=o,t.setStyleAttribute(s,{width:o}),t.setStyleAttribute(l,{width:o}))}else this.parent.grid.columns&&this.parent.grid.columns.length>0&&(this.parent.grid.columns[0].width=this.parent.grid.columns[0].width>this.resColWidth?this.parent.grid.columns[0].width:this.resColWidth),this.parent.grid.headerModule.refreshUI();this.groupingTable&&this.refreshUI()},e.prototype.setColWidth=function(e,t){for(var i=0;i<e.length;i++)e[i].columns?this.setColWidth(e[i].columns,t):"auto"!=e[i].width?e[i].width=t:e[i].minWidth=t},e.prototype.wireEvent=function(e){t.EventHandler.add(e,"mouseover",this.dropIndicatorUpdate,this),t.EventHandler.add(e,"mouseleave",this.dropIndicatorUpdate,this)},e.prototype.unWireEvent=function(e){t.EventHandler.remove(e,"mouseover",this.dropIndicatorUpdate),t.EventHandler.remove(e,"mouseleave",this.dropIndicatorUpdate)},e.prototype.dropIndicatorUpdate=function(e){(this.parent.isDragging&&e.target.classList.contains(oi)&&"mouseover"===e.type||!this.parent.isDragging||!e.target.classList.contains(oi)&&"mouseleave"===e.type)&&(t.removeClass([].slice.call(this.parent.element.querySelectorAll("."+Xt)),Jt),t.removeClass([].slice.call(this.parent.element.querySelectorAll("."+Xt+"-last")),Jt))},e.prototype.tapHoldHandler=function(e){var i=t.closest(e.originalEvent.target,"."+_t);if(!t.isNullOrUndefined(i)&&this.parent.isAdaptive){var a=i.getBoundingClientRect();return this.parent.contextMenuModule.fieldElement=i,void this.parent.contextMenuModule.menuObj.open(a.top,a.left)}},e.prototype.RefreshFieldsPanel=function(){if("pivot"===this.parent.dataType&&null!=this.parent.groupingBarSettings){if(t.selectAll("#"+this.parent.element.id+"_AllFields",this.parent.element).length>0)for(var e=0,i=t.selectAll("#"+this.parent.element.id+"_AllFields",this.parent.element);e<i.length;e++){i[e].remove()}this.parent.groupingBarSettings.showFieldsPanel&&(this.groupingChartTable&&"Table"!==this.parent.displayOption.view&&"Table"!==this.parent.groupingBarSettings.displayMode&&(this.chartPanel=this.createToolbarUI(this.groupingChartTable)),this.groupingTable&&(this.gridPanel=this.createToolbarUI(this.groupingTable)),this.parent.axisFieldModule.render(),this.refreshUI())}},e.prototype.createToolbarUI=function(e){t.select("#"+this.parent.element.id+"_AllFields",e)&&t.select("#"+this.parent.element.id+"_AllFields",e).remove(),e.prepend(t.createElement("div",{id:this.parent.element.id+"_AllFields"}));var i=new n.Toolbar({cssClass:qt,enableRtl:this.parent.enableRtl,items:[{template:"<div class="+ui+"></div>"}],allowKeyboard:!1,width:this.parent.grid?this.parent.getGridWidthAsNumber()-2:this.parent.getWidthAsNumber()-2});return i.appendTo(t.select("#"+this.parent.element.id+"_AllFields",e)),i},e.prototype.addEventListener=function(){this.handlers={load:this.renderLayout,end:this.appendToElement},this.parent.isDestroyed||(this.parent.on(oe,this.handlers.load,this),this.parent.on(ae,this.handlers.end,this))},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ae,this.handlers.end),this.parent.off(oe,this.handlers.load))},e.prototype.destroy=function(){this.removeEventListener(),this.parent.pivotButtonModule&&this.parent.pivotButtonModule.destroy(),this.groupingTable&&this.groupingTable.querySelector("."+qt)&&null!=this.gridPanel&&!this.gridPanel.isDestroyed&&(this.gridPanel.destroy(),this.gridPanel=null),this.groupingChartTable&&this.groupingChartTable.querySelector("."+qt)&&null!=this.chartPanel&&!this.chartPanel.isDestroyed&&(this.chartPanel.destroy(),this.chartPanel=null),this.touchObj&&!this.touchObj.isDestroyed&&this.touchObj.destroy(),this.parent.element.querySelector("."+pi)&&t.remove(this.parent.element.querySelector("."+pi))},e}(),Hn=function(){function e(e){this.parent=e,this.parent.conditionalFormattingModule=this,this.parentID=this.parent.element.id,this.dialog=null,this.fieldsDropDown=[],this.conditionsDropDown=[],this.fontNameDropDown=[],this.fontSizeDropDown=[],this.fontColor=[],this.backgroundColor=[],this.newFormat=[]}return e.prototype.getModuleName=function(){return"conditionalFormatting"},e.prototype.createDialog=function(){null!==t.select("#"+this.parentID+"conditionalformatting",document)&&t.remove(t.select("#"+this.parentID+"conditionalformatting",document)),this.parent.element.appendChild(t.createElement("div",{id:this.parentID+"conditionalformatting"}));var e=[{click:this.addButtonClick.bind(this),buttonModel:{cssClass:this.parent.isAdaptive?"e-small e-round "+fa:fa,iconCss:Ot+" "+xi,content:this.parent.isAdaptive?"":this.parent.localeObj.getConstant("condition")}},{click:this.applyButtonClick.bind(this),isFlat:!0,buttonModel:{isPrimary:!0,cssClass:"e-format-apply-button",content:this.parent.localeObj.getConstant("apply")}},{click:this.cancelButtonClick.bind(this),isFlat:!0,buttonModel:{cssClass:"e-format-cancel-button",content:this.parent.localeObj.getConstant("cancel")}}];this.parent.isAdaptive?this.dialog=new a.Dialog({animationSettings:{effect:"Zoom"},isModal:!0,width:"100%",height:"100%",showCloseIcon:!1,closeOnEscape:!1,enableRtl:this.parent.enableRtl,locale:this.parent.locale,position:{X:"center",Y:"center"},allowDragging:!0,buttons:e,beforeOpen:this.beforeOpen.bind(this),close:this.removeDialog.bind(this),cssClass:ma,header:this.parent.localeObj.getConstant("conditionalFormating"),target:document.body}):this.dialog=new a.Dialog({allowDragging:!0,position:{X:"center",Y:this.parent.element.offsetTop},buttons:e,beforeOpen:this.beforeOpen.bind(this),close:this.removeDialog.bind(this),cssClass:ma,isModal:!1,closeOnEscape:!0,enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,header:this.parent.localeObj.getConstant("conditionalFormating"),target:this.parent.element}),this.dialog.isStringTemplate=!0,this.dialog.appendTo("#"+this.parentID+"conditionalformatting")},e.prototype.beforeOpen=function(e){this.dialog.element.querySelector(".e-dlg-header").setAttribute("title",this.parent.localeObj.getConstant("conditionalFormating"))},e.prototype.addButtonClick=function(){var e=this,t=this;this.parent.trigger(U,{conditions:"LessThan",value1:0,applyGrandTotals:!0,style:{backgroundColor:"white",color:"black",fontFamily:"Arial",fontSize:"12px"}},function(i){t.refreshConditionValues(),e.destroyColorPickers(),t.newFormat.push(i),t.addFormat()})},e.prototype.applyButtonClick=function(){if(this.refreshConditionValues()){this.parent.setProperties({dataSourceSettings:{conditionalFormatSettings:this.newFormat}},!0);var e={conditionalFormattingInfo:this.parent.dataSourceSettings.conditionalFormatSettings};this.parent.actionObj.actionInfo=e,this.parent.renderPivotGrid(),this.dialog.close()}},e.prototype.cancelButtonClick=function(){this.dialog.close(),this.newFormat=[]},e.prototype.refreshConditionValues=function(){for(var e=0;e<this.newFormat.length;e++){if(""===t.select("#"+this.parentID+"conditionvalue1"+e,document).value||""===t.select("#"+this.parentID+"conditionvalue2"+e,document).value)return""===t.select("#"+this.parentID+"conditionvalue1"+e,document).value?t.select("#"+this.parentID+"conditionvalue1"+e,document).focus():t.select("#"+this.parentID+"conditionvalue2"+e,document).focus(),!1;this.newFormat[e].value1=Number(t.select("#"+this.parentID+"conditionvalue1"+e,document).value),this.newFormat[e].value2=Number(t.select("#"+this.parentID+"conditionvalue2"+e,document).value)}return!0},e.prototype.addFormat=function(){for(var e=t.createElement("div",{id:this.parentID+"formatDiv",className:"e-new-format"}),i=0;i<this.newFormat.length;i++)e.appendChild(this.createDialogElements(i));if(0===this.newFormat.length){var a=this.createDialogElements(),r=t.createElement("p",{id:this.parentID+"emptyFormat",className:"e-pivot-conditional-empty-format",innerHTML:this.parent.localeObj.getConstant("emptyFormat")});a.appendChild(r),e.appendChild(a)}this.dialog.setProperties({content:e},!1);for(i=0;i<this.newFormat.length;i++)this.renderDropDowns(i),this.renderColorPicker(i)},e.prototype.createDialogElements=function(e){var i=t.createElement("div",{id:this.parentID+"outerDiv"+e,className:"e-format-outer-div"});if(void 0!==e){var a=this.newFormat[e],r=t.createElement("button",{id:this.parentID+"removeButton"+e,className:"e-format-delete-button",attrs:{type:"button",title:this.parent.localeObj.getConstant("delete")}});i.appendChild(r);var n=t.createElement("div",{id:this.parentID+"innerDiv",className:"e-format-inner-div"}),o=t.createElement("table",{id:this.parentID+"cftable",className:"e-format-table"}),s=t.createElement("tr"),l=t.createElement("td"),d=t.createElement("span",{id:this.parentID+"valuelabel"+e,className:"e-format-value-label",innerHTML:this.parent.localeObj.getConstant("value")});l.appendChild(d),s.appendChild(l),o.appendChild(s),s=t.createElement("tr"),l=t.createElement("td");var h=t.createElement("div",{id:this.parentID+"measure"+e}),p=t.createElement("input",{id:this.parentID+"measureinput"+e,attrs:{type:"text",tabindex:"0"}});h.appendChild(p),l.appendChild(h),s.appendChild(l),l=t.createElement("td");var u=t.createElement("div",{id:this.parentID+"condition"}),c=t.createElement("input",{id:this.parentID+"conditioninput"+e,attrs:{type:"text",tabindex:"0"}});u.appendChild(c),l.appendChild(u),s.appendChild(l),l=t.createElement("td");var g="Between"!==a.conditions&&"NotBetween"!==a.conditions?"display:none; width:10px":"",m=t.createElement("input",{id:this.parentID+"conditionvalue1"+e,attrs:{type:"text",tabindex:"0",value:t.isNullOrUndefined(a.value1)?"0":a.value1.toString(),placeholder:this.parent.localeObj.getConstant("emptyInput")},styles:this.parent.isAdaptive?""===g?"width: 35%":"width: 100%":""===g?"width: 45px":"width: 120px",className:va+" e-format-value1"});l.appendChild(m);var f=t.createElement("span",{id:this.parentID+"valuespan"+e,className:"e-format-value-span",innerHTML:"&",styles:g});l.appendChild(f);var v=t.createElement("input",{id:this.parentID+"conditionvalue2"+e,attrs:{type:"text",tabindex:"0",value:t.isNullOrUndefined(a.value2)?"0":a.value2.toString(),placeholder:this.parent.localeObj.getConstant("emptyInput")},styles:this.parent.isAdaptive&&""===g?"width: 35%":""===g?"width: 45px":g,className:va+" e-format-value2"});l.appendChild(v),s.appendChild(l),o.appendChild(s),this.parent.isAdaptive&&(n.appendChild(o),o=t.createElement("table",{id:this.parentID+"cftable",className:"e-format-table"})),s=t.createElement("tr"),l=t.createElement("td");var S=t.createElement("span",{id:this.parentID+"formatlabel"+e,className:"e-format-label",innerHTML:this.parent.localeObj.getConstant("formatLabel")});l.appendChild(S),s.appendChild(l),o.appendChild(s),s=t.createElement("tr"),l=t.createElement("td");var y=t.createElement("div",{id:this.parentID+"fontname"}),b=t.createElement("input",{id:this.parentID+"fontnameinput"+e,attrs:{type:"text",tabindex:"0"}});y.appendChild(b),l.appendChild(y),s.appendChild(l),l=t.createElement("td");var C=t.createElement("div",{id:this.parentID+"fontsize"}),x=t.createElement("input",{id:this.parentID+"fontsizeinput"+e,attrs:{type:"text",tabindex:"0"}});C.appendChild(x),l.appendChild(C),s.appendChild(l),this.parent.isAdaptive&&(o.appendChild(s),s=t.createElement("tr"),o.appendChild(s),s=t.createElement("tr")),l=t.createElement("td");var w=t.createElement("input",{id:this.parentID+"fontcolor"+e,attrs:{type:"color",tabindex:"0"},className:"e-format-font-color"});l.appendChild(w);var T=t.createElement("input",{id:this.parentID+"backgroundcolor"+e,attrs:{type:"color",tabindex:"0"},className:"e-format-back-color"});l.appendChild(T),s.appendChild(l),l=t.createElement("td");var M=t.createElement("div",{id:this.parentID+"valuepreview"+e,className:va+" e-format-value-preview",innerHTML:"123.45"});l.appendChild(M),s.appendChild(l),o.appendChild(s),n.appendChild(o),i.appendChild(n)}return i},e.prototype.renderDropDowns=function(e){var i=this.newFormat[e],a=[];a.push({index:0,name:this.parent.localeObj.getConstant("AllValues"),field:this.parent.localeObj.getConstant("AllValues")});for(var r=0;r<this.parent.dataSourceSettings.values.length;r++)a.push({index:r+1,name:this.parent.dataSourceSettings.values[r].caption||this.parent.dataSourceSettings.values[r].name,field:this.parent.dataSourceSettings.values[r].name});var n=t.isNullOrUndefined(i.measure)?this.parent.localeObj.getConstant("AllValues"):i.measure;this.fieldsDropDown[e]=new s.DropDownList({dataSource:a,fields:{text:"name",value:"field"},value:n,width:this.parent.isAdaptive?"100%":"120px",popupHeight:"200px",popupWidth:"auto",locale:this.parent.locale,enableRtl:this.parent.enableRtl,change:this.measureChange.bind(this,e)}),this.fieldsDropDown[e].isStringTemplate=!0,this.fieldsDropDown[e].appendTo("#"+this.parentID+"measureinput"+e);var o=[{value:"LessThan",name:this.parent.localeObj.getConstant("LessThan")},{value:"LessThanOrEqualTo",name:this.parent.localeObj.getConstant("LessThanOrEqualTo")},{value:"GreaterThan",name:this.parent.localeObj.getConstant("GreaterThan")},{value:"GreaterThanOrEqualTo",name:this.parent.localeObj.getConstant("GreaterThanOrEqualTo")},{value:"Equals",name:this.parent.localeObj.getConstant("Equals")},{value:"NotEquals",name:this.parent.localeObj.getConstant("NotEquals")},{value:"Between",name:this.parent.localeObj.getConstant("Between")},{value:"NotBetween",name:this.parent.localeObj.getConstant("NotBetween")}];n=t.isNullOrUndefined(i.conditions)?"LessThan":i.conditions,this.conditionsDropDown[e]=new s.DropDownList({dataSource:o,fields:{value:"value",text:"name"},value:n,width:this.parent.isAdaptive?"100%":"120px",popupHeight:"200px",popupWidth:"auto",locale:this.parent.locale,enableRtl:this.parent.enableRtl,change:this.conditionChange.bind(this,e)}),this.conditionsDropDown[e].isStringTemplate=!0,this.conditionsDropDown[e].appendTo("#"+this.parentID+"conditioninput"+e);n=t.isNullOrUndefined(i.style.fontFamily)?"Arial":i.style.fontFamily,this.fontNameDropDown[e]=new s.DropDownList({dataSource:[{index:0,name:"Arial"},{index:1,name:"San Serif"},{index:2,name:"Impact"},{index:3,name:"Trebuchet MS"},{index:4,name:"Serif"},{index:5,name:"Verdana"},{index:6,name:"Courier New"},{index:7,name:"Times New Roman"},{index:8,name:"Tahoma"},{index:9,name:"Gerogia"}],fields:{text:"name"},value:n,width:this.parent.isAdaptive?"100%":"120px",popupWidth:"150px",popupHeight:"200px",locale:this.parent.locale,enableRtl:this.parent.enableRtl,change:this.fontNameChange.bind(this,e)}),this.fontNameDropDown[e].isStringTemplate=!0,this.fontNameDropDown[e].appendTo("#"+this.parentID+"fontnameinput"+e);n=t.isNullOrUndefined(i.style.fontSize)?"12px":i.style.fontSize,this.fontSizeDropDown[e]=new s.DropDownList({dataSource:[{index:0,name:"9px"},{index:1,name:"10px"},{index:2,name:"11px"},{index:3,name:"12px"},{index:4,name:"13px"},{index:5,name:"14px"},{index:6,name:"15px"},{index:6,name:"16px"}],fields:{text:"name"},popupHeight:"200px",value:n,width:this.parent.isAdaptive?"100%":"120px",change:this.fontSizeChange.bind(this,e),locale:this.parent.locale,enableRtl:this.parent.enableRtl}),this.fontSizeDropDown[e].isStringTemplate=!0,this.fontSizeDropDown[e].appendTo("#"+this.parentID+"fontsizeinput"+e)},e.prototype.conditionChange=function(e,i){this.newFormat[e].conditions=i.value,"Between"===i.value||"NotBetween"===i.value?(t.select("#"+this.parentID+"valuespan"+e,document).style.display="inline-block",t.select("#"+this.parentID+"valuespan"+e,document).style.width=this.parent.isAdaptive?"10%":"10px",t.select("#"+this.parentID+"conditionvalue2"+e,document).style.display="inline-block",t.select("#"+this.parentID+"conditionvalue2"+e,document).style.width=this.parent.isAdaptive?"35%":"45px",t.select("#"+this.parentID+"conditionvalue1"+e,document).style.width=this.parent.isAdaptive?"35%":"45px"):(t.select("#"+this.parentID+"valuespan"+e,document).style.display="none",t.select("#"+this.parentID+"conditionvalue2"+e,document).style.display="none",t.select("#"+this.parentID+"conditionvalue1"+e,document).style.width=this.parent.isAdaptive?"100%":"120px")},e.prototype.fontNameChange=function(e,i){this.newFormat[e].style.fontFamily=i.value.toString(),t.select("#"+this.parentID+"valuepreview"+e,document).style.fontFamily=i.value},e.prototype.fontSizeChange=function(e,i){this.newFormat[e].style.fontSize=i.value.toString(),t.select("#"+this.parentID+"valuepreview"+e,document).style.fontSize=i.value},e.prototype.measureChange=function(e,t){this.newFormat[e].measure=t.value.toString()===this.parent.localeObj.getConstant("AllValues")?void 0:t.value.toString()},e.prototype.renderColorPicker=function(e){var i=this.newFormat[e],a=t.isNullOrUndefined(i.style.color)?"black":i.style.color,r=this.isHex(a.substr(1))?a:this.colourNameToHex(a);t.select("#"+this.parentID+"valuepreview"+e,document).style.color=r,this.fontColor[e]=new o.ColorPicker({cssClass:Sa+" e-format-font-color-picker",value:r,mode:"Palette",change:this.fontColorChange.bind(this,e),locale:this.parent.locale,enableRtl:this.parent.enableRtl}),this.fontColor[e].isStringTemplate=!0,this.fontColor[e].appendTo("#"+this.parentID+"fontcolor"+e),t.addClass([this.fontColor[e].element.nextElementSibling.querySelector(".e-selected-color")],Ot),a=t.isNullOrUndefined(i.style.backgroundColor)?"white":i.style.backgroundColor,r=this.isHex(a.substr(1))?a:this.colourNameToHex(a),t.select("#"+this.parentID+"valuepreview"+e,document).style.backgroundColor=r,t.select("#"+this.parentID+"valuepreview"+e,document).style.fontFamily=i.style.fontFamily,t.select("#"+this.parentID+"valuepreview"+e,document).style.fontSize=i.style.fontSize,this.backgroundColor[e]=new o.ColorPicker({cssClass:Sa,value:r,mode:"Palette",change:this.backColorChange.bind(this,e),locale:this.parent.locale,enableRtl:this.parent.enableRtl}),this.backgroundColor[e].isStringTemplate=!0,this.backgroundColor[e].appendTo("#"+this.parentID+"backgroundcolor"+e),t.addClass([this.backgroundColor[e].element.nextElementSibling.querySelector(".e-selected-color")],Ot);var n=new h.Button({iconCss:Ot+" e-format-delete-icon",cssClass:"e-flat",locale:this.parent.locale,enableRtl:this.parent.enableRtl});n.isStringTemplate=!0,n.appendTo("#"+this.parentID+"removeButton"+e),n.element.onclick=this.toggleButtonClick.bind(this,e)},e.prototype.backColorChange=function(e,i){this.newFormat[e].style.backgroundColor=i.currentValue.hex,t.select("#"+this.parentID+"valuepreview"+e,document).style.backgroundColor=i.currentValue.hex},e.prototype.fontColorChange=function(e,i){this.newFormat[e].style.color=i.currentValue.hex,t.select("#"+this.parentID+"valuepreview"+e,document).style.color=i.currentValue.hex},e.prototype.toggleButtonClick=function(e){this.destroyColorPickers(),this.newFormat.splice(e,1),this.addFormat()},e.prototype.isHex=function(e){for(var t=parseInt(e,16);"0"===e.charAt(0);)e=e.substr(1);return t.toString(16)===e.toLowerCase()||0===t&&""===e},e.prototype.hexToRgb=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},e.prototype.colourNameToHex=function(e){var t={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};if(void 0!==t[e.toLowerCase()])return t[e.toLowerCase()];if(0===e.search("rgba")){for(var i=e.substr(5).split(")")[0].split(","),a="",r="",n=0;n<i.length-1;n++)i[n]=(+i[n]).toString(16),1===i[n].length&&(i[n]="0"+i[n]),a+=i[n];return r=Math.round(255*+i[3]).toString(16),"#"+a+r}if(0===e.search("rgb")){for(i=e.substr(4).split(")")[0].split(","),a="",n=0;n<i.length;n++)i[n]=(+i[n]).toString(16),1===i[n].length&&(i[n]="0"+i[n]),a+=i[n];return"#"+a}return"#d5d5d5"},e.prototype.removeDialog=function(){this.dialog&&!this.dialog.isDestroyed&&(this.destroyColorPickers(),this.dialog.destroy()),t.select("#"+this.parentID+"conditionalformatting",document)&&t.remove(t.select("#"+this.parentID+"conditionalformatting",document))},e.prototype.destroyColorPickers=function(){for(var e=0;e<(this.newFormat?this.newFormat.length:0);e++)this.fontColor&&this.fontColor[e]&&!this.fontColor[e].isDestroyed&&this.fontColor[e].destroy(),this.backgroundColor&&this.backgroundColor[e]&&!this.backgroundColor[e].isDestroyed&&this.backgroundColor[e].destroy()},e.prototype.showConditionalFormattingDialog=function(){this.newFormat=[];for(var e=0;e<this.parent.dataSourceSettings.conditionalFormatSettings.length;e++)this.newFormat.push(t.extend({},this.parent.dataSourceSettings.conditionalFormatSettings[e].properties,null,!0));this.createDialog(),this.dialog.refresh(),this.addFormat()},e.prototype.destroy=function(){this.dialog&&!this.dialog.isDestroyed&&this.dialog.close()},e}(),Bn=function(){function e(e){this.isMultiAxisChange=!1,this.currentReport="",this.parent=e,this.parent.toolbarModule=this,this.addEventListener()}return e.prototype.getModuleName=function(){return"toolbar"},e.prototype.createToolbar=function(){this.parent.isModified=!1,this.renderDialog(),null!==t.select("#"+this.parent.element.id+"pivot-toolbar",document)&&t.remove(t.select("#"+this.parent.element.id+"pivot-toolbar",document));var e=t.createElement("div",{id:this.parent.element.id+"pivot-toolbar",className:ja});this.parent.showFieldList&&t.select("#"+this.parent.element.id+"_PivotFieldList",this.parent.element)?this.parent.element.insertBefore(e,t.select("#"+this.parent.element.id+"_PivotFieldList",this.parent.element)):this.parent.showGroupingBar&&t.select("#"+this.parent.element.id+" .e-pivot-grouping-bar",this.parent.element)?this.parent.element.insertBefore(e,t.select("#"+this.parent.element.id+" .e-pivot-grouping-bar",this.parent.element)):this.parent.element.insertBefore(e,t.select("#"+this.parent.element.id+"_grid",this.parent.element)),this.toolbar=new n.Toolbar({created:this.create.bind(this),enableRtl:this.parent.enableRtl,locale:this.parent.locale,items:this.getItems(),allowKeyboard:!1,width:this.parent.gridSettings.allowAutoResizing?"auto":this.parent.grid?this.parent.getGridWidthAsNumber()-2:this.parent.getWidthAsNumber()-2}),this.toolbar.isStringTemplate=!0;var i="viewContainerRef";this.parent[i]&&(this.toolbar.registeredTemplate={},this.toolbar[i]=this.parent[i]),this.parent.toolbarTemplate&&"string"==typeof this.parent.toolbarTemplate?(this.toolbar.appendTo(this.parent.toolbarTemplate),this.parent.element.replaceChild(this.toolbar.element,this.parent.element.querySelector("."+ja)),this.toolbar.element.classList.add(ja)):(this.toolbar.appendTo("#"+this.parent.element.id+"pivot-toolbar"),this.toolbar.width=this.parent.grid?this.parent.getGridWidthAsNumber()-2:this.parent.getWidthAsNumber()-2),this.parent.chart&&this.parent.chart.setProperties({width:this.parent.grid?this.parent.getGridWidthAsNumber().toString():this.parent.getWidthAsNumber().toString()},!0),this.parent.showGroupingBar&&this.parent.groupingBarModule&&this.parent.element.querySelector("."+pi)&&this.parent.groupingBarModule.refreshUI()},e.prototype.fetchReports=function(){var e={reportName:[]};return this.parent.trigger(A,e),e},e.prototype.fetchReportsArgs=function(){var e=new i.Deferred;return this.parent.trigger(A,{reportName:[]},function(t){e.resolve(t)}),e},e.prototype.getItems=function(){for(var e=this.parent.toolbar.filter(function(e,t,i){return i.indexOf(e)===t}),i=[],a=0,r=e;a<r.length;a++){var n=r[a];switch(n){case"New":i.push({prefixIcon:"e-new-report "+Ot,tooltipText:this.parent.localeObj.getConstant("new"),click:this.actionClick.bind(this),id:this.parent.element.id+"new"});break;case"Save":i.push({prefixIcon:"e-save-report "+Ot,tooltipText:this.parent.localeObj.getConstant("save"),click:this.actionClick.bind(this),id:this.parent.element.id+"save"});break;case"SaveAs":i.push({prefixIcon:"e-saveas-report "+Ot,tooltipText:this.parent.localeObj.getConstant("saveAs"),click:this.actionClick.bind(this),id:this.parent.element.id+"saveas"});break;case"Rename":i.push({prefixIcon:"e-rename-report "+Ot,tooltipText:this.parent.localeObj.getConstant("rename"),click:this.actionClick.bind(this),id:this.parent.element.id+"rename"});break;case"Remove":i.push({prefixIcon:Ra+" "+Ot,tooltipText:this.parent.localeObj.getConstant("deleteReport"),click:this.actionClick.bind(this),id:this.parent.element.id+"remove"});break;case"Load":i.push({template:"<div><input class=e-load-report id="+this.parent.element.id+"_reportlist></input></div>",click:this.actionClick.bind(this),id:this.parent.element.id+"load"});break;case"Grid":var o="Chart"===this.parent.displayOption.view;i.push({prefixIcon:"e-toolbar-grid "+Ot,tooltipText:this.parent.localeObj.getConstant("grid"),id:this.parent.element.id+"grid",cssClass:o?da:"",click:this.menuItemClick.bind(this)});break;case"Chart":var s="Table"===this.parent.displayOption.view;i.push({template:'<ul id="'+this.parent.element.id+'chart_menu"></ul>',id:this.parent.element.id+"chartmenu",cssClass:s?da:""});break;case"MDX":"olap"===this.parent.dataType&&i.push({prefixIcon:"e-mdx "+Ot,id:this.parent.element.id+"mdxQuery",click:this.actionClick.bind(this),tooltipText:this.parent.localeObj.getConstant("mdxQuery")});break;case"Export":i.push({template:'<ul id="'+this.parent.element.id+'export_menu"></ul>',id:this.parent.element.id+"exportmenu"});break;case"SubTotal":i.push({template:'<ul id="'+this.parent.element.id+'subtotal_menu"></ul>',id:this.parent.element.id+"subtotalmenu"});break;case"GrandTotal":i.push({template:'<ul id="'+this.parent.element.id+'grandtotal_menu"></ul>',id:this.parent.element.id+"grandtotalmenu"});break;case"ConditionalFormatting":i.push({prefixIcon:"e-toolbar-formatting "+Ot,id:this.parent.element.id+"formatting",click:this.actionClick.bind(this),tooltipText:this.parent.localeObj.getConstant("toolbarFormatting")});break;case"NumberFormatting":i.push({prefixIcon:"e-pivot-format-toolbar "+Ot,id:this.parent.element.id+"numberFormatting",click:this.actionClick.bind(this),tooltipText:this.parent.localeObj.getConstant("numberFormat")});break;case"Formatting":i.push({template:'<ul id="'+this.parent.element.id+'formatting_menu"></ul>',id:this.parent.element.id+"formattingmenu"});break;case"FieldList":i.push({prefixIcon:"e-toolbar-fieldlist "+Ot,tooltipText:this.parent.localeObj.getConstant("fieldList"),click:this.actionClick.bind(this),align:"Right",id:this.parent.element.id+"fieldlist"}),this.parent.element.querySelector(".e-toggle-field-list")&&(this.parent.element.querySelector(".e-toggle-field-list").style.display="none");break;default:"object"==typeof n&&i.push(n)}}this.parent.showFieldList&&-1===e.indexOf("FieldList")&&t.select("#"+this.parent.element.id+"_PivotFieldList",this.parent.element)&&"none"===t.select("#"+this.parent.element.id+"_PivotFieldList",this.parent.element).style.display&&(t.select("#"+this.parent.element.id+"_PivotFieldList",this.parent.element).style.display="block");var l={customToolbar:i};return this.parent.trigger("toolbarRender",l),i},e.prototype.reportChange=function(e){if(this.parent.actionObj.actionName=He,this.parent.actionBeginMethod())e.cancel=!0;else try{this.dropArgs=e,this.parent.isModified&&""!==this.currentReport?this.createConfirmDialog(this.parent.localeObj.getConstant("alert"),this.parent.localeObj.getConstant("newReportConfirm")):this.reportLoad(e)}catch(e){this.parent.actionFailureMethod(e)}},e.prototype.reportLoad=function(e){var t=this;if("Save"!==this.action&&"Rename"!==this.action&&"New"!==this.action){var i={reportName:e.itemData.value},a={reportName:e.itemData.value};this.parent.actionObj.actionInfo=a,this.parent.trigger(R,i,function(e){t.currentReport=e.reportName,t.parent.isModified=!1})}},e.prototype.saveReport=function(e){if(this.currentReport&&""!==this.currentReport&&e.item.id===this.parent.element.id+"save"){var t={report:this.parent.getPersistData(),reportName:this.currentReport};this.parent.actionObj.actionName=this.parent.getActionCompleteName();var i={reportName:this.currentReport};this.parent.actionObj.actionInfo=i,this.parent.trigger(L,t),this.parent.actionObj.actionName&&this.parent.actionCompleteMethod(),this.parent.isModified=!1}else{if(""===this.currentReport&&(e.item.id===this.parent.element.id+"save"||e.item.id===this.parent.element.id+"saveas"))return void this.parent.pivotCommon.errorDialog.createErrorDialog(this.parent.localeObj.getConstant("error"),this.parent.localeObj.getConstant("emptyReport"));this.dialogShow(e,"saveAs")}},e.prototype.mdxQueryDialog=function(e){this.mdxDialog&&!this.mdxDialog.isDestroyed||this.renderMDXDialog();var i=t.createElement("div",{className:"e-mdx-query"}),a=t.createElement("textarea",{className:Ya,innerHTML:this.parent.olapEngineModule.getMDXQuery(this.parent.dataSourceSettings).trim(),attrs:{readonly:"readonly"}});i.appendChild(a),this.mdxDialog.content=i,this.mdxDialog.show()},e.prototype.dialogShow=function(e,i){if(e){this.dialog.header=e.item.tooltipText;var a=t.createElement("div",{className:"e-report-outer"}),r=t.createElement("div",{className:"e-pivotview-report-label",innerHTML:this.parent.localeObj.getConstant("reportName")}),n=t.createElement("input",{className:ka+" "+va,innerHTML:i&&"rename"===i?this.currentReport:"",attrs:{placeholder:this.parent.localeObj.getConstant("emptyReportName"),value:i&&"rename"===i?this.currentReport:""}});n.setSelectionRange(n.textContent.length,n.textContent.length),a.appendChild(r),a.appendChild(n),this.dialog.content=a,this.dialog.refresh(),this.dialog.show()}},e.prototype.renameReport=function(e){this.parent.trigger("toolbarClick",e),this.currentReport&&""!==this.currentReport?this.dialogShow(e,"rename"):this.parent.pivotCommon.errorDialog.createErrorDialog(this.parent.localeObj.getConstant("error"),this.parent.localeObj.getConstant("emptyReport"))},e.prototype.actionClick=function(e){var t=e.item.id==this.parent.element.id+"new"?ge:e.item.id==this.parent.element.id+"save"?me:e.item.id==this.parent.element.id+"saveas"?fe:e.item.id==this.parent.element.id+"rename"?ve:e.item.id==this.parent.element.id+"remove"?Se:e.item.id==this.parent.element.id+"load"?"Load report":e.item.id==this.parent.element.id+"formatting"?ye:e.item.id==this.parent.element.id+"numberFormatting"?be:e.item.id==this.parent.element.id+"mdxQuery"?"MdxQuery":e.item.id==this.parent.element.id+"fieldlist"?Ce:"";if(this.parent.actionObj.actionName=t,!this.parent.actionBeginMethod())try{switch(e.item.id){case this.parent.element.id+"save":case this.parent.element.id+"saveas":this.saveReport(e);break;case this.parent.element.id+"remove":return this.action="Remove",void(this.currentReport&&""!==this.currentReport?this.createConfirmDialog(this.parent.localeObj.getConstant("alert"),this.parent.localeObj.getConstant("removeConfirm")):this.parent.pivotCommon.errorDialog.createErrorDialog(this.parent.localeObj.getConstant("error"),this.parent.localeObj.getConstant("emptyReport")));case this.parent.element.id+"rename":this.renameReport(e);break;case this.parent.element.id+"new":this.action="New",this.newArgs=e,this.parent.isModified&&this.currentReport&&""!==this.currentReport?this.createConfirmDialog(this.parent.localeObj.getConstant("alert"),this.parent.localeObj.getConstant("newReportConfirm")):this.createNewReport(e);break;case this.parent.element.id+"load":this.action="Load";break;case this.parent.element.id+"fieldlist":this.parent.pivotFieldListModule&&this.parent.pivotFieldListModule.dialogRenderer&&this.parent.pivotFieldListModule.dialogRenderer.fieldListDialog.show();break;case this.parent.element.id+"formatting":this.parent.conditionalFormattingModule&&this.parent.conditionalFormattingModule.showConditionalFormattingDialog();break;case this.parent.element.id+"mdxQuery":this.mdxQueryDialog(e);break;case this.parent.element.id+"numberFormatting":this.parent.numberFormattingModule&&this.parent.numberFormattingModule.showNumberFormattingDialog()}}catch(e){this.parent.actionFailureMethod(e)}},e.prototype.renderDialog=function(){null!==t.select("#"+this.parent.element.id+"report-dialog",document)&&t.remove(t.select("#"+this.parent.element.id+"report-dialog",document)),this.parent.element.appendChild(t.createElement("div",{id:this.parent.element.id+"report-dialog",className:"e-pivotview-report-dialog"})),this.dialog=new a.Dialog({animationSettings:{effect:"Fade"},allowDragging:!0,position:{X:"center",Y:"center"},buttons:[{click:this.okBtnClick.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("ok"),isPrimary:!0}},{click:this.cancelBtnClick.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("cancel")}}],isModal:!0,visible:!1,showCloseIcon:!0,enableRtl:this.parent.enableRtl,locale:this.parent.locale,width:"auto",height:"auto",zIndex:1000001,closeOnEscape:!0,target:document.body}),this.dialog.isStringTemplate=!0,this.dialog.appendTo("#"+this.parent.element.id+"report-dialog")},e.prototype.renderMDXDialog=function(){null!==t.select("#"+this.parent.element.id+"mdx-dialog",document)&&t.remove(t.select("#"+this.parent.element.id+"mdx-dialog",document)),this.parent.element.appendChild(t.createElement("div",{id:this.parent.element.id+"mdx-dialog",className:"e-pivotview-mdx-dialog"})),this.mdxDialog=new a.Dialog({animationSettings:{effect:"Fade"},allowDragging:!0,position:{X:"center",Y:"center"},buttons:[{click:this.copyMDXQuery.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("copy"),isPrimary:!0}}],header:this.parent.localeObj.getConstant("mdxQuery"),isModal:!0,visible:!1,showCloseIcon:!0,enableRtl:this.parent.enableRtl,locale:this.parent.locale,width:"auto",height:"auto",zIndex:1000001,closeOnEscape:!0,target:document.body}),this.mdxDialog.isStringTemplate=!0,this.mdxDialog.appendTo("#"+this.parent.element.id+"mdx-dialog")},e.prototype.copyMDXQuery=function(){var e=this.mdxDialog.element.querySelector("."+Ya);try{e.select(),document.execCommand("copy")}catch(e){window.alert("Oops, unable to copy")}},e.prototype.okBtnClick=function(){var e=this,t=this.dialog.element.querySelector("."+ka);if(t&&""===t.value)t.focus();else{if(this.dialog.header!==this.parent.localeObj.getConstant("save")&&this.dialog.header!==this.parent.localeObj.getConstant("saveAs")||!t.value||""===t.value){if(this.dialog.header===this.parent.localeObj.getConstant("new")&&t.value&&""!==t.value){this.action="New",this.currentReport=t.value;var i=!1,a=this,r={reportName:[]};this.parent.trigger(A,r,function(n){for(var o=0;o<n.reportName.length;o++)if(t.value===r.reportName[o]){i=!0;break}if(i)a.createConfirmDialog(a.parent.localeObj.getConstant("alert"),a.parent.localeObj.getConstant("replaceConfirmBefore")+'"'+t.value+'"'+a.parent.localeObj.getConstant("replaceConfirmAfter"));else{a.parent.trigger("newReport");var s={report:a.parent.getPersistData(),reportName:t.value},l={reportName:t.value};e.parent.actionObj.actionInfo=l,a.parent.trigger(L,s),a.parent.isModified=!1,a.updateReportList(),a.dialog.hide()}})}else if(this.dialog.header===this.parent.localeObj.getConstant("rename")&&t.value&&""!==t.value){if(this.currentReport===t.value)return void this.dialog.hide();this.action="Rename";var n=!1,o=this;d={reportName:[]};this.parent.trigger(A,d,function(i){o.renameText=t.value;for(var a=0;a<i.reportName.length;a++)if(t.value===i.reportName[a]){n=!0;break}if(n)o.createConfirmDialog(o.parent.localeObj.getConstant("alert"),o.parent.localeObj.getConstant("replaceConfirmBefore")+'"'+t.value+'"'+o.parent.localeObj.getConstant("replaceConfirmAfter"));else{var r={reportName:o.currentReport,rename:t.value},s={reportName:{oldName:o.currentReport,newName:t.value}};e.parent.actionObj.actionInfo=s,o.parent.trigger(j,r),o.currentReport=t.value,o.updateReportList(),o.dialog.hide()}})}}else{this.action="Save",this.currentReport=t.value;var s=!1,l=this,d={reportName:[]};this.parent.trigger(A,d,function(i){for(var a=0;a<i.reportName.length;a++)if(t.value===i.reportName[a]){s=!0;break}if(s)l.createConfirmDialog(l.parent.localeObj.getConstant("alert"),l.parent.localeObj.getConstant("replaceConfirmBefore")+'"'+t.value+'"'+l.parent.localeObj.getConstant("replaceConfirmAfter"));else{var r={report:l.parent.getPersistData(),reportName:t.value},n={reportName:t.value};e.parent.actionObj.actionInfo=n,l.parent.trigger(L,r),l.parent.isModified=!1,l.updateReportList(),l.dialog.hide()}})}this.parent.actionObj.actionName=this.parent.getActionCompleteName(),this.parent.actionObj.actionName&&this.parent.actionCompleteMethod()}},e.prototype.createNewReport=function(e){this.dialogShow(e)},e.prototype.cancelBtnClick=function(){this.dialog.hide()},e.prototype.createConfirmDialog=function(e,i){document.getElementById(this.parent.element.id+"_ConfirmDialog")&&t.remove(document.getElementById(this.parent.element.id+"_ConfirmDialog").parentElement);var r=t.createElement("div",{id:this.parent.element.id+"_ConfirmDialog",className:ni});this.parent.element.appendChild(r),this.confirmPopUp=new a.Dialog({animationSettings:{effect:"Fade"},allowDragging:!0,showCloseIcon:!0,enableRtl:this.parent.enableRtl,locale:this.parent.locale,header:e,content:i,isModal:!0,visible:!0,closeOnEscape:!0,target:document.body,width:"auto",height:"auto",position:{X:"center",Y:"center"},buttons:[{buttonModel:{content:this.parent.localeObj.getConstant("yes"),isPrimary:!0,cssClass:ai},click:this.okButtonClick.bind(this)},{buttonModel:{content:this.parent.localeObj.getConstant("no"),cssClass:ri},click:this.cancelButtonClick.bind(this)}]}),this.confirmPopUp.isStringTemplate=!0,this.confirmPopUp.appendTo(r),this.confirmPopUp.element.querySelector(".e-dlg-header").innerHTML=e},e.prototype.okButtonClick=function(){var e=this;if("Remove"===this.action){var t={reportName:this.currentReport},i={reportName:this.currentReport};this.parent.actionObj.actionInfo=i,this.parent.trigger("removeReport",t);var a=this.fetchReports();if(a.reportName&&a.reportName.length>0){var r={reportName:a.reportName[a.reportName.length-1]};this.parent.trigger(R,r,function(t){e.currentReport=t.reportName,e.parent.isModified=!1}),this.currentReport=a.reportName[a.reportName.length-1]}else this.currentReport="",this.parent.isModified=!1,this.action="";this.updateReportList(),this.parent.actionObj.actionName="Report removed",this.parent.actionObj.actionName&&this.parent.actionCompleteMethod()}else if("New"===this.action||"Save"!==this.action&&"Rename"!==this.action&&"New"!==this.action){if(this.currentReport&&""!==this.currentReport&&this.parent.isModified){var n={report:this.parent.getPersistData(),reportName:this.currentReport};i={reportName:this.currentReport};this.parent.actionObj.actionInfo=i,this.parent.actionObj.actionName=rt,this.parent.actionObj.actionName&&this.parent.actionCompleteMethod(),this.parent.trigger(L,n),this.parent.isModified=!1,"New"===this.action?(this.parent.actionObj.actionName=ge,this.createNewReport(this.newArgs)):(this.parent.actionObj.actionName=He,this.reportLoad(this.dropArgs))}else if("New"===this.action){this.parent.trigger("newReport");n={report:this.parent.getPersistData(),reportName:this.currentReport};this.parent.trigger(L,n),this.parent.isModified=!1,this.updateReportList(),this.dialog.hide()}}else if("Save"===this.action){n={report:this.parent.getPersistData(),reportName:this.currentReport};this.parent.trigger(L,n),this.parent.isModified=!1,this.updateReportList(),this.dialog.hide()}else if("Rename"===this.action){var o={reportName:this.currentReport,rename:this.renameText,isReportExists:!0};this.parent.trigger(j,o),this.currentReport=this.renameText,this.parent.isModified=!1,this.updateReportList(),this.dialog.hide()}this.confirmPopUp.hide()},e.prototype.cancelButtonClick=function(){"New"===this.action?this.parent.isModified?this.createNewReport(this.newArgs):this.dialog.hide():"Save"===this.action?(this.currentReport=this.reportList.value,this.dialog.hide()):"Rename"===this.action?this.dialog.hide():this.dropArgs&&"Remove"!==this.action&&this.reportLoad(this.dropArgs),this.confirmPopUp.hide()},e.prototype.createChartMenu=function(){var e=this;if(t.select("#"+this.parent.element.id+"chart_menu",document)){for(var i=[],a=this.getValidChartType(),r=0;r<a.length&&r<7;r++){var o=a[r];i.push({text:this.parent.localeObj.getConstant(o.toLowerCase()),id:this.parent.element.id+"_"+o})}7===i.length&&(i.splice(6),i.push({text:this.parent.localeObj.getConstant("MoreOption"),id:this.parent.element.id+"_ChartMoreOption"}));var s=i.length<=0||"Table"===this.parent.displayOption.view;i.push({separator:!0}),i.push({text:this.parent.localeObj.getConstant("multipleAxes"),id:this.parent.element.id+"_multipleAxes"}),i.push({text:this.parent.localeObj.getConstant("showLegend"),id:this.parent.element.id+"_showLegend"});var l=[{iconCss:"e-toolbar-chart "+Ot,items:s?[]:i}];this.chartMenu&&!this.chartMenu.isDestroyed&&this.chartMenu.destroy(),this.chartMenu=new n.Menu({items:l,enableRtl:this.parent.enableRtl,locale:this.parent.locale,cssClass:Ja,select:this.menuItemClick.bind(this),beforeOpen:this.whitespaceRemove.bind(this),onClose:function(t){e.focusToolBar()},beforeItemRender:this.multipleAxesCheckbox.bind(this)}),this.chartMenu.isStringTemplate=!0,this.chartMenu.appendTo("#"+this.parent.element.id+"chart_menu")}},e.prototype.create=function(){var e=this;if(t.select("#"+this.parent.element.id+"chart_menu",this.parent.element)&&this.createChartMenu(),t.select("#"+this.parent.element.id+"export_menu",this.parent.element)){var i=[{iconCss:"e-export "+Ot,items:[{text:this.parent.localeObj.getConstant("pdf"),iconCss:Ia+" "+Ot,id:this.parent.element.id+"pdf"},{text:this.parent.localeObj.getConstant("excel"),iconCss:La+" "+Ot,id:this.parent.element.id+"excel"},{text:this.parent.localeObj.getConstant("csv"),iconCss:Aa+" "+Ot,id:this.parent.element.id+"csv"},{text:this.parent.localeObj.getConstant("png"),iconCss:"e-pivotview-png-export "+Ot,id:this.parent.element.id+"png"},{text:this.parent.localeObj.getConstant("jpeg"),iconCss:"e-pivotview-jpeg-export "+Ot,id:this.parent.element.id+"jpeg"},{text:this.parent.localeObj.getConstant("svg"),iconCss:"e-pivotview-svg-export "+Ot,id:this.parent.element.id+"svg"}]}];this.exportMenu=new n.Menu({items:i,enableRtl:this.parent.enableRtl,locale:this.parent.locale,cssClass:Ja,select:this.menuItemClick.bind(this),beforeOpen:this.updateExportMenu.bind(this),onClose:function(t){e.focusToolBar()}}),this.exportMenu.isStringTemplate=!0,this.exportMenu.appendTo("#"+this.parent.element.id+"export_menu")}if(t.select("#"+this.parent.element.id+"subtotal_menu",this.parent.element)){i=[{iconCss:"e-sub-total "+Ot,items:[{text:this.parent.localeObj.getConstant("showSubTotals"),id:this.parent.element.id+"subtotal",iconCss:za+" "+Ot},{text:this.parent.localeObj.getConstant("doNotShowSubTotals"),id:this.parent.element.id+"notsubtotal",iconCss:za+" "+Ot},{text:this.parent.localeObj.getConstant("showSubTotalsRowsOnly"),id:this.parent.element.id+"subtotalrow",iconCss:za+" "+Ot},{text:this.parent.localeObj.getConstant("showSubTotalsColumnsOnly"),id:this.parent.element.id+"subtotalcolumn",iconCss:za+" "+Ot}]}];this.subTotalMenu=new n.Menu({items:i,enableRtl:this.parent.enableRtl,locale:this.parent.locale,cssClass:Ja,select:this.menuItemClick.bind(this),beforeOpen:this.updateSubtotalSelection.bind(this),onClose:function(t){e.focusToolBar()}}),this.subTotalMenu.isStringTemplate=!0,this.subTotalMenu.appendTo("#"+this.parent.element.id+"subtotal_menu")}if(t.select("#"+this.parent.element.id+"grandtotal_menu",this.parent.element)){i=[{iconCss:"e-grand-total "+Ot,items:[{text:this.parent.localeObj.getConstant("showGrandTotals"),id:this.parent.element.id+"grandtotal",iconCss:za+" "+Ot},{text:this.parent.localeObj.getConstant("doNotShowGrandTotals"),id:this.parent.element.id+"notgrandtotal",iconCss:za+" "+Ot},{text:this.parent.localeObj.getConstant("showGrandTotalsRowsOnly"),id:this.parent.element.id+"grandtotalrow",iconCss:za+" "+Ot},{text:this.parent.localeObj.getConstant("showGrandTotalsColumnsOnly"),id:this.parent.element.id+"grandtotalcolumn",iconCss:za+" "+Ot}]}];this.grandTotalMenu=new n.Menu({items:i,enableRtl:this.parent.enableRtl,locale:this.parent.locale,cssClass:Ja,select:this.menuItemClick.bind(this),beforeOpen:this.updateGrandtotalSelection.bind(this),onClose:function(t){e.focusToolBar()}}),this.grandTotalMenu.isStringTemplate=!0,this.grandTotalMenu.appendTo("#"+this.parent.element.id+"grandtotal_menu")}if(t.select("#"+this.parent.element.id+"formatting_menu",this.parent.element)){i=[{iconCss:"e-pivot-format-menu "+Ot,items:[{text:this.parent.localeObj.getConstant("numberFormatMenu"),iconCss:"e-pivot-number-format-menu "+Ot,id:this.parent.element.id+"numberFormattingMenu"},{text:this.parent.localeObj.getConstant("conditionalFormatingMenu"),iconCss:"e-pivot-conditional-format-menu "+Ot,id:this.parent.element.id+"conditionalFormattingMenu"}]}];this.formattingMenu=new n.Menu({items:i,enableRtl:this.parent.enableRtl,locale:this.parent.locale,cssClass:Ja,select:this.menuItemClick.bind(this)}),this.formattingMenu.isStringTemplate=!0,this.formattingMenu.appendTo("#"+this.parent.element.id+"formatting_menu")}if(t.select("#"+this.parent.element.id+"_reportlist",this.parent.element)){var a={report:this.parent.getPersistData(),reportName:this.parent.localeObj.getConstant("defaultReport")};this.currentReport=this.parent.localeObj.getConstant("defaultReport"),this.parent.trigger(L,a);var r=this.fetchReports();this.reportList=new s.DropDownList({dataSource:r.reportName,width:"150px",popupHeight:"200px",placeholder:""===this.currentReport?this.parent.localeObj.getConstant("reportList"):"",enableRtl:this.parent.enableRtl,locale:this.parent.locale,cssClass:"e-reportlist-drop",select:this.reportChange.bind(this),value:this.currentReport}),this.reportList.isStringTemplate=!0,this.reportList.appendTo("#"+this.parent.element.id+"_reportlist")}this.updateItemElements()},e.prototype.updateItemElements=function(){for(var e=0,t=[].slice.call(this.toolbar.element.querySelectorAll(".e-toolbar-item"));e<t.length;e++){var i=t[e];i.querySelector("button")?i.querySelector("button").setAttribute("tabindex","0"):i.querySelector(".e-menu.e-menu-parent")&&(i.querySelector(".e-menu.e-menu-parent").setAttribute("tabindex","-1"),i.querySelector(".e-menu-item.e-menu-caret-icon")&&i.querySelector(".e-menu-item.e-menu-caret-icon").setAttribute("tabindex","0"))}},e.prototype.whitespaceRemove=function(e){e.element.style.padding="0px";var t=e.element.querySelector(".e-separator");t&&(t.style.margin="0px")},e.prototype.multipleAxesCheckbox=function(e){if(this.parent.element.id+"_multipleAxes"===e.element.id){(r=t.createElement("input",{id:this.parent.element.id+"_checkBox"})).style.display="none",this.parent.element.appendChild(r);var i=new h.CheckBox({label:this.parent.localeObj.getConstant("multipleAxes"),cssClass:"e-multipleAxes",checked:this.parent.chartSettings.enableMultipleAxis,enableRtl:this.parent.enableRtl,locale:this.parent.locale});e.element.innerText="",i.appendTo("#"+this.parent.element.id+"_checkBox"),["Pie","Funnel","Pyramid","Doughnut"].indexOf(this.parent.chartSettings.chartSeries.type)>-1&&!e.element.classList.contains(da)?(e.element.classList.add(da),i.disabled=!0):["Pie","Funnel","Pyramid","Doughnut"].indexOf(this.parent.chartSettings.chartSeries.type)<0&&e.element.classList.contains(da)&&(e.element.classList.remove(da),i.disabled=!1);var a=this.parent.element.querySelector(".e-checkbox-wrapper.e-multipleAxes");e.element.appendChild(a)}else if(this.parent.element.id+"_showLegend"===e.element.id){var r;(r=t.createElement("input",{id:this.parent.element.id+"_showLegendCheckBox"})).style.display="none",this.parent.element.appendChild(r);i=new h.CheckBox({label:this.parent.localeObj.getConstant("showLegend"),checked:this.getLableState(this.parent.chartSettings.chartSeries.type),cssClass:"e-showLegend",enableRtl:this.parent.enableRtl,locale:this.parent.locale});e.element.innerText="",i.appendTo("#"+this.parent.element.id+"_showLegendCheckBox");a=this.parent.element.querySelector(".e-checkbox-wrapper.e-showLegend");e.element.appendChild(a)}},e.prototype.getLableState=function(e){var t=JSON.parse(this.parent.getPersistData()).chartSettings;return t&&t.legendSettings&&void 0!==t.legendSettings.visible?this.showLableState=t.legendSettings.visible:this.showLableState=!(["Pie","Funnel","Pyramid","Doughnut"].indexOf(this.parent.chartSettings.chartSeries.type)>-1),this.showLableState},e.prototype.getAllChartItems=function(){return["Line","Column","Area","Bar","StackingColumn","StackingArea","StackingBar","StepLine","StepArea","SplineArea","Scatter","Spline","StackingColumn100","StackingBar100","StackingArea100","Bubble","Pareto","Polar","Radar","Pie","Pyramid","Funnel","Doughnut"]},e.prototype.updateExportMenu=function(e){var i=[].slice.call(e.element.querySelectorAll("li"));"Table"===this.parent.currentView?(t.addClass(i.slice(3),ha),t.removeClass(i.slice(1,3),ha)):(t.addClass(i.slice(1,3),ha),t.removeClass(i.slice(3),ha))},e.prototype.updateSubtotalSelection=function(e){t.select("#"+this.parent.element.id+"subtotal ."+za,e.element).classList.contains(Wa)||t.select("#"+this.parent.element.id+"subtotal ."+za,e.element).classList.add(Wa),t.select("#"+this.parent.element.id+"notsubtotal ."+za,e.element).classList.contains(Wa)||t.select("#"+this.parent.element.id+"notsubtotal ."+za,e.element).classList.add(Wa),t.select("#"+this.parent.element.id+"subtotalrow ."+za,e.element).classList.contains(Wa)||t.select("#"+this.parent.element.id+"subtotalrow ."+za,e.element).classList.add(Wa),t.select("#"+this.parent.element.id+"subtotalcolumn ."+za,e.element).classList.contains(Wa)||t.select("#"+this.parent.element.id+"subtotalcolumn ."+za,e.element).classList.add(Wa),this.parent.dataSourceSettings.showSubTotals&&this.parent.dataSourceSettings.showRowSubTotals&&!this.parent.dataSourceSettings.showColumnSubTotals?t.select("#"+this.parent.element.id+"subtotalrow ."+za,e.element).classList.remove(Wa):this.parent.dataSourceSettings.showSubTotals&&!this.parent.dataSourceSettings.showRowSubTotals&&this.parent.dataSourceSettings.showColumnSubTotals?t.select("#"+this.parent.element.id+"subtotalcolumn ."+za,e.element).classList.remove(Wa):this.parent.dataSourceSettings.showSubTotals&&this.parent.dataSourceSettings.showRowSubTotals&&this.parent.dataSourceSettings.showColumnSubTotals?t.select("#"+this.parent.element.id+"subtotal ."+za,e.element).classList.remove(Wa):this.parent.dataSourceSettings.showSubTotals&&(this.parent.dataSourceSettings.showRowSubTotals||this.parent.dataSourceSettings.showColumnSubTotals)||t.select("#"+this.parent.element.id+"notsubtotal ."+za,e.element).classList.remove(Wa)},e.prototype.updateGrandtotalSelection=function(e){t.select("#"+this.parent.element.id+"grandtotal ."+za,e.element).classList.contains(Wa)||t.select("#"+this.parent.element.id+"grandtotal ."+za,e.element).classList.add(Wa),t.select("#"+this.parent.element.id+"notgrandtotal ."+za,e.element).classList.contains(Wa)||t.select("#"+this.parent.element.id+"notgrandtotal ."+za,e.element).classList.add(Wa),t.select("#"+this.parent.element.id+"grandtotalrow ."+za,e.element).classList.contains(Wa)||t.select("#"+this.parent.element.id+"grandtotalrow ."+za,e.element).classList.add(Wa),t.select("#"+this.parent.element.id+"grandtotalcolumn ."+za,e.element).classList.contains(Wa)||t.select("#"+this.parent.element.id+"grandtotalcolumn ."+za,e.element).classList.add(Wa),this.parent.dataSourceSettings.showGrandTotals&&this.parent.dataSourceSettings.showRowGrandTotals&&!this.parent.dataSourceSettings.showColumnGrandTotals?t.select("#"+this.parent.element.id+"grandtotalrow ."+za,e.element).classList.remove(Wa):this.parent.dataSourceSettings.showGrandTotals&&!this.parent.dataSourceSettings.showRowGrandTotals&&this.parent.dataSourceSettings.showColumnGrandTotals?t.select("#"+this.parent.element.id+"grandtotalcolumn ."+za,e.element).classList.remove(Wa):this.parent.dataSourceSettings.showGrandTotals&&this.parent.dataSourceSettings.showRowGrandTotals&&this.parent.dataSourceSettings.showColumnGrandTotals?t.select("#"+this.parent.element.id+"grandtotal ."+za,e.element).classList.remove(Wa):this.parent.dataSourceSettings.showGrandTotals&&(this.parent.dataSourceSettings.showRowGrandTotals||this.parent.dataSourceSettings.showColumnGrandTotals)||t.select("#"+this.parent.element.id+"notgrandtotal ."+za,e.element).classList.remove(Wa)},e.prototype.updateReportList=function(){var e;e=this.fetchReports(),this.reportList.dataSource=e.reportName,""===this.currentReport&&this.reportList.dataSource.length>0?(this.reportList.value=this.reportList.dataSource[this.reportList.dataSource.length-1],this.reportList.text=this.reportList.dataSource[this.reportList.dataSource.length-1],this.currentReport=this.reportList.dataSource[this.reportList.dataSource.length-1]):(this.reportList.value=this.currentReport,this.reportList.text=this.currentReport),this.reportList.refresh()},e.prototype.menuItemClick=function(e){var t,i=this,a={},r=e.item.id==this.parent.element.id+"grid"?xe:e.item.id==this.parent.element.id+"_Column"?we:e.item.id==this.parent.element.id+"_Bar"?we:e.item.id==this.parent.element.id+"_Line"?we:e.item.id==this.parent.element.id+"_Area"?we:e.item.id==this.parent.element.id+"_Scatter"?we:e.item.id==this.parent.element.id+"_Polar"?we:e.item.id==this.parent.element.id+"_ChartMoreOption"?we:e.item.id==this.parent.element.id+"_multipleAxes"?"Multiple Axis":e.item.id==this.parent.element.id+"_showLegend"?"Show legend":e.item.id==this.parent.element.id+"pdf"?Te:e.item.id==this.parent.element.id+"png"?Me:e.item.id==this.parent.element.id+"excel"?De:e.item.id==this.parent.element.id+"csv"?Oe:e.item.id==this.parent.element.id+"jpeg"?Ne:e.item.id==this.parent.element.id+"svg"?Ee:e.item.id==this.parent.element.id+"notsubtotal"?Pe:e.item.id==this.parent.element.id+"subtotalrow"?Fe:e.item.id==this.parent.element.id+"subtotalcolumn"?Ie:e.item.id==this.parent.element.id+"subtotal"?Le:e.item.id==this.parent.element.id+"notgrandtotal"?Ae:e.item.id==this.parent.element.id+"grandtotalrow"?Re:e.item.id==this.parent.element.id+"grandtotalcolumn"?je:e.item.id==this.parent.element.id+"grandtotal"?ke:e.item.id==this.parent.element.id+"numberFormattingMenu"?qe:e.item.id==this.parent.element.id+"conditionalFormattingMenu"?Ve:"";if(this.parent.actionObj.actionName=r,!this.parent.actionBeginMethod()){(this.getAllChartItems().indexOf(e.item.id.split(this.parent.element.id+"_")[1])>-1||"ChartMoreOption"===e.item.id.split(this.parent.element.id+"_")[1]||"multipleAxes"===e.item.id.split(this.parent.element.id+"_")[1]||"showLegend"===e.item.id.split(this.parent.element.id+"_")[1])&&(t=e.item.id.split(this.parent.element.id+"_")[1]);try{switch(e.item.id){case this.parent.element.id+"grid":if(this.parent.grid&&this.parent.chart){this.parent.grid.element.style.display="",this.parent.chart.element.style.display="none",this.parent.chartSettings.enableMultipleAxis&&this.parent.chartSettings.enableScrollOnMultiAxis&&(this.parent.element.querySelector(".e-pivotchart").style.display="none"),this.parent.currentView="Table",this.parent.setProperties({displayOption:{primary:"Table"}},!0),this.parent.showGroupingBar&&this.parent.groupingBarModule&&(this.parent.element.querySelector(".e-pivot-grouping-bar").style.display="",this.parent.element.querySelector(".e-chart-grouping-bar").style.display="none");var n={toolbarInfo:{displayOption:this.parent.displayOption,gridSettings:this.parent.gridSettings}};this.parent.actionObj.actionInfo=n,this.parent.layoutRefresh()}break;case this.parent.element.id+"pdf":"Table"===this.parent.currentView?(a={pdfExportProperties:{fileName:"Export.pdf"},pdfDoc:void 0,isBlob:!1,isMultipleExport:!1},this.parent.trigger(b,a,function(e){i.parent.pdfExport(e.pdfExportProperties,e.isMultipleExport,e.pdfDoc,e.isBlob)})):(a={width:void 0,height:void 0,orientation:c.PdfPageOrientation.Landscape,type:"PDF",fileName:"result"},this.parent.trigger(b,a,function(e){i.parent.chartExport(e.type,e.fileName,e.orientation,e.width,e.height)}));break;case this.parent.element.id+"excel":a={excelExportProperties:{fileName:"Export.xlsx"},isBlob:void 0,isMultipleExport:void 0,workbook:void 0},this.parent.trigger(b,a,function(e){i.parent.excelExport(e.excelExportProperties,e.isMultipleExport,e.workbook,e.isBlob)});break;case this.parent.element.id+"csv":a={excelExportProperties:{fileName:"Export.csv"},isBlob:!1,isMultipleExport:!1,workbook:void 0},this.parent.trigger(b,a,function(e){i.parent.csvExport(e.excelExportProperties,e.isMultipleExport,e.workbook,e.isBlob)});break;case this.parent.element.id+"png":a={type:"PNG",width:void 0,height:void 0,fileName:"result",orientation:c.PdfPageOrientation.Landscape},this.parent.trigger(b,a,function(e){i.parent.chartExport(e.type,e.fileName,e.orientation,e.width,e.height)});break;case this.parent.element.id+"jpeg":a={type:"JPEG",fileName:"result",orientation:c.PdfPageOrientation.Landscape,width:void 0,height:void 0},this.parent.trigger(b,a,function(e){i.parent.chartExport(e.type,e.fileName,e.orientation,e.width,e.height)});break;case this.parent.element.id+"svg":a={width:void 0,height:void 0,type:"SVG",fileName:"result",orientation:c.PdfPageOrientation.Landscape},this.parent.trigger(b,a,function(e){i.parent.chartExport(e.type,e.fileName,e.orientation,e.width,e.height)});break;case this.parent.element.id+"notsubtotal":this.parent.setProperties({dataSourceSettings:{showSubTotals:!1,showColumnSubTotals:!1,showRowSubTotals:!1}},!0),this.parent.refreshData();break;case this.parent.element.id+"subtotalrow":this.parent.setProperties({dataSourceSettings:{showSubTotals:!0,showColumnSubTotals:!1,showRowSubTotals:!0}},!0),this.parent.refreshData();break;case this.parent.element.id+"subtotalcolumn":this.parent.setProperties({dataSourceSettings:{showSubTotals:!0,showColumnSubTotals:!0,showRowSubTotals:!1}},!0),this.parent.refreshData();break;case this.parent.element.id+"subtotal":this.parent.setProperties({dataSourceSettings:{showSubTotals:!0,showColumnSubTotals:!0,showRowSubTotals:!0}},!0),this.parent.refreshData();break;case this.parent.element.id+"notgrandtotal":this.parent.setProperties({dataSourceSettings:{showGrandTotals:!1,showColumnGrandTotals:!1,showRowGrandTotals:!1}},!0),this.parent.refreshData();break;case this.parent.element.id+"grandtotalrow":this.parent.setProperties({dataSourceSettings:{showGrandTotals:!0,showColumnGrandTotals:!1,showRowGrandTotals:!0}},!0),this.parent.refreshData();break;case this.parent.element.id+"grandtotalcolumn":this.parent.setProperties({dataSourceSettings:{showGrandTotals:!0,showColumnGrandTotals:!0,showRowGrandTotals:!1}},!0),this.parent.refreshData();break;case this.parent.element.id+"grandtotal":this.parent.setProperties({dataSourceSettings:{showGrandTotals:!0,showColumnGrandTotals:!0,showRowGrandTotals:!0}},!0),this.parent.refreshData();break;case this.parent.element.id+"numberFormattingMenu":this.parent.numberFormattingModule&&this.parent.numberFormattingModule.showNumberFormattingDialog();break;case this.parent.element.id+"conditionalFormattingMenu":this.parent.conditionalFormattingModule&&this.parent.conditionalFormattingModule.showConditionalFormattingDialog();break;case this.parent.element.id+"_"+t:e.item&&e.item.text&&("ChartMoreOption"===t?this.createChartTypeDialog():"multipleAxes"===t?(this.parent.chartSettings.enableScrollOnMultiAxis&&(this.isMultiAxisChange=!0),this.parent.chartSettings.enableMultipleAxis=!this.parent.chartSettings.enableMultipleAxis,this.updateChartType(this.parent.chartSettings.chartSeries.type,!0)):this.getAllChartItems().indexOf(t)>-1?this.updateChartType(t,!1):"showLegend"===t&&(this.parent.chart.legendSettings.visible=!this.showLableState,this.parent.chartSettings.legendSettings?this.parent.chartSettings.legendSettings.visible=!this.showLableState:this.parent.setProperties({chartSettings:{legendSettings:{visible:!this.showLableState}}},!0),this.updateChartType(this.parent.chartSettings.chartSeries.type,!0)))}}catch(e){this.parent.actionFailureMethod(e)}}},e.prototype.addEventListener=function(){this.parent.isDestroyed||this.parent.on(he,this.createToolbar,this)},e.prototype.getValidChartType=function(){for(var e=[],t=0;t<=this.parent.chartTypes.length;t++){var i=this.parent.chartTypes[t];this.getAllChartItems().indexOf(i)>-1&&e.indexOf(i)<0&&e.push(i)}return e},e.prototype.createChartTypeDialog=function(){var e=this,i=this.parent.element.appendChild(t.createElement("div",{id:this.parent.element.id+"_ChartTypeDialog",className:"e-pivotchart-type-dialog"}));this.chartTypesDialog=new a.Dialog({animationSettings:{effect:"Fade"},allowDragging:!0,header:this.parent.localeObj.getConstant("chartTypeSettings"),content:this.getDialogContent(),isModal:!0,beforeOpen:this.beforeOpen.bind(this),visible:!0,showCloseIcon:!0,enableRtl:this.parent.enableRtl,locale:this.parent.locale,width:"auto",height:"auto",position:{X:"center",Y:"center"},buttons:[{click:function(){e.chartTypeDialogUpdate()},buttonModel:{cssClass:ai,content:this.parent.localeObj.getConstant("ok"),isPrimary:!0}},{click:function(){e.removeDialog()},buttonModel:{cssClass:ri,content:this.parent.localeObj.getConstant("cancel")}}],closeOnEscape:!0,target:this.parent.element,close:this.removeDialog.bind(this)}),this.chartTypesDialog.isStringTemplate=!0,this.chartTypesDialog.appendTo(i)},e.prototype.removeDialog=function(){this.chartTypesDialog&&!this.chartTypesDialog.isDestroyed&&this.chartTypesDialog.destroy(),document.getElementById(this.parent.element.id+"_ChartTypeDialog")&&t.remove(document.getElementById(this.parent.element.id+"_ChartTypeDialog"))},e.prototype.chartTypeDialogUpdate=function(){var e=t.getInstance(t.select("#"+this.parent.element.id+"_ChartTypeOption"),s.DropDownList).value,i=t.getInstance(t.select("#"+this.parent.element.id+"_DialogMultipleAxis"),h.CheckBox).checked,a=t.getInstance(t.select("#"+this.parent.element.id+"_DialogShowLabel"),h.CheckBox).checked;this.parent.chart.legendSettings.visible=a,this.chartLableState&&(this.parent.chart.legendSettings.visible=a,this.parent.chartSettings.legendSettings?this.parent.chartSettings.legendSettings.visible=a:this.parent.setProperties({chartSettings:{legendSettings:{visible:a}}},!0)),this.updateChartType(e,!1),this.parent.chartSettings.enableMultipleAxis=i,this.parent.chartSettings.multipleAxisMode=t.getInstance(t.select("#"+this.parent.element.id+"_AxisModeOption"),s.DropDownList).value,this.chartTypesDialog.close()},e.prototype.updateChartType=function(e,i){if(this.getAllChartItems().indexOf(e)>-1&&this.parent.chart){this.parent.currentView="Chart",this.parent.setProperties({displayOption:{primary:"Chart"}},!0),this.parent.chartSettings.enableScrollOnMultiAxis&&this.parent.chartSettings.enableMultipleAxis&&(this.parent.element.querySelector("."+qa).style.width=t.formatUnit(this.parent.grid?this.parent.getGridWidthAsNumber():this.parent.getWidthAsNumber())),this.parent.chart.setProperties({width:t.formatUnit(this.parent.grid?this.parent.getGridWidthAsNumber():this.parent.getWidthAsNumber())},!0),this.parent.chartSettings.chartSeries.type!==e||i?this.parent.chartSettings.chartSeries.type=e:this.parent.pivotChartModule.updateView();var a={toolbarInfo:{displayOption:this.parent.displayOption,chartSettings:this.parent.chartSettings}};this.parent.actionObj.actionInfo=a}},e.prototype.getDialogContent=function(){var e=t.createElement("div",{className:"e-chart-type-div-content"}),i=t.createElement("div",{className:"e-chart-type-option-wrapper"}),a=t.createElement("div",{className:"e-multiple-axes-mode-wrapper"}),r=t.createElement("div",{className:"e-chart-type-option-text",innerHTML:this.parent.localeObj.getConstant("ChartType")}),n=t.createElement("div",{className:"e-multiple-axes-mode-text",innerHTML:this.parent.localeObj.getConstant("multipleAxisMode")}),o=t.createElement("div",{id:this.parent.element.id+"_ChartTypeOption"}),l=t.createElement("div",{id:this.parent.element.id+"_AxisModeOption"});i.appendChild(r),i.appendChild(o);for(var d=[],h=[{value:"Stacked",text:this.parent.localeObj.getConstant("stacked")},{value:"Single",text:this.parent.localeObj.getConstant("single")}],p=this.getValidChartType(),u=0;u<p.length;u++)d.push({value:p[u],text:this.parent.localeObj.getConstant(p[u].toLowerCase())});var c=new s.DropDownList({dataSource:d,enableRtl:this.parent.enableRtl,locale:this.parent.locale,fields:{value:"value",text:"text"},value:this.parent.chartSettings.chartSeries.type?this.parent.chartSettings.chartSeries.type:this.getValidChartType()[0],width:"100%",change:this.changeDropDown.bind(this)});c.isStringTemplate=!0,c.appendTo(o),e.appendChild(i);var g=t.createElement("input",{id:this.parent.element.id+"_DialogMultipleAxis",attrs:{type:"checkbox"}});e.appendChild(g);var m=t.createElement("input",{id:this.parent.element.id+"_DialogShowLabel",attrs:{type:"checkbox"}});e.appendChild(m),a.appendChild(n),a.appendChild(l),e.appendChild(a);var f=new s.DropDownList({dataSource:h,enableRtl:this.parent.enableRtl,locale:this.parent.locale,fields:{value:"value",text:"text"},value:this.parent.chartSettings.multipleAxisMode?this.parent.chartSettings.multipleAxisMode:"Stacked",width:"100%",enabled:this.parent.chartSettings.enableMultipleAxis});return f.isStringTemplate=!0,f.appendTo(l),e},e.prototype.changeDropDown=function(e){var i=JSON.parse(this.parent.getPersistData()).chartSettings;if(!i||!i.legendSettings||void 0===i.legendSettings.visible){var a=!(["Pie","Funnel","Pyramid","Doughnut"].indexOf(e.value.toString())>-1);t.getInstance(t.select("#"+this.parent.element.id+"_DialogShowLabel"),h.CheckBox).checked=a}if(["Pie","Funnel","Pyramid","Doughnut"].indexOf(e.value.toString())>-1)t.getInstance(t.select("#"+this.parent.element.id+"_DialogMultipleAxis"),h.CheckBox).disabled=!0,t.getInstance(t.select("#"+this.parent.element.id+"_AxisModeOption"),s.DropDownList).enabled=!1;else{var r=t.getInstance(t.select("#"+this.parent.element.id+"_DialogMultipleAxis"),h.CheckBox);r.disabled=!1,t.getInstance(t.select("#"+this.parent.element.id+"_AxisModeOption"),s.DropDownList).enabled=r.checked}},e.prototype.beforeOpen=function(){var e=this,i=new h.CheckBox({label:this.parent.localeObj.getConstant("multipleAxes"),cssClass:"e-dialog-multiple-axis",checked:!!this.parent.chartSettings.enableMultipleAxis&&this.parent.chartSettings.enableMultipleAxis,change:function(i){t.getInstance(t.select("#"+e.parent.element.id+"_AxisModeOption"),s.DropDownList).enabled=i.checked},enableRtl:this.parent.enableRtl,locale:this.parent.locale});new h.CheckBox({label:this.parent.localeObj.getConstant("showLegend"),checked:this.getLableState(this.parent.chartSettings.chartSeries.type),change:function(){e.chartLableState=!0},cssClass:"e-dialog-show-legend",enableRtl:this.parent.enableRtl,locale:this.parent.locale}).appendTo(t.select("#"+this.parent.element.id+"_DialogShowLabel",this.chartTypesDialog.element)),i.appendTo(t.select("#"+this.parent.element.id+"_DialogMultipleAxis",this.chartTypesDialog.element)),["Pie","Funnel","Pyramid","Doughnut"].indexOf(this.parent.chartSettings.chartSeries.type)>-1&&(i.disabled=!0,t.getInstance(t.select("#"+this.parent.element.id+"_AxisModeOption"),s.DropDownList).enabled=!1);var a=JSON.parse(this.parent.getPersistData()).chartSettings;a&&a.legendSettings&&void 0!==a.legendSettings.visible?this.chartLableState=!0:this.chartLableState=!1},e.prototype.refreshToolbar=function(){this.createToolbar()},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(he,this.createToolbar)},e.prototype.destroy=function(){this.removeEventListener(),this.confirmPopUp&&!this.confirmPopUp.isDestroyed&&this.confirmPopUp.destroy(),this.dialog&&!this.dialog.isDestroyed&&this.dialog.destroy(),this.mdxDialog&&!this.mdxDialog.isDestroyed&&this.mdxDialog.destroy(),this.chartMenu&&!this.chartMenu.isDestroyed&&this.chartMenu.destroy(),this.chartTypesDialog&&!this.chartTypesDialog.isDestroyed&&this.chartTypesDialog.destroy(),this.exportMenu&&!this.exportMenu.isDestroyed&&this.exportMenu.destroy(),this.subTotalMenu&&!this.subTotalMenu.isDestroyed&&this.subTotalMenu.destroy(),this.grandTotalMenu&&!this.grandTotalMenu.isDestroyed&&this.grandTotalMenu.destroy(),this.formattingMenu&&!this.formattingMenu.isDestroyed&&this.formattingMenu.destroy(),this.reportList&&!this.reportList.isDestroyed&&this.reportList.destroy(),this.toolbar&&!this.toolbar.isDestroyed&&this.toolbar.destroy(),t.select("#"+this.parent.element.id+"pivot-toolbar",document)&&t.remove(t.select("#"+this.parent.element.id+"pivot-toolbar",document))},e.prototype.focusToolBar=function(){t.removeClass(document.querySelector("."+ja).querySelectorAll(".e-menu-item.e-focused"),"e-focused"),t.removeClass(document.querySelector("."+ja).querySelectorAll(".e-menu-item.e-selected"),"e-selected"),document.querySelector(".e-toolbar-items")&&t.addClass([document.querySelector(".e-toolbar-items")],"e-focused")},e}(),_n=function(){function e(e){this.parent=e,this.parent.numberFormattingModule=this,this.removeEventListener(),this.addEventListener(),this.newFormat=[],this.lastFormattedValue=[]}return e.prototype.getModuleName=function(){return"numberFormatting"},e.prototype.showNumberFormattingDialog=function(){var e=this,i=t.createElement("div",{id:this.parent.element.id+"_FormatDialog",className:"e-pivot-format-dialog"});this.parent.element.appendChild(i),this.dialog=new a.Dialog({animationSettings:{effect:"Fade"},allowDragging:!0,header:this.parent.localeObj.getConstant("numberFormat"),content:this.getDialogContent(),isModal:!0,visible:!0,showCloseIcon:!0,enableRtl:this.parent.enableRtl,locale:this.parent.locale,width:"auto",height:"auto",position:{X:"center",Y:"center"},buttons:[{click:this.updateFormatting.bind(this),buttonModel:{cssClass:ai,content:this.parent.localeObj.getConstant("apply"),isPrimary:!0}},{click:function(){e.dialog.hide()},buttonModel:{cssClass:ri,content:this.parent.localeObj.getConstant("cancel")}}],closeOnEscape:!0,target:this.parent.element,overlayClick:function(){e.removeDialog()},close:this.removeDialog.bind(this)}),this.dialog.isStringTemplate=!0,this.dialog.appendTo(i),this.dialog.element.querySelector(".e-dlg-header").innerHTML=this.parent.localeObj.getConstant("numberFormat");var r;this.newFormat=[{name:this.parent.localeObj.getConstant("AllValues"),format:"N0",useGrouping:!0,type:void 0}];for(var n=[],o=0;o<this.parent.dataSourceSettings.formatSettings.length;o++)r={name:this.parent.dataSourceSettings.formatSettings[o].name,format:this.parent.dataSourceSettings.formatSettings[o].format,useGrouping:this.parent.dataSourceSettings.formatSettings[o].useGrouping,type:this.parent.dataSourceSettings.formatSettings[o].type},this.newFormat.push(r);for(o=0;o<this.newFormat.length;o++)n.push(this.newFormat[o].name);for(var s=0;s<this.parent.dataSourceSettings.values.length;s++)-1===n.indexOf(this.parent.dataSourceSettings.values[s].name)&&(r={name:this.parent.dataSourceSettings.values[s].name,format:"N0",useGrouping:!0},this.newFormat.push(r));this.renderControls()},e.prototype.getDialogContent=function(){var e=t.createElement("div",{id:this.parent.element.id+"_FormatDialogOuter",className:"e-pivot-format-dialog-outer"}),i=t.createElement("table",{id:this.parent.element.id+"_FormatTable",className:"e-pivot-format-table"}),a=t.createElement("tr"),r=t.createElement("td"),n=t.createElement("div",{id:this.parent.element.id+"_FormatValueLable",className:"e-pivot-format-value-lable",innerHTML:this.parent.localeObj.getConstant("values")}),o=t.createElement("div",{id:this.parent.element.id+"_FormatValueDrop"});r.appendChild(n),r.appendChild(o),a.appendChild(r),i.appendChild(a),a=t.createElement("tr"),r=t.createElement("td");var s=t.createElement("div",{id:this.parent.element.id+"_FormatLable",className:"e-pivot-format-lable",innerHTML:this.parent.localeObj.getConstant("formatType")}),l=t.createElement("div",{id:this.parent.element.id+"_FormatDrop"});r.appendChild(s),r.appendChild(l),a.appendChild(r),i.appendChild(a),a=t.createElement("tr"),r=t.createElement("td");var d=t.createElement("div",{id:this.parent.element.id+"_GroupingLable",className:"e-pivot-format-grouping-lable",innerHTML:this.parent.localeObj.getConstant("grouping")}),h=t.createElement("div",{id:this.parent.element.id+"_GroupingDrop"});r.appendChild(d),r.appendChild(h),a.appendChild(r),i.appendChild(a),a=t.createElement("tr"),r=t.createElement("td");var p=t.createElement("div",{id:this.parent.element.id+"_DecimalLable",className:"e-pivot-format-decimal-lable",innerHTML:this.parent.localeObj.getConstant("decimalPlaces")}),u=t.createElement("div",{id:this.parent.element.id+"_DecimalDrop"});return r.appendChild(p),r.appendChild(u),a.appendChild(r),i.appendChild(a),a=t.createElement("tr"),r=t.createElement("td"),this.customLable=t.createElement("div",{id:this.parent.element.id+"_CustomLable",className:"e-pivot-format-custom-lable",innerHTML:this.parent.localeObj.getConstant("customFormatString")}),this.customText=t.createElement("input",{id:this.parent.element.id+"_CustomText",attrs:{type:"text",tabindex:"0"},className:va+" e-pivot-format-custom-text"}),r.appendChild(this.customLable),r.appendChild(this.customText),a.appendChild(r),i.appendChild(a),a=t.createElement("tr"),i.appendChild(a),e.appendChild(i),e},e.prototype.renderControls=function(){if(t.select("#"+this.parent.element.id+"_FormatValueDrop",this.dialog.element)){var e=[];e.push({index:0,name:this.parent.localeObj.getConstant("AllValues"),field:this.parent.localeObj.getConstant("AllValues")});for(var i=0;i<this.parent.dataSourceSettings.values.length;i++)e.push({index:i+1,name:this.parent.dataSourceSettings.values[i].caption||this.parent.dataSourceSettings.values[i].name,field:this.parent.dataSourceSettings.values[i].name});this.valuesDropDown=new s.DropDownList({dataSource:e,fields:{text:"name",value:"field"},enableRtl:this.parent.enableRtl,locale:this.parent.locale,index:0,cssClass:"e-pivot-format-value-drop",change:this.valueChange.bind(this),width:"100%",open:this.customUpdate.bind(this)}),this.valuesDropDown.isStringTemplate=!0,this.valuesDropDown.appendTo("#"+this.parent.element.id+"_FormatValueDrop")}if(t.select("#"+this.parent.element.id+"_FormatDrop",this.dialog.element)){var a=[{index:0,name:this.parent.localeObj.getConstant("number")},{index:1,name:this.parent.localeObj.getConstant("currency")},{index:2,name:this.parent.localeObj.getConstant("percentage")},{index:3,name:this.parent.localeObj.getConstant("Custom")}];this.formatDropDown=new s.DropDownList({dataSource:a,fields:{text:"name",value:"name"},index:0,change:this.dropDownChange.bind(this),enableRtl:this.parent.enableRtl,locale:this.parent.locale,cssClass:"e-pivot-format-drop",width:"100%"}),this.formatDropDown.isStringTemplate=!0,this.formatDropDown.appendTo("#"+this.parent.element.id+"_FormatDrop")}if(t.select("#"+this.parent.element.id+"_GroupingDrop",this.dialog.element)){a=[{index:0,name:this.parent.localeObj.getConstant("true")},{index:1,name:this.parent.localeObj.getConstant("false")}];this.groupingDropDown=new s.DropDownList({dataSource:a,fields:{text:"name",value:"name"},enableRtl:this.parent.enableRtl,locale:this.parent.locale,index:0,cssClass:"e-pivot-format-grouping-drop",width:"100%",change:this.groupingChange.bind(this)}),this.groupingDropDown.isStringTemplate=!0,this.groupingDropDown.appendTo("#"+this.parent.element.id+"_GroupingDrop")}if(t.select("#"+this.parent.element.id+"_DecimalDrop",this.dialog.element)){a=[{index:0,name:0},{index:1,name:1},{index:2,name:2},{index:3,name:3},{index:4,name:4},{index:5,name:5},{index:6,name:6},{index:7,name:7},{index:8,name:8},{index:9,name:9},{index:10,name:10}];this.decimalDropDown=new s.DropDownList({dataSource:a,fields:{text:"name",value:"name"},enableRtl:this.parent.enableRtl,locale:this.parent.locale,index:0,cssClass:"e-pivot-format-decimal-drop",popupHeight:150,width:"100%",change:this.decimalChange.bind(this)}),this.decimalDropDown.isStringTemplate=!0,this.decimalDropDown.appendTo("#"+this.parent.element.id+"_DecimalDrop")}if(this.formatDropDown.value!==this.parent.localeObj.getConstant("Custom")&&(this.customText.disabled=!0),0!==this.lastFormattedValue.length){this.valuesDropDown.value=this.lastFormattedValue[0].name;var r=this.lastFormattedValue[0].format,n=""===r?"":r.split("")[0].toLowerCase(),o=this.lastFormattedValue[0].useGrouping?this.parent.localeObj.getConstant("true"):this.parent.localeObj.getConstant("false");this.updateFormattingDialog(r,n,o)}},e.prototype.valueChange=function(e){for(var t=this.newFormat,i=!1,a=0;a<t.length;a++)if(t[a].name===e.value){var r=t[a].format,n=""===r?"":r.split("")[0].toLowerCase(),o=t[a].useGrouping?this.parent.localeObj.getConstant("true"):this.parent.localeObj.getConstant("false");this.updateFormattingDialog(r,n,o),i=!0;break}i||(this.formatDropDown.value=this.parent.localeObj.getConstant("number"),this.decimalDropDown.value=0,this.groupingDropDown.value=this.parent.localeObj.getConstant("true"))},e.prototype.updateFormattingDialog=function(e,t,i){2===e.length&&["n","p","c"].indexOf(t)>-1?(this.formatDropDown.value="n"===t?this.parent.localeObj.getConstant("number"):"p"===t?this.parent.localeObj.getConstant("percentage"):"c"===t?this.parent.localeObj.getConstant("currency"):this.parent.localeObj.getConstant("number"),this.decimalDropDown.value=Number(e.split("")[1]),this.groupingDropDown.value=i):(this.formatDropDown.value=this.parent.localeObj.getConstant("Custom"),this.customText.value=e)},e.prototype.customUpdate=function(){if(this.formatDropDown.value===this.parent.localeObj.getConstant("Custom")){var e=this.getIndexValue();this.newFormat[e].format=this.customText.value}},e.prototype.dropDownChange=function(e){var t=this.getIndexValue();if(e.value===this.parent.localeObj.getConstant("Custom"))this.customText.disabled=!1,this.groupingDropDown.enabled=!1,this.decimalDropDown.enabled=!1,this.newFormat[t].format=this.customText.value;else{var i=this.formattedText();this.newFormat[t].format=i,this.customText.disabled=!0,this.groupingDropDown.enabled=!0,this.decimalDropDown.enabled=!0,this.customText.value=""}},e.prototype.groupingChange=function(){var e=this.getIndexValue();this.newFormat[e].useGrouping=this.groupingDropDown.value===this.parent.localeObj.getConstant("true")},e.prototype.getIndexValue=function(){for(var e=[],t=0;t<this.newFormat.length;t++)e.push(this.newFormat[t].name);return e.indexOf(this.valuesDropDown.value.toString())},e.prototype.decimalChange=function(){var e=this.getIndexValue(),t=this.formattedText();this.newFormat[e].format=t},e.prototype.formattedText=function(){var e;return this.formatDropDown.value===this.parent.localeObj.getConstant("number")||this.formatDropDown.value===this.parent.localeObj.getConstant("percentage")||this.formatDropDown.value===this.parent.localeObj.getConstant("currency")?(e=this.formatDropDown.value===this.parent.localeObj.getConstant("number")?"N":this.formatDropDown.value===this.parent.localeObj.getConstant("currency")?"C":"P",e+=this.decimalDropDown.value):e=this.customText.value},e.prototype.removeDialog=function(){this.dialog&&!this.dialog.isDestroyed&&this.dialog.destroy(),document.getElementById(this.parent.element.id+"_FormatDialog")&&t.remove(document.getElementById(this.parent.element.id+"_FormatDialog"))},e.prototype.updateFormatting=function(){var e=this,i=this.formattedText(),a=this.getIndexValue();this.newFormat.splice(a,1);for(var r=t.extend([],this.newFormat,!0),n=this.parent.dataSourceSettings.formatSettings,o=0;o<n.length;o++)this.insertFormat(n[o].name,n[o].format,n[o].type);if(this.valuesDropDown.value===this.parent.localeObj.getConstant("AllValues"))for(o=0;o<this.parent.dataSourceSettings.values.length;o++)this.insertFormat(this.parent.dataSourceSettings.values[o].name,i);else this.insertFormat(this.valuesDropDown.value.toString(),i);var s={formatSettings:g.cloneFormatSettings(this.newFormat),formatName:this.valuesDropDown.value.toString(),cancel:!1};this.parent.trigger(K,s,function(t){if(t.cancel)e.dialog.close(),e.parent.setProperties({dataSourceSettings:{formatSettings:r}},!0);else{e.parent.setProperties({dataSourceSettings:{formatSettings:t.formatSettings}},!0);var i={numberFormattingInfo:e.parent.dataSourceSettings.formatSettings};e.parent.actionObj.actionInfo=i;try{e.parent.updateDataSource(!1),e.dialog.close()}catch(t){e.parent.setProperties({dataSourceSettings:{formatSettings:r}},!0),e.parent.pivotCommon.errorDialog.createErrorDialog(e.parent.localeObj.getConstant("error"),e.parent.localeObj.getConstant("invalidFormat"),e.dialog.element),e.parent.hideWaitingPopup()}}})},e.prototype.insertFormat=function(e,t,i){for(var a=!1,r={name:e,format:t,useGrouping:this.groupingDropDown.value===this.parent.localeObj.getConstant("true"),type:i},n=this.newFormat,o=0;o<n.length;o++)n[o].name===e&&(n[o]=r,a=!0);a||n.push(r),this.lastFormattedValue=[],this.lastFormattedValue.push(r)},e.prototype.addEventListener=function(){this.parent.isDestroyed||this.parent.on(pe,this.showNumberFormattingDialog,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(pe,this.showNumberFormattingDialog)},e.prototype.destroy=function(){this.dialog&&!this.dialog.isDestroyed&&this.dialog.destroy(),this.removeEventListener()},e}(),Un=function(){function e(e){this.dateGroup=/_date_group_years|_date_group_quarters|_date_group_quarterYear|_date_group_months|_date_group_days|_date_group_hours|_date_group_minutes|_date_group_seconds/g,this.parent=e,this.parent.groupingModule=this,this.addEventListener()}return e.prototype.getModuleName=function(){return"grouping"},e.prototype.render=function(e){var t=e.target,i=e.option,a=e.parentElement;this.parentElement=a,this.selectedCellsInfo=[],this.isUpdate=!1;var r=Number(t.getAttribute("aria-colindex")),n=Number(t.getAttribute("index")),o=this.parent.engineModule.pivotValues[n][r],s=o.valueSort.axis.toString();this.selectedCellsInfo=this.getSelectedCells(o.axis,s,o.actualText.toString()),this.selectedCellsInfo.push({axis:o.axis,fieldName:s,name:o.actualText.toString(),cellInfo:o}),-1!==i.replace(a.id,"").indexOf("_custom_group")?this.createGroupSettings(s):this.updateUnGroupSettings(s)},e.prototype.getSelectedOptions=function(e){for(var t=[],i=0,a=e;i<a.length;i++){var r=a[i];-1===g.inArray(r.name,t)&&t.push(r.name)}return t},e.prototype.createGroupSettings=function(e){var t=this.parent.engineModule.fieldList[e],i=this.getGroupSettings(e);if(this.selectedCellsInfo.length>0){var a=void 0,r=!1;if(t.isCustomField)if(i)i&&"Custom"===i.type?1===this.selectedCellsInfo.length?r=!0:(r=!1,a="custom"):i&&"Number"===i.type&&(r=!1,a="number");else{var n=this.getGroupSettings(e.replace(this.dateGroup,"")),o=this.getGroupSettings(e.replace(/_custom_group/g,""));n?(r=!1,a="date",e=e.replace(this.dateGroup,"")):o&&(r=1===this.selectedCellsInfo.length,a="custom")}else i?"Number"===i.type||"Date"===i.type?(r=!1,a="Date"===i.type?"date":"number"):"Custom"===i.type&&(r=1===this.selectedCellsInfo.length,a="custom"):"number"===t.type||-1!==["datetime","date"].indexOf(t.type)||this.isDateType(e)?(r=!1,a=1===this.selectedCellsInfo.length?-1!==["datetime","date"].indexOf(t.type)||this.isDateType(e)?"date":"number":"custom"):"string"===t.type&&(r=1===this.selectedCellsInfo.length,a="custom");r?(this.parent.pivotCommon.errorDialog.createErrorDialog(this.parent.localeObj.getConstant("warning"),this.parent.localeObj.getConstant("invalidSelection")),this.parent.grid.clearSelection()):a&&""!==a&&this.createGroupDialog(e,a)}},e.prototype.updateUnGroupSettings=function(e){var t=this.parent.engineModule.fieldList[e],i=g.cloneGroupSettings(this.parent.dataSourceSettings.groupSettings),a=this.getGroupSettings(e);if(this.selectedCellsInfo.length>0){var r=void 0;if(t.isCustomField)if(a)"Custom"===a.type&&(r="custom");else{var n=this.getGroupSettings(e.replace(this.dateGroup,"")),o=this.getGroupSettings(e.replace(/_custom_group/g,""));n?(r="date",e=e.replace(this.dateGroup,"")):o&&(r="custom")}else a&&("Number"!==a.type&&"Date"!==a.type||(r="Date"===a.type?"date":"number"));if("date"===r||"number"===r)i=this.validateSettings(e,i,r,[]);else if("custom"===r){var s=this.getSelectedOptions(this.selectedCellsInfo);i=this.validateSettings(e,i,r,s)}this.updateDateSource(i,r)}},e.prototype.updateDateSource=function(e,t){this.isUpdate&&(this.parent.setProperties({dataSourceSettings:{groupSettings:e}},!0),this.parent.updateGroupingReport(e,"date"===t?"Date":"custom"===t?"Custom":"Number"),this.parent.notify(ie,{}))},e.prototype.removeGroupSettings=function(e,t,i,a,r){var n=a.indexOf(e);if(-1!==n)for(var o=i[n],s=0,l=o.customGroups.length;s<l;s++)if(o.customGroups[s]){var d=o.customGroups[s];-1!==g.inArray(d.groupName,t)&&(i=this.modifyParentGroupItems(e,i,[d.groupName],d.items,a),o.customGroups.splice(s,1),this.isUpdate=!0,s--,l--)}return i},e.prototype.getGroupSettings=function(e){for(var t=0,i=this.parent.dataSourceSettings.groupSettings;t<i.length;t++){var a=i[t];if(a.name===e)return a}},e.prototype.isDateType=function(e){for(var t=0,i=this.parent.dataSourceSettings.formatSettings;t<i.length;t++){var a=i[t];if(a.name===e&&a.type)return!0}return!1},e.prototype.getSelectedCells=function(e,t,i){for(var a=[],r=0,n=this.parent.element.querySelectorAll("."+Ta+",."+Ma);r<n.length;r++){var o=n[r],s=Number(o.getAttribute("aria-colindex")),l=Number(o.getAttribute("index")),d=this.parent.engineModule.pivotValues[l][s];d&&d.axis===e&&"grand sum"!==d.type&&"sum"!==d.type&&d.valueSort.axis===t&&i!==d.actualText.toString()&&a.push({axis:d.axis,fieldName:d.valueSort.axis.toString(),name:d.actualText.toString(),cellInfo:d})}return a},e.prototype.createGroupDialog=function(e,i){var r=this,n=t.createElement("div",{id:this.parentElement.id+"_GroupDialog",className:"e-group-field-settings",attrs:{"data-field":e,"data-type":i}});this.parentElement.appendChild(n),this.groupDialog=new a.Dialog({animationSettings:{effect:"Fade"},allowDragging:!0,header:this.parent.localeObj.getConstant("grouping"),content:this.createGroupOptions(e,i),isModal:!0,visible:!0,showCloseIcon:!0,enableRtl:this.parent.enableRtl,locale:this.parent.locale,width:300,height:"auto",position:{X:"center",Y:"center"},buttons:[{click:this.updateGroupSettings.bind(this),buttonModel:{cssClass:ai,content:this.parent.localeObj.getConstant("ok"),isPrimary:!0}},{click:function(){r.groupDialog.hide()},buttonModel:{cssClass:ri,content:this.parent.localeObj.getConstant("cancel")}}],overlayClick:function(){r.removeDialog()},closeOnEscape:!0,close:this.removeDialog.bind(this),target:this.parentElement}),this.groupDialog.isStringTemplate=!0,this.groupDialog.appendTo(n)},e.prototype.createGroupOptions=function(e,i){var a=this,r=this,n=t.createElement("div",{className:"e-group-field-div-content",id:this.parentElement.id+"_group_field_div_content",attrs:{"data-fieldName":e,"data-type":i}}),d=t.createElement("div",{className:"e-group-option-wrapper"});n.appendChild(d);var p=this.parent.dataSourceSettings,u=g.getFieldByName(e,p.groupSettings);switch(i){case"custom":var c=void 0,m=p.rows;m=m.concat(p.columns,p.values,p.filters);var f=g.getFieldByName(e.replace(/_custom_group/g,""),m),v=g.getFieldByName(e,m),S=g.getFieldByName(e+"_custom_group",m);if(v){var y=e+"_custom_group";c=S?S.caption:this.parent.engineModule.fieldList[f.name].caption+(y.match(/_custom_group/g).length+1)}var b=t.createElement("div",{className:"e-caption-option-text",innerHTML:this.parent.localeObj.getConstant("groupFieldCaption")}),C=t.createElement("div",{className:"e-group-caption-wrapper"}),x=t.createElement("input",{id:this.parentElement.id+"group_caption_option",className:"e-group-caption-text",attrs:{type:"text"}});C.appendChild(b),C.appendChild(x),d.appendChild(C);var w=t.createElement("div",{className:"e-input-option-text",innerHTML:this.parent.localeObj.getConstant("groupTitle")}),T=t.createElement("div",{className:"e-group-input-wrapper"}),M=t.createElement("input",{id:this.parentElement.id+"group_input_option",className:"e-group-input-text",attrs:{type:"text"}});T.appendChild(w),T.appendChild(M),d.appendChild(T);var D=new o.MaskedTextBox({placeholder:this.parent.localeObj.getConstant("captionName"),enableRtl:this.parent.enableRtl,locale:this.parent.locale,value:c,width:"100%"});D.isStringTemplate=!0,D.appendTo(x);var O=new o.MaskedTextBox({placeholder:this.parent.localeObj.getConstant("groupName"),enableRtl:this.parent.enableRtl,locale:this.parent.locale,width:"100%"});O.isStringTemplate=!0,O.appendTo(M);break;case"date":case"number":var N=t.createElement("div",{className:"e-group-start-option-wrapper"}),E=t.createElement("input",{id:this.parentElement.id+"group_start_option",className:"e-group_start_option",attrs:{type:"checkbox"}}),P=t.createElement("input",{id:this.parentElement.id+"group_start_input",className:"e-group_start_input",attrs:{type:"text"}});N.appendChild(E),N.appendChild(P),d.appendChild(N);var F=t.createElement("div",{className:"e-group-end-option-wrapper"}),I=t.createElement("input",{id:this.parentElement.id+"group_end_option",className:"e-group_end_option",attrs:{type:"checkbox"}}),L=t.createElement("input",{id:this.parentElement.id+"group_end_input",className:"e-group_end_input",attrs:{type:"text"}});F.appendChild(I),F.appendChild(L),d.appendChild(F);var A=t.createElement("div",{className:"e-group-interval-option-wrapper"}),R=t.createElement("div",{className:"e-group-inerval-option-text",innerHTML:this.parent.localeObj.getConstant("groupBy")}),j=t.createElement("input",{id:this.parentElement.id+"group_interval_input",className:"e-group_interval_input",attrs:{type:"text"}});A.appendChild(R),A.appendChild(j),d.appendChild(A);var k=void 0,q=void 0;if("date"===i){var V=[],H=[{value:"Seconds",text:this.parent.localeObj.getConstant("Seconds")},{value:"Minutes",text:this.parent.localeObj.getConstant("Minutes")},{value:"Hours",text:this.parent.localeObj.getConstant("Hours")},{value:"Days",text:this.parent.localeObj.getConstant("Days")},{value:"Months",text:this.parent.localeObj.getConstant("Months")},{value:"QuarterYear",text:this.parent.localeObj.getConstant("QuarterYear")},{value:"Quarters",text:this.parent.localeObj.getConstant("Quarters")},{value:"Years",text:this.parent.localeObj.getConstant("Years")}];u&&"Date"===u.type?(V=u.groupInterval,k=u.startingAt?u.startingAt.toString():void 0,q=u.endingAt?u.endingAt.toString():void 0):V=["Months"];(U=new l.DateTimePicker({placeholder:this.parent.localeObj.getConstant("chooseDate"),enableRtl:this.parent.enableRtl,locale:this.parent.locale,format:"dd/MM/yyyy hh:mm:ss a",enabled:!(void 0===k),width:"100%"})).isStringTemplate=!0,U.appendTo(P);(G=new l.DateTimePicker({placeholder:this.parent.localeObj.getConstant("chooseDate"),enableRtl:this.parent.enableRtl,locale:this.parent.locale,format:"dd/MM/yyyy hh:mm:ss a",enabled:!(void 0===q),width:"100%"})).isStringTemplate=!0,G.appendTo(L),s.MultiSelect.Inject(s.CheckBoxSelection);var B=new s.MultiSelect({dataSource:H,value:V,fields:{text:"text",value:"value"},mode:"CheckBox",showDropDownIcon:!0,enableSelectionOrder:!1,placeholder:this.parent.localeObj.getConstant("selectGroup"),filterBarPlaceholder:this.parent.localeObj.getConstant("example")+" "+this.parent.localeObj.getConstant("Months"),enableRtl:this.parent.enableRtl,locale:this.parent.locale,select:function(){r.groupDialog.element.querySelector("."+ai).removeAttribute("disabled")},removed:function(){0===B.checkBoxSelectionModule.activeLi.length&&r.groupDialog.element.querySelector("."+ai).setAttribute("disabled","disabled")}});B.isStringTemplate=!0,B.appendTo(j),U.value=void 0===k?null:new Date(k),U.dataBind(),G.value=void 0===q?null:new Date(q),G.dataBind()}else{var _=void 0;u&&"Number"===u.type?(_=u.rangeInterval,k=u.startingAt?u.startingAt.toString():void 0,q=u.endingAt?u.endingAt.toString():void 0):_=2;var U;(U=new o.NumericTextBox({placeholder:this.parent.localeObj.getConstant("enterValue"),enableRtl:this.parent.enableRtl,locale:this.parent.locale,showClearButton:!0,format:"###",value:void 0===k?void 0:parseInt(k,10),enabled:!(void 0===k),width:"100%"})).isStringTemplate=!0,U.appendTo(P);var G;(G=new o.NumericTextBox({placeholder:this.parent.localeObj.getConstant("enterValue"),enableRtl:this.parent.enableRtl,locale:this.parent.locale,showClearButton:!0,format:"###",value:void 0===q?void 0:parseInt(q,10),enabled:!(void 0===q),width:"100%"})).isStringTemplate=!0,G.appendTo(L);var W=new o.NumericTextBox({placeholder:this.parent.localeObj.getConstant("enterValue"),enableRtl:this.parent.enableRtl,locale:this.parent.locale,showClearButton:!0,format:"###",min:1,value:_,width:"100%"});W.isStringTemplate=!0,W.appendTo(j)}var z=new h.CheckBox({label:this.parent.localeObj.getConstant("startAt"),checked:!(void 0===k),enableRtl:this.parent.enableRtl,locale:this.parent.locale,change:function(e){var r="date"===i?t.getInstance(t.select("#"+a.parentElement.id+"group_start_input"),l.DateTimePicker):t.getInstance(t.select("#"+a.parentElement.id+"group_start_input"),o.NumericTextBox);r.enabled=e.checked,r.dataBind()}});z.isStringTemplate=!0,z.appendTo(E);var Q=new h.CheckBox({label:this.parent.localeObj.getConstant("endAt"),checked:!(void 0===q),enableRtl:this.parent.enableRtl,locale:this.parent.locale,change:function(e){var r="date"===i?t.getInstance(t.select("#"+a.parentElement.id+"group_end_input"),l.DateTimePicker):t.getInstance(t.select("#"+a.parentElement.id+"group_end_input"),o.NumericTextBox);r.enabled=e.checked,r.dataBind()}});Q.isStringTemplate=!0,Q.appendTo(I)}return n},e.prototype.updateGroupSettings=function(){var e=this.groupDialog.element,i=e.getAttribute("data-type"),a=e.getAttribute("data-field"),r=g.cloneGroupSettings(this.parent.dataSourceSettings.groupSettings);if(0===r.length&&!this.parent.clonedDataSet&&!this.parent.clonedReport){var n=this.parent.engineModule.data;this.parent.clonedDataSet=g.getClonedData(n),this.parent.setProperties({dataSourceSettings:{dataSource:[]}},!0),this.parent.clonedReport=t.extend({},this.parent.dataSourceSettings,null,!0),this.parent.setProperties({dataSourceSettings:{dataSource:n}},!0)}if("custom"===i){var d=t.getInstance(t.select("#"+this.parentElement.id+"group_input_option"),o.MaskedTextBox),p=t.getInstance(t.select("#"+this.parentElement.id+"group_caption_option"),o.MaskedTextBox);if(t.removeClass([d.element],ga),null===d.value||""===d.value)return t.addClass([d.element],ga),void d.element.focus();for(var u=this.getSelectedOptions(this.selectedCellsInfo),c={groupName:d.value,items:u},m=[],f=[],v={name:a,caption:p.value,type:"Custom",customGroups:[]},S=!1,y=0,b=r.length;y<b;y++)if(r[y].name===a){(v=r[y]).caption=p.value;for(var C=0,x=v.customGroups.length;C<x;C++)if(v.customGroups[C]){var w=v.customGroups[C];w.items&&xn.isContainCommonElements(w.items,u)&&(m=this.mergeArray(m,[w.groupName]),f=this.mergeArray(f,w.items),v.customGroups.splice(C,1),C--,x--)}for(var T=0,M=u;T<M.length;T++){var D=M[T],O=f.indexOf(D);-1!==O&&f.splice(O,1)}f=this.mergeArray(f,[c.groupName]),v.customGroups.push(c),this.isUpdate=!0,S=!0;break}S||(v.customGroups.push(c),this.isUpdate=!0,r.push(v)),r=this.validateSettings(a,r,i,0===m.length?c.items:m,f)}else if("date"===i||"number"===i){var N=t.getInstance(t.select("#"+this.parentElement.id+"group_start_option"),h.CheckBox),E=t.getInstance(t.select("#"+this.parentElement.id+"group_end_option"),h.CheckBox),P="date"===i?t.getInstance(t.select("#"+this.parentElement.id+"group_start_input"),l.DateTimePicker):t.getInstance(t.select("#"+this.parentElement.id+"group_start_input"),o.NumericTextBox),F="date"===i?t.getInstance(t.select("#"+this.parentElement.id+"group_end_input"),l.DateTimePicker):t.getInstance(t.select("#"+this.parentElement.id+"group_end_input"),o.NumericTextBox),I="date"===i?t.getInstance(t.select("#"+this.parentElement.id+"group_interval_input"),s.MultiSelect):t.getInstance(t.select("#"+this.parentElement.id+"group_interval_input"),o.NumericTextBox);v={name:a,startingAt:N.checked?P.value.toString():void 0,endingAt:E.checked?F.value.toString():void 0};if("date"===i){for(var L=[],A=0,R=I.value;A<R.length;A++){var j=R[A];L.push(j)}v.type="Date",v.groupInterval=L}else v.type="Number",v.rangeInterval=I.value;for(S=!1,y=0,b=r.length;y<b;y++)if(r[y].name===a){r.splice(y,1,v),this.isUpdate=!0,S=!0;break}S||(this.isUpdate=!0,r.push(v)),r=this.validateSettings(a,r,i,[],[])}this.groupDialog.close(),this.updateDateSource(r,i)},e.prototype.getGroupBasedSettings=function(e){for(var t={},i=0,a=e;i<a.length;i++){var r=a[i];t[r.type]?t[r.type].push(r):t[r.type]=[r]}return t},e.prototype.getGroupByName=function(e){for(var t={},i=0,a=e;i<a.length;i++){var r=a[i],n=r.name.replace(/_custom_group/g,"");t[n]?t[n].push(r):t[n]=[r]}return t},e.prototype.validateSettings=function(e,t,i,a,r){var n=[],o=this.getGroupBasedSettings(t),s=["Date","Number","Custom"];if(o[s[2]]&&"custom"===i){var l=this.getGroupByName(o[s[2]]);if(l[e.replace(/_custom_group/g,"")]){var d=l[e.replace(/_custom_group/g,"")],h=d.map(function(e,t){return e.name});d=r?this.modifyParentGroupItems(e,d,a,r,h):this.removeGroupSettings(e.replace("_custom_group",""),a,d,h)}for(var p=[],u=0,c=Object.keys(l);u<c.length;u++){var g=c[u];h=l[g].map(function(e,t){return e.name});p=this.reOrderSettings(l[g],h,p,g)}o[s[2]]=p}else if(("date"===i||"number"===i)&&!r){var m="date"===i?o[s[0]]:o[s[1]];"date"===i?o[s[0]]=m.filter(function(t){return t.name!==e}):o[s[1]]=m.filter(function(t){return t.name!==e}),this.isUpdate=!0}for(var f=0,v=s;f<v.length;f++){var S=v[f];o[S]&&(n=n.concat(o[S]))}return n},e.prototype.reOrderSettings=function(e,t,i,a){var r=t.indexOf(a);return r>-1&&e[r].customGroups&&e[r].customGroups.length>0&&(i.push(e[r]),this.reOrderSettings(e,t,i,a+"_custom_group")),i},e.prototype.modifyParentGroupItems=function(e,t,i,a,r){var n=r.indexOf(e+"_custom_group");if(-1!==n){var o=t[n];if(o.customGroups&&o.customGroups.length>0)for(var s=0,l=o.customGroups.length;s<l;s++)if(o.customGroups[s]){var d=!1,h=o.customGroups[s];if(h.items){for(var p=0,u=i;p<u.length;p++){var c=u[p],g=h.items.indexOf(c);-1!==g&&(h.items.splice(g,1),this.isUpdate=!0,d=!0)}d&&(h.items=this.mergeArray(h.items,a))}}}return t},e.prototype.mergeArray=function(e,t){for(var i=[],a=e.concat(t),r=a.length,n={};r--;){var o=String(a[r]);n[o]||(i.unshift(o),n[o]=!0)}return i},e.prototype.removeDialog=function(){this.parent.grid&&this.parent.grid.isDestroyed||(this.parent.grid.clearSelection(),this.groupDialog&&!this.groupDialog.isDestroyed&&this.groupDialog.destroy(),this.parentElement&&document.getElementById(this.parentElement.id+"_GroupDialog")&&t.remove(document.getElementById(this.parentElement.id+"_GroupDialog")))},e.prototype.addEventListener=function(){this.handlers={load:this.render},this.parent.isDestroyed||this.parent.on(ue,this.handlers.load,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.removeDialog(),this.parent.off(ue,this.handlers.load))},e.prototype.destroy=function(){this.removeEventListener()},e}();e.GroupingBarSettings=fn,e.CellEditSettings=vn,e.ConditionalSettings=Sn,e.HyperlinkSettings=yn,e.DisplayOption=bn,e.PivotView=Cn,e.Render=$a,e.ExcelExport=wn,e.PDFExport=Tn,e.KeyboardInteraction=Tr,e.VirtualScroll=Dr,e.DrillThrough=Nr,e.PivotChart=Er,e.PivotFieldList=Ln,e.TreeViewRenderer=Dn,e.AxisFieldRenderer=En,e.AxisTableRenderer=On,e.DialogRenderer=Mn,e.EventBase=tr,e.NodeStateModified=ir,e.DataSourceUpdate=ar,e.FieldList=kn,e.CommonKeyboardInteraction=er,e.Common=sr,e.GroupingBar=Vn,e.CalculatedField=jn,e.ConditionalFormatting=Hn,e.PivotCommon=or,e.load="load",e.enginePopulating=v,e.enginePopulated=S,e.onFieldDropped="onFieldDropped",e.fieldDrop=y,e.beforePivotTableRender="beforePivotTableRender",e.afterPivotTableRender="afterPivotTableRender",e.beforeExport=b,e.excelHeaderQueryCellInfo=C,e.pdfHeaderQueryCellInfo=x,e.excelQueryCellInfo=w,e.pdfQueryCellInfo=T,e.onPdfCellRender=M,e.dataBound=D,e.queryCellInfo="queryCellInfo",e.headerCellInfo="headerCellInfo",e.hyperlinkCellClick=O,e.resizing="resizing",e.resizeStop="resizeStop",e.cellClick="cellClick",e.drillThrough="drillThrough",e.beforeColumnsRender=N,e.selected="selected",e.cellSelecting=E,e.drill="drill",e.cellSelected="cellSelected",e.cellDeselected="cellDeselected",e.rowSelected="rowSelected",e.rowDeselected="rowDeselected",e.beginDrillThrough=P,e.editCompleted=F,e.multiLevelLabelClick=I,e.saveReport=L,e.fetchReport=A,e.loadReport=R,e.renameReport=j,e.removeReport="removeReport",e.newReport="newReport",e.toolbarRender="toolbarRender",e.toolbarClick="toolbarClick",e.chartTooltipRender=k,e.chartLoaded="chartLoaded",e.chartLoad="chartLoad",e.chartResized="chartResized",e.chartAxisLabelRender=q,e.chartSeriesCreated=V,e.aggregateCellInfo=H,e.contextMenuClick=B,e.contextMenuOpen="contextMenuOpen",e.fieldListRefreshed=_,e.conditionalFormatting=U,e.beforePdfExport="beforePdfExport",e.beforeExcelExport=G,e.memberFiltering=W,e.calculatedFieldCreate=z,e.memberEditorOpen=Q,e.fieldRemove=Y,e.numberFormatting=K,e.aggregateMenuOpen=X,e.fieldDragStart=J,e.chartPointClick="chartPointClick",e.beforeServiceInvoke=Z,e.actionBegin=$,e.actionComplete=ee,e.actionFailure=te,e.initialLoad=ie,e.uiUpdate=ae,e.scroll="scroll",e.contentReady=re,e.dataReady=ne,e.initSubComponent=oe,e.treeViewUpdate=se,e.pivotButtonUpdate=le,e.initCalculatedField=de,e.click="click",e.initToolbar=he,e.initFormatting=pe,e.initGrouping=ue,e.sortValue=ce,e.drillUp="Drill up",e.drillDown="Drill down",e.addNewReport=ge,e.saveCurrentReport=me,e.saveAsCurrentReport=fe,e.renameCurrentReport=ve,e.removeCurrentReport=Se,e.loadReports="Load report",e.openConditionalFormatting=ye,e.openNumberFormatting=be,e.MdxQuery="MdxQuery",e.showFieldList=Ce,e.tableView=xe,e.chartView=we,e.multipleAxis="Multiple Axis",e.showLegend="Show legend",e.pdfExport=Te,e.pngExport=Me,e.excelExport=De,e.csvExport=Oe,e.jpegExport=Ne,e.svgExport=Ee,e.hideSubTotals=Pe,e.subTotalsRow=Fe,e.subTotalsColumn=Ie,e.showSubTotals=Le,e.hideGrandTotals=Ae,e.grandTotalsRow=Re,e.grandTotalsColumn=je,e.showGrandTotals=ke,e.numberFormattingMenu=qe,e.conditionalFormattingMenu=Ve,e.reportChange=He,e.sortFieldTree=Be,e.editCalculatedField=_e,e.sortField=Ue,e.filterField=Ge,e.removeField=We,e.openCalculatedField=ze,e.editRecord=Qe,e.saveEditedRecords=Ye,e.addNewRecord=Ke,e.removeRecord=Xe,e.aggregateField=Je,e.contextMenuCalculatedField="CalculatedField Context menu",e.windowResize=Ze,e.calculatedFieldApplied=$e,e.editedRecordsSaved=et,e.newRecordAdded=tt,e.recordRemoved="Record removed",e.closeFieldlist=it,e.fieldTreeSorted=at,e.reportSaved=rt,e.newReportAdded=nt,e.reportReSaved="Report re-saved",e.reportRenamed="Reportrenamed",e.reportRemoved="Report removed",e.excelExported="Excel exported",e.csvExported="CSV exported",e.pdfExported="PDF exported",e.pngExported="PNG exported",e.jpegExported="JPEG exported",e.svgExported="SVG exported",e.conditionallyFormatted=ot,e.numberFormatted=st,e.tableViewed=lt,e.chartViewed=dt,e.subTotalsHidden=ht,e.subTotalsRowShown=pt,e.subTotalsColumnShown=ut,e.subTotalsShown=ct,e.grandTotalsHidden=gt,e.grandTotalsRowShown=mt,e.grandTotalsColumnShown=ft,e.grandTotalsShown=vt,e.valueSorted="Value sorted",e.calculatedFieldEdited=St,e.fieldSorted=yt,e.fieldFiltered=bt,e.fieldRemoved=Ct,e.fieldAggregated=xt,e.recordEdited="Record edited",e.reportChanged="Report changed",e.windowResized="Window resized",e.recordUpdated="Records updated",e.drillThroughClosed=wt,e.ErrorDialog=rr,e.FilterDialog=nr,e.PivotContextMenu=Mr,e.AggregateMenu=Za,e.Toolbar=Bn,e.NumberFormatting=_n,e.Grouping=Un,e.PivotEngine=f,e.PivotUtil=g,e.OlapEngine=cn,e.MDXQuery=un,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ej2-pivotview.umd.min.js.map
