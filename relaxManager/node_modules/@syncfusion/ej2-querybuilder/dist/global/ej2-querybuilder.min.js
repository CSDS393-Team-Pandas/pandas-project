/*!
*  filename: ej2-querybuilder.min.js
*  version : 19.4.48
*  Copyright Syncfusion Inc. 2001 - 2020. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
this.ej=this.ej||{},this.ej.querybuilder=function(e,t,l,i,r,o,n,s,a){"use strict";var u=function(){var e=function(t,l){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var l in t)t.hasOwnProperty(l)&&(e[l]=t[l])})(t,l)};return function(t,l){function i(){this.constructor=t}e(t,l),t.prototype=null===l?Object.create(l):(i.prototype=l.prototype,new i)}}(),d=function(){return(d=Object.assign||function(e){for(var t,l=1,i=arguments.length;l<i;l++){t=arguments[l];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)},p=function(e,t,l,i){var r,o=arguments.length,n=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,l):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,l,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(o<3?r(n):o>3?r(t,l,n):r(t,l))||n);return o>3&&n&&Object.defineProperty(t,l,n),n},h=function(e){function l(){return null!==e&&e.apply(this,arguments)||this}return u(l,e),p([t.Property(null)],l.prototype,"field",void 0),p([t.Property(null)],l.prototype,"label",void 0),p([t.Property(null)],l.prototype,"type",void 0),p([t.Property(null)],l.prototype,"values",void 0),p([t.Property(null)],l.prototype,"operators",void 0),p([t.Property()],l.prototype,"ruleTemplate",void 0),p([t.Property(null)],l.prototype,"template",void 0),p([t.Property({isRequired:!0,min:0,max:Number.MAX_VALUE})],l.prototype,"validation",void 0),p([t.Property(null)],l.prototype,"format",void 0),p([t.Property(null)],l.prototype,"step",void 0),p([t.Property(null)],l.prototype,"value",void 0),p([t.Property(null)],l.prototype,"category",void 0),p([t.Property(null)],l.prototype,"columns",void 0),l}(t.ChildProperty),c=function(e){function l(){return null!==e&&e.apply(this,arguments)||this}return u(l,e),p([t.Property(null)],l.prototype,"condition",void 0),p([t.Collection([],l)],l.prototype,"rules",void 0),p([t.Property(null)],l.prototype,"field",void 0),p([t.Property(null)],l.prototype,"label",void 0),p([t.Property(null)],l.prototype,"type",void 0),p([t.Property(null)],l.prototype,"operator",void 0),p([t.Property(null)],l.prototype,"value",void 0),p([t.Property(!1)],l.prototype,"not",void 0),l}(t.ChildProperty),m=function(e){function l(){return null!==e&&e.apply(this,arguments)||this}return u(l,e),p([t.Property(null)],l.prototype,"numericTextBoxModel",void 0),p([t.Property(null)],l.prototype,"multiSelectModel",void 0),p([t.Property(null)],l.prototype,"datePickerModel",void 0),p([t.Property(null)],l.prototype,"textBoxModel",void 0),p([t.Property(null)],l.prototype,"radioButtonModel",void 0),l}(t.ChildProperty),f=function(e){function l(){return null!==e&&e.apply(this,arguments)||this}return u(l,e),p([t.Property(!0)],l.prototype,"ruleDelete",void 0),p([t.Property(!0)],l.prototype,"groupInsert",void 0),p([t.Property(!0)],l.prototype,"groupDelete",void 0),l}(t.ChildProperty),g=function(e){function h(t,l){var r=e.call(this,t,l)||this;return r.isReadonly=!0,r.fields={text:"label",value:"field"},r.updatedRule={not:!1,condition:"and"},r.isLocale=!1,r.isRefreshed=!1,r.isNotified=!1,r.isAddSuccess=!1,r.isNotValueChange=!1,r.isFieldChange=!1,r.isFieldClose=!1,r.isDestroy=!1,i.MultiSelect.Inject(i.CheckBoxSelection),r}return u(h,e),h.prototype.getPersistData=function(){return this.addOnPersist(["rule"])},h.prototype.reset=function(){this.isImportRules=!1;for(var e=this.element.querySelector(".e-group-body"),l=this.element.querySelectorAll("input.e-control"),i=0,r=l.length;i<r;i++)l[i].parentElement.className.indexOf("e-tooltip")>-1&&t.getComponent(l[i].parentElement,"tooltip").destroy();if(e)e.innerHTML="";else{var o=this.createElement("div",{attrs:{class:"e-group-container"}}),n=this.createElement("div",{attrs:{class:"e-group-header"}}),s=this.createElement("div",{attrs:{class:"e-group-body"}});o.appendChild(n).appendChild(s),this.element.appendChild(o),e=this.element.querySelector(".e-group-body")}this.headerTemplate&&this.isRoot&&(this.element.innerHTML="",this.isRoot=!1),this.enableNotCondition&&t.removeClass(this.element.querySelectorAll(".e-qb-toggle"),"e-active-toggle"),e.appendChild(this.createElement("div",{attrs:{class:"e-rule-list"}})),this.levelColl[this.element.id+"_group0"]=[0],this.rule={condition:"and",not:!1,rules:[]},this.disableRuleCondition(e.parentElement)},h.prototype.getWrapper=function(){return this.element},h.prototype.getModuleName=function(){return"query-builder"},h.prototype.GetRootColumnName=function(e){return this.separator?e.split(this.separator)[0]:e},h.prototype.initialize=function(){if(this.dataColl.length){var e=Object.keys(this.dataColl[0]),t=[],l=[],i=void 0,r=!1,o=!1,n=void 0,s={isRequired:!0,min:0,max:Number.MAX_VALUE};if(this.columns.length){this.columnSort();for(var a=0,u=(d=this.columns).length;a<u;a++)this.updateCustomOperator(d[a]),d[a].type||(e.indexOf(d[a].field)>-1&&("string"===(i=typeof(n=this.dataColl[0][d[a].field]))?o=!isNaN(Date.parse(n)):"object"===i&&(o=n instanceof Date&&!isNaN(n.getTime()),i="string"),d[a].type=i,o=!1),i="string"),d[a].validation||(d[a].validation=s),d[a].category?r=!0:d[a].category=this.l10n.getConstant("OtherFields"),l.indexOf(d[a].category)<0&&l.push(d[a].category),d[a].operators&&!this.isLocale||(d[a].operators=this.customOperators[d[a].type+"Operator"]);r&&(l.length>1||l[0]!==this.l10n.getConstant("OtherFields"))&&(this.fields={text:"label",value:"field",groupBy:"category"}),this.updateSubFieldsFromColumns(this.columns)}else{for(var a=0,u=e.length;a<u;a++)"string"===(i=typeof(n=this.dataColl[0][e[a]]))?o=!isNaN(Date.parse(n)):"object"!==i||Object.keys(n).length||(o=n instanceof Date&&!isNaN(n.getTime()),i="string"),t[a]={field:e[a],label:e[a],type:o?"date":i,validation:s},o=!1,t[a].operators=this.customOperators[t[a].type+"Operator"],"object"===i&&this.updateSubFields(n,t[a]);this.columns=t}}else if(this.columns.length){for(var d=this.columns,a=0,u=d.length;a<u;a++)d[a].category?this.fields={text:"label",value:"field",groupBy:"category"}:d[a].category=this.l10n.getConstant("OtherFields"),this.updateCustomOperator(d[a]),d[a].operators&&!this.isLocale||(d[a].operators=this.customOperators[d[a].type+"Operator"]);this.updateSubFieldsFromColumns(this.columns)}this.trigger("dataBound",{type:"dataBound"})},h.prototype.updateSubFieldsFromColumns=function(e,t){for(var l=0;l<e.length;l++)""!=this.separator&&e[l].field.indexOf(this.separator)<0&&(e[l].field=t?t+this.separator+e[l].field:e[l].field),e[l].operators?this.updateCustomOperator(e[l]):e[l].type&&"object"!==e[l].type&&(e[l].operators=this.customOperators[e[l].type+"Operator"]),e[l].columns&&(e[l].type="object",this.updateSubFieldsFromColumns(e[l].columns,e[l].field))},h.prototype.updateSubFields=function(e,t,l){var i;t.columns=[];var r,o,n=Object.keys(e);l=l||this.dataColl[0];for(var s=0,a=n.length;s<a;s++){var u=t.field.split(".");o=l?l[u[u.length-1]][n[s]]:this.dataColl[0][t.field][n[s]];var d=l[t.field.split(this.separator)[t.field.split(this.separator).length-1]];r=typeof o,i={field:t.field+this.separator+n[s],label:n[s],type:r="object"!==r||isNaN(Date.parse(o))?r:"date"},"object"!==r&&(i.operators=this.customOperators[r+"Operator"]),t.columns.push(i),"object"===r&&this.updateSubFields(o,i,d)}},h.prototype.updateCustomOperator=function(e){if(e.operators)for(var t=this,l=0;l<e.operators.length;l++)!function(l){var i=Object.keys(e.operators[l]).indexOf("sqlOperator");if(i>-1){var r=e.operators[l],o=Object.keys(r),n=o.map(function(e){return r[e]}).join(",").split(","),s=o.indexOf("value");t.operators[n[s]]=n[i]}}(l)},h.prototype.focusEventHandler=function(e){this.target=e.target},h.prototype.clickEventHandler=function(e){var l,i=this,r=e.target;this.isImportRules=!1;var o;if("SPAN"===r.tagName&&(r=r.parentElement),r.className.indexOf("e-collapse-rule")>-1){var n=new t.Animation({duration:1e3,delay:0});this.element.querySelectorAll(".e-summary-content").length<1&&this.renderSummary();var s=document.getElementById(this.element.id+"_summary_content"),a=s.querySelector(".e-summary-text");n.animate(".e-query-builder",{name:"SlideLeftIn"}),(d=this.element.querySelector(".e-group-container")).style.display="none",a.textContent=this.getSqlFromRules(this.rule),s.style.display="block",a.style.height=a.scrollHeight+"px"}if("BUTTON"===r.tagName&&r.className.indexOf("e-qb-toggle")<0){if(r.className.indexOf("e-removerule")>-1)this.actionButton=r,this.deleteRule(r);else if(r.className.indexOf("e-deletegroup")>-1)this.actionButton=r,this.deleteGroup(t.closest(r,".e-group-container"));else if(r.className.indexOf("e-edit-rule")>-1)if((n=new t.Animation({duration:1e3,delay:0})).animate(".e-query-builder",{name:"SlideLeftIn"}),document.getElementById(this.element.id+"_summary_content").style.display="none",this.element.querySelectorAll(".e-group-container").length<1){this.addGroupElement(!1,this.element,this.rule.condition,!1,this.rule.not);var u=t.extend({},this.rule,{},!0);this.setGroupRules(u),this.renderSummaryCollapse()}else{var d=this.element.querySelector(".e-group-container");d.querySelectorAll(".e-collapse-rule").length<1&&this.renderSummaryCollapse(),d.style.display="block"}}else if("LABEL"===r.tagName&&r.parentElement.className.indexOf("e-btn-group")>-1||r.className.indexOf("e-qb-toggle")>-1){var p=t.closest(r,".e-group-container");if(!this.headerTemplate){var h=r.getAttribute("for"),c=void 0;h&&(c=document.getElementById(h).getAttribute("value")),o=p.id.replace(this.element.id+"_","");var m=this.getGroup(o),f=void 0;if(this.enableNotCondition)if(r.className.indexOf("e-qb-toggle")>-1){var g=p.getElementsByClassName("e-qb-toggle")[0];g.className.indexOf("e-active-toggle")>-1?(t.removeClass([g],"e-active-toggle"),f=!1):(t.addClass([g],"e-active-toggle"),f=!0),c=m.condition}else f=m.not;l={groupID:o,cancel:!1,type:"condition",value:c.toLowerCase()},this.enableNotCondition&&(l={groupID:o,cancel:!1,type:"condition",value:c.toLowerCase(),not:f})}this.isImportRules?this.beforeSuccessCallBack(l,r):this.trigger("beforeChange",l,function(e){i.beforeSuccessCallBack(e,r)}),this.target=r}},h.prototype.beforeSuccessCallBack=function(e,l){if(!e.cancel){var i=t.closest(l,".e-group-container"),r=i.id.replace(this.element.id+"_",""),o=this.getValidRules(this.rule),n=this.getParentGroup(i);n.condition=e.value,this.enableNotCondition&&(n.not=e.not),this.isImportRules||this.trigger("change",{groupID:r,type:"condition",value:n.condition}),this.filterRules(o,this.getValidRules(this.rule),"condition")}},h.prototype.selectBtn=function(e,l){"beforeOpen"===l.name?this.showButtons.groupInsert?(this.element.querySelectorAll(".e-group-container").length>=this.maxGroupCount+1?t.addClass([l.element.querySelector("li span.e-addgroup").parentElement],"e-button-hide"):t.removeClass([l.element.querySelector("li span.e-addgroup").parentElement],"e-button-hide"),this.enableRtl&&t.addClass([l.element.querySelector("li").parentElement],"e-rtl")):t.addClass([l.element.querySelector("li span.e-addgroup").parentElement],"e-button-hide"):l.element.children[0].className.indexOf("e-addrule")>-1?this.addRuleElement(t.closest(e,".e-group-container"),{}):l.element.children[0].className.indexOf("e-addgroup")>-1&&this.addGroupElement(!0,t.closest(e,".e-group-container"),"",!0)},h.prototype.appendRuleElem=function(e,l,i,r,o,n){var s,a,u,d=e.querySelector(".e-rule-list");if("change"===i?s=t.select("#"+r,e):((s=this.createElement("div",{attrs:{class:"e-rule-container"}})).setAttribute("id",e.id+"_rule"+this.ruleIdCounter),d.appendChild(s),this.ruleIdCounter++),l&&l.ruleTemplate){u={requestType:"template-initialize",ruleID:s.id,action:o,fields:this.fields,rule:n},this.trigger("actionBegin",u),this.ruleTemplateFn=this.templateParser(l.ruleTemplate);var p=this.element.id+l.field,h=void 0;if(u.fields=this.fields,u.columns=this.columns,u.operators=this.getOperators(n.field),u.operatorFields={text:"key",value:"value"},this.isReact)h=this.ruleTemplateFn(u,this,s.id,p)[0];else if(this.isAngular){var c=this.ruleTemplateFn(u,this,s.id,p);h=3===c[0].nodeType?c[1]:c[0]}else h=this.ruleTemplateFn(u,this,"Template",p)[0];(a=h).className+=" e-rule-field"}else a=this.ruleElem.querySelector(".e-rule-field").cloneNode(!0);return s.appendChild(a),l&&l.ruleTemplate&&this.renderReactTemplates(),s},h.prototype.addRuleElement=function(e,t,l,i,r,o){var n=this;if(e){var s={groupID:e.id.replace(this.element.id+"_",""),cancel:!1,type:"insertRule"};this.isImportRules||this.isInitialLoad?(this.isInitialLoad=!1,this.addRuleSuccessCallBack(s,e,t,l,i,r,o)):this.trigger("beforeChange",s,function(s){n.addRuleSuccessCallBack(s,e,t,l,i,r,o)})}},h.prototype.addRuleSuccessCallBack=function(e,l,r,o,n,s,a){var u,p,h,c,m=this.element.className.indexOf("e-device")>-1?"250px":"200px",f=r&&r.field?this.getColumn(r.field):o||this.columns[0],g={label:"",field:"",type:"",operator:""};if(!e.cancel){if(f&&f.ruleTemplate){this.selectedColumn=f,p=this.selectedColumn.operators,g={label:f.label,field:f.field,type:f.type,operator:p[0].value};var v=Object.keys(r).length?r:g,y={requestType:"template-create",action:"insert-rule",ruleID:(c=this.appendRuleElem(l,f,n,s,"field",v)).id,fields:this.fields,rule:v};this.trigger("actionBegin",y)}else{(c=this.appendRuleElem(l,f,n,s,"field")).querySelector(".e-filter-input").setAttribute("id",c.id+"_filterkey");var C=c.querySelector("button");this.element.className.indexOf("e-device")>-1||"Vertical"===this.displayMode?(C.textContent=this.l10n.getConstant("Remove"),t.addClass([C],"e-flat"),t.addClass([C],"e-primary")):(t.addClass([C],"e-round"),t.addClass([C],"e-icon-btn"),C.setAttribute("title",this.l10n.getConstant("DeleteRule")),C=this.createElement("span",{attrs:{class:"e-btn-icon e-icons e-delete-icon"}}),c.querySelector("button").appendChild(C))}if("Vertical"===this.displayMode||this.element.className.indexOf("e-device")>-1?c.className="e-rule-container e-vertical-mode":c.className="e-rule-container e-horizontal-mode",c.previousElementSibling&&c.previousElementSibling.className.indexOf("e-rule-container")>-1&&(c.className.indexOf("e-joined-rule")<0&&(c.className+=" e-joined-rule"),c.previousElementSibling.className.indexOf("e-prev-joined-rule")<0&&(c.previousElementSibling.className+=" e-prev-joined-rule")),c.previousElementSibling&&c.previousElementSibling.className.indexOf("e-group-container")>-1&&c.className.indexOf("e-separate-rule")<0&&(c.className+=" e-separate-rule"),this.isImportRules||this.updateAddedRule(l,r,g,a,s),!f||f&&!f.ruleTemplate)if("Default"===this.fieldMode){var b=void 0,S=this.isImportRules?this.GetRootColumnName(r.field):r.field;b={dataSource:this.columns,fields:this.fields,placeholder:this.l10n.getConstant("SelectField"),popupHeight:this.columns.length>5?m:"auto",close:this.fieldClose.bind(this,c.id+"_filterkey"),change:this.changeField.bind(this),value:r?S:null,open:this.popupOpen.bind(this,!0)},this.fieldModel&&(b=d({},b,this.fieldModel)),(h=new i.DropDownList(b)).appendTo("#"+c.id+"_filterkey");O=this.isImportRules?this.GetRootColumnName(r.field):h.value;this.selectedColumn=h.getDataByValue(O),Object.keys(r).length&&this.changeRule(r,{element:h.element,itemData:this.selectedColumn})}else{var x=void 0,b=void 0,S=(this.isImportRules,r.field);b={fields:{dataSource:this.columns,value:"field",text:"label",child:"columns",expanded:"expanded"},placeholder:this.l10n.getConstant("SelectField"),showClearButton:!1,popupHeight:this.columns.length>5?m:"auto",changeOnBlur:!1,change:this.changeField.bind(this),value:this.isImportRules?[S]:null,open:this.popupOpen.bind(this,!1)},this.fieldModel&&(b=d({},b,this.fieldModel)),(x=new i.DropDownTree(b)).appendTo("#"+c.id+"_filterkey"),t.isNullOrUndefined(x.value)||(x.element.value=x.value[0]);var O=this.isImportRules?this.GetRootColumnName(r.field):x.value;this.selectedColumn=this.getColumn(O),Object.keys(r).length&&this.changeRule(r,{element:x.element,itemData:this.selectedColumn})}u=c.id.replace(this.element.id+"_",""),this.isImportRules||this.trigger("change",{groupID:l.id.replace(this.element.id+"_",""),ruleID:u,type:"insertRule"})}},h.prototype.updateAddedRule=function(e,l,i,r,o){var n,s,a,u=0;if(r){for(n=t.select("#"+o,e),s=t.closest(e,".e-group-container"),a=this.getParentGroup(s);n&&null!==n.previousElementSibling;)n=n.previousElementSibling,u++;a.rules[u]=l}else{s=t.closest(e,".e-group-container"),a=this.getParentGroup(s);var d=l.custom;Object.keys(l).length?(a.rules.push({field:l.field,type:l.type,label:l.label,operator:l.operator,value:l.value}),d&&(a.rules[a.rules.length-1].custom=d)):(d&&(i.custom=d),a.rules.push(i))}this.disableRuleCondition(e,a)},h.prototype.changeRuleTemplate=function(e,l){var i=this.selectedColumn.operators;if(!e.ruleTemplate){var r=t.closest(l,".e-group-container"),o=t.closest(l,".e-rule-container").id;if(this.previousColumn&&this.previousColumn.ruleTemplate&&(t.detach(l.closest('[id="'+o+'"]').querySelector(".e-rule-field")),this.clearQBTemplate([o])),e){var n={field:e.field,label:e.label,operator:i[0].value,value:""};this.addRuleElement(r,n,e,"change",o,!0)}}},h.prototype.renderToolTip=function(e){var t=new a.Tooltip({content:this.l10n.getConstant("ValidationMessage"),position:"BottomCenter",cssClass:"e-querybuilder-error"});t.appendTo(e),t.open(e)},h.prototype.validateFields=function(){var e=!0;if(this.allowValidation){var l=["isnull","isnotnull","isempty","isnotempty"],i=void 0,r=void 0,o=void 0,n=void 0,s=[],a=void 0,u=void 0,d=void 0,p=void 0,h=void 0,c=this.element.querySelectorAll(".e-rule-container"),m=void 0;for(i=0,r=c.length;i<r;i++)if(a=t.closest(c[i],".e-group-container"),h=this.getParentGroup(a),u=0,n=p=c[i],d=t.getComponent(c[i].querySelector(".e-rule-field input.e-control"),"dropdownlist"),this.selectedColumn=d.getDataByValue(d.value),m=!t.isNullOrUndefined(d.index)&&this.selectedColumn.validation,o=p.querySelector(".e-rule-field input.e-control"),m&&m.isRequired){for(;n&&null!==n.previousElementSibling;)n=n.previousElementSibling,u++;if(o=p.querySelector(".e-rule-operator input.e-control"),h.rules[u].operator||(o.parentElement.className.indexOf("e-tooltip")<0&&this.renderToolTip(o.parentElement),e=!1),h.rules[u].value instanceof Array&&(s=h.rules[u].value),l.indexOf(h.rules[u].operator)<0&&t.isNullOrUndefined(h.rules[u].value)&&"date"!==h.rules[u].type||""===h.rules[u].value||h.rules[u].value instanceof Array&&s.length<1){var f=p.querySelectorAll(".e-rule-value input.e-control");e=!1;for(var g=0,v=f.length;g<v;g++){var y=f[g],C=void 0;y.parentElement.className.indexOf("e-searcher")>-1?(C=t.closest(y,".e-multi-select-wrapper")).className.indexOf("e-tooltip")<0&&this.renderToolTip(C):f[g].parentElement.className.indexOf("e-tooltip")<0&&this.renderToolTip(f[g].parentElement),g++}}}else d.element&&t.isNullOrUndefined(d.index)&&(o.parentElement.className.indexOf("e-tooltip")<0&&this.renderToolTip(o.parentElement),e=!1)}return e},h.prototype.refreshLevelColl=function(){this.levelColl={};var e=this.element.querySelector(".e-group-container");if(e){this.levelColl[e.id]=[0];var t={groupElement:e,level:[0]};this.refreshLevel(t)}},h.prototype.refreshLevel=function(e){var l,i,r=e.groupElement.querySelector(".e-rule-list").children,o=e.groupElement,n=r.length,s=0;for(i=0;i<n;i++)(l=r[i]).className.indexOf("e-group-container")>-1&&(e.level.push(s),this.levelColl[l.id]=e.level.slice(),s++,e.groupElement=l,e=this.refreshLevel(e));var a=t.closest(o,".e-rule-list");return e.groupElement=a?t.closest(a,".e-group-container"):o,e.level=this.levelColl[e.groupElement.id].slice(),e},h.prototype.groupTemplate=function(){var e,t,l,i,r,o=this.createElement("div",{attrs:{class:"e-group-container"}}),n=this.createElement("div",{attrs:{class:"e-group-header"}}),s=this.createElement("div",{attrs:{class:"e-group-body"}}),a=this.createElement("div",{attrs:{class:"e-rule-list"}});return o.appendChild(n),s.appendChild(a),o.appendChild(s),this.headerTemplate||(e=this.createElement("div",{attrs:{class:"e-lib e-btn-group"}}),this.enableNotCondition&&(t=this.createElement("button",{attrs:{type:"button",class:"e-qb-toggle"}}),e.appendChild(t)),(t=this.createElement("input",{attrs:{type:"radio",class:"e-btngroup-and",value:"AND"}})).setAttribute("checked","true"),e.appendChild(t),l=this.createElement("label",{attrs:{class:"e-lib e-btn e-btngroup-and-lbl e-small"},innerHTML:this.l10n.getConstant("AND")}),e.appendChild(l),t=this.createElement("input",{attrs:{type:"radio",class:"e-btngroup-or",value:"OR"}}),e.appendChild(t),l=this.createElement("label",{attrs:{class:"e-lib e-btn e-btngroup-or-lbl e-small"},innerHTML:this.l10n.getConstant("OR")}),e.appendChild(l),n.appendChild(e),i=this.createElement("div",{attrs:{class:"e-group-action"}}),r=this.createElement("button",{attrs:{type:"button",class:"e-add-btn"}}),i.appendChild(r),n.appendChild(i)),o},h.prototype.ruleTemplate=function(){var e,t,l=this.createElement("div"),i=this.createElement("div",{attrs:{class:"e-rule-field"}});e=this.createElement("div",{attrs:{class:"e-rule-filter"}});var r=this.createElement("input",{attrs:{type:"text",class:"e-filter-input"}});e.appendChild(r),i.appendChild(e),e=this.createElement("div",{attrs:{class:"e-rule-operator"}}),i.appendChild(e),e=this.createElement("div",{attrs:{class:"e-rule-value"}}),i.appendChild(e),e=this.createElement("div",{attrs:{class:"e-rule-value-delete"}}),t=this.showButtons.ruleDelete?"e-removerule e-rule-delete e-css e-btn e-small":"e-removerule e-rule-delete e-css e-btn e-small e-button-hide";var o=this.createElement("button",{attrs:{type:"button",class:t}});return e.appendChild(o),i.appendChild(e),l.appendChild(i),l},h.prototype.addGroupElement=function(e,t,l,i,r,o,n){var s=this,a={groupID:t.id.replace(this.element.id+"_",""),cancel:!1,type:"insertGroup"};this.isImportRules||this.isInitialLoad?(this.isInitialLoad=!1,this.addGroupSuccess(a,e,t,l,i,r,o,n)):this.trigger("beforeChange",a,function(a){s.addGroupSuccess(a,e,t,l,i,r,o,n)})},h.prototype.addGroupSuccess=function(e,i,r,o,n,a,u,d){if(!e.cancel&&this.element.querySelectorAll(".e-group-container").length<=this.maxGroupCount){var p=r,h=void 0,c=this.groupElem.cloneNode(!0);if(c.setAttribute("id",this.element.id+"_group"+this.groupIdCounter),this.headerTemplate&&(u?(i=!1,c.setAttribute("id",this.element.id+"_group0"),this.headerTemplateFn(c,a,o,d),this.groupIdCounter=0):this.headerTemplateFn(c,a,o,d)),this.groupIdCounter++,!this.headerTemplate){var m=c.querySelector(".e-btngroup-and"),f=c.querySelector(".e-btngroup-or"),g=c.querySelector(".e-btngroup-and-lbl"),v=c.querySelector(".e-btngroup-or-lbl");m.setAttribute("id",this.element.id+"_and"+this.btnGroupId),f.setAttribute("id",this.element.id+"_or"+this.btnGroupId),m.setAttribute("name",this.element.id+"_and"+this.btnGroupId),f.setAttribute("name",this.element.id+"_and"+this.btnGroupId),g.setAttribute("for",this.element.id+"_and"+this.btnGroupId),v.setAttribute("for",this.element.id+"_or"+this.btnGroupId),this.btnGroupId++}if(i){var y=this.showButtons.groupDelete?"e-deletegroup":"e-deletegroup e-button-hide";h=this.createElement("button",{attrs:{type:"button",class:y}}),new l.Button({iconCss:"e-icons e-delete-icon",cssClass:"e-small e-round"}).appendTo(h),h.setAttribute("title",this.l10n.getConstant("DeleteGroup")),t.rippleEffect(h,{selector:".deletegroup"}),this.headerTemplate||c.querySelector(".e-group-action").appendChild(h);for(var C=p.querySelector(".e-rule-list"),b=C.children,S=0,x=0,O=b.length;x<O;x++)b[x].className.indexOf("e-group-container")>-1&&(S+=1);C.appendChild(c);var E=this.levelColl[p.id].slice(0);E.push(S),this.levelColl[c.id]=E,this.isImportRules||(this.isAddSuccess=!0,this.addGroups([],p.id.replace(this.element.id+"_","")),this.isAddSuccess=!1,n&&this.addRuleElement(c,{}))}else p.appendChild(c),this.levelColl[c.id]=[0];if(this.enableNotCondition&&!this.headerTemplate){var w=c.querySelector(".e-qb-toggle");new l.Button({content:this.l10n.getConstant("NOT"),cssClass:"e-btn e-small"}).appendTo(w),c.querySelector(".e-btngroup-and-lbl").classList.add("e-not"),this.updatedRule&&this.updatedRule.not&&t.addClass([w],"e-active-toggle")}if(this.updatedRule=null,this.headerTemplate){var N={requestType:"header-template-create",ruleID:c.id,condition:o,notCondition:this.enableNotCondition?a:void 0};this.trigger("actionBegin",N)}else{var q=c.querySelector(".e-add-btn");new s.DropDownButton({items:this.items,cssClass:"e-round e-small e-caret-hide e-addrulegroup",iconCss:"e-icons e-add-icon",beforeOpen:this.selectBtn.bind(this,q),select:this.selectBtn.bind(this,q)}).appendTo(q),q.setAttribute("title",this.l10n.getConstant("AddButton"))}if(!this.isImportRules){var R=p.id.replace(this.element.id+"_",""),T=c.id.replace(this.element.id+"_","");this.trigger("change",{groupID:R,type:"insertGroup",childGroupID:T})}}},h.prototype.headerTemplateFn=function(e,t,l,i){var r,o,n=this.element.id+"_header",s=e.querySelector(".e-group-header");if(this.headerTemplate){if(o={requestType:"header-template-initialize",ruleID:e.id,notCondition:this.enableNotCondition?t:void 0,condition:l,rule:this.getRuleCollection(i,!0)},this.trigger("actionBegin",o),this.headerFn=this.templateParser(this.headerTemplate),this.isReact)r=this.headerFn(o,this,e.id,n)[0];else if(this.isAngular){var a=this.headerFn(o,this,e.id,n);r=3===a[0].nodeType?a[1]:a[0]}else r=this.headerFn(o,this,"Template",n)[0];s.appendChild(r),this.renderReactTemplates()}return e},h.prototype.notifyChange=function(e,l,i){var r=t.closest(l,".e-group-container"),o=this.getParentGroup(r),n=t.closest(l,".e-rule-container"),s=0;if("not"===i)return void(o.not=e);if("condition"===i)return void(o.condition=e);for(;n&&null!==n.previousElementSibling;)n=n.previousElementSibling,s++;var a=o.rules[s],u=this.getColumn(a.field),d=this.getFormat(u.format);if("date"===u.type)if(e instanceof Date)e=this.intl.formatDate(e,d);else if(e instanceof Array)for(var p=0;p<e.length;p++)e[p]&&e[p]instanceof Date&&(e[p]=this.intl.formatDate(e[p],d));u.ruleTemplate?this.templateChange(l,e,i):(this.isNotified=!0,this.updateRules(l,e),this.isNotified=!1)},h.prototype.templateChange=function(e,l,i){for(var r=t.closest(e,".e-group-container"),o=this.getParentGroup(r),n=t.closest(e,".e-rule-container"),s=0;n&&null!==n.previousElementSibling;)n=n.previousElementSibling,s++;var a=o.rules[s];"field"===i?this.selectedColumn=this.getColumn(l):a&&(this.selectedColumn=this.getColumn(a.field));var u;this.previousColumn=this.getColumn(a.field);var d=this.getValidRules(this.rule);this.selectedColumn&&(u=this.selectedColumn.operators?this.selectedColumn.operators:this.customOperators[this.selectedColumn.type+"Operator"]);var p,h=["in","notin","between","notbetween"];switch(i){case"field":a.field=l,a.label=this.selectedColumn.label,a.type=this.selectedColumn.type,a.value="",a.operator=u[0].value;break;case"operator":p=a.operator,a.operator=l,h.indexOf(a.operator)>-1?a.value=[]:h.indexOf(p)>-1&&(a.value="");break;case"value":a.value=l}if(this.changeRuleTemplate(this.selectedColumn,e),this.filterRules(d,this.getValidRules(this.rule),i),this.selectedColumn&&this.selectedColumn.ruleTemplate&&("field"===i||"operator"===i)){var c=t.closest(e,".e-rule-container");this.destroyControls(c,!0),t.detach(c.querySelector(".e-rule-field"));var m=this.appendRuleElem(t.closest(c,".e-group-container"),this.selectedColumn,"change",c.id,i,a);"Vertical"===this.displayMode||this.element.className.indexOf("e-device")>-1?m.className="e-rule-container e-vertical-mode":m.className="e-rule-container e-horizontal-mode",m.previousElementSibling&&m.previousElementSibling.className.indexOf("e-rule-container")>-1&&(m.className.indexOf("e-joined-rule")<0&&(m.className+=" e-joined-rule"),m.previousElementSibling.className.indexOf("e-prev-joined-rule")<0&&(m.previousElementSibling.className+=" e-prev-joined-rule")),m.previousElementSibling&&m.previousElementSibling.className.indexOf("e-group-container")>-1&&m.className.indexOf("e-separate-rule")<0&&(m.className+=" e-separate-rule");var f={requestType:"template-create",action:i,ruleID:c.id,fields:this.fields,rule:a};this.trigger("actionBegin",f)}},h.prototype.changeValue=function(e,l){var i,r=this;((i=l.element&&l.element.classList.contains("e-multiselect")?l.element:l.event?l.event.target:l.element).className.indexOf("e-day")>-1||i.className.indexOf("e-today")>-1||i.className.indexOf("e-cell")>-1)&&(i=l.element);var o=t.closest(i,".e-group-container"),n=t.closest(i,".e-rule-container"),s=o&&o.id.replace(this.element.id+"_",""),a=n.id.replace(this.element.id+"_",""),u=l;u.element&&u.element.className.indexOf("e-datepicker")>-1&&(i=u.element);var d,p,h;i.className.indexOf("e-radio")>-1?(p=parseInt(i.id.split("valuekey")[1],0),h=t.getComponent(t.closest(i,".e-rule-container").querySelector(".e-filter-input"),"dropdownlist"),this.selectedColumn=h.getDataByValue(h.value),d=this.selectedColumn.values?this.selectedColumn.values[p]:[!0,!1][p]):d=i.className.indexOf("e-multiselect")>-1?t.getComponent(i,"multiselect").value:l.value,"input"===l.name&&this.immediateModeDelay?(window.clearInterval(this.timer),this.timer=window.setInterval(function(){r.filterValue(s,a,d,e,i)},this.immediateModeDelay)):this.filterValue(s,a,d,e,i)},h.prototype.filterValue=function(e,t,l,i,r){var o=this,n={groupID:e,ruleID:t,value:l,cancel:!1,type:"value"};window.clearInterval(this.timer),this.isImportRules?this.changeValueSuccessCallBack(n,r,i,e,t):this.trigger("beforeChange",n,function(l){o.changeValueSuccessCallBack(l,r,i,e,t)})},h.prototype.changeValueSuccessCallBack=function(e,t,l,i,r){e.cancel||(this.updateRules(t,e.value,l),this.isImportRules||this.trigger("change",{groupID:i,ruleID:r,value:e.value,cancel:!1,type:"value"}))},h.prototype.fieldClose=function(e){if(!this.isFieldChange&&!this.isDestroy){this.isFieldClose=!0;var l=t.getComponent(e,"dropdownlist"),i=l.popupObj.element.querySelector(".e-active"),r=l.getItemData();l.value=r.value;var o={element:l.element,value:r.value,isInteracted:!0,previousItemData:this.prevItemData,previousItem:null,item:i,itemData:r,event:null,e:null};this.changeField(o),this.isFieldChange=!1}},h.prototype.changeField=function(e){if(e.isInteracted){this.isFieldChange=!0,this.prevItemData=e.itemData;var l=t.closest(e.element,".e-rule-filter")||t.closest(e.element,".e-rule-sub-filter"),i="DropdownTree"===this.fieldMode?this.getColumn(e.value[0]):this.getColumn(e.value);if("DropdownTree"===this.fieldMode&&null!=l){var r=l.querySelector(".e-control"),o=t.getComponent(r,"dropdowntree");if(!i)return;if("object"===i.type)return o.value=e.oldValue,o.dataBind(),void(t.isNullOrUndefined(e.oldValue)?r.value="":r.value=e.oldValue[0]);t.isNullOrUndefined(e.value[0])||(o.value=e.value[0],o.dataBind(),r.value=e.value[0])}if(this.destroySubFields(l),this.subFieldElem=null,this.isNotValueChange=!0,i&&i.ruleTemplate)this.templateChange(e.element,i.field,"field");else{for(var n=t.closest(e.element,".e-group-container"),s=this.getParentGroup(n),a=t.closest(e.element,".e-rule-container"),u=0;a&&null!==a.previousElementSibling;)a=a.previousElementSibling,u++;s.rules[u].value="",this.changeRule(s.rules[u],e)}}},h.prototype.changeRule=function(e,l){if(!l.itemData){if("DropdownTree"!==this.fieldMode)return;if(null==t.getComponent(l.element,"dropdowntree").value)return}var i={},r=t.closest(l.element,".e-rule-filter");r=r||t.closest(l.element,".e-rule-sub-filter");var o=t.getComponent(l.element,"dropdownlist");"DropdownTree"===this.fieldMode&&null!=r&&(o=t.getComponent(l.element,"dropdowntree"));var n=t.closest(l.element,".e-group-container").id.replace(this.element.id+"_","");this.changeFilter(r,o,n,e,i,l)},h.prototype.changeFilter=function(e,l,i,r,o,n){var s=this;if(e){var a=void 0;a="DropdownTree"===this.fieldMode?l.value[0]:this.isImportRules?this.GetRootColumnName(l.value):l.value,this.selectedColumn=this.getColumn(a);var u={groupID:i,ruleID:t.closest(e,".e-rule-container").id.replace(this.element.id+"_",""),selectedField:"DropdownTree"===this.fieldMode?l.value[0]:l.value,cancel:!1,type:"field"};this.isImportRules?this.fieldChangeSuccess(u,o,e,r,n):this.trigger("beforeChange",u,function(t){s.fieldChangeSuccess(t,o,e,r,n)})}else{var d=t.closest(n.element,".e-rule-operator");this.changeOperator(e,d,l,i,r,o,n)}},h.prototype.changeOperator=function(e,l,i,r,o,n,s){var a,u=this;l?(a={groupID:r,ruleID:t.closest(l,".e-rule-container").id.replace(this.element.id+"_",""),selectedIndex:i.index,cancel:!1,type:"operator"},this.isImportRules?this.operatorChangeSuccess(a,e,n,o,s):this.trigger("beforeChange",a,function(t){u.operatorChangeSuccess(t,e,n,o,s)})):this.changeRuleValues(e,o,n,s)},h.prototype.fieldChangeSuccess=function(e,l,i,r,o){for(var n=t.closest(i,".e-rule-container"),s=t.closest(o.element,".e-rule-operator"),a=t.closest(o.element,".e-group-container").id.replace(this.element.id+"_",""),u=t.getComponent(o.element,"dropdownlist"),d=n.querySelectorAll(".e-tooltip.e-input-group"),p=0;p<d.length;p++)t.getComponent(d[p],"tooltip").destroy();if(e.cancel)this.changeOperator(i,s,u,a,r,l,o);else{if(null===this.selectedColumn)return;if(l.type=this.selectedColumn.type,n.querySelector(".e-template")&&(r.value=""),"object"===this.selectedColumn.type&&"Default"===this.fieldMode)for(l.type=this.selectedColumn.columns[0].type;this.selectedColumn.columns;)this.createSubFields(i,r,l,o);else this.destroySubFields(i),this.changeOperator(i,s,u,a,r,l,o)}},h.prototype.destroySubFields=function(e){for(;e&&e.nextElementSibling.classList.contains("e-rule-sub-filter");)this.destroyControls(e),e.nextElementSibling.remove()},h.prototype.createSubFields=function(e,l,r,o){var n=t.closest(e,".e-rule-field"),s=this.createElement("div",{attrs:{class:"e-rule-sub-filter",id:"subfilter"+this.subFilterCounter}});n.insertBefore(s,n.querySelector(".e-rule-operator"));var a=t.closest(s,".e-rule-container").id,u=this.createElement("input",{attrs:{type:"text",id:a+"_subfilterkey"+this.subFilterCounter}});s.appendChild(u);var p,h=this.element.className.indexOf("e-device")>-1?"250px":"200px",c=Object.keys(this.selectedColumn.columns[0]);p={dataSource:this.selectedColumn.columns,fields:this.fields,placeholder:this.l10n.getConstant("SelectField"),popupHeight:c.length>5?h:"auto",change:this.changeField.bind(this),index:0,open:this.popupOpen.bind(this,!1)},this.fieldModel&&(p=d({},p,this.fieldModel));var m=new i.DropDownList(p);if(m.appendTo("#"+a+"_subfilterkey"+this.subFilterCounter),this.isImportRules)for(var f=this.selectedColumn.columns,g=0;g<f.length;g++)if(l.field===f[g].field||l.field.indexOf(f[g].field)>-1){m.value=f[g].field,this.selectedColumn=f[g];break}this.subFilterCounter++,this.subFieldElem=u,o.itemData=o.itemData,this.isImportRules||(this.selectedColumn=this.selectedColumn.columns[0]),this.selectedColumn.columns||this.changeRuleValues(s,l,r,o)},h.prototype.operatorChangeSuccess=function(e,l,i,r,o){if(!e.cancel){var n=t.closest(o.element,".e-rule-operator"),s=n.nextElementSibling,a=t.getComponent(o.element,"dropdownlist"),u=r.operator?r.operator.toString().toLowerCase():"";i.operator=a.value.toString();var d=i.operator.toLowerCase();if(i.operator.toLowerCase().indexOf("between")>-1||i.operator.toLowerCase().indexOf("in")>-1&&i.operator.toLowerCase().indexOf("contains")<0?(l=n.previousElementSibling,i.type=r.type,(i.operator.toLowerCase().indexOf("in")<0||u.indexOf("in")<0)&&(r.value=[])):"object"==typeof r.value&&null!=r.value&&(r.value=r.value.length>0?r.value[0]:"number"===r.type?0:""),o.previousItemData){var p=o.previousItemData.value.toString().toLowerCase();(p.indexOf("between")>-1||(p.indexOf("in")>-1||p.indexOf("null")>-1||p.indexOf("empty")>-1)&&p.indexOf("contains")<0)&&(l=n.previousElementSibling,i.type=r.type)}if(u.indexOf("in")>-1&&u.indexOf("in")<5&&d.indexOf("in")>-1&&d.indexOf("in")<5&&(l=null),i.operator.indexOf("null")>-1||i.operator.indexOf("empty")>-1){var h=n.parentElement.querySelector(".e-rule-value"),c=h.querySelector(".e-tooltip.e-input-group");c&&t.getComponent(c,"tooltip").destroy(),t.removeClass([h],"e-show"),t.addClass([h],"e-hide")}s&&this.getColumn(r.field).template&&(l=n.previousElementSibling),this.changeRuleValues(l,r,i,o)}},h.prototype.changeRuleValues=function(e,l,r,o){var n,s,a,u=t.closest(o.element,".e-rule-operator");if(e)if(u=e.nextElementSibling,e.classList.contains("e-rule-sub-filter")&&(r.type=this.selectedColumn.type,u=u.classList.contains("e-rule-sub-filter")?u.nextElementSibling:u),t.addClass([u],"e-operator"),u.childElementCount){n=t.getComponent(u.querySelector(".e-dropdownlist"),"dropdownlist"),r.operator=n.value;var p=void 0;p="DropdownTree"===this.fieldMode?t.getComponent(e.querySelector(".e-dropdowntree"),"dropdowntree"):t.getComponent(e.querySelector(".e-dropdownlist"),"dropdownlist"),r.type="DropdownTree"===this.fieldMode?this.getColumn(p.value[0]).type:this.getColumn(p.value).type;var h=o.itemData;this.renderValues(u,h,o.previousItemData,!0,l,r,o.element)}else{var c=t.closest(u,".e-rule-container").id;a=this.createElement("input",{attrs:{type:"text",id:c+"_operatorkey"}}),u.appendChild(a),this.selectedColumn.operators?s=this.selectedColumn.operators:o.itemData&&(s=this.customOperators[this.selectedColumn.type+"Operator"]);var m=this.element.className.indexOf("e-device")>-1?"250px":"200px",f=s[0].value;f=l&&""!==l.operator?l.operator:f;var g=void 0;g={dataSource:s,fields:{text:"key",value:"value"},placeholder:this.l10n.getConstant("SelectOperator"),popupHeight:s.length>5?m:"auto",change:this.changeField.bind(this),index:0,value:f,open:this.popupOpen.bind(this,!1)},this.operatorModel&&(g=d({},g,this.operatorModel)),new i.DropDownList(g).appendTo("#"+c+"_operatorkey"),r.operator=l&&""!==l.operator&&!t.isNullOrUndefined(l.operator)?l.operator:s[0].value,this.isImportRules&&(r.type=this.selectedColumn.type,r.operator=l.operator),this.renderValues(u,this.selectedColumn,o.previousItemData,!1,l,r,o.element)}this.isImportRules||this.updateRules(o.element,o.item)},h.prototype.popupOpen=function(e,l){this.enableRtl&&t.addClass([l.popup.element],"e-rtl"),e&&(this.isFieldClose=!1)},h.prototype.destroyControls=function(e,l){for(var i=l?e:e.nextElementSibling,r=i.querySelectorAll("input.e-control"),o=i.querySelectorAll("div.e-control:not(.e-handle)"),n=this.columns,s=0,a=r.length;s<a;s++){if(r[s].classList.contains("e-textbox"))t.getComponent(r[s],"textbox").destroy(),t.detach(t.select("input#"+r[s].id,i));else if(r[s].classList.contains("e-dropdownlist"))this.allowValidation&&r[s].parentElement.className.indexOf("e-tooltip")>-1&&t.getComponent(r[s].parentElement,"tooltip").destroy(),t.getComponent(r[s],"dropdownlist").destroy();else if(r[s].classList.contains("e-radio"))t.getComponent(r[s],"radio").destroy();else if(r[s].classList.contains("e-numerictextbox"))t.getComponent(r[s],"numerictextbox").destroy(),t.detach(t.select("input#"+r[s].id,i));else if(r[s].classList.contains("e-datepicker"))t.getComponent(r[s],"datepicker").destroy();else if(r[s].classList.contains("e-multiselect"))t.getComponent(r[s],"multiselect").destroy();else if(r[s].className.indexOf("e-template")>-1)for(var u=r[s].className,d=0,p=n.length;d<p;d++)if(n[d].template&&u.indexOf(n[d].field)>-1){this.templateDestroy(n[d],r[s].id);break}document.getElementById(r[s].id)&&t.detach(r[s])}for(var s=0,a=o.length;s<a;s++){if(o[s].className.indexOf("e-template")>-1)for(var u=o[s].className,d=0,p=n.length;d<p;d++)if(n[d].template&&u.indexOf(n[d].field)>-1){this.templateDestroy(n[d],o[s].id);break}t.detach(o[s])}for(var h=i.querySelectorAll(".e-template:not(.e-control)"),s=0,a=h.length;s<a;s++)t.detach(h[s])},h.prototype.templateDestroy=function(e,l){var i;if("string"!=typeof e.template||void 0===e.template.destroy){var r=(i=e.template).destroy;if(i.destroy){var o=void 0;document.getElementById(l)&&(o=t.closest(document.getElementById(l),".e-rule-field").querySelectorAll(".e-template")),"string"==typeof r?(r=t.getValue(r,window))({field:e.field,elementId:l,elements:o}):i.destroy({field:e.field,elementId:l,elements:o})}}},h.prototype.getValues=function(e){var t,l={},i=[],r=[];this.separator.length>0&&(r=e.split(this.separator));var o=this.dataColl;if(this.dataColl[1])for(var n=0,s=o.length;n<s;n++){var a={};if(r.length>1)for(var u=o[n],d=void 0,p=0,h=r.length;p<h;p++)d=r[p],r.length===p+1?(t=u[d],Number(u[d])===u[d]&&u[d]%1!=0&&(t=u[d].toString())):u=u[d];else t=o[n][e],Number(o[n][e])===o[n][e]&&o[n][e]%1!=0&&(t=o[n][e].toString());t in l||(l[t]=1,r.length>1?this.createNestedObject(a,r,t):a[e]=t,i.push(a))}return i},h.prototype.createNestedObject=function(e,t,l){for(var i,r=t.length-1,o=0;o<r;++o)(i=t[o])in e||(e[i]={}),e=e[i];e[t[r]]=l},h.prototype.getDistinctValues=function(e,t){for(var l={},i=[],r=0,o=e.length;r<o;r++){var n=e[r][t];Number(e[r][t])===e[r][t]&&e[r][t]%1!=0&&(n=e[r][t].toString());var s={};n in l||(l[n]=1,s[t]=n,i.push(s))}return i},h.prototype.renderMultiSelect=function(e,t,l,o,n){var s,a=!1,u=!1;this.dataColl[1]&&Object.keys(this.dataColl[1]).indexOf(e.field)>-1&&(a=!0,s=this.getDistinctValues(this.dataColl,e.field)),a=!e.columns&&a,!this.dataColl.length&&n.length&&(u=!0);var p;p={dataSource:u?n:a?s:this.dataManager,query:new r.Query([e.field]),fields:{text:this.selectedRule.field,value:this.selectedRule.field},placeholder:this.l10n.getConstant("SelectValue"),value:o,mode:"CheckBox",width:"100%",change:this.changeValue.bind(this,l),close:this.closePopup.bind(this,l),actionBegin:this.multiSelectOpen.bind(this,t+"_valuekey"+l),open:this.popupOpen.bind(this,!1)},this.valueModel&&this.valueModel.multiSelectModel&&(p=d({},p,this.valueModel.multiSelectModel));var h=new i.MultiSelect(p);h.appendTo("#"+t+"_valuekey"+l),this.updateRules(h.element,o,0)},h.prototype.multiSelectOpen=function(e,l){if(this.dataSource instanceof r.DataManager){var i=document.getElementById(e),o=t.getComponent(t.closest(i,".e-rule-container").querySelector(".e-filter-input"),"dropdownlist");this.selectedColumn=o.getDataByValue(o.value);var n=this.selectedColumn.field,s=!1;this.dataColl[1]&&Object.keys(this.dataColl[1]).indexOf(n)>-1&&(s=!0),s||(l.cancel=!0,this.bindMultiSelectData(i,n))}},h.prototype.bindMultiSelectData=function(e,t){this.getMultiSelectData(e,t)},h.prototype.getMultiSelectData=function(e,l){var i,o=this,n=new r.Deferred,s=this.dataManager.executeQuery((new r.Query).select(l)),u=t.getComponent(e,"multiselect");u.hideSpinner(),this.createSpinner(t.closest(e,".e-multi-select-wrapper").parentElement),a.showSpinner(t.closest(e,".e-multi-select-wrapper").parentElement),s.then(function(r){i=r.actual&&r.actual.result?r.actual.result:r.result,o.dataColl=t.extend(o.dataColl,i,[],!0),u.dataSource=o.getDistinctValues(o.dataColl,l),a.hideSpinner(t.closest(e,".e-multi-select-wrapper").parentElement)}).catch(function(e){n.reject(e)})},h.prototype.createSpinner=function(e){var l=this.createElement("span",{attrs:{class:"e-qb-spinner"}});e.appendChild(l),a.createSpinner({target:l,width:t.Browser.isDevice?"16px":"14px"})},h.prototype.closePopup=function(e,l){var i=document.getElementById(l.popup.element.id.replace("_popup",""));if(i){var r=t.getComponent(i,"multiselect").value;this.updateRules(i,r,e)}},h.prototype.processTemplate=function(e,l,i,r){var o=t.closest(e,".e-rule-container"),n=o.querySelectorAll(".e-template"),s=o.querySelector(".e-rule-filter .e-filter-input"),a="DropdownTree"===this.fieldMode?t.getComponent(s,"dropdowntree"):t.getComponent(o.querySelector(".e-rule-filter .e-filter-input"),"dropdownlist"),u="DropdownTree"===this.fieldMode?this.getColumn(a.value[0]):this.getColumn(a.value);if("string"==typeof l.template||void 0===l.template.write){var d={rule:i,ruleID:o.id,operator:r.operator,field:u.field,requestType:"value-template-create"};this.trigger("actionBegin",d)}else{var p=l.template;"string"==typeof p.write?t.getValue(p.write,window)({elements:n.length>1?n:n[0],values:i.value,operator:r.operator,field:u.field,dataSource:u.values}):l.template.write({elements:n.length>1?n:n[0],values:i.value,operator:r.operator,field:u.field,dataSource:u.values})}},h.prototype.getItemData=function(e){var l=t.getComponent(document.getElementById(e+"_filterkey"),"dropdownlist");return"DropdownTree"===this.fieldMode&&(l=t.getComponent(document.getElementById(e+"_filterkey"),"dropdowntree")),"DropdownTree"===this.fieldMode?this.getColumn(l.value[0]):this.getColumn(l.value)},h.prototype.setDefaultValue=function(e,l,i){var r=this.getItemData(e);if(t.isNullOrUndefined(r.value))return i?l?[0,0]:0:l?[]:"";if(l){if(!(r.value instanceof Array))return[r.value]}else if(r.value instanceof Array)return r.value[0];return r.value},h.prototype.renderStringValue=function(e,t,l,i,r){var n,s,a=this.getItemData(e),u="string"==typeof a.template;if(s=this.isImportRules||this.isPublic||u?t.value:this.setDefaultValue(e,!1,!1),"in"!==l&&"notin"!==l||!this.dataColl.length&&!a.values){"in"!==l&&"notin"!==l||(s=(n=this.isImportRules?t.value:this.setDefaultValue(e,!0,!1)).join(","));var p=void 0;p={placeholder:this.l10n.getConstant("SelectValue"),input:this.changeValue.bind(this,i)},this.valueModel&&this.valueModel.textBoxModel&&(p=d({},p,this.valueModel.textBoxModel));var h=new o.TextBox(p);h.appendTo("#"+e+"_valuekey"+i),h.value=s,h.dataBind()}else n=this.isImportRules?t.value:this.setDefaultValue(e,!0,!1),this.renderMultiSelect(a,e,i,n,a.values),"Vertical"===this.displayMode||this.element.className.indexOf("e-device")>-1?r.style.width="100%":(r.style.width=null,r.style.minWidth="200px")},h.prototype.renderNumberValue=function(e,t,l,i,r,n,s){var a=this.getItemData(e),u="string"==typeof a.template,p=this.isImportRules||this.isPublic||u?t.value:this.setDefaultValue(e,!1,!0);if("in"!==l&&"notin"!==l||!this.dataColl.length&&!a.values)if("in"===l||"notin"===l){var h=(p=this.isImportRules?t.value:this.setDefaultValue(e,!0,!1)).join(","),c=void 0;c={placeholder:this.l10n.getConstant("SelectValue"),input:this.changeValue.bind(this,i)},this.valueModel&&this.valueModel.textBoxModel&&(c=d({},c,this.valueModel.textBoxModel));var m=new o.TextBox(c);m.appendTo("#"+e+"_valuekey"+i),m.value=h,m.dataBind()}else{var f=(n=a).validation&&n.validation.min?n.validation.min:0,g=n.validation&&n.validation.max?n.validation.max:Number.MAX_VALUE,v=n.format?n.format:"n";s>1&&t&&(p=t.value[i]?t.value[i]:this.setDefaultValue(e,!0,!0));var y=void 0;y={value:p instanceof Array?p[i]:p,format:v,min:f,max:g,width:"100%",step:n.step?n.step:1,change:this.changeValue.bind(this,i)},this.valueModel&&this.valueModel.numericTextBoxModel&&(y=d({},y,this.valueModel.numericTextBoxModel)),new o.NumericTextBox(y).appendTo("#"+e+"_valuekey"+i)}else p=this.isImportRules?t.value:this.setDefaultValue(e,!0,!1),this.renderMultiSelect(a,e,i,p,a.values),this.element.className.indexOf("e-device")>-1||"Vertical"===this.displayMode?r.style.width="100%":(r.style.minWidth="200px",r.style.width=null)},h.prototype.processValueString=function(e,t){var l=[],i=e.split(",");if("string"===t)return i;for(var r=0,o=i.length;r<o;r++)l.push(Number(i[r]));return l},h.prototype.parseDate=function(e,l){var i,r;if(l){var o=this.intl.getDateParser({skeleton:"full",type:"dateTime"});i=this.getFormat(l),r=o(e),t.isNullOrUndefined(r)&&(r=this.intl.parseDate(e,i))}else r=new Date(e);return r},h.prototype.renderControls=function(e,l,i,r,o){if(t.addClass([e.parentElement.querySelector(".e-rule-value")],"e-value"),t.removeClass([e.parentElement.querySelector(".e-rule-value")],"e-hide"),t.addClass([e.parentElement.querySelector(".e-rule-value")],"e-show"),l.template&&(l.template.create||o))this.processTemplate(e,l,i,r);else{var s;s="boolean"===r.type?this.selectedColumn.values?this.selectedColumn.values.length:2:r.operator&&r.operator.toString().toLowerCase().indexOf("between")>-1?2:1;var a=t.closest(e,".e-rule-container").id,u=void 0,p=r.operator.toString();if(e.className.indexOf("e-rule-operator")>-1||e.className.indexOf("e-rule-filter")>-1){u=e.parentElement.querySelector(".e-rule-value"),this.element.className.indexOf("e-device")>-1||"Vertical"===this.displayMode?u.style.width="100%":"in"!==p&&"notin"!==p?t.addClass([u],"e-custom-value"):t.removeClass([u],"e-custom-value");for(var h=0;h<s;h++)switch(r.type){case"string":this.renderStringValue(a,i,p,h,u);break;case"number":this.renderNumberValue(a,i,p,h,u,l,s);break;case"boolean":this.processBoolValues(l,i,a,h);break;case"date":var c=new Date,m=void 0,f=void 0,g=l.format,v=void 0,y=void 0,C=this.l10n.getConstant("SelectValue"),b="string"==typeof l.template;if(l.field||l.key||!l.value||(c=l.value instanceof Date?l.value:this.parseDate(l.value,l.format)),!l.format&&i&&""!==i.field&&(g=(f=this.getColumn(i.field)).format),(this.isImportRules||this.isPublic||b)&&i&&(g=(f=this.getColumn(i.field)).format,i.value?(m=s>1?i.value[h]:i.value,c=this.parseDate(m,f.format)):c=i.value),g){var S=this.getFormat(g);S.skeleton?(y={locale:this.getLocale(),value:c,placeholder:C,format:S,change:this.changeValue.bind(this,h)},this.valueModel&&this.valueModel.datePickerModel&&(y=d({},y,this.valueModel.datePickerModel)),v=new n.DatePicker(y)):(y={value:c,locale:this.getLocale(),placeholder:C,format:S.format,change:this.changeValue.bind(this,h)},this.valueModel&&this.valueModel.datePickerModel&&(y=d({},y,this.valueModel.datePickerModel)),v=new n.DatePicker(y))}else y={locale:this.getLocale(),value:c,placeholder:C,change:this.changeValue.bind(this,h)},this.valueModel&&this.valueModel.datePickerModel&&(y=d({},y,this.valueModel.datePickerModel)),v=new n.DatePicker(y);if(v.appendTo("#"+a+"_valuekey"+h),!i.value){var x=document.getElementById(a+"_valuekey"+h);this.updateRules(x,c,null,this.isNotValueChange),this.isNotValueChange=!1}}}}},h.prototype.processBoolValues=function(e,i,r,o){var n,s,a=!1;t.isNullOrUndefined(i.type)&&e&&(i.type=e.type);var u;if(e.values){p=e.values;"boolean"!==i.type||t.isNullOrUndefined(i.value)?e.value?a=p[o].toLowerCase()===e.value.toString().toLowerCase():0===o&&(a=!0):a=p[o].toLowerCase()===i.value.toString().toLowerCase(),s=n=u=p[o]}else{var p=[!0,!1];"boolean"!==i.type||t.isNullOrUndefined(i.value)?e.value?a=p[o].toString().toLowerCase()===e.value.toString().toLowerCase():0===o&&(a=!0):a=p[o].toString().toLowerCase()===i.value.toString().toLowerCase(),n=p[o].toString(),s=p[o],u=this.l10n.getConstant(["True","False"][o])}var h;h={label:u,name:r+"default",checked:a,value:n,change:this.changeValue.bind(this,o)},this.valueModel&&this.valueModel.radioButtonModel&&(h=d({},h,this.valueModel.radioButtonModel));var c=new l.RadioButton(h);c.appendTo("#"+r+"_valuekey"+o),a&&this.updateRules(c.element,s,0)},h.prototype.getOperatorIndex=function(e,t){var l,i=e.dataSource.length;for(l=0;l<i;l++)if(t.operator===e.dataSource[l].value)return l;return 0},h.prototype.getPreviousItemData=function(e,t){return this.isFieldClose&&e&&(e=this.getColumn(e.value)),t.template&&e&&Object.keys(e).length<4&&(e.template=t.template),e},h.prototype.renderValues=function(e,l,i,r,o,n,s){var a=e.previousElementSibling.getElementsByTagName("input")[0],u="DropdownTree"===this.fieldMode?t.getComponent(a,"dropdowntree"):t.getComponent(a,"dropdownlist"),d="DropdownTree"===this.fieldMode?this.getColumn(u.value[0]):this.getColumn(u.value);if(this.selectedRule=d,r){var p=t.getComponent(e.querySelector("input"),"dropdownlist");(l=s.id.indexOf("operator")>-1?l:this.selectedRule).operators&&(p.value=null,p.dataBind(),p.dataSource=l.operators,p.index=this.getOperatorIndex(p,o),p.value=n.operator=p.dataSource[p.index].value,p.dataBind())}var h=n.operator.toString(),c=!1;if(h.indexOf("null")>-1||h.indexOf("empty")>-1)(g=e.parentElement.querySelector(".e-rule-value"))&&(t.removeClass([g],"e-show"),t.addClass([g],"e-hide"));else{var m=t.closest(e,".e-rule-container").id;if((i=this.getPreviousItemData(i,d))&&i.template){this.templateDestroy(i,m+"_valuekey0");var f=t.select("#"+m+"_valuekey0",e.nextElementSibling);f&&!f.classList.contains("e-control")&&t.detach(t.select("#"+m+"_valuekey0",e.nextElementSibling)),"string"!=typeof i.template&&void 0!==i.template.create||(e.nextElementSibling.classList.contains("e-template-value")&&this.clearQBTemplate([m]),e.nextElementSibling.innerHTML="")}if(r&&(this.validatValue(o,t.closest(e,".e-rule-container")),this.destroyControls(e)),l.template=d.template,l.template&&(t.addClass([e.nextElementSibling],"e-template-value"),l.template=d.template,c=this.setColumnTemplate(l,m,d.field,l.value||h,e,o)),c){var g=e.parentElement.querySelector(".e-rule-value");this.element.className.indexOf("e-device")>-1||"Vertical"===this.displayMode?g.style.width="100%":g.style.width="200px"}else{t.removeClass([e.nextElementSibling],"e-template-value");var v=1;v="boolean"===n.type?this.selectedColumn.values?this.selectedColumn.values.length:2:h&&h.toLowerCase().indexOf("between")>-1?2:1;for(var y=0;y<v;y++){var C=this.createElement("input",{attrs:{type:"text",id:m+"_valuekey"+y}});e.nextElementSibling.appendChild(C)}}this.renderControls(e,l,o,n,c)}},h.prototype.setColumnTemplate=function(e,l,i,r,o,n){var s,a=this,u=!0;if(e.template){if("string"==typeof e.template||void 0===e.template.create)return s={requestType:"value-template-initialize",ruleID:l,field:i,operator:r,rule:n,renderTemplate:!0},this.trigger("actionBegin",s,function(t){u=a.actionBeginSuccessCallBack(t,e,l,i,o)}),u;var d=void 0,p=e.template;if((d="string"==typeof p.create?t.getValue(p.create,window)({field:i,operator:r}):p.create({field:i,operator:r}))instanceof Element)d.id=l+"_valuekey0",t.addClass([d],"e-template"),o.nextElementSibling.appendChild(d),i.indexOf(" ")<0&&t.addClass([d],"e-"+i);else if(d instanceof Array){t.addClass(d,"e-template");for(var h=0,c=d.length;h<c;h++)d[h].id=l+"_valuekey"+h,o.nextElementSibling.appendChild(d[h])}return t.addClass([o.nextElementSibling],"e-template-value"),!0}return!0},h.prototype.actionBeginSuccessCallBack=function(e,l,i,r,o){if(e.renderTemplate){var n=void 0;this.columnTemplateFn=this.templateParser(l.template);var s=this.element.id+r;if(this.isReact)n=this.columnTemplateFn(e,this,i,s)[0];else if(this.isAngular){var a=this.columnTemplateFn(e,this,i,s);n=3===a[0].nodeType?a[1]:a[0]}else n=this.columnTemplateFn(e,this,"Template",s)[0];return o.nextElementSibling.appendChild(n),t.addClass([o.nextElementSibling],"e-template-value"),this.renderReactTemplates(),!0}return!1},h.prototype.updateValues=function(e,l){var i=1;e.className.indexOf("e-template")>-1&&(i=3);var r=e.className.split(" e-")[i],o=parseInt(e.id.slice(-1),2);switch(r){case"checkbox":var n=t.getComponent(e,r).value;l.value=""!==n?n:void 0;break;case"textbox":case"dropdownlist":l.value=t.getComponent(e,r).value;break;case"radio":var s=t.getComponent(e,r);s.checked&&("boolean"==typeof l.value?l.value="true"===s.value:this.getColumn(l.field).values?l.value=s.value:l.value="true"===s.value),s.refresh();break;case"numerictextbox":l.operator.indexOf("between")>-1?("string"==typeof l.value&&(l.value=[]),l.value[o]=t.getComponent(e,r).value):l.value=t.getComponent(e,r).value;break;case"datepicker":var a=this.getColumn(l.field),u=this.getFormat(a.format),d=t.getComponent(e,r).value;l.operator.indexOf("between")>-1?("string"==typeof l.value&&(l.value=[]),l.value[o]=this.intl.formatDate(d,u)):t.isNullOrUndefined(u.format)&&d?l.value=this.intl.formatDate(d):l.value=d?this.intl.formatDate(d,u):d;break;case"multiselect":l.value=t.getComponent(e,r).value}},h.prototype.updateRules=function(e,l,i,r){for(var o,n,s=t.closest(e,".e-group-container"),a=this.getParentGroup(s),u=t.closest(e,".e-rule-container"),d=0,p=s.id.replace(this.element.id+"_",""),h=this.getValidRules(this.rule);u&&null!==u.previousElementSibling;)u=u.previousElementSibling,d++;var c=a.rules[d].operator?a.rules[d].operator.toString():"",m=(u=t.closest(e,".e-rule-container")).id.replace(this.element.id+"_","");if(t.closest(e,".e-rule-filter")||t.closest(e,".e-rule-sub-filter")){this.subFieldElem&&(e=this.subFieldElem),o="DropdownTree"===this.fieldMode?t.getComponent(e,"dropdowntree"):t.getComponent(e,"dropdownlist");var f="DropdownTree"===this.fieldMode?this.getColumn(o.value[0]):this.getColumn(o.value);!this.isImportRules&&a.rules[d].field&&a.rules[d].field.toLowerCase()!==f.field.toLowerCase()&&(!u.querySelectorAll(".e-template")&&!(c.indexOf("null")>-1)||c.indexOf("empty")>-1)&&(a.rules[d].value=""),this.selectedColumn=this.getColumn(this.selectedColumn.field),a.rules[d].field=this.selectedColumn.field,a.rules[d].type=this.selectedColumn.type,a.rules[d].label=this.selectedColumn.label;var g=t.closest(e,".e-rule-filter"),v=(g=g||t.closest(e,".e-rule-sub-filter")).nextElementSibling.querySelector("input.e-control");v=v||g.nextElementSibling.nextElementSibling.querySelector("input.e-control"),c=t.getComponent(v,"dropdownlist").value.toString(),a.rules[d].operator=c;var y=g.nextElementSibling.nextElementSibling,C=y.querySelectorAll("input.e-control");C.length<1&&(C=y.querySelectorAll("div.e-control")),C.length<1&&(C=y.querySelectorAll(".e-template"));for(var b=0;b<C.length;b++)n={groupID:p,ruleID:m,value:a.rules[d].field,type:"field"},c.indexOf("null")>-1||c.indexOf("empty")>-1?a.rules[d].value=null:this.updateValues(C[b],a.rules[d]);this.isImportRules||this.trigger("change",n),this.allowValidation&&a.rules[d].field&&e.parentElement.className.indexOf("e-tooltip")>-1&&t.getComponent(e.parentElement,"tooltip").destroy(),this.filterRules(h,this.getValidRules(this.rule),"field")}else if(t.closest(e,".e-rule-operator")){o=t.getComponent(e,"dropdownlist"),a.rules[d].operator=o.value.toString();var S=u.querySelectorAll(".e-rule-value input.e-control");n={groupID:p,ruleID:m,value:o.value,type:"operator"},this.allowValidation&&a.rules[d].operator&&e.parentElement.className.indexOf("e-tooltip")>-1&&t.getComponent(e.parentElement,"tooltip").destroy(),S.length>1&&!(S[0].className.indexOf("e-template")>-1)&&(a.rules[d].value=[]);for(var x=0;x<S.length;x++)a.rules[d].operator.indexOf("null")>-1||a.rules[d].operator.indexOf("empty")>-1?a.rules[d].value=null:S[x].classList.contains("e-template")||this.updateValues(S[x],a.rules[d]);this.isImportRules||this.trigger("change",n),this.filterRules(h,this.getValidRules(this.rule),"operator")}else t.closest(e,".e-rule-value")&&(this.ruleValueUpdate(e,l,a,d,s,u,i),r||this.filterRules(h,this.getValidRules(this.rule),"value"))},h.prototype.filterRules=function(e,t,l){JSON.stringify({condition:e.condition,not:e.not,rule:e.rules})!==JSON.stringify({condition:t.condition,not:t.not,rule:t.rules})&&(this.isImportRules||this.trigger("ruleChange",{previousRule:e,rule:t,type:l}))},h.prototype.ruleValueUpdate=function(e,t,l,i,r,o,n){var s,a,u=["in","between","notin","notbetween"];if(l.rules[i].operator&&(a=l.rules[i].operator.toString().toLowerCase()),null!==t){if(e.className.indexOf("e-multiselect")>-1&&"number"===l.rules[i].type&&!this.isNotified){for(var d=[],p=t,h=0,c=p.length;h<c;h++)"string"==typeof p[h]&&d.push(parseFloat(p[h]));d.length&&(t=d)}if(this.isNotified)l.rules[i].value=t,s={groupID:r.id,ruleID:o.id,value:l.rules[i].value,type:"value"},this.isImportRules||this.trigger("change",s);else if(e.className.indexOf("e-spin")>-1||e.className.indexOf("e-numeric")>-1)u.indexOf(a)>-1?l.rules[i].value[n]=t:l.rules[i].value=t;else if(e.className.indexOf("e-radio")>-1)l.rules[i].value=t;else if(e.className.indexOf("e-multiselect")>-1)l.rules[i].value=t;else if(e.className.indexOf("e-textbox")>-1)"in"===a||"notin"===a?(l.rules[i].type,l.rules[i].value=this.processValueString(t,l.rules[i].type)):l.rules[i].value=t;else if(e.className.indexOf("e-datepicker")>-1){var m=this.getFormat(this.getColumn(this.selectedColumn.field).format);m.type&&(u.indexOf(a)>-1?("string"==typeof l.rules[i].value&&(l.rules[i].value=[]),l.rules[i].value[n]=this.intl.formatDate(t,m)):l.rules[i].value=this.intl.formatDate(t,m))}this.validatValue(l,o,i)}else e.className.indexOf("e-datepicker")>-1&&u.indexOf(a)>-1?("string"==typeof l.rules[i].value&&(l.rules[i].value=[]),l.rules[i].value[n]=t):l.rules[i].value=t},h.prototype.validatValue=function(e,l,i){t.isNullOrUndefined(i)||(e=e.rules[i]);var r="object"==typeof e.value;if(this.allowValidation&&(t.isNullOrUndefined(i)||(r?e.value.length>0:e.value))){var o=l.querySelectorAll(".e-rule-value .e-control");o.length>0&&(o[0].className.indexOf("e-tooltip")>-1?t.getComponent(o[0],"tooltip").destroy():o[0].parentElement.className.indexOf("e-tooltip")>-1&&t.getComponent(o[0].parentElement,"tooltip").destroy(),o[1]&&o[1].parentElement.className.indexOf("e-tooltip")>-1&&t.getComponent(o[1].parentElement,"tooltip").destroy())}},h.prototype.getFormat=function(e){var t;return e?"string"==typeof e?(t={type:"dateTime"},"short"===e||"yMd"===e?(t.type="date",t.skeleton=e):t.format=e):t={type:"dateTime",skeleton:e.skeleton}:t={type:"date",skeleton:"yMd"},t},h.prototype.findGroupByIdx=function(e,t,l){var i=t.rules,r=[];if(!l){for(var o=0,n=i.length;o<n;o++)(t=i[o]).rules&&r.push(t);return r[e]}return t},h.prototype.destroy=function(){if(this.isDestroy=!0,this.element){var l,i,r,o;for(e.prototype.destroy.call(this),r=(l=this.element.querySelectorAll(".e-addrulegroup")).length,i=0;i<r;i++)t.getComponent(l[i],"dropdown-btn").destroy(),t.detach(l[i]);for(o=this.element.querySelectorAll(".e-rule-filter .e-control.e-tooltip"),i=0;i<o.length;i++)t.getComponent(o[i],"tooltip").destroy();for(r=(l=this.element.querySelectorAll(".e-rule-filter .e-control:not(.e-tooltip)")).length,i=0;i<r;i++)t.getComponent(l[i],"dropdownlist")?t.getComponent(l[i],"dropdownlist").destroy():t.getComponent(l[i],"dropdowntree").destroy(),t.detach(l[i]);for(o=this.element.querySelectorAll(".e-rule-operator .e-control.e-tooltip"),i=0;i<o.length;i++)t.getComponent(o[i],"tooltip").destroy();for(r=(l=this.element.querySelectorAll(".e-rule-operator .e-control:not(.e-tooltip)")).length,i=0;i<r;i++)t.getComponent(l[i],"dropdownlist")&&(t.getComponent(l[i],"dropdownlist").destroy(),t.detach(l[i]));for(o=this.element.querySelectorAll(".e-rule-value .e-control.e-tooltip"),i=0;i<o.length;i++)t.getComponent(o[i],"tooltip").destroy();this.isImportRules=!1,this.unWireEvents(),this.levelColl[this.element.id+"_group0"]=[0],this.element.innerHTML="",this.portals&&this.portals.length&&this.clearQBTemplate(),t.classList(this.element,[],["e-rtl","e-responsive","e-device"]),this.isDestroy=!1}},h.prototype.addRules=function(e,t){t=this.element.id+"_"+t,this.isPublic=!0;for(var l=0,i=e.length;l<i;l++)this.addRuleElement(document.getElementById(t),e[l]);this.isPublic=!1},h.prototype.addGroups=function(e,t){if(this.isAddSuccess||this.element.querySelectorAll(".e-group-container").length<=this.maxGroupCount){t=this.element.id+"_"+t;var l=document.getElementById(t),i=this.getParentGroup(l);if(e.length){this.isPublic=!0;for(var r=0,o=e.length;r<o;r++)this.updatedRule={condition:e[r].condition,not:e[r].not},this.importRules(e[r],l,!1,e[r].not);this.isPublic=!1}else{var n="and",s=!1;this.updatedRule&&(n=this.updatedRule.condition,s=this.updatedRule.not),this.enableNotCondition?i.rules.push({condition:n,not:s,rules:[]}):i.rules.push({condition:n,rules:[]})}this.headerTemplate||this.disableRuleCondition(l,i)}},h.prototype.initWrapper=function(){if(this.isInitialLoad=!0,this.cssClass&&t.addClass([this.element],this.cssClass),this.enableRtl&&t.addClass([this.element],"e-rtl"),this.width&&(this.element.style.width=this.width),this.height&&(this.element.style.height=this.height),this.rule.rules.length?this.isImportRules=!0:this.addGroupElement(!1,this.element),t.Browser.isDevice||"Vertical"===this.displayMode?(t.Browser.isDevice&&(this.element.style.width="100%",this.element.classList.add("e-device")),t.removeClass(this.element.querySelectorAll(".e-rule-container"),"e-horizontal-mode"),t.addClass(this.element.querySelectorAll(".e-rule-container"),"e-vertical-mode"),this.displayMode="Vertical"):this.displayMode="Horizontal",this.summaryView)this.isImportRules?this.renderSummary():this.renderSummaryCollapse();else{if(this.columns.length&&this.isImportRules){this.addGroupElement(!1,this.element,this.rule.condition,!1,this.rule.not,!1,this.rule);var e=t.extend({},this.rule,{},!0);this.isRefreshed=!0,this.setGroupRules(e),this.isRefreshed=!1}else this.columns.length&&this.addRuleElement(this.element.querySelector(".e-group-container"),{});this.notGroupRtl(),this.readonly&&this.enableReadonly();for(var l=this.element.querySelectorAll("label.e-btn"),i=void 0,r=0;r<l.length;r++)i=l.item(r),t.rippleEffect(i,{selector:".e-btn"})}},h.prototype.renderSummary=function(){var e=this.createElement("div",{attrs:{class:"e-summary-content",id:this.element.id+"_summary_content"}}),t=this.createElement("textarea",{attrs:{class:"e-summary-text",readonly:"true"},styles:"max-height:500px"}),l=this.createElement("button",{attrs:{type:"button",class:"e-edit-rule e-css e-btn e-small e-flat e-primary"}}),i=this.createElement("div",{attrs:{class:"e-summary-btndiv"}});e.appendChild(t),t.textContent=this.getSqlFromRules(this.rule),l.textContent=this.l10n.getConstant("Edit"),i.appendChild(l),e.appendChild(i),this.element.appendChild(e)},h.prototype.renderSummaryCollapse=function(){var e=this.createElement("div",{attrs:{class:"e-collapse-rule e-icons",title:this.l10n.getConstant("SummaryViewTitle")}});this.element.querySelector(".e-group-header").appendChild(e)},h.prototype.columnSort=function(){"descending"===this.sortDirection.toLowerCase()?this.columns=new r.DataManager(this.columns).executeLocal((new r.Query).sortByDesc("field")):"ascending"===this.sortDirection.toLowerCase()&&(this.columns=new r.DataManager(this.columns).executeLocal((new r.Query).sortBy("field")))},h.prototype.onChangeNotGroup=function(){if(this.element.innerHTML="",this.groupIdCounter=0,!this.headerTemplate)if(this.enableNotCondition){if(this.enableNotCondition){var e=this.createElement("button",{attrs:{type:"button",class:"e-qb-toggle"}});this.groupElem.querySelector(".e-btn-group").insertBefore(e,this.groupElem.querySelector(".e-btngroup-and"))}}else this.groupElem.querySelector(".e-qb-toggle").remove();this.rule=this.checkNotGroup(this.rule),this.initWrapper()},h.prototype.notGroupRtl=function(){this.enableRtl?t.addClass(this.element.querySelectorAll(".e-btn-group"),"e-rtl"):t.removeClass(this.element.querySelectorAll(".e-btn-group"),"e-rtl")},h.prototype.checkNotGroup=function(e){var l;if(e.rules)for(var i=0;i<e.rules.length;i++)l=e.rules[i],l=this.checkNotGroup(l),e.rules[i]=l;return t.isNullOrUndefined(e.not)?this.enableNotCondition&&!t.isNullOrUndefined(e.condition)&&(e.not=!1):(this.enableNotCondition&&(e.not=!1),delete e.not),e},h.prototype.onPropertyChanged=function(e,l){for(var i=0,r=Object.keys(e);i<r.length;i++)switch(r[i]){case"summaryView":var o=this.element.querySelector(".e-group-container"),n=this.element.querySelector(".e-summary-content");e.summaryView?(o.style.display="none",this.element.querySelectorAll(".e-summary-content").length<1?(this.renderSummary(),n=this.element.querySelector(".e-summary-content")):this.element.querySelector(".e-summary-text").textContent=this.getSqlFromRules(this.rule),n.style.display="block"):(o.querySelectorAll(".e-collapse-rule").length>-1&&this.renderSummaryCollapse(),o.style.display="block",n.style.display="none");break;case"displayMode":this.refresh();break;case"showButtons":e.showButtons.ruleDelete?t.removeClass(this.element.querySelectorAll(".e-rule-delete"),"e-button-hide"):t.addClass(this.element.querySelectorAll(".e-rule-delete"),"e-button-hide"),e.showButtons.groupDelete?t.removeClass(this.element.querySelectorAll(".e-deletegroup"),"e-button-hide"):t.addClass(this.element.querySelectorAll(".e-deletegroup"),"e-button-hide");break;case"cssClass":l.cssClass&&t.removeClass([this.element],l.cssClass.split(" ")),e.cssClass&&t.addClass([this.element],e.cssClass.split(" "));break;case"enableRtl":e.enableRtl?(t.addClass([this.element],"e-rtl"),this.notGroupRtl()):(t.removeClass([this.element],"e-rtl"),this.notGroupRtl());break;case"enablePersistence":this.enablePersistence=e.enablePersistence;break;case"dataSource":this.dataSource=e.dataSource,this.refresh();break;case"columns":this.columns=e.columns,this.columnSort();break;case"sortDirection":this.sortDirection=e.sortDirection,this.columnSort();break;case"maxGroupCount":this.maxGroupCount=e.maxGroupCount;break;case"height":this.height=e.height,this.element.style.height=this.height;break;case"rule":this.rule=e.rule,e.rule=this.getRuleCollection(this.rule,!1);break;case"width":this.width=e.width,this.element.style.width=this.width;break;case"locale":this.locale=e.locale,this.intl=new t.Internationalization(this.locale),this.isLocale=!0,this.refresh(),this.isLocale=!1;break;case"enableNotCondition":this.onChangeNotGroup();break;case"readonly":this.isReadonly=e.readonly,this.enableReadonly()}},h.prototype.preRender=function(){this.element.id=this.element.id||t.getUniqueID("ej2-querybuilder"),this.defaultLocale={StartsWith:"Starts With",EndsWith:"Ends With",Contains:"Contains",Equal:"Equal",NotEqual:"Not Equal",LessThan:"Less Than",LessThanOrEqual:"Less Than Or Equal",GreaterThan:"Greater Than",GreaterThanOrEqual:"Greater Than Or Equal",Between:"Between",NotBetween:"Not Between",In:"In",NotIn:"Not In",Remove:"REMOVE",SelectField:"Select a field",SelectOperator:"Select operator",DeleteRule:"Remove this condition",DeleteGroup:"Delete group",AddGroup:"Add Group",AddCondition:"Add Condition",Edit:"EDIT",ValidationMessage:"This field is required",SummaryViewTitle:"Summary View",OtherFields:"Other Fields",AND:"AND",OR:"OR",NOT:"NOT",SelectValue:"Enter Value",IsEmpty:"Is Empty",IsNotEmpty:"Is Not Empty",IsNull:"Is Null",IsNotNull:"Is Not Null",True:"true",False:"false",AddButton:"Add Group/Condition"},this.l10n=new t.L10n("querybuilder",this.defaultLocale,this.locale),this.intl=new t.Internationalization(this.locale),this.groupIdCounter=0,this.subFilterCounter=0,this.ruleIdCounter=0,this.btnGroupId=0,this.isImportRules=!1,this.parser=[],this.customOperators={stringOperator:[{value:"startswith",key:this.l10n.getConstant("StartsWith")},{value:"endswith",key:this.l10n.getConstant("EndsWith")},{value:"contains",key:this.l10n.getConstant("Contains")},{value:"equal",key:this.l10n.getConstant("Equal")},{value:"notequal",key:this.l10n.getConstant("NotEqual")},{value:"in",key:this.l10n.getConstant("In")},{value:"notin",key:this.l10n.getConstant("NotIn")},{value:"isempty",key:this.l10n.getConstant("IsEmpty")},{value:"isnotempty",key:this.l10n.getConstant("IsNotEmpty")}],dateOperator:[{value:"equal",key:this.l10n.getConstant("Equal")},{value:"greaterthan",key:this.l10n.getConstant("GreaterThan")},{value:"greaterthanorequal",key:this.l10n.getConstant("GreaterThanOrEqual")},{value:"lessthan",key:this.l10n.getConstant("LessThan")},{value:"lessthanorequal",key:this.l10n.getConstant("LessThanOrEqual")},{value:"notequal",key:this.l10n.getConstant("NotEqual")}],booleanOperator:[{value:"equal",key:this.l10n.getConstant("Equal")},{value:"notequal",key:this.l10n.getConstant("NotEqual")}],numberOperator:[{value:"equal",key:this.l10n.getConstant("Equal")},{value:"greaterthanorequal",key:this.l10n.getConstant("GreaterThanOrEqual")},{value:"greaterthan",key:this.l10n.getConstant("GreaterThan")},{value:"between",key:this.l10n.getConstant("Between")},{value:"lessthan",key:this.l10n.getConstant("LessThan")},{value:"notbetween",key:this.l10n.getConstant("NotBetween")},{value:"lessthanorequal",key:this.l10n.getConstant("LessThanOrEqual")},{value:"notequal",key:this.l10n.getConstant("NotEqual")},{value:"in",key:this.l10n.getConstant("In")},{value:"notin",key:this.l10n.getConstant("NotIn")}]},this.operators={equal:"=",notequal:"!=",greaterthan:">",greaterthanorequal:">=",lessthan:"<",in:"IN",notin:"NOT IN",lessthanorequal:"<=",startswith:"LIKE",endswith:"LIKE",between:"BETWEEN",notbetween:"NOT BETWEEN",contains:"LIKE",isnull:"IS NULL",isnotnull:"IS NOT NULL",isempty:"IS EMPTY",isnotempty:"IS NOT EMPTY",notstartswith:"NOT LIKE",notendswith:"NOT LIKE",notcontains:"NOT LIKE"},this.fields||(this.fields={text:"label",value:"field"})},h.prototype.render=function(){this.levelColl={},this.items=[{text:this.l10n.getConstant("AddGroup"),iconCss:"e-icons e-add-icon e-addgroup"},{text:this.l10n.getConstant("AddCondition"),iconCss:"e-icons e-add-icon e-addrule"}],this.ruleElem=this.ruleTemplate(),this.groupElem=this.groupTemplate();var e=[{value:"isnull",key:this.l10n.getConstant("IsNull")},{value:"isnotnull",key:this.l10n.getConstant("IsNotNull")}],t=[{value:"isnull",key:this.l10n.getConstant("IsNull")},{value:"isnotnull",key:this.l10n.getConstant("IsNotNull")}];this.customOperators.stringOperator=this.customOperators.stringOperator.concat(e),this.customOperators.numberOperator=this.customOperators.numberOperator.concat(t),this.dataSource instanceof r.DataManager?(this.dataManager=this.dataSource,this.executeDataManager((new r.Query).take(1))):(this.dataManager=new r.DataManager(this.dataSource),this.dataColl=this.dataManager.executeLocal(new r.Query),this.initControl()),this.renderComplete()},h.prototype.templateParser=function(e){if(e)try{if(document.querySelectorAll(e).length)return t.compile(document.querySelector(e).innerHTML.trim())}catch(l){return t.compile(e)}},h.prototype.executeDataManager=function(e){var t=this,l=this.dataManager.executeQuery(e),i=new r.Deferred;l.then(function(e){e.actual&&e.actual.result?t.dataColl=e.actual.result:t.dataColl=e.result,t.initControl()}).catch(function(e){i.reject(e)})},h.prototype.initControl=function(){this.initialize(),this.initWrapper(),this.wireEvents()},h.prototype.wireEvents=function(){var e=this.getWrapper();t.EventHandler.add(e,"click",this.clickEventHandler,this),t.EventHandler.add(e,"focusout",this.focusEventHandler,this),t.EventHandler.add(e,"focusin",this.focusEventHandler,this),t.EventHandler.add(this.element,"keydown",this.keyBoardHandler,this)},h.prototype.unWireEvents=function(){var e=this.getWrapper();t.EventHandler.remove(e,"click",this.clickEventHandler),t.EventHandler.remove(e,"focusout",this.focusEventHandler),t.EventHandler.remove(e,"focusin",this.focusEventHandler),t.EventHandler.remove(this.element,"keydown",this.keyBoardHandler)},h.prototype.getParentGroup=function(e,t){for(var l=e instanceof Element?this.levelColl[e.id]:this.levelColl[e],i=t?l.length-1:l.length,r=this.rule,o=0;o<i;o++)r=this.findGroupByIdx(l[o],r,0===o);return r},h.prototype.deleteGroup=function(e){var t,l=this,i=e;"string"==typeof e?(t=this.element.id+"_"+e,e=document.getElementById(t)):t=i.id.replace(this.element.id+"_","");var r={groupID:t,cancel:!1,type:"deleteGroup"};this.isImportRules?this.deleteGroupSuccessCallBack(r,e):this.trigger("beforeChange",r,function(t){l.deleteGroupSuccessCallBack(t,e)})},h.prototype.deleteGroupSuccessCallBack=function(e,l){if(!e.cancel){var i=l,r=this.getParentGroup(i,!0),o=0,n=void 0,s=void 0,a=this.getValidRules(this.rule),u=i.nextElementSibling,d=i.previousElementSibling,p=i.querySelectorAll(".e-group-container"),h=i.querySelectorAll(".e-tooltip");for(s=h.length,n=0;n<s;n++)t.getComponent(h[n],"tooltip").destroy();for(n=0,s=p.length;n<s;n++)delete this.levelColl[p[n].id];for(;null!==i.previousElementSibling;)i=i.previousElementSibling,o++;u&&u.className.indexOf("e-separate-rule")>-1&&(t.removeClass([u],"e-separate-rule"),t.addClass([u],"e-joined-rule"),d&&d.className.indexOf("e-rule-container")>-1&&t.addClass([d],"e-prev-joined-rule"));var c=i.parentElement.parentElement.parentElement,m=[];if(this.isReact||this.isAngular){var f=r.rules[o],g=l.querySelectorAll(".e-rule-container");if(f&&f.rules)for(var v=0;v<f.rules.length;v++){var y=this.getColumn(f.rules[v].field),C=g[v].querySelector(".e-template-value");y&&(y.ruleTemplate||this.isPlatformTemplate(y)&&C)&&m.push(g[v].id)}}t.detach(l),this.headerTemplate&&this.clearQBTemplate([l.id]),m.length&&this.clearQBTemplate(m),r.rules.splice(o,1),delete this.levelColl[e.groupID],this.refreshLevelColl(),this.disableRuleCondition(c,r),this.isImportRules||this.trigger("change",e),this.filterRules(a,this.getValidRules(this.rule),"deleteGroup")}},h.prototype.isPlatformTemplate=function(e){return e.template&&("string"==typeof e.template||void 0===e.template.create)},h.prototype.deleteRule=function(e){var l=this,i={groupID:t.closest(e,".e-group-container").id.replace(this.element.id+"_",""),ruleID:t.closest(e,".e-rule-container").id.replace(this.element.id+"_",""),cancel:!1,type:"deleteRule"};this.isImportRules?this.deleteRuleSuccessCallBack(i,e):this.trigger("beforeChange",i,function(t){l.deleteRuleSuccessCallBack(t,e)})},h.prototype.deleteRuleSuccessCallBack=function(e,l){if(!e.cancel){var i=t.closest(l,".e-group-container"),r=this.getParentGroup(i),o=t.closest(l,".e-rule-container"),n=this.getValidRules(this.rule),s=o,a=o.nextElementSibling,u=o.previousElementSibling,d=0,p=o.querySelectorAll(".e-tooltip"),h=void 0,c=p.length;for(h=0;h<c;h++)t.getComponent(p[h],"tooltip").destroy();for(;null!==o.previousElementSibling;)o=o.previousElementSibling,d++;var m=this.getColumn(r.rules[d].field);m&&m.template&&s.querySelector(".e-template")&&this.templateDestroy(m,s.querySelector(".e-template").id),(!u||u.className.indexOf("e-rule-container")<0)&&a&&t.removeClass([a],"e-joined-rule"),(!a||a.className.indexOf("e-rule-container")<0)&&u&&t.removeClass([u],"e-prev-joined-rule");var f=s.querySelector(".e-template-value");try{t.detach(s)}catch(e){}m&&m.ruleTemplate&&this.clearQBTemplate([s.id]),m&&this.isPlatformTemplate(m)&&f&&this.clearQBTemplate([s.id]),r.rules.splice(d,1),r.rules[0]&&r.rules[0].rules||this.disableRuleCondition(i,r),this.isImportRules||this.trigger("change",e),this.filterRules(n,this.getValidRules(this.rule),"deleteRule")}},h.prototype.setGroupRules=function(e,t){this.headerTemplate&&t&&(this.isRoot=!0),this.reset(),this.groupIdCounter=1,this.ruleIdCounter=0,this.isImportRules=!0,this.rule=e,e=this.getRuleCollection(this.rule,!1),this.importRules(this.rule,this.element.querySelector(".e-group-container"),!0,this.rule.not,t),this.isImportRules=!1},h.prototype.keyBoardHandler=function(e){!this.readonly||38!==e.keyCode&&40!==e.keyCode&&13!==e.keyCode||e.preventDefault()},h.prototype.clearQBTemplate=function(e){(this.isReact||this.isAngular)&&this.clearTemplate(e)},h.prototype.disableRuleCondition=function(e,t){if(!this.headerTemplate){if(this.readonly)return;var l=e.querySelector(".e-rule-list").childElementCount,i=e.querySelector(".e-btngroup-and"),r=e.querySelector(".e-btngroup-or");l>1?(i.disabled=!1,r.disabled=!1,(r.nextElementSibling.classList.contains("e-btn-disable")||i.nextElementSibling.classList.contains("e-btn-disable"))&&(r.nextElementSibling.classList.remove("e-btn-disable"),i.nextElementSibling.classList.remove("e-btn-disable")),t&&"or"===t.condition?r.checked=!0:i.checked=!0):(i.checked=!1,i.disabled=!0,r.checked=!1,r.disabled=!0,t&&(r.nextElementSibling.classList.add("e-btn-disable"),i.nextElementSibling.classList.add("e-btn-disable")))}},h.prototype.getValidRules=function(e){e||(e=this.getRules());var l=e.condition,i=e.not,r=t.extend([],e.rules,[],!0);return this.getRuleCollection({condition:l,rules:r,not:i},!0)},h.prototype.getRuleCollection=function(e,l){if(t.isNullOrUndefined(e))return null;var i;if(e.rules&&e.rules.length&&(Object.keys(e.rules[0]).length>6||l))for(var r=e.rules.length,o=0;o<r;o++)i=e.rules[o],i=this.getRuleCollection(i,l),e.rules[o]=i,Object.keys(i).length<1&&l&&(e.rules.splice(o,1),o--,r--);var n=e.custom;if(e.field&&""!==e.field&&(t.isNullOrUndefined(n)||n&&"question"!==n.type&&"answer"!==n.type))if(e.operator&&(e.operator.toString().indexOf("null")>-1||e.operator.toString().indexOf("empty")>-1)&&(e.value=null),this.isRefreshed&&this.enablePersistence||""!==this.rule.field&&""!==e.operator&&""!==e.value&&void 0!==e.value||n&&n.isQuestion){var s=e.condition;e={label:e.label,field:e.field,operator:e.operator,type:e.type,value:e.value},s&&(e.condition=s),n&&(e.custom=n)}else e={};else if(!n||"question"!==n.type&&"answer"!==n.type)e=t.isNullOrUndefined(e.condition)&&t.isNullOrUndefined(e.rules)?{label:"",field:"",operator:"",type:"",value:""}:this.enableNotCondition?{condition:e.condition,rules:e.rules,not:e.not}:{condition:e.condition,rules:e.rules};else{var a=e.not;(e={label:e.label,field:e.field,operator:e.operator,type:e.type,value:e.value,condition:e.condition,rules:e.rules}).custom=n,this.enableNotCondition&&(e.not=a)}return e},h.prototype.setRules=function(e){var l=t.extend({},e,{},!0);this.headerTemplate?this.setGroupRules(l,!0):this.setGroupRules(l)},h.prototype.getRules=function(){var e;return e=this.enableNotCondition?{condition:this.rule.condition,rules:this.rule.rules,not:this.rule.not}:{condition:this.rule.condition,rules:this.rule.rules},this.rule.custom&&(e.custom=this.rule.custom),e},h.prototype.getRule=function(e){var l,i,r=0;e instanceof HTMLElement?l=t.closest(e,".e-rule-container"):(i=this.element.id+"_"+e,l=document.getElementById(i));for(var o=t.closest(l,".e-group-container"),n=this.getParentGroup(o);null!==l.previousElementSibling;)l=l.previousElementSibling,r++;return n.rules[r]},h.prototype.getGroup=function(e){e instanceof Element&&e.className.indexOf("e-group-container")<1&&(e=t.closest(e,".e-group-container"));var l=e instanceof Element?e.id:this.element.id+"_"+e;return this.getParentGroup(l)},h.prototype.deleteGroups=function(e){var t,l,i=e.length;for(t=0;t<i;t++)l=this.element.id+"_"+e[t],this.deleteGroup(document.getElementById(l))},h.prototype.getFilteredRecords=function(){var e=this.getPredicate(this.getValidRules(this.rule)),l=t.isNullOrUndefined(e)?new r.Query:(new r.Query).where(e);return this.dataManager.executeQuery(l)},h.prototype.deleteRules=function(e){var t,l,i=e.length;for(t=0;t<i;t++)l=this.element.id+"_"+e[t],this.deleteRule(document.getElementById(l))},h.prototype.getDataManagerQuery=function(e){for(var t=this.getPredicate(e),l=[],i=0,o=Object.keys(this.columns);i<o.length;i++)l.push(this.columns[i].field);return e.rules.length?(new r.Query).select(l).where(t):(new r.Query).select(l)},h.prototype.getPredicate=function(e){var l,i,o,n,s=e.rules,a=!1,u=["notcontains","notstartswith","notendswith"];if(!s)return l;for(var d=0,p=s.length;d<p;d++)if(a=!1,Object.keys(s[d]).indexOf("rules")>-1&&s[d].rules)(i=this.getPredicate(s[d]))&&(l=l?"and"===e.condition?l.and(i):l.or(i):i);else if(!t.isNullOrUndefined(s[d].operator)&&!t.isNullOrUndefined(s[d].operator.length)){var h=s[d].operator.toLowerCase(),c=!1,m=["equal","notequal","greaterthan","greaterthanorequal","lessthan","lessthanorequal"];if("string"===s[d].type&&(a=!this.matchCase),"date"===s[d].type&&m.indexOf(h)>-1&&(a=!0),n=this.getColumn(s[d].field),h.indexOf("null")>-1||h.indexOf("empty")>-1)s[d].value=null;else if("date"!==s[d].type||s[d].value instanceof Array)o=s[d].value;else{var f=this.getFormat(n.format);t.isNullOrUndefined(s[d].value)?o=null:(o=this.getDate(s[d].value,f),m.indexOf(h)>-1&&!this.isTime(s[d].value)&&(c=!0))}if(0===d)c||(h.indexOf("in")>-1||h.indexOf("between")>-1||h.indexOf("null")>-1||h.indexOf("empty")>-1)&&h.indexOf("contains")<0?l=c?this.datePredicate(s[d],o):this.arrayPredicate(s[d]):""!==(g=o)&&u.indexOf(h)<0&&(l=new r.Predicate(s[d].field,s[d].operator,o,a));else{if(u.indexOf(h)>-1)continue;if(c||(h.indexOf("in")>-1||h.indexOf("between")>-1||h.indexOf("null")>-1||h.indexOf("empty")>-1)&&h.indexOf("contains")<0)l=c?this.datePredicate(s[d],o,l,e.condition):this.arrayPredicate(s[d],l,e.condition);else if("and"===e.condition){g=o;l&&""!==g?l=l.and(s[d].field,s[d].operator,o,a):""!==g&&(l=new r.Predicate(s[d].field,s[d].operator,o,a))}else{var g=o;l&&""!==g?l=l.or(s[d].field,s[d].operator,o,a):""!==g&&(l=new r.Predicate(s[d].field,s[d].operator,o,a))}}}return l},h.prototype.getLocale=function(){var e=this.locale;return t.getValue("main."+this.locale+".dates.calendars.gregorian.days.format.short",t.cldrData)||(e="en"),e},h.prototype.getColumn=function(e,t){for(var l,i=this.columns,r=0,o=(i=t||i).length;r<o;r++){if(i[r].field===e){l=i[r];break}if(i[r].columns){if(l=this.getColumn(e,i[r].columns))break}else if(e.indexOf(this.separator)>-1&&i[r].field===e.split(this.separator)[0]){l=i[r];break}}return l},h.prototype.getOperators=function(e){return this.getColumn(e).operators},h.prototype.setTime=function(e,t){return t?e.setHours(0,0,0):e.setHours(23,59,59),e},h.prototype.datePredicate=function(e,t,l,i){var o,n=this.setTime(new Date(t.getTime()),!0),s=this.setTime(t);switch(e.operator){case"equal":o=(o=new r.Predicate(e.field,"greaterthanorequal",n)).and(e.field,"lessthanorequal",s);break;case"notequal":o=(o=new r.Predicate(e.field,"lessthan",n)).or(e.field,"greaterthan",s);break;case"greaterthan":o=new r.Predicate(e.field,"greaterthan",s);break;case"greaterthanorequal":o=new r.Predicate(e.field,"greaterthanorequal",n);break;case"lessthan":o=new r.Predicate(e.field,"lessthan",n);break;case"lessthanorequal":o=new r.Predicate(e.field,"lessthanorequal",s)}return o&&(l?"and"===i?l=l.and(o):"or"===i&&(l=l.or(o)):l=o),l},h.prototype.arrayPredicate=function(e,t,l){var i,o=e.value,n=e.operator.toString(),s=e.value,a=this.getColumn(e.field),u=this.getFormat(a.format);if(n.indexOf("null")>-1||n.indexOf("empty")>-1)switch(n){case"isnull":i=new r.Predicate(e.field,"isnull",s);break;case"isnotnull":i=new r.Predicate(e.field,"notnull",s);break;case"isempty":i=new r.Predicate(e.field,"equal","");break;case"isnotempty":i=new r.Predicate(e.field,"notequal","")}if(!(n.indexOf("null")>-1||n.indexOf("empty")>-1))for(var d=0,p=o.length;d<p;d++)if(""!==o[d]||("in"===n||"notin"===n)&&"string"===a.type)if(0===d){var h="greaterthanorequal";switch(n){case"between":i="date"!==a.type?new r.Predicate(e.field,h,o[d]):new r.Predicate(e.field,h,o[d]?this.isTime(o[d])?this.getDate(o[d],u):this.setTime(this.getDate(o[d],u),!0):null);break;case"notbetween":i="date"===a.type?new r.Predicate(e.field,"lessthan",o[d]?this.isTime(o[d])?this.getDate(o[d],u):this.setTime(this.getDate(o[d],u),!0):null):new r.Predicate(e.field,"lessthan",o[d]);break;case"in":i=new r.Predicate(e.field,"equal",o[d]);break;case"notin":i=new r.Predicate(e.field,"notequal",o[d])}}else{switch(e.operator){case"between":i="date"===a.type?i.and(e.field,"lessthanorequal",o[d]?this.isTime(o[d])?this.getDate(o[d],u):this.setTime(this.getDate(o[d],u)):o[d]):i.and(e.field,"lessthanorequal",o[d]);break;case"notbetween":i="date"===a.type?i.or(e.field,"greaterthan",o[d]?this.isTime(o[d])?this.getDate(o[d],u):this.setTime(this.getDate(o[d],u)):o[d]):i.or(e.field,"greaterthan",o[d]);break;case"in":i=i.or(e.field,"equal",o[d]);break;case"notin":i=i.and(e.field,"notequal",o[d])}}return i&&(t?"and"===l?t=t.and(i):"or"===l&&(t=t.or(i)):t=i),t},h.prototype.getDate=function(e,t){var l=this.intl.parseDate(e,t);return e.indexOf(":")>-1&&e.indexOf("/")<0&&e.indexOf(",")<0&&e.indexOf("-")<0&&((l=new Date).setHours(parseInt(e.split(":")[0])),l.setMinutes(parseInt(e.split(":")[1])),e.split(":")[2]&&l.setSeconds(parseInt(e.split(":")[2]))),l},h.prototype.isTime=function(e){return!!(e&&e.indexOf(":")>-1)},h.prototype.importRules=function(e,l,i,r,o){if(i){if(e.rules.length>1&&!this.headerTemplate){var n=l.querySelector(".e-btngroup-or"),s=l.querySelector(".e-btngroup-and");n.disabled=!1,s.disabled=!1,"or"===e.condition?n.checked=!0:s.checked=!0}else this.disableRuleCondition(l);if(this.headerTemplate&&o&&(l=this.renderGroup(e,e.condition,this.element,e.not,o)),this.enableNotCondition&&!this.headerTemplate){var a=l.querySelector(".e-qb-toggle");e.not?t.addClass([a],"e-active-toggle"):t.removeClass([a],"e-active-toggle")}}else l=this.renderGroup(e,e.condition,l,r);var u=e.rules;if(!t.isNullOrUndefined(u))for(var d=0,p=u.length;d<p;d++){var h=Object.keys(u[d]);!t.isNullOrUndefined(u[d].rules)&&h.indexOf("rules")>-1&&0!==u[d].rules.length?(l=this.renderGroup(u[d],u[d].condition,l,u[d].not),l=this.importRules(u[d],l,!0)):this.renderRule(u[d],l)}return(l=t.closest(l,".e-rule-list"))&&(l=t.closest(l,".e-group-container")),l},h.prototype.renderGroup=function(e,t,l,i,r){this.addGroupElement(!0,l,t,!1,i,r,e);var o=l.querySelectorAll(".e-group-container");return o[o.length-1]},h.prototype.renderRule=function(e,t){t.className.indexOf("e-group-container")>-1?this.addRuleElement(t,e):this.addRuleElement(t.querySelector(".e-group-container"),e)},h.prototype.enableReadonly=function(){for(var e=this.element.querySelectorAll(".e-dropdownlist, .e-numerictextbox, .e-textbox, .e-datepicker, .e-multiselect .e-lib, .e-radio"),r=0;r<e.length;r++)e[r].classList.contains("e-dropdownlist")?t.getInstance(e[r],i.DropDownList).readonly=this.isReadonly:e[r].classList.contains("e-numerictextbox")?t.getInstance(e[r],o.NumericTextBox).readonly=this.isReadonly:e[r].classList.contains("e-textbox")?t.getInstance(e[r],o.TextBox).readonly=this.isReadonly:e[r].classList.contains("e-datepicker")?t.getInstance(e[r],n.DatePicker).readonly=this.isReadonly:e[r].classList.contains("e-multiselect")?t.getInstance(e[r],i.MultiSelect).readonly=this.isReadonly:e[r].classList.contains("e-radio")&&(t.getInstance(e[r],l.RadioButton).checked||(this.isReadonly?e[r].parentElement.style.display="none":e[r].parentElement.style.display="inherit"));var s=this.element.querySelectorAll(".e-deletegroup"),a=this.element.querySelectorAll(".e-addrulegroup"),u=this.element.querySelectorAll(".e-removerule");!this.isReadonly&&this.ruleElem.classList.contains("e-readonly")&&this.ruleElem.classList.remove("e-readonly");for(var d=[s,a,u],r=0;r<d.length;r++)d[r].forEach(function(e){e.classList.contains("e-readonly")?e.classList.remove("e-readonly"):e.classList.add("e-readonly")});this.enableBtnGroup()},h.prototype.enableBtnGroup=function(){var e=this,t=!1;this.element.querySelectorAll(".e-btngroup-and-lbl, .e-btngroup-or-lbl, .e-qb-toggle").forEach(function(l){!l.classList.contains("e-qb-toggle")||l.classList.contains("e-active-toggle")||l.classList.contains("e-readonly")?l.classList.contains("e-qb-toggle")&&l.classList.contains("e-not-readonly")?l.classList.remove("e-not-readonly"):l.classList.contains("e-qb-toggle")&&l.classList.contains("e-readonly")?l.classList.remove("e-readonly"):l.classList.contains("e-active-toggle")?(l.classList.add("e-not-readonly"),t=!0):l.previousElementSibling.checked||l.classList.contains("e-readonly")?(l.classList.remove("e-readonly"),t?"AND"===l.textContent?l.classList.add("e-readonly-and"):l.classList.add("e-readonly-or"):("AND"===l.textContent&&e.isReadonly?(l.classList.remove("e-not"),l.classList.add("e-readonly-and")):(e.enableNotCondition&&l.classList.add("e-not"),l.classList.remove("e-readonly-and")),"OR"===l.textContent&&e.isReadonly?l.classList.add("e-readonly-or-not"):l.classList.remove("e-readonly-or-not"))):l.classList.contains("e-btn-disable")||l.classList.add("e-readonly"):(l.classList.add("e-readonly"),t=!1)})},h.prototype.isDateFunction=function(e){for(var t=["date","time","day","week","month","year","hour","minute","second","now","quarter","period","extract"],l=0,i=t.length;l<i;l++)if(e.toLowerCase().indexOf(t[l])>-1)return!0;return!1},h.prototype.getSqlString=function(e,t,l){var i=!1;l||""===l?l+="(":(l="",i=!0);var r=e.condition;e.not&&(l+=i?"NOT (":" NOT (");for(var o=0,n=e.rules.length;o<n;o++){if(e.rules[o].rules)l=this.getSqlString(e.rules[o],t,l);else{var s=e.rules[o],a="";if(s.value instanceof Array)if(s.operator.toString().indexOf("between")>-1)"date"!==s.type||this.isDateFunction(s.value[0])?a+=s.value[0]+" AND "+s.value[1]:a+='"'+s.value[0]+'" AND "'+s.value[1]+'"';else if("string"==typeof s.value[0]&&null!==s.value){a+='("'+s.value[0]+'"';for(var u=1,d=s.value.length;u<d;u++)a+=',"'+s.value[u]+'"';a+=")"}else a+="("+s.value+")";else s.operator.toString().indexOf("startswith")>-1?a+=s.value?'("'+s.value+'%")':"("+s.value+")":s.operator.toString().indexOf("endswith")>-1?a+=s.value?'("%'+s.value+'")':"("+s.value+")":s.operator.toString().indexOf("contains")>-1?a+=s.value?'("%'+s.value+'%")':"("+s.value+")":"number"===s.type||"boolean"==typeof s.value||null===s.value?a+=s.value:a+='"'+s.value+'"';s.operator.toString().indexOf("null")>-1||s.operator.toString().indexOf("empty")>-1?(t?s.field="`"+s.field+"`":s.field.indexOf(" ")>-1&&(s.field='"'+s.field+'"'),l+=s.field+" "+this.operators[s.operator]):(t?s.field="`"+s.field+"`":s.field.indexOf(" ")>-1&&(s.field='"'+s.field+'"'),l+=s.field+" "+this.operators[s.operator]+" "+a),s.condition&&""!=s.condition&&(r=s.condition)}o!==n-1&&(""===r&&(r=e.rules[o].condition),l+=" "+r.toUpperCase()+" ")}return i||(l+=")"),e.not&&(l+=")"),l},h.prototype.setRulesFromSql=function(e){e=e.replace(/`/g,"");var t=this.getRulesFromSql(e);this.setRules({condition:t.condition,not:t.not,rules:t.rules})},h.prototype.getRulesFromSql=function(e){this.parser=[],this.sqlParser(e),this.rule={condition:"and",not:!1,rules:[]};var t=this.processParser(this.parser,this.rule,[0]);return this.enableNotCondition?{condition:t.condition,not:t.not,rules:t.rules}:{condition:t.condition,rules:t.rules}},h.prototype.getSqlFromRules=function(e,t){return e||(e=this.getValidRules()),e=this.getRuleCollection(e,!1),this.getSqlString(this.getValidRules(e),t).replace(/"/g,"'")},h.prototype.sqlParser=function(e){var t,l=0;do{t=e.slice(l),l+=this.parseSqlStrings(t)}while(""!==t);return this.parser},h.prototype.parseSqlStrings=function(e){for(var t,l,i=["=","!=","<=",">=","<",">"],r=["AND","OR","NOT"],o=["IN","NOT IN","LIKE","NOT LIKE","BETWEEN","NOT BETWEEN","IS NULL","IS NOT NULL","IS EMPTY","IS NOT EMPTY"],n=0,s=i.length;n<s;n++)if(t=/^\w+$/.test(i[n])?"\\b":"",new RegExp("^("+i[n]+")"+t,"ig").exec(e))return this.parser.push(["Operators",i[n].toLowerCase()]),i[n].length;var a=this.parser[this.parser.length-1];if(!a||a&&"Literal"!==a[0])for(var n=0,s=r.length;n<s;n++)if(t=/^\w+$/.test(r[n])?"\\b":"",new RegExp("^("+r[n]+")"+t,"ig").exec(e))return this.parser.push(["Conditions",r[n].toLowerCase()]),r[n].length;for(var n=0,s=o.length;n<s;n++)if(t=/^\w+$/.test(o[n])?"\\b":"",new RegExp("^("+o[n]+")"+t,"ig").exec(e))return this.parser.push(["SubOperators",o[n].toLowerCase()]),o[n].length;return/^\(/.exec(e)?(this.parser.push(["Left","("]),1):/^\)/.exec(e)?(this.parser.push(["Right",")"]),1):/^(true|false)/.exec(e)?(l=/^(true|false)/.exec(e)[0],this.parser.push(["String",l]),l.length):/^null/.exec(e)?(l=/^null/.exec(e)[0],this.parser.push(["String",null]),l.length):/^`?([a-z_][a-z0-9_.\[\]\(\)]{0,}(\:(number|float|string|date|boolean))?)`?/i.exec(e)?(l=/^`?([a-z_][a-z0-9_.\[\]\(\)]{0,}(\:(number|float|string|date|boolean))?)`?/i.exec(e)[1],this.parser.push(["Literal",l]),l.length):this.checkLiteral()&&/^'?([a-z_][a-z0-9 _.\[\]\(\)]{0,}(\:(number|float|string|date|boolean))?)'?/i.exec(e)?(l=/^'?([a-z_][a-z0-9 _.\[\]\(\)]{0,}(\:(number|float|string|date|boolean))?)'?/i.exec(e)[1],this.parser.push(["Literal",l]),l.length+2):this.checkNumberLiteral(e)?(l=/^[0-9]+(\.[0-9]+)?/.exec(e)[0],this.parser.push(["Literal",l]),l.length):/^'((?:[^\\']+?|\\.|'')*)'(?!')/.exec(e)?(l=/^'((?:[^\\']+?|\\.|'')*)'(?!')/.exec(e)[0],this.parser.push(["String",l]),l.length):/^"([^\\"]*(?:\\.[^\\"]*)*)"/.exec(e)?(l=/^"([^\\"]*(?:\\.[^\\"]*)*)"/.exec(e)[0],this.parser.push(["DoubleString",l]),l.length):/^[0-9]+(\.[0-9]+)?/.exec(e)?(l=/^[0-9]+(\.[0-9]+)?/.exec(e)[0],this.parser.push(["Number",l]),l.length):/^-?[0-9]+(\.[0-9]+)?/.exec(e)?(l=/^-?[0-9]+(\.[0-9]+)?/.exec(e)[0],this.parser.push(["Number",l]),l.length):1},h.prototype.checkLiteral=function(){var e=this.parser[this.parser.length-1];if(!e)return!0;var t=this.parser[this.parser.length-2];return!("Left"!==e[0]||!t||"Conditions"!==t[0])},h.prototype.checkNumberLiteral=function(e){var t=this.parser[this.parser.length-1];if(!t)return!0;if(/^[0-9]+(\.[0-9]+)?/.exec(e)){var l=this.parser[this.parser.length-2],i=this.parser[this.parser.length-3];if("Left"===t[0]&&l&&"Conditions"===l[0])return!0;if("Conditions"===t[0]&&i&&i[1].indexOf("between")<0)return!0}return!1},h.prototype.getOperator=function(e,t){var l={"=":"equal","!=":"notequal","<":"lessthan",">":"greaterthan","<=":"lessthanorequal",">=":"greaterthanorequal",in:"in","not in":"notin",between:"between","not between":"notbetween","is empty":"isempty","is null":"isnull","is not null":"isnotnull","is not empty":"isnotempty"};if(e){if(0===e.indexOf("%")&&"%"===e[e.length-1])return"not like"===t?"notcontains":"contains";if(0!==e.indexOf("%")&&e.indexOf("%")===e.length-1)return"not like"===t?"notstartswith":"startswith";if(0===e.indexOf("%")&&e.indexOf("%")!==e.length-1)return"not like"===t?"notendswith":"endswith"}else{if("not like"===t)return"notequal";if("like"===t)return"equal"}return l[t]},h.prototype.getTypeFromColumn=function(e){return this.getColumn(e.field).type},h.prototype.processParser=function(e,t,l){for(var i,r,o,n,s,a,u,d,p,h,c=[],m=[],f=!1,g=0,v=e.length;g<v;g++)if("Literal"===e[g][0]){if(o={label:e[g][1],field:e[g][1]},"SubOperators"===e[g+1][0]){if(e[g+1][1].indexOf("null")>-1||e[g+1][1].indexOf("empty")>-1)o.operator=this.getOperator(" ",e[g+1][1]),o.value=null,o.type=this.getTypeFromColumn(o);else{var y=e[g+3][1]?e[g+3][1].replace(/'/g,""):e[g+3][1];o.operator=this.getOperator(y,e[g+1][1])}for(h=e[g+1][1],i=++g+1,r=v,i=g+1;i<r;i++)if(h.indexOf("between")<0&&"Left"===e[i][0])f=!0;else{if("Right"===e[i][0]&&f){g=i,f=!1;break}if(h.indexOf("null")>-1||h.indexOf("empty")>-1)break;if(h.indexOf("like")>-1&&"String"===e[i][0]){var C=e[i][1]?e[i][1].replace(/'/g,"").replace(/%/g,""):e[i][1];o.value=C,o.type="string"}else if(h.indexOf("between")>-1){if("Literal"===e[i][0]||"Left"===e[i][0])break;"Number"===e[i][0]?c.push(Number(e[i][1])):"String"===e[i][0]&&m.push(e[i][1].replace(/'/g,""))}else"Number"===e[i][0]?c.push(Number(e[i][1])):"String"===e[i][0]&&m.push(e[i][1].replace(/'/g,""));o.type=this.getTypeFromColumn(o)}h.indexOf("like")<0&&("Number"===e[i-1][0]?(o.value=c,o.type="number"):"String"===e[i-1][0]?(o.value=m,o.type="string"):h.indexOf("between")>-1&&"Conditions"===e[i-1][0]&&(o.value=c,o.type="number"),c=[],m=[],o.type=this.getTypeFromColumn(o))}else"Operators"===e[g+1][0]&&(o.operator=this.getOperator(e[g+2][1],e[g+1][1]),"Number"===e[g+2][0]?(o.type="number",o.value=Number(e[g+2][1])):(o.type="string",o.value=e[g+2][1]?e[g+2][1].replace(/'/g,""):e[g+2][1]),o.type=this.getTypeFromColumn(o));t.rules.push(o)}else{if("Left"===e[g][0]){if("Left"!==e[0][0]&&"not"===e[g-1][1])continue;for(this.parser=e.splice(g+1,v-(g+1)),n=this.enableNotCondition?{condition:"and",rules:[],not:!1}:{condition:"and",rules:[]},p=0,a=t.rules.length,s=0;s<a;s++)t.rules[s].rules&&p++;return l.push(p),t.rules.push(n),n=this.processParser(this.parser,n,l),t}if("Conditions"===e[g][0])"not"===e[g][1]?t.not=!0:t.condition=e[g][1];else if("Right"===e[g][0]){for(this.parser=e.splice(g+1,v-(g+1)),l.pop(),t=this.rule,d=l.length,u=0;u<d;u++)t=this.findGroupByIdx(l[u],t,0===u);return this.processParser(this.parser,t,l)}}return t},p([t.Event()],h.prototype,"created",void 0),p([t.Event()],h.prototype,"actionBegin",void 0),p([t.Event()],h.prototype,"beforeChange",void 0),p([t.Event()],h.prototype,"change",void 0),p([t.Event()],h.prototype,"dataBound",void 0),p([t.Event()],h.prototype,"ruleChange",void 0),p([t.Property({ruleDelete:!0,groupInsert:!0,groupDelete:!0})],h.prototype,"showButtons",void 0),p([t.Property(!1)],h.prototype,"summaryView",void 0),p([t.Property(!1)],h.prototype,"allowValidation",void 0),p([t.Property("Default")],h.prototype,"fieldMode",void 0),p([t.Property([])],h.prototype,"columns",void 0),p([t.Property(null)],h.prototype,"fieldModel",void 0),p([t.Property(null)],h.prototype,"operatorModel",void 0),p([t.Property(null)],h.prototype,"valueModel",void 0),p([t.Property()],h.prototype,"headerTemplate",void 0),p([t.Property("")],h.prototype,"cssClass",void 0),p([t.Property([])],h.prototype,"dataSource",void 0),p([t.Property("Horizontal")],h.prototype,"displayMode",void 0),p([t.Property(!1)],h.prototype,"enablePersistence",void 0),p([t.Property("Default")],h.prototype,"sortDirection",void 0),p([t.Property(5)],h.prototype,"maxGroupCount",void 0),p([t.Property("auto")],h.prototype,"height",void 0),p([t.Property("auto")],h.prototype,"width",void 0),p([t.Property(!1)],h.prototype,"matchCase",void 0),p([t.Property(0)],h.prototype,"immediateModeDelay",void 0),p([t.Property(!1)],h.prototype,"enableNotCondition",void 0),p([t.Property(!1)],h.prototype,"readonly",void 0),p([t.Property("")],h.prototype,"separator",void 0),p([t.Complex({condition:"and",rules:[]},c)],h.prototype,"rule",void 0),h=p([t.NotifyPropertyChanges],h)}(t.Component);return e.Columns=h,e.Rule=c,e.Value=m,e.ShowButtons=f,e.QueryBuilder=g,e}({},ej.base,ej.buttons,ej.dropdowns,ej.data,ej.inputs,ej.calendars,ej.splitbuttons,ej.popups),this.ejs=ej;
//# sourceMappingURL=ej2-querybuilder.min.js.map
